{"version":3,"sources":["jslet-ui.js"],"names":["root","factory","define","amd","require","exports","module","jslet","jsletlocale","window","this","ui","Control","Class","create","initialize","el","ctrlParams","Z","allProperties","_evalParams","isValidTemplateTag","template","ctrlClass","getControlClass","type","htmlTemplate","Error","formatMessage","DBControl","invalidHtmlTag","_styleClass","styleClass","undefined","_childControls","setParams","checkRequiredProperty","beforeBind","id","nextId","bind","jqEl","jQuery","addClass","afterBind","renderAll","ctrlType","name","prop","call","requiredProperties","arrProps","split","cnt","length","i","trim","expectedProperty","addChildControl","childCtrl","push","doUIChanged","removeAllChildControls","len","destroy","innerHTML","$super","_dataset","_isDBControl","dataset","isString","data","getDataset","Checker","test","required","isClass","Dataset","className","dsName","getDatasetInParentElement","addLinkedControl","refreshControl","evt","evtType","eventType","RefreshEvent","UPDATEALL","CHANGEMETA","metaName","_field","fieldName","doMetaChanged","UPDATELOOKUP","doLookupChanged","isMetaChanged","SCROLL","INSERT","DELETE","doValueChanged","UPDATERECORD","UPDATECOLUMN","pEl","getParentElement","removeLinkedControl","DBFieldControl","_valueIndex","_enableInvalidTip","_tableId","_tabIndex","field","fldName","k","lastIndexOf","_fieldMeta","substring","fieldMeta","valueIndex","isNumber","parseInt","tabIndex","value","tbIdx","existField","fldObj","getField","tip","title","setTabIndex","tabIdx","tableId","getValue","getFieldValue","getText","isEditing","getFieldText","getFieldError","renderInvalid","errObj","parent","message","removeClass","canFocus","focus","flag","disabled","readOnly","visible","gotoField","innerFocus","selectText","autoSelectAll","e","console","warn","cannotFocusControl","p","startsWith","indexOf","Function","unescape","invalidJsletProp","controls","register","ctrlName","toLowerCase","createControl","jsletparam","width","height","hidden","container","document","createElement","ctrlParam","controlType","DBTEXT","firstChild","removeChild","style","display","appendChild","body","bindControl","jsletParam","isInstalling","isHTMLElement","attr","unbindControl","rebindControl","install","pElement","onJsletReady","isFunction","isRtl","jqBody","hasClass","htmlTags","find","existIds","duplicatedId","global","afterInstall","uninstall","menuManager","off","hideAll","DnD","oldX","oldY","x","y","deltaX","deltaY","bindedControl","dragDelta","dragged","mouseDowned","self","_docMouseDown","event","fix","pageX","pageY","_doMouseDown","_docMouseMove","Math","abs","_doDragStart","_doDragging","_doMouseMove","_docMouseUp","_doDragEnd","_doMouseUp","_docKeydown","which","_doDragCancel","_docSelectStart","preventDefault","ctrl","doc","on","dnd","EditMask","_mask","_keepChar","_transform","_literalChars","_parsedMask","_format","_target","_buffer","prototype","maskChars","#","regexpr","RegExp","0","9","L","l","A","a","C","c","transforms","setMask","mask","keepChar","transform","checker","inArray","_parseMask","attach","target","jqText","_doKeypress","_doKeydown","_doBur","currentTarget","_doCut","originalEvent","clipboardData","_doPaste","detach","setValue","_clearBuffer","pos","ch","vch","fixedChar","prePos","preValuePos","valuePos","_getFixedCharAndPos","charAt","_showValue","maskObj","result","isMask","join","validateValue","cfg","begin","prevChar","notFound","iteralCnt","slice","_validateChar","maskChar","inputChar","maskCfg","regExpr","_getValidPos","toLeft","end","_packEmpty","str","_updateBuffer","_moveCursor","TextUtil","setCursorPos","chCode","String","fromCharCode","toUpperCase","getCursorPos","legnth","msk","setTimeout","getSelectedText","range","setData","pasteValue","getData","txtEl","start","v","setSelectionRange","createTextRange","moveStart","moveEnd","select","selectionStart","selectionEnd","selection","createRange","text","duplicate","collapse","FocusManager","_onChangingFocus","_focusKeyCode","_containerIds","_activeDataset","_activeField","_activeValueIndex","_initialize","onChangingFocus","focusKeyCode","activeDataset","activeField","activeValueIndex","pushContainer","containerId","popContainer","pop","tabPrev","_getContainer","proxy","_doChangingFocus","tabNext","jqContainer","ele","reverse","dsObj","focusedFlds","mergedFocusedFields","cancelFocus","focusedFields","idx","masterFldName","masterField","masterDataset","focusEditControl","isTabableElement","tagName","typeAttr","handleHostKeyDown","defaultFocusKeyCode","keyCode","shiftKey","stopImmediatePropagation","keydown","globalFocusManager","$","selectNextTabbableOrFocusable","selector","isLoop","selectables","sortByTabIndex","current","nextIndex","currEle","currentIndex","index","eq","selectPrevTabbableOrFocusable","prevIndex","items","item","item1","j","splice","focusable","element","expr","filters","parents","addBack","filter","css","map","mapName","img","nodeName","isTabIndexNotNaN","isNaN","parentNode","href","focusNext","focusPrev","extend","createPseudo","dataName","elem","match","tabbable","isTabIndexNaN","MessageBus","_messages","SIZECHANGED","_timeoutHandlers","sendMessage","messageName","messageBody","sender","handler","clearTimeout","ctrls","onReceiveMessage","subscribe","ctrlObj","unsubscribe","messageBus","ResizeEventBus","getResizableChild","childElements","children","child","getAttribute","RESIZABLE","resize","jsletCtrl","_activePopup","hide","checkSizeChanged","_bodyResize","debounce","removeAttr","resizeEventBus","htmlclass","GlobalZIndex","KeyCode","BACKSPACE","TAB","ENTER","SHIFT","CONTROL","ALT","CAPSLOCK","ESCAPE","SPACE","PAGEUP","PAGEDOWN","END","HOME","LEFT","UP","RIGHT","DOWN","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","IME","htmlElement","level","parentElement","findFirstParent","conditionFn","stopConditionFn","findJsletParent","isChild","testNode","TextMeasurer","updateText","lastText","rule","felementWidth","felement","createRule","position","left","top","margin","padding","overflow","setElement","fontSize","fontStyle","fontWeight","fontFamily","lineHeight","textTransform","letterSpacing","setElementWidth","getSize","ruleObj","getWidth","getHeight","textMeasurer","getCssValue","styleName","odiv","setEditableStyle","formElement","onlySetStyle","scrollbarSize","appendTo","innerWidth","remove","fn","getStyleObject","dom","get","returns","getComputedStyle","camelize","b","camel","replace","val","getPropertyValue","currentStyle","Clipboard","clipboard","getElementById","addEventListener","putText","Calendar","params","_value","_onDateSelected","_minDate","_maxDate","_currYear","_currMonth","_currDate","isDate","minDate","maxDate","onDateSelected","calendarLocale","yearPrev","monthPrev","monthNext","yearNext","Sun","Mon","Tue","Wed","Thu","Fri","Sat","today","html","jqTable","_doTableClick","dvalue","Date","click","d","getFullYear","getMonth","getDate","_fireSelectedEvent","incYear","incMonth","ctrlKey","incDate","_getNotNullDate","deltaDay","setDate","deltaMonth","oldDate","setMonth","newDate","deltaYear","setFullYear","_innerSetValue","oldValue","getTime","m","_setCurrDateCls","_refreshDateCell","_checkNaviState","btnToday","minY","minM","btnYearPrev","visibility","btnMonthPrev","maxY","maxM","btnYearNext","jslet_disabled","btnMonthNext","year","month","monthnames","monthNames","mname","otitle","otable","rows","tBodies","firstDay","w1","getDay","oneDayMs","date","otr","otd","oa","rowCnt","tdCnt","cells","jslet_date_value","node","jqLink","currM","currY","currD","MessageBox","show","caption","iconClass","buttons","callbackFn","hasInput","defaultValue","validateFn","opt","isCenter","resizable","minimizable","maximizable","stopEventBubbling","animation","owin","iconHtml","btnName","btnCount","btnHtml","inputHtml","setContent","toolBar","inputCtrl","obtn","close","showModal","setZIndex","toolBtn","childNodes","info","alert","timeout","omsgBox","error","confirm","isYesNo","prompt","isMultiLine","OverlayPanel","color","srcEle","PopupPanel","popupElement","checkAndHide","stopPropagation","backgroundColor","bottom","right","oldResizeHanlder","onresize","scrollWidth","scrollHeight","overlayPanel","zIndex","excludedEl","_onHidePopup","_excludedEl","_contentEl","onHidePopup","excludedElement","contentElement","contentEl","ajustX","ajustY","PopupElement","createPanel","sharedPopPnl","documentClickHandler","changeContent","newPopup","oldContent","content","border","activePopup","inPopupPanel","activePop","jqWin","winWidth","scrollLeft","winHeight","scrollTop","panel","w","outerWidth","h","outerHeight","hideCallBack","ProgressBar","_labelText","_binded","_setValue","labelText","jqLabel","jqValue","_oldValue","strValue","ProgressPopup","cancellable","onCancelled","_dialog","_cancellable","_onCancelled","closable","onClosed","progressBar","Rating","_itemCount","_splitCount","_itemWidth","_readOnly","_isReady","itemCount","isGTZero","splitCount","isGTEZero","_mouseMove","_mouseOut","_mouseUp","html1","html2","sTd","_getMovedWidth","_changed","cellIndex","offsetX","movedWidth","_round","ceil","intPart","decPart","unit","itemCnt","TipPanel","_hideTimerId","_showTimerId","_oldElement","_tipPanel","tips","leftOrEvent","arguments","isSameCtrl","WaitingBox","overlayColor","tipsAtNewLine","overlay","s","box","tipPanel","jqPnl","ph","pw","jqBox","round","Accordion","_selectedIndex","_onChanged","_items","selectedIndex","onChanged","isArray","panels","headHeight","captionCnt","before","jqCaptions","_doCaptionClick","contentHeight","innerHeight","wrap","setSelectedIndex","jqCaption","isRenderAll","jqBodies","pnlCnt","Desktop","_header","_onLoadMenu","_menuType","_menuWidth","_expanded","header","onLoadMenu","menuType","menuWidth","desktop","isTop","menuEl","wbEl","wbCfg","newable","isFixedHeight","enableLoading","onContentLoading","_doContentLoading","onContentLoaded","_doContentLoaded","onRemoveTabItem","_doRemoveTabItem","_workbench","menuCfg","onItemClick","_openMenu","menuItems","done","_mainMenu","_autoOpenMenu","_toggleMenu","autoOpen","menuContainer","jqHeader","jqWB","expand","showTabPanel","tabPanelId","setContentLoadedState","setTabPanelChanged","changed","setContentChangedState","openMenuById","menuId","_getMenuCfg","openMenuByName","menuName","tabItemId","key","isById","tabItemCfg","fadeIn","isActive","menuUrl","url","urlUtil","addParam","addTabItem","userIFrame","onclick","DesktopUtil","getCurrTabItemId","currTabItemId","location","getParam","isPageDebounce","getDesktop","checkDatasetChangedHandler","changingDatasets","registerEditableDataset","datasetNames","chgDatasets","setInterval","oldChanged","newChanged","isDiff","hasChangedData","clearInterval","desktopUtil","FieldSet","_caption","_collapsed","collapsed","tmpl","nodes","obody","_doExpandBtnClick","fsBody","slideDown","slideUp","_menus","menuid","unregister","menu","menus","menuBarShown","_contextObject","MenuBar","_onItemClick","_preHoverItem","_createMenuBar","setDisabled","operator","Menu","Operator","setChecked","checked","isPopup","_createBarItem","_menubarclick","_showSubMenu","omi","itemCfg","jsletvar","subMenu","jqMi","offset","posX","_activeMenuItem","obar","onClick","_inPopupMenu","each","_invoker","_activeSubMenu","invoker","_createMenuPopup","timerId","shadow","showAt","hostEl","jqHost","ctxElement","showContextMenu","contextObj","_createMenuItem","_createLine","_ItemClick","itemType","_hideSubMenu","delayTime","func","jqPmi","_ItemOver","defaultClickHandler","isCheckBox","isRadioBox","mi","disabledIconClass","onmouseover","onmouseout","menuObj","_menuObj","getMenuItemById","getItem","getMenuGroup","excludeSelf","getItemGroup","groupName","group","size","groupItems","changedCfg","otherGroups","jqIcon","SideMenuBar","_hasSubTitle","_popupWidth","_containerId","_closeTimeout","_showTimeout","oldHeight","hasSubTitle","popupWidth","_clearShowTimeout","_clearCloseTimeout","_doMouseLeave","_doMouseEnter","_doMenuClick","_itemHeight","parseFloat","jqItems","scrTop","maxScrTop","_getItemById","isFirstLevel","_innerCreateMenuItem","append","getMenuItems","groups","isLine","grpCnt","jqPopupContainer","jqItem","isHidden","posY","delta","containerHeight","visiCnt","floor","lastItemH","SplitPanel","directions","_direction","_floatIndex","_onExpanded","_onResize","_oldSize","_oldHeight","_oldWidth","_changeFloatSizeDebounce","_changeFloatSize","floatIndex","direction","onExpanded","onResize","_isHori","_splitterClsName","_splitterMouseDown","jqBtn","jqSplitter","panelDivs","lastIndex","jqPanel","oPanel","minSize","maxSize","Infinity","expanded","_splitterTracker","jqTracker","fixedSize","clsName","splitterSize","after","floatPanel","minBtnCls","splitters","oSplitter","_splitterDragStart","_splitterDragging","_splitterDragEnd","_splitterDragCancel","visiblePanel","panelCnt","floatSize","floatMinSize","panelCfg","notChangeSize","prev","next","_draggingId","jqFp","panelSize","_dragRangeMin","_dragRangeMax","fpMax","endDelta","currWidth","currHeight","TabControl","_activeIndex","_newable","_closable","_onActiveIndexChanged","_onAddTabItem","_onRemoveTabItem","_onCreateContextMenu","_hasContent","_isFixedHeight","_itemsWidth","_containerWidth","_ready","_leftIndex","_rightIndex","_maxHeaderWidth","_tabControlWidth","_tabControlHeight","_contextItemIndex","_onContentLoading","_onContentLoaded","_enableLoading","activeIndex","_chgActiveIndex","activeItemId","itemId","activeItem","hasContent","onAddTabItem","onActiveIndexChanged","onCreateContextMenu","innerAdd","_calcItemsWidth","_createContextMenu","oul","newTab","_newTabItem","isPromise","jqNavBtn","_setVisiTabItems","oitem","_renderTabItem","_checkTabItemCount","addItem","tabHeader","_getTabItemCfg","panelContainer","tabDisabled","jqPanels","jqTabPanels","innerChgActiveIndex","oli","itemContainer","oIframe","canChanged","_totalItemsWidth","_setNavBtnVisible","leftIndex","rightIndex","leftPos","jqBtnLeft","jqBtnRight","totalCnt","_createHeader","canClose","lastNode","insertBefore","_changeTabItem","_doCloseBtnClick","contextMenu","oncontextmenu","removeTabItem","_createBody","jqDiv","contentId","ocontent","jlTabItemId","useIFrame","jqHead","newItemCfg","noDuplicate","tabItems","newId","reloadTabItem","hasChangedFlag","hasChanged","noTabIndex","tabItemIndex","contentChanged","button","_innerRemoveTabItem","innerRemove","animate","elItem","tabPanel","active","_getNextValidIndex","canRemoved","isLeft","reload","currIdx","closeOther","closeAll","_menuItemClick","head","TabItem","Window","_resizable","_minimizable","_maximizable","_iconClass","_width","_height","_minWidth","_minHeight","_maxWidth","_maxHeight","_isCenter","_animation","_onSizeChanged","_onPositionChanged","_onActive","_onClosed","_stopEventBubbling","_isModal","_state","minWidth","minHeight","maxWidth","maxHeight","onSizeChanged","onPositionChanged","onActive","_doWinMouseMove","_doWinMouseDown","_changeBodyHeight","temp_dragging","cursor","activate","maximize","restore","_createTrackerMask","trackerMask","setPosition","_removeTrackerMask","_createTracker","_changeTrackerSize","tracker","changeSize","_removeTracker","jqClose","jqMin","minimize","jqMax","btnMax","jqOffsetP","fadeOut","action","pnode","_tempHeight","_tempWidth","_getHeaderHeight","offsetP","bringToFront","notUpdateLeftTop","getCaptionPanel","changeCaption","captionDiv","getContentPanel","showError","bodyDiv","jqNode","winIdx","maxIndex","nodeType","styleObj","_checkSize","srcEl","jqSrcEl","wdelta","hdelta","ojslet","holder","onmousedown","FieldControlAddon","DBPlace","editControl","_expandChildWidth","prefix","_prefix","setting","suffix","_suffix","expandChildWidth","hasAddon","_renderEditor","_renderOtherPart","editorEl","parentEl","param","valueStyle","FieldValueStyle","BETWEEN","dbCtrl","elId","ctrlDiv","arrPrefixOrSuffix","fixCfg","partEl","jqCtrlDiv","first","DBText","_beforeUpdateToDataset","_enterProcessed","_autoSelectAll","editMask","_position","beforeUpdateToDataset","enableInvalidTip","doFocus","doBlur","doKeydown","doKeypress","_skipFocusEvent","updateToDataset","_isBluring","K","status","editRecord","existStr","cutString","cursorPos","fieldValidator","checkInputChar","inputText","getType","DataType","STRING","chs","isForce","afterRefreshControl","editMaskCfg","maxLength","getEditLength","_keep_silence_","align","alignment","textAlign","activeElement","antiXss","htmlDecode","updateAllEvent","setFieldText","updateRecordEvent","onKeyDown","DBPassword","DBTextArea","DBCustomComboBox","_textReadOnly","textReadOnly","textCtrl","btnCls","comboButtonCls","dbtext","_textField","buttonClick","blur","dbbtn","popupUp","DBAutoComplete","MatchModes","_lookupField","_minChars","_minDelay","_beforePopup","_filterFields","_defaultFilterFields","_onGetFilterField","_matchMode","_timeoutHandler","lookupField","minChars","minDelay","matchMode","testValue","filterFields","beforePopup","onGetFilterField","contentPanel","isShowing","_isSelecting","canBlur","lkf","lookup","lkds","recordCount","closePopup","doChange","_invokePopup","confirmSelect","isPop","prior","_populate","_getDefaultFilterFields","lookupFldObj","codeFld","codeField","nameFld","nameField","lkDs","codeFldObj","nameFldObj","arrFields","_getFilterFields","lkFldObj","inputValue","filterFlds","eventFunc","getFunction","filterValue","lkFld","oldFlag","autoRefreshHostDataset","editFilter","filtered","fixedFilter","dataRec","getRecord","DBAutoCompletePanel","r","dlgWidth","showPopup","_destroyPopPanel","autoCompleteObj","comboCfg","lkfld","lkDataset","fields","getNormalFields","totalChars","displayWidth","totalWidth","defaultCharWidth","cnth","dlgHeight","tableparam","noborder","hasSelectCol","hasSeqCol","hideHead","onRowClick","fldValue","keyValue","setFieldValue","afterSelect","popup","doClosePopup","oldRecno","recno","DBBetweenEdit","_minEleId","_maxEleId","lbl","betweenLabel","ctrlCfg","JSON","stringify","DBCheckBox","_beforeClick","_skipRefresh","beforeClick","_doClick","DBCheckBoxGroup","_columnCount","_hasSelectAllBox","_itemIds","columnCount","hasSelectAllBox","activeEle","activeId","delegateTarget","chkEle","chkBoxes","checkbox","checkboxs","chkcnt","values","valueCnt","lookupNotFound","lkCnt","noOptions","isNewRow","_innerEditFilterExpr","editItemDisabled","Expression","disableOption","selectAll","recnoSilence","eval","keyField","getCurrentDisplayValue","currCheckBox","_is_silence_","chkBox","allCnt","allBoxes","isAllSelected","limitCount","valueCountLimit","NORMAL","count","showInfo","invalidCheckedCount","itemIds","DBCKEditor","_editorId","_editor","CKEDITOR","editorId","editor","_doFocus","_doBlur","_doChange","state","setReadOnly","resetDirty","checkDirty","DBComboSelect","showStyles","_showStyle","_popupHeight","_contentPanel","_pickupField","_onGetSearchField","_correlateCheck","_autoSelected","textField","popupHeight","showStyle","onGetSearchField","correlateCheck","autoSelected","btnEle","parentField","DBComboSelectPanel","customButtonLabel","onCustomButtonClick","comboSelectObj","_isShowing","fieldObject","searchBoxEle","_oldFilter","_oldFiltered","_restoreLkDsEvent","_confirmSelectDebounce","_confirmSelect","lookupDs","isMultiple","MULTIPLE","_initSelected","showType","otree","_create","_setLookupDsEvent","_showTips","_focus","dispCtrl","_oldLkDsCheckSelectable","onlyLeafLevel","onCheckSelectable","hasChildren","_oldLkDsListener","datasetListener","DatasetEvent","AFTERSELECT","jqPh","_confirmAndClose","F","_findData","treeParam","displayFields","hasCheckBox","expandLevel","tableParam","hasFindDialog","hasFilterDialog","findByKey","disableControls","arrKeyValues","valueSeparator","selectByKeyValue","enableControls","searchText","findFldName","searchField","findingValue","findFldNames","currRecno","options","startRecno","findingByText","matchType","found","findByField","isEqual","isMulti","selectedKeyValues","cannotSelect","_afterSelect","DBDataLabel","DBDatePicker","dateValue","dataRange","min","max","DBHtml","DBImage","_locked","_baseUrl","_altField","_enableViewer","_viewUrlField","baseUrl","enableViewer","viewUrlField","altField","locked","ImageViewer","viewer","_getImgUrl","isForViewer","srcUrl","alt","lockedImageTips","src","srcURL","altText","DBLabel","isLabel","METANAMES","subType","REQUIREDCHAR","displayLabel","DBList","pfld","afterCheckBoxClick","afterSelectAll","selected","DBLookupLabel","_lookupValue","_returnField","lookupValue","returnField","DBRadioGroup","radioEle","radios","radio","DBRangeSelect","_beginItem","_endItem","_step","beginItem","endItem","step","multiple","_doChanged","_currOption","inProcessing","renderOptions","arrhtm","nullText","arrValue","optCnt","vcnt","opts","DBRating","_required","DBSelect","_groupField","_lookupDataset","_isRendering","groupField","lookupDataset","_doCheckLimitCount","_setDefaultValue","firstItemValue","dftValue","changedStatus","FieldLookup","groupLookup","groupFldObj","groupIsLookup","indexFields","groupValue","groupDisplayValue","preGroupValue","optValue","label","moreLookupRecords","_checkOptionEditable","valueChanged","DBSelectView","_displayFields","dispFields","dispField","_innerDisplayFieldsExpr","_renderOptions","fixedIndexFields","dispFieldExpr","DBSpinEdit","tag","_createControl","upButton","downButton","_isDisabled","decValue","incValue","minValue","Number","NEGATIVE_INFINITY","maxValue","POSITIVE_INFINITY","setValueToDataset","silence","_getRange","jqUpBtn","jqDownBtn","DBTimePicker","_is12Hour","_hasSecond","is12Hour","hasSecond","minTimePart","hour","minute","second","maxTimePart","_splitTime","minHour","maxHour","_getOptions","timePart","jqHour","jqMinute","jqAmPm","getHours","getMinutes","getSeconds","parts","DATE","setHours","setMinutes","setSeconds","DBUEditor","UE","getEditor","addListener","getContent","ListViewModel","isTree","visibleCount","visibleStartRow","visibleEndRow","needShowRows","allRows","currentRowno","currentRecno","onTopRownoChanged","onVisibleCountChanged","onCurrentRownoChanged","onNeedShowRowsCountChanged","onCheckStateChanged","fixedRows","initial","ds","_parentField","_keyField","refreshModel","pId","tmpNode","tmpKeyValue","currRec","recCnt","pnodes","parentValue","keyvalue","isbold","_updateNodeBoldStyle","_setLastFlag","_refreshNeedShowRows","update","cnode","selectedByRecno","pNode","islast","notFireChangedEvent","_findVisibleNode","currCnt","_innerFindNode","getLevel","rownoToRecno","rowno","recnoToRowno","setVisibleStartRow","notFireEvt","maxVisibleNo","getNeedShowRowCount","getVisibleStartRow","setVisibleEndRow","endRow","getVisibleEndRow","setVisibleCount","getVisibleCount","getCurrentRow","skipSetCurrentRowno","_skipSetCurrentRowno","setCurrentRowno","checkVisible","preRowno","currRow","lowestRowno","maxRow","getCurrentRowno","getCurrentRecno","nextRow","priorRow","num","nextPage","priorPage","_iterateNode","_callbackFn","expandAll","collapseAll","syncDataset","checkNode","relativeCheck","onlyCheckChildren","_updateChildState","_updateParentState","checkChildNodes","childNode","newState","childState","pState","reset","DBTreeView","_useArrow","_hasLine","_hasCheckBox","_correlative","_onlyCheckChildren","_iconClassField","_expandLevel","_onItemDblClick","_beforeCheckBoxClick","_afterCheckBoxClick","_onGetIconClass","_onRenderItem","_enableErrorFinding","iconWidth","itemHeight","iconClassField","useArrow","hasLine","correlative","enableErrorFinding","onItemDblClick","beforeCheckBoxClick","onGetIconClass","onRenderItem","scrBarSize","ti","E","gotoNextError","last","notFF","onmousewheel","wheelEvent","wheelDelta","detail","listvm","scrollEvent","evaluator","oldWidth","nodeHeight","strHeight","treePanelHeight","treePanelWidth","nodeCount","_initVm","_initFrame","strCheckbox","lines","NODETYPE","strLines","_doRowClick","_doRowDblClick","sb","numb","_skip_","nextError","firstError","_fillData","_doCurrentRowChanged","_syncScrollBar","allCount","prevRowno","_doCheckBoxClick","_getTrByRowno","row","jsletrowno","prevRow","_getTextTd","TREENODECLASS","_doExpand","treeNode","_syncToDs","hasCheckbox","vCnt","topRowno","availbleCnt","nodeWidth","preRowNo","ajustScrBar","maxNodeWidth","_fillNode","_checkScrollBar","_setCheckClsName","oCheckBox","jqCheckBox","nodeTbl","rowNo","cellCnt","requiredCnt","insertCell","pitem","TREELINECLASS","empty","line","jqSign","oexpander","noWrap","minusBottom","plusBottom","minus","plus","joinBottom","checkSelectable","ocheckbox","oIcon","iconClsId","isLeaf","oText","jqTd","existRecordError","getRecordErrorInfo","jqScr","scr","clientHeight","checkAll","uncheckAll","SELECTALL","SELECTRECORD","noLineMinus","noLinePlus","TREECHECKBOXCLASS","unChecked","mixedChecked","childChecked","treeNodeLevel","table","TableCellEditor","tableCtrl","colCfg","columns","_tableCtrl","_sysColumns","tblDataset","innerColumns","isBool","dataType","isManual","editorTabIndex","alignStr","editableFields","readOnlyFields","ACTION","EDITACTION","fieldReadOnly","fieldDisabled","additionStr","BOOLEAN","widthCssName","_editPanel","rowHeight","_currField","showEditor","hideEditor","cellPos","firstId","firstOffset","offsetHeight","jqEditor","currentField","CellRender","createHeader","cellPanel","colSetting","createCell","refreshCell","recNo","DefaultCellRender","noRefresh","getFieldTextByRecno","urlExpr","calcUrl","urlTarget","jqCellPanel","_showSelected","SequenceCellRender","_seqColHeader","_reverseSeqCol","SelectCellRender","_beforeSelectAll","_onSelectAll","_afterSelectAll","ocheck","jqCheck","_doSelectBoxClick","EditActionCellRender","jqCell","DBTable","appendTip","_doAppendRecord","deleteTip","_doDeleteRecord","SubgroupCellRender","BoolCellRender","getFieldValueByRecno","TreeCellRender","indentWidth","jqExpBtn","expandedByRecno","getIconClass","iconCls","cellRenders","defaultCellRender","treeCellRender","boolCellRender","sequenceCellRender","selectCellRender","editActionCellRender","subgroupCellRender","TABLECLASS","currentrow","scrollBarWidth","selectColWidth","hoverrow","TableColumn","disableHeadSort","disableFilter","mergeSame","cellRender","colNum","displayOrder","colSpan","TableSubgroup","hasExpander","TableHead","subHeads","rowSpan","AbstractDBTable","_fixedRows","_fixedCols","_hasSeqCol","_hasSelectCol","_noborder","_editable","_hideHead","_onlySpecifiedCol","_disableHeadSort","_disableMouseWheel","_aggregated","_autoClearSelection","_selectBy","_rowHeight","_headRowHeight","_footerRowHeight","_treeField","_columns","_editableFields","_readOnlyFields","_onRowClick","_onRowDblClick","_onCellClick","_onSelect","_beforeSelect","_onFillRow","_onFillCell","_onAppendRecord","_onDeleteRecord","_defaultCellRender","_hasFindDialog","_hasFilterDialog","_repairHeight","subgroup","_isHoriOverflow","_currRow","_currColNum","_editingField","_editorTabIndex","_rowHeightChanged","_autoStretch","_minVisibleRows","_maxVisibleRows","_oldVisibleRows","_cellEditor","fixedCols","cols","headRowHeight","footerRowHeight","reverseSeqCol","seqColHeader","editable","aggregated","autoClearSelection","disableMouseWheel","onlySpecifiedCol","selectBy","treeField","isObject","currColNum","oldColNum","_adjustCurrentCellPos","_showCurrentCell","_findDialog","findingField","onRowDblClick","onCellClick","onSelect","onSelectAll","beforeSelect","beforeSelectAll","onFillRow","onFillCell","onAppendRecord","onDeleteRecord","autoStretch","minVisibleRows","maxVisibleRows","cellEditor","colObj","getColNumByField","gotoColumn","lastColNum","getFieldByColNum","_calcTabIndex","masterFldObj","getMasterFieldObject","charHeight","charWidth","_widthStyleId","_initializeVm","_bindEvents","DataSetStatus","BROWSE","_filterPanel","DBTableFilterPanel","jqFilterBtn","tblPos","changeField","_doDblCellClick","offsetY","_doCellClick","checkFn","jsletrecno","callBackFn","aborted","altKey","showFindDialog","selectAllCells","copySelection","isTabKey","tabPrior","movePriorCell","moveNextCell","_doBeforeSelect","_processSelection","copy","fixed","fixedCol","fixedRow","copyInfo","FindDialog","headSectionHt","fitExcel","selectedText","getSelectionText","_refreshSelection","editingFields","_getEditingFields","focusMngr","onChangingFocusFn","_showCurrentRow","_hideCurrentRow","_innerDestroy","_calcParams","_createFrame","_updateSortFlag","hasCtrlKey","hasShiftKey","hasAltKey","_getSelectionFields","startColNum","endColNum","tmp","isSelected","add","_preRecno","_preColNum","_preTmpRecno","_preTmpColNum","removeAll","_processColumnSelection","_processRowSelection","_prepareColumn","getColumnObj","colCnt1","cobj","seqColWidth","isSeqCol","isSelectCol","isSubgroup","tmpColumns","colCnt2","fldcnt","colCnt","getFields","getTopField","isUnique","n","sort","cobj1","cobj2","ord1","ord2","innerHeads","ohead","context","depth","_convertField2Head","maxHeadRows","_calcHeadSpan","preColCnt","fixedColNum","heads","childCnt","parentHeadObj","checkHtml","htmlStr","reg","fldChildren","isBoolColumn","sWidth","fixedSectionHt","checkAggregated","footSectionHt","hasFixedCol","fixedColWidth","_setScrollBarMaxValue","jqVScrollBar","contentSectionHt","_changeColWidthCssRule","cssName","styleEle","styleSheet","sheet","cssRules","rules","cssRule","selectorText","_changeColWidth","deltaW","designMode","_changeContentWidth","_refreshSeqColWidth","oldSeqColWidth","getTotalWidth","totalWidthStr","leftHeadTbl","leftFixedTbl","leftContentTbl","rightHeadTbl","rightFixedTbl","rightContentTbl","rightFootTbl","_checkHoriOverflow","generateWidthStyle","styleHtml","checkDropable","currCell","jsletColCfg","srcRowIndex","dragTransfer","rowIndex","srcCellIndex","currRowIndex","currCellIndex","srcFldName","currFldName","srcPFldObj","currPFldObj","dbtableframe","norecord","leftFootTbl","jqRightHead","_doSplitHookDown","_doSplitHookUp","isDraggingColumn","_doHeadClick","_head_label_cliecked","transfer","dataTransfer","dropEffect","effectAllowed","destField","_moveColumn","jqLeftFixedTbl","jqRightFixedTbl","jqLeftContentTbl","jqRightContentTbl","hasLeft","_isCurrCellInView","temp","focusing","splitter","bodyMleft","currColId","_renderHeader","noRecordDiv","_renderBody","destCellIndex","moveOneRow","srcStart","srcEnd","destStart","destEnd","colNo","srcCells","destCells","destCell","insertAfter","moveOneTableColumn","rowObj","createTHead","preColNo","srcCell","srcColCfg","destColCfg","destFldName","moveField","currField","dataRows","_changeColNum","headRows","srcCellLen","destCellLen","firstDestColNum","newStart","_calcAndSetContentHeight","rh","_stretchContentHeight","_stretchContentRow","contentWidth","clientWidth","_refreshHeadCell","oth","ochild","sh","_isCellEditable","_createHeadCell","sorttitle","travHead","arrHeadCfg","ccnt","leftHeadObj","rightHeadObj","insertRow","jqTr1","jqTr2","sortedCell","indexField","ohook","tblContainer","jqTblContainer","bodyMTop","jqHook","currLeft","splitDiv","lastChild","_getColumnByField","ctrlKeyPressed","_doSort","sortField","isMultiSort","toggleIndexField","leftHeadCells","rightHeadCells","sortFields","mergedIndexFields","allHeadCells","sortDiv","sortFlag","sortObj","order","oJslet","_getTableRow","offsetTop","otrRecno","_renderCell","isFirstCol","_renderRow","sectionNum","onlyRefreshContent","rightBody","leftBody","isfirstCol","startRow","fldCnt","sysColLen","rightRows","visibleRowCnt","leftRows","oldRowCount","_renderTotalSection","_fillTotalSection","aggregateValues","aggregatedValues","otrLeft","otrRight","sysColCnt","totalValue","aggregateValueObj","labelDisplayed","canShowLabel","totalLabel","NUMBER","sum","dispFmt","displayFormat","displayValue","formatNumber","noRecord","_fillRow","isFixed","clen","contentRows","sameValueNodes","isFirst","actualCnt","_fillCell","isSameAsPrevious","cell","sameNode","jqFirstTd","getFieldErrorByRecno","refreshCurrentRow","contentBody","fixedBody","_getLeftRowByRecno","_getCurrCellEl","cellEl","contentRow","jqContentPanel","currTd","currTdLeft","offsetLeft","currTdWidth","offsetWidth","containerWidth","containerLeft","borderW","oldScrLeft","currColLeft","scrWidth","prevCell","ocells","sw","scrBar","toggle","_doMetaChanged","currFld","col","AGGREGATED","BEFORESCROLL","checkFilterBtnStyle","preRecno","defaultChecked","leftFixedBody","leftContentBody","isEditable","appendRecord","deleteRecord","newHeight","parsedHeads","Splitter","_splitDiv","isDragging","unattach","onSplitEnd","onSplitCancel","tblCtrl","_filterDatasetObj","FilterDataset","_filterDataset","filterDataset","_dbtable","_jqFilterBtn","_currFieldName","_currFilterExpr","dsFilter","cancel","_panel","cancelFilter","FilterPanel","ok","clear","clearAll","isEmpty","getFilterExpr","_setFilterBtnStyle","records","_clearFilterBtnStyle","dsHost","dsFilterExpr","filterText","getFilterExprText","dbContainer","findData","jqFindingValue","isStart","_findingField","findDialog","_containerEl","placeholder","_left","_top","dlgEl","jqFind","oldField","DBChart","chartTypes","legendPositions","_chartType","_categoryField","_valueFields","_chartTitle","_legendPos","_recordRange","RecordRange","ALL","_reverse","_fieldValidated","_echart","_onSetChartOption","chartType","categoryField","valueFields","chartTitle","legendPos","recordRange","onSetChartOption","_getEChart","echarts","init","_validateFields","fieldNotFound","_getLineRecord","xLabels","yValues","yFields","legendLabels","endRecno","CURRENT","valueFldName","valueArr","isInit","valueFldCnt","isSelectedRange","SELECTED","_getLineRecordReverse","_getLineData","_getPieData","chartData","_drawLineChart","echart","option","legend","xAxis","yAxis","series","stack","chtype","setOption","_drawPieChart","drawChart","is","hasSelectedRecords","jqplot","DBEditPanel","_totalColumns","_labelCols","_onlySpecifiedFields","_includeFields","_excludeFields","_layout","_hasLabel","_metaChangedDebounce","labelCols","between","onlySpecifiedFields","hasLabel","layout","fldCfg","dataCols","inFirstCol","showLine","includeFields","excludeFields","_calcLayout","fldLayout","allFlds","fcnt","fldLayouts","layoutCnt","exFields","inFields","dftDataCols","colsInRow","_innerLabelCols","_innerDataCols","getEditField","editFld","oLabel","editorCfg","ohr","octrlDiv","opanel","ctrlId","layouts","layoutHeight","DBInspector","_calcLabelWidth","columnCnt","arrLabelWidth","fieldLayouts","tHead","fldCtrl","oldRowNo","preRowIndex","DBINSPECTOR","labelColCls","editorColCls","DBError","ERROR","DBPageBar","_showPageSize","_pageSizeList","_currPageCount","showPageSize","pageSizeList","pageSize","refresh","pageNum","_jqPageSize","pgSizeList","pageNo","requery","_jqFirstBtn","_jqPriorBtn","_jqNextBtn","_jqLastBtn","_jqRefreshBtn","_jqPageNum","pageCount","CHANGEPAGE","_refreshPageNum","_refreshButtonStatus","pageCnt","prevDisabled","nextDisabled","BatchEditDialog","editFields","_editFields","_onChanging","_batchDataset","getEditableFields","unique","addFieldFromDataset","defaultExpr","onChanging","creating","_dlgId","_createDialog","bedLocale","onlySelectedId","onlyNullId","onlySelected","onlyNullValue","onlyNull","_modifyData","existDatasetError","errorData","fldNames","allFldObjs","iterate","ChartDialog","setProp","propName","_chartId","_parsedValueFields","_chartSettingDs","_chartSettingDsName","_chartTypeDs","chartLocale","code","ctLine","ctBar","ctPie","ctStackBar","chartTypeDs","isEnum","ranges","rrAll","rrCurrent","rrSelected","rangeDs","valueFldLkDs","onFieldChanged","_doFieldChanged","_chartTypes","excludeValueFields","_excludeValueFields","_refreshValueFields","valueFieldsRequired","chartCfg","chartObj","valueFlds","ExportDialog","_exportDataset","_onExported","_onQuerySchema","_onSubmitSchema","_progressBar","_hasSchemaSection","hasSchemaSection","fileName","existedErrorData","_innerShow","_querySchema","_hasDetailDataset","_refreshFields","description","jqExpportFile","onQuerySchema","onSubmitSchema","onExported","edLocale","exportLKDs","isFireGlobalEvent","expFldCfg","expHtml","schemaName","saveAsSchema","saveSchema","deleteSchema","onlyOnce","exportData","_exportData","_saveSchema","_saveAsSchema","_deleteSchema","dsExport","_submitSchema","schema","inuputSchemaLabel","_isProgChanged","queryFn","exportDialog","schemaData","changedRecord","actionFn","fileAndFieldsRequired","defaultXPorter","excelXPorter","exportAggregated","onExporting","_doExporting","_doExported","percent","addFields","fieldRecords","fieldNames","isDetailDs","isActionCol","isEdtActCol","detailDs","detailDataset","all","dialogCfg","_imageUrl","isModal","imageUrl","ImportDialog","_importDataset","_parsedData","_onCustomImport","_onImporting","_onImported","_schemaDsName","_schemaLkDsName","_colHeaders","onCustomImport","onImporting","onImported","schemaLKDs","auditLogEnabled","logChanges","importDialogLocale","schemaDs","_doSchemaChanged","fieldLabel","columnHeader","fixedValue","importData","files","_readFile","_importData","innerRefresh","importDialog","_jl_","fieldMaps","_getFieldMaps","dsSchema","dsSchemaLk","startSilenceMove","foundRecno","endSilenceMove","existedSchema","strMaps","_getColHeaders","_isSaving","labels","errLabels","duplicateFields","fileObj","notSupportFile","reader","FileReader","onload","fileContent","parsedResult","_addColumnHeader","noData","readAsBinaryString","headers","colHeader","_mapFieldColumn","rec","mapFlds","mapFldCnt","parse","arrColHeaders","headerCnt","dsColHeader","schColHeader","mapFld","noColHeader","colHeaders","isSuccess","fldMap","textRec","parsedData","textList","importingFn","progressBarObj","StepProcessor","importTextList","_doImported","run","InputSettingDialog","doProxyFieldChanged","proxyFldName","proxyFldObj","hostFldObj","scale","dateFormat","displayControl","validChars","hostLkObj","lkObj","toPlanObject","editorObj","fldType","labelLabel","labelFocused","labelValueFollow","labelDefaultValue","proxyHostFieldName","proxyFieldChanged","_inputSettingDs","custContextFn","changingFldName","contextRules","condition","customized","enableContextRule","propValue","_isInit","_settings","hostDsName","hostFldName","dsSetting","fldSetting","_hostDataset","_onRestoreDefault","hostDataset","onClosedFn","onRestoreDefault","onRestoreDefaultFn","_initializeFields","tblFields","tableWidth","hostDs","isKeepFields","isDsFld","focused","valueFollow","save","propSetting","defaultInputSettingDialog","DatasetDesigner","_datasetMetas","_onLoadDatasetMeta","_onSaveDatasetMeta","_prepareDataset","onLoadDatasetMeta","onSaveDatasetMeta","dsgnLocale","dtString","dtNumber","dtDate","dtBoolean","dtDataset","dtAction","dtEdit","alLeft","alCenter","alRight","vsNormal","vsBetween","vsMultiple","objAccessor","origValue","fName","fShortName","fLabel","fDisplayLabel","fTip","fDateType","fDetailDataset","fLength","diaplayFormat","fScale","fDefaultExpr","fDefaultValue","customValueAccessor","fValueStyle","fDisplayWidth","fDisplayOrder","fAlignment","fDisplayFormat","fEditControl","fvEditControl","fNullText","fvNullText","fFormula","fReadOnly","fVisible","fUnitConverted","fRequired","fDataRange","fRegularExpr","fUnique","fEditMask","fValueCountLimit","fValidChars","fMergeSame","fMmergeSameBy","fAggraded","fAggradedBy","fValueFollow","fFocused","fFixedValue","fAntiXss","fTrueValue","fFalseValue","fTrueText","fFalseText","fLookup","dsgnField","_doDataTypeChanged","meta","otherwise","dsDesc","dsKeyField","dsCodeField","dsNameField","dsParentField","dsSelectField","dsStatusField","dsContextRules","dsQueryUrl","dsSubmitUrl","dsRecordClass","dsPageSize","dsFixedIndexFields","dsIndexFields","dsFixedFilter","dsFiltered","dsReadOnly","dsAuditLogEnabled","dsObject","AFTERSCROLL","_doObjectChanged","log","queryDatasetMeta","dsMetas","_parse","addDatasetMeta","addEnumDatasetMeta","deleteDatasetMeta","parentId","fldMeta","fldId","fldLen","arrObj","objCode","objName","objType","dsMeta","dsId","jqDataset","jqDsLookup","jqDsFilter","jqField","dsgnDataset","jqFldDetail","jqFldCommon","jqFldAction","jqFldEditAction","jqFldEditable","jqFldBool","jqFldLookup","jqFldString","jqFldNumber","DATASET","eventAction","fire","sgcWebSocket","host","subprotocol","user","password","transport","f","open","websocket","WebSocket","onopen","onmessage","g","stream","onclose","reason","clean","wasClean","onerror","send","readyState","EventSource","XMLHttpRequest","xhr","ActiveXObject","wsSocket","serverIp","onSavingReport","Report","reportServerIp","getWsSocket","WsSocket","reportBo","decodeURIComponent","escape","atob","savingReportFn","design","datasets","reportId","reportName","templateXml","printFields","isPlanObject","_combineReportBo","designReport","preview","printRange","previewReport","print","printReport","inDesign","reportBO","btoa","encodeURIComponent","rptDatasets","dsCode","rtnCfg","dsCodes","_createRptDataset","rptDataset","exportTextArray","exportHeader","notFoundDs","rptFields","dsPrintFields","arrFldNames","defaultReport","assistantURL","authURL","ws","connected","needAlert","version","openCallBackFn","messageText","msgName","msgBody","onMessage","msg","tips1","ignoreWarning","msgText","_innerSend","report","upgrade","upgradeUrl","getVersion"],"mappings":"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","file":"jslet-ui.min.js","sourcesContent":["/*!\r\n * Jslet JavaScript Framework v4.0.0\r\n * http://www.jslet.com\r\n *\r\n * Copyright 2016 Jslet Team\r\n * Released under GNU AGPL v3.0 license and commercial license\r\n */\r\n\r\n/* jshint ignore:start */\r\n\"use strict\";\r\n(function (root, factory) {\r\n    if (typeof define === 'function') {\r\n    \tif(define.amd) {\r\n\t        define('jslet-ui', ['jslet-data', 'jslet-locale'], factory);\r\n\t    } else {\r\n\t    \tdefine(function(require, exports, module) {\r\n\t    \t\trequire('jslet-css');\r\n\t    \t\tvar jslet = require('jslet-data');\r\n\t    \t\tvar jsletlocale = require('jslet-locale');\r\n\t    \t\tmodule.exports = factory(jslet, jsletlocale);\r\n\t    \t});\r\n\t    }\r\n    } else {\r\n    \tfactory(window.jslet, window.jsletlocale);\r\n    }\r\n})(this, function (jslet, jsletlocale) {\r\n\tif(!jslet.ui) {\r\n\t\t/**\r\n\t\t * @class\r\n\t\t * @static\r\n\t\t */\r\n\t\tjslet.ui = {};\r\n\t}\r\n\r\n/* jshint ignore:end */\r\n\n/**\r\n* @class\r\n* \r\n* Control Class, base class for all control.\r\n*/\r\njslet.ui.Control = jslet.Class.create({\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Constructor method.\r\n\t * \r\n\t * @param {HtmlElement} el HTML element.\r\n\t * @param {String | Object} ctrlParams Parameters of this control, it would be a JSON string or plan object, like: '{prop1: value1, prop2: value2}'.\r\n\t */\r\n\tinitialize: function (el, ctrlParams) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\r\n\t\tZ.allProperties = null;\r\n\t\tctrlParams = jslet.ui._evalParams(ctrlParams);\r\n\t\tif (Z.isValidTemplateTag\t&& !Z.isValidTemplateTag(Z.el)) {\r\n\t\t\tvar ctrlClass = jslet.ui.getControlClass(ctrlParams.type), template;\r\n\t\t\tif (ctrlClass) {\r\n\t\t\t\ttemplate = ctrlClass.htmlTemplate;\r\n\t\t\t} else {\r\n\t\t\t\ttemplate = '';\r\n\t\t\t}\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.invalidHtmlTag, template));\r\n\t\t}\r\n\t\tZ._styleClass = null;\r\n\t\t\r\n\t\tZ.styleClass = function(styleClass) {\r\n\t\t\tif(styleClass === undefined) {\r\n\t\t\t\treturn Z._styleClass;\r\n\t\t\t}\r\n\t\t\tZ._styleClass = styleClass;\r\n\t\t};\r\n\t\t\r\n\t\tZ._childControls = null;\r\n\t\tZ.setParams(ctrlParams);\r\n\t\tZ.checkRequiredProperty();\r\n\t\tZ.el.jslet = this;\r\n\t\tZ.beforeBind();\r\n\t\tif(!Z.el.id) {\r\n\t\t\tZ.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tZ.bind();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(Z._styleClass) {\r\n\t\t\tjqEl.addClass(Z._styleClass);\r\n\t\t}\r\n\t\tZ.afterBind();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Before bind.\r\n\t * Child control can extend this method.\r\n\t */\r\n\tbeforeBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Bind this control to a HTML element.\r\n\t */\r\n\tbind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * After bind.\r\n\t */\r\n\tafterBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Render this control, if control configuration is changed, call this method to refresh control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\trenderAll: function() {\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tsetParams: function (ctrlParams) {\r\n\t\tif (!ctrlParams) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ctrlType = ctrlParams.type;\r\n\t\tthis.styleClass(ctrlParams.styleClass);\r\n\t\t\r\n\t\tfor(var name in ctrlParams) {\r\n\t\t\tvar prop = this[name];\r\n\t\t\tif(name == 'type' || name == 'styleClass') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(prop && prop.call) {\r\n\t\t\t\tprop.call(this, ctrlParams[name]);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(ctrlType +  \" NOT support control property: \" + name);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tcheckRequiredProperty: function () {\r\n\t\tif (!this.requiredProperties) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar arrProps = this.requiredProperties.split(','),\r\n\t\t\tcnt = arrProps.length, name;\r\n\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\tname = arrProps[i].trim();\r\n\t\t\tif (!this[name]) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.expectedProperty, [name]));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Add child control into this control.\r\n\t */\r\n\taddChildControl: function(childCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._childControls) {\r\n\t\t\tZ._childControls = [];\r\n\t\t}\r\n\t\tif(childCtrl) {\r\n\t\t\tZ._childControls.push(childCtrl);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh dataset when user changed the value.\r\n\t */\r\n\tdoUIChanged: function () {},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Remove all child controls from this control.\r\n\t */\r\n\tremoveAllChildControls: function() {\r\n\t\tvar Z = this, childCtrl;\r\n\t\tif(Z._childControls) {\r\n\t\t\tfor(var i = 0, len = Z._childControls.length; i < len; i++) {\r\n\t\t\t\tchildCtrl = Z._childControls[i];\r\n\t\t\t\tchildCtrl.destroy();\r\n\t\t\t}\r\n\t\t\tZ._childControls = null;\r\n\t\t}\r\n        if(Z.el) {\r\n            Z.el.innerHTML = '';\r\n        }\r\n\t},\r\n\t\r\n\t/**\r\n\t * Destroy method\r\n\t */\r\n\tdestroy: function(){\r\n\t\tif(this.el) {\r\n\t\t\tthis.el.jslet = null;\r\n\t\t\tthis.el = null;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Base data sensitive control.\r\n */\r\njslet.ui.DBControl = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_dataset: undefined,\r\n\r\n\t_isDBControl: true,\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Dataset which to link to control.\r\n\t * \r\n\t * @param {String | undefined} dataset Dataset name.\r\n\t * \r\n\t * @return {this | jslet.data.Dataset}\r\n\t */\r\n\tdataset: function(dataset) {\r\n\t\tif(dataset === undefined) {\r\n\t\t\treturn this._dataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(dataset)) {\r\n\t\t\tdataset = jslet.data.getDataset(jQuery.trim(dataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBControl.dataset', dataset).required().isClass(jslet.data.Dataset.className);\r\n\t\tthis._dataset = dataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tif(this._isDBControl && !this._dataset) {\r\n\t\t\tvar dsName = this.getDatasetInParentElement();\r\n\t\t\tthis.dataset(dsName);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t * \r\n\t * Call this method before binding parameters to a HTML element, you can rewrite this in your owner control.\r\n\t */\r\n\tbeforeBind: function ($super) {\r\n\t\t$super();\r\n\t\tif(this._isDBControl) {\r\n\t\t\tthis._dataset.addLinkedControl(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcheckRequiredProperty: function($super) {\r\n\t\tif(this._isDBControl) {\r\n\t\t\tjslet.Checker.test('DBControl.dataset', this._dataset).required();\r\n\t\t}\r\n\t\t$super();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh control when data changed.\r\n\t * There are three type changes: meta changed, data changed, lookup data changed.\r\n\t * \r\n\t * @param {jslet.data.RefreshEvent} evt jslet refresh event object.\r\n\t * \r\n\t * @return {Boolean} if refresh successfully, return true, otherwise false.\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this, evtType;\r\n\t\tif(evt) {\r\n\t\t\tevtType = evt.eventType;\r\n\t\t} else {\r\n\t\t\tevtType = jslet.data.RefreshEvent.UPDATEALL;\r\n\t\t}\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tvar metaName = evt.metaName;\r\n\t\t\tif(Z._field && Z._field == evt.fieldName) {\r\n\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t} else {\r\n\t\t\t\tif(!Z._field && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//Lookup data changed\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATELOOKUP && evt.fieldName == Z._field) {\r\n\t\t\tZ.doLookupChanged(evt.isMetaChanged);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t//Value changed\r\n\t\tif (evtType == jslet.data.RefreshEvent.SCROLL || \r\n\t\t\t\tevtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif((evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) && \r\n\t\t\tevt.fieldName === undefined || evt && evt.fieldName == Z._field){\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.doMetaChanged();\r\n\t\t\tZ.doLookupChanged();\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}, // end refreshControl\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field meta is changed.\r\n\t * \r\n\t * @param {String} metaName Field meta name, like: readOnly, disabled,...\r\n\t */\r\n\tdoMetaChanged: function(metaName){},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field value is changed.\r\n\t */\r\n\tdoValueChanged: function() {},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field lookup value is changed.\r\n\t */\r\n\tdoLookupChanged: function() {},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetDatasetInParentElement: function () {\r\n\t\tvar el = this.el, pEl = null;\r\n\t\twhile (true) {\r\n\t\t\tpEl = jslet.ui.getParentElement(el, 1);\r\n\t\t\tif (!pEl) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (pEl.jslet) {\r\n\t\t\t\treturn pEl.jslet.dataset;\r\n\t\t\t}\r\n\t\t\tel = pEl;\r\n\t\t} //end while\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function ($super) {\r\n\t\tthis.removeAllChildControls();\r\n\t\tif (this._isDBControl && this._dataset) {\r\n\t\t\tthis._dataset.removeLinkedControl(this);\r\n\t\t}\r\n\t\tthis._dataset = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n * \r\n * Base data sensitive field control. It's the base class for all form controls.\r\n */\r\njslet.ui.DBFieldControl = jslet.Class.create(jslet.ui.DBControl, {\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_field: undefined,\r\n\t\r\n\t_valueIndex: undefined,\r\n\t\r\n\t_enableInvalidTip: true,\r\n\t\r\n\t_tableId: null,\r\n\t\r\n\t_tabIndex: null,\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Field name which to link to control.\r\n\t * \r\n\t * @param {String | undefined} fldName Field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tfield: function(fldName) {\r\n\t\tif(fldName === undefined) {\r\n\t\t\treturn this._field;\r\n\t\t}\r\n\t\t\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\tjslet.Checker.test('DBControl.field', fldName).isString().required();\r\n\t\tvar k = fldName.lastIndexOf('#');\r\n\t\tif(k > 0) {\r\n\t\t\tthis._fieldMeta = fldName.substring(k+1);\r\n\t\t\tfldName = fldName.substring(0, k);\r\n\t\t}\r\n\t\t\r\n\t\tthis._field = fldName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfieldMeta: function() {\r\n\t\treturn this._fieldMeta;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Field value index which to link to control. \r\n\t * \r\n\t * @param {Integer | undefined} valueIndex Field value index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalueIndex: function(valueIndex) {\r\n\t\tif(valueIndex === undefined) {\r\n\t\t\treturn this._valueIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBControl.valueIndex', valueIndex).isNumber();\r\n\t\t\r\n\t\tthis._valueIndex = parseInt(valueIndex);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Tab index of control. \r\n\t * \r\n\t * @param {Integer | undefined} tabIndex Tab index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\ttabIndex: function(tabIndex) {\r\n\t\tif(tabIndex === undefined) {\r\n\t\t\treturn this._tabIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBControl.tabIndex', tabIndex).isNumber();\r\n\t\tthis._tabIndex = tabIndex;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tif(this._isDBControl) {\r\n\t\t\tvar value = ctrlParams.valueIndex;\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tthis.valueIndex(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar tbIdx = ctrlParams.tabIndex;\r\n\t\tif(tbIdx !== undefined) {\r\n\t\t\tthis.tabIndex(tbIdx);\r\n\t\t}\r\n\t\t\r\n\t},\r\n \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcheckRequiredProperty: function($super) {\r\n\t\t$super();\r\n\t\tif(this._isDBControl) {\r\n\t\t\tjslet.Checker.test('DBControl.field', this._field).required();\r\n\t\t\tthis.existField(this._field);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tif(!metaName || metaName == 'tip') {\r\n\t\t\tvar fldObj = this._dataset.getField(this._field);\r\n\t\t\tif(!fldObj) {\r\n\t\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t\t}\r\n\t\t\tvar tip = fldObj.tip();\r\n\t\t\ttip = tip ? tip: '';\r\n\t\t\tthis.el.title = tip;\r\n\t\t}\r\n\t},\r\n\t\r\n\tsetTabIndex: function() {\r\n\t\tvar Z = this,\r\n\t\t\ttabIdx = Z._tabIndex;\r\n\t\tif(Z._isDBControl) {\r\n\t\t\tif(tabIdx !== 0 && !tabIdx) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tif(fldObj) {\r\n\t\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(tabIdx === 0 || tabIdx) {\r\n\t\t\tZ.el.tabIndex = tabIdx;\r\n\t\t}\r\n\t},\r\n\t\r\n\texistField: function(fldName) {\r\n\t\tvar fldObj = this._dataset.getField(fldName);\r\n\t\treturn fldObj ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * The table id when this control is embed into a DBTable control. This property is used internally, don't call it directly.\r\n\t */\r\n\ttableId: function(tableId) {\r\n\t\tif(tableId === undefined) {\r\n\t\t\treturn this._tableId;\r\n\t\t}\r\n\t\tthis._tableId = tableId;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field value.\r\n\t * \r\n\t * @return {Object} Field value.\r\n\t */\r\n\tgetValue: function() {\r\n\t\treturn this._dataset.getFieldValue(this._field, this._valueIndex); \r\n\t},\r\n\t\r\n\t/**\r\n\t * Get display text of field.\r\n\t * \r\n\t * @param {Boolean} isEditing True - get editing text, false - get display text.\r\n\t * \r\n\t * @return {String}\r\n\t */\r\n\tgetText: function(isEditing) {\r\n\t\treturn this._dataset.getFieldText(this._field, isEditing, this._valueIndex); \r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field error.\r\n\t * \r\n\t * @return {Object} Error Object, like {message: 'Not Exists!', inputText: 'Foo'}\r\n\t */\r\n\tgetFieldError: function() {\r\n\t\treturn this._dataset.getFieldError(this._field, this._valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Render invalid message and change the control to \"invalid\" style.\r\n\t * \r\n\t *  @param {String} errObj error object: {code: xxx, message}, if it's null, clear the 'invalid' style. \r\n\t */\r\n\trenderInvalid: function (errObj) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._field) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (errObj){\r\n\t\t\tjQuery(Z.el).parent().addClass('has-error');\r\n\t\t\tZ.el.title = errObj.message || '';\r\n\t\t} else {\r\n\t\t\tjQuery(Z.el).parent().removeClass('has-error');\r\n\t\t\tZ.el.title = '';\r\n\t\t}\r\n\t},\r\n \r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Identify this control can be focused or not.  \r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Focus to this control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tfocus: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.canFocus()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._isDBControl) {\r\n\t\t\tvar\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tflag = !fldObj || fldObj.disabled() || fldObj.readOnly() || !fldObj.visible();\r\n\t\t\tif(flag) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._tableId) {\r\n\t\t\t\tjslet('#' + Z._tableId).gotoField(Z._field);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.innerFocus();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar Z = this,\r\n\t\t\tel = Z.el;\r\n\t\tif (el.focus) {\r\n\t\t\ttry {\r\n\t\t\t\tel.focus();\r\n\t\t\t\tif(Z.selectText && Z.autoSelectAll && Z.autoSelectAll()) {\r\n\t\t\t\t\tZ.selectText();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} catch (e) {\r\n\t\t\t\t//Can\\'t focus on this control, maybe it\\'s disabled!\r\n\t\t\t\tconsole.warn(jsletlocale.Dataset.cannotFocusControl);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function ($super) {\r\n\t\t$super();\r\n\t\tthis._field = null;\r\n\t}\r\n\t\r\n});\r\n\r\n/*\r\n * Convert string parameters to object\r\n * \r\n * @param {String | Object} ctrlParams Control parameters.\r\n * @return {Object}\r\n */\r\njslet.ui._evalParams = function (ctrlParams) {\r\n\tjslet.Checker.test('evalParams#ctrlParams', ctrlParams).required();\r\n\tif (jslet.isString(ctrlParams)) {\r\n\t\tvar p = jQuery.trim(ctrlParams);\r\n\t\tif (!p.startsWith('{') && p.indexOf(':')>0) {\r\n\t\t\tp = '{' + p +'}';\r\n\t\t}\r\n\t\ttry {\r\n\t\t\t/* jshint ignore:start */\r\n\t\t\tctrlParams = new Function('return ' + unescape(p))();\r\n\t\t\t/* jshint ignore:end */\r\n\t\t\tif(ctrlParams['var']) {\r\n\t\t\t\tctrlParams = ctrlParams['var'];\r\n\t\t\t}\r\n\t\t\treturn ctrlParams;\r\n\t\t} catch (e) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.invalidJsletProp, [ctrlParams]));\r\n\t\t}\r\n\t}\r\n\treturn ctrlParams;\r\n};\r\n\r\n/*\r\n * Hold all jslet control's configurations.\r\n */\r\njslet.ui.controls = {};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Register jslet control class. This method is used to create a new Jslet control. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.register('DBTable', jslet.ui.DBTable);\r\n * \r\n * @param {String} ctrlName Control name.\r\n * @param {jslet.ui.Control} ctrlType Control Class.\r\n */\r\njslet.ui.register = function (ctrlName, ctrlType) {\r\n\tjslet.Checker.test('jslet.ui.register#ctrlName', ctrlName).required().isString();\r\n\tjslet.Checker.test('jslet.ui.register#ctrlType', ctrlType).required();\r\n\tjslet.ui.controls[ctrlName.toLowerCase()] = ctrlType;\r\n};\r\n\r\n/**\r\n * Create jslet control according to control configuration, and add it to parent element. Example:\r\n * \r\n *     @example\r\n *     var pElement = document.getElementById('div1');\r\n *     jslet.ui.createControl({type:'DBTable', dataset: 'employee'}, pElement, 300, 500); \r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String | Object} jsletparam Jslet Parameter.\r\n * @param {HtmlElement} parent Parent html element which created control will be added to.\r\n * @param {Integer} width (Optional)Control width, unit: px.\r\n * @param {Integer} height (Optional)Control height, Unit: px. \r\n * @param {Boolean} hidden (Optional)Hide control or not.\r\n *  \r\n * @return {jslet.ui.Control}\r\n */\r\njslet.ui.createControl = function (jsletparam, parent, width, height, hidden) {\r\n\tjslet.Checker.test('jslet.ui.createControl#jsletparam', jsletparam).required();\r\n\tvar isAuto = false, \r\n\t\tpnode = parent,\r\n\t\tcontainer = document.createElement('div'),\r\n\t\tctrlParam = jslet.ui._evalParams(jsletparam),\r\n\t\tcontrolType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tcontrolType = jslet.ui.controls.DBTEXT;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls[controlType.toLowerCase()];\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\tcontainer.innerHTML = ctrlClass.htmlTemplate;\r\n\r\n\tvar el = container.firstChild;\r\n\tcontainer.removeChild(el);\r\n\tif(hidden) {\r\n\t\tel.style.display = 'none';\r\n\t}\t\r\n\tif (parent) {\r\n\t\tparent.appendChild(el);\r\n\t} else {\r\n\t\tdocument.body.appendChild(el);\r\n\t}\r\n\tif (width) {\r\n\t\tif (parseInt(width) == width)\r\n\t\t\twidth = width + 'px';\r\n\t\tel.style.width = width;\r\n\t}\r\n\tif (height) {\r\n\t\tif (parseInt(height) == height)\r\n\t\t\theight = height + 'px';\r\n\t\tel.style.height = height;\r\n\t}\r\n\r\n\treturn new ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Get jslet class with class name.\r\n * \r\n * @param {String} name Class name.\r\n * \r\n * @return {jslet.ui.Control}\r\n */\r\njslet.ui.getControlClass = function (name) {\r\n\tjslet.Checker.test('jslet.ui.getControlClass#name', name).required().isString();\r\n\treturn jslet.ui.controls[name.toLowerCase()];\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Bind jslet control to an existing html element. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.bindControl(tblDiv, {type:'DBTable', dataset: 'employee'}); \r\n * \r\n * @param {HtmlElement} el HTML element.\r\n * @param {String | Object} jsletParam Control parameters.\r\n */\r\njslet.ui.bindControl = function (el, jsletParam, isInstalling) {\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.bindControl#el', el).required().isHTMLElement();\r\n\t}\r\n\tif (!jsletParam)\r\n\t\tjsletParam = jQuery(el).attr('data-jslet');\r\n\tif(el.jslet) {\r\n\t\tconsole.warn('Control has installed! Don\\'t install it again!');\r\n\t\treturn null;\r\n\t}\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.bindControl#jsletParam', jsletParam).required();\r\n\t}\r\n\tvar ctrlParam = jslet.ui._evalParams(jsletParam);\r\n\tvar controlType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tel.jslet = ctrlParam;\r\n\t\treturn null;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls[controlType.toLowerCase()];\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\treturn new ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Unbind jslet control and clear jslet property. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.unbindControl(tblDiv); \r\n * \r\n * @param {HtmlElement} el HTML element.\r\n */\r\njslet.ui.unbindControl = function(el, isInstalling) {\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.unbindControl#el', el).required().isHTMLElement();\r\n\t}\r\n\tif (el.jslet && el.jslet.destroy) {\r\n\t\tel.jslet.destroy();\r\n\t}\r\n\tel.jslet = null;\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Re-bind jslet control. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.rebindControl(tblDiv); \r\n * \r\n * @param {HtmlElement} el HTML element which binded a Jslet control.\r\n */\r\njslet.ui.rebindControl = function(el) {\r\n\tjslet.Checker.test('jslet.ui.rebindControl#el', el).required().isHTMLElement();\r\n\tjslet.ui.unbindControl(el);\r\n\tjslet.ui.bindControl(el);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Scan the specified HTML element children and bind jslet control to these HTML element with 'data-jslet' attribute. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.install(); //Install jslet on document.body\r\n *     \r\n *     var dialogDiv = document.getElementById('dlgId');\r\n *     jslet.ui.install(dialogDiv); //Install jslet on a dialog.\r\n * \r\n * @param {HtmlElement} pElement (Optional)Parent HTML element which need to be scan, if null, document.body is used.\r\n * @param {Function} onJsletReady (Optional)Call back function after jslet installed.\r\n */\r\njslet.ui.install = function (pElement, onJsletReady) {\r\n\tif(pElement && (onJsletReady === undefined)) {\r\n\t\t//Match case: jslet.ui.install(onJsletReady);\r\n\t\tif(jQuery.isFunction(pElement)) {\r\n\t\t\tonJsletReady = pElement;\r\n\t\t\tpElement = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(!pElement && jsletlocale.isRtl){\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tif(!jqBody.hasClass('jl-rtl')) {\r\n\t\t\tjqBody.addClass('jl-rtl');\r\n\t\t}\r\n\t}\r\n\tvar htmlTags;\r\n\tif (!pElement){\r\n\t\tpElement = document.body;\r\n\t} else {\r\n\t\tjslet.Checker.test('jslet.ui.install#pElement', pElement).isHTMLElement();\t\t\r\n\t}\r\n\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\r\n\tvar cnt = htmlTags.length, el, id, \r\n\t\texistIds = jslet.existIds;\r\n\tif(!existIds) {\r\n\t\texistIds = {};\r\n\t\tjslet.existIds = existIds;\r\n\t}\r\n\tfor (var i = 0; i < cnt; i++) {\r\n\t\tel = htmlTags[i];\r\n\t\tid = el.id;\r\n\t\tif(id) {\r\n\t\t\tif(existIds[id]) {\r\n\t\t\t\tconsole.warn(jslet.formatMessage(jsletlocale.Control.duplicatedId, [id]));\r\n\t\t\t} else {\r\n\t\t\t\texistIds[id] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.bindControl(el, undefined, true);\r\n\t}\r\n\tif(onJsletReady){\r\n\t\tonJsletReady();\r\n\t\t//jslet.ui.onReady();\r\n\t}\r\n\tif(jslet.global.afterInstall) {\r\n\t\tjslet.global.afterInstall(pElement);\r\n\t}\r\n};\r\n\r\n///**\r\n// * {Event} Fired after jslet has installed all controls.\r\n// * Pattern: function(){};\r\n// */\r\n//jslet.ui.onReady = null;\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Scan the specified HTML element children and unbind jslet control to these HTML element with 'data-jslet' attribute.\r\n * \r\n * @param {HtmlElement} pElement (Optional)Parent HTML element which need to be scan, if null, document.body is used.\r\n */\r\njslet.ui.uninstall = function (pElement) {\r\n\tvar htmlTags;\r\n\tif (!pElement) {\r\n\t\thtmlTags = jQuery('*[data-jslet]');\r\n\t} else {\r\n\t\tjslet.Checker.test('jslet.ui.install#pElement', pElement).isHTMLElement();\t\t\r\n\t\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\t}\r\n\tvar el;\r\n\tfor(var i =0, cnt = htmlTags.length; i < cnt; i++){\r\n\t\tel = htmlTags[i];\r\n\t\tif (el.jslet && el.jslet.destroy) {\r\n\t\t\tel.jslet.destroy();\r\n\t\t}\r\n\t\tel.jslet = null;\r\n\t}\r\n\tif(jslet.ui.menuManager) {\r\n\t\tjQuery(document).off('mousedown', jslet.ui.menuManager.hideAll);\r\n\t}\r\n//\tjslet.ui.onReady = null;\r\n};\r\n\n/**\r\n * @private\r\n * @class\r\n * \r\n* Drag & Drop. A common framework to implement drag & drop. Example:\r\n* \r\n*     @example\r\n*     //Define a delegate class\r\n*     dndDelegate = {}\r\n*     dndDelegate._doDragStart = function(){}\r\n*     dndDelegate._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*     dndDelegate._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*     dndDelegate._doDragCancel = function () {}\r\n* \r\n*     //Initialize jslet.ui.DnD\r\n*     //var dnd = new jslet.ui.DnD();\r\n*     //Or use global jslet.ui.DnD instance to bind 'dndDelegate'\r\n*     jslet.ui.dnd.bindControl(dndDelegate);\r\n*\t\r\n*     //After end dragging, you need unbind it\r\n*     jslet.ui.dnd.unbindControl();\r\n* \r\n*/\r\njslet.ui.DnD = function () {\r\n\tvar oldX, oldY, x, y, deltaX, deltaY,\r\n\t\tdragDelta = 2, \r\n\t\tdragged = false, \r\n\t\tbindedControl, \r\n\t\tmouseDowned = true,\r\n\t\tself = this;\r\n\r\n\tthis._docMouseDown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tmouseDowned = true;\r\n\t\tdeltaX = 0;\r\n\t\tdeltaY = 0;\r\n\t\toldX = event.pageX;\r\n\t\toldY = event.pageY;\r\n\t\tdragged = false;\r\n\r\n\t\tif (bindedControl && bindedControl._doMouseDown) {\r\n\t\t\tbindedControl._doMouseDown(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseMove = function (event) {\r\n\t\tif (!mouseDowned) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tx = event.pageX;\r\n\t\ty = event.pageY;\r\n\t\tif (!dragged) {\r\n\t\t\tif (Math.abs(deltaX) > dragDelta || Math.abs(deltaY) > dragDelta) {\r\n\t\t\t\tdragged = true;\r\n\t\t\t\toldX = x;\r\n\t\t\t\toldY = y;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragStart) {\r\n\t\t\t\t\tbindedControl._doDragStart(oldX, oldY);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdeltaX = x - oldX;\r\n\t\tdeltaY = y - oldY;\r\n\t\tif (dragged) {\r\n\t\t\tif (bindedControl && bindedControl._doDragging) {\r\n\t\t\t\tbindedControl._doDragging(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseMove) {\r\n\t\t\t\tbindedControl._doMouseMove(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t\toldX = x;\r\n\t\t\toldY = y;\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseUp = function (event) {\r\n\t\tmouseDowned = false;\r\n\t\tif (dragged) {\r\n\t\t\tdragged = false;\r\n\t\t\tif (bindedControl && bindedControl._doDragEnd) {\r\n\t\t\t\tbindedControl._doDragEnd(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseUp) {\r\n\t\t\t\tbindedControl._doMouseUp(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t}\r\n\t\tself.unbindControl();\r\n\t};\r\n\r\n\tthis._docKeydown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tif (event.which == 27) {//Esc key\r\n\t\t\tif (dragged) {\r\n\t\t\t\tdragged = false;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragCancel) {\r\n\t\t\t\t\tbindedControl._doDragCancel();\r\n\t\t\t\t\tself.unbindControl();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docSelectStart = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tevent.preventDefault();\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\t/**\r\n\t * Bind control.\r\n\t * \r\n\t * @param {Object} ctrl The control need drag & drop, there are four method in it: <br />\r\n\t *  ctrl._doDragStart = function(){} <br />\r\n\t *  ctrl._doDragging = function(oldX, oldY, x, y, deltaX, deltaY){} <br />\r\n\t *  ctrl._doDragEnd = function(oldX, oldY, x, y, deltaX, deltaY){} <br />\r\n\t *  ctrl._doDragCancel = function(){} <br />\r\n\t *  ctrl_doDragStart = function{}\r\n\t */\r\n\tthis.bindControl = function (ctrl) {\r\n\t\tbindedControl = ctrl;\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.on('mousedown', this._docMouseDown);\r\n\t\tdoc.on('mouseup', this._docMouseUp);\r\n\t\tdoc.on('mousemove', this._docMouseMove);\r\n\t\tdoc.on('selectstart', this._docSelectStart);\r\n\t\tdoc.on('keydown', this._docKeydown);\r\n\t};\r\n\r\n\t/**\r\n\t * Unbind the current control\r\n\t */\r\n\tthis.unbindControl = function () {\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.off('mousedown', this._docMouseDown);\r\n\t\tdoc.off('mouseup', this._docMouseUp);\r\n\t\tdoc.off('mousemove', this._docMouseMove);\r\n\t\tdoc.off('selectstart', this._docSelectStart);\r\n\t\tdoc.off('keydown', this._docKeydown);\r\n\t\t\r\n\t\tbindedControl = null;\r\n\t};\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Global Drag & drop object.\r\n * \r\n * @member jslet.ui\r\n */\r\njslet.ui.dnd = new jslet.ui.DnD();\r\n\r\n\n/**\r\n * @class\r\n * \r\n * EditMask.\r\n * \r\n * Create edit mask class and attach to a HTML text element. Example:\r\n * \r\n *     @example\r\n *     var htmlText = jQuery('#textId')[0];\r\n *     var mask = new jslet.ui.EditMask();\r\n *     mask.attach(htmlText);\r\n *     mask.setMask('L00-000');\r\n * \r\n */\r\njslet.ui.EditMask = function () {\r\n\tthis._mask = null;\r\n\tthis._keepChar = true;\r\n\tthis._transform = null;\r\n\r\n\tthis._literalChars = null;\r\n\tthis._parsedMask = null;\r\n\tthis._format = null;\r\n\tthis._target = null;\r\n\tthis._buffer = null;\r\n};\r\n\r\njslet.ui.EditMask.prototype = {\r\n\tmaskChars: {\r\n\t\t'#': { regexpr: new RegExp('[0-9\\\\-]'), required: false }, \r\n\t\t'0': { regexpr: new RegExp('[0-9]'), required: true },\r\n\t\t'9': { regexpr: new RegExp('[0-9]'), required: false },\r\n\t\t'L': { regexpr: new RegExp('[A-Za-z]'), required: true },\r\n\t\t'l': { regexpr: new RegExp('[A-Za-z]'), required: false },\r\n\t\t'A': { regexpr: new RegExp('[0-9a-zA-Z]'), required: true },\r\n\t\t'a': { regexpr: new RegExp('[0-9a-zA-Z]'), required: false },\r\n\t\t'C': { regexpr: null, required: true },\r\n\t\t'c': { regexpr: null, required: false }\r\n\t},\r\n\t\r\n\ttransforms: ['upper','lower'],\r\n\r\n\t/**\r\n\t * Set edit mask. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var htmlText = jQuery('#textId')[0];\r\n\t *     var mask = new jslet.ui.EditMask();\r\n\t *     mask.attach(htmlText);\r\n\t *     mask.setMask('L00-000');\r\n\t * \r\n\t * @param {String} mask Mask string, rule: <br />\r\n\t *  '#': char set: 0-9 and -, not required. <br />\r\n\t *  '0': char set: 0-9, required. <br />\r\n\t *  '9': char set: 0-9, not required. <br />\r\n\t *  'L': char set: A-Z,a-z, required. <br />\r\n\t *  'l': char set: A-Z,a-z, not required. <br />\r\n\t *  'A': char set: 0-9,a-z,A-Z, required. <br />\r\n\t *  'a': char set: 0-9,a-z,A-Z, not required. <br />\r\n\t *  'C': char set: any char, required. <br />\r\n\t *  'c': char set: any char, not required.\r\n\t *\r\n\t * @param {Boolean} keepChar Keep the literal character or not.\r\n\t * @param {String} transform Transform character into UpperCase or LowerCase, optional value: 'upper', 'lower' or null.\r\n\t */\r\n\tsetMask: function(mask, keepChar, transform){\r\n\t\tmask = jQuery.trim(mask);\r\n\t\tjslet.Checker.test('EditMask#mask', mask).isString();\r\n\t\tthis._mask = mask;\r\n\t\tthis._keepChar = keepChar ? true: false;\r\n\t\t\r\n\t\tthis._transform = null;\r\n\t\tif(transform){\r\n\t\t\tvar checker = jslet.Checker.test('EditMask#transform', transform).isString();\r\n\t\t\ttransform = jQuery.trim(transform);\r\n\t\t\ttransform = transform.toLowerCase();\r\n\t\t\tchecker.inArray(this.transforms);\r\n\t\t\tthis._transform = transform;\r\n\t\t}\r\n\t\tthis._parseMask();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Attach edit mask to a HTML text element.\r\n\t * \r\n\t * @param {HtmlElement} target HTML text element.\r\n\t */\r\n\tattach: function (target) {\r\n\t\tjslet.Checker.test('EditMask.attach#target', target).required();\r\n\t\tvar Z = this, jqText = jQuery(target);\r\n\t\tZ._target = target;\r\n\t\tjqText.on('keypress.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar c = event.which;\r\n\t\t\tif (c === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeypress(c)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqText.on('keydown.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('blur.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doBur()) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.currentTarget.focus();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('cut.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tZ._doCut(event.originalEvent.clipboardData || window.clipboardData);\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqText.on('paste.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doPaste(event.originalEvent.clipboardData || window.clipboardData)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Detach edit mask from a HTML text element\r\n\t */\r\n\tdetach: function(){\r\n\t\tvar jqText = jQuery(this._target);\r\n\t\tjqText.off('keypress.editmask');\r\n\t\tjqText.off('keydown.editmask');\r\n\t\tjqText.off('blur.editmask');\r\n\t\tjqText.off('cut.editmask');\r\n\t\tjqText.off('paste.editmask');\r\n\t\tthis._target = null; \r\n\t},\r\n\t\r\n\t/**\r\n\t * Set value to text box.\r\n\t * \r\n\t * @param {String} value New value.\r\n\t */\r\n\tsetValue: function (value) {\r\n\t\tjslet.Checker.test('EditMask.setValue#value', value).isString();\r\n\t\tvalue = jQuery.trim(value);\r\n\t\tvalue = value ? value : '';\r\n\t\tif(!this._mask) {\r\n\t\t\tthis._target.value = value;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tZ._clearBuffer(0);\r\n\t\tvar prePos = 0, pos, preValuePos = 0, k, i, \r\n\t\t\tch, vch, valuePos = 0, fixedChar, \r\n\t\t\tmaskLen = Z._parsedMask.length;\r\n\t\twhile (true) {\r\n\t\t\tfixedChar = Z._getFixedCharAndPos(prePos);\r\n\t\t\tpos = fixedChar.pos;\r\n\t\t\tch = fixedChar.ch;\r\n\t\t\tif (pos < 0) {\r\n\t\t\t\tpos = prePos;\r\n\t\t\t}\r\n\t\t\tif (ch) {\r\n\t\t\t\tvaluePos = value.indexOf(ch, preValuePos);\r\n\t\t\t\tif (valuePos < 0) {\r\n\t\t\t\t\tvaluePos = value.length;\r\n\t\t\t\t}\r\n\t\t\t\tk = -1;\r\n\t\t\t\tfor (i = valuePos - 1; i >= preValuePos; i--) {\r\n\t\t\t\t\tvch = value.charAt(i);\r\n\t\t\t\t\tZ._buffer[k + pos] = vch;\r\n\t\t\t\t\tk--;\r\n\t\t\t\t}\r\n\t\t\t\tpreValuePos = valuePos + 1;\r\n\t\t\t} else {\r\n\t\t\t\tk = 0;\r\n\t\t\t\tvar c, cnt = Z._buffer.length;\r\n\t\t\t\tfor (i = prePos; i < cnt; i++) {\r\n\t\t\t\t\tc = value.charAt(preValuePos + k);\r\n\t\t\t\t\tif (!c) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._buffer[i] = c;\r\n\t\t\t\t\tk++;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tprePos = pos + 1;\r\n\t\t}\r\n\t\tZ._showValue();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get unmasked value.\r\n\t * \r\n\t * @return {String} Unmasked value.\r\n\t */\r\n\tgetValue: function(){\r\n\t\tvar value = this._target.value;\r\n\t\tif(this._keepChar) {\r\n\t\t\treturn value;\r\n\t\t} else {\r\n\t\t\tvar result = [], maskObj;\r\n\t\t\tfor(var i = 0, cnt = value.length; i< cnt; i++){\r\n\t\t\t\tmaskObj = this._parsedMask[i];\r\n\t\t\t\tif(maskObj.isMask) {\r\n\t\t\t\t\tresult.push(value.charAt(i));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the value is valid or not.\r\n\t * \r\n\t * @return {Boolean} True - the value is valid, false - otherwise.\r\n\t */\r\n\tvalidateValue: function(){\r\n\t\tvar Z = this, len = Z._parsedMask.length, cfg;\r\n\t\tfor(var i = 0; i< len; i++){\r\n\t\t\tcfg = Z._parsedMask[i];\r\n\t\t\tif(cfg.isMask && Z.maskChars[cfg.ch].required){\r\n\t\t\t\tif(Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_getFixedCharAndPos: function (begin) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._literalChars || Z._literalChars.length === 0) {\r\n\t\t\treturn { pos: 0, ch: null };\r\n\t\t}\r\n\t\tif (!begin) {\r\n\t\t\tbegin = 0;\r\n\t\t}\r\n\t\tvar ch, mask;\r\n\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tch = mask.ch;\r\n\t\t\tif (Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\t\treturn { ch: ch, pos: i };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { pos: -1, ch: null };\r\n\t},\r\n\r\n\t_parseMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._mask) {\r\n\t\t\tZ._parsedMask = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._parsedMask = [];\r\n\t\t\r\n\t\tZ._format = [];\r\n\t\tvar c, prevChar = null, isMask;\r\n\r\n\t\tfor (var i = 0, cnt = Z._mask.length; i < cnt; i++) {\r\n\t\t\tc = Z._mask.charAt(i);\r\n\t\t\tif (c == '\\\\') {\r\n\t\t\t\tprevChar = c;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tisMask = false;\r\n\t\t\tif (Z.maskChars[c] === undefined) {\r\n\t\t\t\tif (prevChar) {\r\n\t\t\t\t\tZ._parsedMask.push({ ch: prevChar, isMask: isMask });\r\n\t\t\t\t}\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t} else {\r\n\t\t\t\tisMask = prevChar ? false : true;\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t}\r\n\t\t\tif(Z._keepChar && !isMask){\r\n\t\t\t\tif(!Z._literalChars) {\r\n\t\t\t\t\tZ._literalChars = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar notFound = true;\r\n\t\t\t\tfor(var k = 0, iteralCnt = Z._literalChars.length; k < iteralCnt; k++){\r\n\t\t\t\t\tif(Z._literalChars[k] == c){\r\n\t\t\t\t\t\tnotFound = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(notFound) {\r\n\t\t\t\t\tZ._literalChars.push(c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevChar = null;\r\n\t\t\tZ._format.push(isMask ? '_' : c);\r\n\t\t} //end for\r\n\r\n\t\tZ._buffer = Z._format.slice(0);\r\n\t\tif(Z._target) {\r\n\t\t\tZ._target.value = Z._format.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_validateChar: function (maskChar, inputChar) {\r\n\t\tvar maskCfg = this.maskChars[maskChar];\r\n\t\tvar regExpr = maskCfg.regexpr;\r\n\t\tif (regExpr) {\r\n\t\t\treturn regExpr.test(inputChar);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t_getValidPos: function (pos, toLeft) {\r\n\t\tvar Z = this, \r\n\t\t\tcnt = Z._parsedMask.length, i;\r\n\t\tif (pos >= cnt) {\r\n\t\t\treturn cnt - 1;\r\n\t\t}\r\n\t\tif (!toLeft) {\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\t_clearBuffer: function (begin, end) {\r\n\t\tif(!this._buffer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!end) {\r\n\t\t\tend = this._buffer.length - 1;\r\n\t\t}\r\n\t\tfor (var i = begin; i <= end; i++) {\r\n\t\t\tthis._buffer[i] = this._format[i];\r\n\t\t}\r\n\t},\r\n\r\n\t_packEmpty: function (begin, end) {\r\n\t\tvar c, k = 0, Z = this, i;\r\n\t\tfor (i = begin; i >= 0; i--) {\r\n\t\t\tc = Z._format[i];\r\n\t\t\tif (Z._literalChars && Z._literalChars.indexOf(c) >= 0) {\r\n\t\t\t\tk = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbegin = k;\r\n\t\tvar str = [];\r\n\t\tfor (i = begin; i < end; i++) {\r\n\t\t\tc = Z._buffer[i];\r\n\t\t\tif (c != Z._format[i]) {\r\n\t\t\t\tstr.push(c);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar len = str.length - 1;\r\n\r\n\t\tfor (i = end - 1; i >= begin; i--) {\r\n\t\t\tif (len >= 0) {\r\n\t\t\t\tZ._buffer[i] = str[len];\r\n\t\t\t\tlen--;\r\n\t\t\t} else {\r\n\t\t\t\tZ._buffer[i] = Z._format[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_updateBuffer: function (pos, ch) {\r\n\t\tvar begin = pos.begin, end = pos.end, Z = this;\r\n\r\n\t\tbegin = Z._getValidPos(begin);\r\n\t\tif (begin < 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tZ._clearBuffer(begin + 1, end);\r\n\t\tif (Z._literalChars && Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].ch == ch) {\r\n\t\t\t\t\tZ._packEmpty(begin, i);\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar maskObj = Z._parsedMask[begin];\r\n\t\t\tif (Z._validateChar(maskObj.ch, ch)) {\r\n\t\t\t\tZ._buffer[begin] = ch;\r\n\t\t\t\treturn begin;\r\n\t\t\t} else\t{\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_moveCursor: function (begin, toLeft) {\r\n\t\tbegin = this._getValidPos(begin, toLeft);\r\n\t\tif (begin >= 0) {\r\n\t\t\tjslet.ui.TextUtil.setCursorPos(this._target, begin);\r\n\t\t}\r\n\t},\r\n\r\n\t_showValue: function () {\r\n\t\tthis._target.value = this._buffer.join('');\r\n\t},\r\n\r\n\t_doKeypress: function (chCode) {\r\n\t\tif (chCode == 13) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar ch = String.fromCharCode(chCode), Z = this;\r\n\t\tif (Z._transform == 'upper') {\r\n\t\t\tch = ch.toUpperCase();\r\n\t\t} else {\r\n\t\t\tif (Z._transform == 'lower') {\r\n\t\t\t\tch = ch.toLowerCase();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pos = jslet.ui.TextUtil.getCursorPos(Z._target);\r\n\t\tvar begin = Z._updateBuffer(pos, ch);\r\n\t\tZ._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tZ._moveCursor(begin + 1);\r\n\t\t} else {\r\n\t\t\tZ._moveCursor(pos.begin);\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doKeydown: function (chCode) {\r\n\t\tvar Z = this,\r\n\t\t\tpos = jslet.ui.TextUtil.getCursorPos(Z._target),\r\n\t\t\tbegin = pos.begin,\r\n\t\t\tend = pos.end;\r\n\r\n\t\tif (chCode == 229) {//IME showing\r\n\t\t\tvar flag = (Z._parsedMask.legnth > begin);\r\n\t\t\tif (flag) {\r\n\t\t\t\tvar msk = Z._parsedMask[begin];\r\n\t\t\t\tflag = msk.isMask;\r\n\t\t\t\tif (flag) {\r\n\t\t\t\t\tvar c = msk.ch;\r\n\t\t\t\t\tflag = (c == 'c' || c == 'C');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!flag) {\r\n\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\tZ._showValue();\r\n\t\t\t\t\tZ._moveCursor(begin);\r\n\t\t\t\t}, 50);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (chCode == 13) //enter\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (chCode == 8) //backspace\r\n\t\t{\r\n\t\t\tif (begin == end) {\r\n\t\t\t\tbegin = Z._getValidPos(--begin, true);\r\n\t\t\t\tend = begin;\r\n\t\t\t}\r\n\t\t\tZ._clearBuffer(begin, end);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin, true);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 27) // Allow to send 'ESC' command\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 39) // Move Left\r\n\t\t{\r\n\t\t}\r\n\r\n\t\tif (chCode == 46) // delete the selected text\r\n\t\t{\r\n\t\t\tZ._clearBuffer(begin, end - 1);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doBur: function () {\r\n\t\tvar mask, c, Z = this;\r\n\t\tfor (var i = 0, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (!mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tc = mask.ch;\r\n\t\t\tif (Z.maskChars[c].required) {\r\n\t\t\t\tif (Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\t//jslet.ui.TextUtil.setCursorPos(Z._target, i);\r\n\t\t\t\t\t//return false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doCut: function (clipboardData) {\r\n\t\tvar Z = this,\r\n\t\t\tdata = jslet.ui.TextUtil.getSelectedText(Z._target),\r\n\t\t\trange = jslet.ui.TextUtil.getCursorPos(Z._target),\r\n\t\t\tbegin = range.begin;\r\n\t\tZ._clearBuffer(begin, range.end - 1);\r\n\t\tZ._showValue();\r\n\t\tZ._moveCursor(begin, true);\r\n\t\tclipboardData.setData('Text', data);\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doPaste: function (clipboardData) {\r\n\t\tvar pasteValue = clipboardData.getData('Text');\r\n\t\tif (!pasteValue) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar pos = jslet.ui.TextUtil.getCursorPos(this._target), begin = 0, ch;\r\n\t\tpos.end = pos.begin;\r\n\t\tfor (var i = 0; i < pasteValue.length; i++) {\r\n\t\t\tch = pasteValue.charAt(i);\r\n\t\t\tbegin = this._updateBuffer(pos, ch);\r\n\t\t\tpos.begin = i;\r\n\t\t\tpos.end = pos.begin;\r\n\t\t}\r\n\t\tthis._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tthis._moveCursor(begin + 1);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n/**\r\n * @class\r\n * @static\r\n * \r\n * Util of \"Text\" control.\r\n */\r\njslet.ui.TextUtil = {\r\n\t/**\r\n\t * Select text from an Input(Text) element.\r\n\t * \r\n\t * @param {HtmlElement} txtEl The HTML text element .  \r\n\t * @param {Integer} start Start position.\r\n\t * @param {Integer} end End position.\r\n\t */\r\n\tselectText: function(txtEl, start, end){\r\n\t\tvar v = txtEl.value;\r\n\t\tif (v.length > 0) {\r\n\t\t\tstart = start === undefined ? 0 : start;\r\n\t\t\tend = end === undefined ? v.length : end;\r\n \r\n\t\t\tif (txtEl.setSelectionRange) {\r\n\t\t\t\ttxtEl.setSelectionRange(start, end);\r\n\t\t\t} else if (txtEl.createTextRange) {\r\n\t\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\t\trange.moveStart('character', start);\r\n\t\t\t\trange.moveEnd('character', end - v.length);\r\n\t\t\t\trange.select();\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get selected text.\r\n\t * \r\n\t * @param {HtmlElement} textEl HTML Text Element.\r\n\t * \r\n\t * @return {String}  \r\n\t */\r\n\tgetSelectedText: function (txtEl) {\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tvar begin = txtEl.selectionStart;\r\n\t\t\tvar end = txtEl.selectionEnd;\r\n\t\t\treturn txtEl.value.substring(begin, end);\r\n\t\t}\r\n\t\tif (document.selection && document.selection.createRange) {\r\n\t\t\treturn document.selection.createRange().text;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get cursor postion of a HTML text element.\r\n\t * \r\n\t * @param {HtmlElement} txtEl HTML Text Element.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tgetCursorPos: function(txtEl){\r\n\t\tvar result = { begin: 0, end: 0 };\r\n\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tresult.begin = txtEl.selectionStart;\r\n\t\t\tresult.end = txtEl.selectionEnd;\r\n\t\t}\r\n\t\telse if (document.selection && document.selection.createRange) {\r\n\t\t\tvar range = document.selection.createRange();\r\n\t\t\tresult.begin = 0 - range.duplicate().moveStart('character', -100000);\r\n\t\t\tresult.end = result.begin + range.text.length;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set cursor postion of html text element\r\n\t * \r\n\t * @param {HtmlElement} txtEl Html Text Element\r\n\t * @param {Integer} pos Cusor position\r\n\t */\r\n\tsetCursorPos: function(txtEl, pos){\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\ttxtEl.focus();\r\n\t\t\ttxtEl.setSelectionRange(pos, pos);\r\n\t\t}\r\n\t\telse if (txtEl.createTextRange) {\r\n\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\trange.collapse(true);\r\n\t\t\trange.moveEnd('character', pos);\r\n\t\t\trange.moveStart('character', pos);\r\n\t\t\trange.select();\r\n\t\t}\t\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * Control focus manager.\r\n */\r\njslet.ui.FocusManager = function() {\r\n\tthis._onChangingFocus = null;\r\n\tthis._focusKeyCode = null;\r\n\tthis._containerIds = null;\r\n\tthis._activeDataset = null;\r\n\tthis._activeField = null;\r\n\tthis._activeValueIndex = null;\r\n\t\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.FocusManager.prototype = {\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get onChangingFocus event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var doChangingFocus = function (element, reserve, datasetObj, fieldName, focusingFieldList, valueIndex) {\r\n\t * \t     console.log('Changing focus');\r\n\t *     };\r\n\t *     jslet.ui.globalFocusManager.onChangingFocus(doChangingFocus);\r\n\t * \r\n\t * @param {Function | undefined} onChangingFocus Focus changing event handler.\r\n\t * \r\n\t * @param {HtmlElement} element Focusing HTML element;\r\n\t * @param {Boolean} reserve If it's focusing prior element, reserve is true, otherwise false;\r\n\t * @param {jslet.data.Dataset} datasetObj Current dataset object. If the UI control is not jslet UI control, it's null;\r\n\t * @param {String} fieldName Current field name. If the UI control is not jslet UI field control, it's null;\r\n\t * @param {String[]} focusingFieldList Focusing field name list. You can use 'focusingFieldList' and 'fieldName' to check the position of field name.  \r\n\t * @param {Integer} valueIndex Identify the value index of BETWEEN-style or MULTIPLE-style field.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonChangingFocus: function(onChangingFocus) {\r\n\t\tif(onChangingFocus === undefined) {\r\n\t\t\treturn this._onChangingFocus;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.onChangingFocus', onChangingFocus).isFunction();\r\n\t\tthis._onChangingFocus = onChangingFocus;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get 'focusKeyCode'\r\n\t * \r\n\t * @param {Integer | undefined} focusKeyCode Key code for changing focus, default is 9 ('Tab' key).\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfocusKeyCode: function(focusKeyCode) {\r\n\t\tif(focusKeyCode === undefined) {\r\n\t\t\treturn this._focusKeyCode;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.focusKeyCode', focusKeyCode).isNumber();\r\n\t\tthis._focusKeyCode = focusKeyCode;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveDataset: function(dsName) {\r\n\t\tif(dsName === undefined) {\r\n\t\t\treturn this._activeDataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeDataset', dsName).isString();\r\n\t\tthis._activeDataset = dsName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveField: function(fldName) {\r\n\t\tif(fldName === undefined) {\r\n\t\t\treturn this._activeField;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeField', fldName).isString();\r\n\t\tthis._activeField = fldName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveValueIndex: function(valueIndex) {\r\n\t\tif(valueIndex === undefined) {\r\n\t\t\treturn this._activeValueIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeValueIndex', valueIndex).isNumber();\r\n\t\tthis._activeValueIndex = valueIndex;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tpushContainer: function(containerId) {\r\n\t\tjslet.Checker.test('FocusManager.pushContainer#containerId', containerId).required().isString();\r\n\t\tif(this._containerIds === null) {\r\n\t\t\tthis._containerIds = [];\r\n\t\t}\r\n\t\tthis._containerIds.push(containerId);\r\n\t},\r\n\t\r\n\tpopContainer: function(containerId) {\r\n\t\tjslet.Checker.test('FocusManager.pushContainer#containerId', containerId).required().isString();\r\n\t\tif(this._containerIds[this._containerIds.length - 1] == containerId) {\r\n\t\t\tthis._containerIds.pop();\r\n\t\t}\r\n\t},\r\n\t\r\n\ttabPrev: function() {\r\n\t\tjQuery.tabPrev(this._getContainer(), true, jQuery.proxy(this._doChangingFocus, this));\r\n\t},\r\n\t\r\n\ttabNext: function() {\r\n\t\tjQuery.tabNext(this._getContainer(), true, jQuery.proxy(this._doChangingFocus, this));\r\n\t},\r\n\t\r\n\t_getContainer: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqContainer;\r\n\t\tif(Z._containerIds && Z._containerIds.length > 0) {\r\n\t\t\tvar containerId = Z._containerIds[Z._containerIds.length - 1];\r\n\t\t\tjqContainer = jQuery('#' + containerId);\r\n\t\t\tif(jqContainer.length === 0) {\r\n\t\t\t\tthrow new Error('Not found container: ' + containerId);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tjqContainer = jQuery(document);\r\n\t\t}\r\n\t\treturn jqContainer;\r\n\t},\r\n\t\r\n\t_doChangingFocus: function(ele, reverse) {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = jslet.data.getDataset(Z._activeDataset),\r\n\t\t\tfocusedFlds = dsObj && dsObj.mergedFocusedFields();\r\n\t\tif(Z._onChangingFocus) {\r\n\t\t\tvar cancelFocus = Z._onChangingFocus(ele, reverse, dsObj, Z._activeField, focusedFlds, Z._activeValueIndex);\r\n\t\t\tif(!cancelFocus) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z._activeDataset && !Z._activeField) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(!dsObj || !dsObj.focusedFields()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar idx = focusedFlds.indexOf(Z._activeField);\r\n\t\tif(idx < 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar masterFldName;\r\n\t\tif(!reverse) {\r\n\t\t\tif(idx === focusedFlds.length - 1) {\r\n\t\t\t\tmasterFldName = dsObj.masterField();\r\n\t\t\t\tif(masterFldName) {\r\n\t\t\t\t\tZ._activeDataset = dsObj.masterDataset();\r\n\t\t\t\t\tZ._activeField = masterFldName;\r\n\t\t\t\t\treturn Z._doChangingFocus(ele, reverse);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.focusEditControl(focusedFlds[idx + 1]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(idx === 0) {\r\n\t\t\t\tmasterFldName = dsObj.masterField();\r\n\t\t\t\tif(masterFldName) {\r\n\t\t\t\t\tZ._activeDataset = dsObj.masterDataset();\r\n\t\t\t\t\tZ._activeField = masterFldName;\r\n\t\t\t\t\treturn Z._doChangingFocus(ele, reverse);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.focusEditControl(focusedFlds[idx - 1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tfunction isTabableElement(ele) {\r\n\t\t\tvar tagName = ele.tagName;\r\n\t\t\tif(tagName == 'TEXTAREA' || tagName == 'A' || tagName == 'BUTTON') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(tagName == 'INPUT') {\r\n\t\t\t\tvar typeAttr = ele.type;\r\n\t\t\t\tif(typeAttr == 'button' || typeAttr == 'image' || typeAttr == 'reset' || typeAttr == 'submit' || typeAttr == 'url' || typeAttr == 'file') {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction handleHostKeyDown(event) {\r\n\t\t\tvar focusKeyCode = Z._focusKeyCode || jslet.global.defaultFocusKeyCode || 9;\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === focusKeyCode || keyCode === 9) {\r\n\t\t\t\tif(keyCode !== 9 && !isTabableElement(event.target)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(event.shiftKey){\r\n\t\t\t\t\tZ.tabPrev();\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tZ.tabNext();\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjQuery(document).keydown(handleHostKeyDown);\r\n\t}\r\n};\r\n\r\n/**\r\n * Global focus manager.\r\n * \r\n * @member jslet.ui\r\n * @type {jslet.ui.FocusManager}\r\n */\r\njslet.ui.globalFocusManager = new jslet.ui.FocusManager();\r\n\r\n/*!\r\n * jQuery.tabbable 1.0 - Simple utility for selecting the next / previous ':tabbable' element.\r\n * https://github.com/marklagendijk/jQuery.tabbable\r\n *\r\n * Includes ':tabbable' and ':focusable' selectors from jQuery UI Core\r\n *\r\n * Copyright 2013, Mark Lagendijk\r\n * Released under the MIT license\r\n *\r\n */\r\n\r\n(function($){\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the next :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusNext = function(container, isLoop, onChangingFocus){\r\n\t\tselectNextTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the previous :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the next :tabable element.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabNext = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectNextTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the previous :tabbable element\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\tfunction selectNextTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar nextIndex = 0;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex + 1 < selectables.length){\r\n\t\t\t\tnextIndex = currentIndex + 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tnextIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, false);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(nextIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectPrevTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar prevIndex = selectables.length - 1;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex > 0){\r\n\t\t\t\tprevIndex = currentIndex - 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tprevIndex = selectables.length - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, true);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(prevIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sortByTabIndex(items) {\r\n\t\tif(!items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar item, item1, k;\r\n\t\tfor(var i = 1, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tk = 0;\r\n\t\t\tfor(var j = i - 1; j >= 0; j--) {\r\n\t\t\t\titem1 = items[j];\r\n\t\t\t\tif(item1.tabIndex <= item.tabIndex) {\r\n\t\t\t\t\tk = j + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t\tif(i !== k) {\r\n\t\t\t\titems.splice(i, 1);\r\n\t\t\t\titems.splice(k, 0, item);\r\n\t\t\t}\r\n\t\t} //end for i\r\n\t}\r\n\t\r\n\t/*\r\n\t * :focusable and :tabbable, both taken from jQuery UI Core\r\n\t */\r\n\t$.extend($.expr[ ':' ], {\r\n\t\tdata: $.expr.createPseudo ?\r\n\t\t\t$.expr.createPseudo(function(dataName){\r\n\t\t\t\treturn function(elem){\r\n\t\t\t\t\treturn !!$.data(elem, dataName);\r\n\t\t\t\t};\r\n\t\t\t}) :\r\n\t\t\t// support: jQuery <1.8\r\n\t\t\tfunction(elem, i, match){\r\n\t\t\t\treturn !!$.data(elem, match[ 3 ]);\r\n\t\t\t},\r\n\r\n\t\tfocusable: function(element){\r\n\t\t\treturn focusable(element, !isNaN($.attr(element, 'tabindex')));\r\n\t\t},\r\n\r\n\t\ttabbable: function(element){\r\n\t\t\tvar tabIndex = $.attr(element, 'tabindex'),\r\n\t\t\t\tisTabIndexNaN = isNaN(tabIndex);\r\n\t\t\treturn ( isTabIndexNaN || tabIndex >= 0 ) && focusable(element, !isTabIndexNaN);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusable function, taken from jQuery UI Core\r\n\t * @param element\r\n\t * @returns {*}\r\n\t */\r\n\tfunction focusable(element){\r\n\t\tvar map, mapName, img,\r\n\t\t\tnodeName = element.nodeName.toLowerCase(),\r\n\t\t\tisTabIndexNotNaN = !isNaN($.attr(element, 'tabindex'));\r\n\t\tif('area' === nodeName){\r\n\t\t\tmap = element.parentNode;\r\n\t\t\tmapName = map.name;\r\n\t\t\tif(!element.href || !mapName || map.nodeName.toLowerCase() !== 'map'){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\timg = $('img[usemap=#' + mapName + ']')[0];\r\n\t\t\treturn !!img && visible(img);\r\n\t\t}\r\n\t\treturn ( /input|select|textarea/.test(nodeName) ?\r\n\t\t\t!element.disabled :\r\n\t\t\t'a' === nodeName ?\r\n\t\t\t\telement.href || isTabIndexNotNaN :\r\n\t\t\t\tisTabIndexNotNaN) &&\r\n\t\t\t// the element and all of its ancestors must be visible\r\n\t\t\tvisible(element);\r\n\r\n\t\tfunction visible(element){\r\n\t\t\treturn $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function(){\r\n\t\t\t\treturn $.css(this, 'visibility') === 'hidden';\r\n\t\t\t}).length;\r\n\t\t}\r\n\t}\r\n})(jQuery);\r\n\n/**\r\n* @class\r\n* Message bus. Example:\r\n* \r\n*     @example\r\n*     var myCtrlObj = {onReceiveMessage: function(messageName, messageBody){alert(messageBody.x);}};\r\n*     \r\n*     jslet.messageBus.subcribe('MyMessage', myCtrlObj); //Subcribe a message from MessageBus\r\n*     \r\n*     jslet.messageBus.unsubcribe('MyMessage', myCtrlObj); //Unsubcribe a message from MessageBus\r\n*     \r\n*     jslet.messageBus.sendMessage('MyMessage', {x: 10, y:10}); //Send a mesasge to MessageBus\r\n* \r\n*/\r\njslet.MessageBus = function () {\r\n\tvar _messages = {};\r\n\t//SizeChanged is predefined message\r\n\t_messages[jslet.MessageBus.SIZECHANGED] = [];\r\n\t\r\n\tvar _timeoutHandlers = [];\r\n\t/**\r\n\t * Send a message.\r\n\t * \r\n\t * @param {String} messageName Message name.\r\n\t * @param {Object} mesageBody Message body.\r\n\t */\r\n\tthis.sendMessage = function (messageName, messageBody, sender) {\r\n\t\tif(!_messages[messageName]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar handler = _timeoutHandlers[messageName];\r\n\t\t\r\n\t\tif (handler){\r\n\t\t\twindow.clearTimeout(handler);\r\n\t\t}\r\n\t\thandler = setTimeout(function(){\r\n\t\t\t_timeoutHandlers[messageName] = null;\r\n\t\t\tvar ctrls = _messages[messageName], ctrl;\r\n\t\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\t\tctrl = ctrls[i];\r\n\t\t\t\tif (ctrl && ctrl.onReceiveMessage){\r\n\t\t\t\t\tctrl.onReceiveMessage(messageName, messageBody);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 30);\r\n\t\t_timeoutHandlers[messageName] = handler;\r\n\t};\r\n\r\n\t/**\r\n\t* Subscribe a message.\r\n\t* \r\n\t* @param {String} messageName message name.\r\n\t* @param {Object} ctrlObj control object which need subscribe a message.<br /> \r\n\t*   there must be a function: onReceiveMessage in ctrlObj.<br />\r\n\t*\tonReceiveMessage: function(messageName, messageBody){}<br />\r\n\t*   //messageName: String, message name;<br />\r\n\t*   //messageBody: Object, message body;<br />\r\n\t*/\r\n\tthis.subscribe = function(messageName, ctrlObj){\r\n\t\tif (!messageName || !ctrlObj) {\r\n\t\t\tthrow new Error(\"MessageName and ctrlObj required!\");\r\n\t\t}\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls){\r\n\t\t\tctrls = [];\r\n\t\t\t_messages[messageName] = ctrls;\r\n\t\t}\r\n\t\tctrls.push(ctrlObj);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Subscribe a message.\r\n\t * \r\n\t * @param {String} messageName message name.\r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(messageName, ctrlObj){\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar k = ctrls.indexOf(ctrlObj);\r\n\t\tif (k >= 0) {\r\n\t\t\tctrls.splice(k,1);\r\n\t\t}\r\n\t};\r\n};\r\n\r\njslet.MessageBus.SIZECHANGED = \"SIZECHANGED\";\r\n\r\njslet.messageBus = new jslet.MessageBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.messageBus.sendMessage(jslet.MessageBus.SIZECHANGED, null, window);\r\n});\r\n\n/**\r\n * @class\r\n * \r\n * Resize event bus, manage all resize event. Example:\r\n * \r\n *     @example\r\n *     var myCtrlObj = {\r\n *       checkSizeChanged: function(){}\r\n *     }\r\n *\r\n *     //Subcribe a message from MessageBus\r\n *     jslet.resizeEventBus.subcribe(myCtrlObj);\r\n *\r\n *     //Unsubcribe a message from MessageBus\r\n *     jslet.resizeEventBus.unsubcribe(myCtrlObj);\r\n * \r\n *     //Send a mesasge to MessageBus\r\n *     jslet.resizeEventBus.sendMessage('MyMessage', {x: 10, y:10});\r\n * \r\n */\r\njslet.ui.ResizeEventBus = function () {\r\n\t\r\n\tvar handler = null;\r\n\t\r\n\tfunction getResizableChild(sender, childElements) {\r\n\t\tif(!sender) {\r\n\t\t\tsender = document.body;\r\n\t\t}\r\n\t\tvar children = sender.children;\r\n\t\tif(!children) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar child;\r\n\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\tchild = children[i];\r\n\t\t\tif(child.getAttribute(jslet.ui.ResizeEventBus.RESIZABLE)) {\r\n\t\t\t\tchildElements.push(child);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(child.children) {\r\n\t\t\t\tgetResizableChild(child, childElements);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fire a \"resize\" message.\r\n\t * \r\n\t * @param {HtmlElement} sender Sender which sends the \"resize\" event.\r\n\t */\r\n\tthis.resize = function (sender) {\r\n\t\tvar ctrls = [];\r\n\t\tgetResizableChild(sender, ctrls);\r\n\t\tvar ctrl, jsletCtrl;\r\n\t\tif(jslet.ui._activePopup) {\r\n\t\t\tjslet.ui._activePopup.hide();\r\n\t\t}\r\n\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\tctrl = ctrls[i];\r\n\t\t\tif (ctrl){\r\n\t\t\t\tjsletCtrl = ctrl.jslet;\r\n\t\t\t\tif (jsletCtrl && jsletCtrl.checkSizeChanged){\r\n\t\t\t\t\tjsletCtrl.checkSizeChanged();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._bodyResize = jslet.debounce(this.resize, 100);\r\n\t\r\n\t/**\r\n\t * Subscribe a control to response a resize event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var uiCtrl = {\r\n\t *       checkSizeChanged: function() {}\r\n\t *     };\r\n\t * \r\n\t *     jslet.ui.resizeEventBus.subscribe(uiCtrl);\r\n\t * \r\n\t * @param {Object} ctrlObj Control object which need subscribe a message, there must be a function: checkSizeChanged in ctrlObj.\r\n\t */\r\n\tthis.subscribe = function(ctrlObj) {\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tif(!ctrlObj.checkSizeChanged || !jQuery.isFunction(ctrlObj.checkSizeChanged)) {\r\n\t\t\tthrow new Error('subscribe#ctrlObj must have a method named: \"checkSizeChanged\"!');\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).attr(jslet.ui.ResizeEventBus.RESIZABLE, true);\r\n\t\tvar p = ctrlObj.el.parentNode;\r\n\t\twhile(p) {\r\n\t\t\tif(jQuery(p).attr(jslet.ui.ResizeEventBus.RESIZABLE)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tp = p.parentNode;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * Unsubscribe a control to response a resize event.\r\n\t * \r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(ctrlObj){\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).removeAttr(jslet.ui.ResizeEventBus.RESIZABLE);\r\n\t};\r\n\t\r\n};\r\n\r\njslet.ui.ResizeEventBus.RESIZABLE = \"data-jslet-resizable\";\r\n\r\n/**\r\n * Global resize event bus object.\r\n * \r\n * @member jslet.ui\r\n * @type {jslet.ui.ResizeEventBus}\r\n */\r\njslet.ui.resizeEventBus = new jslet.ui.ResizeEventBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.ui.resizeEventBus._bodyResize();\r\n});\r\n\njslet.ui.htmlclass = {};\r\njslet.ui.GlobalZIndex = 100;\r\n\r\n/**\r\n * @enum\r\n * \r\n * Key code.\r\n */\r\njslet.ui.KeyCode = {\r\n\tBACKSPACE: 8, \r\n\tTAB: 9,\r\n\tENTER: 13,\r\n\tSHIFT: 16,\r\n\tCONTROL: 17,\r\n\tALT: 18,\r\n\r\n\tCAPSLOCK: 20,\r\n\tESCAPE: 27,\r\n\tSPACE: 32,\r\n\tPAGEUP: 33,\r\n\tPAGEDOWN: 34,\r\n\tEND: 35,\r\n\tHOME: 36,\r\n\tLEFT: 37,\r\n\tUP: 38,\r\n\tRIGHT: 39,\r\n\tDOWN: 40,\r\n\t\r\n\tINSERT: 45,\r\n\tDELETE: 46,\r\n\r\n\tF1: 112,\r\n\tF2: 113,\r\n\tF3: 114,\r\n\tF4: 115,\r\n\tF5: 116,\r\n\tF6: 117,\r\n\tF7: 118,\r\n\tF8: 119,\r\n\tF9: 120,\r\n\tF10: 121,\r\n\tF11: 122,\r\n\tF12: 123,\r\n\r\n\tIME: 229\r\n};\r\n\r\nfor(var i = 65; i < 90; i++) {\r\n\tjslet.ui.KeyCode[String.fromCharCode(i)] = i;\r\n}\r\n\r\n/**\r\n * @method\r\n * @member jslet.ui\r\n * \r\n * Get the specified level parent element. Example:\r\n * \r\n *     @example\r\n *     //html snippet is: body -> div1 -> div2 ->table\r\n *     jslet.ui.getParentElement(div2); // return div1\r\n *     jslet.ui.getParentElement(div2, 2); //return body \r\n * \r\n * @param {HtmlElement} htmlElement HTML element.\r\n * @param {Integer} level level\r\n * \r\n * @return {HtmlElement} Parent element, if not found, return null.\r\n */\r\njslet.ui.getParentElement = function (htmlElement, level) {\r\n\tif (!level) {\r\n\t\tlevel = 1;\r\n\t}\r\n\tvar flag = htmlElement.parentElement ? true : false,\r\n\tresult = htmlElement;\r\n\tfor (var i = 0; i < level; i++) {\r\n\t\tif (flag) {\r\n\t\t\tresult = result.parentElement;\r\n\t\t} else {\r\n\t\t\tresult = result.parentNode;\r\n\t\t}\r\n\t\tif (!result) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Find first parent with specified condition. Example:\r\n * \r\n *      @example\r\n *      //Html snippet: body ->div1 ->div2 -> div3\r\n *\t   var odiv = jslet.ui.findFirstParent(\r\n *\t\t  odiv3, \r\n *\t\t  function (node) {return node.class == 'head';},\r\n *\t\t  function (node) {return node.tagName != 'BODY'}\r\n *       );\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} element The start checking html element.\r\n * @param {Function} startConditionFn Callback function.\r\n * @param {HtmlElement} startConditionFn.node: function(node}{...}, node is html element;\r\n * @param {Boolean} startConditionFn.return True - Start to get parent node, false - otherwise. \r\n * @param {Function} stopConditionFn Callback function.\r\n * @param {HtmlElement} stopConditionFn.node: function(node}{...}, node is html element;\r\n * @param {Boolean} startConditionFn.return True - End to get parent node, false - otherwise. \r\n * \r\n * @return {HtmlElement} Parent element or null.\r\n */\r\njslet.ui.findFirstParent = function (htmlElement, conditionFn, stopConditionFn) {\r\n\tvar p = htmlElement;\r\n\tif (!p) {\r\n\t\treturn null;\r\n\t}\r\n\tif (!conditionFn) {\r\n\t\treturn p.parentNode;\r\n\t}\r\n\tif (conditionFn(p)) {\r\n\t\treturn p;\r\n\t} else {\r\n\t\tif (stopConditionFn && stopConditionFn(p.parentNode)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn jslet.ui.findFirstParent(p.parentNode, conditionFn, stopConditionFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Find parent element that has 'jslet' property.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} element The start checking html element.\r\n * \r\n * @return {HtmlElement} Parent element or null.\r\n */\r\njslet.ui.findJsletParent = function(element){\r\n\treturn jslet.ui.findFirstParent(element, function(ele){\r\n\t\treturn ele.jslet ? true:false; \r\n\t});\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Check one node is a child of another node or not.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} parentNode parent node.\r\n * @param {HtmlElement} testNode, testing node.\r\n * \r\n * @return {Boolean} true - 'testNode' is a child of 'parentNode', false - otherwise.\r\n */\r\njslet.ui.isChild = function(parentNode, testNode) {\r\n\tif(!parentNode || !testNode) {\r\n\t\treturn false;\r\n\t}\r\n\tvar p = testNode;\r\n\twhile(p) {\r\n\t\tif(p == parentNode) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tp = p.parentNode;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @class\r\n * \r\n * Text Measurer, measure the display width or height of the given text. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.textMeasurer.setElement(document.body);\r\n *     try{\r\n *       var width = jslet.ui.textMeasurer.getWidth('HellowWorld');\r\n *       var height = jslet.ui.textMeasurer.getHeight('HellowWorld');\r\n *     }finally{\r\n *       jslet.ui.textMeasurer.setElement();\r\n *     }\r\n * \r\n */\r\njslet.ui.TextMeasurer = function () {\r\n\tvar rule,felement = document.body,felementWidth;\r\n\r\n\tvar lastText = null;\r\n\t\r\n\tvar createRule = function () {\r\n\t\tif (!rule) {\r\n\t\t\trule = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(rule);\r\n\t\t\trule.style.position = 'absolute';\r\n\t\t\trule.style.left = '-9999px';\r\n\t\t\trule.style.top = '-9999px';\r\n\t\t\trule.style.display = 'none';\r\n\t\t\trule.style.margin = '0px';\r\n\t\t\trule.style.padding = '0px';\r\n\t\t\trule.style.overflow = 'hidden';\r\n\t\t}\r\n\t\tif (!felement) {\r\n\t\t\tfelement = document.body;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Set HTML element which to be used to merge. \r\n\t * \r\n\t * @param {HtmlElement} element.\r\n\t */\r\n\tthis.setElement = function (element) {\r\n\t\tfelement = element;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcreateRule();\r\n\t\trule.style.fontSize = felement.style.fontSize;\r\n\t\trule.style.fontStyle = felement.style.fontStyle;\r\n\t\trule.style.fontWeight = felement.style.fontWeight;\r\n\t\trule.style.fontFamily = felement.style.fontFamily;\r\n\t\trule.style.lineHeight = felement.style.lineHeight;\r\n\t\trule.style.textTransform = felement.style.textTransform;\r\n\t\trule.style.letterSpacing = felement.style.letterSpacing;\r\n\t};\r\n\r\n\tthis.setElementWidth = function (width) {\r\n\t\tfelementWidth = width;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (width) {\r\n\t\t\tfelement.style.width = width;\r\n\t\t} else {\r\n\t\t\tfelement.style.width = '';\r\n\t\t}\r\n\t};\r\n\r\n\tfunction updateText(text){\r\n\t\tif (lastText != text) {\r\n\t\t\trule.innerHTML = text;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get the display size of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display size, unit: px.\r\n\t */\r\n\tthis.getSize = function (text) {\r\n\t\tcreateRule();\r\n\t\tupdateText(text);\r\n\t\tvar ruleObj = jQuery(rule);\r\n\t\treturn {width:ruleObj.width(),height:ruleObj.height()};\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display width of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display width, unit: px.\r\n\t */\r\n\tthis.getWidth = function (text) {\r\n\t\treturn this.getSize(text).width;\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display height of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display height, unit: px.\r\n\t */\r\n\tthis.getHeight = function (text) {\r\n\t\treturn this.getSize(text).height;\r\n\t};\r\n};\r\n\r\n/**\r\n * Text measurer. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.textMeasurer.setElement(document.body);\r\n *     try{\r\n *       var width = jslet.ui.textMeasurer.getWidth('HellowWorld');\r\n *       var height = jslet.ui.textMeasurer.getHeight('HellowWorld');\r\n *     }finally{\r\n *       jslet.ui.textMeasurer.setElement();\r\n *     }\r\n\r\n * @type {jslet.ui.TextMeasurer}\r\n * \r\n * @member jslet.ui\r\n */\r\njslet.ui.textMeasurer = new jslet.ui.TextMeasurer();\r\n\r\n/**\r\n * Get css property value. Example:\r\n * \r\n *     @example\r\n *     var width = jslet.ui.getCssValue('fooClass', 'width'); //Return value like '100px' or '200em'\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} className Css class name.\r\n * @param {String} styleName style name\r\n * \r\n * @return {String} Css property value.\r\n */\r\njslet.ui.getCssValue = function(className, styleName){\r\n\tvar odiv = document.createElement('div');\r\n\todiv.className = className;\r\n\todiv.style.display = 'none';\r\n\tdocument.body.appendChild(odiv);\r\n\tvar result = jQuery(odiv).css(styleName);\r\n\t\r\n\tdocument.body.removeChild(odiv);\r\n\treturn result;\r\n};\r\n\r\njslet.ui.setEditableStyle = function(formElement, disabled, readOnly, onlySetStyle, required) {\r\n\tif(!onlySetStyle) {\r\n\t\tformElement.disabled = disabled;\r\n\t\tformElement.readOnly = readOnly;\r\n\t}\r\n\tvar jqEl = jQuery(formElement);\r\n\tif(disabled || readOnly) {\r\n\t\tif (!jqEl.hasClass('jl-readonly')) {\r\n\t\t\tjqEl.addClass('jl-readonly');\r\n\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t}\r\n\t} else {\r\n\t\tjqEl.removeClass('jl-readonly');\r\n\t\tif(required) {\r\n\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Get system scroll bar width.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @return {Integer} scroll bar width.\r\n */\r\njslet.ui.scrollbarSize = function() {\r\n\tvar parent, child, width, height;\r\n\r\n\tif (width === undefined) {\r\n\t\tparent = jQuery('<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>').appendTo('body');\r\n\t\tchild = parent.children();\r\n\t\twidth = child.innerWidth() - child.height(99).innerWidth();\r\n\t\tparent.remove();\r\n\t}\r\n\r\n\treturn width;\r\n};\r\n\r\n/*\r\n * getStyleObject Plugin for jQuery JavaScript Library\r\n * From: http://upshots.org/?p=112\r\n *\r\n * Copyright: Unknown, see source link\r\n * Plugin version by Dakota Schneider (http://hackthetruth.org)\r\n */\r\n(function($){\r\n    $.fn.getStyleObject = function(){\r\n        var dom = this.get(0);\r\n        var style, prop;\r\n        var returns = {};\r\n        if(window.getComputedStyle){\r\n            var camelize = function(a,b){\r\n                return b.toUpperCase();\r\n            };\r\n            style = window.getComputedStyle(dom, null);\r\n            for(var i=0;i<style.length;i++){\r\n                prop = style[i];\r\n                var camel = prop.replace(/\\-([a-z])/g, camelize);\r\n                var val = style.getPropertyValue(prop);\r\n                returns[camel] = val;\r\n            }\r\n            return returns;\r\n        }\r\n        if(dom.currentStyle){\r\n            style = dom.currentStyle;\r\n            for(prop in style){\r\n                returns[prop] = style[prop];\r\n            }\r\n            return returns;\r\n        }\r\n        return this.css();\r\n    };\r\n})(jQuery);\r\n\r\njslet.Clipboard = function() {\r\n\tvar doc = window.document;\r\n\tvar clipboard = doc.getElementById('jsletClipboard');\r\n\tif(!clipboard) {\r\n\t\tjQuery('<textarea id=\"jsletClipboard\" style=\"position:absolute;top:-1000px\" tabindex=\"-1\"></textarea>').appendTo(doc.body);\r\n\t\r\n\t    window.addEventListener('copy', function (event) {\r\n\t        var text = jQuery('#jsletClipboard').val();\r\n\t        if(text) {\r\n\t\t        if(event.clipboardData) {\r\n\t\t        \tevent.clipboardData.setData('text/plain', text);\r\n\t\t        } else {\r\n\t\t        \twindow.clipboardData.setData('text', text);\r\n\t\t        }\r\n\t\t        jQuery('#jsletClipboard').val(null);\r\n\t\t        event.preventDefault();\r\n\t\t        return false;\r\n\t        }\r\n\t    });\r\n\t}\r\n};\r\n\r\njslet.Clipboard.putText = function(text) {\r\n\tvar clipboard = jQuery('#jsletClipboard').val(text);\r\n\tclipboard[0].select();\r\n};\r\n\r\njslet.Clipboard();\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Calendar. Example:\r\n * \r\n *     @example\r\n *     //1. Declaring:\r\n *       <div data-jslet='type:\"Calendar\"' />\r\n *\r\n *     //2. Binding\r\n *       <div id='ctrlId' />\r\n *       //js snippet \r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, {type:\"Calendar\"});\r\n *\t\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl({type:\"Calendar\"}, document.body);\r\n */\r\njslet.ui.Calendar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,value,onDateSelected,minDate,maxDate';\r\n\r\n\t\tZ._value = null;\r\n\t\t\r\n\t\tZ._onDateSelected = null;\r\n\t\t\r\n\t\tZ._minDate = null;\r\n\r\n\t\tZ._maxDate = null;\r\n\t\t\r\n\t\tZ._currYear = 0;\r\n\t\tZ._currMonth = 0;\r\n\t\tZ._currDate = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Calendar value.\r\n\t * \r\n\t * @param {Date | undefined} value calendar value.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.value', value).isDate();\r\n\t\tthis._value = value;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get minimum date of calendar range.\r\n\t * \r\n\t * @param {Date | undefined} minDate Minimum date of calendar range.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tminDate: function(minDate) {\r\n\t\tif(minDate === undefined) {\r\n\t\t\treturn this._minDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.minDate', minDate).isDate();\r\n\t\tthis._minDate = minDate;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get maximum date of calendar range.\r\n\t * \r\n\t * @param {Date | undefined} maxDate Maximum date of calendar range.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tmaxDate: function(maxDate) {\r\n\t\tif(maxDate === undefined) {\r\n\t\t\treturn this._maxDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.maxDate', maxDate).isDate();\r\n\t\tthis._maxDate = maxDate;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user select a date. Example:\r\n\t * \r\n\t *     @example\r\n\t *     calendar.onDateSelected(function(value){});\r\n\t *\r\n\t * @param {Function | undefined} onDateSelected Date selected event handler.\r\n\t * @param {Date} onDateSelected.value Calendar value.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonDateSelected: function(onDateSelected) {\r\n\t\tif(onDateSelected === undefined) {\r\n\t\t\treturn this._onDateSelected;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.onDateSelected', onDateSelected).isFunction();\r\n\t\tthis._onDateSelected = onDateSelected;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-calendar')) {\r\n\t\t\tjqEl.addClass('jl-calendar panel panel-default');\r\n\t\t}\r\n\t\tvar calendarLocale = jsletlocale.Calendar;\r\n\t\tvar template = ['<div class=\"jl-cal-header\">',\r\n\t\t\t'<a class=\"jl-cal-btn jl-cal-yprev\" title=\"', calendarLocale.yearPrev,\r\n\t\t\t'\" href=\"javascript:;\">&lt;&lt;</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mprev\" title=\"', calendarLocale.monthPrev, '\">&lt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-title\"></a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mnext\" title=\"', calendarLocale.monthNext, '\">&gt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-ynext\" title=\"', calendarLocale.yearNext, '\">&gt;&gt;</a>',\r\n\t\t'</div>',\r\n\t\t'<div class=\"jl-cal-body\">',\r\n\t\t\t'<table cellpadding=\"0\" cellspacing=\"0\">',\r\n\t\t\t\t'<thead><tr><th class=\"jl-cal-weekend\">',\r\n\t\t\t\tcalendarLocale.Sun,\r\n\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Mon,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Tue,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Wed,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Thu,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Fri,\r\n\t\t\t\t\t\t'</th><th class=\"jl-cal-weekend\">',\r\n\t\t\t\t\tcalendarLocale.Sat,\r\n\t\t\t\t\t\t'</th></tr></thead><tbody>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'</tbody></table></div><div class=\"jl-cal-footer\"><a class=\"jl-cal-today\" href=\"javascript:;\">', calendarLocale.today, '</a></div>'];\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tvar jqTable = jqEl.find('.jl-cal-body table');\r\n\t\tZ._currYear = -1;\r\n\t\tjqTable.on('click', Z._doTableClick);\r\n\t\t\r\n\t\tvar dvalue = Z._value && jslet.isDate(Z._value) ? Z._value : new Date();\r\n\t\tthis.setValue(dvalue);\r\n\t\tjqEl.find('.jl-cal-today').click(function (event) {\r\n\t\t\tvar d = new Date();\r\n\t\t\tZ.setValue(new Date(d.getFullYear(), d.getMonth(), d.getDate()));\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-yprev').click(function (event) {\r\n\t\t\tZ.incYear(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mprev').click(function (event) {\r\n\t\t\tZ.incMonth(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-ynext').click(function (event) {\r\n\t\t\tZ.incYear(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mnext').click(function (event) {\r\n\t\t\tZ.incMonth(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.on('keydown', function(event){\r\n\t\t\tvar ctrlKey = event.ctrlKey,\r\n\t\t\t\tkeyCode = event.keyCode;\r\n\t\t\tvar delta = 0;\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.UP) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\t\t\tif(keyCode == jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.LEFT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.RIGHT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_getNotNullDate: function() {\r\n\t\tvar value =this._value;\r\n\t\tif(!value) {\r\n\t\t\tvalue = new Date();\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tincDate: function(deltaDay) {\r\n\t\tvar value = this._getNotNullDate();\r\n\t\tvalue.setDate(value.getDate() + deltaDay);\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincMonth: function(deltaMonth) {\r\n\t\tvar value = this._getNotNullDate(),\r\n\t\t\toldDate = value.getDate();\r\n\t\tvalue.setMonth(value.getMonth() + deltaMonth);\r\n\t\tif(oldDate >=29) {\r\n\t\t\tvar newDate = value.getDate();\r\n\t\t\tif(oldDate != newDate) {\r\n\t\t\t\tvalue = new Date(value.getFullYear(), value.getMonth(), 1) - 24*3600*1000;\r\n\t\t\t\tvalue = new Date(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincYear: function(deltaYear) {\r\n\t\tvar value = this._getNotNullDate(),\r\n\t\t\toldDate = value.getDate();\r\n\t\tvalue.setFullYear(value.getFullYear() + deltaYear);\r\n\t\tif(oldDate >=29) {\r\n\t\t\tvar newDate = value.getDate();\r\n\t\t\tif(oldDate != newDate) {\r\n\t\t\t\tvalue = new Date(value.getFullYear(), value.getMonth(), 1) - 24*3600*1000;\r\n\t\t\t\tvalue = new Date(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\t_innerSetValue: function(value) {\r\n\t\tvar Z = this,\r\n\t\t\toldValue = Z._getNotNullDate();\r\n\t\tif(value) { //Overwrite Year/Month/Date part, keep time part.\r\n\t\t\toldValue.setFullYear(value.getFullYear(), value.getMonth(), value.getDate());\r\n\t\t}\r\n\t\tZ._value = oldValue;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set date value of calendar.\r\n\t * \r\n\t * @param {Date} value Calendar date.\r\n\t */\r\n\tsetValue: function (value) {\r\n\t\tif (!value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar Z = this;\r\n\t\tif (Z._minDate && value < Z._minDate) {\r\n\t\t\tvalue = new Date(Z._minDate.getTime());\r\n\t\t}\r\n\t\tif (Z._maxDate && value > Z._maxDate) {\r\n\t\t\tvalue = new Date(Z._maxDate.getTime());\r\n\t\t}\r\n\t\tZ._innerSetValue(value);\r\n\t\tvar y = value.getFullYear(), \r\n\t\t\tm = value.getMonth();\r\n\t\tif (Z._currYear == y && Z._currMonth == m) {\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t} else {\r\n\t\t\tZ._refreshDateCell(y, m);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override.\r\n\t */\r\n\tfocus: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-cal-current')[0].focus();\r\n\t},\r\n\t\r\n\t_checkNaviState: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), flag, btnToday;\r\n\t\tif (Z._minDate) {\r\n\t\t\tvar minY = Z._minDate.getFullYear(),\r\n\t\t\t\tminM = Z._minDate.getMonth(),\r\n\t\t\t\tbtnYearPrev = jqEl.find('.jl-cal-yprev')[0];\r\n\t\t\tflag = (Z._currYear <= minY);\r\n\t\t\tbtnYearPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == minY && Z._currMonth <= minM);\r\n\t\t\tvar btnMonthPrev = jqEl.find('.jl-cal-mprev')[0];\r\n\t\t\tbtnMonthPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._minDate > new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\r\n\t\tif (Z._maxDate) {\r\n\t\t\tvar maxY = Z._maxDate.getFullYear(),\r\n\t\t\t\tmaxM = Z._maxDate.getMonth(),\r\n\t\t\t\tbtnYearNext = jqEl.find('.jl-cal-ynext')[0];\r\n\t\t\tflag = (Z._currYear >= maxY);\r\n\t\t\tbtnYearNext.jslet_disabled = flag;\r\n\t\t\tbtnYearNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == maxY && Z._currMonth >= maxM);\r\n\t\t\tvar btnMonthNext = jqEl.find('.jl-cal-mnext')[0];\r\n\t\t\tbtnMonthNext.jslet_disabled = flag;\r\n\t\t\tbtnMonthNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._maxDate < new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshDateCell: function (year, month) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tmonthnames = jsletlocale.Calendar.monthNames,\r\n\t\t\tmname = monthnames[month],\r\n\t\t\totitle = jqEl.find('.jl-cal-title')[0];\r\n\t\totitle.innerHTML = mname + ',' + year;\r\n\t\tvar otable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\tfirstDay = new Date(year, month, 1),\r\n\t\t\tw1 = firstDay.getDay(),\r\n\t\t\toneDayMs = 86400000, //24 * 60 * 60 * 1000\r\n\t\t\tdate = new Date(firstDay.getTime() - (w1 + 1) * oneDayMs);\r\n\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\r\n\t\tvar rowCnt = rows.length, otr, otd, m, oa;\r\n\t\tfor (var i = 1; i <= rowCnt; i++) {\r\n\t\t\totr = rows[i - 1];\r\n\t\t\tfor (var j = 1, tdCnt = otr.cells.length; j <= tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j - 1];\r\n\t\t\t\tdate = new Date(date.getTime() + oneDayMs);\r\n\t\t\t\toa = otd.firstChild;\r\n\t\t\t\tif (Z._minDate && date < Z._minDate || Z._maxDate && date > Z._maxDate) {\r\n\t\t\t\t\toa.innerHTML = '';\r\n\t\t\t\t\totd.jslet_date_value = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toa.innerHTML = date.getDate();\r\n\t\t\t\t\totd.jslet_date_value = date;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\tif (m != month) {\r\n\t\t\t\t\tjQuery(otd).addClass('jl-cal-disable');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjQuery(otd).removeClass('jl-cal-disable');\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t} //end for i\r\n\t\tZ._currYear = year;\r\n\t\tZ._currMonth = month;\r\n\t\tZ._setCurrDateCls();\r\n\t\tZ._checkNaviState();\r\n\t},\r\n\t\r\n\t_fireSelectedEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onDateSelected) {\r\n\t\t\tZ._onDateSelected.call(Z, Z._value);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doTableClick: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar node = event.target,\r\n\t\t\totd = node.parentNode;\r\n\t\t\r\n\t\tif (otd && otd.tagName && otd.tagName.toLowerCase() == 'td') {\r\n\t\t\tif (!otd.jslet_date_value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = jslet.ui.findFirstParent(otd, function (node) { return node.jslet; });\r\n\t\t\tvar Z = el.jslet;\r\n\t\t\tZ._innerSetValue(otd.jslet_date_value);\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t\ttry{\r\n\t\t\t\totd.firstChild.focus();\r\n\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t}\r\n\t},\r\n\r\n\t_setCurrDateCls: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!jslet.isDate(Z._value)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currM = Z._value.getMonth(),\r\n\t\t\tcurrY = Z._value.getFullYear(),\r\n\t\t\tcurrD = Z._value.getDate(),\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\totable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\trowCnt = rows.length, otr, otd, m, d, y, date, jqLink;\r\n\t\tfor (var i = 0; i < rowCnt; i++) {\r\n\t\t\totr = rows[i];\r\n\t\t\tfor (var j = 0, tdCnt = otr.cells.length; j < tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j];\r\n\t\t\t\tdate = otd.jslet_date_value;\r\n\t\t\t\tif (!date) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\ty = date.getFullYear();\r\n\t\t\t\td = date.getDate();\r\n\t\t\t\tjqLink = jQuery(otd.firstChild);\r\n\t\t\t\tif (y == currY && m == currM && d == currD) {\r\n\t\t\t\t\tif (!jqLink.hasClass('jl-cal-current')) {\r\n\t\t\t\t\t\tjqLink.addClass('jl-cal-current');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\totd.firstChild.focus();\r\n\t\t\t\t\t} catch(e){\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqLink.removeClass('jl-cal-current');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-cal-body table').off();\r\n\t\tjqEl.find('.jl-cal-today').off();\r\n\t\tjqEl.find('.jl-cal-yprev').off();\r\n\t\tjqEl.find('.jl-cal-mprev').off();\r\n\t\tjqEl.find('.jl-cal-mnext').off();\r\n\t\tjqEl.find('.jl-cal-ynext').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Calendar', jslet.ui.Calendar);\r\njslet.ui.Calendar.htmlTemplate = '<div></div>';\r\n\n/**\r\n* @class\r\n* \r\n* MessageBox, it can be used to display info, warn, error, confirm, prompt dialog.\r\n*/\r\njslet.ui.MessageBox = function () {\r\n\r\n\t/**\r\n\t * Show message box.\r\n\t * \r\n\t * @param {String} message Message text.\r\n\t * @param {String} caption Caption text.\r\n\t * @param {String} iconClass Caption icon class.\r\n\t * @param {String[]} buttons Array of button names, it's the subset of array ['ok','cancel', 'yes', 'no'], like : ['ok','cancel'].\r\n\t * @param {Function} callbackFn Callback function when user click one button. \r\n\t * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n\t * @param {String} callbackFn.value Text which user inputted. \r\n\t * @param {Integer} hasInput Value inputting flag, options: 0 - none, 1 - single line input, 2 - multiple line input.\r\n\t * @param {String} defaultValue The default value of Input element, if 'hasInput' = 0, this argument is be ignored.\r\n\t * @param {Function} validateFn Validate function of input element, if 'hasInput' = 0, this argument is be ignored.\r\n\t * @param {String} validateFn.value The value which need to be validated, if 'hasInput' = 0, this argument is be ignored.\r\n\t */\r\n\tthis.show = function (message, caption, iconClass, buttons, callbackFn, hasInput, defaultValue, validateFn) {\r\n\r\n\t\tvar opt = { type: 'window', caption: caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, stopEventBubbling: true, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar iconHtml = '';\r\n\t\tif (iconClass) {\r\n\t\t\ticonHtml = '<div class=\"jl-msg-icon ';\r\n\t\t\tif (iconClass == 'info' || iconClass == 'error' || iconClass == 'question' || iconClass == 'warning') {\r\n\t\t\t\ticonHtml += 'jl-msg-icon-' + iconClass;\r\n\t\t\t} else {\r\n\t\t\t\ticonHtml += iconClass;\r\n\t\t\t}\r\n\t\t\ticonHtml += '\"><i class=\"fa ';\r\n\t\t\tswitch (iconClass) {\r\n\t            case 'info':\r\n\t            \ticonHtml += 'fa-info';\r\n\t                break;\r\n\t            case 'error':\r\n\t            \ticonHtml += 'fa-times';\r\n\t                break;\r\n\t            case 'success':\r\n\t            \ticonHtml += 'fa-check';\r\n\t                break;\r\n\t            case 'warning':\r\n\t            \ticonHtml += 'fa-exclamation';\r\n\t                break;\r\n\t            case 'question':\r\n\t            \ticonHtml += 'fa-question';\r\n\t                break;\r\n\t            default :\r\n\t            \ticonHtml += 'fa-info';\r\n                 \tbreak;\r\n\t        }\r\n\t\t\ticonHtml += '\"></i></div>';\r\n\t\t}\r\n\r\n\t\tvar btnCount = buttons.length;\r\n\t\tvar btnHtml = [], btnName, i;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tfor (i = btnCount - 1; i >=0; i--) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-xs\" ');\r\n\t\t\t\tbtnHtml.push(' data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\">');\r\n\t\t\t\tbtnHtml.push(jsletlocale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < btnCount; i++) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-xs\" ');\r\n\t\t\t\tbtnHtml.push('\" data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\">');\r\n\t\t\t\tbtnHtml.push(jsletlocale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar inputHtml = ['<br />'];\r\n\t\tif (hasInput) {\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push('<input type=\"text\"');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('<textarea rows=\"5\"');\r\n\t\t\t}\r\n\t\t\tinputHtml.push(' style=\"width:');\r\n\t\t\tinputHtml.push('98%\"');\r\n\t\t\tif (defaultValue !== null && defaultValue !== undefined) {\r\n\t\t\t\tinputHtml.push(' value=\"');\r\n\t\t\t\tinputHtml.push(defaultValue);\r\n\t\t\t\tinputHtml.push('\"');\r\n\t\t\t}\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push(' />');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('></textarea>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(message) {\r\n\t\t\tmessage = message.replace('\\n', '<br />');\r\n\t\t}\r\n\t\tvar html = ['<div class=\"jl-msg-container\">', iconHtml, '<div class=\"' + (hasInput? 'jl-msg-message-noicon': 'jl-msg-message') + '\">',\r\n\t\t\t\t\tmessage, inputHtml.join(''), '</div>', '</div>',\r\n\t\t\t\t\t'<div class=\"jl-msg-tool\"><div>', btnHtml.join(''), '</div></div>'\r\n\t\t];\r\n\r\n\t\towin.setContent(html.join(''));\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tvar toolBar = jqEl.find('.jl-msg-tool')[0].firstChild;\r\n\t\tvar inputCtrl = null;\r\n\t\tif (hasInput == 1) {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container input')[0];\r\n\t\t} else {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container textarea')[0];\r\n\t\t}\r\n\t\t\r\n\t\tjQuery(toolBar).on('click', 'button', function(event) {\r\n\t\t\tvar obtn = event.currentTarget;\r\n\t\t\tvar btnName = jQuery(obtn).attr('data-jsletname');\r\n\t\t\tvar value = null;\r\n\t\t\tif (hasInput && btnName == 'ok') {\r\n\t\t\t\tvalue = inputCtrl.value;\r\n\t\t\t\tif (validateFn && !validateFn(value)) {\r\n\t\t\t\t\tinputCtrl.focus();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\towin.close();\r\n\t\t\tif (callbackFn) {\r\n\t\t\t\tcallbackFn(btnName, value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(99981);\r\n\t\tvar k = btnCount - 1;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tk = 0;\r\n\t\t}\r\n\t\tif(inputCtrl) {\r\n\t\t\tinputCtrl.focus();\r\n\t\t} else {\r\n\t\t\tvar toolBtn = toolBar.childNodes[k];\r\n\t\t\tif(toolBtn) {\r\n\t\t\t\ttoolBtn.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn owin;\r\n\t};\r\n};\r\n\r\n/**\r\n * Show info message. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.info('Finished!', 'Tips');\r\n *     jslet.ui.info('Finished!', 'Tips', function(){console.log('info')});\r\n *     jslet.ui.info('Finished!', 'Tips', null, 1000); //Auto close after 1 second.\r\n *     \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.info = jslet.ui.alert = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.info;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'info', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Show error message. Example:\r\n * \r\n *     @examle\r\n *     jslet.ui.error('You have made a mistake!', 'Error');\r\n *     jslet.ui.error('You have made a mistake!', 'Error', function(){console.log('error')});\r\n *     jslet.ui.error('You have made a mistake!', 'Error', null, 1000); //Auto close after 1 second.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.error = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.error;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'error', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show warning message. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning');\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning', function(){console.log('warning')});\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning', null, 1000); //Auto close after 1 second.\r\n *     \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.warn = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.warn;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'warning', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show confirm message. Example:\r\n * \r\n *     @example\r\n *     var callbackFn = function(button){\r\n *       alert('Button: ' + button + ' clicked!');\r\n *     }\r\n *     jslet.ui.confirm('Are you sure?', 'Confirm', callbackFn);//show Ok/Cancel\r\n *     jslet.ui.confirm('Are you sure?', 'Confirm', callbackFn, true);//show Yes/No/Cancel\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button. \r\n * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n */\r\njslet.ui.confirm = function(message, caption, callbackFn, isYesNo){\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.confirm;\r\n\t}\r\n\tif (!isYesNo) {\r\n\t\tomsgBox.show(message, caption, 'question',['ok', 'cancel'], callbackFn);\t\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, 'question', ['yes', 'no', 'cancel'], callbackFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * Prompt user to input some value. Example:\r\n * \r\n *     @example\r\n *     var callbackFn = function(button, value){\r\n *       alert('Button: ' + button + ', value:' + value);\r\n *     };\r\n *     \r\n *     var validateFn = function(value){\r\n *       if (!value){\r\n *         alert('Please input some thing!');\r\n *         return false;\r\n *       }\r\n *       return true;\r\n *     };\r\n *     \r\n *     jslet.ui.prompt('Input your name: ', 'Prompt', callbackFn, 'Bob', validateFn);\r\n *     jslet.ui.prompt('Input your comments: ', 'Prompt', callbackFn, null, validateFn, true);\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button. \r\n * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n * @param {String} callbackFn.value Text which user inputted. \r\n * @param {String} defaultValue The default value of Input element, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {Function} validateFn Validate function of input element, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {String} validateFn.value The value which need to be validated, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {Boolean} isMultiLine True - user can input multiple lines text, false - only one line text.\r\n */\r\njslet.ui.prompt = function (message, caption, callbackFn, defaultValue, validateFn, isMultiLine) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption && !message) {\r\n\t\tcaption = jsletlocale.MessageBox.prompt;\r\n\t}\r\n\tif (!isMultiLine) {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 1, defaultValue, validateFn);\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 2, defaultValue, validateFn);\r\n\t}\r\n};\r\n\n/**\r\n* @class \r\n* \r\n* Overlay panel. Example:\r\n* \r\n*     @example\r\n*     var overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n*     overlay.setZIndex(999, '#ddd');\r\n*     overlay.show();\r\n* \r\n* @param {HtmlElement} container HTML Element that OverlayPanel will cover.\r\n* @param {String} color Color String.\r\n*/\r\njslet.ui.OverlayPanel = function (container, color) {\r\n\tvar odiv = document.createElement('div');\r\n\tjQuery(odiv).addClass('jl-overlay').on('click', function(event){\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar srcEle = event.target;\r\n\t\tif(!jslet.ui.PopupPanel.popupElement.checkAndHide(srcEle)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t});\r\n\t\r\n\tif (color) {\r\n\t\todiv.style.backgroundColor = color;\r\n\t}\r\n\tvar left, top, width, height;\r\n\tif (!container) {\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tleft = 0;\r\n\t\ttop = 0;\r\n\t\twidth = jqBody.width();\r\n\t\theight = jqBody.height();\r\n\t} else {\r\n\t\twidth = jQuery(container).width();\r\n\t\theight = jQuery(container).height();\r\n\t}\r\n\todiv.style.left = '0px';\r\n\todiv.style.top = '0px';\r\n\todiv.style.bottom = '0px';\r\n\todiv.style.right = '0px';\r\n\tif (!container) {\r\n\t\tdocument.body.appendChild(odiv);\r\n\t} else {\r\n\t\tcontainer.appendChild(odiv);\r\n\t}\r\n\todiv.style.display = 'none';\r\n\r\n\tvar oldResizeHanlder = null;\r\n\tif (!container) {\r\n\t\toldResizeHanlder = window.onresize;\r\n\r\n\t\twindow.onresize = function () {\r\n\t\t\todiv.style.width = document.body.scrollWidth + 'px';\r\n\t\t\todiv.style.height = document.body.scrollHeight + 'px';\r\n\t\t};\r\n\t} else {\r\n\t\toldResizeHanlder = container.onresize;\r\n\t\tcontainer.onresize = function () {\r\n\t\t\tvar width = jQuery(container).width() - 12;\r\n\t\t\tvar height = jQuery(container).height() - 12;\r\n\t\t\todiv.style.width = width + 'px';\r\n\t\t\todiv.style.height = height + 'px';\r\n\t\t};\r\n\t}\r\n\r\n\tthis.overlayPanel = odiv;\r\n\r\n\t/**\r\n\t * Show overlay panel.\r\n\t */\r\n\tthis.show = function () {\r\n\t\todiv.style.display = 'block';\r\n\t\treturn odiv;\r\n\t};\r\n\r\n\t/**\r\n\t * Hide overlay panel.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\todiv.style.display = 'none';\r\n\t\treturn odiv;\r\n\t};\r\n\t\r\n\t/**\r\n\t * Set Z-index.\r\n\t * \r\n\t * @param {Integer} zIndex Z-Index.\r\n\t */\r\n\tthis.setZIndex = function(zIndex){\r\n\t\tthis.overlayPanel.style.zIndex = zIndex;\r\n\t};\r\n\r\n\t/**\r\n\t * Destroy overlay panel.\r\n\t */\r\n\tthis.destroy = function () {\r\n\t\tthis.hide();\r\n\t\tif (!container) {\r\n\t\t\twindow.onresize = oldResizeHanlder;\r\n\t\t\tdocument.body.removeChild(odiv);\r\n\t\t} else {\r\n\t\t\tcontainer.onresize = oldResizeHanlder;\r\n\t\t\tcontainer.removeChild(odiv);\r\n\t\t}\r\n\t\tjQuery(this.overlayPanel).off();\r\n\t};\r\n};\r\n\n/**\r\n * @private\r\n * @class\r\n * \r\n * Popup Panel. Example: \r\n * \r\n *     @example\r\n *     var popPnl = new jslet.ui.PopupPanel();\r\n *     popPnl.contentElement(document.getElementById('id'));\r\n *     popPnl.show(10, 10, 100, 100);\r\n * \r\n *     popPnl.hide(); //or\r\n *     popPnl.destroy();\r\n *  \r\n */\r\njslet.ui.PopupPanel = function (excludedEl) {\r\n\tthis._onHidePopup = null;\r\n\tthis._excludedEl = excludedEl;\r\n\tthis._contentEl = null;\r\n};\r\n\r\njslet.ui.PopupPanel.prototype = {\r\n\t/**\r\n\t * Event handler when hide popup panel: function(){}\r\n\t */\r\n\tonHidePopup: function(onHidePopup) {\r\n\t\tif(onHidePopup === undefined) {\r\n\t\t\treturn this._onHidePopup;\r\n\t\t}\r\n\t\tthis._onHidePopup = onHidePopup;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\texcludedElement: function(excludedEl) {\r\n\t\tif(excludedEl === undefined) {\r\n\t\t\treturn this._excludedEl;\r\n\t\t}\r\n\t\tthis._excludedEl = excludedEl;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcontentElement: function(contentEl) {\r\n\t\tif(contentEl === undefined) {\r\n\t\t\treturn this._contentEl;\r\n\t\t}\r\n\t\tthis._contentEl = contentEl;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tshow: function(left, top, width, height, ajustX, ajustY) {\r\n\t\tjslet.ui.PopupPanel.popupElement.show(this, left, top, width, height, ajustX, ajustY);\r\n\t},\r\n\t\r\n\thide: function() {\r\n\t\tjslet.ui.PopupPanel.popupElement.hide();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tthis._onHidePopup = null;\r\n\t\tthis._excludedEl = null;\r\n\t\tthis._contentEl = null;\r\n\t}\r\n};\r\n\r\n(function () {\r\n\tvar PopupElement = function() {\r\n\t\tvar sharedPopPnl = null;\r\n\t\tvar activePopup = null;\r\n\t\t\r\n\t\tvar inPopupPanel = function (htmlElement) {\r\n\t\t\tif (!htmlElement || htmlElement === document) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (jQuery(htmlElement).hasClass('jl-popup-panel')) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn inPopupPanel(htmlElement.parentNode);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar self = this;\r\n\t\tvar documentClickHandler = function (event) {\r\n\t\t\tif(!activePopup) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tvar srcEle = event.target;\r\n\t\t\tself.checkAndHide(srcEle);\r\n\t\t};\r\n\t\t\r\n\t\tfunction createPanel() {\r\n\t\t\tif(sharedPopPnl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar p = document.createElement('div');\r\n\t\t\tp.style.display = 'none';\r\n\t\t\tp.className = 'jl-popup-panel jl-opaque jl-border-box dropdown-menu';\r\n\t\t\tp.style.position = 'absolute';\r\n\t\t\tp.style.zIndex = 99000;\r\n\t\t\tdocument.body.appendChild(p);\r\n\t\t\t\r\n\t\t\tjQuery(document).on('click', documentClickHandler);\r\n\t\t\tsharedPopPnl = p;\r\n\t\t}\r\n\t\t\r\n\t\tfunction changeContent(newPopup) {\r\n\t\t\tvar oldContent = sharedPopPnl.childNodes[0];\r\n\t\t\tif (oldContent) {\r\n\t\t\t\tsharedPopPnl.removeChild(oldContent);\r\n\t\t\t}\r\n\t\t\tif(newPopup) {\r\n\t\t\t\tvar content = newPopup.contentElement();\r\n\t\t\t\tif(!content) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tsharedPopPnl.appendChild(content);\r\n\t\t\t\tcontent.style.border = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.show = function(activePop, left, top, width, height, ajustX, ajustY) {\r\n\t\t\tcreatePanel();\r\n\t\t\tif(activePopup !== activePop) {\r\n\t\t\t\tthis.hide();\r\n\t\t\t\tchangeContent(activePop);\r\n\t\t\t}\r\n\t\t\tactivePopup = activePop;\r\n\t\t\t\r\n\t\t\tleft = parseInt(left);\r\n\t\t\ttop = parseInt(top);\r\n\t\t\t\r\n\t\t\tif (height) {\r\n\t\t\t\tsharedPopPnl.style.height = parseInt(height) + 'px';\r\n\t\t\t}\r\n\t\t\tif (width) {\r\n\t\t\t\tsharedPopPnl.style.width = parseInt(width) + 'px';\r\n\t\t\t}\r\n\t\t\tvar jqWin = jQuery(window),\r\n\t\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\t\twinHeight = jqWin.scrollTop() + jqWin.height(),\r\n\t\t\t\tpanel = jQuery(sharedPopPnl),\r\n\t\t\t\tw = panel.outerWidth(),\r\n\t\t\t\th = panel.outerHeight();\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tleft -= w;\r\n\t\t\t}\r\n\t\t\tif(left + w > winWidth) {\r\n\t\t\t\tleft += winWidth - left - w - 1;\r\n\t\t\t}\r\n\t\t\tif(top + h > winHeight) {\r\n\t\t\t\ttop -= (h + 2 + ajustY);\r\n\t\t\t}\r\n\t\t\tif(left < 0) {\r\n\t\t\t\tleft = 1;\r\n\t\t\t}\r\n\t\t\tif(top < 0) {\r\n\t\t\t\ttop = 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (top) {\r\n\t\t\t\tsharedPopPnl.style.top = top + 'px';\r\n\t\t\t}\r\n\t\t\tif (left) {\r\n\t\t\t\tsharedPopPnl.style.left = left + 'px';\r\n\t\t\t}\r\n\t\t\tsharedPopPnl.style.display = 'block';\r\n\t\t};\r\n\t\t\r\n\t\tthis.hide = function() {\r\n\t\t\tif(activePopup) {\r\n\t\t\t\tif (sharedPopPnl) {\r\n\t\t\t\t\tsharedPopPnl.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tvar hideCallBack = activePopup.onHidePopup();\r\n\t\t\t\tif(hideCallBack) {\r\n\t\t\t\t\thideCallBack.call(activePopup);\r\n\t\t\t\t}\r\n\t\t\t\tactivePopup = null;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\t/**\r\n\t\t * Check the specified element is in the active popup panel or not. If it is not in the popup panel, hide the popup panel. \r\n\t\t */\r\n\t\tthis.checkAndHide = function(el) {\r\n\t\t\tif(!activePopup) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (jslet.ui.isChild(activePopup.excludedElement(), el) ||\r\n\t\t\t\t\tinPopupPanel(el)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.hide();\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\t\r\n\t\tthis.destroy = function() {\r\n\t\t\tif(!sharedPopPnl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdocument.body.removeChild(sharedPopPnl);\r\n\t\t\tjQuery(sharedPopPnl).off();\r\n\t\t\tjQuery(document).off('click', documentClickHandler);\r\n\t\t}; \r\n\t};\r\n\t\r\n\tjslet.ui.PopupPanel.popupElement = new PopupElement();\r\n})();\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * ProgressBar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"ProgressBar\",value:10, labelText: 'Starting...']};\r\n * \r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px\"></div>\r\n *  \r\n *     //2. Binding\r\n *       <div id='ctrlId'></div>\r\n *     //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.ProgressBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,value,labelText';\r\n\r\n\t\tZ._value = 0;\r\n\t\t\r\n\t\tZ._labelText = '0%';\r\n\t\t\r\n\t\tZ._binded = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar value.\r\n\t * \r\n\t * @param {Integer | undefined} value Progress bar value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tvalue = parseInt(value);\r\n\t\tif(!value) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value > 100) {\r\n\t\t\tvalue = 100;\r\n\t\t}\r\n\t\tthis._value = value;\r\n\t\tthis._setValue();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar label text.\r\n\t * \r\n\t * @param {String | undefined} labelText Progress bar label text.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlabelText: function(labelText) {\r\n\t\tif(labelText === undefined) {\r\n\t\t\treturn this._labelText;\r\n\t\t}\r\n\t\tthis._labelText = labelText;\r\n\t\tif(this._binded) {\r\n\t\t\tvar jqEl = jQuery(this.el);\r\n\t\t\tvar jqLabel = jqEl.find('.jl-progressbar-label');\r\n\t\t\tjqLabel.text(labelText);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tthis._binded = true;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-progressbar')) {\r\n\t\t\tjqEl.addClass('jl-progressbar jl-border-box jl-round5');\r\n\t\t}\r\n\t\tjqEl.attr('role', 'progressbar').attr('aria-valuemax', '100').attr('aria-valuemin', '0').attr('aria-valuenow', this._value);\r\n\t\tjqEl.html('<div class=\"jl-progressbar-label\">' + Z._labelText + '</div><div class=\"jl-progressbar-value\"></div>');\r\n\t},\r\n\t\r\n\t_setValue: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._binded) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar jqLabel = jqEl.find('.jl-progressbar-label');\r\n\t\tvar jqValue = jqEl.find('.jl-progressbar-value');\r\n\t\tZ._oldValue = -1;\r\n\t\tvar value = Z._value, strValue = value + '%';\r\n\t\tif(value != Z._oldValue) {\r\n\t\t\tjqLabel.text(strValue);\r\n\t\t\tjqValue.css('width', strValue);\r\n\t\t\tjqEl.attr('aria-valuenow', value);\r\n\t\t\tZ._oldValue = value;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('ProgressBar', jslet.ui.ProgressBar);\r\njslet.ui.ProgressBar.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * ProgressBar. Example:\r\n * \r\n *     @example\r\n *     var progressObj = jslet.ui.ProgressPopup(document.body, 'saving...');\r\n *     progressObj.value(40);\r\n *     progressObj.show();\r\n *\r\n * @param {HtmlElement} container The container where the progress popup control show in.\r\n * @param {String} caption The progress caption.\r\n * @param {Boolean} cancellable True - the progress popup can be cancelled, false - otherwise.\r\n * @param {Function} onCancelled The cancelled event, fired when user clicking the close button.\r\n * \r\n */\r\njslet.ui.ProgressPopup = function(container, caption, cancellable, onCancelled) {\r\n\tjslet.Checker.test('ProgressPopus#container', container).isHTMLElement();\r\n\tjslet.Checker.test('ProgressPopus#onCancelled', onCancelled).isFunction();\r\n\t\r\n\tthis._dialog = null;\r\n\tthis._value = 0;\r\n\tthis._cancellable = false;\r\n\tif(cancellable !== undefined) {\r\n\t\tthis._cancellable = !!cancellable;\r\n\t}\r\n\tthis._onCancelled = onCancelled;\r\n\t\r\n\tthis.initialize(container || document.body, caption || '');\r\n};\r\n\r\njslet.ui.ProgressPopup.prototype = {\r\n\t\t\r\n\tinitialize: function(container, caption) {\r\n\t\tvar opt = { type: 'window', caption: caption, isCenter: true, resizable: true, minimizable: false, closable: this._cancellable, maximizable: false, \r\n\t\t\t\twidth: 500, height: 80, animation: 'fade', onClosed: this._onCancelled};\r\n\t\tvar owin = jslet.ui.createControl(opt, container);\r\n\t\tvar html = '<div name=\"progressBar\" data-jslet=\"type: \\'ProgressBar\\'\" style=\"width: 100%\"/>';\r\n\t\towin.setContent(html);\r\n\t\tthis._dialog = owin;\r\n\t\tjslet.ui.install(owin.el);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show progress popup control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tshow: function() {\r\n\t\tthis._dialog.showModal();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar value.\r\n\t * \r\n\t * @param {Integer | undefined} value Progress bar value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tvalue = parseInt(value);\r\n\t\tif(!value) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value > 100) {\r\n\t\t\tvalue = 100;\r\n\t\t}\r\n\t\tthis._value = value;\r\n\t\tvar progressBar = jQuery(this._dialog.el).find('[name=progressBar]')[0].jslet;\r\n\t\tprogressBar.value(value);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close and destroy the progress popup control.\r\n\t */\r\n\tdestroy: function(){\r\n\t\tif(this._dialog) {\r\n\t\t\tthis._dialog.close();\r\n\t\t\tthis._dialog = null;\r\n\t\t}\r\n\t}\r\n};\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRating. A control which usually displays some star to user, and user can click to rate something. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRating\",dataset:\"employee\",field:\"grade\", itemCount: 5};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRating\",dataset:\"employee\",field:\"grade\"', itemCount: 5' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.Rating = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t_isDBControl: false,\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,value,itemCount,splitCount,readOnly';\r\n\t\t\r\n\t\tZ._itemCount = 5;\r\n\r\n\t\tZ._splitCount = 0;\r\n\t\t\r\n\t\tZ._itemWidth = 0;\r\n\t\t\r\n\t\tZ._value = 0;\r\n\t\t\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ._isReady = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the rate item count, In other words, the count of 'Star' sign.\r\n\t * \r\n\t * @param {Integer | undefined} itemCount Rate item count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\titemCount: function(itemCount) {\r\n\t\tif(itemCount === undefined) {\r\n\t\t\treturn this._itemCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.itemCount', itemCount).isGTZero();\r\n\t\tthis._itemCount = parseInt(itemCount);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the rating value.\r\n\t * \r\n\t * @param {Number | undefined} value Rating value.\r\n\t * \r\n\t * @return {this | Number}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.value', value).isGTZero();\r\n\t\tthis._value = value;\r\n\t\tif(this._isReady) {\r\n\t\t\tthis._setValue(value);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identity whether the rating is read only or not.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly True - the rating is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Value splitCount for one item. <br />\r\n\t * if \"splitCount\" is 0.5, the possible value will be 0.5, 1, 1.5, ... <br />\r\n\t * if \"splitCount\" is 0.25, the possible value will be 0.25, 0.5, 0.75, 1, 1.25, 1.5, ... \r\n\t * \r\n\t * @param {Integer | undefined} splitCount \r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tsplitCount: function(splitCount) {\r\n\t\tif(splitCount === undefined) {\r\n\t\t\treturn this._splitCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.splitCount', splitCount).isGTEZero();\r\n\t\tthis._splitCount = splitCount;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-rating')) {\r\n\t\t\tjqEl.addClass('jl-rating');\r\n\t\t}\r\n\r\n\t\tZ.renderAll();\r\n\t\tjqEl.on('mousemove', 'td', jQuery.proxy(Z._mouseMove, Z));\r\n\t\tjqEl.on('mouseleave', jQuery.proxy(Z._mouseOut, Z));\r\n\t\tjqEl.on('mouseup', 'td', jQuery.proxy(Z._mouseUp, Z));\r\n\t\tZ._isReady = true;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\ti, len, \r\n\t\t\thtml1 = '',\r\n\t\t\thtml2 = '',\r\n\t\t\tsTd = '<td><i class=\"fa fa-star\" aria-hidden=\"true\"></i></td>';\r\n\t\tfor(i = 0, len = Z._itemCount; i < len; i++) {\r\n\t\t\thtml1 += sTd;\r\n\t\t\thtml2 += sTd;\r\n\t\t}\r\n\t\tvar html = '<div class=\"jl-rating\"><table><tr>' + html1 +\r\n\t\t\t'</tr></table><div class=\"jl-rating-value\"><table><tr>' + html2 + \r\n\t\t\t'</tr></table></div></div>';\r\n\t\tjqEl.html(html);\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ._itemWidth = jqEl.find('td:first').outerWidth();\r\n\t\t\tZ._setValue(Z._value);\r\n\t\t}, 5);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_mouseMove: function domove(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-rating-value').width(Z._getMovedWidth(event));\r\n\t\tZ._changed = true;\r\n\t},\r\n\r\n\t_getMovedWidth: function(event) {\r\n\t\tvar otd = event.currentTarget,\r\n\t\t\tcellIndex = otd.cellIndex;\r\n\t\treturn this._itemWidth * cellIndex + event.offsetX;\r\n\t},\r\n\t\r\n\t_mouseOut: function doout(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._changed) {\r\n\t\t\tZ._setValue(Z._value);\r\n\t\t}\r\n\t},\r\n\r\n\t_mouseUp: function dodown(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._changed = false;\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tmovedWidth = Z._getMovedWidth(event);\r\n\r\n\t\tZ._value = Z._round(Z._itemCount * movedWidth / (Z._itemCount * Z._itemWidth));\r\n\t\tZ.doUIChanged();\r\n\t},\r\n\t\r\n\t_round: function(value) {\r\n\t\tvar splitCount = this._splitCount;\r\n\t\tif(!splitCount || splitCount === 1) {\r\n\t\t\treturn Math.ceil(value);\r\n\t\t}\r\n\t\tvar intPart = parseInt(value),\r\n\t\t\tdecPart = value - intPart,\r\n\t\t\tunit = 1 / splitCount,\r\n\t\t\tceil;\r\n\t\tfor(var i = 1, len = splitCount; i <= len; i++) {\r\n\t\t\tceil = i * unit;\r\n\t\t\tif(decPart < ceil) {\r\n\t\t\t\treturn intPart + ceil; \r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\t_setValue: function(value) {\r\n\t\tjslet.Checker.test('Rating.value', value).isNumber();\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\titemCnt = Z._itemCount;\r\n\t\tif(value > itemCnt) {\r\n\t\t\tvalue = itemCnt;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-rating-value').width(value * Z._itemWidth);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('Rating', jslet.ui.Rating);\r\njslet.ui.Rating.htmlTemplate = '<Div></Div>';\r\n\n/**\r\n* @class \r\n* \r\n* TipPanel. Example:\r\n* \r\n*     @example\r\n*     var tipPnl = new jslet.ui.TipPanel();\r\n*     tipPnl.show('Hello world', 10, 10);\r\n*/\r\njslet.ui.TipPanel = function () {\r\n\tthis._hideTimerId = null;\r\n\tthis._showTimerId = null;\r\n\tthis._oldElement = null;\r\n\tvar p = document.createElement('div');\r\n\tjQuery(p).addClass('jl-tip-panel');\r\n\tdocument.body.appendChild(p);\r\n\tthis._tipPanel = p;\r\n\r\n\t/**\r\n\t * Show tips at specified position. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tipPnl.show('foo...', event);\r\n\t *     tipPnl.show('foo...', 100, 200);\r\n\t * \r\n\t * @param {String} tips Tips text.\r\n\t * @param {Integer | MouseEvent} leftOrEvent Position left or mouse event, if it is mouse event, the \"top\" argument is undefined.\r\n\t * @param {Integer | undefined} top Position top.\r\n\t */\r\n\tthis.show = function (tips, leftOrEvent, top) {\r\n\t\tvar Z = this;\r\n\t\tvar len = arguments.length;\r\n\t\tvar isSameCtrl = false, left = leftOrEvent;\r\n\t\tif (len == 2) { //this.show(tips)\r\n\t\t\tvar evt = left;\r\n\t\t\tevt = jQuery.event.fix( evt );\r\n\r\n\t\t\ttop = evt.pageY + 16; left = evt.pageX + 2;\r\n\t\t\tvar ele = evt.currentTarget;\r\n\t\t\tisSameCtrl = (ele === Z._oldElement);\r\n\t\t\tZ._oldElement = ele;\r\n\t\t} else {\r\n\t\t\tleft = parseInt(left);\r\n\t\t\ttop = parseInt(top);\r\n\t\t}\r\n\r\n\t\tif (Z._hideTimerId) {\r\n\t\t\twindow.clearTimeout(Z._hideTimerId);\r\n\t\t\tif (isSameCtrl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._showTimerId = window.setTimeout(function () {\r\n\t\t\tvar p = Z._tipPanel;\r\n\t\t\tp.innerHTML = tips;\r\n\t\t\tp.style.left = left + 'px';\r\n\t\t\tp.style.top = top + 'px';\r\n\t\t\tZ._tipPanel.style.display = 'block';\r\n\t\t\tZ._showTimerId = null;\r\n\t\t}, 300);\r\n\t};\r\n\r\n\t/**\r\n\t * Hide tip panel.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._showTimerId) {\r\n\t\t\twindow.clearTimeout(Z._showTimerId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hideTimerId = window.setTimeout(function () {\r\n\t\t\tZ._tipPanel.style.display = 'none';\r\n\t\t\tZ._hideTimerId = null;\r\n\t\t\tZ._oldElement = null;\r\n\t\t}, 300);\r\n\t};\r\n};\r\n\n/**\r\n * @class \r\n * \r\n * WaitingBox. Example:\r\n * \r\n *     @example\r\n *     var wb = new jslet.ui.WaitingBox(document.getElementById(\"test\"), \"Gray\", true);\r\n *\t   wb.show(\"Please wait a moment...\");\r\n * \r\n * @param {HtmlElement} container The container which waiting box resides on.\r\n * @param {String} overlayColor Overlay color.\r\n * @param {Boolean} tipsAtNewLine Tips is at new line or not. If false, tips and waiting icon is at the same line.\r\n */\r\njslet.ui.WaitingBox = function (container, overlayColor, tipsAtNewLine) {\r\n\tvar overlay = new jslet.ui.OverlayPanel(container);\r\n\tvar s = '<div class=\"jl-waitingbox jl-round4\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw jl-waitingbox-icon\"></i>';\r\n\t\ts += '<span class=\"jl-waitingbox-text\"></span></div>';\r\n\r\n\tjQuery(overlay.overlayPanel).html(s);\r\n\r\n\t/**\r\n\t * Show waiting box.\r\n\t * \r\n\t * @param {String} tips Tips.\r\n\t */\r\n\tthis.show = function (tips) {\r\n\t\tvar p = overlay.overlayPanel,\r\n\t\t\tbox = p.firstChild,\r\n\t\t\ttipPanel = box.childNodes[1];\r\n\t\ttipPanel.innerHTML = tips ? tips : '';\r\n\t\tvar jqPnl = jQuery(p),\r\n\t\t\tph = jqPnl.height(),\r\n\t\t\tpw = jqPnl.width();\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar jqBox = jQuery(box);\r\n\t\t\tbox.style.top = Math.round((ph - jqBox.height()) / 2) + 'px';\r\n\t\t\tbox.style.left = Math.round((pw - jqBox.width()) / 2) + 'px';\r\n\t\t}, 10);\r\n\r\n\t\toverlay.show();\r\n\t};\r\n\r\n\t/**\r\n\t * Hide waiting box.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\toverlay.hide();\r\n\t};\r\n\r\n\t/**\r\n\t * Destroy waiting box.\r\n\t */\r\n\tthis.destroy = function () {\r\n\t\toverlay.overlayPanel.innerHTML = '';\r\n\t\toverlay.destroy();\r\n\t};\r\n};\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Accordion. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"Accordion\",selectedIndex:1,items:[{caption:\"Caption1\"},{caption:\"Caption2\"}]};\r\n * \r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *  \r\n *     //2. Binding\r\n *       <div id='ctrlId'>\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.Accordion = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,selectedIndex,onChanged,items';\r\n\r\n\t\tZ._selectedIndex = 0;\r\n\t\t\r\n\t\tZ._onChanged = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Selected index.\r\n\t * \r\n\t * @param {Integer | undefined} index selected index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tselectedIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._selectedIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.selectedIndex', index).isGTEZero();\r\n\t\tthis._selectedIndex = index;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user changes accordion panel. Example:\r\n\t * \r\n\t *     @example \r\n\t *\t   accordionObj.onChanged(function(index){\r\n\t *     });\r\n\t *\r\n\t * @param {Function | undefined} onChanged Accordion panel changed event.\r\n\t * @param {Integer} onChanged.index Accordion panel index.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonChanged: function(onChanged) {\r\n\t\tif(onChanged === undefined) {\r\n\t\t\treturn this._onChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.onChanged', onChanged).isFunction();\r\n\t\tthis._onChanged = onChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Accordion item settings. Example:\r\n\t * \r\n\t *     @example\r\n\t *     accordObj.items([caption: 'caption1'}, {caption: 'caption2'},...]);\r\n\t *     \r\n\t * @param {Object[] | undefined} items Items settings.\r\n\t * @param {String} items.caption Item caption.\r\n\t * \r\n\t * @return {this | Object[]} \r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Accordion.items.caption', item.caption).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-accordion')) {\r\n\t\t\tjqEl.addClass('jl-accordion jl-border-box jl-round5');\r\n\t\t}\r\n\t\tvar panels = jqEl.find('>div'), jqCaption, headHeight = 0, item;\r\n\r\n\t\tvar captionCnt = Z._items ? Z._items.length - 1: -1, caption;\r\n\t\tpanels.before(function(index) {\r\n\t\t\tif (index <= captionCnt) {\r\n\t\t\t\tcaption = Z._items[index].caption;\r\n\t\t\t} else {\r\n\t\t\t\tcaption = 'caption' + index;\r\n\t\t\t}\r\n\t\t\treturn '<button class=\"btn btn-default jl-accordion-head btn-sm\" jsletindex = \"' + index + '\">' + caption + '</button>';\r\n\t\t});\r\n\r\n\t\tvar jqCaptions = jqEl.find('>.jl-accordion-head');\r\n\t\tjqCaptions.click(Z._doCaptionClick);\r\n\t\t\r\n\t\theadHeight = jqCaptions.outerHeight() * panels.length;\r\n\t\tvar contentHeight = jqEl.innerHeight() - headHeight-1;\r\n\t\t\r\n\t\tpanels.wrap('<div class=\"jl-accordion-body\" style=\"height:'+contentHeight+'px;display:none\"></div>');\r\n\t\tvar index = Z._selectedIndex;\r\n\t\tif(index > 0) {\r\n\t\t\tZ._selectedIndex = 0;\r\n\t\t}\r\n        Z.setSelectedIndex(index, true);\r\n\t},\r\n\t\r\n\t_doCaptionClick: function(event){\r\n\t\tvar jqCaption = jQuery(event.currentTarget),\r\n\t\t\tZ = jslet.ui.findJsletParent(jqCaption[0]).jslet,\r\n\t\t\tk = parseInt(jqCaption.attr('jsletindex'));\r\n\t\tZ.setSelectedIndex(k);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set selected index\r\n\t * \r\n\t * @param {Integer} index Panel index, start at 0.\r\n\t */\r\n\tsetSelectedIndex: function(index, isRenderAll){\r\n\t\tif (!index) {\r\n\t\t\tindex = 0;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar jqBodies = jQuery(Z.el).find('>.jl-accordion-body');\r\n\t\tvar pnlCnt = jqBodies.length - 1;\r\n\t\tif (index > pnlCnt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (Z._selectedIndex == index && index < pnlCnt){\r\n\t\t\tjQuery(jqBodies[index]).hide();\r\n\t\t\tif(!isRenderAll || isRenderAll && index > 0) {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tjQuery(jqBodies[index]).show();\r\n\t\t\tZ._selectedIndex = index;\r\n\t\t\tif (Z._onChanged){\r\n\t\t\t\tZ._onChanged.call(this, index);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._selectedIndex >= 0 && Z._selectedIndex != index) {\r\n\t\t\tjQuery(jqBodies[Z._selectedIndex]).hide();\r\n\t\t}\r\n\t\tjQuery(jqBodies[index]).show();\r\n\t\tZ._selectedIndex = index;\r\n\t\tif (Z._onChanged) {\r\n\t\t\tZ._onChanged.call(this, index);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('>.jl-accordion-head').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Accordion', jslet.ui.Accordion);\r\njslet.ui.Accordion.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Jslet Desktop, this control is used to a desktop with a main menu and a workbench.<br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"Desktop\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"Desktop\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.Desktop = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'header,onLoadMenu,menuType,menuWidth';\r\n\t\tZ.requiredProperties = 'onLoadMenu';\r\n\t\t\r\n\t\tZ._header = null;\r\n\t\tZ._onLoadMenu = null;\r\n\t\tZ._menuType = 'side';\r\n\t\t\r\n\t\tZ._menuWidth = 160;\r\n\t\tZ._expanded = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu header.\r\n\t * \r\n\t * @param {String | undefined} header Menu header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\theader: function(header) {\r\n\t\tif(header === undefined) {\r\n\t\t\treturn this._header;\r\n\t\t}\r\n\t\tthis._header = header;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Loading menu event. It can be a Function or a global function name.<br />\r\n\t * Loaded menu configuration is used for jslet.ui.Menu or jslet.ui.SideMenu control.\r\n\t * \r\n\t * @param {Function | String} onLoadMenu Menu loading event handler.\r\n\t * @param {Object[] | Promise} onLoadMenu.return Menu loading event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonLoadMenu: function(onLoadMenu) {\r\n\t\tjslet.Checker.test('DeskTop.onLoadMenu', onLoadMenu).required();\r\n\t\tthis._onLoadMenu = onLoadMenu;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Menu position. The optional values: left or top.\r\n\t * \r\n\t * @param {String | undefined} menuType Menu type. The optional values: 'side', 'top', 'tree', default is 'side'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tmenuType: function(menuType) {\r\n\t\tif(menuType === undefined) {\r\n\t\t\treturn this._menuType;\r\n\t\t}\r\n\t\tjslet.Checker.test('Desktop.menuType', menuType).inArray(['side', 'top', 'tree']);\r\n\t\tthis._menuType = menuType;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Menu width for side menu. It's valid when 'menuType' is 'side'.\r\n\t * \r\n\t * @param {Integer | undefined} menuWidth Menu width for side menu.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmenuWidth: function(menuWidth) {\r\n\t\tif(menuWidth === undefined) {\r\n\t\t\treturn this._menuWidth;\r\n\t\t}\r\n\t\tthis._menuWidth = menuWidth;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(!jqEl.hasClass('jl-desktop')) {\r\n\t\t\tjqEl.addClass('jl-desktop');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.desktop = this;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el), html,\r\n\t\t\tisTop = (Z._menuType === 'top');\r\n\t\tif(isTop) {\r\n\t\t\thtml = '<div name=\"mainMenu\" class=\"jl-dsk-menu-top\"></div><div name=\"workbench\" class=\"jl-dsk-bench-top\"></div>';\r\n\t\t} else {\r\n\t\t\tZ._expanded = true;\r\n\t\t\thtml = '<div class=\"jl-dsk-menu-left\" style=\"width: ' + Z._menuWidth + 'px\">' + \r\n\t\t\t'<div class=\"jl-dsk-header\"><span class=\"jl-dsk-headercontent\">' + (Z._header || '') + \r\n\t\t\t'</span><a class=\"jl-dsk-toggle\" href=\"javascript:void(0)\"><i class=\"fa fa-exchange\"></i></a></div>' +\r\n\t\t\t'<div class=\"jl-dsk-menu\" name=\"mainMenu\"></div></div><div name=\"workbench\" class=\"jl-dsk-bench-left\" style=\"padding-left: ' + Z._menuWidth + 'px\"></div>';\r\n\t\t}\r\n \t\t\r\n\t\tjqEl.html(html);\r\n\t\tvar menuEl = jqEl.find('[name=\"mainMenu\"]')[0],\r\n\t\t\twbEl = jqEl.find('[name=\"workbench\"]')[0];\r\n\t\t\r\n\t\tvar wbCfg = {type: 'TabControl', newable: false, isFixedHeight: true, styleClass: (Z.styleClass() || '') + ' jl-dsk-bench', \r\n\t\t\t\tenableLoading: true, \r\n\t\t\t\tonContentLoading: Z._doContentLoading, onContentLoaded: Z._doContentLoaded, onRemoveTabItem: Z._doRemoveTabItem};\r\n\t\tZ._workbench = jslet.ui.bindControl(wbEl, wbCfg);\r\n\t\t\r\n\t\tvar menuCfg = {type: (isTop? 'MenuBar': 'SideMenuBar'), onItemClick: jQuery.proxy(Z._openMenu, Z)},\r\n\t\t\tmenuItems = null;\r\n\t\tif(Z._onLoadMenu) {\r\n\t\t\tvar result = Z._onLoadMenu();\r\n\t\t\tif(result.done) {\r\n\t\t\t\tresult.done(function(items) {\r\n\t\t\t\t\tjslet.Checker.test('Desktop.MenuItems', items).isArray();\r\n\t\t\t\t\tZ._mainMenu.items(items);\r\n\t\t\t\t\tZ._mainMenu.renderAll();\r\n\t\t\t\t\tZ._autoOpenMenu(items);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tmenuCfg.items = result;\r\n\t\t\t\tmenuItems = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._mainMenu = jslet.ui.bindControl(menuEl, menuCfg);\r\n\t\tif(menuItems) {\r\n\t\t\tZ._autoOpenMenu(menuItems);\r\n\t\t}\r\n\t\tif(!isTop) {\r\n\t\t\tjqEl.find('.jl-dsk-toggle').off().on('click', function() {\r\n\t\t\t\tZ._toggleMenu();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t_autoOpenMenu: function(menuItems) {\r\n\t\tif(!menuItems) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuCfg;\r\n\t\tfor(var i = 0, len = menuItems.length; i < len; i++) {\r\n\t\t\tmenuCfg = menuItems[i];\r\n\t\t\tif(menuCfg.items) {\r\n\t\t\t\tthis._autoOpenMenu(menuCfg.items);\r\n\t\t\t} else if(menuCfg.autoOpen) {\r\n\t\t\t\tthis._openMenu(menuCfg);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_toggleMenu: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._expanded = !Z._expanded;\r\n\t\tvar menuContainer = jqEl.find('.jl-dsk-menu-left'),\r\n\t\t\tjqHeader = jqEl.find('.jl-dsk-headercontent'),\r\n\t\t\tjqWB = jQuery(Z._workbench.el);\r\n\t\tif(Z._expanded) {\r\n\t\t\tZ._mainMenu.expand();\r\n\t\t\tmenuContainer.removeClass('jl-dsk-menu-left-collapsed');\r\n\t\t\tjqHeader.show();\r\n\t\t\tjqWB.css('padding-left', Z._menuWidth);\r\n\t\t} else {\r\n\t\t\tZ._mainMenu.collapse();\r\n\t\t\tjqHeader.hide();\r\n\t\t\tmenuContainer.addClass('jl-dsk-menu-left-collapsed');\r\n\t\t\tjqWB.css('padding-left', 40);\r\n\t\t}\r\n\t},\r\n\t\r\n\tshowTabPanel: function(tabPanelId) {\r\n\t\tthis._workbench.setContentLoadedState(tabPanelId);\r\n\t},\r\n\t\r\n\tsetTabPanelChanged: function(tabPanelId, changed) {\r\n\t\tthis._workbench.setContentChangedState(tabPanelId, changed);\r\n\t},\r\n\t\r\n\topenMenuById: function(menuId) {\r\n\t\tvar menuCfg = this._getMenuCfg(this._mainMenu.items(), menuId, true);\r\n\t\tthis._openMenu(menuCfg);\r\n\t},\r\n\t\r\n\topenMenuByName: function(menuName) {\r\n\t\tvar menuCfg = this._getMenuCfg(this._mainMenu.items(), menuName);\r\n\t\tthis._openMenu(menuCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set tab item to changed state or not.\r\n\t * \r\n\t * @param {String} tabItemId Tab item id.\r\n\t * @param {Boolean} changed Changed state.\r\n\t */\r\n\tsetContentChangedState: function(tabItemId, changed) {\r\n\t\tthis._workbench.setContentChangedState(tabItemId, changed);\r\n\t},\r\n\t\r\n\t/**\r\n\t * set the specified tab item to loaded state. It will fire the \"onContentLoaded\" event.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t */\r\n\tsetContentLoadedState: function(tabItemId) {\r\n\t\tthis._workbench.setContentLoadedState(tabItemId);\r\n\t},\r\n\t\r\n\t_getMenuCfg: function(items, key, isById) {\r\n\t\tvar result = null, item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tif(item.items) {\r\n\t\t\t\tresult = this._getMenuCfg(item.items, key, isById);\r\n\t\t\t\tif(result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(isById) {\r\n\t\t\t\t\tif(item.id === key) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(item.name === key) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_doContentLoading: function(id, tabItemCfg) {\r\n    \tif(tabItemCfg.debounce) {\r\n    \t\tjQuery('#' + id).hide();\r\n    \t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_doContentLoaded: function(id, tabItemCfg) {\r\n    \tif(tabItemCfg.debounce) {\r\n    \t\tjQuery('#' + id).fadeIn('fast');\r\n    \t}\r\n\t},\r\n\t\r\n\t_doRemoveTabItem: function(tabItemCfg, isActive) {\r\n//    \tvar iframe = document.getElementById(tabItemCfg.contentId);\r\n//    \tvar iframeWin = iframe.contentWindow || iframe;\r\n//    \tif(iframeWin.onMainTabClosed) {\r\n//    \t\tiframeWin.onMainTabClosed(tabItemCfg);\r\n//    \t}\r\n    \treturn true;\r\n\t},\r\n\t\r\n\t_openMenu: function(menuCfg) {\r\n\t\tif(!menuCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuUrl = jQuery.trim(menuCfg.url);\r\n\t\t\r\n\t\tif(menuUrl) {\r\n\t\t\tvar menuId = menuCfg.id;\r\n\t\t\tmenuUrl = jslet.urlUtil.addParam(menuUrl, {menuId: menuId});\r\n\t    \tthis._workbench.addTabItem({id: 'if-' + menuId, header: menuCfg.name, url: menuUrl, closable: true, userIFrame: true, debounce: menuCfg.debounce, iconClass: menuCfg.iconClass});\r\n\t    \treturn;\r\n\t\t}\r\n\t\tif(menuCfg.onclick) {\r\n\t\t\tmenuCfg.onclick.call(menuCfg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.warn('Menu: ' + menuCfg.name + ' not exists properties: \"url\" or \"onclick\"');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('.jl-dsk-toggle').off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Desktop', jslet.ui.Desktop);\r\njslet.ui.Desktop.htmlTemplate = '<div></div>';\r\n\r\njslet.ui.DesktopUtil = function() {\r\n\tvar checkDatasetChangedHandler, currTabItemId, changingDatasets, debounce = null;\r\n\t\r\n\tfunction getCurrTabItemId() {\r\n\t\tif(!currTabItemId) {\r\n\t\t\tvar url = window.document.location.href;\r\n\t\t\tcurrTabItemId = jslet.urlUtil.getParam(url, 'jlTabItemId');\r\n\t\t}\r\n\t\treturn currTabItemId;\r\n\t}\r\n\t\r\n\tfunction isPageDebounce() {\r\n\t\tif(debounce === null) {\r\n\t\t\tvar url = window.document.location.href;\r\n\t\t\tdebounce = jslet.urlUtil.getParam(url, 'debounce');\r\n\t\t}\r\n\t\treturn !!debounce;\r\n\t}\r\n\t\r\n\tfunction getDesktop() {\r\n\t\tvar p = window.parent;\r\n\t\tvar result = null;\r\n\t\twhile(true) {\r\n\t\t\tif(!p) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(p.jslet && p.jslet.desktop) {\r\n\t\t\t\tresult = p.jslet.desktop;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tp = p.parent;\r\n\t\t}\r\n\t\tif(!result) { //If parent not exists desktop object, check current window object.\r\n\t\t\tif(window.jslet) {\r\n\t\t\t\tresult = window.jslet.desktop;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tthis.showTabPanel = function() {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.showTabPanel(getCurrTabItemId());\r\n\t};\r\n\t\r\n\tthis.registerEditableDataset = function(datasetNames) {\r\n\t\tjslet.Checker.test('registerEditableDatasetString', datasetNames).isString();\r\n\t\tif(datasetNames) {\r\n\t\t\tvar chgDatasets = datasetNames;\r\n\t\t\tif(jslet.isString(chgDatasets)) {\r\n\t\t\t\tchgDatasets = datasetNames.split(',');\r\n\t\t\t}\r\n\t\t\tchangingDatasets = {};\r\n\t\t\tfor(var i = 0, len = chgDatasets.length; i < len; i++) {\r\n\t\t\t\tchangingDatasets[chgDatasets[i]] = false;\r\n\t\t\t}\r\n\t\t\tif(!checkDatasetChangedHandler && getCurrTabItemId()) {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t//tabcontrol\r\n\t\t\t\tcheckDatasetChangedHandler = window.setInterval(function() {\r\n\t\t\t\t\tvar dsObj, isDiff = false,\r\n\t\t\t\t\t\tchanged = false, oldChanged, newChanged;\r\n\t\t\t\t\tfor(var dsName in changingDatasets) {\r\n\t\t\t\t\t\tdsObj = jslet.data.getDataset(dsName);\r\n\t\t\t\t\t\tif(dsObj) {\r\n\t\t\t\t\t\t\toldChanged = changingDatasets[dsName];\r\n\t\t\t\t\t\t\tnewChanged = dsObj.hasChangedData(true);\r\n\t\t\t\t\t\t\tchanged = changed || newChanged;\r\n\t\t\t\t\t\t\tif(oldChanged !== newChanged) {\r\n\t\t\t\t\t\t\t\tisDiff = true;\r\n\t\t\t\t\t\t\t\tchangingDatasets[dsName] = newChanged;\r\n\t\t\t\t\t\t\t\tif(changed) {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isDiff) {\r\n\t\t\t\t\t\tvar desktop = getDesktop();\r\n\t\t\t\t\t\tif(!desktop) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdesktop.setContentChangedState(getCurrTabItemId(), changed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 500);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!checkDatasetChangedHandler) {\r\n\t\t\t\twindow.clearInterval(checkDatasetChangedHandler);\r\n\t\t\t\tcheckDatasetChangedHandler = null;\r\n\t\t\t}\r\n\t\t\tchangingDatasets = null;\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.openMenuById = function(menuId) {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.openMenuById(menuId);\r\n\t};\r\n\r\n\tthis.openMenuByName = function(menuName) {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.openMenuByName(menuName);\r\n\t};\r\n\t\r\n\tthis.setContentLoadedState = function() {\r\n\t\tif(!isPageDebounce()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.setContentLoadedState(getCurrTabItemId());\r\n\t};\r\n};\r\n\r\njslet.ui.desktopUtil = new jslet.ui.DesktopUtil();\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * FieldSet. Example:\r\n * \r\n *     @example\r\n *     //1. Declaring:\r\n *       <div data-jslet='type:\"FieldSet\"' />\r\n *\r\n *     //2. Binding\r\n *       <div id='ctrlId' />\r\n *       //Js snippet\r\n *       var jsletParam = {type:\"FieldSet\"};\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       var jsletParam = {type:\"FieldSet\"};\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.FieldSet = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,caption,collapsed';\r\n\r\n\t\tZ._caption = null; \r\n\t\t\r\n\t\tZ._collapsed = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get caption of FieldSet.\r\n\t * \r\n\t * @param {String | undefined} caption Caption of FieldSet.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldSet.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify FieldSet is collapsed or not.\r\n\t * \r\n\t * @param {Boolean | undefined} collapsed True - FieldSet is collapsed, false(default) - otherwise. \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcollapsed: function(collapsed) {\r\n\t\tif(collapsed === undefined) {\r\n\t\t\treturn this._collapsed;\r\n\t\t}\r\n\t\tthis._collapsed = collapsed ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-fieldset')) {\r\n\t\t\tjqEl.addClass('jl-fieldset jl-round5');\r\n\t\t}\r\n\t\t\r\n\t\tvar tmpl = ['<legend class=\"jl-fieldset-legend\">'];\r\n\t\ttmpl.push('<span class=\"jl-fieldset-title\"><i class=\"fa fa-chevron-circle-up jl-fieldset-btn\">');\r\n\t\ttmpl.push('<span>');\r\n\t\ttmpl.push(Z._caption);\r\n\t\ttmpl.push('</span></span></legend><div class=\"jl-fieldset-body\"></div>');\r\n\t\t\r\n\t\tvar nodes = Z.el.childNodes, \r\n\t\t\tchildren = [],\r\n\t\t\ti, cnt;\r\n\t\tcnt = nodes.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tchildren.push(nodes[i]);\r\n\t\t}\r\n\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tvar obody = jQuery(Z.el).find('.jl-fieldset-body')[0];\r\n\t\tcnt = children.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tobody.appendChild(children[i]);\r\n\t\t}\r\n\t\t\r\n\t\tjqEl.find('.jl-fieldset-btn').click(jQuery.proxy(Z._doExpandBtnClick, this));\r\n\t},\r\n\t\r\n\t_doExpandBtnClick: function(){\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tvar fsBody = jqEl.find('.jl-fieldset-body');\r\n\t\tif (!Z._collapsed){\r\n\t\t\tfsBody.slideUp();\r\n\t\t\tjqEl.addClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').addClass('fa-chevron-circle-down');\r\n\t\t}else{\r\n\t\t\tfsBody.slideDown();\r\n\t\t\tjqEl.removeClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').removeClass('fa-chevron-circle-down');\r\n\t\t}\r\n\t\tfsBody[0].focus();\r\n\t\tZ._collapsed = !Z._collapsed;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('input.jl-fieldset-btn').off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('FieldSet', jslet.ui.FieldSet);\r\njslet.ui.FieldSet.htmlTemplate = '<fieldset></fieldset>';\r\n\njslet.ui.menuManager = {};\r\n/*\r\n * Global menu id collection, array of string\r\n */\r\njslet.ui.menuManager._menus = [];\r\n\r\n/*\r\n * Register menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.register = function (menuid) {\r\n\tjslet.ui.menuManager._menus.push(menuid);\r\n};\r\n\r\n/*\r\n * Unregister menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.unregister = function (menuid) {\r\n\tfor (var i = 0, len = this._menus.length; i < len; i++) {\r\n\t\tjslet.ui.menuManager._menus.splice(i, 1);\r\n\t}\r\n};\r\n\r\n/*\r\n * Hide all menu item.\r\n */\r\njslet.ui.menuManager.hideAll = function (event) {\r\n\tvar id, menu, menus = jslet.ui.menuManager._menus;\r\n\tfor (var i = 0, len = menus.length; i < len; i++) {\r\n\t\tid = menus[i];\r\n\t\tmenu = jslet('#'+id);\r\n\t\tif (menu) {\r\n\t\t\tmenu.hide();\r\n\t\t}\r\n\t}\r\n\tjslet.ui.menuManager.menuBarShown = false;\r\n\tjslet.ui.menuManager._contextObject = null;\r\n};\r\n\r\njQuery(document).on('mousedown', jslet.ui.menuManager.hideAll);\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * MenuBar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'MenuBar', onItemClick: globalMenuItemClick, items: [\r\n *       {name: 'File', items: [\r\n *         {id: 'new', name: 'New Tab', iconClass: 'icon1' }]\r\n *       }]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id='ctrlId' />\r\n *      //js snippet:\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.MenuBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,onItemClick,items';\r\n\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {MouseEvent} items.onClick.event Mouse event.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} items.items Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tif(!items) {\r\n\t\t\tthis._items = null;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('MenuBar.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-menubar')) {\r\n\t\t\tjqEl.addClass('jl-menubar jl-unselectable jl-round5');\r\n\t\t}\r\n\r\n\t\tthis.renderAll();\r\n\t\tjqEl.on('mouseout',function (event) {\r\n\t\t\tif (Z._preHoverItem && !jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-menubar-item').off();\r\n\t\tthis._createMenuBar();\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be disabled/enabled.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} disabled True - the menu item is disabled, otherwise it's enabled.\r\n\t */\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setDisabled(menuId, disabled);\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be checked or non-checked.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} checked True - the menu item is checked, otherwise it's non-checked.\r\n\t */\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setChecked(menuId, checked);\r\n\t},\r\n\t\r\n\t_createMenuBar: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.isPopup || !Z._items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (var i = 0, cnt = Z._items.length, item; i < cnt; i++) {\r\n\t\t\titem = Z._items[i];\r\n\t\t\tZ._createBarItem(Z.el, item, Z._menubarclick);\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (omi) {\r\n\t\tvar Z = omi.parentNode.jslet,\r\n\t\t\titemCfg = omi.jsletvar;\r\n\t\tif (!itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!itemCfg.subMenu) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items });\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body),\r\n\t\t\tbodyMTop = parseInt(jqBody.css('margin-top')),\r\n\t\t\tbodyMleft = parseInt(jqBody.css('margin-left')),\r\n\t\t\tjqMi = jQuery(omi), \r\n\t\t\tpos = jqMi.offset(), \r\n\t\t\tposX = pos.left;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tposX +=  jqMi.width() + 10;\r\n\t\t}\r\n\t\titemCfg.subMenu.show(posX, pos.top + jqMi.height());\r\n\t\tjslet.ui.menuManager.menuBarShown = true;\r\n\t\tZ._activeMenuItem = omi;\r\n\t\t// this.parentNode.parentNode.jslet.ui._createMenuPopup(cfg);\r\n\t},\r\n\r\n\t_createBarItem: function (obar, itemCfg) {\r\n\t\tif (itemCfg.visible !== undefined && !itemCfg.visible) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar omi = document.createElement('div');\r\n\t\tjQuery(omi).addClass('jl-menubar-item');\r\n\t\tomi.jsletvar = itemCfg;\r\n\t\tvar Z = this, jqMi = jQuery(omi);\r\n\t\tjqMi.on('click',function (event) {\r\n\t\t\tvar cfg = this.jsletvar;\r\n\t\t\tif(!cfg.items) {\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\tif (cfg.onClick) {\r\n\t\t\t\t\tcfg.onClick.call(Z, cfg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (Z._onItemClick)\r\n\t\t\t\t\t\tZ._onItemClick.call(Z, cfg);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//\t\t\t\tif (Z._activeMenuItem != this || jslet.ui.menuManager.menuBarShown)\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t}\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tjQuery(this).addClass('jl-menubar-item-hover');\r\n\t\t\tif (jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<a class=\"jl-focusable-item\" href=\"javascript:void(0)\">');\r\n\t\ttemplate.push(itemCfg.name);\r\n\t\ttemplate.push('</a>');\r\n\t\t\r\n\t\tomi.innerHTML = template.join('');\r\n\t\tobar.appendChild(omi);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tZ._activeMenuItem = null;\r\n\t\tZ._preHoverItem = null;\r\n\t\tZ._menubarclick = null;\r\n\t\tZ._onItemClick = null;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menubar-item').off();\r\n\t\tjqEl.find('.jl-menubar-item').each(function(){\r\n\t\t\tvar omi = this;\r\n\t\t\tif (omi.jsletvar){\r\n\t\t\t\tomi.jsletvar.subMenu = null;\r\n\t\t\t\tomi.jsletvar = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('MenuBar', jslet.ui.MenuBar);\r\njslet.ui.MenuBar.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Menu. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'Menu', onItemClick: globalMenuItemClick, items: [\r\n *       {id: 'back', name: 'Backward', iconClass: 'icon1' },\r\n *       {id: 'go', name: 'Forward', disabled: true },\r\n *       {name: '-' }]};\r\n *\r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *       <div id='menu1' />\r\n *       //js snippet:\r\n *       var el = document.getElementById('menu1');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n *       //Use the below code to show context menu\r\n *       jslet('#ctrlId').showContextMenu(event);\r\n *       //Show menu at the specified position\r\n *       jslet('#ctrlId').show(left, top);\r\n * \r\n */\r\njslet.ui.Menu = jslet.Class.create(jslet.ui.Control, {\r\n\t_onItemClick: undefined,\r\n\t_items:undefined,\r\n\t_invoker: null,\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'onItemClick,items,invoker'; //'invoker' is used for inner\r\n\t\t//items is an array, menu item's properties: id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items\r\n\t\t$super(el, params);\r\n\t\tZ._activeSubMenu = null;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {MouseEvent} items.onClick.event Mouse event.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Menu.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tinvoker: function(invoker) {\r\n\t\tif(invoker === undefined) {\r\n\t\t\treturn this._invoker;\r\n\t\t}\r\n\t\tthis._invoker = invoker;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tele = Z.el;\r\n\t\tif (!jqEl.hasClass('jl-menu')) {\r\n\t\t\tjqEl.addClass('jl-menu');\r\n\t\t}\r\n\t\tele.style.display = 'none';\r\n\r\n\t\tif (!ele.id) {\r\n\t\t\tele.id = jslet.nextId();\r\n\t\t}\r\n\r\n\t\tjslet.ui.menuManager.register(ele.id);\r\n\t\tZ._createMenuPopup();\r\n\t\tjqEl.on('mousedown',function (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseover', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\tif (jslet.ui.menuManager.timerId) {\r\n\t\t\t\twindow.clearTimeout(jslet.ui.menuManager.timerId);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseout', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = false;\r\n\t\t\tjslet.ui.menuManager.timerId = window.setTimeout(function () {\r\n\t\t\t\tif (!jslet.ui.menuManager._inPopupMenu) {\r\n\t\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\t}\r\n\t\t\t\tjslet.ui.menuManager.timerId = null;\r\n\t\t\t}, 800);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be disabled/enabled.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} disabled True - the menu item is disabled, otherwise it's enabled.\r\n\t */\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setDisabled(menuId, disabled);\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be checked or non-checked.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} checked True - the menu item is checked, otherwise it's non-checked.\r\n\t */\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setChecked(menuId, checked);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show menu at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\twidth = jqEl.outerWidth(),\r\n\t\t\theight = jqEl.outerHeight(),\r\n\t\t\tjqWin = jQuery(window),\r\n\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\twinHeight = jqWin.scrollTop() + jqWin.height();\r\n\t\t\t\r\n\t\tleft = left || Z.left || 10;\r\n\t\ttop = top || Z.top || 10;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tleft -= width;\r\n\t\t}\r\n\t\tif(left + width > winWidth) {\r\n\t\t\tleft += winWidth - left - width - 1;\r\n\t\t}\r\n\t\tif(top + height > winHeight) {\r\n\t\t\ttop += winHeight - top - height - 1;\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 0;\r\n\t\t}\r\n\t\tZ.el.style.left = left + 'px';\r\n\t\tZ.el.style.top = parseInt(top) + 'px';\r\n\t\tZ.el.style.display = 'block';\r\n\t\tif (!Z.shadow) {\r\n\t\t\tZ.shadow = document.createElement('div');\r\n\t\t\tjQuery(Z.shadow).addClass('jl-menu-shadow');\r\n\t\t\tZ.shadow.style.width = width + 'px';\r\n\t\t\tZ.shadow.style.height = height + 'px';\r\n\t\t\tdocument.body.appendChild(Z.shadow);\r\n\t\t}\r\n\t\tZ.shadow.style.left = left + 1 + 'px';\r\n\t\tZ.shadow.style.top = top + 1 + 'px';\r\n\t\tZ.shadow.style.display = 'block';\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu at the position which specifed by a HTML element. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menuObj.showAt('#btn1'); //\r\n\t *     menuObj.showAt(document.getElementById('btn1'));\r\n\t * \r\n\t * @param {String | HtmlElement} hostEl Host HTML element or jQuery query string.\r\n\t */\r\n\tshowAt: function(hostEl) {\r\n\t\tvar jqHost = jQuery(hostEl);\r\n\t\tif(jqHost.length === 0) {\r\n\t\t\tthrow new Error('Host control NOT found When showing menu, check it first!');\r\n\t\t}\r\n\t\tvar offset = jqHost.offset();\r\n\t\tthis.show(offset.left, offset.top + jqHost.outerHeight());\r\n\t},\r\n\t\r\n\t/**\r\n\t * Hide menu item and all its sub menu item.\r\n\t */\r\n\thide: function () {\r\n\t\tthis.ctxElement = null;\r\n\t\tthis.el.style.display = 'none';\r\n\t\tif (this.shadow) {\r\n\t\t\tthis.shadow.style.display = 'none';\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu on context menu. Example:\r\n\t * \r\n\t *     @example\r\n\t *     //Html\r\n\t *     <div id=\"popmenu\" oncontextmenu=\"popMenu(event);\">\r\n\t *     //Js\r\n\t *\t   function popMenu(event) {\r\n\t *\t     jslet(\"#popmenu\").showContextMenu(event);\r\n\t *     }\r\n\t */\r\n\tshowContextMenu: function (event, contextObj) {\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tjslet.ui.menuManager._contextObject = contextObj;\r\n\t\tthis.show(event.pageX, event.pageY);\r\n\t\tevent.preventDefault();\r\n\t},\r\n\r\n\t_createMenuPopup: function () {\r\n\t\tvar panel = this.el,\r\n\t\t\titems = this._items, itemCfg, name, i, cnt;\r\n\t\tcnt = items.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\titemCfg = items[i];\r\n\t\t\tif (!itemCfg.name) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tname = itemCfg.name.trim();\r\n\t\t\tif (name != '-') {\r\n\t\t\t\tthis._createMenuItem(panel, itemCfg);\r\n\t\t\t} else {\r\n\t\t\t\tthis._createLine(panel, itemCfg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdocument.body.appendChild(panel);\r\n\t},\r\n\r\n\t_ItemClick: function (sender, cfg) {\r\n\t\t//has sub menu items\r\n\t\tif (cfg.items) {\r\n\t\t\tthis._showSubMenu(sender, cfg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (cfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\t\tif (cfg.itemType == 'check' || cfg.itemType == 'radio') {\r\n\t\t\tthis.setChecked(sender.id, !cfg.checked);\r\n\t\t}\r\n\t\tvar contextObj = jslet.ui.menuManager._contextObject || this;\r\n\t\tif (cfg.onClick) {\r\n\t\t\tcfg.onClick.call(contextObj, cfg);\r\n\t\t} else {\r\n\t\t\tif (this._onItemClick) {\r\n\t\t\t\tthis._onItemClick.call(contextObj, cfg);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_hideSubMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._activeSubMenu) {\r\n\t\t\tZ._activeSubMenu._hideSubMenu();\r\n\t\t\tZ._activeSubMenu.hide();\r\n\t\t\tZ._activeSubMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex'));\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (sender, cfg, delayTime) {\r\n\t\tvar Z = this;\r\n\t\tvar func = function () {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tif (!cfg.subMenu) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqPmi = jQuery(sender),\r\n\t\t\t\tpos = jqPmi.offset(), \r\n\t\t\t\tx = pos.left;\r\n\t\t\tif (!jsletlocale.isRtl) {\r\n\t\t\t\tx += jqPmi.width();\r\n\t\t\t}\r\n\r\n\t\t\tcfg.subMenu.show(x - 2, pos.top);\r\n\t\t\tcfg.subMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex')) + 1;\r\n\t\t\tZ._activeSubMenu = cfg.subMenu;\r\n\t\t};\r\n\t\tif (delayTime) {\r\n\t\t\twindow.setTimeout(func, delayTime);\r\n\t\t} else {\r\n\t\t\tfunc();\r\n\t\t}\r\n\t},\r\n\r\n\t_ItemOver: function (sender, cfg) {\r\n\t\tif (this._activeSubMenu) {\r\n\t\t\tthis._showSubMenu(sender, cfg, 200);\r\n\t\t}\r\n\t},\r\n\r\n\t_createMenuItem: function (container, itemCfg, defaultClickHandler) {\r\n\t\t//id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items,subMenuId\r\n\t\tvar isCheckBox = false, \r\n\t\t\tisRadioBox = false,\r\n\t\t\titemType = itemCfg.itemType;\r\n\t\tif (itemType) {\r\n\t\t\tisCheckBox = (itemType == 'check');\r\n\t\t\tisRadioBox = (itemType == 'radio');\r\n\t\t}\r\n\t\tif (isCheckBox) {\r\n\t\t\titemCfg.iconClass = 'fa fa-check';//'jl-menu-check';\r\n\t\t}\r\n\t\tif (isRadioBox) {\r\n\t\t\titemCfg.iconClass = 'fa fa-circle'; //kjl-menu-radio';\r\n\t\t}\r\n\t\tif (itemCfg.items) {\r\n\t\t\titemCfg.disabled = false;\r\n\t\t}\r\n\t\tvar mi = document.createElement('div'), Z = this, jqMi = jQuery(mi);\r\n\t\tjqMi.addClass('jl-menu-item ' + (itemCfg.disabled ? 'jl-menu-disabled' : ''));\r\n\r\n\t\tif (!itemCfg.id) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tmi.id = itemCfg.id;\r\n\t\tmi.jsletvar = itemCfg;\r\n\t\tjqMi.on('click', function (event) {\r\n\t\t\tZ._ItemClick(this, this.jsletvar);\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tZ._ItemOver(this, this.jsletvar);\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tif (!this.jsletvar.disabled) {\r\n\t\t\t\tjQuery(this).addClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseout', function (event) {\r\n\t\t\tif (!this.jsletvar.subMenu) {\r\n\t\t\t\tjQuery(this).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<span class=\"jl-menu-icon-placeholder ');\r\n\t\tif ((isCheckBox || isRadioBox) && !itemCfg.checked) {\r\n\t\t\t//Empty \r\n\t\t} else {\r\n\t\t\tif (itemCfg.iconClass) {\r\n\t\t\t\ttemplate.push((!itemCfg.disabled || !itemCfg.disabledIconClass) ? itemCfg.iconClass : itemCfg.disabledIconClass);\r\n\t\t\t}\r\n\t\t}\r\n\t\ttemplate.push('\"></span>');\r\n\r\n\t\tif (itemCfg.items) {\r\n\t\t\ttemplate.push('<div class=\"jl-menu-arrow\"><i class=\"fa fa-caret-right\" aria-hidden=\"true\"></i></div>');\r\n\t\t}\r\n\r\n\t\ttemplate.push('<a  href=\"javascript:void(0)\" class=\"jl-focusable-item jl-menu-content ');\r\n\t\ttemplate.push(' jl-menu-content-left jl-menu-content-right');\r\n\t\ttemplate.push('\">');\r\n\t\ttemplate.push(itemCfg.name + \"&nbsp;&nbsp;&nbsp;&nbsp;\");\r\n\t\ttemplate.push('</a>');\r\n\t\tmi.innerHTML = template.join('');\r\n\t\tcontainer.appendChild(mi);\r\n\t\tif (itemCfg.items) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items, invoker: mi });\r\n\t\t}\r\n\t},\r\n\r\n\t_createLine: function (container, itemCfg) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\tjQuery(odiv).addClass('jl-menu-line');\r\n\t\tcontainer.appendChild(odiv);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._activeSubMenu = null;\r\n\t\tjslet.ui.menuManager.unregister(Z.el.id);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menu-item').each(function(){\r\n\t\t\tthis.onmouseover = null;\r\n\t\t\tthis.onclick = null;\r\n\t\t\tthis.onmouseout = null;\r\n\t\t});\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Menu', jslet.ui.Menu);\r\njslet.ui.Menu.htmlTemplate = '<div></div>';\r\n\r\n\r\njslet.ui.Menu.Operator = function(menuObj) {\r\n\tthis._menuObj = menuObj;\r\n};\r\n\r\njslet.ui.Menu.Operator.prototype = {\r\n\tgetMenuItemById: function(id) {\r\n\t\tjslet.Checker.test('getMenuItemById#id', id).required().isString();\r\n\t\t\r\n\t\tfunction getItem(items, id) {\r\n\t\t\tvar item, itemObj;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif(item.id === id) {\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.items) {\r\n\t\t\t\t\titem = getItem(item.items, id);\r\n\t\t\t\t\tif(item) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar items = this._menuObj.items();\r\n\t\tif(!items) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn getItem(items, id);\r\n\t},\r\n\t\t\r\n\tgetMenuGroup: function(id, excludeSelf) {\r\n\t\tjslet.Checker.test('getMenuGroup#id', id).required().isString();\r\n\t\t\r\n\t\tfunction getItemGroup(items, id) {\r\n\t\t\tvar item, itemObj;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif(item.id === id && item.itemType === 'radio') {\r\n\t\t\t\t\tvar groupName = item.group,\r\n\t\t\t\t\t\tresult = [], itemCfg;\r\n\t\t\t\t\tfor(var j = 0, size = items.length; j < size; j++) {\r\n\t\t\t\t\t\titemCfg = items[j];\r\n\t\t\t\t\t\tif(excludeSelf && itemCfg.id === id) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(itemCfg.itemType === 'radio' && itemCfg.group === groupName) {\r\n\t\t\t\t\t\t\tresult.push(itemCfg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.items) {\r\n\t\t\t\t\tvar groupItems = getItemGroup(item.items, id);\r\n\t\t\t\t\tif(groupItems) {\r\n\t\t\t\t\t\treturn groupItems;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar items = this._menuObj.items();\r\n\t\tif(!items) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn getItemGroup(items, id);\r\n\t},\r\n\t\t\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar itemCfg = this.getMenuItemById(menuId);\r\n\t\titemCfg.disabled = disabled? true: false;\r\n\t\tif (itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqMi = jQuery('#'+menuId);\r\n\t\tif(jqMi.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (disabled) {\r\n\t\t\tjqMi.removeClass('jl-menu-enabled');\r\n\t\t\tjqMi.addClass('jl-menu-disabled');\r\n\t\t} else {\r\n\t\t\tjqMi.removeClass('jl-menu-disabled');\r\n\t\t\tjqMi.addClass('jl-menu-enabled');\r\n\t\t}\r\n\t},\r\n\t\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar itemCfg = this.getMenuItemById(menuId);\r\n\t\tvar itemType = itemCfg.itemType;\r\n\t\tchecked = itemType === 'radio'? true: checked; //Radio menu item can not be unchecked.\r\n\t\tif (itemCfg.disabled || itemType != 'check' && itemType != 'radio' || itemCfg.checked == checked) {\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.checked = checked;\r\n\t\tvar changedCfg = [itemCfg], i, len;\r\n\t\tif(itemType == 'radio') {\r\n\t\t\tvar otherGroups = this.getMenuGroup(menuId, true);\r\n\t\t\tfor(i = 0, len = otherGroups.length; i < len; i++) {\r\n\t\t\t\titemCfg = otherGroups[i];\r\n\t\t\t\tif(itemCfg.checked) {\r\n\t\t\t\t\titemCfg.checked = false;\r\n\t\t\t\t\tchangedCfg.push(itemCfg);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqIcon;\r\n\t\tfor(i = 0, len = changedCfg.length; i < len; i++) {\r\n\t\t\titemCfg = changedCfg[i];\r\n\t\t\tjqIcon = jQuery('#'+itemCfg.id).find('.jl-menu-icon-placeholder');\r\n\t\t\tif (itemCfg.checked) {\r\n\t\t\t\tjqIcon.addClass(itemCfg.iconClass);\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass(itemCfg.iconClass);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Side menu bar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'SideMenuBar', onItemClick: globalMenuItemClick, items: [\r\n *       {name: 'File', items: [\r\n *         {id: 'new', name: 'New Tab', iconClass: 'icon1' }]\r\n *       }]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id='ctrlId' />\r\n *      //js snippet:\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.SideMenuBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,hasSubTitle,onItemClick,items,popupWidth';\r\n\r\n\t\tZ._hasSubTitle = true;\r\n\t\t\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\tZ._popupWidth = null;\r\n\t\t\r\n\t\tZ._containerId = null;\r\n\t\t\r\n\t\tZ._closeTimeout = null;\r\n\t\tZ._showTimeout = null;\r\n\t\t\r\n\t\tZ.oldHeight = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify to show sub-menu title or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSubTitle True - show sub menu title, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSubTitle: function(hasSubTitle) {\r\n\t\tif(hasSubTitle === undefined) {\r\n\t\t\treturn this._hasSubTitle;\r\n\t\t}\r\n\t\tthis._hasSubTitle = hasSubTitle? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} items.items Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tif(!items) {\r\n\t\t\tthis._items = null;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('SideMenuBar.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t\tif(!Z.el.id) {\r\n\t\t\tZ.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-sidemenubar')) {\r\n\t\t\tjqEl.addClass('jl-sidemenubar jl-unselectable jl-round4');\r\n\t\t}\r\n\t\tjqEl.on('mouseenter', '.jl-smb-baritem', function(event) {\r\n\t\t\tZ._clearShowTimeout();\r\n\t\t\tZ._clearCloseTimeout();\r\n\t\t\tvar omi = event.currentTarget;\r\n\t\t\tZ._showTimeout = window.setTimeout(function() {\r\n\t\t\t\tZ._showSubMenu(omi);\r\n\t\t\t}, 100);\r\n\t\t});\r\n\t\tjqEl.on('mouseleave', function() {\r\n\t\t\tZ._doMouseLeave();\r\n\t\t});\r\n\t\tvar containerId = Z.el.id + '_panel';\r\n\t\tZ._containerId = containerId;\r\n\t\tvar container = document.getElementById(containerId);\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(container);\r\n\t\t\tcontainer.id = containerId;\r\n\t\t\tcontainer.className = 'jl-smb-popup';\r\n\t\t\tjQuery(container).on('mouseleave', function() {\r\n\t\t\t\tZ._doMouseLeave();\r\n\t\t\t}).on('mouseenter', function() {\r\n\t\t\t\tZ._doMouseEnter();\r\n\t\t\t}).on('click', '.jl-smb-item', function(event) {\r\n\t\t\t\tZ._doMenuClick(event.currentTarget);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContainer = jQuery('#' + Z._containerId);\r\n\t\tjqEl.find('.jl-smb-up').off();\r\n\t\tjqEl.find('.jl-smb-down').off();\r\n\t\tjqContainer.html('<span class=\"jl-smb-box\"></span>');\r\n\t\tif(Z._popupWidth) {\r\n\t\t\tjqContainer.css('width', Z._popupWidth + 'px');\r\n\t\t}\r\n\t\tZ._itemHeight = parseFloat(jslet.ui.getCssValue('jl-smb-baritem', 'height'));\r\n\r\n\t\tvar html = '';\r\n\t\thtml += '<div class=\"jl-smb-up\"><a href=\"javascript:void(0)\"><i class=\"fa fa-chevron-up\"></i></a></div>';\r\n\t\thtml += '<div class=\"jl-smb-items\"><ul class=\"jl-smb-ul\">';\r\n\t\tvar items = Z._items || [];\r\n\t\tfor (var i = 0, cnt = items.length, item; i < cnt; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tif(item.id === null || item.id === undefined) {\r\n\t\t\t\titem.id = jslet.nextId();\r\n\t\t\t}\r\n\t\t\tif(!item.items || item.items.length === 0) {\r\n\t\t\t\tconsole.warn('Menu item: ' + item.name + ' does not have items!');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\thtml += '<li><a class=\"jl-smb-baritem\" id=\"' + item.id + '\" href=\"javascript:void(0)\">';\r\n\t\t\thtml += '<i class=\"jl-smb-icon ' + (item.iconClass || 'jl-hidden') + '\"></i>';\r\n\t\t\thtml += '<span>' + item.name + '</span><i class=\"jl-smb-arrow fa fa-chevron-right\"></i>';\r\n\t\t\thtml += '</a></li>';\r\n\t\t\tZ._createMenuItem(jqContainer, item.id, item.items);\r\n\t\t}\r\n\t\thtml += '<li class=\"jl-smb-lastbaritem\"></li></ul></div>';\r\n\t\thtml += '<div class=\"jl-smb-down\"><a href=\"javascript:void(0)\"><i class=\"fa fa-chevron-down\"></i></a></div>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.find('.jl-smb-up').on('click', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tjqEl.find('.jl-smb-down').show();\r\n\t\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\t\tvar scrTop = jqItems.scrollTop();\r\n\t\t\tscrTop -= Z._itemHeight;\r\n\t\t\tif(scrTop <= 0) {\r\n\t\t\t\tjQuery(this).hide();\r\n\t\t\t}\r\n\t\t\tjqItems.scrollTop(scrTop);\r\n\t\t}).on('mouseenter', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t});\r\n\t\tjqEl.find('.jl-smb-down').on('click', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tjqEl.find('.jl-smb-up').show();\r\n\t\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\t\tvar scrTop = jqItems.scrollTop() + Z._itemHeight;\r\n\t\t\tvar maxScrTop = jqItems[0].scrollHeight - jqItems.innerHeight();\r\n\t\t\tif(scrTop > maxScrTop) {\r\n\t\t\t\tjQuery(this).hide();\r\n\t\t\t}\r\n\t\t\tjqItems.scrollTop(scrTop);\r\n\t\t}).on('mouseenter', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t});\r\n\t\tZ.resize();\r\n\t},\r\n\r\n\tcollapse: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-smb-baritem > .jl-smb-arrow').hide();\r\n\t\tjqEl.find('.jl-smb-baritem > span').hide();\r\n\t},\r\n\t\r\n\texpand: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-smb-baritem > .jl-smb-arrow').show();\r\n\t\tjqEl.find('.jl-smb-baritem > span').show();\r\n\t},\r\n\t\r\n\t_clearShowTimeout: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._showTimeout) {\r\n\t\t\twindow.clearTimeout(Z._showTimeout);\r\n\t\t\tZ._showTimeout = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_clearCloseTimeout: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._closeTimeout) {\r\n\t\t\twindow.clearTimeout(Z._closeTimeout);\r\n\t\t\tZ._closeTimeout = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getItemById: function(items, id, isFirstLevel) {\r\n\t\tvar Z = this, itemCfg;\r\n\t\tfor(var i = 0, cnt = items.length; i < cnt; i++) {\r\n\t\t\titemCfg = items[i]; \r\n\t\t\tif(itemCfg.id === id) {\r\n\t\t\t\treturn itemCfg;\r\n\t\t\t}\r\n\t\t\tif(!isFirstLevel && itemCfg.items) {\r\n\t\t\t\titemCfg = Z._getItemById(itemCfg.items, id);\r\n\t\t\t\tif(itemCfg) {\r\n\t\t\t\t\treturn itemCfg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_createMenuItem: function(jqContainer, id, items) {\r\n\t\tvar Z = this;\r\n\t\tvar html = Z._innerCreateMenuItem(id, items, 0);\r\n\t\tjqContainer.append(html);\r\n\t},\r\n\t\r\n\t_innerCreateMenuItem: function(id, items, level) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction getMenuItems(menuItems, result) {\r\n\t\t\tvar itemCfg;\r\n\t\t\tfor(var k = 0, len = menuItems.length; k < len; k++) {\r\n\t\t\t\titemCfg = menuItems[k];\r\n\t\t\t\tif(itemCfg.items) {\r\n\t\t\t\t\tgetMenuItems(itemCfg.items, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(itemCfg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar groups = [], group = null, groupItems, menuName, menuItems, itemCfg;\r\n\t\tfor (var i = 0, cnt = items.length - 1; i <= cnt; i++) {\r\n\t\t\titemCfg = items[i];\r\n\t\t\tif(itemCfg.items) {\r\n\t\t\t\tmenuItems = [];\r\n\t\t\t\tgetMenuItems(itemCfg.items, menuItems);\r\n\t\t\t\tgroups.push({id: itemCfg.id || jslet.nextId(), name: itemCfg.name, items: menuItems});\r\n\t\t\t\tgroup = null;\r\n\t\t\t} else {\r\n\t\t\t\tif(group === null) {\r\n\t\t\t\t\tgroupItems = [];\r\n\t\t\t\t\tgroup = {id: jslet.nextId(), items: groupItems, isLine: true};\r\n\t\t\t\t\tgroups.push(group);\r\n\t\t\t\t}\r\n\t\t\t\tmenuName = jQuery.trim(itemCfg.name);\r\n\t\t\t\tif(menuName === '-') {\r\n\t\t\t\t\tgroup = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tgroupItems.push(itemCfg);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar html = '<ul id=\"' + id +'_popup\" class=\"jl-smb-popup-ul ' + (level === 0? 'jl-hidden': '') + '\">';\r\n\t\tfor(var j = 0, grpCnt = groups.length - 1; j <= grpCnt; j++) {\r\n\t\t\tgroup = groups[j];\r\n\t\t\tmenuName = jQuery.trim(group.name);\r\n\t\t\thtml += '<li class=\"jl-smb-group' + (j < grpCnt? ' jl-smb-line': '') + '\">';\r\n\t\t\tif(!group.isLine) {\r\n\t\t\t\tif(Z._hasSubTitle && menuName) {\r\n\t\t\t\t\thtml += '<div class=\"jl-smb-subtitle\">' + menuName + '</div>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thtml += '<ul id=\"' + group.id +'_popup\" class=\"jl-smb-popup-ul\">';\r\n\t\t\tgroupItems = group.items;\r\n\t\t\tfor (i = 0, cnt = groupItems.length - 1; i <= cnt; i++) {\r\n\t\t\t\titemCfg = groupItems[i];\r\n\t\t\t\tid = itemCfg.id;\r\n\t\t\t\tif(!id && id !== 0) {\r\n\t\t\t\t\tid = jslet.nextId();\r\n\t\t\t\t\titemCfg.id = id;\r\n\t\t\t\t}\r\n\t\t\t\tmenuName = jQuery.trim(itemCfg.name);\r\n\t\t\t\thtml += '<li>';\r\n\t\t\t\thtml += '<a id=\"' + id + '\" class=\"jl-smb-item' + (itemCfg.disabled ? ' jl-smb-disabled': '') +\r\n\t\t\t\t  '\" href=\"javascript:void(0)\">';\r\n\t\t\t\thtml += '<span class=\"jl-smb-popup-icon ' + (itemCfg.iconClass || '') + '\"></span>' + menuName + '</a>';\r\n\t\t\t\thtml += '</li>';\r\n\t\t\t} //End for i\r\n\t\t\thtml += '</ul>';\r\n\t\t\thtml += '</li>';\r\n\t\t} //End for j\r\n\t\thtml += '</ul>';\r\n\t\treturn html;\r\n\t},\r\n\t\r\n\t_hideSubMenu: function() {\r\n\t\tthis._clearShowTimeout();\r\n\t\tjQuery('#' + this._containerId).hide();\r\n\t},\r\n\t\r\n\t_showSubMenu: function (omi) {\r\n\t\tvar Z = this,\r\n\t\t\titemCfg = Z._getItemById(Z._items, omi.id, true);\r\n\t\tif (!itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar jqPopupContainer = jQuery('#' + Z._containerId);\r\n\t\tjqPopupContainer.children().each(function(index) {\r\n\t\t\tvar jqItem = jQuery(this);\r\n\t\t\tif(jqItem.hasClass('jl-smb-box')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar isHidden = jqItem.hasClass('jl-hidden');\r\n\t\t\tif(this.id !== itemCfg.id + '_popup') {\r\n\t\t\t\tif(!isHidden) {\r\n\t\t\t\t\tjqItem.addClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(isHidden) {\r\n\t\t\t\t\tjqItem.removeClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar jqMi = jQuery(omi), \r\n\t\t\tpos = jqMi.offset(), \r\n\t\t\tposX = pos.left + jqMi.width() + 2,\r\n\t\t\tposY = pos.top;\r\n\t\tvar delta = pos.top + jqPopupContainer.outerHeight() - jQuery(window).innerHeight() - document.body.scrollTop;\r\n\t\tvar jqBox = jqPopupContainer.find('.jl-smb-box');\r\n\t\tif(delta > 0) {\r\n\t\t\tposY = posY - delta;\r\n\t\t\tjqBox.css('top', delta +'px');\r\n\t\t} else {\r\n\t\t\tjqBox.css('top', '0');\r\n\t\t}\r\n\t\tjqPopupContainer.show();\r\n\t\tjqPopupContainer.offset({left: posX, top: posY - 1});\r\n\t},\r\n\r\n\t_doMouseEnter: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._clearCloseTimeout();\r\n\t},\r\n\t\r\n\t_doMouseLeave: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._closeTimeout = window.setTimeout(function() {\r\n\t\t\twindow.clearTimeout(Z._closeTimeout);\r\n\t\t\tZ._closeTimeout = null;\r\n\t\t\tZ._hideSubMenu();\r\n\t\t}, 200);\r\n\t},\r\n\t\r\n\t_doMenuClick: function(omi) {\r\n\t\tvar Z = this,\r\n\t\t\titemCfg = Z._getItemById(Z._items, omi.id);\r\n\t\tif (itemCfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hideSubMenu();\r\n\t\tif(itemCfg.onClick) {\r\n\t\t\titemCfg.onClick(itemCfg);\r\n\t\t}\r\n\t\tif(Z._onItemClick) {\r\n\t\t\tZ._onItemClick(itemCfg);\r\n\t\t}\r\n\t},\r\n\t\r\n\tresize: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\theight = jqEl.height();\r\n\t\tif (height === Z.oldHeight){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.oldHeight = height;\r\n\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\tjqItems.height(height);\r\n\t\tvar containerHeight = jqItems.innerHeight();\r\n\t\tif(jqItems[0].scrollHeight <= containerHeight) {\r\n\t\t\tjqEl.find('.jl-smb-up').hide();\r\n\t\t\tjqEl.find('.jl-smb-down').hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(jqItems.scrollTop() > 0) {\r\n\t\t\tjqEl.find('.jl-smb-up').show();\r\n\t\t}\r\n\t\tjqEl.find('.jl-smb-down').show();\r\n\t\tvar visiCnt = Math.floor(containerHeight / Z._itemHeight);\r\n\t\tvar lastItemH = containerHeight - visiCnt * Z._itemHeight;\r\n\t\tjqEl.find('.jl-smb-lastbaritem').css('height', lastItemH + 'px');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tthis.resize();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._activeMenuItem = null;\r\n\t\tZ._preHoverItem = null;\r\n\t\tZ._menubarclick = null;\r\n\t\tZ._onItemClick = null;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\tjQuery('#' + Z._containerId).off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('SideMenuBar', jslet.ui.SideMenuBar);\r\njslet.ui.SideMenuBar.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Split Panel. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"SplitPanel\",direction:\"hori\",floatIndex: 1};\r\n *     //1. Binding:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *     \r\n *     //2. Binding on fly\r\n *       <div id='ctrlId'>\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *     //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.SplitPanel = jslet.Class.create(jslet.ui.Control, {\r\n\tdirections: ['hori', 'vert'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,direction,floatIndex,onExpanded,onResize';\r\n\r\n\t\tZ._direction = 'hori';\r\n\r\n\t\tZ._floatIndex = 1;\r\n\t\t\r\n\t\tZ._onExpanded = null;\r\n\t\t\r\n\t\tZ._onResize = null;\r\n\t\t\r\n\t\tZ.panels = null; //Array, panel configuration, {size:100, maxSize: 100, minSize:10}\r\n\r\n\t\tZ._oldSize = 0;\r\n\t\t\r\n\t\tZ._oldHeight = 0;\r\n\t\t\r\n\t\tZ._oldWidth = 0;\r\n\t\t\r\n\t\tZ._changeFloatSizeDebounce = jslet.debounce(Z._changeFloatSize, 110);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get float panel index, only one panel can be a floating panel.\r\n\t * \r\n\t * @param {Integer | undefined} index float panel index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfloatIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._floatIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.floatIndex', index).isGTEZero();\r\n\t\tthis._floatIndex = index;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get Split direction, optional value: 'hori', 'vert'. Default value is 'hori'\r\n\t * \r\n\t * @param {String | undefined} direction optional value: 'hori', 'vert'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdirection: function(direction) {\r\n\t\tif(direction === undefined) {\r\n\t\t\treturn this._direction;\r\n\t\t}\r\n\t\tdirection = jQuery.trim(direction);\r\n\t\tvar checker = jslet.Checker.test('SplitPanel.direction', direction).required().isString();\r\n\t\tdirection = direction.toLowerCase();\r\n\t\tchecker.inArray(this.directions);\r\n\t\tthis._direction = direction;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user expand/collapse one panel.. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.onExpanded(function(panelIndex){}); \r\n\t *\r\n\t * @param {Function | undefined} onExpanded Expanded event handler.\r\n\t * @param {Integer} onExpanded.panelIndex The changing panel index.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonExpanded: function(onExpanded) {\r\n\t\tif(onExpanded === undefined) {\r\n\t\t\treturn this._onExpanded;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onExpanded', onExpanded).isFunction();\r\n\t\tthis._onExpanded = onExpanded;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after user change size of one panel. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.onResize(function(panelIndex, newSize){}); \r\n\t *\r\n\t * @param {Function | undefined} onResize Resize event handler.\r\n\t * @param {Integer} onResize.panelElement The changing panel element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonResize: function(onResize) {\r\n\t\tif(onResize === undefined) {\r\n\t\t\treturn this._onResize;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onResize', onResize).isFunction();\r\n\t\tthis._onResize = onResize;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-splitpanel')) {\r\n\t\t\tjqEl.addClass('jl-splitpanel jl-border-box jl-round5');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tZ._isHori = (Z._direction == 'hori');\r\n\t\tZ._splitterClsName = Z._isHori ? 'jl-sp-splitter-hori': 'jl-sp-splitter-vert';\r\n\t\tjqEl.off();\r\n\t\tjqEl.on('mousedown', '.' + Z._splitterClsName, Z._splitterMouseDown);\r\n\t\tjqEl.on('click', '.jl-sp-button', function(event){\r\n\t\t\tvar jqBtn = jQuery(event.currentTarget),\r\n\t\t\t\tjqSplitter = jqBtn.parent(),\r\n\t\t\t\tindex = parseInt(jqSplitter.attr('jsletindex'));\r\n\t\t\tZ.expand(index);\r\n\t\t\tevent.stopPropagation();\r\n\t\t});\r\n\t\t\r\n\t\tvar panelDivs = jqEl.find('>div'),\r\n\t\t\tlastIndex = panelDivs.length - 1;\r\n\t\tif (!Z._floatIndex && Z._floatIndex !== 0 || Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (!Z.panels) {\r\n\t\t\tZ.panels = [];\r\n\t\t}\r\n\r\n\t\tpanelDivs.each(function(k){\r\n\t\t\tvar jqPanel = jQuery(panelDivs[k]),\r\n\t\t\t\toPanel = Z.panels[k];\r\n\t\t\tif (!oPanel){\r\n\t\t\t\toPanel = {};\r\n\t\t\t\tZ.panels[k] = oPanel;\r\n\t\t\t}\r\n\r\n\t\t\tvar minSize = parseInt(jqPanel.css(Z._isHori ?'min-width': 'min-height'));\r\n\t\t\toPanel.minSize = minSize ? minSize : 5;\r\n\t\t\t\r\n\t\t\tvar maxSize = parseInt(jqPanel.css(Z._isHori ?'max-width': 'max-height'));\r\n\t\t\toPanel.maxSize = maxSize ? maxSize : Infinity;\r\n\t\t\toPanel.expanded = jqPanel.css('display') != 'none';\r\n\t\t\t\r\n\t\t\tvar size = oPanel.size;\r\n\t\t\tif (size !== null && size !== undefined) {\r\n\t\t\t\tif (Z._isHori) {\r\n\t\t\t\t\tjqPanel.outerWidth(size - 5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.outerHeight(size - 5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.width = jqEl.innerWidth();\r\n\t\tZ.height = jqEl.innerHeight();\r\n\t\t\r\n\t\tZ._splitterTracker = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z._splitterTracker);\r\n\t\tjqTracker.addClass('jl-sp-splitter-tracker');\r\n\t\tvar fixedSize = 0,\r\n\t\t\tclsName = Z._isHori ? 'jl-sp-panel-hori': 'jl-sp-panel-vert';\r\n\t\tZ.el.appendChild(Z._splitterTracker);\r\n\t\tif (Z._isHori) {\r\n\t\t\tZ._splitterTracker.style.height = '100%';\r\n\t\t} else {\r\n\t\t\tZ._splitterTracker.style.width = '100%';\r\n\t\t}\r\n\t\tvar splitterSize = parseInt(jslet.ui.getCssValue(Z._splitterClsName, Z._isHori? 'width' : 'height'));\r\n\t\tpanelDivs.after(function(k){\r\n\t\t\tvar panel = panelDivs[k],\r\n\t\t\t\tjqPanel = jQuery(panel),\r\n\t\t\t\texpanded = Z.panels[k].expanded;\r\n\t\t\tif (Z._isHori) {\r\n\t\t\t\tjqPanel.outerHeight(Z.height);\r\n\t\t\t}\r\n\t\t\tjqPanel.addClass(clsName);\r\n\r\n\t\t\tif (k === Z._floatIndex) {\r\n\t\t\t\tZ.floatPanel = panel;\r\n\t\t\t} else {\r\n\t\t\t\tif (expanded) {\r\n\t\t\t\t\tfixedSize += splitterSize + Z.panels[k].size;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.css('display', 'none');\r\n\t\t\t\t\tfixedSize += splitterSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (k === lastIndex){\r\n\t\t\t\tif (Z._isHori) {\r\n\t\t\t\t\treturn '<div style=\"clear:both;width:0px\"></div>';\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tvar id = jslet.nextId(),\r\n\t\t\t\tminBtnCls = Z._isHori ? 'fa-caret-left' : 'fa-caret-up';\r\n\t\t\t\t\r\n\t\t\tif (Z._floatIndex <= k || !expanded) {\r\n\t\t\t\tminBtnCls += Z._isHori ? ' fa-caret-right' : ' fa-caret-down';\r\n\t\t\t}\r\n\t\t\treturn '<div class=\"'+ Z._splitterClsName + ' jl-unselectable\" id = \"' + id + \r\n\t\t\t'\" jsletindex=\"'+ (k >= Z._floatIndex ? k+1: k)+ '\"><div class=\"jl-sp-button ' +  \r\n\t\t\t(Z._isHori? 'jl-sp-button-hori': 'jl-sp-button-vert')+ '\"' + \r\n\t\t\t(expanded ? '': ' jsletcollapsed=\"1\"') +'><i class=\"fa ' + \r\n\t\t\tminBtnCls  + '\" aria-hidden=\"true\"></i></div></div>';\r\n\t\t});\r\n\t\tvar splitters = jqEl.find('.' + Z._splitterClsName);\r\n\t\tif (Z._isHori) {\r\n\t\t\tsplitters.outerHeight(Z.height);\r\n\t\t}\r\n\r\n\t\tvar oSplitter;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\toSplitter = splitters[i];\r\n\t\t\toSplitter._doDragStart = Z._splitterDragStart;\r\n\t\t\toSplitter._doDragging = Z._splitterDragging;\r\n\t\t\toSplitter._doDragEnd = Z._splitterDragEnd;\r\n\t\t\toSplitter._doDragCancel = Z._splitterDragCancel;\r\n\t\t}\r\n\t\tZ._changeFloatSize();\r\n\t},\r\n\t\r\n\t_changeFloatSize: function(visiblePanel) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tpanelDivs = jqEl.find('>div'),\r\n\t\t\tfixedSize = 0,\r\n\t\t\tpanelCnt = Z.panels.length * 2;\r\n\t\t\r\n\t\tpanelDivs.each(function(k){\r\n\t\t\tif(k >= panelCnt) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqPanel = jQuery(this);\r\n\t\t\tif(this !== Z.floatPanel && (visiblePanel === this || jqPanel.css('display') != 'none')) {\r\n\t\t\t\tfixedSize += Z._isHori ? jqPanel.outerWidth(true) : jqPanel.outerHeight(true);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar floatSize, floatMinSize = 5;\r\n\t\tvar panelCfg = Z.panels[Z._floatIndex];\r\n\t\tif(panelCfg) {\r\n\t\t\tfloatMinSize = panelCfg.minSize? panelCfg.minSize: 5;\r\n\t\t}\r\n\t\tif(Z._isHori) {\r\n\t\t\tfloatSize = jqEl.innerWidth() - fixedSize - 6;\r\n\t\t\tif(floatSize < floatMinSize) {\r\n\t\t\t\tfloatSize = floatMinSize;\r\n\t\t\t}\r\n\t\t\tjQuery(Z.floatPanel).outerWidth(floatSize);\r\n\t\t} else {\r\n\t\t\tfloatSize = jqEl.innerHeight() - fixedSize - 6;\r\n\t\t\tif(floatSize < floatMinSize) {\r\n\t\t\t\tfloatSize = floatMinSize;\r\n\t\t\t}\r\n\t\t\tjQuery(Z.floatPanel).outerHeight(floatSize);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand or collapse the specified panel. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.expand(1, true); //Expand the second panel.\r\n\t *     splitter.expand(0, false); //Collapse the first panel.\r\n\t * \r\n\t * \r\n\t * @param {Integer} index Panel index.\r\n\t * @param {Boolean} expanded True for expanded, false otherwise.\r\n\t */\r\n\texpand: function(index, expanded, notChangeSize){\r\n\t\tvar Z = this, jqPanel, jqEl = jQuery(Z.el),\r\n\t\t\tsplitters = jqEl.find('.'+Z._splitterClsName);\r\n\t\tif (index < 0 || index > splitters.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tjqSplitter = jQuery(splitters[(index >= Z._floatIndex ? index - 1: index)]),\r\n\t\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\t\t\r\n\t\tif (expanded === undefined) {\r\n\t\t\texpanded  = jqBtn.attr('jsletcollapsed')=='1';\r\n\t\t}\r\n\t\tif (index < Z._floatIndex) {\r\n\t\t\tjqPanel = jqSplitter.prev();\r\n\t\t} else {\r\n\t\t\tjqPanel = jqSplitter.next();\r\n\t\t}\r\n\t\tvar jqIcon = jqBtn.find(':first-child');\r\n\t\tif (Z._isHori){\r\n\t\t\tif (jqIcon.hasClass('fa-caret-right')) {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-right');\r\n\t\t\t\tjqIcon.addClass('fa-caret-left');\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-left');\r\n\t\t\t\tjqIcon.addClass('fa-caret-right');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (jqIcon.hasClass('fa-caret-down')) {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-down');\r\n\t\t\t\tjqIcon.addClass('fa-caret-up');\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-up');\r\n\t\t\t\tjqIcon.addClass('fa-caret-down');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (expanded){\r\n\t\t\tZ._changeFloatSize(jqPanel[0]);\r\n\t\t\tjqPanel.css('display', 'block');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '0');\r\n\t\t}else{\r\n\t\t\tjqPanel.css('display','none');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '1');\r\n\t\t\tZ._changeFloatSize();\r\n\t\t}\r\n\t\tif(notChangeSize) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.panels[index].expanded = expanded;\r\n\t\tif (Z._onExpanded) {\r\n\t\t\tZ._onExpanded.call(Z, index);\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t},\r\n\t\r\n\t_splitterMouseDown: function(event){\r\n\t\tvar pos = jQuery(this).position(),\r\n\t\t\tZ = this.parentNode.jslet;\r\n\t\tZ._splitterTracker.style.top = pos.top + 'px';\r\n\t\tZ._splitterTracker.style.left = pos.left + 'px';\r\n\t\tZ._draggingId = this.id;\r\n\t\tvar jqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\tif(jqBtn.attr('jsletcollapsed')=='1') { //Collapsed\r\n\t\t\tjqBtn.click();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t},\r\n\t\t\r\n\t_splitterDragStart: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tjqPanel = index < Z._floatIndex ? jqSplitter.prev(): jqSplitter.next(),\r\n\t\t\tcfg = Z.panels[index],\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\t\t\r\n\t\tvar panelSize = Z._isHori ? jqPanel.outerWidth(true) : jqPanel.outerHeight(true);\r\n\t\tZ._dragRangeMin = panelSize  - cfg.minSize;\r\n\t\tZ._dragRangeMax = cfg.maxSize - panelSize;\r\n\t\tvar fpMax = (Z._isHori ? jqFp.outerWidth(true) : jqFp.outerHeight(true)) - Z.panels[Z._floatIndex].minSize;\r\n\t\tif (Z._dragRangeMax > fpMax) {\r\n\t\t\tZ._dragRangeMax = fpMax;\r\n\t\t}\r\n\t\tjqTracker.show();\r\n\t},\r\n\t\r\n\t_splitterDragging: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tdelta = Math.abs(Z._isHori ? deltaX : deltaY),\r\n\t\t\texpanded;\r\n\t\t\t\r\n\t\tif (Z._isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tif (expanded && delta > Z._dragRangeMax){\r\n\t\t\tZ.endDelta = Z._dragRangeMax;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (!expanded && delta > Z._dragRangeMin){\r\n\t\t\tZ.endDelta = Z._dragRangeMin;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tZ.endDelta = Math.abs(Z._isHori ? deltaX : deltaY);\r\n\t\tvar pos = jqTracker.offset();\r\n\t\tif (Z._isHori) {\r\n\t\t\tpos.left = x;\r\n\t\t} else {\r\n\t\t\tpos.top = y;\r\n\t\t}\r\n\t\tjqTracker.offset(pos);\r\n\t},\r\n\t\r\n\t_splitterDragEnd: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tjqPanel = index < Z._floatIndex ? jqSplitter.prev(): jqSplitter.next(),\r\n\t\t\texpanded,\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\r\n\t\tif (Z._isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tvar delta = Z.endDelta * (expanded ? 1: -1);\r\n\t\t\r\n\t\tif (Z._isHori) {\r\n\t\t\tif(delta < 0) {\r\n\t\t\t\tjqPanel.outerWidth(jqPanel.outerWidth() + delta);\r\n\t\t\t\tjqFp.outerWidth(jqFp.outerWidth() - delta);\r\n\t\t\t} else {\r\n\t\t\t\tjqFp.outerWidth(jqFp.outerWidth() - delta);\r\n\t\t\t\tjqPanel.outerWidth(jqPanel.outerWidth() + delta);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(delta < 0) { \r\n\t\t\t\tjqPanel.outerHeight(jqPanel.outerHeight() + delta);\r\n\t\t\t\tjqFp.outerHeight(jqFp.outerHeight() - delta);\r\n\t\t\t} else {\r\n\t\t\t\tjqFp.outerHeight(jqFp.outerHeight() - delta);\r\n\t\t\t\tjqPanel.outerHeight(jqPanel.outerHeight() + delta);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z._onResize) {\r\n\t\t\tZ._onResize.call(Z, jqPanel[0]);\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t_splitterDragCancel: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tcurrWidth = jqEl.innerWidth(),\r\n\t\t\tcurrHeight = jqEl.innerHeight();\r\n\t\tif (Z._isHori && currWidth !== Z._oldWidth ||\r\n\t\t\t!Z._isHori && currHeight !== Z._oldHeight) {\r\n\t\t\tZ._changeFloatSizeDebounce();\r\n\t\t}\r\n\t\tif(Z._oldWidth != currWidth || Z._oldHeight != currHeight) {\r\n\t\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t\t}\r\n\t\tZ._oldWidth = currWidth;\r\n\t\tZ._oldHeight = currHeight;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._splitterTracker = null;\r\n\t\tZ._draggingId = null;\r\n\t\tZ.floatPanel = null;\r\n\t\tvar splitters = jqEl.find('.'+Z._splitterClsName);\r\n\t\tsplitters.off('mousedown', Z._splitterMouseDown);\r\n\t\tZ._splitterMouseDown = null;\r\n\t\tvar item;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\titem = splitters[i];\r\n\t\t\tjslet.ui.dnd.unbindControl(item);\r\n\t\t\titem._doDragStart = null;\r\n\t\t\titem._doDragging = null;\r\n\t\t\titem._doDragEnd = null;\r\n\t\t\titem._doDragCancel = null;\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('SplitPanel', jslet.ui.SplitPanel);\r\njslet.ui.SplitPanel.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * TabControl. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: \"TabControl\", \r\n *       activeIndex: 1, \r\n *       onCreateContextMenu: doCreateContextMenu, \r\n *       items: [\r\n *         {header: \"one\", userIFrame: true, url: \"http://www.google.com\", iconClass: \"tabIcon\"},\r\n *         {header: \"two\", closable: true, divId: \"p2\"},\r\n *         {header:\"three\",closable:true,divId:\"p3\"},\r\n *       ]};\r\n *     //1. Binding:\r\n *     <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\" />\r\n *\r\n *     //2. Binding on fly\r\n *     <div id='ctrlId' />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.TabControl = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,activeIndex,newable,closable,items,isFixedHeight,hasContent,onAddTabItem,onActiveIndexChanged,onRemoveTabItem,onCreateContextMenu,onContentLoading,onContentLoaded,enableLoading';\r\n\t\t\r\n\t\tZ._activeIndex = -1;\r\n\t\t\r\n\t\tZ._newable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._onActiveIndexChanged = null;\r\n\t\t\r\n\t\tZ._onAddTabItem = null;\r\n\t\t\r\n\t\tZ._onRemoveTabItem = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ._items = [];\r\n\t\t\r\n\t\tZ._hasContent = true;\r\n\t\t\r\n\t\tZ._isFixedHeight = false;\r\n\t\t\r\n\t\tZ._itemsWidth = [];\r\n\t\tZ._containerWidth = 0;\r\n\t\tZ._ready = false;\r\n\t\t\r\n\t\tZ._leftIndex = 0;\r\n\t\tZ._rightIndex = 0;\r\n\t\tZ._maxHeaderWidth = 160;\r\n\t\tZ._tabControlWidth = jQuery(Z.el).width();\r\n\t\tZ._tabControlHeight = jQuery(Z.el).height();\r\n\t\tZ._contextItemIndex = 0;\r\n\t\t\r\n\t\tZ._onContentLoading = null;\r\n\t\tZ._onContentLoaded = null;\r\n\t\t\r\n\t\tZ._enableLoading = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get active tab item index.\r\n\t * \r\n\t * @param {Integer | undefined} index active tabItem index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tactiveIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._activeIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.activeIndex', index).isGTEZero();\r\n\t\tif(this._ready) {\r\n\t\t\tthis._chgActiveIndex(index);\r\n\t\t} else {\r\n\t\t\tthis._activeIndex = index;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get active tab item id.\r\n\t * \r\n\t * @param {String | undefined} itemId active tabItem id.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tactiveItemId: function(itemId) {\r\n\t\tvar Z = this;\r\n\t\tif(itemId === undefined) {\r\n\t\t\tvar itemCfg = Z._items[this._activeIndex];\r\n\t\t\tif(itemCfg) {\r\n\t\t\t\treturn itemCfg.id;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.activeItemId', itemId).isString();\r\n\t\tif(this._ready) {\r\n\t\t\tvar items = Z._items;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\tif(itemId === items[i].id) {\r\n\t\t\t\t\tthis._chgActiveIndex(i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get active tab item configuration.\r\n\t * \r\n\t * @return {jslet.ui.TabItem}\r\n\t */\r\n\tactiveItem: function() {\r\n\t\tvar items = this._items;\r\n\t\tif(items && items.length > 0) {\r\n\t\t\treturn this._items[this._activeIndex || 0];\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether user can add tab item on fly.\r\n\t * \r\n\t * @param {Boolean | undefined} newable True(default) - user can add tab item on fly, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tnewable: function(newable) {\r\n\t\tif(newable === undefined) {\r\n\t\t\treturn this._newable;\r\n\t\t}\r\n\t\tthis._newable = newable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if user can close tab item on fly.\r\n\t * \r\n\t * @param {Boolean | undefined} closable True(default) - user can close tab item on fly, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if the TabControl has content panel. Sometimes, you only need the TabControl which is without content panel. \r\n\t * \r\n\t * @param {Boolean | undefined} hasContent True(default) - TabControl has content panel, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\thasContent: function(hasContent) {\r\n\t\tif(hasContent === undefined) {\r\n\t\t\treturn this._hasContent;\r\n\t\t}\r\n\t\tthis._hasContent = hasContent? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the height of TabPanel is same. \r\n\t * \r\n\t * @param {Boolean | undefined} isFixedHeight True - the height of TabPanel is same, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tisFixedHeight: function(isFixedHeight) {\r\n\t\tif(isFixedHeight === undefined) {\r\n\t\t\treturn this._isFixedHeight;\r\n\t\t}\r\n\t\tthis._isFixedHeight = isFixedHeight? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether enable loading icon when open a tab panel. \r\n\t * \r\n\t * @param {Boolean | undefined} enableLoading True - enable loading icon, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tenableLoading: function(enableLoading) {\r\n\t\tif(enableLoading === undefined) {\r\n\t\t\treturn this._enableLoading;\r\n\t\t}\r\n\t\tthis._enableLoading = enableLoading? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after add a new tab item.\r\n\t * Pattern: \r\n\t *   function(){}\r\n\t *   \r\n\t * @param {Function | undefined} onAddTabItem tab item added event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonAddTabItem: function(onAddTabItem) {\r\n\t\tif(onAddTabItem === undefined) {\r\n\t\t\treturn this._onAddTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onAddTabItem', onAddTabItem).isFunction();\r\n\t\tthis._onAddTabItem = onAddTabItem;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user toggle tab item.\r\n\t * Pattern: \r\n\t *   function(oldIndex, newIndex){}\r\n\t *   //oldIndex: Integer\r\n\t *   //newIndex: Integer\r\n\t *   \r\n\t * @param {Function | undefined} onActiveIndexChanged tab item active event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonActiveIndexChanged: function(onActiveIndexChanged) {\r\n\t\tif(onActiveIndexChanged === undefined) {\r\n\t\t\treturn this._onActiveIndexChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onActiveIndexChanged', onActiveIndexChanged).isFunction();\r\n\t\tthis._onActiveIndexChanged = onActiveIndexChanged;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired after remove a tab item.\r\n\t * Pattern: \r\n\t *  function(tabItemIndex, active){}\r\n\t *  //tabItemIndex: Integer\r\n\t *  //active: Boolean Identify if the removing item is active\r\n\t *  //return: Boolean, false - cancel removing tab item, true - remove tab item. \r\n\t *   \r\n\t * @param {Function | undefined} onRemoveTabItem tab item removed event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRemoveTabItem: function(onRemoveTabItem) {\r\n\t\tif(onRemoveTabItem === undefined) {\r\n\t\t\treturn this._onRemoveTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onRemoveTabItem', onRemoveTabItem).isFunction();\r\n\t\tthis._onRemoveTabItem = onRemoveTabItem;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired before show context menu.\r\n\t * Pattern: \r\n\t *   function(menuItems){}\r\n\t *   //menuItems: Array of MenuItem, see menu item configuration in jslet.ui.menu.js.\r\n\t *   \r\n\t * @param {Function | undefined} onCreateContextMenu creating context menu event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Fired before loading content of tab item;\r\n\t * Pattern: \r\n\t *   function(contentId, itemCfg){}\r\n\t *   //contentId: {String} the content element's id.\r\n\t *   //itemCfg: {Plan Object} tab item config\r\n\t *   \r\n\t * @param {Function | undefined} onContentLoading before loading tab panel content handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonContentLoading: function(onContentLoading) {\r\n\t\tif(onContentLoading === undefined) {\r\n\t\t\treturn this._onContentLoading;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onContentLoading', onContentLoading).isFunction();\r\n\t\tthis._onContentLoading = onContentLoading;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Fired after loading content of tab item;\r\n\t * Pattern: \r\n\t *   function(contentId, itemCfg){}\r\n\t *   //contentId: {String} the content element's id.\r\n\t *   //itemCfg: {Plan Object} tab item config\r\n\t *   \r\n\t * @param {Function | undefined} onContentLoading after loading tab panel content handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonContentLoaded: function(onContentLoaded) {\r\n\t\tif(onContentLoaded === undefined) {\r\n\t\t\treturn this._onContentLoaded;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onContentLoaded', onContentLoaded).isFunction();\r\n\t\tthis._onContentLoaded = onContentLoaded;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Set or get tab item configuration.\r\n\t * \r\n\t * @param {jslet.ui.TabItem[] | undefined} items tab items.\r\n\t * \r\n\t * @return {this | jslet.ui.TabItem[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('TabControl.items.header', item.header).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(this);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tfunction innerAdd(itemCfg) {\r\n\t\t\tif (!itemCfg) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ.addTabItem(itemCfg);\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ.activeIndex(Z._items.length - 1);\r\n\t\t}\r\n\t\t\r\n\t\tZ._createContextMenu();\r\n\r\n\t\tvar\ttemplate = [\r\n\t\t\t'<div class=\"jl-tab-header jl-unselectable\"><div class=\"jl-tab-container jl-unselectable\"><ul class=\"jl-tab-list\">',\r\n\t\t\tZ._newable ? '<li><a href=\"javascript:;\" class=\"jl-tab-inner\"><span class=\"jl-tab-new\">+</span></a></li>' : '',\r\n\t\t\t'</ul></div><a class=\"jl-tab-left jl-hidden\"><span class=\"jl-nav-btn fa fa-arrow-circle-left\"></span></a><a class=\"jl-tab-right jl-hidden\"><span class=\"jl-nav-btn fa fa-arrow-circle-right\"></span></a></div>',\r\n\t\t\t'<div class=\"jl-tab-panels jl-round5 jl-hidden' + (Z._isFixedHeight ? ' jl-tab-panels-fixed': '') + ' \"',\r\n\t\t\tZ._hasContent? '': ' style=\"border: 0;height:0\"',\r\n\t\t\t'></div>'];\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-tabcontrol')) {\r\n\t\t\tjqEl.addClass('jl-tabcontrol jl-round5');\r\n\t\t}\r\n\t\tjqEl.html(template.join(''));\r\n\t\tif (Z._newable) {\r\n\t\t\tvar oul = jqEl.find('.jl-tab-list')[0];\r\n\t\t\tvar newTab = oul.childNodes[oul.childNodes.length - 1];\r\n\t\t\tZ._newTabItem = newTab;\r\n\t\t\t\r\n\t\t\tnewTab.onclick = function () {\r\n\t\t\t\tif (!Z._onAddTabItem) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar\titemCfg = Z._onAddTabItem.call(Z);\r\n\t\t\t\tif(jslet.isPromise(itemCfg)) {\r\n\t\t\t\t\titemCfg.done(function(result) {\r\n\t\t\t\t\t\tinnerAdd(result);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinnerAdd(itemCfg);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar jqNavBtn = jqEl.find('.jl-tab-left');\r\n\t\t\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex - 1);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn = jqEl.find('.jl-tab-right');\r\n\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex + 1);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tif (Z._items && Z._items.length > 0) {\r\n\t\t\tvar oitem, \r\n\t\t\t\tcnt = Z._items.length;\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\toitem = Z._items[i];\r\n\t\t\t\tZ._renderTabItem(oitem);\r\n\t\t\t}\r\n\t\t\tZ._activeIndex = 0;\r\n\t\t}\r\n\t\tZ._calcItemsWidth();\r\n\t\tZ._ready = true;\r\n\t\tZ._chgActiveIndex(Z._activeIndex);\r\n\t\tZ._checkTabItemCount();\r\n\t},\r\n\r\n\taddItem: function (itemCfg) {\r\n\t\tthis._items[this._items.length] = itemCfg;\r\n\t},\r\n\r\n\t/**\r\n\t * Change tab item's header.\r\n\t * \r\n\t * @param {Integer} index - tab item index.\r\n\t * @param {String} header - tab item header.\r\n\t */\r\n\ttabHeader: function(index, header) {\r\n\t\tjslet.Checker.test('tabHeader#index', index).isGTEZero();\r\n\t\tjslet.Checker.test('tabHeader#label', header).required().isString();\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\titemCfg.header = header;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar panelContainer = jqEl.find('.jl-tab-list')[0];\r\n\t\tvar nodes = panelContainer.childNodes;\r\n\t\tjQuery(nodes[index]).find('.jl-tab-title').html(header);\r\n\t\tZ._calcItemsWidth();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable tab item.\r\n\t * \r\n\t * @param {Integer} index - tab item index.\r\n\t * @param {Boolean} disabled - true - disabled, false - otherwise.\r\n\t */\r\n\ttabDisabled: function(index, disabled) {\r\n\t\tjslet.Checker.test('tabDisabled#index', index).isGTEZero();\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(index == Z._activeIndex) {\r\n\t\t\tconsole.warn('Cannot set current tab item to disabled.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.disabled(disabled);\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqPanels = jqEl.find('.jl-tab-panels'),\r\n\t\t\tpanelContainer = jqPanels[0],\r\n\t\t\tnodes = panelContainer.childNodes,\r\n\t\t\tjqItem = jQuery(nodes[index]);\r\n\t\tif(disabled) {\r\n\t\t\tjqItem.addClass('jl-tab-disabled');\r\n\t\t} else {\r\n\t\t\tjqItem.removeClass('jl-tab-disabled');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_checkTabItemCount: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqTabPanels = jQuery(Z.el).find('.jl-tab-panels');\r\n\t\tif(!Z._items || Z._items.length === 0) {\r\n\t\t\tif(!jqTabPanels.hasClass('jl-hidden')) {\r\n\t\t\t\tjqTabPanels.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tjqTabPanels.removeClass('jl-hidden');\r\n\r\n\t\t} \r\n\t},\r\n\t\r\n\t/*\r\n\t * Change active tab item.\r\n\t * \r\n\t * @param {Integer} index Tab item index which will be toggled to.\r\n\t */\r\n\t_chgActiveIndex: function (index) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction innerChgActiveIndex() {\r\n\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\toli, \r\n\t\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\t\tnodes = oul.childNodes,\r\n\t\t\t\tcnt = nodes.length - (Z._newable ? 2 : 1);\r\n\t\r\n\t\t\tvar itemContainer = jqEl.find('.jl-tab-panels')[0],\r\n\t\t\t\titem,\r\n\t\t\t\titems = itemContainer.childNodes;\r\n\t\t\tfor (var i = 0; i <= cnt; i++) {\r\n\t\t\t\toli = jQuery(nodes[i]);\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif (i === index) {\r\n\t\t\t\t\toli.addClass('jl-tab-active');\r\n\t\t\t\t\titem.style.display = 'block';\r\n\t\t\t\t\t//To fix Chrome bug: scrollbar disappeared.\r\n\t\t\t\t\tvar oIframe = item.childNodes[0];\r\n\t\t\t\t\tif(oIframe.tagName == 'IFRAME') {\r\n\t\t\t\t\t\titem.style.overflow = 'hidden';\r\n\t\t\t\t\t\tvar oldHeight = oIframe.style.height;\r\n\t\t\t\t\t\toIframe.style.height = \"0\";\r\n\t\t\t\t\t\t/* jshint ignore:start */\r\n\t\t\t\t\t\toIframe.scrollWidth;\r\n\t\t\t\t\t\t/* jshint ignore:end */\r\n\t\t\t\t\t\toIframe.style.height = oldHeight || \"100%\";\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\toli.removeClass('jl-tab-active');\r\n\t\t\t\t\titem.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ._activeIndex = index;\r\n\t\t\tif(index < Z._leftIndex || index >= Z._rightIndex) {\r\n\t\t\t\tZ._setVisiTabItems(null, Z._activeIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg || itemCfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (index != Z._activeIndex && Z._onActiveIndexChanged) {\r\n\t\t\tvar result = Z._onActiveIndexChanged.call(Z, Z._activeIndex, index);\r\n\t\t\tif(jslet.isPromise(result)) {\r\n\t\t\t\tresult.done(function(canChanged) {\r\n\t\t\t\t\tif(canChanged === undefined || canChanged) {\r\n\t\t\t\t\t\tinnerChgActiveIndex();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(result === undefined || result) {\r\n\t\t\t\t\tinnerChgActiveIndex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tinnerChgActiveIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getTabItemCfg: function(index) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._items.length <= index) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn Z._items[index];\r\n\t},\r\n\t\r\n\t_calcItemsWidth: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl =jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tab-list').children();\r\n\t\tZ._itemsWidth = [];\r\n\t\tZ._totalItemsWidth = 0;\r\n\t\tnodes.each(function(index){\r\n\t\t\tvar w = jQuery(this).outerWidth() + 5;\r\n\t\t\tZ._itemsWidth[index] = w;\r\n\t\t\tZ._totalItemsWidth += w;\r\n\t\t});\r\n\r\n\t\tZ._containerWidth = jqEl.find('.jl-tab-container').innerWidth();\r\n\t\tZ._setNavBtnVisible();\r\n\t},\r\n\t\r\n\t_setVisiTabItems: function(leftIndex, rightIndex) {\r\n\t\tvar Z = this, w, i, len;\r\n\t\tif(!leftIndex && leftIndex !== 0) {\r\n\t\t\tif(!rightIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._newable) {\r\n\t\t\t\trightIndex++;\r\n\t\t\t}\r\n\t\t\tw = Z._itemsWidth[rightIndex];\r\n\t\t\tZ._leftIndex = rightIndex;\r\n\t\t\tfor(i = rightIndex - 1; i >= 0; i--) {\r\n\t\t\t\tw += Z._itemsWidth[i];\r\n\t\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\t\tZ._leftIndex = i + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ._leftIndex = i;\r\n\t\t\t}\r\n\t\t\tleftIndex = Z._leftIndex;\r\n\t\t} else {\r\n\t\t\tZ._leftIndex = leftIndex;\r\n\t\t}\r\n\t\tw = 0;\r\n\t\tZ._rightIndex = leftIndex;\r\n\t\tfor(i = leftIndex, len = Z._itemsWidth.length; i < len; i++) {\r\n\t\t\tw += Z._itemsWidth[i];\r\n\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\tZ._rightIndex = i - 1;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tZ._rightIndex = i;\r\n\t\t}\r\n\t\tvar leftPos = 0;\r\n\t\tfor(i = 0; i < Z._leftIndex; i++) {\r\n\t\t\tleftPos += Z._itemsWidth[i];\r\n\t\t}\r\n\t\tleftPos += 5;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-tab-container').scrollLeft(jsletlocale.isRtl ? 50000 - leftPos: leftPos);\r\n\t\tZ._setNavBtnVisible();\r\n\t},\r\n\t\r\n\t_setNavBtnVisible: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqBtnLeft = jqEl.find('.jl-tab-left'),\r\n\t\t\tisHidden = jqBtnLeft.hasClass('jl-hidden');\r\n\t\tif(Z._leftIndex > 0 && Z._totalItemsWidth > Z._containerWidth) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnLeft.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnLeft.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqBtnRight = jqEl.find('.jl-tab-right');\r\n\t\tvar totalCnt = Z._itemsWidth.length;\r\n\t\tisHidden = jqBtnRight.hasClass('jl-hidden');\r\n\t\tif(Z._rightIndex < totalCnt - 1 && Z._totalItemsWidth > Z._containerWidth) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnRight.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnRight.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeader: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tcanClose = Z._closable && itemCfg.closable,\r\n\t\t\ttmpl = [];\r\n\t\t\r\n\t\tif(Z._enableLoading) {\r\n\t\t\ttmpl.push('<div class=\"jl-tab-loading jl-hidden\"><i class=\"fa fa-spinner fa-pulse fa-fw\"></i></div>');\r\n\t\t}\r\n\t\ttmpl.push('<a href=\"javascript:;\" class=\"jl-tab-inner' + (canClose? ' jl-tab-close-loc': '') + \r\n\t\t        '\" onclick=\"javascript:this.blur();\" title=\"' + itemCfg.header + '\">');\r\n\r\n\t\ttmpl.push('<span class=\"jl-tab-icon ' + (itemCfg.iconClass || '') + '\"></span>');\r\n\r\n\t\ttmpl.push('<span class=\"jl-tab-title\">');\r\n\t\ttmpl.push(itemCfg.header);\r\n\t\ttmpl.push('</span>');\r\n\t\ttmpl.push('<span class=\"fa fa-times close jl-tab-close' + (!canClose || itemCfg.disabled? ' jl-hidden': '') + '\"></span><span style=\"clear:both\"></span>');\r\n\t\ttmpl.push('</a>');\r\n\t\tif(!itemCfg.id && itemCfg.id !== 0) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar oli = document.createElement('li');\r\n\t\toli.id = itemCfg.id + '_h';\r\n\t\tif(itemCfg.disabled) {\r\n\t\t\tjQuery(oli).addClass('jl-tab-disabled');\r\n\t\t}\r\n\t\toli.innerHTML = tmpl.join('');\r\n\r\n\t\tif (Z._newable) {\r\n\t\t\tvar lastNode = parent.childNodes[parent.childNodes.length - 1];\r\n\t\t\tparent.insertBefore(oli, lastNode);\r\n\t\t} else {\r\n\t\t\tparent.appendChild(oli);\r\n\t\t}\r\n\t\toli.jslet = Z;\r\n\t\tjQuery(oli).on('click', Z._changeTabItem);\r\n\r\n\t\tif (canClose) {\r\n\t\t\tjQuery(oli).find('.jl-tab-close').click(Z._doCloseBtnClick);\r\n\t\t}\r\n\t\tif(Z.contextMenu && !itemCfg.disabled) {\r\n\t\t\toli.oncontextmenu = function (event) {\r\n\t\t\t\tvar k = 0;\r\n\t\t\t\tvar items = jQuery(Z.el).find('.jl-tab-list li').each(function() {\r\n\t\t\t\t\tif(this === event.currentTarget) {\r\n\t\t\t\t\t\tZ._contextItemIndex = k;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tk++;\r\n\t\t\t\t});\r\n\t\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\r\n\t_changeTabItem: function (event) {\r\n\t\tvar nodes = this.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == this) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet._chgActiveIndex(index);\r\n\t},\r\n\r\n\t_doCloseBtnClick: function (event) {\r\n\t\tvar oli = this.parentNode.parentNode,\r\n\t\t\tnodes = oli.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == oli) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\toli.jslet.removeTabItem(index);\r\n\t\tevent.preventDefault();\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_createBody: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqDiv = jQuery(document.createElement('div'));\r\n\t\tif (!jqDiv.hasClass('jl-tab-panel')) {\r\n\t\t\tjqDiv.addClass('jl-tab-panel');\r\n\t\t}\r\n\t\tparent.appendChild(jqDiv[0]);\r\n\t\t\r\n\t\tif (itemCfg.content || itemCfg.contentId) {\r\n\t\t\tvar ocontent = itemCfg.content;\r\n\t\t\tif(itemCfg.contentId) {\r\n\t\t\t\tocontent = jQuery('#'+itemCfg.contentId)[0];\r\n\t\t\t}\r\n\t\t\tif (ocontent) {\r\n\t\t\t\tjqDiv.html('');\r\n\t\t\t\tjqDiv.append(ocontent);\r\n\t\t\t\tjqDiv.children().show();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar url = itemCfg.url;\r\n\t\tif (url) {\r\n\t\t\turl = jslet.urlUtil.addParam(url, {jlTabItemId: itemCfg.id});\r\n\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\turl = jslet.urlUtil.addParam(url, {debounce: true});\r\n\t\t\t}\r\n\t\t\titemCfg.url = url;\r\n\t\t\tif (itemCfg.useIFrame || itemCfg.useIFrame === undefined) {\r\n\t\t\t\tvar h = itemCfg.height;\r\n\t\t\t\tif(h && !jslet.isString(h)) {\r\n\t\t\t\t\th += 'px';\r\n\t\t\t\t}\r\n\t\t\t\th = h ? h: '100%';\r\n\t\t\t\t\r\n\t\t\t\tvar id = itemCfg.id || jslet.nextId(); \r\n\t\t\t\tvar s = '<iframe id=\"' + id + '\" scrolling=\"yes\" frameborder=\"0\" allowtransparency=\"true\" src=\"' + \r\n\t\t\t\t\turl + \r\n\t\t\t\t'\" style=\"background-color:transparent;width: 100%;' + (Z._isFixedHeight? '': 'height:' + h) + '\"' +\r\n\t\t\t\t(Z._isFixedHeight? 'class=\"jl-tab-frame-fixed\"': '') + '></iframe>';\r\n\t\t\t\tjqDiv.html(s);\r\n\t\t\t\titemCfg.contentId = id;\r\n\t\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\t\tif(Z._enableLoading) {\r\n\t\t\t\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\t\t\t\tjqHead = jqEl.find('.jl-tab-header');\r\n\t\t\t\t\t\tjqHead.find('#' + id + '_h .jl-tab-loading').removeClass('jl-hidden');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(Z._onContentLoading) {\r\n\t\t\t\t\t\tZ._onContentLoading.call(Z, id, itemCfg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Add tab item dynamically.\r\n\t * \r\n\t * @param {Object} newItemCfg Tab item configuration\r\n\t * @param {Boolean} noDuplicate Identify if the same \"tabItem.id\" can be added or not, default is true. \r\n\t */\r\n\taddTabItem: function (newItemCfg, noDuplicate) {\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\tnewId = newItemCfg.id;\r\n\t\tif(!newId) {\r\n\t\t\tnewId = jslet.nextId();\r\n\t\t\tnewItemCfg.id = newId;\r\n\t\t}\r\n\t\tvar itemCfg;\r\n\t\tif((noDuplicate === undefined || noDuplicate) && newId) {\r\n\t\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\t\titemCfg = tabItems[i];\r\n\t\t\t\tif(newId === itemCfg.id) {\r\n\t\t\t\t\tif(itemCfg.url !== newItemCfg.url) {\r\n\t\t\t\t\t\titemCfg.url = newItemCfg.url;\r\n\t\t\t\t\t\tZ.reloadTabItem(itemCfg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ.activeIndex(i);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttabItems.push(newItemCfg);\r\n\t\tZ._renderTabItem(newItemCfg);\r\n\t\tZ._calcItemsWidth();\r\n\t\tZ._chgActiveIndex(tabItems.length - 1);\r\n\t\tZ._checkTabItemCount();\r\n\t},\r\n\r\n\t/**\r\n\t * set the specified tab item to loaded state. It will fire the \"onContentLoaded\" event.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t */\r\n\tsetContentLoadedState: function(tabItemId) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(Z._enableLoading) {\r\n\t\t\tjqEl.find('#' + tabItemId + '_h .jl-tab-loading').addClass('jl-hidden');\r\n\t\t}\r\n\t\tif(!Z._onContentLoaded) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\ttabItems = Z._items,\r\n\t\t\tcontentId = null,\r\n\t\t\titemCfg;\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(tabItemId === itemCfg.id) {\r\n\t\t\t\tcontentId = itemCfg.contentId;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!contentId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._onContentLoaded.call(Z, contentId, itemCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set tab item to changed state or not.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t * @param {Boolean} changed - changed state.\r\n\t */\r\n\tsetContentChangedState: function(tabItemId, changed) {\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\titemCfg,\r\n\t\t\tidx = -1;\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(tabItemId === itemCfg.id) {\r\n\t\t\t\tidx = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(idx < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.changed = changed;\r\n\t\tvar header = itemCfg.header,\r\n\t\t\thasChangedFlag = (header.charAt(0) === '*');\r\n\t\tif(changed) {\r\n\t\t\tif(!hasChangedFlag) {\r\n\t\t\t\theader = '*' + header;\r\n\t\t\t\tZ.tabHeader(idx, header);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(hasChangedFlag) {\r\n\t\t\t\theader = header.substring(1);\r\n\t\t\t\tZ.tabHeader(idx, header);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify which exists changed tab item or not.\r\n\t */\r\n\thasChanged: function(tabIndex) {\r\n\t\tjslet.Checker.test('TabControl.hasChanged#tabIndex', tabIndex).isGTEZero();\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\titemCfg,\r\n\t\t\tidx = -1,\r\n\t\t\tnoTabIndex = (tabIndex === undefined || tabIndex === null);\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(itemCfg.changed) {\r\n\t\t\t\tif(noTabIndex || tabIndex === i) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_renderTabItem: function(itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tpanelContainer = jqEl.find('.jl-tab-panels')[0];\r\n\t\tif(!itemCfg.id) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tZ._createHeader(oul, itemCfg);\r\n\t\tZ._createBody(panelContainer, itemCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove tab item with tabItemIndex\r\n\t * \r\n\t * @param {Integer} tabItemIndex Tab item index\r\n\t */\r\n\tremoveTabItem: function (tabItemIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (tabItemIndex >= Z._items.length || tabItemIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar itemCfg = Z._items[tabItemIndex];\r\n\t\tif(itemCfg.changed) {\r\n            jslet.ui.confirm(jsletlocale.TabControl.contentChanged, jsletlocale.MessageBox.confirm, function(button){\r\n\t\t\t\tif(button === 'ok') {\r\n\t\t\t\t\tZ._innerRemoveTabItem(tabItemIndex);\r\n\t\t\t\t}\r\n            });\r\n\t\t} else {\r\n\t\t\tZ._innerRemoveTabItem(tabItemIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_innerRemoveTabItem: function (tabItemIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tnodes = oul.childNodes,\r\n\t\t\toli = jQuery(nodes[tabItemIndex]),\r\n\t\t\tactive = oli.hasClass('jl-tab-active');\r\n\t\t\r\n\t\tfunction innerRemove() {\r\n\t\t\toli.find('.jl-tab-close').hide();\r\n\t\t\toli.animate({width:'toggle'},200, function() {\r\n\t\t\t\tvar elItem = oli[0]; \r\n\t\t\t\telItem.oncontextmenu = null;\r\n\t\t\t\toul.removeChild(elItem);\r\n\t\t\t\tZ._items.splice(tabItemIndex, 1);\r\n\t\t\t\tvar panelContainer = jqEl.find('.jl-tab-panels')[0];\r\n\t\t\t\tnodes = panelContainer.childNodes;\r\n\t\t\t\tvar tabPanel = nodes[tabItemIndex];\r\n\t\t\t\tpanelContainer.removeChild(tabPanel);\r\n\t\t\t\tZ._calcItemsWidth();\r\n\t\t\t\tZ._checkTabItemCount();\r\n\t\t\t\tif (active) {\r\n\t\t\t\t\tvar cnt = nodes.length - (Z._newable ? 2 : 1);\r\n\t\t\t\t\ttabItemIndex = Z._getNextValidIndex(tabItemIndex, tabItemIndex >= cnt);\r\n\t\t\t\t\tif (tabItemIndex >= 0) {\r\n\t\t\t\t\t\tZ._chgActiveIndex(tabItemIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tZ._activeIndex = -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(Z._activeIndex > tabItemIndex) {\r\n\t\t\t\t\t\tZ._activeIndex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._onRemoveTabItem) {\r\n\t\t\tvar result = Z._onRemoveTabItem.call(Z, Z._items[tabItemIndex], active);\r\n\t\t\tif(jslet.isPromise(result)) {\r\n\t\t\t\tresult.done(function(canRemoved) {\r\n\t\t\t\t\tif (canRemoved === undefined || canRemoved) {\r\n\t\t\t\t\t\tinnerRemove();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (result === undefined || result) {\r\n\t\t\t\t\tinnerRemove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getNextValidIndex: function(start, isLeft) {\r\n\t\tvar Z = this, i, len;\r\n\t\tif(isLeft) {\r\n\t\t\tfor(i = start - 1; i >= 0; i--) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i = start, len = Z._items.length; i < len; i++) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Reload the active tab panel.\r\n\t */\r\n\treload: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcurrIdx = Z._contextItemIndex,\r\n\t\t\titemCfg = Z._items[currIdx];\r\n\t\tZ.reloadTabItem(itemCfg);\r\n\t},\r\n\t\r\n\treloadTabItem: function(itemCfg) {\r\n\t\tvar Z = this;\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar contentId = itemCfg.contentId;\r\n\t\tif(contentId) {\r\n\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\tif(Z._enableLoading) {\r\n\t\t\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\t\t\tjqHead = jqEl.find('.jl-tab-header');\r\n\t\t\t\t\tjqHead.find('#' + contentId + '_h .jl-tab-loading').removeClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onContentLoading) {\r\n\t\t\t\t\tZ._onContentLoading.call(Z, contentId, itemCfg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tjQuery('#' + contentId).attr('src', itemCfg.url);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close the current active tab item  if this tab item is closable.\r\n\t */\r\n\tclose: function (tabItemIndex) {\r\n\t\tvar Z = this;\r\n\t\tif(tabItemIndex === undefined) {\r\n\t\t\ttabItemIndex = Z._activeIndex;\r\n\t\t}\r\n\t\tvar itemCfg = Z._items[tabItemIndex];\r\n\t\tif (itemCfg && tabItemIndex >= 0 && itemCfg.closable && !itemCfg.disabled) {\r\n\t\t\tZ.removeTabItem(tabItemIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close all closable tab item except current active tab item.\r\n\t */\r\n\tcloseOther: function () {\r\n\t\tvar Z = this, oitem;\r\n\t\tfor (var i = Z._items.length - 1; i >= 0; i--) {\r\n\t\t\toitem = Z._items[i];\r\n\t\t\tif (oitem.closable && !oitem.disabled) {\r\n\t\t\t\tif (Z._contextItemIndex == i) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ.removeTabItem(i);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close all closable tab item.\r\n\t */\r\n\tcloseAll: function() {\r\n\t\tvar Z = this, oitem;\r\n\t\tfor (var i = Z._items.length - 1; i >= 0; i--) {\r\n\t\t\toitem = Z._items[i];\r\n\t\t\tif (oitem.closable && !oitem.disabled) {\r\n\t\t\t\tZ.removeTabItem(i);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tcurrWidth = jqEl.width(),\r\n\t\t\tcurrHeight = jqEl.height();\r\n\t\tif(currWidth === Z._tabControlWidth && currHeight === Z._tabControlHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ( Z._tabControlWidth != currWidth){\r\n\t\t\tZ._tabControlWidth = currWidth;\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex);\r\n\t\t}\r\n\t\tZ._tabControlHeight = currHeight;\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\t\t\r\n\t},\r\n\t\r\n\t_createContextMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.contextMenu = null;\r\n\t\tif (!jslet.ui.Menu || !Z._closable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: [\r\n   \t\t\t{ id: 'reload', name: jsletlocale.TabControl.reload},\r\n\t\t\t{ id: 'close', name: jsletlocale.TabControl.close},\r\n\t\t\t{ id: 'closeOther', name: jsletlocale.TabControl.closeOther},\r\n\t\t\t{ id: 'closeAll', name: jsletlocale.TabControl.closeAll}]\r\n\t\t\t};\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t},\r\n\r\n\t_menuItemClick: function (menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tif(menuId === 'reload') {\r\n\t\t\tthis.reload();\r\n\t\t} else if (menuId === 'close') {\r\n\t\t\tthis.close(this._contextItemIndex);\r\n\t\t} else if (menuId === 'closeOther') {\r\n\t\t\tthis.closeOther();\r\n\t\t} else if (menuId === 'closeAll') {\r\n\t\t\tthis.closeAll();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z._newTabItem) {\r\n\t\t\tZ._newTabItem.onclick = null;\r\n\t\t\tZ._newTabItem = null;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\thead = jqEl.find('.jl-tab-header')[0];\r\n\t\t\r\n\t\tjqEl.find('.jl-tab-left').off();\r\n\t\tjqEl.find('.jl-tab-right').off();\r\n\t\thead.oncontextmenu = null;\r\n\t\tjqEl.find('.jl-tab-close').off();\r\n\t\tvar items = jqEl.find('.jl-tab-list').find('li');\r\n\t\titems.off();\r\n\t\titems.each(function(){\r\n\t\t\tthis.jslet = null;\r\n\t\t});\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(this);\r\n\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('TabControl', jslet.ui.TabControl);\r\njslet.ui.TabControl.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n * @class\r\n * \r\n* Tab Item\r\n*/\r\njslet.ui.TabItem = function () {\r\n\tvar Z = this;\r\n\tZ.id = null; //{String} Element Id\r\n\tZ.index = -1; //{Integer} TabItem index\r\n\tZ.header = null; //{String} Head of tab item\r\n\tZ.closable = false; //{Boolean} Can be closed or not\r\n\tZ.disabled = false; //{Boolean} \r\n\tZ.useIFrame = false; //{Boolean}\r\n\tZ.height = '100%';\r\n\tZ.url = null; //{String} \r\n\tZ.contentId = null; //{String} \r\n\tZ.content = null; //{String} \r\n};\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Window, there are the following features: <br /> \r\n * 1. Show as modal or modeless; <br />\r\n * 2. User can change window size; <br />\r\n * 3. User can minimize/maximize/restore/close window; <br />\r\n * 4. User can move window; <br />\r\n * \r\n * Example:\r\n *\r\n *     @example\r\n *     var oWin = jslet.ui.createControl({ type: \"Window\", iconClass:\"winicon\", caption: \"test window\", minimizable: false, maximizable:false,onActive: doWinActive, onPositionChanged: doPositionChanged });\r\n *     oWin.setContent(\"Open modeless window in the Body(with icon)!\");\r\n *     oWin.show(350,250);\r\n *     //or oWin.showModel(350, 250);\r\n *\r\n */\r\njslet.ui.Window = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onActive,width,height,minWidth,maxWidth,minHeight,maxHeight,isCenter,isSmallHeader,stopEventBubbling,animation';\r\n\r\n\t\tZ._caption = null;\r\n\t\t\r\n\t\tZ._resizable = true;\r\n\t\t\r\n\t\tZ._minimizable = true;\r\n\r\n\t\tZ._maximizable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._iconClass = null;\r\n\t\t\r\n\t\tZ._width = 0;\r\n\t\t\r\n\t\tZ._height = 0;\r\n\t\t\r\n\t\tZ._minWidth = 20;\r\n\t\t\r\n\t\tZ._minHeight = 30;\r\n\t\t\r\n\t\tZ._maxWidth = -1;\r\n\r\n\t\tZ._maxHeight = -1;\r\n\r\n\t\tZ._isCenter = false;\r\n \r\n\t\tZ._animation = 'linear';\r\n\t\t\r\n\t\tZ._onSizeChanged = null;\r\n\t\t\r\n\t\tZ._onPositionChanged = null;\r\n\t\t\r\n\t\tZ._onActive = null;\r\n\t\t\r\n\t\tZ._onClosed = null;\r\n\r\n\t\tZ._stopEventBubbling = false;\r\n\t\t\r\n\t\tZ._isModal = false;\r\n\t\t\r\n\t\tZ._state = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window caption.\r\n\t * \r\n\t * @param {String | undefined} caption Window caption.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the icon class of window header.\r\n\t * \r\n\t * @param {String | undefined} iconClass The icon css class of window header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ticonClass: function(iconClass) {\r\n\t\tif(iconClass === undefined) {\r\n\t\t\treturn this._iconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.iconClass', iconClass).isString();\r\n\t\tthis._iconClass = iconClass;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be resized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} resizable True - window can be resized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tresizable: function(resizable) {\r\n\t\tif(resizable === undefined) {\r\n\t\t\treturn this._resizable;\r\n\t\t}\r\n\t\tthis._resizable = resizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be minimized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} minimizable True - window can be minimized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tminimizable: function(minimizable) {\r\n\t\tif(minimizable === undefined) {\r\n\t\t\treturn this._minimizable;\r\n\t\t}\r\n\t\tthis._minimizable = minimizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be maximized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} maximizable True - window can be maximized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tmaximizable: function(maximizable) {\r\n\t\tif(maximizable === undefined) {\r\n\t\t\treturn this._maximizable;\r\n\t\t}\r\n\t\tthis._maximizable = maximizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be closed or not.\r\n\t * \r\n\t * @param {Boolean | undefined} closable True - window can be closed, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window is shown in center of container.\r\n\t * \r\n\t * @param {Boolean | undefined} isCenter True - window is shown in center of container, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tisCenter: function(isCenter) {\r\n\t\tif(isCenter === undefined) {\r\n\t\t\treturn this._isCenter;\r\n\t\t}\r\n\t\tthis._isCenter = isCenter? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Animation effect for showing and hiding.\r\n\t * \r\n\t * @param {String | undefined} animation Animation effect for showing and hiding, optional value: 'none', 'linear', 'slide', 'fade', default is 'linear'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tanimation: function(animation) {\r\n\t\tif(animation === undefined) {\r\n\t\t\treturn this._animation;\r\n\t\t}\r\n\t\tthis._animation = animation;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether stopping the event bubble.\r\n\t * \r\n\t * @param {Boolean | undefined} stopEventBubbling True - stop event bubbling, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tstopEventBubbling: function(stopEventBubbling) {\r\n\t\tif(stopEventBubbling === undefined) {\r\n\t\t\treturn this._stopEventBubbling;\r\n\t\t}\r\n\t\tthis._stopEventBubbling = stopEventBubbling? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial width.\r\n\t * \r\n\t * @param {Integer | undefined} width Window initial width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.width', width).isGTZero();\r\n\t\tthis._width = width;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height Window initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window minimum width.\r\n\t * \r\n\t * @param {Integer | undefined} minWidth Window minimum width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminWidth: function(minWidth) {\r\n\t\tif(minWidth === undefined) {\r\n\t\t\treturn this._minWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minWidth', minWidth).isGTZero();\r\n\t\tif(minWidth < 20) {\r\n\t\t\tminWidth = 20;\r\n\t\t}\r\n\t\tthis._minWidth = minWidth;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window minimum height.\r\n\t * \r\n\t * @param {Integer | undefined} minHeight Window minimum height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminHeight: function(minHeight) {\r\n\t\tif(minHeight === undefined) {\r\n\t\t\treturn this._minHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minHeight', minHeight).isGTZero();\r\n\t\tif(minHeight < 30) {\r\n\t\t\tminHeight = 30;\r\n\t\t}\r\n\t\tthis._minHeight = minHeight;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window maximum width.\r\n\t * \r\n\t * @param {Integer | undefined} maxWidth Window maximum width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxWidth: function(maxWidth) {\r\n\t\tif(maxWidth === undefined) {\r\n\t\t\treturn this._maxWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxWidth', maxWidth).isNumber();\r\n\t\tthis._maxWidth = maxWidth;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window maximum height.\r\n\t * \r\n\t * @param {Integer | undefined} maxHeight Window maximum height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxHeight: function(maxHeight) {\r\n\t\tif(maxHeight === undefined) {\r\n\t\t\treturn this._maxHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxHeight', maxHeight).isNumber();\r\n\t\tthis._maxHeight = maxHeight;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window size changed event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onSizeChanged(function(width, height){\r\n\t *     \r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onSizeChanged Window size changed event handler.\r\n\t * @param {Integer} onSizeChanged.width Changed width.\r\n\t * @param {Integer} onSizeChanged.height Changed height.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSizeChanged: function(onSizeChanged) {\r\n\t\tif(onSizeChanged === undefined) {\r\n\t\t\treturn this._onSizeChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onSizeChanged', onSizeChanged).isFunction();\r\n\t\tthis._onSizeChanged = onSizeChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window position changed event handler. <br />\r\n\t * Fired when user changes the window's position. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onPositionChanged(function(left, top){\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onPositionChanged window position changed event handler\r\n\t * @param {Integer} onPositionChanged.left The left of changing position.\r\n\t * @param {Integer} onPositionChanged.top The top of changing position.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonPositionChanged: function(onPositionChanged) {\r\n\t\tif(onPositionChanged === undefined) {\r\n\t\t\treturn this._onPositionChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onPositionChanged', onPositionChanged).isFunction();\r\n\t\tthis._onPositionChanged = onPositionChanged;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window activated event handler. <br />\r\n\t * Fired when the window is active. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onActive(function(winObj){\r\n\t *       //windObj: jslet.ui.Window Window Object\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onActive Window activated event handler.\r\n\t * @param {jslet.ui.Window} onActive.winObj Jslet window object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonActive: function(onActive) {\r\n\t\tif(onActive === undefined) {\r\n\t\t\treturn this._onActive;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onActive', onActive).isFunction();\r\n\t\tthis._onActive = onActive;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window closed event handler. <br />\r\n\t * Fired when uses closes window. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onClosed(function(winObj){});\r\n\t * \r\n\t * @param {Function | undefined} onClosed Window closed event handler.\r\n\t * @param {jslet.ui.Window} onClosed.winObj Jslet window object.\r\n\t * @param {String} onClosed.return If return value equals 'hidden', then hide window instead of closing.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonClosed: function(onClosed) {\r\n\t\tif(onClosed === undefined) {\r\n\t\t\treturn this._onClosed;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onClosed', onClosed).isFunction();\r\n\t\tthis._onClosed = onClosed;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._closable) {\r\n\t\t\tZ._minimizable = false;\r\n\t\t\tZ._maximizable = false;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-window')) {\r\n\t\t\tjqEl.addClass('panel panel-default jl-window');\r\n\t\t}\r\n\t\tif (Z._width) {\r\n\t\t\tjqEl.width(Z._width);\r\n\t\t}\r\n\t\tif (Z._height) {\r\n\t\t\tjqEl.height(Z._height);\r\n\t\t}\r\n\t\tjqEl.css('display','none');\r\n\t\tvar template = [\r\n\t\t'<div class=\"panel-heading jl-win-header jl-win-header-sm\" style=\"cursor:move\">',\r\n\t\t\tZ._iconClass ? '<span class=\"jl-win-header-icon ' + Z._iconClass + '\"></span>' : '',\r\n\t\t\t'<span class=\"panel-title jl-win-caption\">', Z._caption ? Z._caption : '', '</span>',\r\n\t\t\t'<span class=\"jl-win-tool jl-unselectable\">'];\r\n\t\t\ttemplate.push(Z._closable ? '<button class=\"close jl-win-close\" onfocus=\"this.blur();\">x</button>' : '');\r\n\t\t\ttemplate.push(Z._maximizable ? '<button class=\"close jl-win-max\" onfocus=\"this.blur();\"></button>' : '');\r\n\t\t\ttemplate.push(Z._minimizable ? '<button class=\"close jl-win-min\" onfocus=\"this.blur();\">-</button>' : '');\r\n\t\ttemplate.push('</span></div>');\r\n\t\ttemplate.push('<div class=\"panel-body jl-win-body\"></div>');\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tjqEl.on('mousemove', Z._doWinMouseMove);\r\n\t\tjqEl.on('mousedown', Z._doWinMouseDown);\r\n\t\tjqEl.on('dblclick', function(event){\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqEl.on('click', function(event){\r\n\t\t\tif(Z._stopEventBubbling) {\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tZ._changeBodyHeight();\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tvar jqBody = jqEl.find('.jl-win-body');\r\n\t\tjqBody.on('mouseenter',function (event) {\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tif (jslet.temp_dragging) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tZ.cursor = null;\r\n\t\t\t},300);\r\n\t\t});\r\n\t\tjqBody.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\t\r\n\t\tjqHeader.on('mousedown',function (event) {\r\n\t\t\tZ.activate();\r\n\t\t\tif (Z._state == 'max') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t});\r\n\r\n\t\tjqHeader.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (!Z._maximizable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (Z._state != 'max') {\r\n\t\t\t\tZ.maximize();\r\n\t\t\t} else {\r\n\t\t\t\tZ.restore();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\theader._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._createTrackerMask(header);\r\n\t\t\tZ.trackerMask.style.cursor = header.style.cursor;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\theader._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ.setPosition(Z.left + deltaX, Z.top + deltaY, true);\r\n\t\t};\r\n\r\n\t\theader._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar left = parseInt(Z.el.style.left);\r\n\t\t\tvar top = parseInt(Z.el.style.top);\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\theader._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ.setPosition(Z.left, Z.top);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._createTrackerMask(this);\r\n\t\t\tZ._createTracker();\r\n\t\t\tZ.trackerMask.style.cursor = Z.el.style.cursor;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._changeTrackerSize(deltaX, deltaY);\r\n\t\t};\r\n\r\n\t\tZ.el._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tif (!Z.tracker) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar left = parseInt(Z.tracker.style.left);\r\n\t\t\tvar top = parseInt(Z.tracker.style.top);\r\n\t\t\tvar width = parseInt(Z.tracker.style.width);\r\n\t\t\tvar height = parseInt(Z.tracker.style.height);\r\n\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ.changeSize(width, height);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tif (Z._closable) {\r\n\t\t\tvar jqClose = jqEl.find('.jl-win-close');\r\n\t\t\tjqClose.click(function (event) {\r\n\t\t\t\tZ.close();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._minimizable) {\r\n\t\t\tvar jqMin = jqEl.find('.jl-win-min');\r\n\t\t\tjqMin.click(function (event) {\r\n\t\t\t\tZ.minimize();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._maximizable) {\r\n\t\t\tvar jqMax = jqEl.find('.jl-win-max'),\r\n\t\t\t\tbtnMax = jqMax[0];\r\n\t\t\tjqMax.click(function (event) {\r\n\t\t\t\tif (Z._state != 'max') {\r\n\t\t\t\t\tbtnMax.innerHTML = '';\r\n\t\t\t\t\tZ.maximize();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbtnMax.innerHTML = '';\r\n\t\t\t\t\tZ.restore();\r\n\t\t\t\t}\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show window at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (Z._isCenter) {\r\n\t\t\tvar jqOffsetP = jQuery(window),\r\n\t\t\t\tpw = jqOffsetP.width(),\r\n\t\t\t\tph = jqOffsetP.height();\r\n\t\t\tleft = document.body.scrollLeft + Math.round((pw - jqEl.outerWidth()) / 2);\r\n\t\t\ttop = document.body.scrollTop + Math.round((ph - jqEl.outerHeight()) / 2);\r\n\t\t\tif(left < 0) {\r\n\t\t\t\tleft = 0;\r\n\t\t\t}\r\n\t\t\tif(top < 0) {\r\n\t\t\t\ttop = 0;\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\tZ.top = top ? top : 0;\r\n\t\tZ.left = left ? left : 0;\r\n\t\tZ.el.style.left = Z.left + 'px';\r\n\t\tZ.el.style.top = Z.top + 'px';\r\n\t\tif(Z._animation == 'slide') {\r\n\t\t\tjqEl.slideDown(function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._animation == 'fade') {\r\n\t\t\tjqEl.fadeIn(function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t} else if(Z._animation == 'none') {\r\n\t\t\tjqEl.show(function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tjqEl.show('fast', function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show modal window at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshowModal: function (left, top) {\r\n\t\tvar Z = this;\r\n\t\tZ._isModal = true;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex += 10;\r\n\t\tvar k = jslet.ui.GlobalZIndex;\r\n\t\tZ.el.style.zIndex = k;\r\n\t\tZ.show(left, top);\r\n\t\tZ.overlay.setZIndex(k - 2);\r\n\t\tZ.overlay.show();\r\n\t},\r\n\r\n\t/**\r\n\t * Hide window.\r\n\t */\r\n\thide: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(Z._animation == 'slide') {\r\n\t\t\tjqEl.slideUp();\r\n\t\t} else if(Z._animation == 'fade') {\r\n\t\t\tjqEl.fadeOut();\r\n\t\t} else if(Z._animation == 'none') {\r\n\t\t\tjqEl.hide();\r\n\t\t} else {\r\n\t\t\tjqEl.hide('fast');\r\n\t\t}\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.hide();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close window, this will fire onClosed event.\r\n\t */\r\n\tclose: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.el) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._onClosed) {\r\n\t\t\tvar action = Z._onClosed.call(Z);\r\n\t\t\tif (action && action.toLowerCase() == 'hidden') {\r\n\t\t\t\tZ.hide();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pnode = Z.el.parentNode;\r\n\t\tpnode.removeChild(Z.el);\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.destroy();\r\n\t\t\tZ.overlay = null;\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex -= 10;\r\n\t\tZ.destroy();\r\n\t},\r\n\r\n\t/**\r\n\t * Minimize window.\r\n\t */\r\n\tminimize: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._state == 'min') {\r\n\t\t\tZ.restore();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._state == 'max') {\r\n\t\t\tZ.restore();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tZ._tempHeight = jqEl.height();\r\n\t\tZ._tempWidth = jqEl.width();\r\n\t\tZ.changeSize(Z._tempWidth, Z._getHeaderHeight() + 2);\r\n\t\tZ._state = 'min';\r\n\t},\r\n\r\n\t/**\r\n\t * Maximize window.\r\n\t */\r\n\tmaximize: function () {\r\n\t\tvar Z = this,\r\n\t\t\toffsetP = jQuery(window),\r\n\t\t\twidth = offsetP.width(),\r\n\t\t\theight = offsetP.height(),\r\n\t\t\tleft = document.body.scrollLeft,\r\n\t\t\ttop = document.body.scrollTop;\r\n\t\t\r\n\t\tZ.setPosition(left, top, true);\r\n\t\tif (Z._state !== 'min') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tZ._tempHeight = jqEl.height();\r\n\t\t\tZ._tempWidth = jqEl.width();\r\n\t\t}\r\n\t\tZ.changeSize(width, height);\r\n\t\tZ._state = 'max';\r\n\t},\r\n\r\n\t/**\r\n\t * Restore window.\r\n\t */\r\n\trestore: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.setPosition(Z.left, Z.top, true);\r\n\t\tZ.changeSize(Z._tempWidth, Z._tempHeight);\r\n\t\tZ._state = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Activate window, this will fire the 'OnActive' event.\r\n\t */\r\n\tactivate: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.bringToFront();\r\n\t\t}\r\n\t\tif (Z._onActive) {\r\n\t\t\tZ._onActive.call();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Change window position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t * @param {Boolean} notUpdateLeftTop True - Only change html element position, \r\n\t *\t\tnot change the inner position of Window object, it is usually use for moving action.\r\n\t */\r\n\tsetPosition: function (left, top, notUpdateLeftTop) {\r\n\t\tvar Z = this;\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 0;\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\t\tif (!notUpdateLeftTop) {\r\n\t\t\tZ.left = left;\r\n\t\t\tZ.top = top;\r\n\t\t} else {\r\n\t\t\tif (Z._onPositionChanged) {\r\n\t\t\t\tvar result = Z._onPositionChanged.call(Z, left, top);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tif (result.left) {\r\n\t\t\t\t\t\tleft = result.left;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (result.top) {\r\n\t\t\t\t\t\ttop = result.top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.el.style.left = left + 'px';\r\n\t\tZ.el.style.top = top + 'px';\r\n\t},\r\n\r\n\t/**\r\n\t * Change window size.\r\n\t * \r\n\t * @param {Integer} width Window width.\r\n\t * @param {Integer} height Window height.\r\n\t * @param {Boolean} notUpdateSize True - Only change html element size, \r\n\t *\t\tnot change the inner size of Window object, it is usually use for moving action.\r\n\t */\r\n\tchangeSize: function (width, height) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onSizeChanged) {\r\n\t\t\tZ._onSizeChanged.call(Z, width, height);\r\n\t\t}\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(width) {\r\n\t\t\tjqEl.width(width);\r\n\t\t}\r\n\t\tif(height) {\r\n\t\t\tjqEl.height(height);\r\n\t\t}\r\n\t\tZ._changeBodyHeight();\r\n\t},\r\n\r\n\t_getHeaderHeight: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHeader = jqEl.find('.jl-win-header');\r\n\t\treturn jqHeader.outerHeight() || 30;\r\n\t},\r\n\t\r\n\t_changeBodyHeight: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._height) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqBody = jqEl.find('.jl-win-body');\r\n\t\tjqBody.outerHeight(jqEl.innerHeight() - Z._getHeaderHeight());\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get window caption element. You can use it to customize window caption.\r\n\t * \r\n\t * @return {HtmlElement}\r\n\t */\r\n\tgetCaptionPanel: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-caption')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Change window caption.\r\n\t * \r\n\t * @param {String} caption Window caption.\r\n\t */\r\n\tchangeCaption: function (caption) {\r\n\t\tthis.caption = caption;\r\n\t\tvar captionDiv = jQuery(this.el).find('.jl-win-caption');\r\n\t\tcaptionDiv.html(caption);\r\n\t},\r\n\r\n\t/**\r\n\t * Get window content element. You can use it to customize window content.\r\n\t * \r\n\t * @return {HtmlElement}\r\n\t */\r\n\tgetContentPanel: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-body')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Set window content.\r\n\t * \r\n\t * @param {String} html Html text for window content.\r\n\t */\r\n\tsetContent: function (html) {\r\n\t\tif (!html){\r\n\t\t\tjslet.showError('Window content cannot be null!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar bodyDiv = jQuery(this.el).find('.jl-win-body');\r\n\t\tif (html && html.toLowerCase) {\r\n\t\t\tbodyDiv.html(html);\r\n\t\t} else {\r\n\t\t\tbodyDiv.html('');\r\n\t\t\t\r\n\t\t\thtml.parentNode.removeChild(html);\r\n\t\t\tbodyDiv[0].appendChild(html);\r\n\t\t\tif (html.style && html.style.display == 'none') {\r\n\t\t\t\thtml.style.display = 'block';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Bring window to front.\r\n\t */\r\n\tbringToFront: function () {\r\n\t\tvar Z = this;\r\n\t\tvar p = Z.el.parentNode;\r\n\t\tvar node, jqEl = jQuery(Z.el);\r\n\t\tvar maxIndex = 0, jqNode, winIdx;\r\n\t\tfor (var i = 0, cnt = p.childNodes.length; i < cnt; i++) {\r\n\t\t\tnode = p.childNodes[i];\r\n\t\t\tif (node.nodeType != 1 || node == Z.el) {\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqEl.find('.jl-win-header').addClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tjqNode = jQuery(node);\r\n\t\t\t\r\n\t\t\tif (jqNode.hasClass('jl-window')) {\r\n\t\t\t\twinIdx = parseInt(node.style.zIndex) || 0;\r\n\t\t\t\tif (maxIndex < winIdx) {\r\n\t\t\t\t\tmaxIndex = winIdx;\r\n\t\t\t\t}\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqNode.find('.jl-win-header').removeClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar styleObj = jqEl.getStyleObject();\r\n\t\twinIdx = parseInt(styleObj.zIndex) || 0;\r\n\t\tif (winIdx <= maxIndex) {\r\n\t\t\tZ.setZIndex(maxIndex + 2);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Set window Z-Index.\r\n\t * \r\n\t * @param {Integer} zIndex Z-Index.\r\n\t */\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.el.style.zIndex = zIndex;\r\n\t\tif(this.overlay) {\r\n\t\t\tthis.overlay.setZIndex(zIndex - 2);\r\n\t\t}\r\n\t},\r\n\r\n\t_checkSize: function (width, height) {\r\n\t\tvar Z = this;\r\n\t\tif (width) {\r\n\t\t\tif (width < Z._minWidth || Z._maxWidth > 0 && width > Z._maxWidth) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (height) {\r\n\t\t\tif (height < Z.minHeight || Z._maxHeight > 0 && height > Z._maxHeight) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_changeTrackerSize: function (deltaX, deltaY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.tracker || !Z.cursor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\tw = jqEl.width(), \r\n\t\t\th = jqEl.height(), \r\n\t\t\ttop = null, left = null;\r\n\r\n\t\tif (Z.cursor == 'nw') {\r\n\t\t\tw = w - deltaX;\r\n\t\t\th = h - deltaY;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t} else if (Z.cursor == 'n') {\r\n\t\t\th = h - deltaY;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t} else if (Z.cursor == 'ne') {\r\n\t\t\th = h - deltaY;\r\n\t\t\tw = w + deltaX;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t} else if (Z.cursor == 'e') {\r\n\t\t\tw = w + deltaX;\r\n\t\t} else if (Z.cursor == 'se') {\r\n\t\t\tw = w + deltaX;\r\n\t\t\th = h + deltaY;\r\n\t\t} else if (Z.cursor == 's'){\r\n\t\t\th = h + deltaY;\r\n\t\t} else if (Z.cursor == 'sw') {\r\n\t\t\th = h + deltaY;\r\n\t\t\tw = w - deltaX;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t} else if (Z.cursor == 'w') {\r\n\t\t\tw = w - deltaX;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t}\r\n\r\n\t\tif (!Z._checkSize(w, h)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqTracker = jQuery(Z.tracker);\r\n\t\tif (w) {\r\n\t\t\tjqTracker.width(w);\r\n\t\t}\r\n\t\tif (h) {\r\n\t\t\tjqTracker.height(h);\r\n\t\t}\r\n\t\tif (top) {\r\n\t\t\tZ.tracker.style.top = top + 'px';\r\n\t\t}\r\n\t\tif (left) {\r\n\t\t\tZ.tracker.style.left = left + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_doWinMouseMove: function (event) {\r\n\t\tif (jslet.temp_dragging) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tvar srcEl = event.target, jqSrcEl = jQuery(srcEl);\r\n\t\t\r\n\t\tif (!jqSrcEl.hasClass('jl-window')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!srcEl.jslet._resizable || srcEl.jslet._state) {\r\n\t\t\tsrcEl.jslet.cursor = null;\r\n\t\t\tsrcEl.style.cursor = 'default';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = jqSrcEl.offset(),\r\n\t\t\tx = event.pageX - pos.left,\r\n\t\t\ty = event.pageY - pos.top,\r\n\t\t\tw = jqSrcEl.width(),\r\n\t\t\th = jqSrcEl.height();\r\n\t\tvar delta = 8, wdelta = w - delta, hdelta = h - delta, cursor = null;\r\n\t\tif (x <= delta && y <= delta) {\r\n\t\t\tcursor = 'nw';\r\n\t\t} else if (x > delta && x < wdelta && y <= delta) {\r\n\t\t\tcursor = 'n';\r\n\t\t} else if (x >= wdelta && y <= delta) {\r\n\t\t\tcursor = 'ne';\r\n\t\t} else if (x >= wdelta && y > delta && y <= hdelta) {\r\n\t\t\tcursor = 'e';\r\n\t\t} else if (x >= wdelta && y >= hdelta) {\r\n\t\t\tcursor = 'se';\r\n\t\t} else if (x > delta && x < wdelta && y >= hdelta) {\r\n\t\t\tcursor = 's';\r\n\t\t} else if (x <= delta && y >= hdelta) {\r\n\t\t\tcursor = 'sw';\r\n\t\t} else if (x <= delta && y > delta && y < hdelta) {\r\n\t\t\tcursor = 'w';\r\n\t\t}\r\n\t\t\r\n\t\tsrcEl.jslet.cursor = cursor;\r\n\t\tsrcEl.style.cursor = cursor ? cursor + '-resize' : 'default';\r\n\t},\r\n\r\n\t_doWinMouseDown: function (event) {\r\n\t\tvar ojslet = this.jslet;\r\n\t\tojslet.activate();\r\n\t\tif (ojslet.cursor) {\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_createTrackerMask: function (holder) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body);\r\n\r\n\t\tZ.trackerMask = document.createElement('div');\r\n\t\tjQuery(Z.trackerMask).addClass('jl-win-tracker-mask');\r\n\t\tZ.trackerMask.style.top = '0px';\r\n\t\tZ.trackerMask.style.left = '0px';\r\n\t\tZ.trackerMask.style.zIndex = 99998;\r\n\t\tZ.trackerMask.style.width = jqBody.width() + 'px';\r\n\t\tZ.trackerMask.style.height = jqBody.height() + 'px';\r\n\t\tZ.trackerMask.style.display = 'block';\r\n\t\tZ.trackerMask.onmousedown = function () {\r\n\t\t\tif (holder && holder._doDragCancel) {\r\n\t\t\t\tholder._doDragCancel();\r\n\t\t\t}\r\n\t\t};\r\n\t\tjqBody[0].appendChild(Z.trackerMask);\r\n\t},\r\n\r\n\t_removeTrackerMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t\tdocument.body.removeChild(Z.trackerMask);\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t},\r\n\r\n\t_createTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\tw = jqEl.width(), \r\n\t\t\th = jqEl.height();\r\n\t\t\r\n\t\tZ.tracker = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z.tracker);\r\n\t\tjqTracker.addClass('jl-win-tracker');\r\n\t\tZ.tracker.style.top = Z.top + 'px';\r\n\t\tZ.tracker.style.left = Z.left + 'px';\r\n\t\tZ.tracker.style.zIndex = 99999;\r\n\t\tjqTracker.width(w);\r\n\t\tjqTracker.height(h);\r\n\t\tZ.tracker.style.display = 'block';\r\n\t\tZ.el.parentNode.appendChild(Z.tracker);\r\n\t},\r\n\r\n\t_removeTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\tZ.el.parentNode.removeChild(Z.tracker);\r\n\t\t}\r\n\t\tZ.tracker = null;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjslet.ui.uninstall(Z.el);\r\n\r\n\t\tjqEl.find('.jl-win-max').off();\r\n\t\tjqEl.find('.jl-win-min').off();\r\n\t\tjqEl.find('.jl-win-close').off();\r\n\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tjqHeader.off();\r\n\t\tjqEl.find('.jl-win-body').off();\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t\tZ.el._doDragCancel = null;\r\n\t\tZ.el._doDragEnd = null;\r\n\t\tZ.el._doDragging = null;\r\n\t\tZ.el._doDragStart = null;\r\n\t\theader._doDragCancel = null;\r\n\t\theader._doDragEnd = null;\r\n\t\theader._doDragging = null;\r\n\t\theader._doDragStart = null;\r\n\t\tif ($super) {\r\n\t\t\t$super();\r\n\t\t}\r\n\t}\r\n});\r\njslet.ui.register('Window', jslet.ui.Window);\r\njslet.ui.Window.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * \r\n * Field control add-on.\r\n */\r\njslet.ui.FieldControlAddon = {\r\n\t/**\r\n\t * @property {String} field Field name if the add-on is another field, like: 'currency' \r\n\t */\r\n\tfield: null,\r\n\t/**\r\n\t * @property {String} content Fixed content if the add-on is the fixed content, like: 'kg'\r\n\t */\r\n\tcontent: null,\r\n\t\r\n\t/**\r\n\t * @property {String} width The add-on width.\r\n\t */\r\n\twidth: '10px'\r\n};\r\n\r\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBPlace. It's an placeholder for other DBControls. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBPlace\",dataset: \"dataset\", \"field\":\"fieldName\", suffix: [{\"content\": \"KG\", \"width\": \"10px\"}] };\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBPlace = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field,prefix,suffix,expandChildWidth';\r\n\t\t\r\n\t\tthis.editControl = null;\r\n\t\t\r\n\t\tthis._expandChildWidth = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Prefix of this control. Example:\r\n\t * \r\n\t *     @example\r\n\t *     dbPlaceObj.prefix([{field: '', content: '', width: 30}]);\r\n\t * \r\n\t * @param {jslet.ui.FieldControlAddon[] | undefined} prefix - The prefix settings.\r\n\t * \r\n\t * @return {this | jslet.ui.FieldControlAddon[]}\r\n\t */\r\n\tprefix: function(prefix) {\r\n\t\tif(prefix === undefined) {\r\n\t\t\treturn this._prefix;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBPlace#prefix', prefix).isArray();\r\n\t\tvar setting;\r\n\t\tfor(var i = 0, len = prefix.length; i < len; i++) {\r\n\t\t\tsetting = prefix[i];\r\n\t\t\tif(!setting.field && !setting.content) {\r\n\t\t\t\tthrow new Error('In DBPlace#prefix setting, one of property \"field\" or \"content\" is required!');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(prefix && prefix.length === 0) {\r\n\t\t\tprefix = null;\r\n\t\t}\r\n\t\tthis._prefix = prefix;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * Suffix of this control. Example:\r\n\t * \r\n\t *     @example\r\n\t *     dbPlaceObj.suffix([{field: '', content: '', width: 30}]);\r\n\t * \r\n\t * @param {jslet.ui.FieldControlAddon[] | undefined} suffix - The suffix settings. \r\n\t * \r\n\t * @return {this | jslet.ui.FieldControlAddon[]}\r\n\t */\r\n\tsuffix: function(suffix) {\r\n\t\tif(suffix === undefined) {\r\n\t\t\treturn this._suffix;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBPlace#suffix', suffix).isArray();\r\n\t\tjslet.Checker.test('DBPlace#suffix', suffix).isArray();\r\n\t\tvar setting;\r\n\t\tfor(var i = 0, len = suffix.length; i < len; i++) {\r\n\t\t\tsetting = suffix[i];\r\n\t\t\tif(!setting.field && !setting.content) {\r\n\t\t\t\tthrow new Error('In DBPlace#suffix setting, one of property \"field\" or \"content\" is required!');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(suffix && suffix.length === 0) {\r\n\t\t\tsuffix = null;\r\n\t\t}\r\n\t\tthis._suffix = suffix; \r\n\t\treturn this;\r\n\t},\r\n\t\r\n\texpandChildWidth: function(expandChildWidth) {\r\n\t\tif(expandChildWidth === undefined) {\r\n\t\t\treturn this._expandChildWidth;\r\n\t\t}\r\n\t\tthis._expandChildWidth = expandChildWidth? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA &&\r\n\t\t\tZ._field == evt.fieldName && \r\n\t\t\t(evt.metaName == 'editControl' || evt.metaName == 'valueStyle')) {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\t\r\n\t\tvar fldName, i, len,\r\n\t\t\thasAddon = Z._prefix || Z._suffix;\r\n\t\tif(!hasAddon) {\r\n\t\t\tZ._renderEditor(Z._field, Z.el);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tjQuery(Z.el).addClass('jl-comb-editor');\r\n\t\tif(Z._prefix) {\r\n\t\t\tZ._renderOtherPart(Z.el, Z._prefix);\r\n\t\t}\r\n\t\tvar editorEl = Z._renderEditor(Z._field, Z.el);\r\n\t\tjQuery(editorEl).addClass('jl-comb-master');\r\n\t\t\r\n\t\tif(Z._suffix) {\r\n\t\t\tZ._renderOtherPart(Z.el, Z._suffix);\r\n\t\t}\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_renderEditor: function(fldName, parentEl) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(fldName),\r\n\t\t\tparam = fldObj.editControl();\r\n\t\tif (fldObj.valueStyle() == jslet.data.FieldValueStyle.BETWEEN && Z._valueIndex === undefined) {\r\n\t\t\tparam = {\r\n\t\t\t\ttype: 'DBBetweenEdit'\r\n\t\t\t};\r\n\t\t}\r\n\t\tparam.dataset = Z._dataset;\r\n\t\tparam.field = fldName;\r\n\t\tif(Z._valueIndex !== undefined) {\r\n\t\t\tparam.valueIndex = Z._valueIndex;\r\n\t\t}\r\n\t\tif(Z._tabIndex || Z._tabIndex === 0) {\r\n\t\t\tparam.tabIndex = Z._tabIndex;\r\n\t\t}\r\n\t\tvar dbCtrl = jslet.ui.createControl(param, parentEl);\r\n\t\tZ.addChildControl(dbCtrl);\r\n\t\tif(dbCtrl.tableId) {\r\n\t\t\tdbCtrl.tableId(Z._tableId);\r\n\t\t}\r\n\t\tvar elId = jslet.nextId();\r\n\t\tdbCtrl.el.id = elId;\r\n\t\treturn dbCtrl.el;\r\n\t},\r\n\t\r\n\t_renderOtherPart: function(ctrlDiv, arrPrefixOrSuffix) {\r\n\t\tvar fixCfg, editorEl, width, partEl, \r\n\t\t\tjqCtrlDiv = jQuery(ctrlDiv);\r\n\t\tfor(var i = 0, len = arrPrefixOrSuffix.length; i < len; i++) {\r\n\t\t\tfixCfg = arrPrefixOrSuffix[i];\r\n\t\t\twidth = fixCfg.width;\r\n\t\t\tvar id = jslet.nextId();\r\n\t\t\tjqCtrlDiv.append('<span id = \"' + id + '\"></span>');\r\n\t\t\tpartEl = document.getElementById(id);\r\n\t\t\tif(fixCfg.field) {\r\n\t\t\t\t this._renderEditor(fixCfg.field, partEl);\r\n\t\t\t} else if(fixCfg.content) {\r\n\t\t\t\tpartEl.innerHTML = fixCfg.content;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('prefix or suffix: field or content is required!');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(!width) {\r\n\t\t\t\tconsole.warn('Width is empty, use 5% instead!');\r\n\t\t\t\twidth = '5%';\r\n\t\t\t}\r\n\t\t\tjQuery(partEl).addClass('jl-comb-addon').children().first().addClass('input-sm');\r\n\t\t\t\r\n\t\t\tpartEl.style.width = width;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPlace', jslet.ui.DBPlace);\r\njslet.ui.DBPlace.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBText is a powerful control, it can input any data type, like: Number, Date etc. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBText,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBText,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBText = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll,readOnly';\r\n\r\n\t\t/**\r\n\t\t * @protected\r\n\t\t */\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\t\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._enterProcessed = false;\r\n\t\t\r\n\t\tZ._autoSelectAll = true;\r\n\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ.oldValue = null;\r\n\t\tZ.editMask = null;\r\n\t\tZ._position = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeUpdateToDataset: function(beforeUpdateToDataset) {\r\n\t\tif(beforeUpdateToDataset === undefined) {\r\n\t\t\treturn this._beforeUpdateToDataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.beforeUpdateToDataset', beforeUpdateToDataset).isFunction();\r\n\t\tthis._beforeUpdateToDataset = beforeUpdateToDataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tenableInvalidTip: function(enableInvalidTip) {\r\n\t\tif(enableInvalidTip === undefined) {\r\n\t\t\treturn this._enableInvalidTip;\r\n\t\t}\r\n\t\tthis._enableInvalidTip = enableInvalidTip? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly? true: false;\r\n\t\tif(readOnly) {\r\n\t\t\tthis.el.readOnly = true;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether selecting all text when the text box got focus.\r\n\t * \r\n\t * @param {Boolean | undefined} autoSelectAll True - select all text, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoSelectAll: function(autoSelectAll) {\r\n\t\tif(autoSelectAll === undefined) {\r\n\t\t\treturn this._autoSelectAll;\r\n\t\t}\r\n\t\tthis._autoSelectAll = autoSelectAll? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' && \r\n\t\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('form-control input-sm');\r\n\t\tZ.el.name = Z._field;\r\n\t\tif (Z.doFocus) {\r\n\t\t\tjqEl.on('focus', jQuery.proxy(Z.doFocus, Z));\r\n\t\t}\r\n\t\tif (Z.doBlur) {\r\n\t\t\tjqEl.on('blur', jQuery.proxy(Z.doBlur, Z));\r\n\t\t}\r\n\t\tif (Z.doKeydown) {\r\n\t\t\tjqEl.on('keydown', Z.doKeydown);\r\n\t\t}\r\n\t\tif (Z.doKeypress) {\r\n\t\t\tjqEl.on('keypress', Z.doKeypress);\r\n\t\t}\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipFocusEvent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\tZ.doValueChanged();\r\n\t\tZ.oldValue = Z.el.value;\r\n\t\tif(Z._autoSelectAll) {\r\n\t\t\tjslet.ui.TextUtil.selectText(Z.el);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(jqEl.attr('readOnly') || jqEl.attr('disabled')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t\tZ._isBluring = true;\r\n\t\ttry {\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tZ._isBluring = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which;\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tvar Z = this.jslet,\r\n\t\t\tK = jslet.ui.KeyCode;\r\n\t\tif(keyCode === K.ENTER) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\t//Process 'ArrowUp', 'ArrowDown', 'PageUp', 'PageDown' key when it is editing. \r\n\t\tvar isEditing = Z._dataset.status() > 0;\r\n\t\tif(isEditing && (keyCode === K.UP || keyCode === K.DOWN || keyCode === K.PAGEUP || keyCode === K.PAGEDOWN)) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.readOnly() && !fldObj.disabled() && (keyCode === K.BACKSPACE || keyCode === K.DELETE)) {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t}\r\n\t\tif(keyCode === K.LEFT || keyCode === K.RIGHT) { //Arrow-left, Arrow-right\r\n\t\t\tvar pos = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\t\tif((keyCode === K.LEFT && pos.begin > 0) || \r\n\t\t\t\t\t(keyCode === 39 && pos.begin < Z.el.value.length)) {\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tvar Z = this.jslet,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which,\r\n\t\t\texistStr = jslet.cutString(Z.el.value, jslet.ui.TextUtil.getSelectedText(Z.el)),\r\n\t\t\tcursorPos = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\tif (!Z._dataset.fieldValidator().checkInputChar(fldObj, String.fromCharCode(keyCode), existStr, cursorPos.begin)) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tif(keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\tif(!Z._enterProcessed) {\r\n\t\t\t\tZ.updateToDataset();\r\n\t\t\t} else {\r\n\t\t\t\tZ._enterProcessed = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select text.\r\n\t * \r\n\t * @param {Integer} start (Optional) Start of cursor position.\r\n\t * @param {Integer} end (Optional) End of cursor position.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tselectText: function(start, end){\r\n\t\tjslet.ui.TextUtil.selectText(this.el, start, end);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Input a text into text control at current cursor position.\r\n\t * \r\n\t * @param {String} text The text need to be input.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tinputText: function(text) {\r\n\t\tif(!text) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.inputText#text', text).isString();\r\n\t\t\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(fldObj.getType() !== jslet.data.DataType.STRING) {\r\n\t\t\tconsole.warn('Only String Field can be input!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ch, chs = [];\r\n\t\tfor(var i = 0, len = text.length; i < len; i++) {\r\n\t\t\tch = text[i];\r\n\t\t\tif (Z._dataset.fieldValidator().checkInputChar(fldObj, ch)) {\r\n\t\t\t\tchs.push(ch);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z._position) {\r\n\t\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\t}\r\n\t\tvar subStr = chs.join(''),\r\n\t\t\tvalue =Z.el.value,\r\n\t\t\tbegin = Z._position.begin,\r\n\t\t\tend = Z._position.end;\r\n\t\tvar prefix = value.substring(0, begin), \r\n\t\t\tsuffix = value.substring(end); \r\n\t\tZ.el.value = prefix + text + suffix;\r\n\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\t\t\r\n\t\tZ.updateToDataset();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function ($super, evt, isForce) {\r\n\t\tif($super(evt, isForce) && this.afterRefreshControl) {\r\n\t\t\tthis.afterRefreshControl(evt);\r\n\t\t}\r\n\t}, \r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!Z._readOnly && (!metaName || metaName == \"disabled\" || metaName == \"readOnly\")) {\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, fldObj.disabled(), fldObj.readOnly(), false, fldObj.required());\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'editMask') {\r\n\t\t\tvar editMaskCfg = fldObj.editMask();\r\n\t\t\tif (editMaskCfg) {\r\n\t\t\t\tif(!Z.editMask) {\r\n\t\t\t\t\tZ.editMask = new jslet.ui.EditMask();\r\n\t\t\t\t\tZ.editMask.attach(Z.el);\r\n\t\t\t\t}\r\n\t\t\t\tvar mask = editMaskCfg.mask,\r\n\t\t\t\t\tkeepChar = editMaskCfg.keepChar,\r\n\t\t\t\t\ttransform = editMaskCfg.transform;\r\n\t\t\t\tZ.editMask.setMask(mask, keepChar, transform);\r\n\t\t\t} else {\r\n\t\t\t\tif(Z.editMask) {\r\n\t\t\t\t\tZ.editMask.detach();\r\n\t\t\t\t\tZ.editMask = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\t\r\n\t\tZ.el.maxLength = fldObj.getEditLength();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText || Z._dataset.getFieldText(Z._field);\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tvar align = fldObj.alignment();\r\n\t\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tif (align == 'left') {\r\n\t\t\t\talign= 'right';\r\n\t\t\t} else {\r\n\t\t\t\talign = 'left';\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.el.style.textAlign = align;\r\n\t\tvar value;\r\n\t\tif (Z.editMask){\r\n\t\t\tvalue = Z.getText();\r\n\t\t\tZ.editMask.setValue(value);\r\n\t\t} else {\r\n\t\t\tif (document.activeElement != Z.el || Z.el.readOnly || Z._isBluring) {\r\n\t\t\t\tvalue = Z.getText(false);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getText(true);\r\n\t\t\t}\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.STRING && fldObj.antiXss()) {\r\n\t\t\t\tvalue = jslet.htmlDecode(value);\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t}\r\n\t\tZ.oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tthis.doValueChanged();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t}, // end renderAll\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar value = Z.el.value;\r\n\t\tif(Z.oldValue == value) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tif (this.editMask && !this.editMask.validateValue()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (Z._beforeUpdateToDataset) {\r\n\t\t\tif (!Z._beforeUpdateToDataset.call(Z)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tif (Z.editMask) {\r\n\t\t\t\tvalue = Z.editMask.getValue();\r\n\t\t\t}\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tif (Z.editMask){\r\n\t\t\tZ.editMask.detach();\r\n\t\t\tZ.editMask = null;\r\n\t\t}\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\tZ.onKeyDown = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBText', jslet.ui.DBText);\r\njslet.ui.DBText.htmlTemplate = '<input type=\"text\"></input>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBPassword.\r\n */\r\njslet.ui.DBPassword = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tjQuery(el).attr('type', 'password');\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPassword', jslet.ui.DBPassword);\r\njslet.ui.DBPassword.htmlTemplate = '<input type=\"password\"></input>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBTextArea.\r\n */\r\njslet.ui.DBTextArea = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'textarea';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBTextArea', jslet.ui.DBTextArea);\r\njslet.ui.DBTextArea.htmlTemplate = '<textarea></textarea>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCustomComboBox: used for jslet.ui.DBComboSelect and jslet.ui.DBDatePicker.\r\n */\r\njslet.ui.DBCustomComboBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textReadOnly';\r\n\t\tZ._textReadOnly = false;\r\n\t\tZ.enableInvalidTip = false;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the text box is read only.\r\n\t * \r\n\t * @param {Boolean | undefined} textReadOnly True - text box is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\ttextReadOnly: function(textReadOnly) {\r\n\t\tif(textReadOnly === undefined) {\r\n\t\t\treturn this._textReadOnly;\r\n\t\t}\r\n\t\tthis._textReadOnly = textReadOnly ? true: false;\r\n\t\tif(this.textCtrl) {\r\n\t\t\tthis.textCtrl.readOnly(textReadOnly);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n//\t/**\r\n//\t * @protected\r\n//\t * @override\r\n//\t */\r\n//\tafterBind: function ($super) {\r\n//\t\t$super();\r\n//\t\t\r\n//\t\tif (this._textReadOnly) {\r\n//\t\t\tthis.el.childNodes[0].readOnly = true;\r\n//\t\t}\r\n//\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('input-group')) {\r\n\t\t\tjqEl.addClass('input-group input-group-sm');\r\n\t\t}\r\n\t\tvar btnCls = Z.comboButtonCls ? Z.comboButtonCls:'fa-caret-down'; \r\n\t\tvar s = '<input type=\"text\" class=\"form-control\">' + \r\n    \t'<span class=\"input-group-btn jl-comb-btn-group\"><button class=\"btn btn-default btn-sm \" tabindex=\"-1\"><i class=\"fa ' + btnCls + '\"></i></button></span>'; \r\n\t\tjqEl.html(s);\r\n\t\tvar dbtext = jqEl.find('[type=\"text\"]')[0];\r\n\t\tZ.textCtrl = new jslet.ui.DBText(dbtext, {\r\n\t\t\ttype: 'dbtext',\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._textField || Z._field,\r\n\t\t\tenableInvalidTip: true,\r\n\t\t\tvalueIndex: Z._valueIndex,\r\n\t\t\ttabIndex: Z._tabIndex,\r\n\t\t\treadOnly: Z._textReadOnly\r\n\t\t});\r\n\t\tjQuery(dbtext).on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.BACKSPACE && !this.value) {\r\n\t\t\t\tZ.buttonClick();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(dbtext).on('click', function(event) {\r\n\t\t\tif(Z._textReadOnly) {\r\n\t\t\t\tZ.buttonClick();\r\n\t\t\t}\r\n       \t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n       \t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tZ.addChildControl(Z.textCtrl);\r\n\t\t\r\n\t\tvar jqBtn = jqEl.find('button');\r\n\t\tif (this.buttonClick) {\r\n\t\t\t\r\n\t\t\tjqBtn.on('click', function(event){\r\n\t\t\t\tZ.buttonClick(jqBtn[0]);\r\n\t\t\t});\r\n\t\t\tjqBtn.focus(function(event) {\r\n\t\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t\t});\r\n\t\t\tjqBtn.blur(function(event) {\r\n\t\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function ($super, tableId) {\r\n\t\t$super(tableId);\r\n\t\tthis.textCtrl.tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._textReadOnly) {\r\n\t\t\tjQuery(Z.el).find('button').focus();\r\n\t\t} else {\r\n\t\t\tZ.textCtrl.focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this;\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tflag = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tjqEl.find('button').attr(\"disabled\", flag);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tvar dbbtn = Z.el.childNodes[1];\r\n\t\tdbbtn.onclick = null;\r\n\t\tjQuery(Z.textCtrl.el).off('keydown', this.popupUp);\r\n\t\tZ.textCtrl.destroy();\r\n\t\tZ.textCtrl = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBAutoComplete. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBAutoComplete\",field:\"department\", matchType:\"start\"};\r\n *     //1. Declaring:\r\n *      <input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      \r\n *     //2. Binding\r\n *      <input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      //Js snippet\r\n *      var el = document.getElementById('cboAuto');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBAutoComplete = jslet.Class.create(jslet.ui.DBText, {\r\n\t\r\n\tMatchModes: ['start','end', 'any'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.allProperties) {\r\n\t\t\tZ.allProperties = 'styleClass,dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields';\r\n\t\t}\r\n\t\t\r\n\t\tZ._lookupField = null;\r\n\t\t\r\n\t\tZ._minChars = 0;\r\n\r\n\t\tZ._minDelay = 0;\r\n\t\t\r\n\t\tZ._beforePopup = null;\r\n\t\t\r\n\t\tZ._filterFields = null;\r\n\t\t\r\n\t\tZ._defaultFilterFields = null;\r\n\t\t\r\n\t\tZ._onGetFilterField = null;\r\n\t\t\r\n\t\tZ._matchMode = 'start';\r\n\t\t\r\n\t\tZ._timeoutHandler = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get lookup field name.\r\n\t * \r\n\t * @param {String | undefined} lookupField Lookup field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupField: function(lookupField) {\r\n\t\tif(lookupField === undefined) {\r\n\t\t\treturn this._lookupField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.lookupField', lookupField).isString();\r\n\t\tthis._lookupField = lookupField;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get minimum characters before searching. <br />\r\n\t * Suppose minChars = 3, when user input 1 character, the search panel would not pop up. After user input 3 characters, the search panel pops up.\r\n\t * \r\n\t * @param {Integer | undefined} minChars Minimum characters before searching.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminChars: function(minChars) {\r\n\t\tif(minChars === undefined) {\r\n\t\t\treturn this._minChars;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minChars', minChars).isGTEZero();\r\n\t\tthis._minChars = parseInt(minChars);\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get delay time(ms) before auto searching. If user input the value very quickly, the searching panel would not pop up.\r\n\t * \r\n\t * @param {Integer | undefined} minDelay Delay time.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminDelay: function(minDelay) {\r\n\t\tif(minDelay === undefined) {\r\n\t\t\treturn this._minDelay;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minDelay', minDelay).isGTEZero();\r\n\t\tthis._minDelay = parseInt(minDelay);\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get match mode.\r\n\t * \r\n\t * @param {String | undefined} matchMode match mode, optional values: 'start'(default), 'end', 'any'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tmatchMode: function(matchMode) {\r\n\t\tif(matchMode === undefined) {\r\n\t\t\treturn this._matchMode;\r\n\t\t}\r\n\t\tmatchMode = jQuery.trim(matchMode);\r\n\t\tvar checker = jslet.Checker.test('DBAutoComplete.matchMode', matchMode).isString();\r\n\t\tmatchMode = matchMode.toLowerCase();\r\n\t\tchecker.testValue(matchMode).inArray(this.MatchModes);\r\n\t\tthis._matchMode = matchMode;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get filter fields, more than one fields are separated with ','. <br />\r\n\t * Filter fields is used to match the inputting value.\r\n\t * \r\n\t * @param {String | undefined} filterFields Filter fields.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tfilterFields: function(filterFields) {\r\n\t\tvar Z = this;\r\n\t\tif(filterFields === undefined) {\r\n\t\t\treturn Z._filterFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.filterFields', filterFields).isString();\r\n\t\tZ._filterFields = filterFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get before pop up event handler, you can use this to customize the display result. Example:\r\n\t * \r\n\t *     @example\r\n\t *     autoCompleteObj.beforePopup(function(dataset, inputValue){});\r\n\t * \r\n\t * @param {Function | undefined} beforePopup Before pop up event handler.\r\n\t * @param {jslet.data.Dataset} beforePopup.dataset Dataset object.\r\n\t * @param {String} beforePopup.inputValue Input value.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforePopup: function(beforePopup) {\r\n\t\tif(beforePopup === undefined) {\r\n\t\t\treturn this._beforePopup;\r\n\t\t}\r\n\t\tthis._beforePopup = beforePopup;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get filter field event handler, you can use this to customize the display result.. Example:\r\n\t * \r\n\t *     @example\r\n\t *     autoCompleteObj.onGetFilterField(function(dataset, inputValue){});\r\n\t *   \r\n\t * @param {Function | undefined} onGetFilterField Filter field event handler.\r\n\t * @param {jslet.data.Dataset} onGetFilterField.dataset Dataset object.\r\n\t * @param {String} onGetFilterField.inputValue Input value.\r\n\t * @param {String} onGetFilterField.return Filter field name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonGetFilterField: function(onGetFilterField) {\r\n\t\tif(onGetFilterField === undefined) {\r\n\t\t\treturn this._onGetFilterField;\r\n\t\t}\r\n\t\tthis._onGetFilterField = onGetFilterField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' &&\r\n\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.el.disabled || Z.el.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\tif(Z._isSelecting) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar value = Z.el.value, canBlur = true;\r\n\t\t\tif(!Z._lookupField) {\r\n\t\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tvar\tlkf = fldObj.lookup(),\r\n\t\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif(value.length > 0 && lkds.recordCount() === 0) {\r\n\t\t\t\t\tcanBlur = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\t\tZ.contentPanel.closePopup();\r\n\t\t\t}\r\n\t\t\tZ.updateToDataset();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t\tif(!canBlur) {\r\n\t\t\t\tZ.el.focus();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ.updateToDataset();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t}\r\n\t},\r\n\r\n\tdoChange: null,\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\r\n\t\tvar keyCode = event.which, \r\n\t\t\tZ = this.jslet,\r\n\t\t\tK = jslet.ui.KeyCode;\r\n\t\tif(keyCode >= K.F1 && keyCode <= K.F12 || keyCode === K.SHIFT || keyCode === K.CONTROL || keyCode === K.ALT || \r\n\t\t\t\tkeyCode === K.CAPSLOCK || keyCode === K.INSERT || keyCode === K.HOME || keyCode === K.END || \r\n\t\t\t\tkeyCode === K.PAGEUP || keyCode === K.PAGEDOWN || keyCode === K.LEFT || keyCode === K.RIGHT) { \r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(keyCode === K.ESCAPE && Z.contentPanel) {\r\n\t\t\tZ.contentPanel.closePopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyCode === K.UP || keyCode === K.DOWN) {\r\n\t\t\tif(Z.contentPanel && Z.contentPanel.isPop) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\t\tlkf = fldObj.lookup(),\r\n\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif (keyCode === K.UP) { //up arrow\r\n\t\t\t\t\tlkds.prior();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t\tif (keyCode === K.DOWN) {//down arrow\r\n\t\t\t\t\tlkds.next();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!Z.tableId()) {\r\n\t\t\t\t\tZ._invokePopup();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t} \r\n\r\n\t\tif (keyCode === K.DELETE || keyCode === K.BACKSPACE || keyCode === K.IME) {\r\n\t\t\tZ._invokePopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyCode !== K.ENTER && keyCode !== K.TAB) {\r\n\t\t\tZ._invokePopup();\r\n\t\t} else if (Z.contentPanel) {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\tZ.contentPanel.confirmSelect();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n//\t\tvar keyCode = event.keyCode ? event.keyCode : \r\n//\t\t\tevent.which\t? event.which: event.charCode;\r\n//\t\tvar Z = this.jslet;\r\n//\t\tif (keyCode != 13 && keyCode != 9) {\r\n//\t\t\tZ._invokePopup();\r\n//\t\t} else if (Z.contentPanel) {\r\n//\t\t\tif(Z.contentPanel.isShowing()) {\r\n//\t\t\t\tZ.contentPanel.confirmSelect();\r\n//\t\t\t}\r\n//\t\t}\r\n\t},\r\n\r\n\t_invokePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._timeoutHandler) {\r\n\t\t\tclearTimeout(Z._timeoutHandler);\r\n\t\t}\r\n\t\tvar delayTime = 100;\r\n\t\tif (Z._minDelay) {\r\n\t\t\tdelayTime = parseInt(Z._minDelay);\r\n\t\t}\r\n\t\t\r\n\t\tZ._timeoutHandler = setTimeout(function () {\r\n\t\t\tZ._populate(Z.el.value); \r\n\t\t}, delayTime);\r\n\t},\r\n\r\n\t_getDefaultFilterFields: function(lookupFldObj) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._defaultFilterFields) {\r\n\t\t\treturn Z._defaultFilterFields;\r\n\t\t}\r\n\t\tvar codeFld = lookupFldObj.codeField(),\r\n\t\t\tnameFld = lookupFldObj.nameField(),\r\n\t\t\tlkDs = lookupFldObj.dataset(),\r\n\t\t\tcodeFldObj = lkDs.getField(codeFld),\r\n\t\t\tnameFldObj = lkDs.getField(nameFld),\r\n\t\t\tarrFields = [];\r\n\t\tif(codeFldObj && codeFldObj.visible()) {\r\n\t\t\tarrFields.push(codeFld);\r\n\t\t}\r\n\t\tif(codeFld != nameFld && nameFldObj && nameFldObj.visible()) {\r\n\t\t\tarrFields.push(nameFld);\r\n\t\t}\r\n\t\tZ._defaultFilterFields = arrFields;\r\n\t\treturn arrFields;\r\n\t},\r\n\t\r\n\t_getFilterFields: function(lkFldObj, inputValue) {\r\n\t\tvar Z = this;\r\n\t\tvar filterFlds = null;\r\n\t\t\r\n\t\tvar eventFunc = jslet.getFunction(Z._onGetFilterField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfilterFlds = eventFunc.call(Z, lkFldObj.dataset(), inputValue);\r\n\t\t\tjslet.Checker.test('DBAutoComplete.onGetFilterField#return', filterFlds).isString();\r\n\t\t}\r\n\t\tfilterFlds = filterFlds || Z._filterFields;\r\n\t\tvar arrFields;\r\n\t\tif (filterFlds) {\r\n\t\t\tarrFields = filterFlds.split(',');\r\n\t\t} else {\r\n\t\t\tarrFields = Z._getDefaultFilterFields(lkFldObj);\r\n\t\t}\r\n\t\tif(arrFields.length === 0) {\r\n\t\t\tthrow new Error('Not specified [filter fields]!');\r\n\t\t}\r\n\t\tvar filterValue = inputValue;\r\n\t\tif (Z._matchMode == 'start') {\r\n\t\t\tfilterValue = filterValue + '%';\r\n\t\t} else {\r\n\t\t\tif (Z._matchMode == 'end') {\r\n\t\t\t\tfilterValue = '%' + filterValue;\r\n\t\t\t} else {\r\n\t\t\t\tfilterValue = '%' + filterValue + '%';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, result = '';\r\n\t\tfor(var i = 0, len = arrFields.length; i < len; i++) {\r\n\t\t\tfldName = arrFields[i];\r\n\t\t\tif(i > 0) {\r\n\t\t\t\tresult += ' || ';\r\n\t\t\t}\r\n\t\t\tresult += 'like([' + fldName + '],\"' + filterValue + '\")';\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_populate: function (inputValue) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._minChars > 0 && inputValue && inputValue.length < Z._minChars) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\tlkFld = fldObj.lookup();\r\n\t\tif (!lkFld) {\r\n\t\t\tconsole.error(Z._field + ' is NOT a lookup field!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar lkds = lkFld.dataset(),\r\n\t\t\toldFlag = lkds.autoRefreshHostDataset();\r\n\t\tlkds.autoRefreshHostDataset(true);\r\n\t\ttry {\r\n\t\t\tvar\teditFilter = lkFld.editFilter();\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._beforePopup);\r\n\t\t\tif (eventFunc) {\r\n\t\t\t\teventFunc.call(Z, lkds, inputValue, editFilter);\r\n\t\t\t} else if (inputValue) {\r\n\t\t\t\tvar filter = Z._getFilterFields(lkFld, inputValue);\r\n\t\t\t\tif(editFilter) {\r\n\t\t\t\t\tif(filter) {\r\n\t\t\t\t\t\tfilter = '(' + editFilter + ') && (' + filter + ')';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfilter = editFilter;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlkds.filter(filter);\r\n\t\t\t\tlkds.filtered(true);\r\n\t\t\t} else {\r\n\t\t\t\tif(editFilter) {\r\n\t\t\t\t\tlkds.filter(editFilter);\r\n\t\t\t\t\tlkds.filtered(true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkds.filter(null);\r\n\t\t\t\t\tif(!lkds.fixedFilter()) {\r\n\t\t\t\t\t\tlkds.filtered(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tlkds.autoRefreshHostDataset(oldFlag);\r\n\t\t}\r\n\t\t//Clear field value which specified by 'lookupField'.\r\n\t\tif(Z._lookupField) {\r\n\t\t\tvar dataRec = Z._dataset.getRecord();\r\n\t\t\tif(dataRec) {\r\n\t\t\t\tdataRec[Z._lookupField] = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = new jslet.ui.DBAutoCompletePanel(Z);\r\n\t\t} else {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tr = jqEl.offset(),\r\n\t\t\th = jqEl.outerHeight(),\r\n\t\t\tx = r.left,\r\n\t\t\ty = r.top + h;\r\n\t\t\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth() - Z.contentPanel.dlgWidth;\r\n\t\t}\r\n\t\tZ.contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\t_destroyPopPanel: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z.contentPanel){\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function (isMetaChanged) {\r\n\t\tif(isMetaChanged) {\r\n\t\t\tthis._destroyPopPanel();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._destroyPopPanel();\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\n/**\r\n * @private\r\n * @class DBAutoCompletePanel\r\n * \r\n */\r\njslet.ui.DBAutoCompletePanel = function (autoCompleteObj) {\r\n\tvar Z = this;\r\n\tZ.dlgWidth = 320;\r\n\tZ.dlgHeight = 180;\r\n\r\n\tvar lkf, lkds;\r\n\tZ.comboCfg = autoCompleteObj;\r\n\tZ.dataset = autoCompleteObj.dataset();\r\n\tZ.field = autoCompleteObj.lookupField() || autoCompleteObj.field();\r\n\tZ.lkDataset = null;\r\n\r\n\tZ.confirmSelect = function () {\r\n\t\tZ.comboCfg._isSelecting = true;\r\n\t\tvar fldValue = Z.lkDataset.keyValue();\r\n\t\tif (fldValue || fldValue === 0) {\r\n\t\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z.valueIndex);\t\t\t\r\n\t\t\tZ.comboCfg.el.focus();\r\n\t\t}\r\n\t\tif (Z.comboCfg.afterSelect) {\r\n\t\t\tZ.comboCfg.afterSelect(Z.dataset, Z.lkDataset);\r\n\t\t}\r\n\t\tZ.closePopup();\r\n\t};\r\n\r\n\tfunction create () {\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t\tZ.panel.style.width = '100%';\r\n\t\t\tZ.panel.style.height = '100%';\r\n\t\t\tjQuery(Z.panel).on(\"mousedown\", function(event){\r\n\t\t\t\tZ.comboCfg._isSelecting = true;\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t});\r\n\t\t}\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tlkds = lkfld.dataset();\r\n\t\tZ.lkDataset = lkds;\r\n\t\tvar fields = lkds.getNormalFields(),\r\n\t\t\ttotalChars = 0;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.visible()) {\r\n\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 30;\r\n\t\tZ.dlgWidth = totalWidth;\r\n\t\tif(Z.dlgWidth < 150) {\r\n\t\t\tZ.dlgWidth = 150;\r\n\t\t}\r\n\t\tif(Z.dlgWidth > 500) {\r\n\t\t\tZ.dlgWidth = 500;\r\n\t\t}\r\n\r\n\t\tZ.panel.innerHTML = '';\r\n\r\n\t\tvar cntw = Z.dlgWidth - 4,\r\n\t\t\tcnth = Z.dlgHeight - 4,\r\n\t\t\ttableparam = { type: 'DBTable', dataset: lkds, readOnly: true, noborder:true, hasSelectCol: false, hasSeqCol: false, hideHead: true };\r\n\t\ttableparam.onRowClick = Z.confirmSelect;\r\n\r\n\t\tZ.otable = jslet.ui.createControl(tableparam, Z.panel, '100%', cnth);\r\n\t\tZ.otable.el.focus();\r\n\t\tZ.otable.el.style.border = \"0\";\r\n\t\t\r\n\t\treturn Z.panel;\r\n\t}\r\n\r\n\tZ.showPopup = function (left, top, ajustX, ajustY) {\r\n\t\tZ.comboCfg._isSelecting = false;\r\n\t\tZ.isPop = true;\r\n\t\tZ.popup.show(left, top, Z.dlgWidth, Z.dlgHeight, ajustX, ajustY);\r\n\t};\r\n\r\n\tZ.doClosePopup = function () {\r\n\t\tZ.isPop = false;\r\n\t\tvar oldRecno = Z.lkDataset.recno() || 0;\r\n\t\ttry {\r\n\t\t\tZ.lkDataset.filter(null);\r\n\t\t} finally {\r\n\t\t\tif(oldRecno >= 0) {\r\n\t\t\t\tZ.lkDataset.recno(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tZ.closePopup = function () {\r\n\t\tZ.popup.hide();\r\n\t};\r\n\t\r\n\tZ.isShowing = function(){\r\n\t\treturn Z.isPop;\r\n\t};\r\n\t\r\n\tcreate();\r\n\tZ.popup = new jslet.ui.PopupPanel(autoCompleteObj.el);\r\n\tZ.popup.contentElement(Z.panel);\r\n\tZ.popup.onHidePopup(Z.doClosePopup);\r\n\tZ.isPop = false;\r\n\t\r\n\tZ.destroy = function(){\r\n\t\tjQuery(Z.panel).off();\r\n\t\tZ.otable.onRowClick = null;\r\n\t\tZ.otable.destroy();\r\n\t\tZ.otable = null;\r\n\t\tZ.panel = null;\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\tZ.comboCfg = null;\r\n\t\tZ.dataset = null;\r\n\t\tZ.field = null;\r\n\t\tZ.lkDataset = null;\r\n\t};\r\n};\r\n\r\njslet.ui.register('DBAutoComplete', jslet.ui.DBAutoComplete);\r\njslet.ui.DBAutoComplete.htmlTemplate = '<input type=\"text\"></input>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBBetweenEdit. <br /> \r\n * It implements \"From ... To ...\" style editor. This editor usually use in query parameter editor. <br />\r\n * Example:\r\n * \r\n *     @example\r\n *       var jsletParam = {type:\"DBBetweenEdit\",\"field\":\"dateFld\"};\r\n *\r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBBetweenEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\tthis._minEleId = null;\r\n\t\tthis._maxEleId = null;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @hide\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\treturn;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar lbl = jsletlocale.Dataset.betweenLabel;\r\n\t\tif (!lbl) {\r\n\t\t\tlbl = '-';\r\n\t\t}\r\n\t\tlbl = '&nbsp;' + lbl + '&nbsp;';\r\n\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tvar ctrlCfg = {};\r\n\t\tctrlCfg.dataset = Z._dataset.name();\r\n\t\tctrlCfg.field = Z._field;\r\n\t\tctrlCfg.type = 'DBPlace';\r\n\t\tctrlCfg.valueIndex = 0;\r\n\t\t\r\n\t\tvar template = \r\n\t\t\t'<div class=\"input-group\">' + \r\n\t\t\t'<div class=\"jl-btw-min\" data-jslet=\\'' + JSON.stringify(ctrlCfg) + '\\'></div>' + \r\n\t\t\t'<span class=\"input-group-addon jl-btw-separator\">' + lbl + '</span>';\r\n\t\tctrlCfg.valueIndex = 1;\r\n\t\ttemplate += \r\n\t\t\t'<div class=\"jl-btw-max\" data-jslet=\\'' + JSON.stringify(ctrlCfg) + '\\'></div>' + \r\n\t\t\t'</div>';\r\n\r\n\t\tZ.el.innerHTML = template;\r\n\t\tjslet.ui.install(Z.el);\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tZ._minEleId = jqEl.find('.jl-btw-min')[0].id;\r\n\t\tZ._maxEleId = jqEl.find('.jl-btw-max')[0].id;\r\n\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function($super, tableId){\r\n\t\t$super(tableId);\r\n\t\tjslet('#'+ this._minEleId).tableId(tableId);\r\n\t\tjslet('#'+ this._maxEleId).tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tjslet('#'+ this._minEleId).focus();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBBetweenEdit', jslet.ui.DBBetweenEdit);\r\njslet.ui.DBBetweenEdit.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n *  \r\n * DBCheckBox. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCheckBox\", dataset:\"employee\", field:\"married\"};\r\n * \r\n *     //1. Declaring:\r\n *      <input type='checkbox' data-jslet='type:\"DBCheckBox\",dataset:\"employee\", field:\"married\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <input id=\"ctrlId\" type=\"checkbox\" />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCheckBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.isCheckBox = true;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beforeClick';\r\n\t\tZ._beforeClick = null;\r\n\t\t\r\n\t\tZ._skipRefresh = false;\r\n\t\tjQuery(el).attr('type', 'checkbox');\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeClick: function(beforeClick) {\r\n\t\tif(beforeClick === undefined) {\r\n\t\t\treturn this._beforeClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBox.beforeClick', beforeClick).isFunction();\r\n\t\tthis._beforeClick = beforeClick;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-dbcheck')) {\r\n\t\t\tjqEl.addClass('jl-dbcheck');\r\n\t\t}\r\n\t\tjqEl.on('click', Z._doClick);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('checkbox-inline form-control');\r\n\t}, // end bind\r\n\r\n\t_doClick: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif (Z._beforeClick) {\r\n\t\t\tvar result = Z._beforeClick.call(Z, Z.el);\r\n\t\t\tif (!result) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, false, fldObj.required());\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue();\r\n\t\tif (value) {\r\n\t\t\tZ.el.checked = true;\r\n\t\t} else {\r\n\t\t\tZ.el.checked = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.el.checked;\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBox', jslet.ui.DBCheckBox);\r\njslet.ui.DBCheckBox.htmlTemplate = '<input type=\"checkbox\"></input>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCheckBoxGroup. Display a group of checkbox. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCheckBoxGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,columnCount,hasSelectAllBox';\r\n\t\t\r\n\t\tZ._columnCount = 99999;\r\n\t\t\r\n\t\tZ._hasSelectAllBox = false;\r\n\t\t\r\n\t\tZ._itemIds = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBoxGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether creating \"select all\" box.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSelectAllBox True - has \"select all box\", false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSelectAllBox: function(hasSelectAllBox) {\r\n\t\tif(hasSelectAllBox === undefined) {\r\n\t\t\treturn this._hasSelectAllBox;\r\n\t\t}\r\n\t\tthis._hasSelectAllBox = hasSelectAllBox? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n//\t\tif(fldObj.valueStyle() !== jslet.data.FieldValueStyle.MULTIPLE) {\r\n//\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n//\t\t}\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which, idx, activeEle, activeId;\r\n\t\t\t\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx - 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === Z._itemIds.length - 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx + 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.on('click', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5);\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.on('blur', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\tdisabled = disabled || readOnly;\r\n\t\t\tvar chkBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\t\tchkEle, \r\n\t\t\t\ttabIndex = fldObj.tabIndex(),\r\n\t\t\t\trequired = fldObj.required();\r\n\t\t\tfor(var i = 0, cnt = chkBoxes.length; i < cnt; i++){\r\n\t\t\t\tchkEle = chkBoxes[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(chkEle, disabled, readOnly, false, required);\r\n\t\t\t\tchkEle.tabIndex = tabIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar checkboxs = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\tchkcnt = checkboxs.length, \r\n\t\t\tcheckbox, i;\r\n\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\tcheckbox = checkboxs[i];\r\n\t\t\tif(jQuery(checkbox).hasClass('jl-selectall')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcheckbox.checked = false;\r\n\t\t}\r\n\t\tvar values = Z.getValue();\r\n\t\tif(values && values.length > 0) {\r\n\t\t\tvar valueCnt = values.length, value;\r\n\t\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\t\tcheckbox = checkboxs[i];\r\n\t\t\t\tfor (var j = 0; j < valueCnt; j++) {\r\n\t\t\t\t\tvalue = values[j];\r\n\t\t\t\t\tif (value == checkbox.value) {\r\n\t\t\t\t\t\tcheckbox.checked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatMessage(jsletlocale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n//\t\tif(fldObj.valueStyle() != jslet.data.FieldValueStyle.MULTIPLE) {\r\n//\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n//\t\t}\r\n\t\t\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tlkCnt = lkds.recordCount();\r\n\t\tif(lkCnt === 0) {\r\n\t\t\tZ.el.innerHTML = jsletlocale.DBCheckBoxGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._itemIds = [];\r\n\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\tisNewRow = false;\r\n\t\tvar editFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false,\r\n\t\t\tk = -1,\r\n\t\t\titemId;\r\n\t\tif(Z._hasSelectAllBox && lkCnt > 0) {\r\n\t\t\ttemplate.push('<tr>');\r\n\t\t\titemId = jslet.nextId();\r\n\t\t\ttemplate.push('<td style=\"white-space: nowrap;vertical-align:middle\"><input type=\"checkbox\" class=\"jl-selectall\"');\r\n\t\t\ttemplate.push(' id=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\"/><label for=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\">');\r\n\t\t\ttemplate.push(jsletlocale.DBCheckBoxGroup.selectAll);\r\n\t\t\ttemplate.push('</label></td>');\r\n\t\t\tk = 0;\r\n\t\t\tZ._itemIds.push(itemId);\r\n\t\t}\r\n\t\tZ.el.innerHTML = '';\r\n\t\tvar oldRecno = lkds.recnoSilence();\r\n\t\ttry {\r\n\t\t\tfor (var i = 0; i < lkCnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\tZ._itemIds.push(itemId);\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap; \"><input type=\"checkbox\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\" id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t} // end for\r\n\t\t\tif (lkCnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ.doMetaChanged();\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._is_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar allBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'), chkBox, j, allCnt;\r\n\t\tif(jQuery(currCheckBox).hasClass('jl-selectall')) {\r\n\t\t\tvar isAllSelected = currCheckBox.checked;\r\n\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\tif(chkBox == currCheckBox) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (!chkBox.disabled) {\r\n\t\t\t\t\tchkBox.checked = isAllSelected;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlimitCount = fldObj.valueCountLimit(), \r\n\t\t\tvalues = null;\r\n\t\tif(fldObj.valueStyle() === jslet.data.FieldValueStyle.NORMAL) {\r\n\t\t\tif(currCheckBox.checked) {\r\n\t\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\t\tif(chkBox === currCheckBox || jQuery(chkBox).hasClass('jl-selectall')) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchkBox.checked = false;\r\n\t\t\t\t} //end for j\r\n\t\t\t\tvalues = currCheckBox.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvalues = [];\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\tif(jQuery(chkBox).hasClass('jl-selectall')) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (chkBox.checked) {\r\n\t\t\t\t\tvalues.push(chkBox.value);\r\n\t\t\t\t\tcount ++;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\r\n\t\t\tif (limitCount && count > limitCount) {\r\n\t\t\t\tcurrCheckBox.checked = !currCheckBox.checked;\r\n\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._is_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, values);\r\n\t\t} finally {\r\n\t\t\tZ._is_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar itemIds = this._itemIds;\r\n\t\tif (itemIds && itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-checkboxgroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-checkboxgroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBoxGroup', jslet.ui.DBCheckBoxGroup);\r\njslet.ui.DBCheckBoxGroup.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCKEditor is a data sensitive CKEditor. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBCKEditor,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBCKEditor,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCKEditor = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,height';\r\n\r\n\t\tZ._height = 150;\r\n\t\t\r\n\t\tZ._oldValue = null;\r\n\t\t\r\n\t\tZ._editorId = null;\r\n\t\tZ._editor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get CKEditor initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height CKEditor initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCKEditor.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!window.CKEDITOR) {\r\n\t\t\tthrow new Error('Not found CKEDITOR component! Goto for more: http://ckeditor.com/');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('jl-ckeditor');\r\n\t\tvar editorId = jslet.nextId();\r\n\t\tvar html = '<textarea class=\"jl-hidden\"></textarea>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.children().attr('id', editorId).attr('name', Z._field);\r\n\t\t\r\n\t\tvar editor = window.CKEDITOR.replace(editorId, {\r\n\t\t\theight: Z._height\r\n\t\t});\r\n\t\t\r\n\t\teditor.on('focus', jQuery.proxy(Z._doFocus, Z));\r\n\t\teditor.on('blur', jQuery.proxy(Z._doBlur, Z));\r\n\t\teditor.on('change', jQuery.proxy(Z._doChange, Z));\r\n\t\tZ._editor = editor;\r\n\t\tZ._editorId = '#cke_' + editorId;\r\n\t\tZ.renderAll();\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\tjQuery(Z._editorId).addClass('jl-focus');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doBlur: function () {\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z._editorId).removeClass('jl-focus');\r\n\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t},\r\n\t\r\n\t_doChange: function() {\r\n\t\tthis.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar state = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._editor.setReadOnly(state);\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError(), value;\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\tvalue = errObj.inputText;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t\tvalue = Z.getText();\r\n\t\t}\r\n\t\tZ._editor.setData(value);\r\n\t\tZ._editor.resetDirty();\r\n\t\tZ._oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinnerFocus: function($super) {\r\n\t\tthis._editor.focus();\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!Z._editor.checkDirty()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z._editor.getData();\r\n\t\tif(Z._oldValue == value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t\tZ._editor.resetDirty();\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tZ._editor = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBCKEditor', jslet.ui.DBCKEditor);\r\njslet.ui.DBCKEditor.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBCustomComboBox\r\n * \r\n * DBComboSelect. Show data on a popup panel, it can display tree style or table style. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true};\r\n * \r\n *      //1. Declaring:\r\n *      <div data-jslet='type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBComboSelect = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\tshowStyles: ['auto', 'table', 'tree'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck,autoSelected';\r\n\t\tZ._textField = null;\r\n\t\t\r\n\t\tZ._showStyle = 'auto';\r\n\t\t\r\n\t\tZ._popupWidth = 300;\r\n\r\n\t\tZ._popupHeight = 300;\r\n\t\t\r\n\t\tZ._contentPanel = null;\r\n\t\t\r\n\t\tZ._pickupField = null;\r\n\t\t\r\n\t\tZ._onGetSearchField = null;\r\n\t\t\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\tZ._autoSelected = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name of text box.\r\n\t * \r\n\t * @param {String | undefined} textField Field name which binded to the text box.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ttextField: function(textField) {\r\n\t\tif(textField === undefined) {\r\n\t\t\treturn this._textField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.textField', textField).required().isString();\r\n\t\tthis._textField = textField.trim();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel height.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The height of pop up panel.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the content style of pop up panel.\r\n\t * \r\n\t * @param {String | undefined} showStyle The content style of the pop up panel, optional value: \"auto\"(default), \"table\", \"tree\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tshowStyle: function(showStyle) {\r\n\t\tif(showStyle === undefined) {\r\n\t\t\treturn this._showStyle;\r\n\t\t}\r\n\t\tshowStyle = jQuery.trim(showStyle);\r\n\t\tvar checker = jslet.Checker.test('DBComboSelect.showStyle', showStyle).isString();\r\n\t\tshowStyle = showStyle.toLowerCase();\r\n\t\tchecker.testValue(showStyle).inArray(this.showStyles);\r\n\t\tthis._showStyle = showStyle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/*\r\n\t * @event\r\n\t * \r\n\t * Set or get \"onGetSearchField\" event handler.\r\n\t * \r\n\t * @param {Function} Optional onGetSearchField event handler.\r\n\t * \r\n\t * @return {Function or this}\r\n\t */\r\n\tonGetSearchField: function(onGetSearchField) {\r\n\t\tif(onGetSearchField === undefined) {\r\n\t\t\treturn this._onGetSearchField;\r\n\t\t}\r\n\t\tthis._onGetSearchField = onGetSearchField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether correlate checking the tree nodes or not.\r\n\t * \r\n\t * @param {Boolean | undefined} correlateCheck True - correlate checking the tree nodes, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Automatically select the finding record when searching record.\r\n\t * \r\n\t * @param {Boolean | undefined} autoSelected True - Automatically select record, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoSelected: function(autoSelected) {\r\n\t\tif(autoSelected === undefined) {\r\n\t\t\treturn this._autoSelected;\r\n\t\t}\r\n\t\tthis._autoSelected = autoSelected;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tafterBind: function ($super) {\r\n\t\t$super();\r\n\t\t\r\n\t\tif (this._contentPanel) {\r\n\t\t\tthis._contentPanel = null;\r\n\t\t}\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar Z = this, \r\n\t\t\tel = Z.el, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup(),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\t\t\r\n\t\t}\r\n\t\tif (lkf === null || lkf === undefined) {\r\n\t\t\tthrow new Error(Z._field + ' is NOT a lookup field!');\r\n\t\t}\r\n\t\tvar style = Z._showStyle;\r\n\t\tif (Z._showStyle == 'auto') {\r\n\t\t\tstyle = lkf.parentField() ? 'tree' : 'table';\r\n\t\t}\r\n\t\tif (!Z._contentPanel) {\r\n\t\t\tZ._contentPanel = new jslet.ui.DBComboSelectPanel(Z, btnEle);\r\n\t\t\tZ._contentPanel.showStyle = style;\r\n\t\t\tZ._contentPanel.customButtonLabel = Z.customButtonLabel;\r\n\t\t\tZ._contentPanel.onCustomButtonClick = Z.onCustomButtonClick;\r\n\t\t\tif (Z._popupWidth) {\r\n\t\t\t\tZ._contentPanel.popupWidth = Z._popupWidth;\r\n\t\t\t}\r\n\t\t\tif (Z._popupHeight) {\r\n\t\t\t\tZ._contentPanel.popupHeight = Z._popupHeight;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar r = jqEl.offset(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\tx = r.left, y = r.top + h;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ._contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\tclosePopup: function(){\r\n\t\tvar Z = this;\r\n\t\tif(Z._contentPanel) {\r\n\t\t\tZ._contentPanel.closePopup();\r\n\t\t}\r\n\t\tZ._contentPanel = null;\r\n\t\tZ.focus();\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function (isMetaChanged) {\r\n\t\tif(isMetaChanged) {\r\n\t\t\tthis._destroyPopPanel();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_destroyPopPanel: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._contentPanel){\r\n\t\t\tZ._contentPanel.destroy();\r\n\t\t\tZ._contentPanel = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._destroyPopPanel();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.DBComboSelectPanel = function (comboSelectObj, btnEle) {\r\n\tvar Z = this;\r\n\r\n\tZ.showStyle = 'auto';\r\n\r\n\tZ.customButtonLabel = null;\r\n\tZ.onCustomButtonClick = null;\r\n\tZ.popupWidth = 350;\r\n\tZ.popupHeight = 350;\r\n\tZ._isShowing = false;\r\n\t\r\n\tvar otree, otable, showType, valueSeperator = ',', lkf, lkds, self = this;\r\n\tZ.comboSelectObj = comboSelectObj;\r\n\r\n\tZ.dataset = comboSelectObj._dataset;\r\n\tZ.field = comboSelectObj._field;\r\n\tZ.fieldObject = Z.dataset.getField(Z.field);\r\n\tZ.panel = null;\r\n\tZ.searchBoxEle = null;\r\n\tZ._oldFilter = null;\r\n\tZ._oldFiltered = null;\r\n\t\r\n\tZ.popup = new jslet.ui.PopupPanel(btnEle);\r\n\tZ.popup.onHidePopup = function() {\r\n\t\tZ._isShowing = false;\r\n\t\tZ._restoreLkDsEvent();\r\n\t\tif(Z.comboSelectObj) {\r\n\t\t\tZ.comboSelectObj.focus();\r\n\t\t}\r\n\t};\r\n\tZ._confirmSelectDebounce = jslet.debounce(this._confirmSelect, 50);\r\n};\r\n\r\njslet.ui.DBComboSelectPanel.prototype = {\r\n\t\t\r\n\tlookupDs: function() {\r\n\t\treturn this.fieldObject.lookup().dataset();\r\n\t},\r\n\t\r\n\tisMultiple: function() {\r\n\t\treturn this.fieldObject && this.fieldObject.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t},\r\n\t\t\r\n\tshowPopup: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isShowing) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._initSelected();\r\n\t\tvar showType = Z.showStyle.toLowerCase();\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = Z._create();\r\n\t\t} else {\r\n\t\t\tvar ojslet = Z.otree ? Z.otree : Z.otable;\r\n\t\t\tojslet.dataset().addLinkedControl(ojslet);\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tojslet.renderAll();\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\tvar jqPanel = jQuery(Z.panel);\r\n\t\tjqPanel.find('.jl-combopnl-head input').val('');\r\n\t\tjqPanel.find('.jl-combopnl-head').hide();\r\n\r\n\t\tif(showType == 'table') {\r\n\t\t\tvar fields = Z.lookupDs().getNormalFields(),\r\n\t\t\t\tfldObj, totalChars = 0;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tif(fldObj.visible()) {\r\n\t\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 40;\r\n\t\t\tZ.popupWidth = totalWidth;\r\n\t\t\tif(Z.popupWidth < 150) {\r\n\t\t\t\tZ.popupWidth = 150;\r\n\t\t\t}\r\n\t\t\tif(Z.popupWidth > 500) {\r\n\t\t\t\tZ.popupWidth = 500;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._setLookupDsEvent();\r\n\t\tZ._isShowing = true;\r\n\t\tZ.popup.contentElement(Z.panel);\r\n\t\tZ.popup.show(left, top, Z.popupWidth, Z.popupHeight, ajustX, ajustY);\r\n\t\tZ._showTips(jsletlocale.DBComboSelect.find);\r\n\t\tZ._focus();\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.popup.hide();\r\n\t\tvar dispCtrl = Z.otree ? Z.otree : Z.otable;\r\n\t\tif(dispCtrl) {\r\n\t\t\tdispCtrl.dataset().removeLinkedControl(dispCtrl);\r\n\t\t}\r\n\t\tZ.comboSelectObj.focus();\r\n\t},\r\n\t\r\n\t_setLookupDsEvent: function() {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\t\tvar lkDs = lkfld.dataset();\r\n\t\tvar editFilter = lkfld.editFilter();\r\n\t\tif(editFilter) {\r\n\t\t\tvar filter = lkDs.filter();\r\n\t\t\tZ._oldFilter = filter;\r\n\t\t\tZ._oldFiltered = lkDs.filtered();\r\n\t\t\tif(filter) {\r\n\t\t\t\tfilter = '(' + editFilter + ') && (' + filter + ')';\r\n\t\t\t} else {\r\n\t\t\t\tfilter = editFilter;\r\n\t\t\t}\r\n\t\t\tlkDs.filter(filter);\r\n\t\t\tlkDs.filtered(true);\r\n\t\t\t\r\n\t\t}\r\n\t\tif(Z.isMultiple()) {\r\n\t\t\tZ._oldLkDsCheckSelectable = null;\r\n\t\t\tif(lkfld.onlyLeafLevel()) {\r\n\t\t\t\tZ._oldLkDsCheckSelectable = lkDs.onCheckSelectable();\r\n\t\t\t\tlkDs.onCheckSelectable(function(){\r\n\t\t\t\t\treturn !this.hasChildren();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tlkDs = Z.lookupDs();\r\n\t\t\tZ._oldLkDsListener = lkDs.datasetListener();\r\n\t\t\tlkDs.datasetListener(function(eventType) {\r\n\t\t\t\tif(Z._oldLkDsListener) {\r\n\t\t\t\t\tZ._oldLkDsListener.call(lkDs, eventType);\r\n\t\t\t\t}\r\n\t\t\t\tif(eventType === jslet.data.DatasetEvent.AFTERSELECT) {\r\n\t\t\t\t\tZ._confirmSelectDebounce.call(Z);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_restoreLkDsEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\t\tif(!lkfld) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkDs = lkfld.dataset();\r\n\t\tif(Z.isMultiple()) {\r\n\t\t\tlkDs.onCheckSelectable(Z._oldLkDsCheckSelectable? Z._oldLkDsCheckSelectable: null);\r\n\t\t\tlkDs.datasetListener(Z._oldLkDsListener? Z._oldLkDsListener: null);\r\n\t\t}\r\n\t\tif(Z._oldFiltered) {\r\n\t\t\tlkDs.filtered(Z._oldFiltered);\r\n\t\t}\r\n\t\tif(Z._oldFilter) {\r\n\t\t\tlkDs.filter(Z._oldFilter);\r\n\t\t} \r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t\tZ.panel.style.width = '100%';\r\n\t\t\tZ.panel.style.height = '100%';\r\n\t\t}\r\n\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z.showStyle.toLowerCase(),\r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar template = ['<div class=\"jl-combopnl-tip\" style=\"display:none\"></div>',\r\n\t\t                '<div class=\" col-xs-8 col-xs-offset-4 jl-combopnl-head\">',\r\n\t\t                '<div class=\"input-group input-group-sm\">',\r\n\t\t                '<input class=\"form-control\" type=\"text\" size=\"10\"></input>',\r\n\t\t                '<span class=\"input-group-btn\">',\r\n\t\t                '<button class=\"jl-combopnl-search btn btn-secondary\" type=\"button\"><i class=\"fa fa-search\"></i></button>',\r\n\t\t                '<button class=\"jl-combopnl-closesearch btn btn-secondary\" type=\"button\"><i class=\"fa fa-times\"></i></button>',\r\n\t\t                '</span>',\r\n\t\t                '</div></div>',\r\n\t\t                '<div class=\"jl-combopnl-content\"></div>'];\r\n\r\n\t\tZ.panel.innerHTML = template.join('');\r\n\t\tvar jqPanel = jQuery(Z.panel),\r\n\t\t\tjqPh = jqPanel.find('.jl-combopnl-head');\r\n\t\tjqPanel.on('keydown', function(event){\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\t\tZ._confirmAndClose();\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ESCAPE) {\r\n\t\t\t\tZ.closePopup();\r\n\t\t\t}\r\n\t\t\tif(event.ctrlKey && keyCode === jslet.ui.KeyCode.F) {\r\n\t\t\t\tjqPanel.find('.jl-combopnl-head').slideDown();\r\n\t\t\t\tZ.searchBoxEle.focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.searchBoxEle = jqPh.find('input')[0];\r\n\t\tjQuery(Z.searchBoxEle).on('keydown', function(event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tif (event.which != 13) {//enter\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tZ._findData(event.currentTarget);\r\n\t\t});\r\n\t\t\r\n\t\tjqPanel.find('.jl-combopnl-closesearch').click(function() {\r\n\t\t\tjqPanel.find('.jl-combopnl-head').slideUp();\r\n\t\t\tZ._focus();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-combopnl-search').click(function() {\r\n\t\t\tZ._findData(Z.searchBoxEle);\r\n\t\t});\r\n\t\tvar contentPanel = jqPanel.find('.jl-combopnl-content')[0];\r\n\r\n\t\t//create popup content\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeParam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: Z.isMultiple(),\r\n\t\t\t\texpandLevel:1\r\n\t\t\t};\r\n\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttreeParam.onItemClick = jQuery.proxy(Z._confirmAndClose, Z);\r\n\t\t\t}\r\n\t\t\ttreeParam.correlateCheck = Z.comboSelectObj.correlateCheck();\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otree = jslet.ui.createControl(treeParam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableParam = { type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: Z.isMultiple(), hasSeqCol: false, \r\n\t\t\t\t\thasFindDialog: false, hasFilterDialog: false };\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttableParam.onRowClick = jQuery.proxy(Z._confirmAndClose, Z);\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otable = jslet.ui.createControl(tableParam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn Z.panel;\r\n\t},\r\n\r\n\t_initSelected: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldValue = Z.comboSelectObj.getValue(), \r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\r\n\t\tif(lkfld.onlyLeafLevel()) {\r\n\t\t\tlkds.onCheckSelectable(function(){\r\n\t\t\t\treturn !this.hasChildren();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (!Z.isMultiple()) {\r\n\t\t\tif (fldValue) {\r\n\t\t\t\tlkds.findByKey(fldValue);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlkds.disableControls();\r\n\t\ttry {\r\n\t\t\tlkds.selectAll(false);\r\n\t\t\tif (fldValue) {\r\n\t\t\t\tvar arrKeyValues = fldValue;\r\n\t\t\t\tif(!jslet.isArray(fldValue)) {\r\n\t\t\t\t\tarrKeyValues = fldValue.split(jslet.global.valueSeparator);\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0, len = arrKeyValues.length; i < len; i++){\r\n\t\t\t\t\tlkds.selectByKeyValue(true, arrKeyValues[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tlkds.enableControls();\r\n\t\t}\r\n\t},\r\n\r\n\t_findData: function (searchText) {\r\n\t\tvar Z = this;\r\n\t\tvar findFldName = Z.comboSelectObj.searchField, \r\n\t\t\tfindingValue = this.searchBoxEle.value;\r\n\t\tif (!findingValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar eventFunc = jslet.getFunction(Z.comboSelectObj.onGetSearchField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfindFldName = eventFunc.call(findingValue);\r\n\t\t}\r\n\t\tvar findFldNames = null;\r\n\t\tvar lkds = Z.lookupDs();\r\n\t\tif(!findFldName) {\r\n\t\t\tfindFldNames = [];\r\n\t\t\tvar fields = lkds.getNormalFields(), fldObj;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tif(fldObj.visible()) {\r\n\t\t\t\t\tfindFldNames.push(fldObj.name());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfindFldNames = findFldName.split(',');\r\n\t\t}\r\n\t\tif(!findFldNames || findFldNames.length === 0) {\r\n\t\t\tconsole.warn('Search field NOT specified! Can\\'t search data!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tcurrRecno = lkds.recno() + 1;\r\n\t\tvar options = {startRecno: currRecno, findingByText: true, matchType: 'any'};\r\n\t\tvar found = lkds.findByField(findFldNames, findingValue, options);\r\n\t\tif(!found) {\r\n\t\t\toptions.startRecno = 0;\r\n\t\t\tfound = lkds.findByField(findFldNames, findingValue, options);\r\n\t\t}\r\n\t\tif(found && found.isEqual && Z.comboSelectObj.autoSelected()) {\r\n\t\t\tlkds.select(true);\r\n\t\t}\r\n\t\tif(!found) {\r\n\t\t\tZ._showTips(jsletlocale.DBComboSelect.notFound);\r\n\t\t}\r\n\t\tif(searchText) {\r\n\t\t\tsearchText.focus();\r\n\t\t}\r\n\t\treturn;\r\n\t\t\r\n\t},\r\n\r\n\t_focus: function() {\r\n\t\tvar Z = this;\r\n\t\twindow.setTimeout(function(){\r\n\t\t\tvar dbCtrl = Z.otable || Z.otree;\r\n\t\t\tif(dbCtrl) {\r\n\t\t\t\tdbCtrl.el.focus();\r\n\t\t\t}\r\n\t\t}, 10);\r\n\t},\r\n\t\r\n\t_showTips: function (tips) {\r\n\t\tvar jqPanel = jQuery(this.panel);\r\n\t\tjqPanel.find('.jl-combopnl-tip').html(tips).slideDown();\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tjqPanel.find('.jl-combopnl-tip').slideUp();\r\n\t\t}, 1500);\r\n\t},\r\n\t\r\n\t_confirmSelect: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldValue = Z.comboSelectObj.getValue(),\r\n\t\t\tfldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tisMulti = Z.isMultiple(),\r\n\t\t\tlookupDs = Z.lookupDs();\r\n\t\t\r\n\t\tif (isMulti) {\r\n\t\t\tfldValue = lookupDs.selectedKeyValues();\r\n\t\t} else {\r\n\t\t\tif(lookupDs.hasChildren() && lkfld.onlyLeafLevel()) {\r\n\t\t\t\tZ._showTips(jsletlocale.DBComboSelect.cannotSelect);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfldValue = lookupDs.keyValue();\r\n\t\t}\r\n\r\n\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z._valueIndex);\r\n\t\tif (!isMulti && Z.comboSelectObj._afterSelect) {\r\n\t\t\tZ.comboSelectObj._afterSelect(Z.dataset, lookupDs);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_confirmAndClose: function () {\r\n\t\tif(this._confirmSelect()) {\r\n\t\t\tthis.closePopup();\r\n\t\t}\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\tvar Z = this;\r\n\t\tZ._restoreLkDsEvent();\r\n\t\tif (Z.otree){\r\n\t\t\tZ.otree.destroy();\r\n\t\t\tZ.otree = null;\r\n\t\t}\r\n\t\tif (Z.otable){\r\n\t\t\tZ.otable.destroy();\r\n\t\t\tZ.otable = null;\r\n\t\t}\r\n\t\tZ.comboSelectObj = null;\r\n\t\t\r\n\t\tjQuery(Z.searchBoxEle).off();\r\n\t\tZ.fieldObject = null;\r\n\t\t\r\n\t\tZ.searchBoxEle = null;\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\tZ.panel = null;\r\n\t}\r\n};\r\n\r\njslet.ui.register('DBComboSelect', jslet.ui.DBComboSelect);\r\njslet.ui.DBComboSelect.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBDataLabel. Show field value in a HTML label. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <label data-jslet='type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBDataLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control-static jl-datalabel jl-lbl-normal');//Bootstrap class\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tvar text = Z.getText();\r\n\t\tZ.el.innerHTML = text;\r\n\t\tZ.el.title = text;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tthis.doValueChanged();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBDataLabel', jslet.ui.DBDataLabel);\r\njslet.ui.DBDataLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBCustomComboBox\r\n * \r\n * DBDatePicker. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBDatePicker = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textReadOnly,popupWidth,popupHeight';\r\n\t\t\r\n\t\tZ._popupWidth = 260;\r\n\r\n\t\tZ._popupHeight = 226;\r\n\r\n\t\tZ.popup = null;\r\n\t\t\r\n\t\tZ.comboButtonCls = 'fa-calendar';\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel height.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The height of pop up panel.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar el = this.el, \r\n\t\t\tZ = this, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar width = Z._popupWidth,\r\n\t\t\theight = Z._popupHeight,\r\n\t\t\tdateValue = Z.getValue(),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminDate = null,\r\n\t\t\tmaxDate = null;\r\n\t\t\r\n\t\tif (range){\r\n\t\t\tif (range.min) {\r\n\t\t\t\tminDate = range.min;\r\n\t\t\t}\r\n\t\t\tif (range.max) {\r\n\t\t\t\tmaxDate = range.max;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = jslet.ui.createControl({ type: 'Calendar', value: dateValue, minDate: minDate, maxDate: maxDate,\r\n\t\t\t\tonDateSelected: function (date) {\r\n\t\t\t\t\tZ._dataset.setFieldValue(Z._field, new Date(date.getTime()), Z._valueIndex);\r\n\t\t\t\t\tZ.popup.hide();\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tZ.el.focus();\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t//Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, null, width + 'px', height + 'px', true); //Hide panel first\r\n\t\t\t\r\n\t\t\tZ.popup = new jslet.ui.PopupPanel(btnEle);\r\n\t\t\t\r\n\t\t\tZ.popup.onHidePopup = function() {\r\n\t\t\t\tZ.focus();\r\n\t\t\t};\r\n\t\t\tZ.popup.contentElement(Z.contentPanel.el);\r\n\t\t}\r\n\t\t\r\n\t\tvar r = jqEl.offset(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\tx = r.left, y = r.top + h;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ.contentPanel.el.style.display = 'block';\r\n\t\tZ.popup.show(x, y, width + 3, height + 3, 0, h);\r\n\t\tZ.contentPanel.focus();\r\n\t\tZ.contentPanel.setValue(dateValue);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z.contentPanel) {\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t\tif(Z.popup) {\r\n\t\t\tZ.popup.destroy();\r\n\t\t\tZ.popup = null;\r\n\t\t}\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBDatePicker', jslet.ui.DBDatePicker);\r\njslet.ui.DBDatePicker.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBHtml. Display html text from one field. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBHtml\",dataset:\"employee\",field:\"comment\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBHtml\",dataset:\"employee\",field:\"comment\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBHtml = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar content = this.getText();\r\n\t\tthis.el.innerHTML = content;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBHtml', jslet.ui.DBHtml);\r\njslet.ui.DBHtml.htmlTemplate = '<div style=\"width:200px;height:200px\"></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBImage. Display an image which store in database or which's path store in database. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBImage\",dataset:\"employee\",field:\"photo\"};\r\n * \r\n *     //1. Declaring:\r\n *      <img data-jslet='{type:\"DBImage\",dataset:\"employee\",field:\"photo\"}' />\r\n *      or\r\n *      <img data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <img id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBImage = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,locked,baseUrl,altField,enableViewer,viewUrlField';\r\n\t\t\r\n\t\tZ._locked = false;\r\n\t\t\r\n\t\tZ._baseUrl = null;\r\n\t\t\r\n\t\tZ._altField = null;\r\n\t\t\r\n\t\tZ._enableViewer = false;\r\n\t\t\r\n\t\tZ._viewUrlField = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get base URL for image \"src\". The whole image URL is : \"baseUrl\" + the value of field. \r\n\t * \r\n\t * @param {String | undefined} baseUrl Base URL.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tbaseUrl: function(baseUrl) {\r\n\t\tif(baseUrl === undefined) {\r\n\t\t\treturn this._baseUrl;\r\n\t\t}\r\n\t\tbaseUrl = jQuery.trim(baseUrl);\r\n\t\tjslet.Checker.test('DBImage.baseUrl', baseUrl).isString();\r\n\t\tthis._baseUrl = baseUrl;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether show image viewer. If true, user can click the image to show the image viewer. \r\n\t * \r\n\t * @param {Boolean | undefined} enableViewer True - enable viewer, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableViewer: function(enableViewer) {\r\n\t\tif(enableViewer === undefined) {\r\n\t\t\treturn this._enableViewer;\r\n\t\t}\r\n\t\tthis._enableViewer = enableViewer? true: false;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for image viewer. If 'field' stores the thumbnail url, 'viewUrlField' is stores the initial image url which is \r\n\t * provided for image viewer. Only enabled when 'enableViewer' is true.\r\n\t * \r\n\t * @param {String | undefined} viewUrlField.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tviewUrlField: function(viewUrlField) {\r\n\t\tif(viewUrlField === undefined) {\r\n\t\t\treturn this._viewUrlField;\r\n\t\t}\r\n\t\tviewUrlField = jQuery.trim(viewUrlField);\r\n\t\tjslet.Checker.test('DBImage.viewUrlField', viewUrlField).isString();\r\n\t\tthis._viewUrlField = viewUrlField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for image \"alt\". If not found the image, it displays the \"alt\" value.\r\n\t * \r\n\t * @param {String | undefined} baseUrl Base url.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\taltField: function(altField) {\r\n\t\tif(altField === undefined) {\r\n\t\t\treturn this._altField;\r\n\t\t}\r\n\t\taltField = jQuery.trim(altField);\r\n\t\tjslet.Checker.test('DBImage.altField', altField).isString();\r\n\t\tthis._altField = altField;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether stop refreshing image when moving dataset's cursor.\r\n\t * \r\n\t * @param {Boolean | undefined} locked True - stop refreshing, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tlocked: function(locked) {\r\n\t\tif(locked === undefined) {\r\n\t\t\treturn this._locked;\r\n\t\t}\r\n\t\tthis._locked = locked;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'img';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('img-responsive img-rounded');\r\n\t\tif(jslet.ui.ImageViewer) {\r\n\t\t\tjqEl.on('click', function() {\r\n\t\t\t\tif(Z._locked || !Z._enableViewer) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar viewer = new jslet.ui.ImageViewer();\r\n\t\t\t\tviewer.show(Z._getImgUrl(true));\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_getImgUrl: function(isForViewer) {\r\n\t\tvar Z = this, srcUrl;\r\n\t\tif(isForViewer && Z._viewUrlField) {\r\n\t\t\tsrcUrl = Z._dataset.getFieldValue(Z._viewUrlField);\r\n\t\t\tif(!srcUrl) {\r\n\t\t\t\tsrcUrl = Z.getValue();\r\n\t\t\t}\r\n\t\t}else {\r\n\t\t\tsrcUrl = Z.getValue();\r\n\t\t}\r\n\t\tif (!srcUrl) {\r\n\t\t\tsrcUrl = '';\r\n\t\t} else {\r\n\t\t\tif (Z._baseUrl) {\r\n\t\t\t\tsrcUrl = Z._baseUrl + srcUrl;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn srcUrl;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (Z._locked) {\r\n\t\t\tZ.el.alt = jsletlocale.DBImage.lockedImageTips;\r\n\t\t\tZ.el.src = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar srcURL = Z._getImgUrl();\r\n\t\tif (Z.el.src != srcURL) {\r\n\t\t\tvar altText = srcURL;\r\n\t\t\tif(Z._altField) {\r\n\t\t\t\taltText = Z._dataset.getFieldText(Z._altField);\r\n\t\t\t}\r\n\t\t\tZ.el.alt = altText || '';\r\n\t\t\tZ.el.src = srcURL;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBImage', jslet.ui.DBImage);\r\njslet.ui.DBImage.htmlTemplate = '<img></img>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBLabel. Display field name, use this control to void hard-coding field name, and you can change field name dynamically. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *      //1. Declaring:\r\n *      <label data-jslet='type:\"DBLabel\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\tthis.isLabel = true;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tjQuery(this.el).addClass('control-label');\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function(metaName) {\r\n\t\tif(metaName && jslet.ui.DBLabel.METANAMES.indexOf(metaName) < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this, subType = Z._fieldMeta,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tcontent = '';\r\n\t\tif(!fldObj) {\r\n\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif((!subType || subType == 'label') && (!metaName || metaName == 'label' || metaName == 'required')) {\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tcontent += '<span class=\"jl-lbl-required\">' + \r\n\t\t\t\t\tjslet.ui.DBLabel.REQUIREDCHAR + '</span>';\r\n\t\t\t}\r\n\t\t\tcontent += fldObj.displayLabel() || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType && subType == 'tip' && \r\n\t\t\t(!metaName || metaName == subType)) {\r\n\t\t\tcontent = fldObj.tip() || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType  && subType == 'error' && \r\n\t\t\t(metaName && metaName == subType)) {\r\n\t\t\tvar errObj = Z.getFieldError();\r\n\t\t\tcontent = errObj && errObj.message || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar jqEl = jQuery(this.el),\r\n\t\t\tsubType = this.fieldMeta();\r\n\t\t\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent());\r\n\t\tif(subType == 'error') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-error')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-error');\r\n\t\t\t}\r\n\t\t} else \r\n\t\tif(subType == 'tip') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-tip')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-tip');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\njslet.ui.DBLabel.REQUIREDCHAR = '*';\r\njslet.ui.DBLabel.METANAMES = ['label', 'required', 'tip', 'error'];\r\njslet.ui.register('DBLabel', jslet.ui.DBLabel);\r\njslet.ui.DBLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBList. Show data on list, it can display tree style or table style. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBList\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBList\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBList = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\tshowStyles: ['auto', 'table', 'tree'],\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,showStyle,correlateCheck';\r\n\t\t\r\n\t\tZ._showStyle = 'auto';\r\n\t\t\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the content style of pop up panel.\r\n\t * \r\n\t * @param {String | undefined} showStyle The content style of the pop up panel, optional value: \"auto\"(default), \"table\", \"tree\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tshowStyle: function(showStyle) {\r\n\t\tif(showStyle === undefined) {\r\n\t\t\treturn this._showStyle;\r\n\t\t}\r\n\t\tshowStyle = jQuery.trim(showStyle);\r\n\t\tvar checker = jslet.Checker.test('DBComboSelect.showStyle', showStyle).isString();\r\n\t\tshowStyle = showStyle.toLowerCase();\r\n\t\tchecker.testValue(showStyle).inArray(this.showStyles);\r\n\t\tthis._showStyle = showStyle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether correlate checking the tree nodes or not.\r\n\t * \r\n\t * @param {Boolean | undefined} correlateCheck True - correlate checking the tree nodes, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(jqEl.hasClass('jl-dblist')) {\r\n\t\t\tjqEl.addClass('jl-dblist');\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z._showStyle.toLowerCase(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\tif(showType == 'auto' && pfld) {\r\n\t\t\tshowType = 'tree';\r\n\t\t}\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeParam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: isMulti,\r\n\t\t\t\tcorrelateCheck: Z._correlateCheck,\r\n\t\t\t\texpandLevel: 99\r\n\t\t\t};\r\n\t\t\tif(isMulti) {\r\n\t\t\t\ttreeParam.afterCheckBoxClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\ttreeParam.onItemClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tjslet.ui.createControl(treeParam, Z.el, '100%', '100%');\r\n\t\t\t\tjQuery(Z.el.childNodes[0]).on('focus', function(event) {\r\n\t\t\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t\t\t}).on('blur', function(event) {\r\n\t\t\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t\t\t});\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableParam = {type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: isMulti, hasSeqCol: false, hasFindDialog: false, hasFilterDialog: false};\r\n\t\t\tif(isMulti) {\r\n\t\t\t\ttableParam.afterSelect = tableParam.afterSelectAll = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\ttableParam.onRowClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tjslet.ui.createControl(tableParam, Z.el, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tZ.el.disabled = true;\r\n\t\t} else {\r\n\t\t\tZ.el.disabled = false;\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE,\r\n\t\t\tvalue;\r\n\t\tif(!isMulti) {\r\n\t\t\tvalue = lkds.keyValue();\r\n\t\t} else {\r\n\t\t\tvalue = lkds.selectedKeyValues();\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText || '';\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tfldValue = fldObj.getValue(),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\tif(!isMulti) {\r\n\t\t\tlkds.findByKey(fldValue);\r\n\t\t} else {\r\n\t\t\tvar oldRecno = lkds.recno();\r\n\t\t\tlkds.disableControls();\r\n\t\t\ttry {\r\n\t\t\t\tlkds.selectAll(false);\r\n\t\t\t\tif(fldValue) {\r\n\t\t\t\t\tfor(var i = 0, len = fldValue.length; i < len; i++) {\r\n\t\t\t\t\t\tlkds.findByKey(fldValue[i]);\r\n\t\t\t\t\t\tlkds.selected(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tlkds.recno(oldRecno);\r\n\t\t\t\tlkds.enableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBList', jslet.ui.DBList);\r\njslet.ui.DBList.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBLookupLabel. Display field value according to another field and its value. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: '0101', returnField: 'name'};\r\n * \r\n *      //1. Declaring:\r\n *      <label data-jslet='{type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: \"0101\", returnField: \"name\"}' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBLookupLabel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,lookupField,returnField,lookupValue';\r\n\t\tZ.requiredProperties = 'lookupValue,lookupField,returnField';\r\n\r\n\t\tZ._lookupField = null;\r\n\t\t\r\n\t\tZ._lookupValue = null;\r\n\t\t\r\n\t\tZ._returnField = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for looking up.\r\n\t * \r\n\t * @param {String | undefined} lookupField Lookup field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupField: function(lookupField) {\r\n\t\tif(lookupField === undefined) {\r\n\t\t\treturn this._lookupField;\r\n\t\t}\r\n\t\tjslet.Checker.text('lookupField', lookupField).required().isString();\r\n\t\tthis._lookupField = lookupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the lookup value.\r\n\t * \r\n\t * @param {Object | undefined} lookupField Lookup value.\r\n\t * \r\n\t * @return {this | Object}\r\n\t */\r\n\tlookupValue: function(lookupValue) {\r\n\t\tif(lookupValue === undefined) {\r\n\t\t\treturn this._lookupValue;\r\n\t\t}\r\n\t\tjslet.Checker.text('lookupValue', lookupValue).required();\r\n\t\tthis._lookupValue = lookupValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the return field name.\r\n\t * \r\n\t * @param {String | undefined} returnField Return field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\treturnField: function(returnField) {\r\n\t\tif(returnField === undefined) {\r\n\t\t\treturn this._returnField;\r\n\t\t}\r\n\t\tjslet.Checker.text('returnField', returnField).required().isString();\r\n\t\tthis._returnField = returnField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt, isForce) {\r\n\t\tif (evt.eventType != jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isForce) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar result = Z.dataset.lookup(Z._lookupField, Z._lookupValue, Z._returnField);\r\n\t\tif (result === null) {\r\n\t\t\tresult = 'NOT found: ' + Z._lookupValue;\r\n\t\t}\r\n\t\tZ.el.innerHTML = result;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent, true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\njslet.ui.register('DBLookupLabel', jslet.ui.DBLookupLabel);\r\njslet.ui.DBLookupLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRadioGroup. Display a group of radio that user can select one option. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"'' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRadioGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,columnCount';\r\n\t\t\r\n\t\tZ._columnCount = 99999;\r\n\t\t\r\n\t\tZ._itemIds = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRadioGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which, idx, activeEle, activeId;\r\n\t\t\t\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx - 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === Z._itemIds.length - 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx + 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.on('click', 'input[type=\"radio\"]', function(event){\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5);\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"radio\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.on('blur', 'input[type=\"radio\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\r\n\t\t\tZ.disabled = disabled || readOnly;\r\n\t\t\tdisabled = Z.disabled;\r\n\t\t\tvar radios = jQuery(Z.el).find('input[type=\"radio\"]'),\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\tradioEle,\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t\r\n\t\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\t\tradioEle = radios[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(radioEle, disabled, readOnly, false, required);\r\n\t\t\t\tradioEle.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\tradios = jQuery(Z.el).find('input[type=\"radio\"]'), \r\n\t\t\tradio;\r\n\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\tradio = radios[i];\r\n\t\t\tradio.checked = (value == jQuery(radio.parentNode).attr('value'));\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field), lkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatMessage(jsletlocale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tcnt = lkds.recordCount();\r\n\t\tif(cnt === 0) {\r\n\t\t\tZ.el.innerHTML = jsletlocale.DBRadioGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno();\r\n\t\ttry {\r\n\t\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\t\tisNewRow = false, \r\n\t\t\t\titemId;\r\n\t\t\tvar editFilter = lkf.editFilter();\r\n\t\t\tZ._innerEditFilterExpr = null;\r\n\t\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\t\tif(editFilter) {\r\n\t\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t\t}\r\n\t\t\tvar disableOption = false, k = -1;\r\n\t\t\t\r\n\t\t\tZ._itemIds = [];\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\tZ._itemIds.push(itemId);\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap;vertical-align:middle\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\"><input name=\"');\r\n\t\t\t\ttemplate.push(Z._field);\r\n\t\t\t\ttemplate.push('\" type=\"radio\" id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t} // end while\r\n\t\t\tif (cnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ.doMetaChanged();\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_ || Z.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, jQuery(currCheckBox.parentNode).attr('value'));\r\n\t\t\tcurrCheckBox.checked = true;\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar itemIds = this._itemIds;\r\n\t\tif (itemIds && itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-radiogroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-radiogroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRadioGroup', jslet.ui.DBRadioGroup);\r\njslet.ui.DBRadioGroup.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRangeSelect. Display a select which options produce with 'beginItem' and 'endItem'. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRangeSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beginItem,endItem,step';\r\n\t\tif (!Z.requiredProperties) {\r\n\t\t\tZ.requiredProperties = 'field,beginItem,endItem,step';\r\n\t\t}\r\n\r\n\t\tZ._beginItem = 0;\r\n\r\n\t\tZ._endItem = 10;\r\n\r\n\t\tZ._step = 1;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the begin item of range.\r\n\t * \r\n\t * @param {Integer | undefined} beginItem Begin item of range.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tbeginItem: function(beginItem) {\r\n\t\tif(beginItem === undefined) {\r\n\t\t\treturn this._beginItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.beginItem', beginItem).isNumber();\r\n\t\tthis._beginItem = parseInt(beginItem);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the end item of range.\r\n\t * \r\n\t * @param {Integer | undefined} endItem End item of range.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tendItem: function(endItem) {\r\n\t\tif(endItem === undefined) {\r\n\t\t\treturn this._endItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.endItem', endItem).isNumber();\r\n\t\tthis._endItem = parseInt(endItem);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the step.\r\n\t * \r\n\t * @param {Integer | undefined} step Step.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.step', step).isNumber();\r\n\t\tthis._step = parseInt(step);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);// end observe\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', function () {\r\n\t\t\t\tZ._currOption = this;\r\n\t\t\t});// end observe\r\n\t\t}\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t}, // end bind\r\n\r\n\t_doChanged: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z.getValue(),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\t\r\n\trenderOptions: function () {\r\n\t\tvar Z = this,\r\n\t\t\tarrhtm = [];\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.required()){\r\n\t\t\tarrhtm.push('<option value=\"_null_\">');\r\n\t\t\tarrhtm.push(fldObj.nullText());\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\r\n\t\tfor (var i = Z._beginItem; i <= Z._endItem; i += Z._step) {\r\n\t\t\tarrhtm.push('<option value=\"');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('\">');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\t\tjQuery(Z.el).html(arrhtm.join(''));\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tvar value = Z.getValue();\r\n\t\t\tif (value !== null) {\r\n\t\t\t\tZ.el.value = value;\r\n\t\t\t} else {\r\n\t\t\t\tZ.el.value = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar arrValue = Z.getValue(),\r\n\t\t\t\toptCnt = Z.el.options.length, opt, selected, i;\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tif (opt) {\r\n\t\t\t\t\t\topt.selected = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar j, vcnt = arrValue.length - 1;\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tfor (j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.renderOptions();\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1, opt;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRangeSelect', jslet.ui.DBRangeSelect);\r\njslet.ui.DBRangeSelect.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Rating\r\n * \r\n * DBRating. A control which usually displays some star to user, and user can click to rate something. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRating\",dataset:\"employee\",field:\"grade\", itemCount: 5};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRating\",dataset:\"employee\",field:\"grade\"', itemCount: 5' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRating = jslet.Class.create(jslet.ui.Rating, {\r\n\t_isDBControl: true,\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t\tthis.refreshControl();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tZ._readOnly = fldObj.disabled() || fldObj.readOnly();\r\n\t\t}\r\n\t\tif(!metaName || metaName == \"required\") {\r\n\t\t\tZ._required = fldObj.required();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue();\r\n\t\t\r\n\t\tZ._value = value;\r\n\t\tZ._setValue(value);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoUIChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.setFieldValue(Z._field, Z.value(), Z._valueIndex);\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBRating', jslet.ui.DBRating);\r\njslet.ui.DBRating.htmlTemplate = '<Div></Div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBSelect. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBSelect\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBSelect\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,groupField,lookupDataset';\r\n\r\n\t\tZ._groupField = null;\r\n\t\t\r\n\t\tZ._lookupDataset = null;\r\n\t\t\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\t\r\n\t\tZ._isRendering = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get group field name, you can use this to group options. <br />\r\n\t * Detail to see HTML \"OptGroup\" element.\r\n\t * \r\n\t * @param {String | undefined} groupField Group field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tgroupField: function(groupField) {\r\n\t\tif(groupField === undefined) {\r\n\t\t\treturn this._groupField;\r\n\t\t}\r\n\t\tgroupField = jQuery.trim(groupField);\r\n\t\tjslet.Checker.test('DBSelect.groupField', groupField).isString();\r\n\t\tthis._groupField = groupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the lookup dataset to render \"Select Options\".\r\n\t * \r\n\t * @param {String | undefined} lookupDataset Lookup dataset name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupDataset: function(lookupDataset) {\r\n\t\tif(lookupDataset === undefined) {\r\n\t\t\treturn this._lookupDataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(lookupDataset)) {\r\n\t\t\tlookupDataset = jslet.data.getDataset(jQuery.trim(lookupDataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBSelect.lookupDataset', lookupDataset).isClass(jslet.data.Dataset.className);\r\n\t\tthis._lookupDataset = lookupDataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', Z._doCheckLimitCount);\r\n\t\t}\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t_doChanged: function(event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z._dataset.getFieldValue(Z._field),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\r\n\t_doCheckLimitCount: function(event) {\r\n\t\tvar Z = event.delegateTarget.jslet;\r\n\t\tZ._currOption = this;\r\n\t},\r\n\r\n\t_setDefaultValue: function(fldObj, firstItemValue) {\r\n\t\tif(!firstItemValue || !fldObj.required()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dftValue = fldObj.defaultValue();\r\n\t\tif(dftValue) {\r\n\t\t\tvar lkds = fldObj.lookup().dataset();\r\n\t\t\tvar found = lkds.findByKey(dftValue);\r\n\t\t\tif(found) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tdftValue = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!dftValue) {\r\n\t\t\tfldObj.defaultValue(firstItemValue);\r\n\t\t}\r\n\t\tif(this._dataset.changedStatus() && !fldObj.getValue()) {\r\n\t\t\tfldObj.setValue(firstItemValue);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif(Z._lookupDataset) {\r\n\t\t\tlkf = new jslet.data.FieldLookup(fldObj, {dataset: Z._lookupDataset});\r\n\t\t} else {\r\n\t\t\tif (!lkf) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._isRendering = true;\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tgroupIsLookup = false,\r\n\t\t\tgroupLookup, \r\n\t\t\tgroupFldObj, \r\n\t\t\textraIndex;\r\n\t\tif (Z._groupField) {\r\n\t\t\tgroupFldObj = lkds.getField(Z._groupField);\r\n\t\t\tif (groupFldObj === null) {\r\n\t\t\t\tthrow 'NOT found field: ' + Z._groupField + ' in ' + lkds.name();\r\n\t\t\t}\r\n\t\t\tlkds.indexFields(Z._groupField);\r\n\t\t}\r\n\t\tvar preGroupValue = null, groupValue, groupDisplayValue, content = [];\r\n\r\n\t\tif (!Z.el.multiple && !fldObj.required()){\r\n\t\t\tcontent.push('<option value=\"_null_\">');\r\n\t\t\tcontent.push(fldObj.nullText());\r\n\t\t\tcontent.push('</option>');\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno(),\r\n\t\t\toptValue, optDispValue, \r\n\t\t\tfirstItemValue = null,\r\n\t\t\teditFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false, allCnt = 0;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = lkds.recordCount(); i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (Z._groupField) {\r\n\t\t\t\t\tgroupValue = lkds.getFieldValue(Z._groupField);\r\n\t\t\t\t\tif (groupValue != preGroupValue) {\r\n\t\t\t\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (groupIsLookup) {\r\n\t\t\t\t\t\t\tif (!groupLookup.dataset()\r\n\t\t\t\t\t\t\t\t\t\t\t.findByField(groupLookup.keyField(), groupValue)) {\r\n\t\t\t\t\t\t\t\tthrow 'Not found: [' + groupValue + '] in Dataset: [' +\r\n\t\t\t\t\t\t\t\t\tgroupLookup.dataset().name() +\r\n\t\t\t\t\t\t\t\t\t']field: [' + groupLookup.keyField() + ']';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupLookup.getCurrentDisplayValue();\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupValue;\r\n\r\n\t\t\t\t\t\tcontent.push('<optgroup label=\"');\r\n\t\t\t\t\t\tcontent.push(groupDisplayValue);\r\n\t\t\t\t\t\tcontent.push('\">');\r\n\t\t\t\t\t\tpreGroupValue = groupValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push('<option value=\"');\r\n\t\t\t\toptValue = lkds.getFieldValue(lkf.keyField());\r\n\t\t\t\tif(firstItemValue === null) {\r\n\t\t\t\t\tfirstItemValue = optValue;\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push(optValue);\r\n\t\t\t\tcontent.push('\"'+ (disableOption? ' disabled': '') +  '>');\r\n\t\t\t\tcontent.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\tcontent.push('</option>');\r\n\t\t\t\tallCnt++;\r\n\t\t\t} // end for\r\n\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t}\r\n\t\t\tif(allCnt > 100) {\r\n\t\t\t\tconsole.warn(fldObj.label() + '(' + Z._field + '): ' + jsletlocale.DBSelect.moreLookupRecords);\r\n\t\t\t}\r\n\r\n\t\t\tjQuery(Z.el).html(content.join(''));\r\n\t\t\tZ._setDefaultValue(fldObj, firstItemValue);\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText;\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar value = Z.getValue();\r\n\t\tif(!Z.el.multiple && value === Z.el.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar i, optCnt = Z.el.options.length, \r\n\t\t\topt;\r\n\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\topt = Z.el.options[i];\r\n\t\t\tif (opt) {\r\n\t\t\t\topt.selected = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tif(!Z._checkOptionEditable(fldObj, value)) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t\tif (value === null){\r\n\t\t\t\tif (!fldObj.required()) {\r\n\t\t\t\t\tvalue = '_null_';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t} else {\r\n\t\t\tvar arrValue = value;\r\n\t\t\tif(arrValue === null || arrValue.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tvar vcnt = arrValue.length - 1, selected;\r\n\t\t\tZ._skipRefresh = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\r\n\t\t\t\t\tfor (var j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n \r\n\t_checkOptionEditable: function(fldObj, fldValue) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerEditFilterExpr || fldValue === null || fldValue === undefined || fldValue === '') {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar lkDs = fldObj.lookup().dataset(); \r\n\t\tif(lkDs.findByKey(fldValue) && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar opt, value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tif (!value) {\r\n\t\t\t\topt = Z.el.options[Z.el.selectedIndex];\r\n\t\t\t\tvalue = opt.innerHTML;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value ? opt.value : opt.innerHTML);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tZ._skipRefresh = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t\tvar valueChanged = false;\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\t\tvalue = null;\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t\tif(value != Z._dataset.getFieldValue(Z._field, Z._valueIndex)) {\r\n\t\t\t\t\tvalueChanged = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t\tif(value != Z._dataset.getFieldValue(Z._field)) {\r\n\t\t\t\t\tvalueChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(valueChanged) {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t\tZ.doValueChanged();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._skipRefresh = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._currOption = null;\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBSelect', jslet.ui.DBSelect);\r\njslet.ui.DBSelect.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBSelectView. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBSelectView\",dataset:\"employee\",displayFields:\"name\"};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBSelectView\",dataset:\"employee\",displayFields:\"name\"' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSelectView = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,displayFields,groupField';\r\n\r\n\t\tZ._groupField = null;\r\n\t\t\r\n\t\tZ._displayFields = null;\r\n\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\t\r\n\t\tZ._isRendering = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get group field name, you can use this to group options. <br />\r\n\t * Detail to see HTML \"OptGroup\" element.\r\n\t * \r\n\t * @param {String | undefined} groupField Group field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tgroupField: function(groupField) {\r\n\t\tif(groupField === undefined) {\r\n\t\t\treturn this._groupField;\r\n\t\t}\r\n\t\tgroupField = jQuery.trim(groupField);\r\n\t\tjslet.Checker.test('DBSelectView.groupField', groupField).isString();\r\n\t\tthis._groupField = groupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display fields to render tree node, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @param {String | undefined} displayFields Display fields, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdisplayFields: function(displayFields) {\r\n\t\tif(displayFields === undefined) {\r\n\t\t\tvar dispFields = this._displayFields;\r\n\t\t\tif(dispFields) {\r\n\t\t\t\tif(this._dataset.getField(dispFields)) {\r\n\t\t\t\t\treturn '[' + dispFields + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn dispFields;\r\n\t\t\t} else {\r\n\t\t\t\tvar dataset = this._dataset;\r\n\t\t\t\tvar dispField = dataset.nameField() || dataset.codeField() || dataset.keyField();\r\n\t\t\t\tif(dispField) {\r\n\t\t\t\t\treturn '[' + dispField + ']';\r\n\t\t\t\t}\r\n\t\t\t\tjslet.Checker.test('DBSelectView.displayFields', dispField).required();\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisplayFields = jQuery.trim(displayFields);\r\n\t\tjslet.Checker.test('DBSelectView.displayFields', displayFields).required().isString();\r\n\t\tthis._displayFields = displayFields;\r\n\t\tthis._innerDisplayFieldsExpr = null;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t}, // end bind\r\n\r\n\t_doChanged: function(event) {\r\n\t\tthis.jslet._dataset.recno(parseInt(this.value));\r\n\t},\r\n\t\r\n\t_renderOptions: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._isRendering = true;\r\n\t\tvar dsObj = Z.dataset(),\r\n\t\t\tgroupIsLookup = false,\r\n\t\t\tgroupLookup, \r\n\t\t\tgroupFldObj, \r\n\t\t\textraIndex;\r\n\t\tif (Z._groupField) {\r\n\t\t\tgroupFldObj = dsObj.getField(Z._groupField);\r\n\t\t\tif (groupFldObj === null) {\r\n\t\t\t\tthrow 'NOT found field: ' + Z._groupField + ' in ' + dsObj.name();\r\n\t\t\t}\r\n\t\t\tdsObj.fixedIndexFields(Z._groupField);\r\n\t\t}\r\n\t\tvar preGroupValue = null, groupValue, groupDisplayValue, content = [];\r\n\r\n\t\tvar oldRecno = dsObj.recno(),\r\n\t\t\toptValue, optDispValue, \r\n\t\t\tfirstItemValue = null,\r\n\t\t\tdispFieldExpr = Z.displayFields();\r\n\t\tjslet.Checker.test('DBSelectView.displayFields', dispFieldExpr).required().isString();\r\n\t\tif(!Z._innerDisplayFieldsExpr) {\r\n\t\t\tZ._innerDisplayFieldsExpr = new jslet.data.Expression(dsObj, dispFieldExpr);\r\n\t\t}\r\n\t\tvar allCnt = 0, displayValue;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = dsObj.recordCount(); i < cnt; i++) {\r\n\t\t\t\tdsObj.recnoSilence(i);\r\n\t\t\t\tif (Z._groupField) {\r\n\t\t\t\t\tgroupValue = dsObj.getFieldValue(Z._groupField);\r\n\t\t\t\t\tif (groupValue != preGroupValue) {\r\n\t\t\t\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (groupIsLookup) {\r\n\t\t\t\t\t\t\tif (!groupLookup.dataset()\r\n\t\t\t\t\t\t\t\t\t\t\t.findByField(groupLookup.keyField(), groupValue)) {\r\n\t\t\t\t\t\t\t\tthrow 'Not found: [' + groupValue + '] in Dataset: [' +\r\n\t\t\t\t\t\t\t\t\tgroupLookup.dataset().name() +\r\n\t\t\t\t\t\t\t\t\t']field: [' + groupLookup.keyField() + ']';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupLookup.getCurrentDisplayValue();\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupValue;\r\n\r\n\t\t\t\t\t\tcontent.push('<optgroup label=\"');\r\n\t\t\t\t\t\tcontent.push(groupDisplayValue);\r\n\t\t\t\t\t\tcontent.push('\">');\r\n\t\t\t\t\t\tpreGroupValue = groupValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push('<option value=\"'+ i +'\">');\r\n\t\t\t\tcontent.push(Z._innerDisplayFieldsExpr.eval());\r\n\t\t\t\tcontent.push('</option>');\r\n\t\t\t\tallCnt++;\r\n\t\t\t} // end for\r\n\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t}\r\n\t\t\tif(allCnt > 100) {\r\n\t\t\t\tconsole.warn(dsObj.name() + jsletlocale.DBSelectView.moreLookupRecords);\r\n\t\t\t}\r\n\r\n\t\t\tjQuery(Z.el).html(content.join(''));\r\n\t\t} finally {\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t\tZ.el.value = Z.dataset().recno();\r\n\t\t}\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tthis._renderOptions();\r\n\t\treturn this;\r\n\t},\r\n\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\t//empty\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tZ.el.value = Z.dataset().recno();\r\n\t\t}\r\n\t}, // end refreshControl\r\n\t\t\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBSelectView', jslet.ui.DBSelectView);\r\njslet.ui.DBSelectView.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBSpinEdit. \r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5};\r\n * \r\n *    //1. Declaring:\r\n *     <div data-jslet='type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5'></div>\r\n *     or\r\n *     <div data-jslet='jsletParam'></div>\r\n *\r\n *    //2. Binding\r\n *     <div id=\"ctrlId\"></div>\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *    //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSpinEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,step';\r\n\r\n\t\tZ._step = 1;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get step.\r\n\t * \r\n\t * @param {Integer | undefined} step Step value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBSpinEdit.step', step).isNumber();\r\n\t\tthis._step = step;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tag = el.tagName.toLowerCase();\r\n\t\treturn tag == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-spinedit')) {\r\n\t\t\tjqEl.addClass('input-group jl-spinedit');\r\n\t\t}\r\n\t\tZ._createControl();\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t_createControl: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\ts = '<input type=\"text\" class=\"form-control\">' + \r\n\t\t    \t'<div class=\"jl-spinedit-btn-group\">' +\r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-up\" tabindex=\"-1\"><i class=\"fa fa-caret-up\"></i></button>' + \r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-down\" tabindex=\"-1\"><i class=\"fa fa-caret-down\"></i></button>';\r\n\t\tjqEl.html(s);\r\n\t\t\r\n\t\tvar editor = jqEl.find('input')[0],\r\n\t\t\tupButton = jqEl.find('.jl-spinedit-up')[0],\r\n\t\t\tdownButton = jqEl.find('.jl-spinedit-down')[0];\r\n\t\tZ.editor = editor;\r\n\t\teditor.name = Z._field;\r\n\t\tjQuery(Z.editor).on(\"keydown\", function(event){\r\n\t\t\tif(Z._isDisabled()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar keyCode = event.keyCode;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.UP) {\r\n\t\t\t\tZ.decValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tZ.incValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t\tnew jslet.ui.DBText(editor, {\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._field,\r\n\t\t\tbeforeUpdateToDataset: Z.beforeUpdateToDataset,\r\n\t\t\tvalueIndex: Z._valueIndex,\r\n\t\t\ttabIndex: Z._tabIndex\r\n\t\t});\r\n\t\t\r\n\t\tvar jqBtn = jQuery(upButton);\r\n\t\tjqBtn.on('click', function () {\r\n\t\t\tZ.incValue();\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqBtn.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn = jQuery(downButton);\r\n\t\tjqBtn.on('click', function () {\r\n\t\t\tZ.decValue();\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqBtn.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_isDisabled: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\treturn fldObj.disabled() || fldObj.readOnly();\r\n\t},\r\n\t\r\n\tbeforeUpdateToDataset: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.el.value;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min || range.min === 0) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max || range.min === 0) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (val) {\r\n\t\t\tval = parseFloat(val);\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.el.value = val;\r\n\t\treturn true;\r\n\t},\r\n\r\n\tsetValueToDataset: function (val) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.silence) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.silence = true;\r\n\t\tif (val === undefined) {\r\n\t\t\tval = Z.value;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, val, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ.silence = false;\r\n\t\t}\r\n\t},\r\n\r\n\tincValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar maxValue = Z._getRange().maxValue;\r\n\t\tif (val === maxValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val < maxValue) {\r\n\t\t\tval += Z._step;\r\n\t\t} else {\r\n\t\t\tval = maxValue;\r\n\t\t}\r\n\t\tif (val > maxValue) {\r\n\t\t\tval = maxValue;\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_getRange: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min || range.min === 0) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max || range.min === 0) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {minValue: minValue, maxValue: maxValue};\r\n\t},\r\n\t\r\n\tdecValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar minValue = Z._getRange().minValue;\r\n\t\tif (val === minValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val > minValue) {\r\n\t\t\tval -= Z._step;\r\n\t\t} else {\r\n\t\t\tval = minValue;\r\n\t\t}\r\n\t\tif (val < minValue)\r\n\t\t\tval = minValue;\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tthis.editor.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\r\n\t\tif(!metaName || metaName == 'disabled' || metaName == 'readOnly') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly(),\r\n\t\t\t\tjqUpBtn = jqEl.find('.jl-spinedit-up'),\r\n\t\t\t\tjqDownBtn = jqEl.find('.jl-spinedit-down');\r\n\t\t\t\t\r\n\t\t\tif (disabled) {\r\n\t\t\t\tjqUpBtn.attr('disabled', 'disabled');\r\n\t\t\t\tjqDownBtn.attr('disabled', 'disabled');\r\n\t\t\t} else {\r\n\t\t\t\tjqUpBtn.attr('disabled', false);\r\n\t\t\t\tjqDownBtn.attr('disabled', false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'dataRange') {\r\n\t\t\tvar range = fldObj.dataRange();\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.min || range.min === 0) ? range.min: '');\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.max || range.max === 0) ? range.max: '');\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function(){\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function($super, tableId){\r\n\t\t$super(tableId);\r\n\t\tthis.editor.jslet.tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function(){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjQuery(this.editor).off();\r\n\t\tthis.editor = null;\r\n\t\tjqEl.find('.jl-upbtn-up').off();\r\n\t\tjqEl.find('.jl-downbtn-up').off();\r\n\t}\r\n\t\r\n});\r\njslet.ui.register('DBSpinEdit', jslet.ui.DBSpinEdit);\r\njslet.ui.DBSpinEdit.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBTimePicker is used for time inputting. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBTimePicker\",field:\"time\"};\r\n *     //1. Declaring:\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *      or\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='{type:\"DBTimePicker\",field:\"time\"}' />\r\n *\r\n *     //2. Binding\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTimePicker = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,is12Hour,hasSecond';\r\n\t\t\r\n\t\tZ._is12Hour = false;\r\n\t\t\r\n\t\tZ._hasSecond = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether use 12-hour style.\r\n\t * \r\n\t * @param {Boolean | undefined} is12Hour True - use 12-hour style, false(default) - use 24-hour style.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tis12Hour: function(is12Hour) {\r\n\t\tif(is12Hour === undefined) {\r\n\t\t\treturn this._is12Hour;\r\n\t\t}\r\n\t\tthis._is12Hour = is12Hour? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether exists \"Second\" part or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSecond True(default) - exists \"Second\" part, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSecond: function(hasSecond) {\r\n\t\tif(hasSecond === undefined) {\r\n\t\t\treturn this._hasSecond;\r\n\t\t}\r\n\t\tthis._hasSecond = hasSecond? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div' || tagName == 'span';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-timepicker')) {\r\n\t\t\tjqEl.addClass('form-control jl-timepicker');\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tjqEl.on('change', 'select', function(event){\r\n\t\t\tZ.updateToDataset();\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminTimePart = {hour: 0, minute: 0, second: 0},\r\n\t\t\tmaxTimePart = {hour: 23, minute: 59, second: 59};\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min) {\r\n\t\t\t\tminTimePart = Z._splitTime(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tmaxTimePart = Z._splitTime(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar\ttmpl = [];\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-hour\">');\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tvar minHour = minTimePart.hour;\r\n\t\t\tvar maxHour = maxTimePart.hour;\r\n\t\t\tvar min = 100, max = 0, hour;\r\n\t\t\tfor(var k = minHour; k < maxHour; k++) {\r\n\t\t\t\thour = k;\r\n\t\t\t\tif( k > 11) {\r\n\t\t\t\t\thour = k - 12;\r\n\t\t\t\t}\r\n\t\t\t\tmin = Math.min(min, hour);\r\n\t\t\t\tmax = Math.max(max, hour);\r\n\t\t\t}\r\n\t\t\ttmpl.push(Z._getOptions(min, max));\r\n\t\t} else {\r\n\t\t\ttmpl.push(Z._getOptions(minTimePart.hour, maxTimePart.hour || 23));\r\n\t\t}\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-minute\">');\r\n\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\tif(Z._hasSecond) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-second\">');\r\n\t\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\t\ttmpl.push('</select>');\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-ampm\"><option value=\"am\">AM</option><option value=\"pm\">PM</option></select>');\r\n\t\t}\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_getOptions: function(begin, end) {\r\n\t\tvar result = [], value;\r\n\t\tfor(var i = begin; i <= end; i++) {\r\n\t\t\tif( i < 10) {\r\n\t\t\t\tvalue = '0' + i;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '' + i;\r\n\t\t\t}\r\n\t\t\tresult.push('<option value=\"');\r\n\t\t\tresult.push(i);\r\n\t\t\tresult.push('\">');\r\n\t\t\tresult.push(value);\r\n\t\t\tresult.push('</option>');\r\n\t\t}\r\n\t\treturn result.join('');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar items = jQuery(Z.el).find(\"select\"), item,\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\tfor(var i = 0, cnt = items.length; i < cnt; i++){\r\n\t\t\t\titem = items[i];\r\n\t\t\t\titem.disabled = disabled;\r\n\t\t\t\tjslet.ui.setEditableStyle(item, disabled, disabled, true, required);\r\n\t\t\t\titem.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\ttimePart = Z._splitTime(value),\r\n\t\t\thour = timePart.hour,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHour = jqEl.find('.jl-time-hour'),\r\n\t\t\tjqMinute = jqEl.find('.jl-time-minute');\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tvar jqAmPm = jqEl.find('.jl-time-ampm');\r\n\t\t\tjqAmPm.prop('selectedIndex', hour < 12 ? 0: 1);\r\n\t\t\tif(hour > 11) {\r\n\t\t\t\thour -= 12;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjqHour.val(hour);\r\n\t\tjqMinute.val(timePart.minute);\r\n\t\tif(Z._hasSecond) {\r\n\t\t\tjqMinute = jqEl.find('.jl-time-second');\r\n\t\t\tjqMinute.val(timePart.second);\r\n\t\t}\r\n\t},\r\n\t \r\n\t_splitTime: function(value) {\r\n\t\tvar\thour = 0,\r\n\t\t\tminute = 0,\r\n\t\t\tsecond = 0;\r\n\t\tif(value) {\r\n\t\t\tif(jslet.isDate(value)) {\r\n\t\t\t\thour = value.getHours();\r\n\t\t\t\tminute = value.getMinutes();\r\n\t\t\t\tsecond = value.getSeconds();\r\n\t\t\t} else if(jslet.isString(value)) {\r\n\t\t\t\tvar parts = value.split(\":\");\r\n\t\t\t\thour = parseInt(parts[0]);\r\n\t\t\t\tif(parts.length > 1) {\r\n\t\t\t\t\tminute = parseInt(parts[1]);\r\n\t\t\t\t}\r\n\t\t\t\tif(parts.length > 2) {\r\n\t\t\t\t\tsecond = parseInt(parts[2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {hour: hour, minute: minute, second: second};\r\n\t},\r\n\t\r\n\t_prefix: function(value) {\r\n\t\tif(parseInt(value) < 10) {\r\n\t\t\treturn '0' + value;\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tvalue = null, hour;\r\n\t\t\tif(fldObj.getType() != jslet.data.DataType.DATE) {\r\n\t\t\t\tvalue = [];\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val()) + 12;\r\n\t\t\t\t\tvalue.push(hour);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-hour').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue.push(':');\r\n\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-minute').val()));\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tvalue.push(':');\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-second').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue = value.join('');\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getValue();\r\n\t\t\t\tif(!value) {\r\n\t\t\t\t\tvalue = new Date();\r\n\t\t\t\t}\r\n\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val());\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour += 12;\r\n\t\t\t\t}\r\n\t\t\t\tvar minute = parseInt(jqEl.find('.jl-time-minute').val());\r\n\t\t\t\tvar second = 0;\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tsecond = parseInt(jqEl.find('.jl-time-second').val());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvalue.setHours(hour);\r\n\t\t\t\tvalue.setMinutes(minute);\r\n\t\t\t\tvalue.setSeconds(second);\r\n\t\t\t}\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('.jl-time-hour').focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBTimePicker', jslet.ui.DBTimePicker);\r\njslet.ui.DBTimePicker.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBUEditor is a data sensitive UEditor. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBUEditor,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBUEditor,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBUEditor = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,height';\r\n\r\n\t\tZ._height = 150;\r\n\t\t\r\n\t\tZ._oldValue = null;\r\n\t\t\r\n\t\tZ._editor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get UEditor initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height UEditor initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBUEditor.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!window.UE) {\r\n\t\t\tthrow new Error('Not found UEditor component! Goto for more: http://ueditor.baidu.com/website/');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('jl-ueditor');\r\n\t\tvar editorId = jslet.nextId();\r\n\t\tvar html = '<textarea></textarea>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.children().attr('id', editorId).attr('name', Z._field);\r\n\t\tvar editor = window.UE.getEditor(editorId);\r\n\t\t\r\n\t\teditor.on('focus', jQuery.proxy(Z._doFocus, Z));\r\n\t\teditor.on('contentchange', jQuery.proxy(Z._doChange, Z));\r\n\t\tZ._editor = editor;\r\n\t\teditor.addListener('ready', function(editor) {\r\n\t\t\tZ.renderAll();\r\n\t\t });\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t},\r\n\r\n\t_doChange: function() {\r\n\t\tthis.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tconsole.warn('UEditor Not support this feature: set read only!');\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError(), value;\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\tvalue = errObj.inputText;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t\tvalue = Z.getText();\r\n\t\t}\r\n\t\tZ._editor.setContent(value || '');\r\n\t\tZ._oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinnerFocus: function($super) {\r\n\t\tthis._editor.focus();\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z._editor.getContent();\r\n\t\tif(Z._oldValue == value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tZ._editor = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBUEditor', jslet.ui.DBUEditor);\r\njslet.ui.DBUEditor.htmlTemplate = '<div></div>';\r\n\r\n\n/*\r\n * Inner Class for DBTable and DBTreeView control\r\n */\r\n\"use strict\";\r\njslet.ui.ListViewModel = function (dataset, isTree) {// boolean, identify if it's tree model\r\n\tvar visibleCount = 0,\r\n\t\tvisibleStartRow = 0,\r\n\t\tvisibleEndRow = 0,\r\n\t\tneedShowRows = null,//Array of all rows that need show, all of these rows's status will be 'expanded'\r\n\t\tallRows = null,//Array of all rows, include 'expanded' and 'collapsed' rows\r\n\t\tcurrentRowno = 0,\r\n\t\tcurrentRecno = 0;\r\n\tthis.onTopRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onVisibleCountChanged = null; //Event handler: function(visibleRowCount){}\r\n\tthis.onCurrentRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onNeedShowRowsCountChanged = null; //Event handler: function(needShowCount){}\r\n\tthis.onCheckStateChanged = null;  //Event handler: function(){}\r\n\t\t\r\n\tthis.fixedRows = 0;\r\n\tvar initial = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar ds = dataset;\r\n\t\tif (!ds._parentField || !ds._keyField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\tinitial();\r\n\t\r\n\tthis.refreshModel = function (expandLevel) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\texpandLevel = -1;\r\n\t\t}\r\n\t\tvar dsObj = dataset, \r\n\t\t\thiddenCnt = 0, \r\n\t\t\trecno, \r\n\t\t\tallCnt = dsObj.recordCount(), \r\n\t\t\tchildCnt, \r\n\t\t\tresult = [], \r\n\t\t\tpId,\r\n\t\t\toldRecno = dsObj.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdsObj.recnoSilence(this.fixedRows);\r\n\t\t\tvar level = 0, \r\n\t\t\t\tpnodes = [], \r\n\t\t\t\tnode, pnode, \r\n\t\t\t\ttmpNode, tmpKeyValue,\r\n\t\t\t\tcurrRec, keyValue, recCnt;\r\n\t\t\tfor(recno = 0, recCnt = dsObj.recordCount(); recno < recCnt; recno++) {\r\n\t\t\t\tdsObj.recnoSilence(recno);\r\n\t\t\t\tkeyValue = dsObj.keyValue();\r\n\t\t\t\tlevel = 0;\r\n\t\t\t\tpnode = null;\r\n\t\t\t\tpId = dsObj.parentValue();\r\n\t\t\t\tfor(var m = pnodes.length - 1; m>=0; m--) {\r\n\t\t\t\t\ttmpNode = pnodes[m];\r\n\t\t\t\t\ttmpKeyValue = tmpNode.keyvalue; \r\n\t\t\t\t\tif (tmpKeyValue !== null && \r\n\t\t\t\t\t\ttmpKeyValue !== undefined && \r\n\t\t\t\t\t\ttmpKeyValue !== '' && \r\n\t\t\t\t\t\ttmpKeyValue == pId) {\r\n\t\t\t\t\t\tlevel = tmpNode.level + 1;\r\n\t\t\t\t\t\tpnode = tmpNode;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tfor(var k = pnodes.length - 1; k > m; k--) {\r\n\t\t\t\t\t\tpnodes.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcurrRec = dsObj.getRecord();\r\n\t\t\t\tvar expanded = true;\r\n\t\t\t\tif(expandLevel >= 0 && level <= expandLevel) {\r\n\t\t\t\t\texpanded = true;\r\n\t\t\t\t} else { \r\n\t\t\t\t\texpanded = dsObj.expanded();\r\n\t\t\t\t}\r\n\t\t\t\tnode = { parent: pnode, recno: recno, keyvalue: keyValue, expanded: expanded, isbold: 0, level: level };\r\n\t\t\t\tpnodes.push(node);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tif (!pnode.children) {\r\n\t\t\t\t\t\tpnode.children = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpnode.children.push(node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(node);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} //end for recno\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tallRows = result;\r\n\t\tfor(var j = 0, len = allRows.length; j < len; j++) {\r\n\t\t\tthis._updateNodeBoldStyle(allRows[j]);\r\n\t\t}\r\n\t\tthis._setLastFlag(result);\r\n\t\tthis._refreshNeedShowRows();\r\n\t};\r\n\t\t\r\n\tthis._updateNodeBoldStyle = function(node) {\r\n\t\t\r\n\t\tfunction update(pnode) {\r\n\t\t\tvar children = pnode.children, \r\n\t\t\t\tcnode, found = false;\r\n\t\t\tif(!children) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, cnt = children.length; i < cnt; i++) {\r\n\t\t\t\tcnode = children[i];\r\n\t\t\t\tif(cnode.children) {\r\n\t\t\t\t\tupdate(cnode);\r\n\t\t\t\t\tif(!cnode.isbold) {\r\n\t\t\t\t\t\tif (dataset.selectedByRecno(cnode.recno)) {\r\n\t\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (dataset.selectedByRecno(cnode.recno)) {\r\n\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tpnode.isbold = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!node) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar pNode = node, root = node;\r\n\t\twhile(true) {\r\n\t\t\tpNode = node.parent;\r\n\t\t\tif(pNode === null) {\r\n\t\t\t\troot = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tnode = pNode;\r\n\t\t}\r\n\t\tupdate(root);\r\n\t};\r\n\t\r\n\tthis._setLastFlag = function (nodes) {\r\n\t\tif (!nodes || nodes.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tnodes[nodes.length - 1].islast = true;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._setLastFlag(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._refreshNeedShowRows = function (notFireChangedEvent) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = [], node;\r\n\t\tif (!allRows) {\r\n\t\t\tthis.refreshModel();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar preCnt = needShowRows ? needShowRows.length: 0;\r\n\t\tneedShowRows = [];\r\n\t\tthis._findVisibleNode(allRows);\r\n\t\tvar currCnt = needShowRows.length;\r\n\t\tif (!notFireChangedEvent && this.onNeedShowRowsCountChanged){\r\n\t\t\tthis.onNeedShowRowsCountChanged(currCnt);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.hasChildren = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.children && node.children.length > 0;\r\n\t};\r\n\t\r\n\tthis.getLevel = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.level;\r\n\t};\r\n\t\r\n\tthis._findVisibleNode = function (nodes) {\r\n\t\tif (!nodes) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tneedShowRows.push(node);\r\n\t\t\tif (node.expanded){\r\n\t\t\t\tthis._findVisibleNode(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.rownoToRecno = function (rowno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn rowno + this.fixedRows;\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = rowno + this.fixedRows;\r\n\t\t\treturn rowno >= 0 ? rowno : -1;\r\n\t\t}\r\n\t\tif (rowno >= needShowRows.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn needShowRows[rowno].recno;\r\n\t};\r\n\t\r\n\tthis.recnoToRowno = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn recno - this.fixedRows;\r\n\t\t}\r\n\t\tfor(var i = 0, cnt = needShowRows.length; i < cnt; i++){\r\n\t\t\tif (needShowRows[i].recno == recno) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\t\r\n\tthis.setVisibleStartRow = function (rowno, notFireEvt) {\r\n\t\tif (rowno >= 0) {\r\n\t\t\tvar maxVisibleNo = this.getNeedShowRowCount() + 1 - visibleCount;\r\n\t\t\tif (rowno > maxVisibleNo) {\r\n\t\t\t\trowno = maxVisibleNo;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = 0;\r\n\t\t}\r\n\t\tif (visibleStartRow == rowno) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleStartRow = rowno;\r\n\t\tvisibleEndRow = rowno + visibleCount - 1;\r\n\t\tif (!notFireEvt && this.onTopRownoChanged) {\r\n\t\t\tthis.onTopRownoChanged(rowno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleStartRow = function () {\r\n\t\treturn visibleStartRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleEndRow = function(endRow){\r\n\t\tvisibleEndRow = endRow;\r\n\t};\r\n\t\r\n\tthis.getVisibleEndRow = function(){\r\n\t\treturn visibleEndRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleCount = function (count, notFireEvt) {\r\n\t\tif (visibleCount == count) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleCount = count;\r\n\t\tvisibleEndRow = visibleStartRow + count - 1;\r\n\t\tif (!notFireEvt && this.onVisibleCountChanged) {\r\n\t\t\tthis.onVisibleCountChanged(count);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleCount = function () {\r\n\t\treturn visibleCount;\r\n\t};\r\n\t\r\n\tthis.getNeedShowRowCount = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn dataset.recordCount()- this.fixedRows;\r\n\t\t}\r\n\t\treturn needShowRows.length;\r\n\t};\r\n\t\r\n\tthis.getCurrentRow = function(){\r\n\t\treturn needShowRows[currentRowno];\r\n\t};\r\n\t\r\n\tthis.skipSetCurrentRowno = function() {\r\n\t\tthis._skipSetCurrentRowno = true;\r\n\t};\r\n\t\r\n\tthis.setCurrentRowno = function (rowno, notFireEvt, checkVisible) {\r\n\t\tif(this._skipSetCurrentRowno) {\r\n\t\t\tthis._skipSetCurrentRowno = false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(rowno === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar preRowno = currentRowno, recno = 0, currRow=null;\r\n\t\tif (rowno < 0){//In the fixed row area\r\n\t\t\tvar lowestRowno = -1 * this.fixedRows;\r\n\t\t\tif (rowno < lowestRowno) {\r\n\t\t\t\trowno = lowestRowno;\r\n\t\t\t}\r\n\t\t\trecno = this.fixedRows + rowno;\r\n\t\t} else {\r\n\t\t\tvar maxRow = this.getNeedShowRowCount();\r\n\t\t\tif(maxRow === 0) {\r\n\t\t\t\tcurrentRowno = 0;\r\n\t\t\t\tcurrentRecno = -1;\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (rowno >= maxRow) {\r\n\t\t\t\trowno = maxRow - 1;\r\n\t\t\t}\r\n\t\t\tif (!isTree) {\r\n\t\t\t\trecno = rowno + this.fixedRows;\r\n\t\t\t} else {\r\n\t\t\t\tcurrRow = needShowRows[rowno];\r\n\t\t\t\trecno = currRow.recno;\r\n\t\t\t}\r\n\t\t\tif (checkVisible) {\r\n\t\t\t\tif (rowno >= 0 && rowno < visibleStartRow){\r\n\t\t\t\t\tthis.setVisibleStartRow(rowno);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (rowno >= visibleStartRow + visibleCount) {\r\n\t\t\t\t\t\tthis.setVisibleStartRow(rowno - visibleCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcurrentRowno = rowno;\r\n\t\tcurrentRecno = recno;\r\n\t\tif (!notFireEvt && this.onCurrentRownoChanged) {\r\n\t\t\tthis.onCurrentRownoChanged(preRowno, currentRowno);\r\n\t\t}\r\n\t\treturn currRow;\r\n\t};\r\n\t\r\n\tthis.getCurrentRowno = function () {\r\n\t\treturn currentRowno;\r\n\t};\r\n\t\r\n\tthis.getCurrentRecno = function() {\r\n\t\treturn currentRecno;\r\n\t};\r\n\t\r\n\tthis.nextRow = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno + 1, false, true);\r\n\t};\r\n\t\r\n\tthis.priorRow = function (num) {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno - 1, false, true);\r\n\t};\r\n\t\r\n\tthis.nextPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow + visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis.priorPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow - visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis._innerFindNode = function (nodes, recno) {\r\n\t\tvar node, nextNode;\r\n\t\tfor (var i = 0, cnt = nodes.length - 1; i <= cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.recno == recno) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t\tif (node.children) {\r\n\t\t\t\tvar result = this._innerFindNode(node.children, recno);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis.expand = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tnode.expanded = node.children ? true : false;\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(node.expanded);\r\n\t\t\tvar p = node;\r\n\t\t\twhile (true) {\r\n\t\t\t\tp = p.parent;\r\n\t\t\t\tif (!p) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (!p.expanded) {\r\n\t\t\t\t\tdataset.recnoSilence(p.recno);\r\n\t\t\t\t\tdataset.expanded(true);\r\n\t\t\t\t\tp.expanded = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapse = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(false);\r\n\t\t\tnode.expanded = false;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\t\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._iterateNode = function (nodes, callbackFn) {\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children) {\r\n\t\t\t\tif (callbackFn) {\r\n\t\t\t\t\tcallbackFn(node);\r\n\t\t\t\t}\r\n\t\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\t\tthis._iterateNode(node.children, callbackFn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._callbackFn = function (node, expanded) {\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(expanded);\r\n\t\t\tnode.expanded = expanded;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.expandAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, true); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapseAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, false); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.syncDataset = function(){\r\n\t\tvar recno = dataset.recno();\r\n\t\tif(recno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno()),\r\n\t\t\tpnode = node.parent;\r\n\t\tif (pnode && !pnode.expanded){\r\n\t\t\twhile(true){\r\n\t\t\t\tif (!pnode.expanded) {\r\n\t\t\t\t\tpnode.expanded = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tpnode = pnode.parent;\r\n\t\t\t\tif (!pnode) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tvar rowno = this.recnoToRowno(recno);\r\n\t\tthis.setCurrentRowno(rowno, false, true);\r\n\t};\r\n\t\r\n\tthis.checkNode = function(state, relativeCheck, onlyCheckChildren){\r\n\t\tvar node = this.getCurrentRow();\r\n\t\tdataset.selected(state ? 1 : 0);\r\n\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._updateChildState(node, state);\r\n\t\t\t}\r\n\t\t\tif (node.parent && !onlyCheckChildren) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._updateNodeBoldStyle(node);\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.checkChildNodes = function(state, relativeCheck){\r\n\t\tvar node = this.getCurrentRow();\r\n\t\tdataset.selected(state ? 1 : 0);\r\n\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._updateChildState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._updateNodeBoldStyle(node);\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateChildState = function(node, state){\r\n\t\tvar oldRecno = dataset.recnoSilence(),\r\n\t\t\tchildNode;\r\n\t\ttry{\r\n\t\t\tfor(var i = 0, cnt = node.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = node.children[i];\r\n\t\t\t\tdataset.recnoSilence(childNode.recno);\r\n\t\t\t\tdataset.selected(state);\r\n\t\t\t\tif (childNode.children && childNode.children.length > 0) {\r\n\t\t\t\t\tthis._updateChildState(childNode, state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateParentState = function(node, state){\r\n\t\tvar pNode = node.parent;\r\n\t\tif (!pNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar childNode, newState, childState;\r\n\t\tif (state != 2){\r\n\t\t\tfor(var i = 0, cnt = pNode.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = pNode.children[i];\r\n\t\t\t\tchildState = dataset.selectedByRecno(childNode.recno);\r\n\t\t\t\tif (childState == 2){\r\n\t\t\t\t\tnewState = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (i === 0){\r\n\t\t\t\t\tnewState = childState;\r\n\t\t\t\t} else if (newState != childState){\r\n\t\t\t\t\tnewState =2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}//end for\r\n\t\t} else {\r\n\t\t\tnewState = state;\r\n\t\t}\r\n\t\tvar pState = dataset.selectedByRecno(pNode.recno);\r\n\t\tif (pState != newState){\r\n\t\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\t\ttry{\r\n\t\t\t\tdataset.recnoSilence(pNode.recno);\r\n\t\t\t\tdataset.selected(newState);\r\n\t\t\t}finally{\r\n\t\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateParentState(pNode, newState);\r\n\t};\r\n\t\r\n\tthis.reset = function() {\r\n\t\tvisibleCount = 0;\r\n\t\tvisibleStartRow = 0;\r\n\t\tvisibleEndRow = 0;\r\n\t\tneedShowRows = null;\r\n\t\tallRows = null;\r\n\t\tcurrentRowno = 0;\r\n\t\tcurrentRecno = 0;\r\n\t\tthis.fixedRows = 0;\r\n\t};\r\n\t\r\n\tthis.destroy = function(){\r\n\t\tdataset = null;\r\n\t\tallRows = null;\r\n\t\tthis.reset();\r\n\t\tthis.onTopRownoChanged = null;\r\n\t\tthis.onVisibleCountChanged = null;\r\n\t\tthis.onCurrentRownoChanged = null;\r\n\t\tthis.onNeedShowRowsCountChanged = null;\r\n\t\tthis.onCheckStateChanged = null;\r\n\t};\r\n};\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBTreeView. <br /> \r\n * Features: <br />\r\n * 1. Perfect performance, you can load unlimited data; <br />\r\n * 2. Checkbox on tree node; <br />\r\n * 3. Relative check, when you check one tree node, its children and its parent will check too; <br />\r\n * 4. Many events for you to customize tree control; <br />\r\n * 5. Context menu supported and you can customize your context menu; <br />\r\n * 6. Icon supported on each tree node. <br />\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = { type: \"DBTreeView\", \r\n *     \tdataset: \"dsAgency\", \r\n *     \tdisplayFields: \"[code]+'-'+[name]\",\r\n *      keyField: \"id\", \r\n *     \tparentField: \"parentid\",\r\n *      hasCheckBox: true, \r\n *     \ticonClassField: \"iconcls\", \r\n *     \tonCreateContextMenu: doCreateContextMenu, \r\n *     \tcorrelateCheck: true\r\n *     };\r\n *     \r\n *     //1. Declaring:\r\n *       <div id=\"ctrlId\" data-jslet=\"jsletParam\">\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *     \tvar el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTreeView = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,displayFields,useArrow,itemHeight,hasLine,hasCheckBox,enableErrorFinding,correlateCheck,correlative,onlyCheckChildren,readOnly,expandLevel,onItemClick,onItemDblClick,beforeCheckBoxClick,afterCheckBoxClick,iconClassField,onGetIconClass,onRenderItem,onCreateContextMenu';\r\n\t\tZ.requiredProperties = 'displayFields';\r\n\t\t\r\n\t\tZ._displayFields = null;\r\n\r\n\t\tZ._itemHeight = 22;\r\n\t\t\r\n\t\tZ._useArrow = false;\r\n\r\n\t\tZ._hasLine = true;\r\n\r\n\t\tZ._hasCheckBox = false;\r\n\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ._correlative = false;\r\n\t\t\r\n\t\tZ._onlyCheckChildren = false;\r\n\t\t\r\n\t\tZ._iconClassField = null;\r\n\t\t\r\n\t\tZ._expandLevel = -1;\r\n\t\t\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._onItemDblClick = null;\r\n\r\n\t\tZ._beforeCheckBoxClick = null;\r\n\t\t\r\n\t\tZ._afterCheckBoxClick = null;\r\n\r\n\t\tZ._onGetIconClass = null;\r\n\t\t\r\n\t\tZ._onRenderItem = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ._enableErrorFinding = false;\r\n\t\t\r\n\t\tZ.iconWidth = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display fields to render tree node, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @param {String | undefined} displayFields Display fields, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdisplayFields: function(displayFields) {\r\n\t\tif(displayFields === undefined) {\r\n\t\t\tvar dispFields = this._displayFields;\r\n\t\t\tif(dispFields) {\r\n\t\t\t\tif(this._dataset.getField(dispFields)) {\r\n\t\t\t\t\treturn '[' + dispFields + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn dispFields;\r\n\t\t\t} else {\r\n\t\t\t\tvar dataset = this._dataset;\r\n\t\t\t\tvar dispField = dataset.nameField() || dataset.codeField() || dataset.keyField();\r\n\t\t\t\tif(dispField) {\r\n\t\t\t\t\treturn '[' + dispField + ']';\r\n\t\t\t\t}\r\n\t\t\t\tjslet.Checker.test('DBTreeView.displayFields', dispField).required();\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisplayFields = jQuery.trim(displayFields);\r\n\t\tjslet.Checker.test('DBTreeView.displayFields', displayFields).required().isString();\r\n\t\tthis._displayFields = displayFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get tree items' height, default is 22px.\r\n\t * \r\n\t * @param {Integer | undefined} itemHeight Tree items' height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\titemHeight: function(itemHeight) {\r\n\t\tif(itemHeight === undefined) {\r\n\t\t\treturn this._itemHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.itemHeight', itemHeight).isNumber();\r\n\t\tthis._itemHeight = itemHeight;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If icon class is stored one field, you can set this property to display different tree node icon.\r\n\t * \r\n\t * @param {String | undefined} iconClassField Icon class field.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ticonClassField: function(iconClassField) {\r\n\t\tif(iconClassField === undefined) {\r\n\t\t\treturn this._iconClassField;\r\n\t\t}\r\n\t\ticonClassField = jQuery.trim(iconClassField);\r\n\t\tjslet.Checker.test('DBTreeView.iconClassField', iconClassField).isString();\r\n\t\tthis._iconClassField = iconClassField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, use \"Arrow\" as expander, else \"Plus/Minus\" as expander.\r\n\t * \r\n\t * @param {Boolean | undefined} useArrow True - use \"Arrow\" as expander, False - \"Plus/Minus\" as expander.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tuseArrow: function(useArrow) {\r\n\t\tif(useArrow === undefined) {\r\n\t\t\treturn this._useArrow;\r\n\t\t}\r\n\t\tthis._useArrow = useArrow ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is a line before tree node.\r\n\t * \r\n\t * @param {Boolean | undefined} hasLine True - a line before tree node, False - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasLine: function(hasLine) {\r\n\t\tif(hasLine === undefined) {\r\n\t\t\treturn this._hasLine;\r\n\t\t}\r\n\t\tthis._hasLine = hasLine ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is a check box on tree node.\r\n\t * \r\n\t * @param {Boolean | undefined} hasCheckBox True - a check box on tree node, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasCheckBox: function(hasCheckBox) {\r\n\t\tif(hasCheckBox === undefined) {\r\n\t\t\treturn this._hasCheckBox;\r\n\t\t}\r\n\t\tthis._hasCheckBox = hasCheckBox ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\treturn this.correlative(correlateCheck);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, when you check one tree node, its children and its parent will be checked too.\r\n\t * \r\n\t * @param {Boolean | undefined} correlative If true, when checking one tree node, its children and its parent will be checked too.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelative: function(correlative) {\r\n\t\tif(correlative === undefined) {\r\n\t\t\treturn this._correlative;\r\n\t\t}\r\n\t\tthis._correlative = correlative ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, only check children.\r\n\t * \r\n\t * @param {Boolean | undefined} onlyCheckChildren True - only check children, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlyCheckChildren: function(onlyCheckChildren) {\r\n\t\tif(onlyCheckChildren === undefined) {\r\n\t\t\treturn this._onlyCheckChildren;\r\n\t\t}\r\n\t\tthis._onlyCheckChildren = onlyCheckChildren ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the checkbox is read only or not, ignored if \"hasCheckBox\" is false.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly Checkbox is readOnly or not, ignored if hasCheckBox = false.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the nodes which level is from 0 to \"expandLevel\" will be expanded when initialize tree.\r\n\t * \r\n\t * @param {Integer | undefined} expandLevel Identify the nodes which level is from 0 to \"expandLevel\" will be expanded when initialize tree.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\texpandLevel: function(expandLevel) {\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\treturn this._expandLevel;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.expandLevel', expandLevel).isGTEZero();\r\n\t\tthis._expandLevel = parseInt(expandLevel);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it's showing the 'Error find' menu item in the context menu.\r\n\t * \r\n\t * @param {Boolean | undefined} enableErrorFinding True - show error find menu item in the context menu, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableErrorFinding: function(enableErrorFinding) {\r\n\t\tif(enableErrorFinding === undefined) {\r\n\t\t\treturn this._enableErrorFinding;\r\n\t\t}\r\n\t\tthis._enableErrorFinding = enableErrorFinding ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Get or set item clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onItemClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick Item clicking event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Get or set item double clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onItemDblClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} onItemDblClick Double clicking item event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemDblClick: function(onItemDblClick) {\r\n\t\tif(onItemDblClick === undefined) {\r\n\t\t\treturn this._onItemDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemDblClick', onItemDblClick).isFunction();\r\n\t\tthis._onItemDblClick = onItemDblClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get before check box clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.beforeCheckBoxClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} beforeCheckBoxClick Before check box clicking event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeCheckBoxClick: function(beforeCheckBoxClick) {\r\n\t\tif(beforeCheckBoxClick === undefined) {\r\n\t\t\treturn this._beforeCheckBoxClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.beforeCheckBoxClick', beforeCheckBoxClick).isFunction();\r\n\t\tthis._beforeCheckBoxClick = beforeCheckBoxClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get after check box click event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.afterCheckBoxClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} afterCheckBoxClick After check box clicking event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterCheckBoxClick: function(afterCheckBoxClick) {\r\n\t\tif(afterCheckBoxClick === undefined) {\r\n\t\t\treturn this._afterCheckBoxClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.afterCheckBoxClick', afterCheckBoxClick).isFunction();\r\n\t\tthis._afterCheckBoxClick = afterCheckBoxClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * You can use this event to customize your tree node icon flexibly. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onGetIconClass(function(keyValue, level, isLeaf) {\r\n\t *        return 'icon_class';\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} onGetIconClass Get icon class event.\r\n\t * @param {String} onGetIconClass.keyValue Key value of tree node.\r\n\t * @param {Integer} onGetIconClass.level Tree node level.\r\n\t * @param {Boolean} onGetIconClass.isLeaf Identify whether the tree node is the leaf node.\r\n\t * @param {String} onGetIconClass.return Icon class name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonGetIconClass: function(onGetIconClass) {\r\n\t\tif(onGetIconClass === undefined) {\r\n\t\t\treturn this._onGetIconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onGetIconClass', onGetIconClass).isFunction();\r\n\t\tthis._onGetIconClass = onGetIconClass;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get item rendering event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onRenderItem(function(iconEl, textEl, level, isLeaf) {});\r\n\t * \r\n\t * @param {Function | undefined} onRenderItem Item rendering event.\r\n\t * @param {HtmlElement} onRenderItem.iconEl HTML element for rendering icon.\r\n\t * @param {HtmlElement} onRenderItem.textEl HTML element for rendering text.\r\n\t * @param {Integer} onRenderItem.level Tree node level.\r\n\t * @param {Boolean} onRenderItem.isLeaf Identify whether the tree node is the leaf node.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRenderItem: function(onRenderItem) {\r\n\t\tif(onRenderItem === undefined) {\r\n\t\t\treturn this._onRenderItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onRenderItem', onRenderItem).isFunction();\r\n\t\tthis._onRenderItem = onRenderItem;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get context menu creating event. It's used to add customized menu. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onCreateContextMenu(function(menuItems) {\r\n\t *       menuItems.push({ name: '-' });\r\n\t *       menuItems.push({ id: 'customMenu', name: 'Customized Menu1', onClick: function() { alert('Customized Menu1 clicked!'); } });\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onCreateContextMenu context menu creating event.\r\n\t * @param {Object[]} onCreateContextMenu.menuItems context menu creating event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.scrBarSize = jslet.ui.scrollbarSize() + 1;\r\n\t\t\r\n\t\tif (Z._keyField === undefined) {\r\n\t\t\tZ._keyField = Z._dataset.keyField();\r\n\t\t}\r\n\t\tvar ti = jqEl.attr('tabindex');\r\n\t\tif (!ti) {\r\n\t\t\tjqEl.attr('tabindex', -1);\r\n\t\t}\r\n\t\tjqEl.keydown(function(event) {\r\n\t\t\tvar keyCode = event.which, \r\n\t\t\t\tctrlKey = event.ctrlKey;\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.E) { //ctrl + e\r\n\t\t\t\tZ.gotoNextError();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.HOME) { //ctrl + Home\r\n\t\t\t\tZ._dataset.first();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.END) { //ctrl + Home\r\n\t\t\t\tZ._dataset.last();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.on('mouseenter', 'td.jl-tree-text', function(event) {\r\n\t\t\tjQuery(this).addClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tjqEl.on('mouseleave', 'td.jl-tree-text', function(event) {\r\n\t\t\tjQuery(this).removeClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tif (!jqEl.hasClass('jl-tree')) {\r\n\t\t\tjqEl.addClass('jl-tree');\r\n\t\t}\r\n        var notFF = ((typeof Z.el.onmousewheel) == 'object'); //firefox or nonFirefox browser\r\n        var wheelEvent = (notFF ? 'mousewheel' : 'DOMMouseScroll');\r\n        jqEl.on(wheelEvent, function(event) {\r\n            var originalEvent = event.originalEvent;\r\n            var num = notFF ? originalEvent.wheelDelta / -120 : originalEvent.detail / 3;\r\n            Z.listvm.setVisibleStartRow(Z.listvm.getVisibleStartRow() + num);\r\n       \t\tevent.preventDefault();\r\n        });\r\n\t\t\r\n\t\tZ.renderAll();\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno()));\r\n\t\tZ._createContextMenu();\t\t\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t}, // end bind\r\n\t\r\n\t/**\r\n\t * @override\r\n\t*/\r\n\trenderAll: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.evaluator = new jslet.data.Expression(Z._dataset, Z.displayFields());\r\n\t\tif(Z._useArrow) {\r\n\t\t\tjqEl.removeClass('jl-tree-plus');\r\n\t\t\tjqEl.removeClass('jl-tree-plus-nl');\r\n\t\t\tjqEl.addClass('jl-tree-arrow');\r\n\t\t} else {\r\n\t\t\tjqEl.removeClass('jl-tree-arrow');\r\n\t\t\tif(Z._hasLine) {\r\n\t\t\t\tjqEl.addClass('jl-tree-plus');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.addClass('jl-tree-plus-nl');\r\n\t\t\t}\r\n\t\t}\r\n\t\tjqEl.html('');\r\n\t\tZ.oldWidth = jqEl.width();\r\n\t\tZ.oldHeight = jqEl.height();\r\n\t\tjqEl.css('line-height', Z._itemHeight + 'px');\r\n\t\tZ.nodeHeight = Z.iconWidth = (Z._itemHeight || parseInt(jslet.ui.getCssValue('jl-tree', 'line-height')));\r\n\t\tvar strHeight = jqEl[0].style.height; \r\n\t\tif(strHeight.indexOf('%') > 0) {\r\n\t\t\tZ.treePanelHeight = jqEl.parent().height() * parseFloat(strHeight) / 100;\r\n\t\t} else {\r\n\t\t\tZ.treePanelHeight = jqEl.height();\r\n\t\t}\r\n\t\tZ.treePanelWidth = jqEl.width();\r\n\t\tZ.nodeCount = Math.floor(Z.treePanelHeight / Z.nodeHeight);\r\n\r\n\t\tZ._initVm();\r\n\t\tZ._initFrame();\r\n\t\tZ.listvm.syncDataset();\r\n\t}, // end renderAll\r\n\t\r\n\t_initFrame: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\t\r\n\t\tjqEl.find('.jl-tree-container').off();\r\n\t\tjqEl.find('.jl-tree-scrollbar').off();\r\n\t\t\r\n\t\tvar strCheckbox = '<span class=\"fa-stack jl-tree-mixedchecked jl-hidden\"><i class=\"fa fa-square fa-stack-1x\"></i><i class=\"fa fa-square-o fa-stack-2x\" aria-hidden=\"true\"></i></span>';\r\n\t\tstrCheckbox += '<span class=\"fa fa-check-square-o jl-tree-checked jl-hidden\"></span>';\r\n\t\tstrCheckbox += '<span class=\"fa fa-square-o jl-tree-unchecked jl-hidden\"></span>';\r\n\t\tvar lines = [], i, cnt;\r\n\t\tfor(i = 0; i < 5; i++) {//Default cells for lines is 5\r\n\t\t\tlines.push('<td class=\"jl-tree-unit jl-tree-lines\" ');\r\n\t\t\tlines.push(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tlines.push('=\"0\"></td>');\r\n\t\t}\r\n\t\tvar strLines = lines.join(''),\r\n\t\t\ttmpl = ['<div class=\"jl-tree-container\">'],\r\n\t\t\tflag = !Z._hasLine || Z._useArrow;\r\n\t\tfor(i = 0, cnt = Z.nodeCount; i < cnt; i++) {\r\n\t\t\ttmpl.push('<table class=\"jl-tree-nodes\" cellpadding=\"0\" cellspacing=\"0\"><tr>');\r\n\t\t\ttmpl.push(strLines);\r\n\t\t\ttmpl.push('<td class=\"jl-tree-unit jl-tree-expander\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//expander\r\n\t\t\ttmpl.push('=\"1\">');\r\n\t\t\tif(flag) {\r\n\t\t\t\tif(Z._useArrow) {\r\n\t\t\t\t\ttmpl.push('<i class=\"fa fa-caret-right\" aria-hidden=\"true\"></i>');\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttmpl.push('<i class=\"fa fa-plus-square-o\" aria-hidden=\"true\"></i>');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttmpl.push('</td><td class=\"jl-tree-unit jl-tree-checkbox\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//checkbox\r\n\t\t\ttmpl.push('=\"2\">' + strCheckbox + '</td><td ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//icon\r\n\t\t\ttmpl.push('=\"3\"></td><td class=\"jl-tree-text\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//text\r\n\t\t\ttmpl.push('=\"9\" nowrap=\"nowrap\"></td></tr></table>');\r\n\t\t}\r\n\t\ttmpl.push('</div><div class=\"jl-tree-scrollbar\"><div class=\"jl-tree-tracker\"></div></div>');\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\t\r\n\t\tjqEl.on('click', 'td[data-nodetype]', function(event) {\r\n\t\t\tZ._doRowClick(event.currentTarget);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\tjqEl.on('dblclick', 'td[data-nodetype]', function(event) {\r\n\t\t\tZ._doRowDblClick(event.currentTarget);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\tZ.listvm.setVisibleCount(Z.nodeCount);\r\n\t\tvar sb = jqEl.find('.jl-tree-scrollbar');\r\n\t\t\r\n\t\tsb.on('scroll',function() {\r\n\t\t\tvar numb = Math.ceil(this.scrollTop/Z.nodeHeight);\r\n\t\t\tif (numb != Z.listvm.getVisibleStartRow()) {\r\n\t\t\t\tZ._skip_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(numb);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._skip_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto next error record if dataset exists error records. Press 'Ctrl + E' to call this method.\r\n\t */\r\n\tgotoNextError: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset.nextError()) {\r\n\t\t\tZ._dataset.firstError();\r\n\t\t}\r\n\t},\r\n\r\n\tresize: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\theight = jqEl.height(),\r\n\t\t\twidth = jqEl.width();\r\n\t\tif (width != Z.oldWidth) {\r\n\t\t\tZ.oldWidth = width;\r\n\t\t\tZ.treePanelWidth = jqEl.innerWidth();\r\n\t\t\tZ._fillData();\r\n\t\t}\r\n\t\tif (height != Z.oldHeight) {\r\n\t\t\tZ.oldHeight = height;\r\n\t\t\tZ.treePanelHeight = jqEl.innerHeight();\r\n\t\t\tZ.nodeCount = Math.floor(height / Z.nodeHeight) - 1;\r\n\t\t\tZ._initFrame();\r\n\t\t}\r\n\t},\r\n\t\r\n\thasChildren: function() {\r\n\t\treturn this.listvm.hasChildren();\r\n\t},\r\n\t\r\n\t_initVm:function() {\r\n\t\tvar Z=this;\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, true);\r\n\t\tZ.listvm.refreshModel(Z._expandLevel);\r\n\t\tZ.listvm.fixedRows=0;\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged=function(rowno) {\r\n\t\t\trowno = Z.listvm.getCurrentRowno();\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onVisibleCountChanged=function() {\r\n\t\t\tZ._fillData();\r\n\t\t\tvar allCount = Z.listvm.getNeedShowRowCount();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * allCount);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged=function(prevRowno, rowno) {\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onNeedShowRowsCountChanged = function(allCount) {\r\n\t\t\tZ._fillData();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * (allCount + 2));\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCheckStateChanged = function() {\r\n\t\t\tZ._fillData();\r\n\t\t};\r\n\t},\r\n\t\r\n\t_doKeydown: function(keyCode) {\r\n\t\tvar Z = this, result = false;\r\n\t\tif (keyCode === jslet.ui.KeyCode.SPACE) {//space\r\n\t\t\tZ._doCheckBoxClick();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.UP) {//KEY_UP\r\n\t\t\tZ.listvm.priorRow();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.DOWN) {//KEY_DOWN\r\n\t\t\tZ.listvm.nextRow();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.LEFT) {//KEY_LEFT\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.RIGHT) {//KEY_RIGHT\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEUP) {//KEY_PAGEUP\r\n\t\t\tZ.listvm.priorPage();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEDOWN) {//KEY_PAGEDOWN\r\n\t\t\tZ.listvm.nextPage();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getTrByRowno: function(rowno) {\r\n\t\tvar nodes = jQuery(this.el).find('.jl-tree-nodes'), row;\r\n\t\tfor(var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\trow = nodes[i].rows[0];\r\n\t\t\tif (row.jsletrowno == rowno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_doCurrentRowChanged: function(rowno) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.prevRow) {\r\n\t\t\tjQuery(Z._getTextTd(Z.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tvar otr = Z._getTrByRowno(rowno);\r\n\t\tif (otr) {\r\n\t\t\tjQuery(Z._getTextTd(otr)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tZ.prevRow = otr;\r\n\t},\r\n\t\r\n\t_getTextTd: function(otr) {\r\n\t\treturn otr.cells[otr.cells.length - 1];\r\n\t},\r\n\t\r\n\t_doExpand: function() {\r\n\t\tthis.expand();\r\n\t},\r\n\t\r\n\t_doRowClick: function(treeNode) {\r\n\t\tvar Z = this,\r\n\t\t\tnodeType = treeNode.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif(!nodeType) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (nodeType != '0') {\r\n\t\t\tZ._syncToDs(treeNode);\r\n\t\t}\r\n\t\tif (nodeType == '1' || nodeType == '2') { //expander\r\n\t\t\tvar item = Z.listvm.getCurrentRow();\r\n\t\t\tif (nodeType == '1' && item.children && item.children.length > 0) {\r\n\t\t\t\tif (item.expanded) {\r\n\t\t\t\t\tZ.collapse();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.expand();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (nodeType == '2') {//checkbox\r\n\t\t\t\tZ._doCheckBoxClick();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(nodeType == '9') {\r\n\t\t\tZ._doCheckBoxClick();\r\n\t\t\tif(Z._onItemClick) {\r\n\t\t\t\tZ._onItemClick.call(Z);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doRowDblClick: function(treeNode) {\r\n\t\tthis._syncToDs(treeNode);\r\n\t\tvar nodeType = treeNode.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif (this._onItemDblClick && nodeType == '9') {\r\n\t\t\tthis._onItemDblClick.call(this);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doCheckBoxClick: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = Z.listvm.getCurrentRow();\r\n\t\tif(!node.hasCheckbox) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._beforeCheckBoxClick && !Z._beforeCheckBoxClick.call(Z)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.listvm.checkNode(!Z._dataset.selected()? 1:0, Z._correlative, Z._onlyCheckChildren);\r\n\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncToDs: function(otr) {\r\n\t\tvar rowno = -1, k;\r\n\t\twhile(true) {\r\n\t\t\tk = otr.jsletrowno;\r\n\t\t\tif (k === 0 || k) {\r\n\t\t\t\trowno = k;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\totr = otr.parentNode;\r\n\t\t\tif (!otr) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.listvm.setCurrentRowno(rowno);\r\n\t\tthis._dataset.recno(this.listvm.getCurrentRecno());\r\n\t},\r\n\t\r\n\t_fillData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tvCnt = Z.listvm.getVisibleCount(), \r\n\t\t\ttopRowno = Z.listvm.getVisibleStartRow(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\tavailbleCnt = vCnt + topRowno,\r\n\t\t\tindex = 0,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tree-nodes'), node;\r\n\t\tif (Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._isRendering = true;\r\n\t\tZ._skip_ = true;\r\n\t\tvar oldRecno = Z._dataset.recnoSilence(),\r\n\t\t\tpreRowNo = Z.listvm.getCurrentRowno(),\r\n\t\t\tajustScrBar = true, maxNodeWidth = 0, nodeWidth;\r\n\t\ttry{\r\n\t\t\tif (allCnt < availbleCnt) {\r\n\t\t\t\tfor(var i = availbleCnt - allCnt; i > 0; i--) {\r\n\t\t\t\t\tnode = nodes[vCnt - i];\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tajustScrBar = false; \r\n\t\t\t} else {\r\n\t\t\t\tallCnt = availbleCnt;\r\n\t\t\t}\r\n\t\t\tvar endRow = allCnt - 1;\r\n\t\t\t\r\n\t\t\tfor(var k = topRowno; k <= endRow; k++) {\r\n\t\t\t\tnode = nodes[index++];\r\n\t\t\t\tnodeWidth = Z._fillNode(node, k);\r\n\t\t\t\tif (ajustScrBar && maxNodeWidth < Z.treePanelWidth) {\r\n\t\t\t\t\tif (k == endRow && nodeWidth < Z.treePanelWidth) {\r\n\t\t\t\t\t\tajustScrBar = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaxNodeWidth = Math.max(maxNodeWidth, nodeWidth);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (k == endRow && ajustScrBar) {\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnode.style.display = '';\r\n\t\t\t\t\tnode.jsletrowno = k;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.listvm.setCurrentRowno(preRowNo, false);\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tZ._skip_ = false;\r\n\t\t}\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ._checkScrollBar();\r\n\t\t}, 5);\r\n\t},\r\n\r\n\t_setCheckClsName: function(oCheckBox, expanded) {\r\n\t\tvar jqCheckBox = jQuery(oCheckBox);\r\n\t\tif (!expanded) {\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').removeClass('jl-hidden');\r\n\t\t} else if (expanded == 2) { //mixed checked\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').removeClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').addClass('jl-hidden');\r\n\t\t} else {\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').removeClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').addClass('jl-hidden');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillNode: function(nodeTbl, rowNo) {\r\n\t\tvar row = nodeTbl.rows[0],\r\n\t\t\tZ = this,\r\n\t\t\titem = Z.listvm.setCurrentRowno(rowNo, true),\r\n\t\t\tcells = row.cells, \r\n\t\t\tcellCnt = cells.length, \r\n\t\t\trequiredCnt = item.level + 4,\r\n\t\t\totd, i, cnt;\r\n\t\tZ._dataset.recnoSilence(Z.listvm.getCurrentRecno());\r\n\t\trow.jsletrowno = rowNo;\r\n\t\tif (cellCnt < requiredCnt) {\r\n\t\t\tfor(i = 1, cnt = requiredCnt - cellCnt; i <= cnt; i++) {\r\n\t\t\t\totd = row.insertCell(0);\r\n\t\t\t\tjQuery(otd).addClass('jl-tree-unit jl-tree-lines').attr('jsletline', 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cellCnt >= requiredCnt) {\r\n\t\t\tfor(i = 0, cnt = cellCnt - requiredCnt; i < cnt; i++) {\r\n\t\t\t\tcells[i].style.display = 'none';\r\n\t\t\t}\r\n\t\t\tfor(i = cellCnt - requiredCnt; i < requiredCnt; i++) {\r\n\t\t\t\tcells[i].style.display = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tcellCnt = cells.length;\r\n\t\t//Line\r\n\t\tvar pitem = item, k = 1, totalWidth = Z.iconWidth * item.level;\r\n\t\tfor(i = item.level; i > 0; i--) {\r\n\t\t\totd = row.cells[cellCnt- 4 - k++];\r\n\t\t\tpitem = pitem.parent;\r\n\t\t\tif (pitem.islast) {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.empty;\r\n\t\t\t} else {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.line;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//expander\r\n\t\tvar oexpander = row.cells[cellCnt- 4],\r\n\t\t\tjqSign;\r\n\t\toexpander.noWrap = true;\r\n\t\toexpander.style.display = '';\r\n\t\tif (item.children && item.children.length > 0) {\r\n\t\t\tif(!Z._useArrow && Z._hasLine) {\r\n\t\t\t\tif (!item.islast) {\r\n\t\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minus : jslet.ui.htmlclass.TREELINECLASS.plus;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minusBottom : jslet.ui.htmlclass.TREELINECLASS.plusBottom;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjqSign = jQuery(oexpander.childNodes[0]);\r\n\t\t\t\tif(Z._useArrow) {\r\n\t\t\t\t\tif(item.expanded) {\r\n\t\t\t\t\t\tjqSign.addClass('jl-tree-rotate-45');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjqSign.removeClass('jl-tree-rotate-45');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(item.expanded) {\r\n\t\t\t\t\t\tjqSign.removeClass('fa-plus-square-o');\r\n\t\t\t\t\t\tjqSign.addClass('fa-minus-square-o');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjqSign.addClass('fa-plus-square-o');\r\n\t\t\t\t\t\tjqSign.removeClass('fa-minus-square-o');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tjqSign.show();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!Z._useArrow && Z._hasLine) {\r\n\t\t\t\tif (!item.islast) {\r\n\t\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.join;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.joinBottom;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjqSign = jQuery(oexpander.childNodes[0]);\r\n\t\t\t\tjqSign.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t\ttotalWidth += Z.iconWidth;\r\n\t\t\t\t\r\n\t\t// CheckBox\r\n\t\tvar flag = Z._hasCheckBox && Z._dataset.checkSelectable();\r\n\t\tvar node = Z.listvm.getCurrentRow();\r\n\t\tnode.hasCheckbox = flag;\r\n\t\tvar ocheckbox = row.cells[cellCnt- 3];\r\n\t\tif (flag) {\r\n\t\t\tocheckbox.noWrap = true;\r\n\t\t\tZ._setCheckClsName(ocheckbox, Z._dataset.selected());\r\n\t\t\tocheckbox.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\tocheckbox.style.display = 'none';\r\n\t\t}\r\n\t\t//Icon\r\n\t\tvar oIcon = row.cells[cellCnt- 2],\r\n\t\t\tclsName = 'jl-tree-unit jl-tree-icon',\r\n\t\t\ticonClsId = null;\r\n\r\n\t\tvar isLeaf = !(item.children && item.children.length > 0);\r\n\t\tif(Z._iconClassField || Z._onGetIconClass) {\r\n\t\t\tif(Z._iconClassField) {\r\n\t\t\t\ticonClsId = Z._dataset.getFieldValue(Z._iconClassField);\r\n\t\t\t} else if (Z._onGetIconClass) {\r\n\t\t\t\ticonClsId = Z._onGetIconClass.call(Z, Z._dataset.keyValue(), item.level, isLeaf); //keyValue, level, isLeaf\r\n\t\t\t}\r\n\t\t\tif (iconClsId) {\r\n\t\t\t\tclsName = iconClsId + ' '+ clsName;\r\n\t\t\t}\r\n\t\t\tif (oIcon.className != clsName) {\r\n\t\t\t\toIcon.className = clsName;\r\n\t\t\t}\r\n\t\t\toIcon.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\toIcon.style.display = 'none';\r\n\t\t}\r\n\t\t//Text\r\n\t\tvar text = Z.evaluator.eval() || '      ';\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar width = Math.round(jslet.ui.textMeasurer.getWidth(text)) + 10;\r\n\t\ttotalWidth += width + 10;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tvar oText = row.cells[cellCnt- 1];\r\n\t\toText.style.width = width + 'px';\r\n\r\n\t\tvar jqTd = jQuery(oText);\r\n\t\tjqTd.html(text);\r\n\t\tif(Z._dataset.existRecordError()) {\r\n\t\t\tif(!jqTd.hasClass('has-error')) {\r\n\t\t\t\tjqTd.addClass('has-error');\r\n\t\t\t}\r\n\t\t\toText.title = Z._dataset.getRecordErrorInfo();\r\n\t\t} else {\r\n\t\t\tif(jqTd.hasClass('has-error')) {\r\n\t\t\t\tjqTd.removeClass('has-error');\r\n\t\t\t}\r\n\t\t\toText.title = jqTd.text();\r\n\t\t}\r\n\t\t\r\n\t\tif (item.isbold) {\r\n\t\t\tjqTd.addClass('jl-tree-child-checked');\r\n\t\t} else {\r\n\t\t\tjqTd.removeClass('jl-tree-child-checked');\r\n\t\t}\r\n\t\tif(Z._onRenderItem) {\r\n\t\t\tZ._onRenderItem.call(Z, oIcon, oText, item.level, isLeaf); //keyValue, level, isLeaf\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\t\r\n\t_syncScrollBar: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skip_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjQuery(Z.el).find('.jl-tree-scrollbar').scrollTop(Z.nodeHeight * Z.listvm.getVisibleStartRow());\r\n\t},\r\n\t\r\n\t_checkScrollBar: function() {\r\n\t\tvar jqScr = jQuery(this.el).find('.jl-tree-scrollbar');\r\n\t\tvar scr = jqScr[0];\r\n\t\tif(scr.scrollHeight > scr.clientHeight) {\r\n\t\t\tjqScr.removeClass('jl-tree-scrollbar-hidden');\r\n\t\t} else {\r\n\t\t\tif(!jqScr.hasClass('jl-tree-scrollbar-hidden')) {\r\n\t\t\t\tjqScr.addClass('jl-tree-scrollbar-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand the current tree node.\r\n\t */\r\n\texpand: function() {\r\n\t\tthis.listvm.expand();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse the current tree node.\r\n\t */\r\n\tcollapse: function() {\r\n\t\tthis.listvm.collapse();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand all child nodes of the current tree node.\r\n\t */\r\n\texpandAll: function() {\r\n\t\tthis.listvm.expandAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse all child nodes of the current tree node.\r\n\t */\r\n\tcollapseAll: function() {\r\n\t\tthis.listvm.collapseAll();\r\n\t},\r\n\t\r\n\t_createContextMenu: function() {\r\n\t\tif (!jslet.ui.Menu) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: []};\r\n\t\tif (Z._hasCheckBox) {\r\n\t\t\tmenuCfg.items.push({ id: 'checkAll', name: jsletlocale.DBTreeView.checkAll });\r\n\t\t\tmenuCfg.items.push({ id: 'uncheckAll', name: jsletlocale.DBTreeView.uncheckAll });\r\n\t\t\tmenuCfg.items.push({ name: '-' });\r\n\t\t}\r\n\t\tmenuCfg.items.push({ id: 'expandAll', name: jsletlocale.DBTreeView.expandAll });\r\n\t\tmenuCfg.items.push({ id: 'collapseAll', name: jsletlocale.DBTreeView.collapseAll});\r\n\t\tif(Z._enableErrorFinding) {\r\n\t\t\tmenuCfg.items.push({ name: '-' });\r\n\t\t\tmenuCfg.items.push({ id: 'nextError', name: jsletlocale.DBTreeView.nextError});\r\n\t\t}\r\n\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t\tjQuery(Z.el).on('contextmenu', function(event) {\r\n\t\t\tvar node = event.target,\r\n\t\t\t\tnodeType = node.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tif(!nodeType || nodeType == '0') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._syncToDs(node);\r\n\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_menuItemClick: function(menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tvar Z = this;\r\n\t\tif (menuId == 'expandAll') {\r\n\t\t\tZ.expandAll();\r\n\t\t} else if (menuId == 'collapseAll') {\r\n\t\t\tZ.collapseAll();\r\n\t\t} else if (menuId == 'checkAll') {\r\n\t\t\tZ.listvm.checkChildNodes(true, true);\r\n\t\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t\t}\r\n\t\t} else if (menuId == 'uncheckAll') {\r\n\t\t\tZ.listvm.checkChildNodes(false, true);\r\n\t\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t\t}\r\n\t\t} else if (menuId == 'nextError') {\r\n\t\t\tZ.gotoNextError();\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\t//empty\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.listvm.refreshModel(Z._expandLevel);\r\n\t\t\tif(evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\t\tZ.listvm.syncDataset();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) {\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL) {\r\n\t\t\tif (Z._hasCheckBox) {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (Z._hasCheckBox) {\r\n\t\t\t\tZ.listvm.checkNode(Z._dataset.selected(), Z._correlative, Z._onlyCheckChildren);\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tZ.listvm.syncDataset();\r\n\t\t}\r\n\t}, // end refreshControl\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function() {\r\n\t\tthis.resize();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.find('.jl-tree-nodes').off();\r\n\t\tZ.listvm.destroy();\r\n\t\tZ.listvm = null;\r\n\t\tZ.prevRow = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.TREELINECLASS = {\r\n\t\tline : 'jl-tree-unit jl-tree-lines jl-tree-line',// '|'\r\n\t\tjoin : 'jl-tree-unit jl-tree-lines jl-tree-join',// |-\r\n\t\tjoinBottom : 'jl-tree-unit jl-tree-lines jl-tree-join-bottom',// |_\r\n\t\tminus : 'jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-minus',// O-\r\n\t\tminusBottom : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-minus-bottom',// o-_\r\n\t\tnoLineMinus : 'jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-noline-minus',// o-\r\n\t\tplus : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus',// o+\r\n\t\tplusBottom : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus-bottom',// o+_\r\n\t\tnoLinePlus : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-noline-plus',// o+\r\n\t\tempty : 'jl-tree-unit'\r\n};\r\njslet.ui.htmlclass.TREECHECKBOXCLASS = {\r\n\tchecked : 'jl-tree-unit jl-tree-checkbox jl-tree-checked',\r\n\tunChecked : 'jl-tree-unit jl-tree-checkbox jl-tree-unchecked',\r\n\tmixedChecked : 'jl-tree-unit jl-tree-checkbox jl-tree-mixedchecked'\r\n};\r\n\r\njslet.ui.htmlclass.TREENODECLASS = {\r\n\tselected : 'jl-tree-selected',\r\n\tchildChecked : 'jl-tree-child-checked',\r\n\ttreeNodeLevel : 'jl-tree-child-level'\r\n};\r\n\r\njslet.ui.DBTreeView.NODETYPE = 'data-nodetype';\r\n\r\njslet.ui.register('DBTreeView', jslet.ui.DBTreeView);\r\njslet.ui.DBTreeView.htmlTemplate = '<div></div>';\r\n\r\n\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\njslet.ui.table.TableCellEditor = function(tableCtrl) { \r\n\tvar _tableCtrl = tableCtrl; \r\n\tvar _editPanel;\r\n\tvar _currField;\r\n\t\r\n\tfunction _create() { \r\n\t\tvar html = '<div class=\"form-group form-group-sm jl-tbl-editpanel\"><table class=\"jl-tbl-edittable\"><tbody><tr class=\"jl-tbl-editrow\">';\r\n\t\tvar columns = _tableCtrl._sysColumns, colCfg,\r\n\t\t\ttblDataset = tableCtrl.dataset(),\r\n\t\t\tdsName = tblDataset.name(),\r\n\t\t\tleft = 1, i, len;\r\n\t\t\t\r\n\t\tfor(i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolCfg = columns[i];\r\n\t\t\tleft += colCfg.width + 1;\r\n\t\t}\r\n\t\tcolumns = _tableCtrl.innerColumns;\r\n\t\tvar tableId = tableCtrl.el.id,\r\n\t\t\teditorTabIndex = tableCtrl.editorTabIndex(),\r\n\t\t\tisBool, fldObj, fldName, dataType,\r\n\t\t\talignStr = ';text-align: center',\r\n\t\t\teditableFields = tableCtrl.editableFields(),\r\n\t\t\treadOnlyFields = tableCtrl.readOnlyFields(),\r\n\t\t\tisManual;\r\n\t\tisManual = editableFields && editableFields.length > 0 || readOnlyFields && readOnlyFields.length > 0;\r\n\t\tfor(i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolCfg = columns[i];\r\n\t\t\tfldName = colCfg.field;\r\n\t\t\tif(!fldName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(readOnlyFields && readOnlyFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(editableFields && editableFields.indexOf(fldName) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = tblDataset.getField(fldName);\r\n\t\t\tdataType = fldObj.getType();\r\n\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\thtml += '<td class=\"jl-edtfld-' + fldName +  '\" style=\"display:none;vertical-align: middle' + \r\n\t\t\t\t(isBool? alignStr: '') + '\">';\r\n\t\t\tif(isManual || !fldObj.fieldReadOnly() && !fldObj.fieldDisabled()) {\r\n\t\t\t\tvar additionStr = '';\r\n\t\t\t\tif(colCfg.prefix) {\r\n\t\t\t\t\tadditionStr = ', prefix: ' + jslet.JSON.stringify(colCfg.prefix);\r\n\t\t\t\t}\r\n\t\t\t\tif(colCfg.suffix) {\r\n\t\t\t\t\tadditionStr += ', suffix: ' + jslet.JSON.stringify(colCfg.suffix);\r\n\t\t\t\t}\r\n\t\t\t\tisBool = (fldObj.dataType() === jslet.data.DataType.BOOLEAN);\r\n\t\t\t\thtml += '<div data-jslet=\\'type:\"DBPlace\",dataset:\"' + dsName + \r\n\t\t\t\t\t'\",field:\"' + fldName + \r\n\t\t\t\t\t'\", tableId: \"' + tableId + \r\n\t\t\t\t\t'\", expandChildWidth: ' + (isBool? 'false': 'true') + \r\n\t\t\t\t\t(editorTabIndex? ', tabIndex: ' + editorTabIndex: '') + \r\n\t\t\t\t\tadditionStr + \r\n\t\t\t\t\t'\\' class=\"' + colCfg.widthCssName + \r\n\t\t\t\t\t(isBool? ' jl-tbl-check-col': '') + \r\n\t\t\t\t\t'\"></div>';\r\n\t\t\t}\r\n\t\t\thtml += '</td>';\r\n\t\t}\r\n\t\thtml += '</tr></tbody></table></div>';\r\n\t\tvar jqPanel = jQuery(html);\r\n\t\tjqPanel.appendTo(jQuery(_tableCtrl.el));\r\n\t\tjqPanel.css('left', left + 'px');\r\n\t\tjslet.ui.install(jqPanel[0]);\r\n\t\t_editPanel = jqPanel;\r\n\t\tjqPanel.height(_tableCtrl.rowHeight());\r\n\t\tjqPanel.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\t//prevent to fire dbtable's ctrl+c\r\n\t\t\tif(event.ctrlKey && keyCode === jslet.ui.KeyCode.C) { //ctrl + c\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_create();\r\n\t\r\n\tthis.showEditor = function(fldName, otd) {\r\n\t\tvar dataset = _tableCtrl.dataset();\r\n\t\tif(dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!fldName) {\r\n\t\t\tdataset.focusEditControl(_currField);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = dataset.getField(fldName);\r\n\t\tif(!fldObj || fldObj.disabled() || fldObj.readOnly()) {\r\n\t\t\tthis.hideEditor();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqTd = jQuery(otd),\r\n\t\t\tfirstId = jqTd.attr('jsletFirstId'),\r\n\t\t\tcellPos;\r\n\t\tif(firstId) {\r\n\t\t\tvar firstOffset = jQuery('#' + firstId).offset();\r\n\t\t\tvar offsetHeight = parseFloat(jqTd.attr('jsletOffsetHeight'));\r\n\t\t\tcellPos = {left: firstOffset.left, top: firstOffset.top + offsetHeight};\r\n\t\t} else {\r\n\t\t\tcellPos = jqTd.offset();\r\n\t\t}\r\n\t\t_editPanel.show();\r\n\t\tif(_currField) {\r\n\t\t\t_editPanel.find('.jl-edtfld-' + _currField).hide();\r\n\t\t}\r\n\t\tvar jqEditor = _editPanel.find('.jl-edtfld-' + fldName);\r\n\t\t_editPanel.offset(cellPos);\r\n\t\tjqEditor.show();\r\n\t\tdataset.focusEditControl(fldName);\r\n\t\t_currField = fldName;\r\n\t};\r\n\t\r\n\tthis.currentField = function() {\r\n\t\treturn _currField;\r\n\t};\r\n\t\r\n\tthis.hideEditor = function() {\r\n\t\t_editPanel.hide();\r\n\t\t_tableCtrl.el.focus();\r\n\t};\r\n\t\r\n\tthis.destroy = function() { \r\n\t\t_tableCtrl = null; \r\n\t};\r\n};\r\n\r\n\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * \r\n * Cell render.\r\n */\r\njslet.ui.table.CellRender = jslet.Class.create({\r\n\t/**\r\n\t * Create column header.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t */\r\n\tcreateHeader: function(cellPanel, colSetting) {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Create cell.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh cell content.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t * @param {Integer} recNo Record number.\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Default cell render.\r\n */\r\njslet.ui.table.DefaultCellRender =  jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field,\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tcellPanel.parentNode.style.textAlign = fldObj.alignment();\r\n\t},\r\n\t\t\t\t\t\t\t\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t\t\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl(),\r\n\t\t\t\ttarget = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\tif(text === '' || text === null || text === undefined) {\r\n\t\t\ttext = '&nbsp;';\r\n\t\t}\r\n\t\tvar jqCellPanel = jQuery(cellPanel); \r\n\t\tjqCellPanel.html(text);\r\n\t\tcellPanel.title = jqCellPanel.text();\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t} \r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Sequence column cell render.\r\n */\r\njslet.ui.table.SequenceCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.innerHTML = this._seqColHeader || '&nbsp;';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tjQuery(cellPanel.parentNode).addClass('jl-tbl-sequence');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqDiv = jQuery(cellPanel), \r\n\t\t\ttext,\r\n\t\t\trecno = this.listvm.getCurrentRecno();\r\n\t\tif(this._reverseSeqCol) {\r\n\t\t\ttext = this._dataset.recordCount() - recno;\r\n\t\t} else {\r\n\t\t\ttext = recno + 1;\r\n\t\t}\r\n\t\tvar title;\r\n\t\tif(this._dataset.existRecordError(recno)) {\r\n\t\t\tjqDiv.parent().addClass('has-error');\r\n\t\t\ttitle = this._dataset.getRecordErrorInfo(recno);\r\n\t\t} else {\r\n\t\t\tjqDiv.parent().removeClass('has-error');\r\n\t\t\ttitle = text;\r\n\t\t}\r\n\t\t\r\n\t\tcellPanel.title = title;\r\n\t\tjqDiv.html(text);\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Select column cell render.\r\n */\r\njslet.ui.table.SelectCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\tvar ocheckbox = document.createElement('input');\r\n\t\tocheckbox.type = 'checkbox';\r\n\t\tvar Z = this;\r\n\t\tjQuery(ocheckbox).addClass('jl-tbl-select-check jl-tbl-select-all').on('click', function(event) {\r\n\t\t\tif(Z._beforeSelectAll) {\r\n\t\t\t\tZ._beforeSelectAll.call(Z);\r\n\t\t\t}\r\n\t\t\tZ._dataset.selectAll(this.checked ? 1 : 0, Z._onSelectAll);\r\n\t\t\tif(Z._afterSelectAll) {\r\n\t\t\t\tZ._afterSelectAll.call(Z);\r\n\t\t\t}\r\n\t\t});\r\n\t\tcellPanel.appendChild(ocheckbox);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n    createCell: function(cellPanel, colCfg) {\r\n\t    cellPanel.style.textAlign = 'center';\r\n\t\tvar Z = this, \r\n\t\tocheck = document.createElement('input'),\r\n\t\tjqCheck = jQuery(ocheck);\r\n\t\tjqCheck.attr('type', 'checkbox').addClass('jl-tbl-select-check');\r\n\t\tjqCheck.click(Z._doSelectBoxClick);\r\n\t\tcellPanel.appendChild(ocheck);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tocheck = cellPanel.firstChild;\r\n\t\tif(Z._dataset.checkSelectable(recNo)) {\r\n\t\t\tocheck.checked = Z._dataset.selectedByRecno(recNo);\r\n\t\t\tocheck.style.display = '';\r\n\t\t} else {\r\n\t\t\tocheck.style.display = 'none';\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Edit action column cell render.\r\n */\r\njslet.ui.table.EditActionCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\t\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(cellPanel);\r\n\t\tjqCell.html('<a class=\"jl-tbl-insert\" href=\"javascript: void(0)\" title=\"' + jsletlocale.DBTable.appendTip +\r\n\t\t\t\t'\"><i class=\"fa fa-plus\"></i></a>');\r\n\t\tjqCell.on('click', function(event) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._doAppendRecord();\r\n\t\t\t}, 80);\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n    createCell: function(cellPanel, colCfg) {\r\n\t    cellPanel.style.textAlign = 'center';\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(cellPanel);\r\n\t\tjqCell.html('<a class=\"jl-tbl-delete\" href=\"javascript: void(0)\" title=\"' + jsletlocale.DBTable.deleteTip +\r\n\t\t\t\t'\"><i class=\"fa fa-minus\"></i></a>');\r\n\t\tjqCell.on('click', function(event) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._doDeleteRecord();\r\n\t\t\t}, 80);\r\n\t\t});\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.table.SubgroupCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\t//TODO\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Boolean column cell render.\r\n */\r\njslet.ui.table.BoolCellRender = jslet.Class.create(jslet.ui.table.DefaultCellRender, {\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tvar jqCell = jQuery(cellPanel);\r\n\t\tjqCell.css('textAlign', 'center');\r\n\t\tjqCell.html('<i class=\"fa fa-square-o\" aria-hidden=\"true\"></i>');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqCell = jQuery(cellPanel);\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field, \r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tif (Z._dataset.getFieldValueByRecno(recNo, fldName)) {\r\n\t\t\tjqCell.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square-o');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjqCell.find('.fa-check-square-o').removeClass('fa-check-square-o').addClass('fa-square-o');\r\n\t\t}\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Tree column cell render.\r\n */\r\njslet.ui.table.TreeCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg, recNo) {\r\n\t\tvar Z = this;\r\n\r\n\t\tvar odiv = document.createElement('div'),\r\n\t\t\tjqDiv = jQuery(odiv);\r\n\t\todiv.style.height = Z.rowHeight() - 2 + 'px';\r\n\t\tjqDiv.html('<span class=\"jl-tbltree-indent\"></span><a class=\"jl-tbltree-btn\" href=\"javascript:void()\"><i class=\"fa fa-minus-square-o\" aria-hidden=\"true\"></i></a>' + \r\n\t\t\t\t'<span class=\"jl-tbltree-iconhost\"></span><span class=\"jl-tbltree-text\"></span>');\r\n\t\t\r\n\t\tcellPanel.appendChild(odiv);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar odiv = cellPanel.firstChild,\r\n\t\t\tjqDiv = jQuery(odiv),\r\n\t\t\tarrSpan = odiv.childNodes,\r\n\t\t\tZ = this,\r\n\t\t\tlevel = Z.listvm.getLevel(recNo);\r\n\t\t\r\n\t\tif (!jslet.ui.table.TreeCellRender.iconWidth) {\r\n\t\t\tjslet.ui.table.TreeCellRender.iconWidth = parseInt(jslet.ui.getCssValue('jl-tbltree-indent', 'width'));\r\n\t\t}\r\n\t\tvar hasChildren = Z.listvm.hasChildren(recNo),\r\n\t\t\tindentWidth = (!hasChildren ? level + 1 : level) * jslet.ui.table.TreeCellRender.iconWidth;\r\n\t\t//Indent\r\n\t\tjqDiv.find('.jl-tbltree-indent').css('width', indentWidth + 'px');\r\n\t\t\r\n\t\t//Expand button\r\n\t\tvar jqExpBtn = jqDiv.find('.jl-tbltree-btn'); //expand button\r\n\t\tjqExpBtn.css('display', hasChildren ? 'inline-block' : 'none');\r\n\t\tif (hasChildren) {\r\n\t\t\tvar expanded = Z._dataset.expandedByRecno(recNo);\r\n\t\t\tif(expanded) {\r\n\t\t\t\tjqExpBtn.find('.fa-plus-square-o').removeClass('fa-plus-square-o').addClass('fa-minus-square-o');\r\n\t\t\t} else {\r\n\t\t\t\tjqExpBtn.find('.fa-minus-square-o').removeClass('fa-minus-square-o').addClass('fa-plus-square-o');\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Icon\r\n\t\tif (colCfg.getIconClass) {\r\n\t\t\tvar iconCls = colCfg.getIconClass(level, hasChildren);\r\n\t\t\tif (iconCls) {\r\n\t\t\t\tvar jqIcon = jqDiv.find('.jl-tbltree-iconhost');\r\n\t\t\t\tjqIcon.addClass('jl-tbltree-icon ' + iconCls);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Text\r\n\t\tvar fldName = colCfg.field, fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t}\r\n\t\tcellPanel.title = text;\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl();\r\n\t\t\tvar target = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\tjqDiv.find('.jl-tbltree-text').html(text);\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\r\n\r\njslet.ui.table.cellRenders = {\r\n\tdefaultCellRender: new jslet.ui.table.DefaultCellRender(),\r\n\ttreeCellRender: new jslet.ui.table.TreeCellRender(),\r\n\tboolCellRender: new jslet.ui.table.BoolCellRender(),\r\n\tsequenceCellRender: new jslet.ui.table.SequenceCellRender(),\r\n\tselectCellRender: new jslet.ui.table.SelectCellRender(),\r\n\teditActionCellRender: new jslet.ui.table.EditActionCellRender(),\r\n\tsubgroupCellRender: new jslet.ui.table.SubgroupCellRender()\r\n};\r\n\r\n\njslet.ui.htmlclass.TABLECLASS = {\r\n\tcurrentrow: 'jl-tbl-current',\r\n\tscrollBarWidth: 16,\r\n\tselectColWidth: 30,\r\n\thoverrow: 'jl-tbl-row-hover',\r\n};\r\n\r\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * \r\n * Table column.\r\n */\r\njslet.ui.table.TableColumn = function() {\r\n\tvar Z = this;\r\n\t\r\n\t/**\r\n\t * @property {String} field Field name.\r\n\t */\r\n\tZ.field = null;\r\n\t\r\n\t/**\r\n\t * @property {String} label Column header label.\r\n\t */\r\n\tZ.label = null;\r\n\t\r\n\t/**\r\n\t * @property {String} title Column header title.\r\n\t */\r\n\tZ.title = null;\r\n\t\r\n\t/**\r\n\t * @property {jslet.ui.FieldControlAddon[]} prefix The prefix part of the field when editing.\r\n\t */\r\n\tZ.prefix = null;\r\n\t\r\n\t/**\r\n\t * @property {jslet.ui.FieldControlAddon[]} suffix The suffix part of the field when editing.\r\n\t */\r\n\tZ.suffix = null;\r\n\t \r\n\t/**\r\n\t * @property {Integer} width Column display width.\r\n\t */\r\n\tZ.width = null;   //Integer, column display width\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableHeadSort True - user sort this column by click column header, false - otherwise.\r\n\t */\r\n\tZ.disableHeadSort = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableFilter True - disable to show filter panel, false - otherwise.\r\n\t */\r\n\tZ.disableFilter = false;\r\n\r\n\t/**\r\n\t * @property {Boolean} mergeSame True - if this column value of adjoined rows is same then merge these rows, false - otherwise.\r\n\t */\r\n\tZ.mergeSame = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} noRefresh True - do not refresh for customized column, false - otherwise.\r\n\t */\r\n\tZ.noRefresh = false; //Boolean, true - do not refresh for customized column\r\n\t\r\n\t/**\r\n\t * @property {Boolean} visible True - column is visible, false - otherwise.\r\n\t */\r\n\tZ.visible = true;\r\n\r\n\t/**\r\n\t * @property {jslet.ui.table.CellRender} cellRender Column cell render for customized column.\r\n\t */\r\n\tZ.cellRender = null;  \r\n\r\n\tZ.colNum = null;  //Integer, column number\r\n\tZ.displayOrder = null; //Integer, display order\r\n\tZ.colSpan = null; //Integer, column span\r\n};\r\n\r\n/*\r\n * Sub group, use this class to implement complex requirement in one table row, like master-detail style row\r\n */\r\njslet.ui.table.TableSubgroup = function() {\r\nvar Z = this;\r\n\tZ.hasExpander = true; //Boolean, true - will add a new column automatically, click this column will expand or collapse subgroup panel\r\n\tZ.template = null;//String, html template \r\n\tZ.height = 0; //Integer, subgroup panel height\r\n};\r\n\r\n/**\r\n * @class\r\n * \r\n * Table column header, use this class to implement hierarchical header\r\n */\r\njslet.ui.table.TableHead = function() {\r\n\tvar Z = this;\r\n\t\r\n\t/**\r\n\t * @property {String} label Head label.\r\n\t */\r\n\tZ.label = null;\r\n\t\r\n\t/**\r\n\t * @property {String} title Head title.\r\n\t */\r\n\tZ.title = null;\r\n\t\r\n\t/**\r\n\t * @property {String} id Head id.\r\n\t */\r\n\tZ.id = null;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableHeadSort True - user sort this column by click column header, false - otherwise.\r\n\t */\r\n\tZ.disableHeadSort = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableFilter True - disable to show filter panel, false - otherwise.\r\n\t */\r\n\tZ.disableFilter = false;\r\n\r\n\t/**\r\n\t * @property {jslet.ui.table.TableHead[]} subHeads Sub heads.\r\n\t */\r\n\tZ.subHeads = null;\r\n\r\n\tZ.rowSpan = 0;\r\n\tZ.colSpan = 0;\r\n\t\r\n};\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n */\r\njslet.ui.AbstractDBTable = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tZ.allProperties = 'styleClass,dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,editable,hideHead,' + \r\n\t\t\t'disableHeadSort,onlySpecifiedCol,disableMouseWheel,selectBy,rowHeight,footerRowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,' + \r\n\t\t\t'beforeSelect,beforeSelectAll,afterSelect,afterSelectAll,onFillRow,onFillCell,treeField,columns,subgroup,aggregated,' + \r\n\t\t\t'autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog,autoStretch,minVisibleRows,maxVisibleRows' +\r\n\t\t\t'onAppendRecord,onDeleteRecord,editableFields,readOnlyFields,enableErrorFinding';\r\n\t\t\r\n\t\tZ._fixedRows = 0;\r\n\r\n\t\tZ._fixedCols = 0;\r\n\r\n\t\tZ._hasSeqCol = true;\r\n\t\t\r\n\t\tZ._reverseSeqCol = false;\r\n\t\r\n\t\tZ._seqColHeader = null;\r\n\r\n\t\tZ._hasSelectCol = false;\r\n\t\t\r\n\t\tZ._noborder = false;\r\n\t\t\r\n\t\tZ._editable = false;\r\n\r\n\t\tZ._hideHead = false;\r\n\t\t\r\n\t\tZ._onlySpecifiedCol = false;\r\n\t\t\r\n\t\tZ._disableHeadSort = false;\r\n\t\t\r\n\t\tZ._disableMouseWheel = false;\r\n\t\t\r\n\t\tZ._aggregated = true;\r\n\t\t\r\n\t\tZ._autoClearSelection = true;\r\n\t\t\r\n\t\tZ._selectBy = null;\r\n\r\n\t\tZ._rowHeight = null;\r\n\r\n\t\tZ._headRowHeight = null;\r\n\r\n\t\tZ._footerRowHeight = null;\r\n\t\t\r\n\t\tZ._treeField = null;\r\n\r\n\t\tZ._columns = null;\r\n\t\t\r\n\t\tZ._editableFields = null;\r\n\t\t\r\n\t\tZ._readOnlyFields = null;\r\n\t\t\r\n\t\tZ._onRowClick = null;\r\n\r\n\t\tZ._onRowDblClick = null;\r\n\t\t\r\n\t\tZ._onCellClick = null;\r\n\t\t\r\n\t\tZ._onSelect = null;\r\n\r\n\t\tZ._onSelectAll = null;\r\n\t\t\r\n\t\tZ._beforeSelect = null;\r\n\t\t\r\n\t\tZ._afterSelect = null;\r\n\t\t\r\n\t\tZ._beforeSelectAll = null;\r\n\t\t\r\n\t\tZ._afterSelectAll = null;\r\n\t\t\r\n\t\tZ._onFillRow = null;\r\n\t\t\r\n\t\tZ._onFillCell = null;\t\t\r\n\r\n\t\tZ._onAppendRecord = null;\r\n\r\n\t\tZ._onDeleteRecord = null;\r\n\t\t\r\n\t\tZ._defaultCellRender = null;\r\n\r\n\t\tZ._hasFindDialog = true;\r\n\t\t\r\n\t\tZ._hasFilterDialog = true;\r\n\t\t\r\n\t\tZ._enableErrorFinding = false;\r\n\t\t\r\n\t\tZ._repairHeight = 0;\r\n\t\tZ.contentHeight = 0;\r\n\t\tZ.subgroup = null;//jslet.ui.table.TableSubgroup\r\n\t\t\r\n\t\tZ._sysColumns = null;//all system column like sequence column, select column, sub-group column\r\n\t\tZ._isHoriOverflow = false;\r\n\t\tZ._oldHeight = null;\r\n\t\t\r\n\t\tZ._currRow = null;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._editingField = null;\r\n\t\tZ._editorTabIndex = 1;\r\n\t\tZ._rowHeightChanged = false;\r\n\t\tZ._autoStretch = false;\r\n\t\tZ._minVisibleRows = 1;\r\n\t\tZ._maxVisibleRows = 0;\r\n\t\tZ._oldVisibleRows = -1;\r\n\t\t\r\n\t\tZ._cellEditor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get fixed rows.\r\n\t * \r\n\t * @param {Integer | undefined} rows Fixed rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfixedRows: function(rows) {\r\n\t\tif(rows === undefined) {\r\n\t\t\treturn this._fixedRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.fixedRows', rows).isNumber();\r\n\t\tthis._fixedRows = parseInt(rows);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get Fixed columns.\r\n\t * \r\n\t * @param {Integer | undefined} cols Fixed columns.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfixedCols: function(cols) {\r\n\t\tif(cols === undefined) {\r\n\t\t\treturn this._fixedCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.fixedCols', cols).isNumber();\r\n\t\tthis._fixedCols = parseInt(cols);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table row.\r\n\t * \r\n\t * @param {Integer | undefined} rowHeight Table row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\trowHeight: function(rowHeight) {\r\n\t\tvar Z = this;\r\n\t\tif(rowHeight === undefined) {\r\n\t\t\tif(Z._rowHeight === null) {\r\n\t\t\t\tvar clsName = Z._editable? 'jl-tbl-editing-row': 'jl-tbl-row';\r\n\t\t\t\tZ._rowHeight = parseInt(jslet.ui.getCssValue(clsName, 'height')) || 25;\r\n\t\t\t}\r\n\t\t\treturn Z._rowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.rowHeight', rowHeight).isGTZero();\r\n\t\tZ._rowHeight = parseInt(rowHeight);\r\n\t\tZ._rowHeightChanged = true;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table header.\r\n\t * \r\n\t * @param {Integer | undefined} headRowHeight Table header row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theadRowHeight: function(headRowHeight) {\r\n\t\tif(headRowHeight === undefined) {\r\n\t\t\tif(this._headRowHeight === null) {\r\n\t\t\t\tthis._headRowHeight = parseInt(jslet.ui.getCssValue('jl-tbl-header-row', 'height')) || 25;\r\n\t\t\t}\r\n\t\t\treturn this._headRowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.headRowHeight', headRowHeight).isGTZero();\r\n\t\tthis._headRowHeight = parseInt(headRowHeight);\r\n\t\treturn this;\r\n\t},\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table footer.\r\n\t * \r\n\t * @param {Integer | undefined} footerRowHeight Table footer row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfooterRowHeight: function(footerRowHeight) {\r\n\t\tif(footerRowHeight === undefined) {\r\n\t\t\tif(this._footerRowHeight === null) {\r\n\t\t\t\tthis._footerRowHeight = parseInt(jslet.ui.getCssValue('jl-tbl-footer-row', 'height')) || 20;\r\n\t\t\t}\r\n\t\t\treturn this._footerRowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.footerRowHeight', footerRowHeight).isGTZero();\r\n\t\tthis._footerRowHeight = parseInt(footerRowHeight);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is sequence column in DBTable.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSeqCol True(default) - exists sequence column, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSeqCol: function(hasSeqCol) {\r\n\t\tif(hasSeqCol === undefined) {\r\n\t\t\treturn this._hasSeqCol;\r\n\t\t}\r\n\t\tthis._hasSeqCol = hasSeqCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the sequence number is reverse.\r\n\t * \r\n\t * @param {Boolean | undefined} reverseSeqCol True - the sequence number is reverse, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treverseSeqCol: function(reverseSeqCol) {\r\n\t\tif(reverseSeqCol === undefined) {\r\n\t\t\treturn this._reverseSeqCol;\r\n\t\t}\r\n\t\tthis._reverseSeqCol = reverseSeqCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get sequence column header.\r\n\t * \r\n\t * @param {String | undefined} seqColHeader Sequence column header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tseqColHeader: function(seqColHeader) {\r\n\t\tif(seqColHeader === undefined) {\r\n\t\t\treturn this._seqColHeader;\r\n\t\t}\r\n\t\tthis._seqColHeader = seqColHeader;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is \"select\" column in DBTable.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSelectCol True(default) - has \"select\" column, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSelectCol: function(hasSelectCol) {\r\n\t\tif(hasSelectCol === undefined) {\r\n\t\t\treturn this._hasSelectCol;\r\n\t\t}\r\n\t\tthis._hasSelectCol = hasSelectCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has border or not.\r\n\t * \r\n\t * @param {Boolean | undefined} noborder True - the table without border, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tnoborder: function(noborder) {\r\n\t\tif(noborder === undefined) {\r\n\t\t\treturn this._noborder;\r\n\t\t}\r\n\t\tthis._noborder = noborder ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @deprecated\r\n\t * Use editable instead.\r\n\t * \r\n\t * Identify the table is read only or not.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly True(default) - the table is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn !Z._editable;\r\n\t\t}\r\n\t\tZ.editable(!readOnly);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table is editable or not.\r\n\t * \r\n\t * @param {Boolean | undefined} editable True(default) - the table is editable, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\teditable: function(editable) {\r\n\t\tvar Z = this;\r\n\t\tif(editable === undefined) {\r\n\t\t\treturn Z._editable;\r\n\t\t}\r\n\t\tZ._editable = editable ? true: false;\r\n\t\tif(Z._editable && !Z._rowHeightChanged) {\r\n\t\t\tZ._rowHeight = null;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table header is hidden or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hideHead True - the table header is hidden, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thideHead: function(hideHead) {\r\n\t\tif(hideHead === undefined) {\r\n\t\t\treturn this._hideHead;\r\n\t\t}\r\n\t\tthis._hideHead = hideHead ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has aggregated row or not.\r\n\t * \r\n\t * @param {Boolean | undefined} aggregated True - the table has aggregated row, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\taggregated: function(aggregated) {\r\n\t\tif(aggregated === undefined) {\r\n\t\t\treturn this._aggregated;\r\n\t\t}\r\n\t\tthis._aggregated = aggregated ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether automatically clear selection when selecting table cells.\r\n\t * \r\n\t * @param {Boolean | undefined} autoClearSelection True(default) - automatically clear selection, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoClearSelection: function(autoClearSelection) {\r\n\t\tif(autoClearSelection === undefined) {\r\n\t\t\treturn this._autoClearSelection;\r\n\t\t}\r\n\t\tthis._autoClearSelection = autoClearSelection ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify disable table head sorting or not.\r\n\t * \r\n\t * @param {Boolean | undefined} disableHeadSort True - disable table header sorting, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tdisableHeadSort: function(disableHeadSort) {\r\n\t\tif(disableHeadSort === undefined) {\r\n\t\t\treturn this._disableHeadSort;\r\n\t\t}\r\n\t\tthis._disableHeadSort = disableHeadSort ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Disable to use mouse wheel to scroll rows or not.\r\n\t * \r\n\t * @param {Boolean | undefined} disableMouseWheel True - disable to use mouse wheel to scroll rows, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tdisableMouseWheel: function(disableMouseWheel) {\r\n\t\tif(disableMouseWheel === undefined) {\r\n\t\t\treturn this._disableMouseWheel;\r\n\t\t}\r\n\t\tthis._disableMouseWheel = disableMouseWheel ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether showing the specified columns or not.\r\n\t * \r\n\t * @param {Boolean | undefined} onlySpecifiedCol True - only showing the specified columns, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlySpecifiedCol: function(onlySpecifiedCol) {\r\n\t\tif(onlySpecifiedCol === undefined) {\r\n\t\t\treturn this._onlySpecifiedCol;\r\n\t\t}\r\n\t\tthis._onlySpecifiedCol = onlySpecifiedCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specified field names for selecting group records, multiple field names are separated with ','.<br />\r\n\t * See jslet.data.Dataset.select(selected, selectBy). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.selectBy('code,gender');\r\n\t * \r\n\t * @param {String | undefined} selectBy group selecting field names.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tselectBy: function(selectBy) {\r\n\t\tif(selectBy === undefined) {\r\n\t\t\treturn this._selectBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.selectBy', selectBy).isString();\r\n\t\tthis._selectBy = selectBy;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display table as tree style. If this property is set, the dataset must be a tree style dataset, \r\n\t *  means dataset.parentField() and dataset.levelField() can not be empty.<br />\r\n\t * Only one field name allowed. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.treeField('code');\r\n\t * \r\n\t * @param {String | undefined} treeField the field name which will show as tree style.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ttreeField: function(treeField) {\r\n\t\tif(treeField === undefined) {\r\n\t\t\treturn this._treeField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.treeField', treeField).isString();\r\n\t\tthis._treeField = treeField;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Default cell render, it must be a child class of jslet.ui.table.CellRender. Example:\r\n\t * \r\n\t *     @example\r\n\t * \t   var cellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t *\t     createHeader: function(cellPanel, colCfg) { },\r\n\t *\t     createCell: function(cellPanel, colCfg) { },\r\n\t *\t     refreshCell: function(cellPanel, colCfg, recNo) { }\r\n\t *     });\r\n\t * \r\n\t * @param {jslet.ui.table.CellRender} defaultCellRender Default cell render.\r\n\t * \r\n\t * @return {this | jslet.ui.table.CellRender}\r\n\t * \r\n\t */\r\n\tdefaultCellRender: function(defaultCellRender) {\r\n\t\tif(defaultCellRender === undefined) {\r\n\t\t\treturn this._defaultCellRender;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.defaultCellRender', defaultCellRender).isObject();\r\n\t\t\r\n\t\tthis._defaultCellRender = defaultCellRender;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcurrColNum: function(currColNum) {\r\n\t\tvar Z = this;\r\n\t\tif(currColNum === undefined) {\r\n\t\t\treturn Z._currColNum;\r\n\t\t}\r\n\t\tvar oldColNum = Z._currColNum;\r\n\t\tZ._currColNum = currColNum;\r\n\t\tif(oldColNum !== currColNum) {\r\n\t\t\tZ._adjustCurrentCellPos(oldColNum > currColNum);\r\n\t\t\tZ._showCurrentCell();\r\n\t\t}\r\n\t\tif(Z._findDialog) {\r\n\t\t\tvar colCfg = Z.innerColumns[currColNum];\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onRowClick(function(otr) {});\r\n\t *     \r\n\t * @param {Function | undefined} onRowClick Table row clicked event handler.\r\n\t * @param {HtmlElement} onRowClick.trElement Table row element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRowClick: function(onRowClick) {\r\n\t\tif(onRowClick === undefined) {\r\n\t\t\treturn this._onRowClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowClick', onRowClick).isFunction();\r\n\t\tthis._onRowClick = onRowClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row double clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onRowDblClick(function(otr) {});\r\n\t *     \r\n\t * @param {Function | undefined} onRowDblClick Table row double clicked event handler.\r\n\t * @param {HtmlElement} onRowDblClick.trElement Table row element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRowDblClick: function(onRowDblClick) {\r\n\t\tif(onRowDblClick === undefined) {\r\n\t\t\treturn this._onRowDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowDblClick', onRowDblClick).isFunction();\r\n\t\tthis._onRowDblClick = onRowDblClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table cell clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onCellClick(function(otd) {});\r\n\t *     \r\n\t * @param {Function | undefined} onCellClick Table cell clicked event handler.\r\n\t * @param {HtmlElement} onCellClick.tdElement Table cell element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCellClick: function(onCellClick) {\r\n\t\tif(onCellClick === undefined) {\r\n\t\t\treturn this._onCellClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onCellClick', onCellClick).isFunction();\r\n\t\tthis._onCellClick = onCellClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onSelect(function(checked) {});\r\n\t *     \r\n\t * @param {Function | undefined} onSelect Table row selected event handler.\r\n\t * @param {Boolean} onSelect.checked True - table row is selected, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSelect: function(onSelect) {\r\n\t\tif(onSelect === undefined) {\r\n\t\t\treturn this._onSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelect', onSelect).isFunction();\r\n\t\tthis._onSelect = onSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when all table rows are selected. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onSelectAll(function(dataset, checked) {});\r\n\t *     \r\n\t * @param {Function | undefined} onSelectAll All Table row selected event handler.\r\n\t * @param {jslet.data.Dataset} onSelectAll.dataset The current dataset object.\r\n\t * @param {Boolean} onSelectAll.checked True - all rows selected, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSelectAll: function(onSelectAll) {\r\n\t\tif(onSelectAll === undefined) {\r\n\t\t\treturn this._onSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelectAll', onSelectAll).isFunction();\r\n\t\tthis._onSelectAll = onSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired before table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.beforeSelect(function(selected) {\r\n\t *       return true;\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} beforeSelect Table row selecting event handler.\r\n\t * @param {Boolean} beforeSelect.selected True - table row is selected, false - otherwise.\r\n\t * @param {Boolean} beforeSelect.return True - table row is allowed to select, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeSelect: function(beforeSelect) {\r\n\t\tif(beforeSelect === undefined) {\r\n\t\t\treturn this._beforeSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.beforeSelect', beforeSelect).isFunction();\r\n\t\tthis._beforeSelect = beforeSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.afterSelect(function() {});\r\n\t *     \r\n\t * @param {Function | undefined} afterSelect Table row after selected event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterSelect: function(afterSelect) {\r\n\t\tif(afterSelect === undefined) {\r\n\t\t\treturn this._afterSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.afterSelect', afterSelect).isFunction();\r\n\t\tthis._afterSelect = afterSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired before all table rows are selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.beforeSelectAll(function(selected) {\r\n\t *       return true;\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} beforeSelectAll All table rows are being selected event handler.\r\n\t * @param {Boolean} beforeSelectAll.selected True - all table rows are selected, false - otherwise.\r\n\t * @param {Boolean} beforeSelectAll.return True - all table rows are allowed to select, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeSelectAll: function(beforeSelectAll) {\r\n\t\tif(beforeSelectAll === undefined) {\r\n\t\t\treturn this._beforeSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.beforeSelectAll', beforeSelectAll).isFunction();\r\n\t\tthis._beforeSelectAll = beforeSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after all table rows are selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.afterSelectAll(function() {});\r\n\t *     \r\n\t * @param {Function | undefined} afterSelectAll Event handler for \"after all table rows are selected\".\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterSelectAll: function(afterSelectAll) {\r\n\t\tif(afterSelectAll === undefined) {\r\n\t\t\treturn this._afterSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.afterSelectAll', afterSelectAll).isFunction();\r\n\t\tthis._afterSelectAll = afterSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when fill row, user can use this to customize each row style like background color, font color. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onFillRow(function(trEle, dsObj) {});\r\n\t *   \r\n\t * @param {Function | undefined} onFillRow Table row filled event handler.\r\n\t * @param {HtmlElement} onFillRow.trElement Table row element.\r\n\t * @param {jslet.data.Dataset} onFillRow.dataset Current dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonFillRow: function(onFillRow) {\r\n\t\tif(onFillRow === undefined) {\r\n\t\t\treturn this._onFillRow;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillRow', onFillRow).isFunction();\r\n\t\tthis._onFillRow = onFillRow;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when fill cell, user can use this to customize each cell style like background color, font color. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onFillRow(function(trEle, dsObj, fldName) {});\r\n\t * \r\n\t * @param {Function | undefined} onFillCell Table cell filled event handler.\r\n\t * @param {HtmlElement} onFillCell.tdElement Table cell element.\r\n\t * @param {jslet.data.Dataset} onFillCell.dataset Current dataset object.\r\n\t * @param {String} onFillCell.fieldName Field name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonFillCell: function(onFillCell) {\r\n\t\tif(onFillCell === undefined) {\r\n\t\t\treturn this._onFillCell;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillCell', onFillCell).isFunction();\r\n\t\tthis._onFillCell = onFillCell;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user click the '+' button of the 'Edit' column. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onAppendRecord(function() {\r\n\t *        this.dataset().appendRecord();\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onAppendRecord '+ button event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonAppendRecord: function(onAppendRecord) {\r\n\t\tif(onAppendRecord === undefined) {\r\n\t\t\treturn this._onAppendRecord;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onAppendRecord', onAppendRecord).isFunction();\r\n\t\tthis._onAppendRecord = onAppendRecord;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user click the '-' button of the 'Edit' column. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onDeleteRecord(function() {\r\n\t *        this.dataset().deleteRecord();\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onDeleteRecord '- button event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonDeleteRecord: function(onDeleteRecord) {\r\n\t\tif(onDeleteRecord === undefined) {\r\n\t\t\treturn this._onDeleteRecord;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onDeleteRecord', onDeleteRecord).isFunction();\r\n\t\tthis._onDeleteRecord = onDeleteRecord;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has finding dialog or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasFindDialog true(default) - show finding dialog when press 'Ctrl + F', false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasFindDialog: function(hasFindDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFindDialog === undefined) {\r\n\t\t\treturn Z._hasFindDialog;\r\n\t\t}\r\n\t\tZ._hasFindDialog = hasFindDialog? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has filter dialog or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasFilterDialog true(default) - show filter dialog when creating table, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasFilterDialog: function(hasFilterDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFilterDialog === undefined) {\r\n\t\t\treturn Z._hasFilterDialog;\r\n\t\t}\r\n\t\tZ._hasFilterDialog = hasFilterDialog? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it's showing the 'Error find' menu item in the context menu.\r\n\t * \r\n\t * @param {Boolean | undefined} enableErrorFinding True - show error find menu item in the context menu, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableErrorFinding: function(enableErrorFinding) {\r\n\t\tif(enableErrorFinding === undefined) {\r\n\t\t\treturn this._enableErrorFinding;\r\n\t\t}\r\n\t\tthis._enableErrorFinding = enableErrorFinding ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the table height is stretched automatically according to the dataset's records.\r\n\t * \r\n\t * @param {Boolean | undefined} autoStretch True - The table height is stretched automatically, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoStretch: function(autoStretch) {\r\n\t\tvar Z = this;\r\n\t\tif(autoStretch === undefined) {\r\n\t\t\treturn Z._autoStretch;\r\n\t\t}\r\n\t\tZ._autoStretch = autoStretch? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the minimum visible rows of the table.\r\n\t * \r\n\t * @param {Integer | undefined} minVisibleRows Minimum visible rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminVisibleRows: function(minVisibleRows) {\r\n\t\tif(minVisibleRows === undefined) {\r\n\t\t\treturn this._minVisibleRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.minVisibleRows', minVisibleRows).isGTZero();\r\n\t\tthis._minVisibleRows = parseInt(minVisibleRows);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the minimum visible rows of the table.\r\n\t * \r\n\t * @param {Integer | undefined} maxVisibleRows Minimum visible rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxVisibleRows: function(maxVisibleRows) {\r\n\t\tif(maxVisibleRows === undefined) {\r\n\t\t\treturn this._maxVisibleRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.maxVisibleRows', maxVisibleRows).isNumber();\r\n\t\tthis._maxVisibleRows = parseInt(maxVisibleRows);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\tcellEditor: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._editable) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(!Z._cellEditor) {\r\n\t\t\tZ._cellEditor = new jslet.ui.table.TableCellEditor(Z);\r\n\t\t}\r\n\t\treturn Z._cellEditor;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Table columns configurations, array of jslet.ui.table.TableColumn.\r\n\t * \r\n\t * @param {jslet.ui.table.TableColumn[] | undefined} columns Table columns configurations.\r\n\t * \r\n\t * @return {this | jslet.ui.table.TableColumn[]}\r\n\t */\r\n\tcolumns: function(columns) {\r\n\t\tif(columns === undefined) {\r\n\t\t\treturn this._columns;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.columns', columns).isArray();\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolObj = columns[i];\r\n\t\t\tjslet.Checker.test('DBTable.Column.field', colObj.field).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.label', colObj.label).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colNum', colObj.colNum).isGTEZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.displayOrder', colObj.displayOrder).isNumber();\r\n\t\t\tjslet.Checker.test('DBTable.Column.width', colObj.width).isGTZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colSpan', colObj.colSpan).isGTZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.prefix', colObj.prefix).isArray();\r\n\t\t\tjslet.Checker.test('DBTable.Column.suffix', colObj.suffix).isArray();\r\n\t\t\tif(!colObj.field) {\r\n\t\t\t\tcolObj.disableHeadSort = true;\r\n\t\t\t\tcolObj.disableFilter = true;\r\n\t\t\t} else {\r\n\t\t\t\tcolObj.disableHeadSort = colObj.disableHeadSort ? true: false;\r\n\t\t\t\tcolObj.disableFilter = colObj.disableFilter ? true: false;\r\n\t\t\t}\r\n\t\t\tcolObj.mergeSame = colObj.mergeSame ? true: false;\r\n\t\t\tcolObj.noRefresh = colObj.noRefresh ? true: false;\r\n\t\t\tjslet.Checker.test('DBTable.Column.cellRender', colObj.cellRender).isObject();\r\n\t\t}\r\n\t\tthis._columns = columns;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get editable fields when DBTable is in editable. It is contrast to 'readOnlyFields'.<br />\r\n\t * If the read only columns' count is greater than editable fields, use 'readOnlyFields' instead. <br />\r\n\t * If 'editableFields' and 'readOnlyFields' are not specified, editable fields comes from jslet.data.Field object.\r\n\t * \r\n\t * @param {String[] | String | undefined} editableFields Editable fields.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\teditableFields: function(editableFields) {\r\n\t\tif(editableFields === undefined) {\r\n\t\t\treturn this._editableFields;\r\n\t\t}\r\n\t\tif(jslet.isString(editableFields)) {\r\n\t\t\teditableFields = editableFields.split(',');\r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('DBTable.editableFields', editableFields).isArray();\r\n\t\t}\r\n\t\tfor(var i = 0, len = editableFields.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('DBTable.editableFields#fieldName', editableFields[i]).required().isString();\r\n\t\t\teditableFields[i] = editableFields[i].trim();\r\n\t\t}\r\n\t\tthis._editableFields = editableFields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get read only fields when DBTable is in editable. It is contrast to 'editableFields'.<br />\r\n\t * If the editable columns' count is greater than read only fields, use 'editableFields' instead. <br />\r\n\t * If 'editableFields' and 'readOnlyFields' are not specified, editable fields comes from jslet.data.Field object.\r\n\t * \r\n\t * @param {String[] | String | undefined} readOnlyFields Read only fields.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\treadOnlyFields: function(readOnlyFields) {\r\n\t\tif(readOnlyFields === undefined) {\r\n\t\t\treturn this._readOnlyFields;\r\n\t\t}\r\n\t\tif(jslet.isString(readOnlyFields)) {\r\n\t\t\treadOnlyFields = readOnlyFields.split(',');\r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('DBTable.readOnlyFields', readOnlyFields).isArray();\r\n\t\t}\r\n\t\tfor(var i = 0, len = readOnlyFields.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('DBTable.readOnlyFields#fieldName', readOnlyFields[i]).required().isString();\r\n\t\t\treadOnlyFields[i] = readOnlyFields[i].trim();\r\n\t\t}\r\n\t\tthis._readOnlyFields = readOnlyFields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoField: function(fldName) {\r\n\t\tjslet.Checker.test('DBTable.gotoField#fldName', fldName).required().isString();\r\n\t\tvar colNum = this.getColNumByField(fldName);\r\n\t\tif(colNum >= 0) {\r\n\t\t\tthis.gotoColumn(colNum);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get column number with field name.\r\n\t * \r\n\t * @param {String} fldName Field name.\r\n\t * \r\n\t * @return {Integer} Column number.\r\n\t */\r\n\tgetColNumByField: function(fldName) {\r\n\t\tvar lastColNum = this.innerColumns.length - 1,\r\n\t\t\tcolCfg;\r\n\t\tfor(var i = 0; i <= lastColNum; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tif(colCfg.field == fldName) {\r\n\t\t\t\treturn colCfg.colNum;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field name with column number.\r\n\t * \r\n\t * @param {Integer} colNum Column number.\r\n\t * \r\n\t * @return {String} Field name.\r\n\t */\r\n\tgetFieldByColNum: function(colNum) {\r\n\t\tvar lastColNum = this.innerColumns.length - 1,\r\n\t\t\tcolCfg;\r\n\t\tfor(var i = 0; i <= lastColNum; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tif(colCfg.colNum == colNum) {\r\n\t\t\t\treturn colCfg.field;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoColumn: function(colNum) {\r\n\t\tjslet.Checker.test('DBTable.gotoColumn#colNum', colNum).required().isGTEZero();\r\n\t\tvar lastColNum = this.innerColumns.length - 1;\r\n\t\tif(colNum > lastColNum) {\r\n\t\t\tcolNum = lastColNum;\r\n\t\t}\r\n\t\tthis.currColNum(colNum);\r\n\t},\r\n\t\r\n\teditorTabIndex: function() {\r\n\t\treturn this._editorTabIndex;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t_calcTabIndex: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(Z._editable) {\r\n\t\t\tvar masterFldObj = Z._dataset.getMasterFieldObject(),\r\n\t\t\t\ttbIdx = null;\r\n\t\t\tif(masterFldObj) {\r\n\t\t\t\ttbIdx = masterFldObj.tabIndex();\r\n\t\t\t}\r\n\t\t\tif(!tbIdx) {\r\n\t\t\t\ttbIdx = Z.el.tabIndex;\r\n\t\t\t}\r\n\t\t\tZ._editorTabIndex = tbIdx && tbIdx > 0? tbIdx: null;\r\n\t\t}\r\n\t\tZ.el.tabIndex = -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t\t\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tZ.charHeight = jslet.ui.textMeasurer.getHeight('M')+4;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tZ.charWidth = jslet.global.defaultCharWidth || 12;\r\n\t\tZ._widthStyleId = jslet.nextId();\r\n\t\tZ._initializeVm();\r\n\t\tZ._calcTabIndex();\r\n\t\tZ.renderAll();\r\n\t\tZ._bindEvents();\r\n\t}, // end bind\r\n\t\r\n\t_bindEvents: function() {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n        var notFF = ((typeof Z.el.onmousewheel) == 'object'); //firefox or nonFirefox browser\r\n        var wheelEvent = (notFF ? 'mousewheel' : 'DOMMouseScroll');\r\n        jqEl.on(wheelEvent, function(event) {\r\n        \tif(Z._disableMouseWheel) {\r\n        \t\treturn;\r\n        \t}\r\n        \t\r\n            var originalEvent = event.originalEvent;\r\n            var num = notFF ? originalEvent.wheelDelta / -120 : originalEvent.detail / 3;\r\n\t\t\tif(Z._editable && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n            Z.listvm.setVisibleStartRow(Z.listvm.getVisibleStartRow() + num);\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t}\r\n       \t\tevent.preventDefault();\r\n        });\r\n\r\n        jqEl.on('mousedown', function(event) {\r\n        \tif(event.shiftKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n        \r\n        jqEl.on('click', 'button.jl-tbl-filter', function(event) {\r\n    \t\tif (!Z._filterPanel) {\r\n    \t\t\tZ._filterPanel = new jslet.ui.table.DBTableFilterPanel(Z);\r\n    \t\t}\r\n    \t\tvar btnEle = event.currentTarget,\r\n    \t\t\tjqFilterBtn = jQuery(btnEle),\r\n    \t\t\ttblPos = jQuery(Z.el).offset();\r\n    \t\tvar r = jqFilterBtn.offset(), \r\n    \t\t\th = jqFilterBtn.outerHeight(), \r\n    \t\t\tx = r.left - tblPos.left, \r\n    \t\t\ty = r.top + h - tblPos.top;\r\n    \t\tif (jsletlocale.isRtl) {\r\n    \t\t\tx = x + jqFilterBtn.outerWidth();\r\n    \t\t}\r\n    \t\tvar fldName = jqFilterBtn[0].getAttribute('jsletfilterfield');\r\n    \t\tZ._filterPanel.changeField(fldName);\r\n    \t\tZ._filterPanel.jqFilterBtn(jqFilterBtn);\r\n    \t\tZ._filterPanel.show(x, y, 0, h);\r\n        \t\r\n       \t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n        });\r\n        jqEl.on('dblclick', 'td.jl-tbl-cell', function(event) {\r\n        \tvar otd = event.currentTarget;\r\n        \tZ._doDblCellClick(otd, event.offsetY);\r\n        });\r\n        \r\n        jqEl.on('mousedown', 'td.jl-tbl-cell', function(event) {\r\n        \tvar otd = event.currentTarget;\r\n        \tvar offsetY = event.offsetY;\r\n        \tif(event.target != otd) {\r\n        \t\toffsetY = jQuery(event.target).offset().top - jQuery(otd).offset().top + event.offsetY;\r\n        \t}\r\n        \tZ._doCellClick(otd, offsetY, event);\r\n        \t\r\n        \tif(event.shiftKey || event.ctrlKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n\r\n        jqEl.on('click', '.jl-tbltree-btn', function(event) {\r\n        \tfunction checkFn(node) {\r\n\t\t\t\treturn node.tagName && node.tagName.toLowerCase() == 'tr' && (node.jsletrecno || node.jsletrecno === 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfunction callBackFn() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar otr = jslet.ui.findFirstParent(this, checkFn);\r\n\t\t\t\t\t\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tvar recNo = otr.jsletrecno;\r\n\t\t\tZ._dataset.recno(recNo);\r\n\t\t\tif(Z._dataset.aborted()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (Z._dataset.expandedByRecno(recNo)) {\r\n\t\t\t\tZ.listvm.collapse(callBackFn);\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand(callBackFn);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n        });\r\n        \r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which,\r\n\t\t\t\tctrlKey = event.ctrlKey,\r\n\t\t\t\tshiftKey = event.shiftKey,\r\n\t\t\t\taltKey = event.altKey;\r\n\t\t\tif(ctrlKey) {\r\n\t\t\t\tvar flag = false;\r\n\t\t\t\tif(Z._hasFindDialog && keyCode === jslet.ui.KeyCode.F) { //ctrl + f\r\n\t\t\t\t\tZ.showFindDialog();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.E && (Z._enableErrorFinding || Z._editable)) { //ctrl + e\r\n\t\t\t\t\tZ.gotoNextError();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.A) { //ctrl + a\r\n\t\t\t\t\tZ.selectAllCells();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.HOME) { //ctrl + Home\r\n\t\t\t\t\tZ._dataset.first();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.END) { //ctrl + End\r\n\t\t\t\t\tZ._dataset.last();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.C) { //ctrl + c\r\n\t\t\t\t\tZ.copySelection(false);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(flag) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar isTabKey = (keyCode === jslet.ui.KeyCode.TAB || keyCode === jslet.global.defaultFocusKeyCode);\r\n\t\t\tif(shiftKey && isTabKey) { //Shift TAB Left\r\n\t\t\t\tif(!Z.tabPrior()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else if(isTabKey) { //TAB Right\r\n\t\t\t\tif(!Z.tabNext()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else if(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tZ.movePriorCell(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tZ.moveNextCell(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.UP) {//KEY_UP\r\n\t\t\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\t\t\tZ.listvm.priorRow();\r\n\t\t\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.DOWN) {//KEY_DOWN\r\n\t\t\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\t\t\tZ.listvm.nextRow();\r\n\t\t\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEUP) {//KEY_PAGEUP\r\n\t\t\t\tZ.listvm.priorPage();\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEDOWN) {//KEY_PAGEDOWN\r\n\t\t\t\tZ.listvm.nextPage();\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ENTER && !Z._editable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n\t\t});\t\t\r\n\t\tZ._createContextMenu();\r\n\t},\r\n\t\r\n\t_createContextMenu: function() {\r\n\t\tif (!jslet.ui.Menu) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar menuCfg = {type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: []};\r\n\t\tmenuCfg.items.push({id: 'selectAll', name: jsletlocale.DBTable.selectAll});\r\n\t\tmenuCfg.items.push({id: 'copy', name: jsletlocale.DBTable.copy});\r\n\t\tmenuCfg.items.push({name: '-'});\r\n\t\tif(Z._hasFindDialog) {\r\n\t\t\tmenuCfg.items.push({id: 'find', name: jsletlocale.DBTable.find});\r\n\t\t}\r\n\t\tmenuCfg.items.push({id: 'fixed', name: jsletlocale.DBTable.fixed, \r\n\t\t\titems: [{id: 'fixedCol', name: jsletlocale.DBTable.fixedCol},\r\n\t\t\t        {id: 'fixedRow', name: jsletlocale.DBTable.fixedRow},\r\n\t\t\t]});\r\n\t\tif(Z._enableErrorFinding || Z._editable) {\r\n\t\t\tmenuCfg.items.push({name: '-'});\r\n\t\t\tmenuCfg.items.push({id: 'nextError', name: jsletlocale.DBTable.nextError});\r\n\t\t}\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t\tjQuery(Z.el).on('contextmenu', '.jl-tbl-cell', function(event) {\r\n\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_menuItemClick: function(menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tvar Z = this;\r\n\t\tif (menuId == 'selectAll') {\r\n\t\t\tZ.selectAllCells();\r\n\t\t} else if (menuId == 'find') {\r\n\t\t\tZ.showFindDialog();\r\n\t\t} else if (menuId == 'fixedRow') {\r\n\t\t\tZ.fixedRows(Z._dataset.recno() + 1);\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (menuId == 'fixedCol') {\r\n\t\t\tZ.fixedCols(Z._currColNum + 1);\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (menuId == 'copy') {\r\n\t\t\tjslet.ui.info(jsletlocale.DBTable.copyInfo);\r\n\t\t} else if (menuId == 'nextError') {\r\n\t\t\tZ.gotoNextError();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show finding record dialog. Press 'Ctrl + F' to call this method.\r\n\t */\r\n\tshowFindDialog: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._filterPanel) {\r\n\t\t\tZ._filterPanel.hide();\r\n\t\t}\r\n\t\tif(!Z._hasFindDialog) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!Z._findDialog) {\r\n\t\t\tZ._findDialog = new jslet.ui.table.FindDialog(Z);\r\n\t\t}\r\n\t\tif(!Z._findDialog.findingField()) {\r\n\t\t\tvar colCfg = Z.innerColumns[Z._currColNum];\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t} else {\r\n\t\t\t\t//Get first column with field name.\r\n\t\t\t\tfor(var i = Z._currColNum + 1, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[i];\r\n\t\t\t\t\tif(colCfg.field) {\r\n\t\t\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._findDialog.findingField()) {\r\n\t\t\tZ._findDialog.show(0, Z.headSectionHt);\r\n\t\t}\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto the next error record if dataset exists errors. Press 'Ctrl + E' to call this method.\r\n\t */\r\n\tgotoNextError: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset.nextError()) {\r\n\t\t\tZ._dataset.firstError();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcopySelection: function(fitExcel) {\r\n\t\tvar Z = this, \r\n\t\t\tselectedText;\r\n\t\tif(fitExcel) {\r\n\t\t\tselectedText = Z._dataset.selection.getSelectionText('\"', true, '\\t');\r\n\t\t} else {\r\n\t\t\tselectedText = Z._dataset.selection.getSelectionText('', false, '\\t');\r\n\t\t}\r\n\t\tif(!selectedText) {\r\n\t\t\tvar fldName = Z.getFieldByColNum(Z._currColNum);\r\n\t\t\tif(fldName) {\r\n\t\t\t\tselectedText = Z._dataset.getFieldText(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(selectedText) {\r\n\t\t\tjslet.Clipboard.putText(selectedText);\r\n\t\t\twindow.setTimeout(function() {Z.el.focus();}, 5);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tselectAllCells: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfields = [], colCfg, fldName;\r\n\t\tfor(var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tcolCfg = Z.innerColumns[i];\r\n\t\t\tfldName = colCfg.field;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tfields.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._dataset.selection.selectAll(fields, true);\r\n\t\tZ._refreshSelection();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Move cursor to the prior editable field.\r\n\t */\r\n\ttabPrior: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = Z.getFieldByColNum(Z._currColNum),\r\n\t\t\tlastColNum, num = null, \r\n\t\t\tfocusedFields = Z._dataset.focusedFields(),\r\n\t\t\teditingFields = Z._getEditingFields();\r\n\t\tif(editingFields && editingFields.indexOf(fldName) >= 0) {\r\n\t\t\tvar focusMngr = jslet.ui.globalFocusManager,\r\n\t\t\t\tonChangingFocusFn = focusMngr.onChangingFocus();\r\n\t\t\t\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfocusedFields = focusedFields.slice(0);\r\n\t\t\t\tfor(var i = focusedFields.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(editingFields.indexOf(focusedFields[i]) < 0) {\r\n\t\t\t\t\t\tfocusedFields.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar idx = -1, fields;\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfields = focusedFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(idx < 0) {\r\n\t\t\t\tfields = editingFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(onChangingFocusFn) {\r\n\t\t\t\tvar cancelFocus = onChangingFocusFn(document.activeElement || Z.el, true, Z._dataset, \r\n\t\t\t\t\t\tfocusMngr.activeField(), fields, focusMngr.activeValueIndex());\r\n\t\t\t\tif(!cancelFocus) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(fields && idx >= 0) {\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\t\t\tZ._dataset.prior();\r\n\t\t\t\t\t\tfldName = fields[fields.length - 1];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldName = fields[idx - 1];\r\n\t\t\t\t}\r\n\t\t\t\tnum = Z.getColNumByField(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(num === null) {\r\n\t\t\tlastColNum = Z.innerColumns.length - 1;\r\n\t\t\tif(Z._currColNum === 0) {\r\n\t\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\t\tZ._dataset.prior();\r\n\t\t\t\t\tnum = lastColNum;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnum = Z._currColNum - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.currColNum(num);\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Move cursor to the next editable field.\r\n\t */\r\n\ttabNext: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = Z.getFieldByColNum(Z._currColNum),\r\n\t\t\tlastColNum, num = null, \r\n\t\t\tfocusedFields = Z._dataset.focusedFields(),\r\n\t\t\teditingFields = Z._getEditingFields();\r\n\t\t\t\r\n\t\tif(editingFields && editingFields.indexOf(fldName) >= 0) {\r\n\t\t\tvar focusMngr = jslet.ui.globalFocusManager,\r\n\t\t\t\tonChangingFocusFn = focusMngr.onChangingFocus();\r\n\t\t\t\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfocusedFields = focusedFields.slice(0);\r\n\t\t\t\tfor(var i = focusedFields.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(editingFields.indexOf(focusedFields[i]) < 0) {\r\n\t\t\t\t\t\tfocusedFields.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar idx = -1, fields;\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfields = focusedFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(idx < 0) {\r\n\t\t\t\tfields = editingFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(onChangingFocusFn) {\r\n\t\t\t\tvar cancelFocus = onChangingFocusFn(document.activeElement || Z.el, false, Z._dataset, \r\n\t\t\t\t\t\tfocusMngr.activeField(), fields, focusMngr.activeValueIndex());\r\n\t\t\t\tif(!cancelFocus) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(fields && idx >= 0) {\r\n\t\t\t\tif(idx === fields.length - 1) {\r\n\t\t\t\t\tif(Z._dataset.recno() < Z._dataset.recordCount() - 1) {\r\n\t\t\t\t\t\tZ._dataset.next();\r\n\t\t\t\t\t\tfldName = fields[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldName = fields[idx + 1];\r\n\t\t\t\t}\r\n\t\t\t\tnum = Z.getColNumByField(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(num === null) {\r\n\t\t\tlastColNum = Z.innerColumns.length - 1;\r\n\t\t\tif(Z._currColNum < lastColNum) {\r\n\t\t\t\tnum = Z._currColNum + 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(Z._dataset.recno() === Z._dataset.recordCount() - 1) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.next();\r\n\t\t\t\tnum = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.currColNum(num);\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\tmovePriorCell: function(ctrlKey, shiftKey, altKey) {\r\n\t\tvar Z = this,\r\n\t\t\tlastColNum = Z.innerColumns.length - 1,\r\n\t\t\tnum;\r\n\t\t\r\n\t\tif(Z._currColNum === 0) {\r\n\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\tZ._dataset.prior();\r\n\t\t\t\tnum = lastColNum;\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tnum = Z._currColNum - 1;\r\n\t\t}\r\n\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\tZ.currColNum(num);\r\n\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tmoveNextCell: function(ctrlKey, shiftKey, altKey) {\r\n\t\tvar Z = this,\r\n\t\t\tlastColNum = Z.innerColumns.length - 1,\r\n\t\t\tnum;\r\n\t\t\r\n\t\tif(Z._currColNum < lastColNum) {\r\n\t\t\tnum = Z._currColNum + 1;\r\n\t\t} else {\r\n\t\t\tif(Z._dataset.recno() === Z._dataset.recordCount() - 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._dataset.next();\r\n\t\t\tnum = 0;\r\n\t\t}\r\n\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\tZ.currColNum(num);\r\n\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_getEditingFields: function() {\r\n\t\tvar Z = this; \r\n\t\tif(!Z._editable) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldName, fldObj,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\tresult = null;\r\n\r\n\t\tfor(var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tfldName = Z.innerColumns[i].field;\r\n\t\t\tif(!fldName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\tif(!fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\tif(!result) {\r\n\t\t\t\t\tresult = [];\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_initializeVm: function() {\r\n\t\tvar Z = this;\r\n\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, Z._treeField ? true : false);\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged = function(rowno) {\r\n\t\t\tif (rowno < 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._fillData();\r\n\t\t\t\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t\tZ._showCurrentRow();\r\n\t\t};\r\n\t\r\n\t\tZ.listvm.onVisibleCountChanged = function() {\r\n\t\t\tZ.renderAll();\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged = function(preRowno, rowno) {\r\n\t\t\tZ._hideCurrentRow();\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tvar currRow = Z._getTrByRowno(rowno), otr;\r\n\t\t\tif (!currRow) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\totr = currRow.fixed;\r\n\t\t\tif (otr) {\r\n\t\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totr = currRow.content;\r\n\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\tZ._currRow = currRow;\r\n\t\t\tif(Z._editable) {\r\n\t\t\t\tvar fldName = Z._editingField;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tvar fldObj = Z._dataset.getField(fldName);\r\n\t\t\t\t\tif(fldObj && !fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\t\t\tZ._dataset.focusEditControl(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._innerDestroy();\r\n\t\tZ.el.innerHTML = '';\r\n\t\tZ.listvm.fixedRows = Z._fixedRows;\r\n\t\tZ._calcParams();\r\n\t\tZ.listvm.refreshModel();\r\n\t\tZ._createFrame();\r\n\t\tZ._fillData();\r\n\t\tZ._showCurrentRow(true);\r\n\t\tZ._oldHeight = jQuery(Z.el).height();\r\n\t\tZ._updateSortFlag(true);\r\n\t\treturn this;\r\n\t}, // end renderAll\r\n\r\n\t_doBeforeSelect: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t},\r\n\t\r\n\t_getSelectionFields: function(startColNum, endColNum) {\r\n\t\tif(startColNum > endColNum) {\r\n\t\t\tvar tmp = startColNum;\r\n\t\t\tstartColNum = endColNum;\r\n\t\t\tendColNum = tmp;\r\n\t\t}\r\n\t\tvar fields = [], fldName, colCfg, colNum;\r\n\t\tfor(var i = 0, len = this.innerColumns.length; i < len; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tcolNum = colCfg.colNum;\r\n\t\t\tif(colNum >= startColNum && colNum <= endColNum) {\r\n\t\t\t\tfldName = colCfg.field;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fields;\r\n\t},\r\n\t\r\n\t_processSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tvar Z = this,\r\n\t\t\tcurrRecno = Z._dataset.recno(),\r\n\t\t\tfldName;\r\n\t\tif(hasCtrlKey || !Z._autoClearSelection) { //If autoClearSelection = false, click a cell will select it.\r\n\t\t\tfldName = Z.innerColumns[Z._currColNum].field;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tif(Z._dataset.selection.isSelected(currRecno, fldName)) {\r\n\t\t\t\t\tZ._dataset.selection.remove(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ._dataset.selection.add(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t}\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(hasShiftKey) {\r\n\t\t\tvar fields;\r\n\t\t\tif(Z._preTmpRecno >= 0 && Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, false);\r\n\t\t\t}\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._currColNum);\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._refreshSelection();\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t} else {\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t\tif(Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_processColumnSelection: function(colCfg, hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\trecCnt = Z._dataset.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields, colNum;\r\n\t\tif(hasShiftKey) {\r\n\t\t\tif(Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(0, recCnt, fields, true);\r\n\t\t\t}\r\n\t\t\tcolNum = colCfg.colNum + colCfg.colSpan - 1;\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, colNum);\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preTmpColNum = colNum;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tif(colCfg.colSpan > 1) {\r\n\t\t\t\tfields = [];\r\n\t\t\t\tvar startColNum = colCfg.colNum,\r\n\t\t\t\t\tendColNum = colCfg.colNum + colCfg.colSpan, fldName;\r\n\t\t\t\t\r\n\t\t\t\tfor(colNum = startColNum; colNum < endColNum; colNum++) {\r\n\t\t\t\t\tfldName = Z.innerColumns[colNum].field;\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfields = [colCfg.field];\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preColNum = colCfg.colNum;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_processRowSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfields = Z._getSelectionFields(0, Z.innerColumns.length - 1);\r\n\t\tvar currRecno = Z._dataset.recno();\r\n\t\tif(hasShiftKey) {\r\n\t\t\tif(Z._preTmpRecno >= 0) {\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, true);\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._preTmpColNum = currRecno;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(currRecno, currRecno, fields, true);\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_prepareColumn: function() {\r\n\t\tvar Z = this, cobj;\r\n\t\tZ._sysColumns = [];\r\n\t\t//prepare system columns\r\n\t\tif (Z._hasSeqCol) {\r\n\t\t\tcobj = {label:'&nbsp;',width: Z.seqColWidth, disableHeadSort:true,isSeqCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.sequenceCellRender, widthCssName: Z._widthStyleId + '-s0'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\tif (Z._hasSelectCol) {\r\n\t\t\tcobj = {label:'<input type=\"checkbox\" />', width: Z.selectColWidth, disableHeadSort:true,isSelectCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.selectCellRender, widthCssName: Z._widthStyleId + '-s1'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t\r\n\t\tif (Z.subgroup && Z.subgroup.hasExpander) {\r\n\t\t\tcobj = {label:'&nbsp;', width: Z.selectColWidth, disableHeadSort:true, isSubgroup: true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.subgroupCellRender, widthCssName: Z._widthStyleId + '-s2'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t//prepare data columns\r\n\t\tvar tmpColumns = [], fldObj;\r\n\t\tif (Z._columns) {\r\n\t\t\tfor(var k = 0, colCnt2 = Z._columns.length; k < colCnt2; k++) {\r\n\t\t\t\tcobj = Z._columns[k];\r\n\t\t\t\tif (!cobj.field) {\r\n\t\t\t\t\tcobj.disableHeadSort = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\t\tif(!fldObj) {\r\n\t\t\t\t\t\tthrow new Error('Not found Field: ' + cobj.field);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t}\r\n\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction getColumnObj(fldName) {\r\n\t\t\tif (Z._columns) {\r\n\t\t\t\tfor(var m = 0, colCnt1 = Z._columns.length; m < colCnt1; m++) {\r\n\t\t\t\t\tcobj = Z._columns[m];\r\n\t\t\t\t\tif (cobj.field && cobj.field == fldName) {\r\n\t\t\t\t\t\treturn cobj;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar i, fldcnt, colCnt, fldName;\r\n\t\tif (!Z._onlySpecifiedCol) {\r\n\t\t\tvar fields = Z._dataset.getFields();\r\n\t\t\tfor (i = 0, fldcnt = fields.length; i < fldcnt; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif (fldObj.visible()) {\r\n\t\t\t\t\tcobj = getColumnObj(fldName);\r\n\t\t\t\t\tif(!cobj) {\r\n\t\t\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\t\t\tcobj.field = fldObj.name();\r\n\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t}\r\n\t\t\t\t} // end if visible\r\n\t\t\t} // end for\r\n\t\t\tif (Z._columns) {\r\n\t\t\t\tfor(i = 0, colCnt = Z._columns.length; i < colCnt; i++) {\r\n\t\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\t\tif (!cobj.field) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfldObj = Z._dataset.getTopField(cobj.field);\r\n\t\t\t\t\tif (!fldObj) {\r\n\t\t\t\t\t\tthrow new Error(\"Field: \" + cobj.field + \" doesn't exist!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar children = fldObj.children();\r\n\t\t\t\t\tif (children && children.length > 0) {\r\n\t\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\t\tvar isUnique = true;\r\n\t\t\t\t\t\t// cobj.field is not a child of a groupfield, we need check if the topmost parent field is duplicate or not \r\n\t\t\t\t\t\tif (cobj.field != fldName) {\r\n\t\t\t\t\t\t\tfor(var n = 0; n < tmpColumns.length; n++) {\r\n\t\t\t\t\t\t\t\tif (tmpColumns[n].field == fldName) {\r\n\t\t\t\t\t\t\t\t\tisUnique = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} // end for k\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (isUnique) {\r\n\t\t\t\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\t\t\t\tcobj.field = fldName;\r\n\t\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} //end for i\r\n\t\t\t} //end if Z.columns\r\n\t\t}\r\n\t\t\r\n\t\ttmpColumns.sort(function(cobj1, cobj2) {\r\n\t\t\tvar ord1 = cobj1.displayOrder || 0;\r\n\t\t\tvar ord2 = cobj2.displayOrder || 0;\r\n\t\t\treturn ord1 === ord2? 0: (ord1 < ord2? -1: 1);\r\n\t\t});\r\n\t\t\r\n\t\tZ.innerHeads = [];\r\n\t\tZ.innerColumns = [];\r\n\t\tvar ohead, label, \r\n\t\t\tcontext = {lastColNum: 0, depth: 0};\r\n\t\t\r\n\t\tfor(i = 0, colCnt = tmpColumns.length; i < colCnt; i++) {\r\n\t\t\tcobj = tmpColumns[i];\r\n\t\t\tfldName = cobj.field;\r\n\t\t\tif (!fldName) {\r\n\t\t\t\tohead = new jslet.ui.table.TableHead();\r\n\t\t\t\tlabel = cobj.label;\r\n\t\t\t\tohead.label = label? label: \"\";\r\n\t\t\t\tohead.level = 0;\r\n\t\t\t\tohead.colNum = context.lastColNum++;\r\n\t\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\t\tohead.id = jslet.nextId();\r\n\t\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\tohead.disableHeadSort = cobj.disableHeadSort;\r\n\r\n\t\t\t\tZ.innerHeads.push(ohead);\r\n\t\t\t\tZ.innerColumns.push(cobj);\r\n\t\t\t\t\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tZ._convertField2Head(context, fldObj);\r\n\t\t}\r\n\r\n\t\tZ.maxHeadRows = context.depth + 1;\r\n\t\tZ._calcHeadSpan();\r\n\t\r\n\t\t//check fixedCols property\r\n\t\tvar preColCnt = 0, len,\r\n\t\t\tfixedColNum = Z._fixedCols - Z._sysColumns.length;\r\n\t\tcolCnt = 0;\r\n\t\tfor(i = 1, len = Z.innerHeads.length; i < len; i++) {\r\n\t\t\tohead = Z.innerHeads[i];\r\n\t\t\tcolCnt += ohead.colSpan;\r\n\t\t\tif (fixedColNum <= preColCnt || fixedColNum == colCnt) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (fixedColNum < colCnt && fixedColNum > preColCnt) {\r\n\t\t\t\tZ._fixedCols = preColCnt + Z._sysColumns.length;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpreColCnt = colCnt;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_calcHeadSpan: function(heads) {\r\n\t\tvar Z = this;\r\n\t\tif (!heads) {\r\n\t\t\theads = Z.innerHeads;\r\n\t\t}\r\n\t\tvar ohead, childCnt = 0;\r\n\t\tfor(var i = 0, len = heads.length; i < len; i++ ) {\r\n\t\t\tohead = heads[i];\r\n\t\t\tohead.rowSpan = Z.maxHeadRows - ohead.level;\r\n\t\t\tif (ohead.subHeads) {\r\n\t\t\t\tohead.colSpan = Z._calcHeadSpan(ohead.subHeads);\r\n\t\t\t\tchildCnt += ohead.colSpan;\r\n\t\t\t} else {\r\n\t\t\t\tohead.colSpan = 1;\r\n\t\t\t\tchildCnt++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn childCnt;\r\n\t},\r\n\t\r\n\t_convertField2Head: function(context, fldObj, parentHeadObj) {\r\n\t\tfunction checkHtml(htmlStr) {\r\n\t\t    var  reg = /<[^>]+>/g;\r\n\t\t    return reg.test(htmlStr);\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tif (!fldObj.visible()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar level = 0, heads;\r\n\t\tif (!parentHeadObj) {\r\n\t\t\theads = Z.innerHeads;\r\n\t\t} else {\r\n\t\t\tlevel = parentHeadObj.level + 1;\r\n\t\t\theads = parentHeadObj.subHeads;\r\n\t\t}\r\n\t\tvar ohead, fldName = fldObj.name();\r\n\t\tohead = new jslet.ui.table.TableHead();\r\n\t\tohead.label = fldObj.displayLabel();\r\n\t\tohead.field = fldName;\r\n\t\tohead.level = level;\r\n\t\tohead.colNum = context.lastColNum;\r\n\t\tohead.id = jslet.nextId();\r\n\t\theads.push(ohead);\r\n\t\tcontext.depth = Math.max(level, context.depth);\r\n\t\tvar fldChildren = fldObj.children();\r\n\t\tif (fldChildren && fldChildren.length > 0) {\r\n\t\t\tohead.subHeads = [];\r\n\t\t\tvar added = false;\r\n\t\t\tfor(var i = 0, cnt = fldChildren.length; i< cnt; i++) {\r\n\t\t\t\tZ._convertField2Head(context, fldChildren[i], ohead);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcontext.lastColNum ++;\r\n\t\t\tvar cobj, found = false;\r\n\t\t\tvar len = Z._columns ? Z._columns.length: 0;\r\n\t\t\tfor(var k = 0; k < len; k++) {\r\n\t\t\t\tcobj = Z._columns[k];\r\n\t\t\t\tif (cobj.field == fldName) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!found) {\r\n\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\tcobj.field = fldName;\r\n\t\t\t}\r\n\t\t\tif (!cobj.label) {\r\n\t\t\t\tcobj.label = fldObj.displayLabel();\r\n\t\t\t}\r\n\t\t\tvar dataType = fldObj.getType();\r\n\t\t\tif(dataType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\tcobj.isBoolColumn = true;\r\n\t\t\t}\r\n\t\t\tcobj.mergeSame = fldObj.mergeSame();\r\n\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\tif (!cobj.width) {\r\n\t\t\t\tvar maxWidth = fldObj ? fldObj.displayWidth() : 0;\r\n\t\t\t\tif (!Z._hideHead && cobj.label) {\r\n\t\t\t\t\tif(checkHtml(cobj.label)) {\r\n\t\t\t\t\t\tmaxWidth = Math.max(maxWidth, jQuery(cobj.label).text().length);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaxWidth = Math.max(maxWidth, cobj.label.length);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcobj.width = maxWidth ? (maxWidth * Z.charWidth) : 10;\r\n\t\t\t}\r\n\t\t\t//check and set cell render \r\n\t\t\tif (!cobj.cellRender) {\r\n\t\t\t\tif (dataType === jslet.data.DataType.BOOLEAN) {//data type is boolean\r\n\t\t\t\t\tcobj.cellRender = jslet.ui.table.cellRenders.boolCellRender;\r\n\t\t\t\t} else if (dataType === jslet.data.DataType.EDITACTION) {//data type is edit\r\n\t\t\t\t\tohead.cellRender = cobj.cellRender = jslet.ui.table.cellRenders.editActionCellRender;\r\n\t\t\t\t} else if (cobj.field == Z._treeField) {\r\n\t\t\t\t\tcobj.cellRender = jslet.ui.table.cellRenders.treeCellRender;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tohead.disableHeadSort = true;\r\n\t\t\t\tohead.disableFilter = true;\r\n\t\t\t}\r\n\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\r\n\t\t\tZ.innerColumns.push(cobj);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_calcParams: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._preTmpColNum = -1;\r\n\t\tZ._preTmpRecno = -1;\r\n\t\tZ._preRecno = -1;\r\n\t\tZ._preColNum = -1;\r\n\r\n\t\tif (Z._treeField) {//if tree style table, it can't be sorted by clicking column header\r\n\t\t\tZ._disableHeadSort = true;\r\n\t\t}\r\n\t\t// calculate Sequence column width\r\n\t\tif (Z._hasSeqCol) {\r\n\t\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth + 5;\r\n\t\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\t} else {\r\n\t\t\tZ.seqColWidth = 0;\r\n\t\t}\r\n\t\t// calculate Select column width\r\n\t\tif (Z._hasSelectCol) {\r\n\t\t\tZ.selectColWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t} else {\r\n\t\t\tZ.selectColWidth = 0;\r\n\t\t}\r\n\t\t//calculate Fixed row section's height\r\n\t\tif (Z._fixedRows > 0) {\r\n\t\t\tZ.fixedSectionHt = Z._fixedRows * Z.rowHeight();\r\n\t\t} else {\r\n\t\t\tZ.fixedSectionHt = 0;\r\n\t\t}\r\n\t\t//Calculate Foot section's height\r\n\t\tif (Z.aggregated() && Z.dataset().checkAggregated()) {\r\n\t\t\tZ.footSectionHt = Z.footerRowHeight();\r\n\t\t} else {\r\n\t\t\tZ.footSectionHt = 0;\r\n\t\t}\r\n\t\tZ._prepareColumn();\r\n\r\n\t\t// fixed Column count must be less than total columns\r\n\t\tif (Z._fixedCols) {\r\n\t\t\tif (Z._fixedCols > Z.innerColumns.length) {\r\n\t\t\t\tZ._fixedCols = Z.innerColumns.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.hasFixedCol = Z._sysColumns.length > 0 || Z._fixedCols > 0;\r\n\t\tif (Z.hasFixedCol) {\r\n\t\t\tvar w = 0, i, cnt;\r\n\t\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\t\tw += Z._sysColumns[i].width + 1;\r\n\t\t\t}\r\n\t\t\tfor(i = 0, cnt = Z._fixedCols; i < cnt; i++) {\r\n\t\t\t\tw += Z.innerColumns[i].width + 1;\r\n\t\t\t}\r\n\t\t\tZ.fixedColWidth = w + 1;\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = 0;\r\n\t\t}\r\n\t}, // end _calcParams\r\n\r\n\t_setScrollBarMaxValue: function(maxValue) {\r\n\t\tvar Z = this,\r\n\t\t\tv = maxValue + Z._repairHeight + (Z._autoStretch? Z.footSectionHt: 0);\r\n\t\tZ.jqVScrollBar.find('div').height(v);\r\n\t\tif(Z.contentSectionHt >= v) {\r\n\t\t\tZ.jqVScrollBar.parent().addClass('jl-scrollbar-hidden');\t\r\n\t\t} else {\r\n\t\t\tZ.jqVScrollBar.parent().removeClass('jl-scrollbar-hidden');\t\r\n\t\t}\r\n\t},\r\n\r\n\t_changeColWidthCssRule: function(cssName, width) {\r\n\t\tvar Z = this,\r\n\t\t\tstyleEle = document.getElementById(Z._widthStyleId),\r\n\t\t\tstyleObj = styleEle.styleSheet || styleEle.sheet,\r\n\t\t\tcssRules = styleObj.cssRules || styleObj.rules,\r\n\t\t\tcssRule = null, found = false;\r\n\t\t\tcssName = '.' + cssName;\r\n\t\tfor(var i = 0, len = cssRules.length; i < len; i++) {\r\n\t\t\tcssRule = cssRules[i];\r\n\t\t\tif(cssRule.selectorText == cssName) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tcssRule.style.width = width + 'px';\r\n\t\t}\r\n\t\treturn found;\r\n\t},\r\n\r\n\t_changeColWidth: function(index, deltaW) {\r\n\t\tvar Z = this,\r\n\t\t\tcolObj = Z.innerColumns[index];\r\n\t\tif (colObj.width + deltaW <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolObj.width += deltaW;\r\n\t\tif(colObj.field) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.getField(colObj.field).displayWidth(Math.round(colObj.width/Z.charWidth));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._changeColWidthCssRule(colObj.widthCssName, colObj.width)) {\r\n\t\t\tZ._changeContentWidth(deltaW);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshSeqColWidth: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._hasSeqCol) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldSeqColWidth = Z.seqColWidth;\r\n\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth;\r\n\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\tif(Z.seqColWidth == oldSeqColWidth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\tif(colObj.isSeqCol) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcolObj.width = Z.seqColWidth;\r\n\t\tZ._changeColWidthCssRule(colObj.widthCssName, Z.seqColWidth);\r\n\t\tvar deltaW = Z.seqColWidth - oldSeqColWidth;\r\n\t\tZ._changeContentWidth(deltaW, true);\r\n\t},\r\n\r\n\t_changeContentWidth: function(deltaW, isLeft) {\r\n\t\tvar Z = this,\r\n\t\t\ttotalWidth = Z.getTotalWidth(isLeft),\r\n\t\t\ttotalWidthStr = totalWidth + 'px';\r\n\t\tif(!isLeft) {\r\n\t\t\tZ.rightHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ.rightFootTbl.style.width = totalWidthStr;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = totalWidth;\r\n\t\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 1 + 'px';\r\n\t\t\tZ.leftHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t}\r\n\t\tZ._checkHoriOverflow();\r\n\t},\r\n\r\n\t_createFrame: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.el.style.position = 'relative';\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-table')) {\r\n\t\t\tjqEl.addClass('jl-table jl-border-box jl-round5');\r\n\t\t}\r\n\t\tif(Z._noborder) {\r\n\t\t\tjqEl.addClass('jl-tbl-noborder');\r\n\t\t}\r\n\t\t\r\n\t\tfunction generateWidthStyle() {\r\n\t\t\tvar colObj, cssName, i, len,\r\n\t\t\t\tstyleHtml = ['<style type=\"text/css\" id=\"' + Z._widthStyleId + '\">\\n'];\r\n\t\t\tfor(i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tfor(i = 0, len = Z.innerColumns.length; i< len; i++) {\r\n\t\t\t\tcolObj = Z.innerColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tstyleHtml.push('</style>');\r\n\t\t\treturn styleHtml.join('');\r\n\t\t}\r\n\t\t\r\n\t\tvar dbtableframe = [\r\n\t\t\t'<div class=\"jl-tbl-splitter\" style=\"display: none\"></div>',\r\n\t\t\tgenerateWidthStyle(),\r\n\t\t\t'<div class=\"jl-tbl-norecord\">',\r\n\t\t\tjsletlocale.DBTable.norecord,\r\n\t\t\t'</div>',\r\n\t\t\t'<table class=\"jl-tbl-container\"><tr>',\r\n\t\t\t'<td><div class=\"jl-tbl-fixedcol\"><table class=\"jl-tbl-data\"><tbody /></table><table class=\"jl-tbl-data\"><tbody /></table><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data\"><tbody /></table><table><tbody /></table></div></div></td>',\r\n\t\t\t'<td><div class=\"jl-tbl-contentcol\"><div><table class=\"jl-tbl-data jl-tbl-content-table\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody /></table></div><div><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table></div><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table><table class=\"jl-tbl-content-table jl-tbl-footer\"><tbody /></table></div></div></td>',\r\n\t\t\t'<td class=\"jl-scrollbar-col\"><div class=\"jl-tbl-vscroll-head\"></div><div class=\"jl-tbl-vscroll\"><div /></div></td></tr></table>'];\r\n\t\t\r\n\t\tjqEl.html(dbtableframe.join(''));\r\n\r\n\t\tvar children = jqEl.find('.jl-tbl-fixedcol')[0].childNodes;\r\n\t\tZ.leftHeadTbl = children[0];\r\n\t\tZ.leftFixedTbl = children[1];\r\n\t\tZ.leftContentTbl = children[2].firstChild;\r\n\t\tZ.leftFootTbl = children[2].children[1];\r\n\t\t\r\n\t\tchildren = jqEl.find('.jl-tbl-contentcol')[0].childNodes;\r\n\t\tZ.rightHeadTbl = children[0].firstChild;\r\n\t\tZ.rightFixedTbl = children[1].firstChild;\r\n\t\tZ.rightContentTbl = children[2].firstChild;\r\n\t\tZ.rightFootTbl = children[2].children[1];\r\n\r\n\t\tZ.height = jqEl.height();\r\n\t\tif(Z.height <= 1 && !Z._autoStretch) {\r\n\t\t\tZ.height = 200;\r\n\t\t\tjqEl.height(200);\r\n\t\t}\r\n\t\tif (Z._hideHead) {\r\n\t\t\tZ.leftHeadTbl.style.display = 'none';\r\n\t\t\tZ.rightHeadTbl.style.display = 'none';\r\n\t\t\tjqEl.find('.jl-tbl-vscroll-head').css('display', 'none');\r\n\t\t}\r\n\t\tif (Z._fixedRows <= 0) {\r\n\t\t\tZ.leftFixedTbl.style.display = 'none';\r\n\t\t\tZ.rightFixedTbl.style.display = 'none';\r\n\t\t}\r\n\t\tif (!Z.footSectionHt) {\r\n\t\t\tZ.leftFootTbl.style.display = 'none';\r\n\t\t\tZ.rightFootTbl.style.display = 'none';\r\n\t\t}\r\n\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 'px';\r\n\t\t\r\n\t\tvar jqRightHead = jQuery(Z.rightHeadTbl);\r\n\t\tjqRightHead.off();\r\n\t\tvar x = jqRightHead.on('mousedown', Z._doSplitHookDown);\r\n\t\tvar y = jqRightHead.on('mouseup', Z._doSplitHookUp);\r\n\t\t\r\n\t\tjQuery(Z.leftHeadTbl).on('mousedown', '.jl-tbl-header-cell', function(event) {\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mousedown', '.jl-tbl-header-cell', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjQuery(Z.leftHeadTbl).on('mouseup', '.jl-focusable-item', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mouseup', '.jl-focusable-item', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tvar dragTransfer = null;\r\n\t\tjqRightHead.on('dragstart', '.jl-focusable-item', function(event) {\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode.parentNode.parentNode,\r\n\t\t\t\tcolCfg = otd.jsletColCfg,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\ttransfer.effectAllowed = 'link';\r\n\t\t\tdragTransfer = {fieldName: colCfg.field, rowIndex: otd.parentNode.rowIndex, cellIndex: otd.cellIndex};\r\n\t\t\ttransfer.setData('fieldName', colCfg.field); //must has this row otherwise FF does not work.\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction checkDropable(currCell) {\r\n\t\t\tvar colCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\tvar result = (srcRowIndex == currRowIndex && currCellIndex != srcCellIndex);\r\n\t\t\tif(!result) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\tvar\tsrcFldName = dragTransfer.fieldName,\r\n\t\t\t\tcurrFldName = colCfg.field,\r\n\t\t\t\tsrcPFldObj = Z._dataset.getField(srcFldName).parent(),\r\n\t\t\t\tcurrPFldObj = currFldName && Z._dataset.getField(currFldName).parent();\r\n\t\t\tresult = (srcPFldObj === currPFldObj || (currPFldObj && srcPFldObj.name() == currPFldObj.name()));\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t\r\n\t\tjqRightHead.on('dragover', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\r\n\t\tjqRightHead.on('dragenter', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('dragleave', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\treturn  false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('drop', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\tvar currCell = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer,\r\n\t\t\t\tcolCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\t\r\n\t\t\tif(!checkDropable(currCell)) { \r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar destField = this.parentNode.jsletColCfg.field;\r\n\t\t\tif(!destField) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar\tsrcField = dragTransfer.fieldName;\r\n\t\t\tZ._moveColumn(srcRowIndex, srcCellIndex, currCellIndex);\r\n\t    \treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tvar jqLeftFixedTbl = jQuery(Z.leftFixedTbl),\r\n\t\t\tjqRightFixedTbl = jQuery(Z.rightFixedTbl),\r\n\t\t\tjqLeftContentTbl = jQuery(Z.leftContentTbl),\r\n\t\t\tjqRightContentTbl = jQuery(Z.rightContentTbl);\r\n\t\t\r\n\t\tjqLeftFixedTbl.off();\r\n\t\tjqLeftFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\r\n\t\tjqRightFixedTbl.off();\r\n\t\tjqRightFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqRightFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqLeftContentTbl.off();\r\n\t\tjqLeftContentTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftContentTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqRightContentTbl.off();\r\n\t\tjqRightContentTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqRightContentTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tZ.jqVScrollBar = jqEl.find('.jl-tbl-vscroll');\r\n\t\t//The scrollbar width must be set explicitly, otherwise it doesn't work in IE. \r\n\t\tZ.jqVScrollBar.width(jslet.ui.scrollbarSize() + 1);\r\n\t\t\r\n\t\tZ.jqVScrollBar.off().on('scroll', function() {\r\n\t\t\tif (Z._keep_silence_) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._editable && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n\t\t\tvar num = Math.round(this.scrollTop / Z.rowHeight());// + Z._fixedRows;\r\n\t\t\tif (num != Z.listvm.getVisibleStartRow()) {\r\n\t\t\t\tZ._keep_silence_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(num);\r\n\t\t\t\t\tZ._showCurrentRow();\r\n\t\t\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\t\t\tif(cellEditor) {\r\n\t\t\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\tjqEl.find('.jl-tbl-contentcol').off().on('scroll', function() {\r\n\t\t\tif(Z._isCurrCellInView()) {\r\n\t\t\t\t//Avoid focusing the current control\r\n\t\t\t\tjslet.temp.focusing = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ._showCurrentCell();\r\n\t\t\t\t\t\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tjslet.temp.focusing = false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t        \tvar cellEditor = Z.cellEditor();\r\n\t        \tif(cellEditor) {\r\n\t       \t\t\tcellEditor.hideEditor();\r\n\t        \t}\r\n\t\t\t}\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tsplitter._doDragStart = function() {\r\n\t\t\tthis.style.display = 'block';\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tsplitter._doDragging = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar bodyMleft = parseInt(jQuery(document.body).css('margin-left'));\r\n\r\n\t\t\tvar ojslet = splitter.parentNode.jslet;\r\n\t\t\tvar colObj = ojslet.innerColumns[ojslet.currColId];\r\n\t\t\tif (colObj.width + deltaX <= 40) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsplitter.style.left = x - jQuery(splitter.parentNode).offset().left - bodyMleft + 'px';\r\n\t\t};\r\n\r\n\t\tsplitter._doDragEnd = function(oldX, oldY, x, y, deltaX,\r\n\t\t\tdeltaY) {\r\n\t\t\tvar Z = splitter.parentNode.jslet;\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t}\r\n\t\t\tZ._changeColWidth(Z.currColId, deltaX);\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n//\t\t\tif(cellEditor) {\r\n//\t\t\t\tcellEditor.showEditor();\r\n//\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tsplitter._doDragCancel = function() {\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n\t\t};\r\n\r\n\t\tif (Z.footSectionHt) {\r\n\t\t\tZ.leftFootTbl.style.display = '';\r\n\t\t\tZ.rightFootTbl.style.display = '';\r\n\t\t}\r\n\t\tZ._renderHeader();\r\n\t\tif (Z._hideHead) {\r\n\t\t\tZ.headSectionHt = 0;\r\n\t\t} else {\r\n\t\t\tZ.headSectionHt = Z.maxHeadRows * Z.headRowHeight();\r\n\t\t}\r\n\t\tZ._changeContentWidth(0);\r\n\r\n\t\tZ.noRecordDiv = jqEl.find('.jl-tbl-norecord')[0];\r\n\t\tZ.noRecordDiv.style.top = Z.headSectionHt + 'px';\r\n\t\tZ.noRecordDiv.style.left = jqEl.find('.jl-tbl-fixedcol').width() + 5 + 'px';\r\n\t\tjqEl.find('.jl-tbl-vscroll-head').height(Z.headSectionHt + Z.fixedSectionHt);\r\n\t\tZ._renderBody();\r\n\t},\r\n\r\n\t_moveColumn: function(rowIndex, srcCellIndex, destCellIndex) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction moveOneRow(cells, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar cobj, \r\n\t\t\t\tcolNo = 0, \r\n\t\t\t\tsrcCells = [],\r\n\t\t\t\tdestCells = [], i, len;\r\n\t\t\t\r\n\t\t\tfor(i = 0, len = cells.length; i < len; i++) {\r\n\t\t\t\tcobj = cells[i];\r\n\t\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\t\tdestCells.push(cobj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t\t}\r\n\t\t\tvar destCell;\r\n\t\t\tif(srcStart > destStart) {\t\r\n\t\t\t\tdestCell = destCells[0];\r\n\t\t\t\tfor(i = 0, len = srcCells.length; i < len; i++) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertBefore(destCell);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdestCell = destCells[destCells.length - 1];\r\n\t\t\t\tfor(i = srcCells.length; i >= 0; i--) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertAfter(destCell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction moveOneTableColumn(rows, rowIndex, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar rowCnt = rows.length;\r\n\t\t\tif(rowCnt === 0 || rowCnt === rowIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar rowObj, cellCnt;\r\n\t\t\tfor(var i = rowIndex, len = rows.length; i < len; i++) {\r\n\t\t\t\trowObj = rows[i];\r\n\t\t\t\tmoveOneRow(rowObj.cells, srcStart, srcEnd, destStart, destEnd);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar rows = Z.rightHeadTbl.createTHead().rows, cobj,\r\n\t\t\trowObj = rows[rowIndex],\r\n\t\t\tsrcStart = 0,\r\n\t\t\tsrcEnd = 0,\r\n\t\t\tdestStart = 0,\r\n\t\t\tdestEnd = 0, \r\n\t\t\tpreColNo = 0,\r\n\t\t\tcolNo = 0;\r\n\t\t\r\n\t\tfor(var i = 0, len = rowObj.cells.length; i < len; i++) {\r\n\t\t\tcobj = rowObj.cells[i];\r\n\t\t\tpreColNo = colNo; \r\n\t\t\tcolNo += (cobj.colSpan || 1);\r\n\t\t\tif(i === srcCellIndex) {\r\n\t\t\t\tsrcStart = preColNo;\r\n\t\t\t\tsrcEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t\tif(i === destCellIndex) {\r\n\t\t\t\tdestStart = preColNo;\r\n\t\t\t\tdestEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar srcCell = rowObj.cells[srcCellIndex],\r\n\t\t\tdestCell = rowObj.cells[destCellIndex];\r\n\t\tvar srcColCfg = srcCell.jsletColCfg,\r\n\t\t\tdestColCfg = destCell.jsletColCfg,\r\n\t\t\tsrcFldName = srcColCfg.field,\r\n\t\t\tdestFldName = destColCfg.field;\r\n\t\tif(srcFldName && destFldName) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.moveField(srcFldName, destFldName);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar currField = Z.getFieldByColNum(Z._currColNum);\r\n\t\tvar dataRows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tZ._changeColNum(dataRows[0], srcStart, srcEnd, destStart, destEnd);\r\n\t\tvar headRows = Z.rightHeadTbl.createTHead().rows;\r\n\t\tmoveOneTableColumn(headRows, rowIndex, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFixedTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(dataRows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFootTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tZ._dataset.selection.removeAll();\r\n\t\tZ._refreshSelection();\r\n    \tZ.gotoField(currField);\r\n\t},\r\n\t\r\n\t_changeColNum: function(rowObj, srcStart, srcEnd, destStart, destEnd) {\r\n\t\tif(!rowObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar cobj, \r\n\t\t\tcolNo = 0, \r\n\t\t\tsrcCells = [],\r\n\t\t\tdestCells = [],\r\n\t\t\tcells = rowObj.cells, i, len;\r\n\t\t\r\n\t\tfor(i = 0, len = cells.length; i < len; i++) {\r\n\t\t\tcobj = cells[i];\r\n\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\tdestCells.push(cobj);\r\n\t\t\t} else {\r\n\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t}\r\n\t\tvar srcCellLen = srcCells.length,\r\n\t\t\tdestCellLen = destCells.length,\r\n\t\t\tfirstDestColNum= destCells[0].jsletColCfg.colNum,\r\n\t\t\tk = 0, colCfg;\r\n\t\tif(srcStart > destStart) {\r\n\t\t\tfor(i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = firstDestColNum + (k++);\r\n\t\t\t}\r\n\t\t\tfor(i = destStart; i < srcStart; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum + srcCellLen;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar newStart = firstDestColNum - srcCellLen + destCellLen;\r\n\t\t\tfor(i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = newStart + (k++);\r\n\t\t\t}\r\n\t\t\tfor(i = srcEnd + 1; i <= destEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum - srcCellLen;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t_calcAndSetContentHeight: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\r\n\t\tvar rh = Z.rowHeight(), rows;\r\n\t\tif(Z._autoStretch) {\r\n\t\t\trows = Z._dataset.recordCount() - Z._fixedRows;\r\n\t\t\tif(Z._oldVisibleRows === rows) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._maxVisibleRows > 0 && rows > Z._maxVisibleRows) {\r\n\t\t\t\trows = Z._maxVisibleRows;\r\n\t\t\t}\r\n\t\t\tif(rows < Z._minVisibleRows) {\r\n\t\t\t\trows = Z._minVisibleRows;\r\n\t\t\t}\r\n\t\t\tZ.contentSectionHt = rh * rows + Z.footSectionHt;\r\n\t\t\tZ._repairHeight = 0;\r\n\t\t\tZ._oldVisibleRows = rows;\r\n\t\t\tZ.listvm.setVisibleCount(rows, true);\r\n\t\t} else {\r\n\t\t\tZ.contentSectionHt = Z.height - Z.headSectionHt - Z.fixedSectionHt;\r\n\t\t\tif (Z._isHoriOverflow) {\r\n\t\t\t\tZ.contentSectionHt -= jslet.ui.htmlclass.TABLECLASS.scrollBarWidth;\r\n\t\t\t}\r\n\t\t\trows = Math.floor((Z.contentSectionHt - Z.footSectionHt) / rh);\r\n\t\t\tZ.listvm.setVisibleCount(rows, true);\r\n\t\t\tZ._repairHeight = Z.contentSectionHt - rows * rh;\r\n\t\t}\r\n\t\t\r\n\t\t//jqEl.find('.jl-tbl-contentcol').height(Z.height);\r\n\t\tjqEl.find('.jl-tbl-content-div').height(Z.contentSectionHt);\r\n\r\n\t\tZ.jqVScrollBar.height(Z.contentSectionHt);\r\n\t\tZ._setScrollBarMaxValue(Z.listvm.getNeedShowRowCount() * rh);\r\n\t},\r\n\t\r\n\t_stretchContentHeight: function() {\r\n\t\tif(!this._autoStretch) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._calcAndSetContentHeight();\r\n\t\tthis._stretchContentRow();\r\n\t},\r\n\r\n\t_checkHoriOverflow: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcontentWidth = Z.getTotalWidth();\r\n\r\n\t\tif(Z._hideHead) {\r\n\t\t\tZ._isHoriOverflow = contentWidth > jQuery(Z.rightContentTbl.parentNode.parentNode).innerWidth();\r\n\t\t} else {\r\n\t\t\tZ._isHoriOverflow = contentWidth > Z.rightHeadTbl.parentNode.parentNode.clientWidth;\r\n\t\t}\r\n\t\tZ._calcAndSetContentHeight();\r\n\t},\r\n\t\r\n\t_refreshHeadCell: function(fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), oth = null, cobj;\r\n\t\tjqEl.find('.jl-tbl-header-cell').each(function(index, value) {\r\n\t\t\tcobj = this.jsletColCfg;\r\n\t\t\tif(cobj && cobj.field == fldName) {\r\n\t\t\t\toth = this;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!oth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\tcobj.label = fldObj.displayLabel();\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tochild.html('');\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field && Z._isCellEditable(cobj)) {\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tjQuery(oth).find('.jl-focusable-item').html(sh);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeadCell: function(otr, cobj) {\r\n\t\tvar Z = this,\r\n\t\t\trowSpan = 0, colSpan = 0;\r\n\t\t\r\n\t\tif (!cobj.subHeads) {\r\n\t\t\trowSpan = Z.maxHeadRows - (cobj.level ? cobj.level: 0);\r\n\t\t} else {\r\n\t\t\tcolSpan = cobj.colSpan;\r\n\t\t}\r\n\t\tvar oth = document.createElement('th');\r\n\t\toth.className = 'jl-tbl-header-cell jl-unselectable';\r\n\t\toth.noWrap = true;\r\n\t\toth.jsletColCfg = cobj;\r\n\t\tif (rowSpan && rowSpan > 1) {\r\n\t\t\toth.rowSpan = rowSpan;\r\n\t\t}\r\n\t\tif (colSpan && colSpan > 1) {\r\n\t\t\toth.colSpan = colSpan;\r\n\t\t}\r\n\t\toth.innerHTML = '<div style=\"position: relative\" unselectable=\"on\" class=\"jl-unselectable jl-tbl-header-div jl-border-box ' + \r\n\t\t\t(cobj.widthCssName || '') +'\">';\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tochild.innerHTML = [\r\n\t\t\t    Z._hasFilterDialog && cobj.field && !cobj.subHeads && !cobj.disableFilter? '<button class=\"jl-tbl-filter\" jsletfilterfield=\"' + cobj.field + \r\n\t\t\t    \t\t'\"><i class=\"fa fa-filter\"></i></button>': '',\r\n\t\t\t    '<span id=\"',\r\n\t\t\t\tcobj.id, \r\n\t\t\t\t'\" unselectable=\"on\" style=\"width:100%;padding:0px 2px\">',\r\n\t\t\t\t((!Z._disableHeadSort && !cobj.disableHeadSort) ? '<span class=\"jl-focusable-item\" draggable=\"true\">' + sh +'</span>': sh),\r\n\t\t\t\t'</span><span unselectable=\"on\" class=\"jl-tbl-sorter\" title=\"',\r\n\t\t\t\tjsletlocale.DBTable.sorttitle,\r\n\t\t\t\t'\">&nbsp;</span><div  unselectable=\"on\" class=\"jl-tbl-splitter-hook\" colid=\"',\r\n\t\t\t\tcobj.colNum,\r\n\t\t\t\t'\">&nbsp;</div>'].join('');\r\n\t\t}\r\n\t\totr.appendChild(oth);\t\r\n\t}, // end _createHeadCell\r\n\r\n\t_renderHeader: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar otr, otrLeft = null, cobj, otrRight, otd, oth, i, cnt,\r\n\t\t\tleftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead();\r\n\t\tfor(i = 0; i < Z.maxHeadRows; i++) {\r\n\t\t\tleftHeadObj.insertRow(-1);\r\n\t\t\trightHeadObj.insertRow(-1);\r\n\t\t}\r\n\t\totr = leftHeadObj.rows[0];\r\n\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\tcobj = Z._sysColumns[i];\r\n\t\t\tcobj.rowSpan = Z.maxHeadRows;\r\n\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t}\r\n\t\tfunction travHead(arrHeadCfg) {\r\n\t\t\tvar cobj, otr;\r\n\t\t\tfor(var m = 0, ccnt = arrHeadCfg.length; m < ccnt; m++) {\r\n\t\t\t\tcobj = arrHeadCfg[m];\r\n\t\t\t\tif (cobj.colNum < Z._fixedCols) {\r\n\t\t\t\t\totr = leftHeadObj.rows[cobj.level];\r\n\t\t\t\t} else {\r\n\t\t\t\t\totr = rightHeadObj.rows[cobj.level];\r\n\t\t\t\t}\r\n\t\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t\t\tif (cobj.subHeads) {\r\n\t\t\t\t\ttravHead(cobj.subHeads);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttravHead(Z.innerHeads);\r\n\t\tvar jqTr1, jqTr2, h= Z.headRowHeight();\r\n\t\tfor(i = 0; i <= Z.maxHeadRows; i++) {\r\n\t\t\tjqTr1 = jQuery(leftHeadObj.rows[i]);\r\n\t\t\tjqTr2 = jQuery(rightHeadObj.rows[i]);\r\n\t\t\tjqTr1.height(h);\r\n\t\t\tjqTr2.height(h);\r\n\t\t}\r\n\t\tZ.sortedCell = null;\r\n\t\tZ.indexField = null;\r\n\t}, // end renderHead\r\n\r\n\tgetTotalWidth: function(isLeft) {\r\n\t\tvar Z= this,\r\n\t\t\ttotalWidth = 0, i, cnt;\r\n\t\tif(!isLeft) {\r\n\t\t\tfor(i = Z._fixedCols, cnt = Z.innerColumns.length; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z._sysColumns[i].width;\r\n\t\t\t}\r\n\t\t\tfor(i = 0, cnt = Z._fixedCols; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\r\n\t_doSplitHookDown: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target;\r\n\t\tif (ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function(el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\t\tvar jqTblContainer = jQuery(tblContainer),\r\n\t\t\tjqBody = jQuery(document.body), \r\n\t\t\tbodyMTop = parseInt(jqBody.css('margin-top')),\r\n\t\t\tbodyMleft = parseInt(jqBody.css('margin-left')),\r\n\t\t\ty = jqTblContainer.position().top - bodyMTop,\r\n\t\t\tjqHook = jQuery(ohook),\r\n\t\t\th = jqTblContainer.height() - 20,\r\n\t\t\tcurrLeft = jqHook.offset().left - jqTblContainer.offset().left - bodyMleft,\r\n\t\t\tsplitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tsplitDiv.style.left = currLeft + 'px';\r\n\t\tsplitDiv.style.top = '1px';\r\n\t\tsplitDiv.style.height = h + 'px';\r\n\t\tjslet.ui.dnd.bindControl(splitDiv);\r\n\t\ttblContainer.jslet.currColId = parseInt(jqHook.attr('colid'));\r\n\t\ttblContainer.jslet.isDraggingColumn = true;\r\n\t},\r\n\r\n\t_doSplitHookUp: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target.lastChild;\r\n\t\tif (!ohook || ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function(el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\r\n\t\tvar jqTblContainer = jQuery(tblContainer),\r\n\t\t\tjqBody = jQuery(document.body); \r\n\t\tjqBody.css('cursor','auto');\r\n\r\n\t\tvar splitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tif (splitDiv.style.display != 'none') {\r\n\t\t\tsplitDiv.style.display = 'none';\r\n\t\t}\r\n\t\ttblContainer.jslet.isDraggingColumn = false;\r\n\t},\r\n\r\n\t_getColumnByField: function(fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.innerColumns) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar cobj;\r\n\t\tfor (var i = 0, cnt = Z.innerColumns.length; i < cnt; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\t\t\tif (cobj.field == fieldName) {\r\n\t\t\t\treturn cobj;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_doHeadClick: function(colCfg, ctrlKeyPressed) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._disableHeadSort || colCfg.disableHeadSort || Z.isDraggingColumn) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._doSort(colCfg.field, ctrlKeyPressed);\r\n\t}, // end _doHeadClick\r\n\r\n\t_doSort: function(sortField, isMultiSort) {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.confirm();\r\n\t\tZ._dataset.disableControls();\r\n\t\ttry {\r\n\t\t\tZ._dataset.toggleIndexField(sortField, !isMultiSort);\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t} finally {\r\n\t\t\tZ._dataset.enableControls();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateSortFlag: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar sortFields = Z._dataset.mergedIndexFields();\r\n\t\t\r\n\t\tvar leftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead(),\r\n\t\t\tleftHeadCells, rightHeadCells,\r\n\t\t\tallHeadCells = [], oth, i, cnt, r,\r\n\t\t\trowCnt = leftHeadObj.rows.length;\r\n\t\tfor(r = 0; r < rowCnt; r++) {\r\n\t\t\tleftHeadCells = leftHeadObj.rows[r].cells;\r\n\t\t\tfor (i = 0, cnt = leftHeadCells.length; i < cnt; i++) {\r\n\t\t\t\toth = leftHeadCells[i];\r\n\t\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(r = 0; r < rowCnt; r++) {\r\n\t\t\trightHeadCells =  rightHeadObj.rows[r].cells;\r\n\t\t\tfor (i = 0, cnt = rightHeadCells.length; i < cnt; i++) {\r\n\t\t\t\toth = rightHeadCells[i];\r\n\t\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sortDiv, \r\n\t\t\tcellCnt = allHeadCells.length;\r\n\t\tfor (i = 0; i < cellCnt; i++) {\r\n\t\t\toth = allHeadCells[i];\r\n\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\tif (sortDiv) {\r\n\t\t\t\tsortDiv.innerHTML = '&nbsp;';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, sortFlag, sortObj, \r\n\t\t\tk = 1,\r\n\t\t\tlen = sortFields.length;\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tsortObj = sortFields[i];\r\n\t\t\tfor (var j = 0; j < cellCnt; j++) {\r\n\t\t\t\toth = allHeadCells[j];\r\n\t\t\t\tfldName = oth.jsletColCfg.field;\r\n\t\t\t\tif (!fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\t\tsortFlag = '&nbsp;';\r\n\t\t\t\tif (fldName == sortObj.fieldName) {\r\n\t\t\t\t\tsortFlag = sortObj.order === 1 ? '<i class=\"fa fa-arrow-up\"></i>' : '<i class=\"fa fa-arrow-down\"></i>';\r\n\t\t\t\t\tif (len > 1) {\r\n\t\t\t\t\t\tsortFlag += k++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsortDiv.innerHTML = sortFlag;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_doSelectBoxClick: function(event) {\r\n\t\tvar ocheck = null;\r\n\t\tif (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tocheck = event.target;\r\n\t\t} else {\r\n\t\t\tocheck = this;\r\n\t\t}\r\n\t\tvar otr = jslet.ui.getParentElement(ocheck, 2);\r\n\t\ttry {\r\n\t\t\tjQuery(otr).click();// tr click\r\n\t\t} finally {\r\n\t\t\tvar otable = jslet.ui.findFirstParent(otr, function(node) {\r\n\t\t\t\treturn node.jslet? true: false;\r\n\t\t\t});\r\n\t\t\tvar oJslet = otable.jslet;\r\n\r\n\t\t\tif (oJslet._onSelect) {\r\n\t\t\t\tvar flag = oJslet._onSelect.call(oJslet, ocheck.checked);\r\n\t\t\t\tif (flag !== undefined && !flag) {\r\n\t\t\t\t\tocheck.checked = !ocheck.checked;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oJslet._beforeSelect) {\r\n\t\t\t\toJslet._beforeSelect.call(oJslet);\r\n\t\t\t}\r\n\t\t\toJslet._dataset.select(ocheck.checked ? 1 : 0, oJslet._selectBy);\r\n\t\t\toJslet._showCurrentCell();\r\n\t\t\tif(oJslet._afterSelect) {\r\n\t\t\t\toJslet._afterSelect.call(oJslet);\r\n\t\t\t}\r\n\t\t}\r\n\t}, // end _doSelectBoxClick\r\n\r\n\t_getTableRow: function(otd, offsetTop) {\r\n\t\tvar otr = otd.parentElement,\r\n\t\t\trowSpan = otd.rowSpan;\r\n\t\tif(rowSpan < 2) {\r\n\t\t\treturn otr;\r\n\t\t}\r\n\t\tvar currIdx = otr.rowIndex;\r\n\t\tvar rows = otr.parentElement.rows;\r\n\t\tvar height = 0;\r\n\t\tfor(var i = currIdx; i < currIdx + rowSpan; i++) {\r\n\t\t\totr = rows[i];\r\n\t\t\theight += otr.offsetHeight;\r\n\t\t\tif(height >= offsetTop) {\r\n\t\t\t\treturn otr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn otr;\r\n\t},\r\n\t\r\n\t_doCellClick: function(otd, offsetTop, event) {\r\n\t\tvar Z = this;\r\n    \tvar colCfg = otd.jsletColCfg;\r\n    \tif(!colCfg) {\r\n    \t\treturn;\r\n    \t}\r\n    \tZ._doRowClick(Z._getTableRow(otd, offsetTop));\r\n\t\tif(colCfg.isSeqCol) { //If the cell is sequence cell, process row selection.\r\n\t\t\tZ._processRowSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t} else {\r\n    \t\tvar colNum = colCfg.colNum;\r\n    \t\tif(colNum !== 0 && !colNum) {\r\n    \t\t\treturn;\r\n    \t\t}\r\n\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n    \t\tZ.currColNum(colNum);\r\n\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t    \tvar cellEditor = Z.cellEditor();\r\n\t    \tif(cellEditor) {\r\n\t    \t\tif(Z._isCellEditable(colCfg)) {\r\n\t    \t\t\tvar fldName = colCfg.field;\r\n\t    \t\t\tcellEditor.showEditor(fldName, otd);\r\n\t    \t\t\tif(colCfg.isBoolColumn) {\r\n\t    \t\t\t\twindow.setTimeout(function() {\r\n\t        \t\t\t\tZ._dataset.setFieldValue(fldName, !Z._dataset.getFieldValue(fldName));\r\n\t    \t\t\t\t}, 5);\r\n\t    \t\t\t}\r\n\t    \t\t} else {\r\n\t    \t\t\tcellEditor.hideEditor();\r\n\t    \t\t}\r\n\t    \t}\r\n\t\t}\r\n\t\tif (Z._onCellClick) {\r\n\t\t\tZ._onCellClick.call(Z, otd);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDblCellClick: function(otd, offsetTop) {\r\n    \tthis._doRowDblClick(this._getTableRow(otd, offsetTop));\r\n\t},\r\n\r\n\t_doRowDblClick: function(otr) {\r\n\t\tif(!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._onRowDblClick) {\r\n\t\t\tthis._onRowDblClick.call(this, otr);\r\n\t\t}\r\n\t},\r\n\r\n\t_doRowClick: function(otr) {\r\n\t\tif(!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z.dataset(),\r\n\t\t\totrRecno = otr.jsletrecno; \r\n\t\tif(otrRecno !== dsObj.recno()) {\r\n\t\t\tif(dsObj.status()) {\r\n\t\t\t\tdsObj.confirm();\r\n\t\t\t}\r\n\t\r\n\t\t\tvar rowno = Z.listvm.recnoToRowno(otrRecno);\r\n\t\t\tZ.listvm.setCurrentRowno(rowno);\r\n\t\t\tdsObj.recno(Z.listvm.getCurrentRecno());\r\n\t\t}\r\n\t\tif (Z._onRowClick) {\r\n\t\t\tZ._onRowClick.call(Z, otr);\r\n\t\t}\r\n\t},\r\n\r\n\t_renderCell: function(otr, colCfg, isFirstCol) {\r\n\t\tvar Z = this;\r\n\t\tvar otd = document.createElement('td');\r\n\t\totd.noWrap = true;\r\n\t\totd.jsletColCfg = colCfg;\r\n\t\tjQuery(otd).addClass('jl-tbl-cell');\r\n\t\totd.innerHTML = '<div class=\"jl-tbl-cell-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\tvar ochild = otd.firstChild;\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createCell) {\r\n\t\t\tcellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t} else if (!Z._isCellEditable(colCfg)) {\r\n\t\t\t\tjslet.ui.table.cellRenders.defaultCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\t\tcolCfg.editable = false;\r\n\t\t} else {\r\n\t\t\tjslet.ui.table.cellRenders.defaultCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\tcolCfg.editable = true;\r\n\t\t}\r\n\t\totr.appendChild(otd);\r\n\t},\r\n\r\n\t_renderRow: function(sectionNum, onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tvar rowCnt = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\tswitch (sectionNum) {\r\n\t\t\tcase 1:\r\n\t\t\t\t{//fixed data\r\n\t\t\t\t\trowCnt = Z._fixedRows;\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\tcase 2:\r\n\t\t\t\t{//data content\r\n\t\t\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tvar otr, oth, colCfg, isfirstCol, \r\n\t\t\tstartRow = 0, j,\r\n\t\t\tfldCnt = Z.innerColumns.length;\r\n\t\tif (onlyRefreshContent) {\r\n\t\t\tstartRow = rightBody.rows.length;\r\n\t\t}\r\n\t\tvar rh = Z.rowHeight();\r\n\t\t// create date content table row\r\n\t\tfor (var i = startRow; i < rowCnt; i++) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\t\totr.style.height = rh + 'px';\r\n\r\n\t\t\t\tvar sysColLen = Z._sysColumns.length;\r\n\t\t\t\tfor(j = 0; j < sysColLen; j++) {\r\n\t\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, j === 0);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tisfirstCol = sysColLen === 0;\r\n\t\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, isfirstCol && j === 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisfirstCol = !hasLeft;\r\n\t\t\totr = rightBody.insertRow(-1);\r\n\t\t\totr.style.height = rh + 'px';\r\n\t\t\tfor (j = Z._fixedCols; j < fldCnt; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\tZ._renderCell(otr, colCfg, j == Z._fixedCols);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_stretchContentRow: function() {\r\n\t\tvar Z = this;\r\n\t\tvar visibleRowCnt = Z.listvm.getVisibleCount() - Z._fixedRows, \r\n\t\t\tleftBody = null, leftRows = null,\r\n\t\t\trightBody, rightRows,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\r\n\t\tif (hasLeft) {\r\n\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\tleftRows = leftBody.rows;\r\n\t\t}\r\n\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\trightRows = rightBody.rows;\r\n\t\tvar i, oldRowCount = rightRows.length;\r\n\t\t//Hide the extra rows\r\n\t\tfor(i = visibleRowCnt; i < oldRowCount; i++) {\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tleftRows[i].style.display = 'none';\r\n\t\t\t}\r\n\t\t\trightRows[i].style.display = 'none';\r\n\t\t}\r\n\t\t\r\n\t\tvar otr, colCfg, isfirstCol, j,\r\n\t\t\tfldCnt = Z.innerColumns.length,\r\n\t\t\trh = Z.rowHeight();\r\n\t\t// create date content table row\r\n\t\tfor (i = 0; i < visibleRowCnt; i++) {\r\n\t\t\tif (i < oldRowCount) {\r\n\t\t\t\tif(hasLeft) {\r\n\t\t\t\t\tleftRows[i].style.display = 'table-row';\r\n\t\t\t\t}\r\n\t\t\t\trightRows[i].style.display = 'table-row';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\t\totr.style.height = rh + 'px';\r\n\r\n\t\t\t\tvar sysColLen = Z._sysColumns.length;\r\n\t\t\t\tfor(j = 0; j < sysColLen; j++) {\r\n\t\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, j === 0);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tisfirstCol = sysColLen === 0;\r\n\t\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, isfirstCol && j === 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisfirstCol = !hasLeft;\r\n\t\t\totr = rightBody.insertRow(-1);\r\n\t\t\totr.style.height = rh + 'px';\r\n\t\t\tfor (j = Z._fixedCols; j < fldCnt; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\tZ._renderCell(otr, colCfg, j == Z._fixedCols);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_renderBody: function(onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tif (onlyRefreshContent) {\r\n\t\t\tZ._renderRow(2, true);\r\n\t\t} else {\r\n\t\t\tZ._renderRow(1);\r\n\t\t\tZ._renderRow(2);\r\n\t\t\tZ._renderTotalSection();\r\n\t\t}\r\n\t}, // end _renderBody\r\n\r\n\t_renderTotalSection: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.footSectionHt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar hasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tleftBody,\r\n\t\t\trightBody,\r\n\t\t\totr, colCfg, j, len;\r\n\t\tif (hasLeft) {\r\n\t\t\tleftBody = Z.leftFootTbl.tBodies[0];\r\n\t\t}\r\n\t\trightBody = Z.rightFootTbl.tBodies[0];\r\n\t\t\r\n\t\tfunction createCell(colCfg) {\r\n\t\t\tvar otd = document.createElement('td');\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.innerHTML = '<div class=\"jl-tbl-footer-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\t\totd.jsletColCfg = colCfg;\r\n\t\t\treturn otd;\r\n\t\t}\r\n\t\t\r\n\t\tif (hasLeft) {\r\n\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\totr.style.height = Z.footerRowHeight() + 'px';\r\n\r\n\t\t\tfor(j = 0, len = Z._sysColumns.length; j < len; j++) {\r\n\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t}\r\n\t\totr = rightBody.insertRow(-1);\r\n\t\totr.style.height = Z.footerRowHeight() + 'px';\r\n\t\tfor (j = Z._fixedCols, len = Z.innerColumns.length; j < len; j++) {\r\n\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillTotalSection: function() {\r\n\t\tvar Z = this,\r\n\t\t\taggregateValues = Z._dataset.aggregatedValues();\r\n\t\tif (!Z.footSectionHt || !aggregateValues) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar sysColCnt = Z._sysColumns.length,\r\n\t\t\thasLeft = Z._fixedCols > 0 || sysColCnt > 0,\r\n\t\t\totrLeft, otrRight;\r\n\t\tif (hasLeft) {\r\n\t\t\totrLeft = Z.leftFootTbl.tBodies[0].rows[0];\r\n\t\t}\r\n\t\totrRight = Z.rightFootTbl.tBodies[0].rows[0];\r\n\r\n\t\tvar otd, k = 0, fldObj, cobj, fldName, totalValue;\r\n\t\tvar aggregateValueObj,\r\n\t\t\tlabelDisplayed = false,\r\n\t\t\tcanShowLabel = true;\r\n\t\tif(sysColCnt > 0) {\r\n\t\t\totd = otrLeft.cells[sysColCnt - 1];\r\n\t\t\totd.innerHTML = jsletlocale.DBTable.totalLabel;\r\n\t\t\tcanShowLabel = false;\r\n\t\t}\r\n\t\tvar colNum;\r\n\t\tfor (var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\t\t\tcolNum = cobj.colNum;\r\n\t\t\tif (colNum < Z._fixedCols) {\r\n\t\t\t\totd = otrLeft.cells[colNum + sysColCnt];\r\n\t\t\t} else {\r\n\t\t\t\totd = otrRight.cells[colNum - Z._fixedCols];\r\n\t\t\t}\r\n\t\t\totd.style.textAlign = 'right';\r\n\r\n\t\t\tfldName = cobj.field;\r\n\t\t\taggregateValueObj = aggregateValues[fldName];\r\n\t\t\tif (!aggregateValueObj) {\r\n\t\t\t\tif(canShowLabel) {\r\n\t\t\t\t\tvar content;\r\n\t\t\t\t\tif(labelDisplayed) {\r\n\t\t\t\t\t\tcontent = '&nbsp;';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontent = jsletlocale.DBTable.totalLabel;\r\n\t\t\t\t\t\tlabelDisplayed = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\totd.firstChild.innerHTML = content;\r\n\t\t\t\t\totd.firstChild.title = '';\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcanShowLabel = false;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\ttotalValue = aggregateValueObj.sum;\r\n\t\t\t} else {\r\n\t\t\t\ttotalValue = aggregateValueObj.count;\r\n\t\t\t}\r\n\t\t\tif(!totalValue) {\r\n\t\t\t\totd.firstChild.innerHTML = '&nbsp;';\r\n\t\t\t\totd.firstChild.title = '';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar dispFmt = fldObj.displayFormat();\r\n\t\t\tvar displayValue = totalValue;\r\n\t\t\tif(dispFmt && fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\tdisplayValue = totalValue? jslet.formatNumber(totalValue, dispFmt) : '';\r\n\t\t\t}\r\n\t\t\totd.firstChild.innerHTML = displayValue;\r\n\t\t\totd.firstChild.title = displayValue;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillData: function() {\r\n\t\tvar Z = this;\r\n\t\tvar preRecno = Z._dataset.recno(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\th = allCnt * Z.rowHeight();\r\n\t\tZ._setScrollBarMaxValue(h);\r\n\t\tvar noRecord = Z.dataset().recordCount() === 0;\r\n\t\tZ.noRecordDiv.style.display = (noRecord ?'block':'none');\r\n\t\tvar oldRecno = Z._dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tZ._fillRow(true);\r\n\t\t\tZ._fillRow(false);\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ._fillTotalSection();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ._refreshSeqColWidth();\r\n\t\tif(Z._cellEditor && noRecord) {\r\n\t\t\tZ._cellEditor.hideEditor();\r\n\t\t}\r\n\t},\r\n\r\n\t_fillRow: function(isFixed) {\r\n\t\tvar Z = this,\r\n\t\t\trowCnt = 0, start = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\t\t\r\n\t\tif (isFixed) {\r\n\t\t\trowCnt = Z._fixedRows;\r\n\t\t\tstart = -1 * Z._fixedRows;\r\n\t\t\tif (rowCnt === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t} else {\r\n\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\tstart = Z.listvm.getVisibleStartRow();\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t}\r\n\t\t\r\n\t\tvar otr, colCfg, isfirstCol, recNo = -1, cells, clen, otd, j, \r\n\t\t\tfldCnt = Z.innerColumns.length,\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount() - Z.listvm.getVisibleStartRow(),\r\n\t\t\tfixedRows = hasLeft ? leftBody.rows : null,\r\n\t\t\tcontentRows = rightBody.rows,\r\n\t\t\tsameValueNodes = {},\r\n\t\t\tisFirst = true,\r\n\t\t\tactualCnt = Math.min(contentRows.length, rowCnt);\r\n\r\n\t\tfor (var i = 0; i < actualCnt ; i++) {\r\n\t\t\tif (i + (isFixed? start: 0) >= allCnt) {\r\n\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\totr = fixedRows[i];\r\n\t\t\t\t\totr.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\totr = contentRows[i];\r\n\t\t\t\totr.style.display = 'none';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tZ.listvm.setCurrentRowno(i + start, true);\r\n\t\t\trecNo = Z.listvm.getCurrentRecno();\r\n\t\t\tZ._dataset.recnoSilence(recNo);\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = fixedRows[i];\r\n\t\t\t\totr.jsletrecno = recNo;\r\n\t\t\t\totr.style.display = '';\r\n\t\t\t\tif (Z._onFillRow) {\r\n\t\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t\t}\r\n\t\t\t\tcells = otr.childNodes;\r\n\t\t\t\tclen = cells.length;\r\n\t\t\t\tfor (j = 0; j < clen; j++) {\r\n\t\t\t\t\totd = cells[j];\r\n\t\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\totr = contentRows[i];\r\n\t\t\totr.jsletrecno = recNo;\r\n\t\t\totr.style.display = '';\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\t// fill content table\r\n\t\t\totr = contentRows[i];\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\tclen = cells.length;\r\n\t\t\tfor (j = 0; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t} //end for data content field\r\n\t\t\tisFirst = 0;\r\n\t\t} //end for records\r\n\t\tZ.listvm.setCurrentRowno(0, true);\r\n\t},\r\n\r\n\t_fillCell: function(recNo, otd, sameValueNodes, isFirst) {\r\n\t\tvar Z = this,\r\n\t\t\tcolCfg = otd.jsletColCfg;\r\n\t\tif (!colCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldName = colCfg.field,\r\n\t\t\tcellPanel = otd.firstChild,\r\n\t\t\tjqTd;\r\n\t\t\r\n\t\tif (Z._onFillCell) {\r\n\t\t\tZ._onFillCell.call(Z, cellPanel, Z._dataset, fldName);\r\n\t\t}\r\n\t\tif (fldName && colCfg.mergeSame && sameValueNodes) {\r\n\t\t\tif (isFirst || !Z._dataset.isSameAsPrevious(fldName)) {\r\n\t\t\t\tsameValueNodes[fldName] = { cell: otd, count: 1 };\r\n\t\t\t\tjqTd = jQuery(otd);\r\n\t\t\t\tjqTd.attr('rowspan', 1);\r\n\t\t\t\tif(Z._editable) {\r\n\t\t\t\t\tvar offset = jqTd.offset();\r\n\t\t\t\t\tjqTd.attr('jsletFirstId', null);\r\n\t\t\t\t\tif(!otd.id) {\r\n\t\t\t\t\t\totd.id = jslet.nextId();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\totd.style.display = '';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar sameNode = sameValueNodes[fldName];\r\n\t\t\t\tsameNode.count++;\r\n\t\t\t\totd.style.display = 'none';\r\n\t\t\t\tvar jqFirstTd = jQuery(sameNode.cell);\r\n\t\t\t\tif(Z._editable) {\r\n\t\t\t\t\tjQuery(otd).attr('jsletOffsetHeight', (sameNode.count -1) * Z.rowHeight()).attr('jsletFirstId', jqFirstTd.attr('id'));\r\n\t\t\t\t}\r\n\t\t\t\tjqFirstTd.attr('rowspan', sameNode.count);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.refreshCell) {\r\n\t\t\tcellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t} else {\r\n\t\t\tjslet.ui.table.cellRenders.defaultCellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t}\r\n\t\tif(fldName) {\r\n\t\t\tvar errObj = Z._dataset.getFieldErrorByRecno(recNo, fldName);\r\n\t\t\tjqTd = jQuery(otd);\r\n\t\t\tvar title = cellPanel.title;\r\n\t\t\tif(errObj && errObj.message) {\r\n\t\t\t\tif(!jqTd.hasClass('has-error')) {\r\n\t\t\t\t\tjqTd.addClass('has-error');\r\n\t\t\t\t}\r\n\t\t\t\tcellPanel.title = errObj.message;\r\n\t\t\t} else {\r\n\t\t\t\tif(jqTd.hasClass('has-error')) {\r\n\t\t\t\t\tjqTd.removeClass('has-error');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefreshCurrentRow: function() {\r\n\t\tvar Z = this,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._hasSeqCol || Z._hasSelectCol,\r\n\t\t\tfixedBody = null, contentBody, idx,\r\n\t\t\trecno = Z._dataset.recno();\r\n\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\tidx = recno;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\tidx = Z.listvm.recnoToRowno(Z._dataset.recno()) - Z.listvm.getVisibleStartRow();\r\n\t\t}\r\n\r\n\t\tvar otr, cells, otd, recNo, colCfg, j, clen;\r\n\r\n\t\tif (hasLeft) {\r\n\t\t\totr = fixedBody.rows[idx];\r\n\t\t\tif (!otr) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\trecNo = otr.jsletrecno;\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\tvar ocheck;\r\n\t\t\tfor (j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tcolCfg = otd.jsletColCfg;\r\n\t\t\t\tif (colCfg && colCfg.isSeqCol) {\r\n\t\t\t\t\tcolCfg.cellRender.refreshCell.call(Z, otd.firstChild, colCfg);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (colCfg && colCfg.isSelectCol) {\r\n\t\t\t\t\tocheck = otd.firstChild;\r\n\t\t\t\t\tocheck.checked = Z._dataset.selected();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ._fillCell(recNo, otd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\totr = contentBody.rows[idx];\r\n\t\tif (!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trecNo = otr.jsletrecno;\r\n\t\tif (Z._onFillRow) {\r\n\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t}\r\n\t\t// fill content table\r\n\t\tcells = otr.childNodes;\r\n\t\tfor (j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\totd = cells[j];\r\n\t\t\tZ._fillCell(recNo, otd);\r\n\t\t}\r\n\t},\r\n\r\n\t_getLeftRowByRecno: function(recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\treturn Z.leftFixedTbl.tBodies[0].rows[recno];\r\n\t\t}\r\n\t\tvar rows = Z.leftContentTbl.tBodies[0].rows, row;\r\n\t\tfor (var i = 0, cnt = rows.length; i < cnt; i++) {\r\n\t\t\trow = rows[i];\r\n\t\t\tif (row.jsletrecno == recno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}, // end _getLeftRowByRecno\r\n\r\n\t_showCurrentRow: function(checkVisible) {//Check if current row is in visible area\r\n\t\tvar Z = this,\r\n\t\t\trowno = Z.listvm.recnoToRowno(Z._dataset.recno());\r\n\t\tZ.listvm.setCurrentRowno(rowno, false, checkVisible);\r\n\t\tZ._showCurrentCell();\r\n\t},\r\n\r\n\t_hideCurrentRow: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._currRow) {\r\n\t\t\tif (Z._currRow.fixed) {\r\n\t\t\t\tjQuery(Z._currRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\tjQuery(Z._currRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_getTrByRowno: function(rowno) {\r\n\t\tvar Z = this, \r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tidx, otr, k, rows, row, fixedRow;\r\n\r\n\t\tif (rowno < 0) {//fixed rows\r\n\t\t\trows = Z.rightFixedTbl.tBodies[0].rows;\r\n\t\t\tk = Z._fixedRows + rowno;\r\n\t\t\trow = rows[k];\r\n\t\t\tfixedRow = (hasLeft ? Z.leftFixedTbl.tBodies[0].rows[k] : null);\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\t//data content\r\n\t\trows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tk = rowno - Z.listvm.getVisibleStartRow();\r\n\t\tif (k >= 0) {\r\n\t\t\trow = rows[k];\r\n\t\t\tif (!row) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tfixedRow = hasLeft ? Z.leftContentTbl.tBodies[0].rows[k] : null;\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_getCurrCellEl: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currRow) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar contentRow = Z._currRow.content,\r\n\t\t\tcells = contentRow.cells, \r\n\t\t\tcellEl, colCfg;\r\n\t\tfor(var i = 0, len = cells.length; i < len; i++) {\r\n\t\t\tcellEl = cells[i];\r\n\t\t\tcolCfg = cellEl.jsletColCfg;\r\n\t\t\tif(colCfg && colCfg.colNum === Z._currColNum) {\r\n\t\t\t\treturn cellEl;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_adjustCurrentCellPos: function(isLeft) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currRow) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\toldScrLeft = contentPanel.scrollLeft;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currTd = Z._getCurrCellEl(),\r\n\t\t\tcurrTdLeft = currTd.offsetLeft,\r\n\t\t\tcurrTdWidth = currTd.offsetWidth,\r\n\t\t\tcontainerWidth = contentPanel.clientWidth,\r\n\t\t\tcontainerLeft = contentPanel.scrollLeft;\r\n\t\tif(currTdLeft < containerLeft) {\r\n\t\t\tcontentPanel.scrollLeft = currTdLeft;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(currTdLeft + currTdWidth > containerLeft + containerWidth) {\r\n\t\t\tcontentPanel.scrollLeft = currTdLeft + currTdWidth - containerWidth;\r\n\t\t}\r\n\t},\r\n\r\n\t_isCurrCellInView: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\tborderW = (Z._noborder ? 0: 2),\r\n\t\t\toldScrLeft = contentPanel.scrollLeft,\r\n\t\t\tcurrColLeft = 0, i, len;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tfor(i = Z._fixedCols, len = Z.innerColumns.length; i < Z._currColNum; i++) {\r\n\t\t\tcurrColLeft += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tif(currColLeft < oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\tvar containerWidth = jqContentPanel.innerWidth(),\r\n\t\t\tcontentWidth = jqContentPanel.find('.jl-tbl-content-div').width(),\r\n\t\t\tscrWidth = 0;\r\n\t\tfor(i = Z.innerColumns.length - 1; i > Z._currColNum; i--) {\r\n\t\t\tscrWidth += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tcurrColLeft = contentWidth - scrWidth - containerWidth;\r\n\t\tcurrColLeft = (currColLeft >= 0? currColLeft: 0);\r\n\t\tif(currColLeft > oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_showCurrentCell: function() {\r\n\t\tvar Z = this,\r\n\t\t\trowObj = Z._currRow;\r\n\t\tif(!rowObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar otr;\r\n\t\tif(Z._currColNum >= Z._fixedCols) {\r\n\t\t\totr = rowObj.content;\r\n\t\t} else {\r\n\t\t\totr = rowObj.fixed;\r\n\t\t}\r\n\t\tvar recno = otr.jsletrecno;\r\n    \tvar cellEditor = Z.cellEditor();\r\n\t\tif(recno !== Z._dataset.recno()) {\r\n    \t\tif(Z.prevCell) {\r\n    \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n    \t\t}\r\n        \tif(cellEditor) {\r\n       \t\t\tcellEditor.hideEditor();\r\n        \t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ocells = otr.cells, otd, colCfg, found = false;\r\n\t\tfor(var i = 0, len = ocells.length; i < len; i++) {\r\n\t\t\totd = ocells[i];\r\n        \tcolCfg = otd.jsletColCfg;\r\n        \tif(colCfg && colCfg.colNum == Z._currColNum) {\r\n        \t\tif(Z.prevCell) {\r\n        \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n        \t\t}\r\n        \t\tvar jqCell = jQuery(otd);\r\n        \t\tjqCell.addClass('jl-tbl-curr-cell');\r\n        \t\tZ.prevCell = jqCell;\r\n        \t\tfound = true;\r\n        \t\tbreak;\r\n        \t}\r\n\t\t}\r\n    \tif(cellEditor && found) {\r\n    \t\tif(Z._isCurrCellInView()) {\r\n    \t\t\tcellEditor.showEditor(colCfg.field, otd);\r\n    \t\t} else {\r\n    \t\t\tcellEditor.hideEditor();\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\t\r\n\t_showSelected: function(otd, fldName, recno) {\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(otd);\r\n\t\tif(recno === undefined) {\r\n\t\t\trecno = Z._dataset.recno();\r\n\t\t}\r\n\t\tvar isSelected = Z._dataset.selection.isSelected(recno, fldName);\r\n\t\tif(isSelected) {\r\n\t\t\tjqCell.addClass('jl-tbl-selected');\r\n\t\t} else {\r\n\t\t\tjqCell.removeClass('jl-tbl-selected');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_refreshSelection: function() {\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).find('td.jl-tbl-cell').each(function(k, otd) {\r\n        \tvar colCfg = otd.jsletColCfg;\r\n        \tvar recno = parseInt(otd.parentNode.jsletrecno);\r\n        \tif((recno || recno === 0) && colCfg) {\r\n        \t\tvar fldName = colCfg.field;\r\n        \t\tif(fldName) {\r\n        \t\t\tZ._showSelected(otd, fldName, recno);\r\n        \t\t}\r\n        \t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_syncScrollBar: function(rowno) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tsw = rowno * Z.rowHeight();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar scrBar = Z.jqVScrollBar[0];\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tscrBar.scrollTop = sw;\r\n\t\t\t}, 10);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Toggle(expand/collapse) the current record expanded status, enabled for tree style table.\r\n\t */\r\n\ttoggle: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (expanded) {\r\n\t\t\tZ.listvm.collapse(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ.listvm.expand(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand the current record, enabled for tree style table.\r\n\t */\r\n\texpand: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (!expanded) {\r\n\t\t\tZ.listvm.expand(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse the current record, enabled for tree style table.\r\n\t */\r\n\tcollapse: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (expanded) {\r\n\t\t\tZ.listvm.collapse(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand all records, enabled for tree style table.\r\n\t */\r\n\texpandAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.expandAll(function() {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse all records, enabled for tree style table.\r\n\t */\r\n\tcollapseAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.collapseAll(function() {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_doMetaChanged: function(metaName, fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!fldName) {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(metaName == 'label' && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName == 'required' && Z._editable && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(metaName == 'visible') {\r\n\t\t\t\r\n\t\t}\r\n\t\tif(Z._editable && (metaName == 'readOnly' || metaName == 'disabled')) {\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tvar currFld = cellEditor.currentField();\r\n\t\t\t\tif(currFld == fldName) {\r\n\t\t\t\t\tcellEditor.showEditor(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this, i, cnt, otr, otd, checked, ocheckbox, col, recno,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tZ._doMetaChanged(evt.metaName, evt.fieldName);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.AGGREGATED) {\r\n\t\t\tZ._fillTotalSection();\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.BEFORESCROLL) {\r\n\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tif(!Z.listvm) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._hideCurrentRow();\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\tZ._updateSortFlag(true);\r\n\t\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t}\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.checkFilterBtnStyle();\r\n\t\t\t}\r\n\t\t\t//Clear \"Select all\" checkbox\r\n\t\t\tif(Z._hasSelectCol) {\r\n\t\t\t\tjQuery(Z.el).find('.jl-tbl-select-all')[0].checked = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD) {\r\n\t\t\tvar fldName = evt.fieldName;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.mergeSame()) {\r\n\t\t\t\t\tZ._fillData();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.refreshCurrentRow();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATECOLUMN || evtType == jslet.data.RefreshEvent.UPDATELOOKUP) {\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\trecno = Z._dataset.recno();\r\n\t\t\tvar\tpreRecno = evt.preRecno;\r\n\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(recno, preRecno));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\tZ._fillData();\r\n\t\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcol = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\trecno = evt.recno;\r\n\t\t\tfor(i = 0, cnt = recno.length; i < cnt; i++) {\r\n\t\t\t\totr = Z._getLeftRowByRecno(recno[i]);\r\n\t\t\t\tif (!otr) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\totd = otr.cells[col];\r\n\t\t\t\tchecked = evt.selected ? true : false;\r\n\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcol = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\tvar leftFixedBody = Z.leftFixedTbl.tBodies[0],\r\n\t\t\t\tleftContentBody = Z.leftContentTbl.tBodies[0],\r\n\t\t\t\trec,\r\n\t\t\t\toldRecno = Z._dataset.recno();\r\n\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0, cnt = leftFixedBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftFixedBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = 0, cnt = leftContentBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftContentBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t} //end event selectall\r\n\t}, // refreshControl\r\n\r\n\t_isCellEditable: function(colCfg) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._editable) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Z._editableFields && Z._editableFields.length > 0 && Z._editableFields.indexOf(fldName) < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Z._readOnlyFields && Z._readOnlyFields.length > 0 && Z._readOnlyFields.indexOf(fldName) >=0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fldName),\r\n\t\t\tisEditable = !fldObj.fieldDisabled() && !fldObj.fieldReadOnly() ? 1 : 0;\r\n\t\treturn isEditable;\r\n\t},\r\n\t\r\n\t_doAppendRecord: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onAppendRecord) {\r\n\t\t\tZ._onAppendRecord.call(Z);\r\n\t\t} else {\r\n\t\t\tZ._dataset.appendRecord();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDeleteRecord: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onDeleteRecord) {\r\n\t\t\tZ._onDeleteRecord.call(Z);\r\n\t\t} else {\r\n\t\t\tZ._dataset.deleteRecord();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnewHeight = jqEl.height();\r\n\t\tif (newHeight == Z._oldHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.height = newHeight;\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t_innerDestroy: function() {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._currRow = null;\r\n\t\tZ._oldVisibleRows = -1;\r\n\t\tZ.listvm.reset();\r\n\t\tZ.leftHeadTbl = null;\r\n\t\tZ.rightHeadTbl = null;\r\n\t\tjQuery(Z.rightHeadTbl).off();\r\n\r\n\t\tZ.leftFixedTbl = null;\r\n\t\tZ.rightFixedTbl = null;\r\n\r\n\t\tZ.leftContentTbl = null;\r\n\t\tZ.rightContentTbl = null;\r\n\r\n\t\tZ.leftFootTbl = null;\r\n\t\tZ.rightFootTbl = null;\r\n\t\t\r\n\t\tZ.noRecordDiv = null;\r\n\t\tif(Z.jqVScrollBar) {\r\n\t\t\tZ.jqVScrollBar.off();\r\n\t\t}\r\n\t\tZ.jqVScrollBar = null;\r\n\t\t\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tif(splitter) {\r\n\t\t\tsplitter._doDragging = null;\r\n\t\t\tsplitter._doDragEnd = null;\r\n\t\t\tsplitter._doDragCancel = null;\r\n\t\t}\r\n\t\tZ.parsedHeads = null;\r\n\t\tZ.prevCell = null;\r\n\t\t\r\n\t\tjqEl.find('.jl-tbl-select-check').off();\r\n\t\tif(Z._filterPanel) {\r\n\t\t\tZ._filterPanel.destroy();\r\n\t\t\tZ._filterPanel = null;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._findDialog) {\r\n\t\t\tZ._findDialog.destroy();\r\n\t\t\tZ._findDialog = null;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._cellEditor) {\r\n\t\t\tZ._cellEditor.destroy();\r\n\t\t\tZ._cellEditor = null;\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.off();\r\n\t\tZ._innerDestroy();\r\n\t\tZ.listvm.destroy();\r\n\t\tZ.listvm = null;\r\n\t\t$super();\r\n\t} \r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.AbstractDBTable\r\n * \r\n * DBTable is a powerful control, features: <br />\r\n * <ol>\r\n * <li>\r\n * <dl><dt>Sort Data</dt><dd>Clicking column header text to sort data, SHIFT + Clicking column header text to sort data with multiple columns.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Find Data</dt><dd>Pressing CTRL + F to pop up finding dialog.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Filter Data</dt><dd>Pressing the down-arrow of each column header to pop up filtering dialog.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Copy Data to Clipboard</dt><dd>First select cells(CTRL + A, CTRL/SHIFT + Clicking Cell), pressing CTRL + C to copy data.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Find Error Record</dt><dd>When importing records or batch editing records, press CTRL + E to find the next record existing error.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Multi-Layer Column Header</dt><dd>Set dataset field's property \"children\".</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Change Column Width</dt><dd>Drag and drop column line.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Move Column</dt><dd>Drag and drop column header.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Sequence Column</dt><dd>Set property \"hasSeqCol\" to true to show sequence column; <br />\r\n * Set property \"reverseSeqCol\" to \"true\" to reverse sequence no; <br />\r\n * Set property \"seqColHeader\" to customize sequence header. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Select Column</dt>\r\n * <dd>Set property \"hasSelectCol\" to \"true\" to show select column.<br />\r\n * Clicking \"Select Column\" header to select all records.<br />\r\n * Set property \"selectBy\" to group select records.<br />\r\n * Set dataset event \"onCheckSelectable\" to check which records can be selected. \r\n * </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Action Column</dt><dd>Add a \"ACTION\" type field to dataset. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Edit Action Column</dt><dd>Add a \"EDITACTION\" type field to dataset. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Fixed rows or columns</dt><dd>Set value to properties \"fixedRows\" or \"fixedCols\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support \"Total\" row</dt><dd>Set the dataset field's properties: \"aggregated\" and \"aggregatedBy\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Merge Rows with Same Value</dt><dd>Set the dataset field's properties: \"mergeSame\" and \"mergeSameBy\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Tree-Grid Style</dt><dd>Set property: \"treeField\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>In-cell Edit</dt><dd>Set property: \"editable\" to true. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Customize Table Style</dt><dd>Use: \"noborder\", \"onFillRow\", \"onFillCell\", \"hideHead\" to customize. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Stretch Table Height Automatically</dt><dd>Use: \"autoStretch\", \"minVisibleRows\", \"onFillCell\", \"maxVisibleRows\" to customize. </dd></dl>\r\n * </li>\r\n * </ol>\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBTable\", dataset: \"employee\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DBTable\", dataset: \"employee\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTable = jslet.Class.create(jslet.ui.AbstractDBTable, {});\r\n\r\njslet.ui.register('DBTable', jslet.ui.DBTable);\r\njslet.ui.DBTable.htmlTemplate = '<div></div>';\r\n\r\n/*\r\n* Splitter: used in jslet.ui.DBTable\r\n*/\r\njslet.ui.Splitter = function() {\r\n\tif (!jslet.ui._splitDiv) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\todiv.className = 'jl-split-column';\r\n\t\todiv.style.display = 'none';\r\n\t\tjslet.ui._splitDiv = odiv;\r\n\t\tdocument.body.appendChild(odiv);\r\n\t\todiv = null;\r\n\t}\r\n\t\r\n\tthis.isDragging = false;\r\n\t\r\n\tthis.attach = function(el, left, top, height) {\r\n\t\tif (!height) {\r\n\t\t\theight = jQuery(el).height();\r\n\t\t}\r\n\t\tvar odiv = jslet.ui._splitDiv;\r\n\t\todiv.style.height = height + 'px';\r\n\t\todiv.style.left = left + 'px';\r\n\t\todiv.style.top = top + 'px';\r\n\t\todiv.style.display = 'block';\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis.unattach = function() {\r\n\t\tjslet.ui._splitDiv.style.display = 'none';\r\n\t\tthis.onSplitEnd = null;\r\n\t\tthis.onSplitCancel = null;\r\n\t};\r\n\t\r\n\tthis.onSplitEnd = null;\r\n\tthis.onSplitCancel = null;\r\n\t\r\n\tthis._doDragEnd = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitEnd) {\r\n\t\t\tthis.onSplitEnd(x - oldX);\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis._doDragging = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tthis.isDragging = true;\r\n\t\tjslet.ui._splitDiv.style.left = x + 'px';\r\n\t};\r\n\t\r\n\tthis._doDragCancel = function() {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitCancel) {\r\n\t\t\tthis.onSplitCancel();\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n};\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/*\r\n * Filter panel for DBTable\r\n */\r\njslet.ui.table.DBTableFilterPanel = function(tblCtrl) {\r\n\tvar Z = this;\r\n\tZ._width = 300;\r\n\tZ._height = 150;\r\n\tZ.fieldName = null;\r\n\tZ._filterDatasetObj = new jslet.data.FilterDataset(tblCtrl.dataset());\r\n\tZ._filterDataset = Z._filterDatasetObj.filterDataset();\r\n\tZ._filterDataset.getField('lParenthesis').visible(false);\r\n\tZ._filterDataset.getField('rParenthesis').visible(false);\r\n\tZ._filterDataset.getField('logicalOpr').visible(false);\r\n\tZ._filterDataset.getField('valueExprInput').visible(false);\r\n\tZ._dbtable = tblCtrl;\r\n\tZ._jqFilterBtn = null;\r\n\tZ._currFieldName = null;\r\n\tZ._currFilterExpr = null;\r\n};\r\n\r\njslet.ui.table.DBTableFilterPanel.prototype = {\r\n\t\r\n\tjqFilterBtn: function(jqFilterBtn) {\r\n\t\tthis._jqFilterBtn = jqFilterBtn;\r\n\t},\r\n\t\t\r\n\tchangeField: function(fldName) {\r\n\t\tvar dsFilter = this._filterDataset,\r\n\t\t\tfldObj = dsFilter.getField('field'),\r\n\t\t\tlkDs = fldObj.lookup().dataset();\r\n\t\tdsFilter.cancel();\r\n\t\tlkDs.filter('[name] == \"' + fldName +'\" || like([name],\"'+ fldName + '.%' + '\")');\r\n\t\tlkDs.filtered(true);\r\n\t\tfldObj.visible(lkDs.recordCount() > 1);\r\n\t\tif(!dsFilter.find('[field] == \"' + fldName + '\" || like([field], \"' + fldName + '.%' + '\")')) {\r\n\t\t\tdsFilter.appendRecord();\r\n\t\t\tdsFilter.setFieldValue('field', fldName);\r\n\t\t}\r\n\t\tthis._currFieldName = fldName;\r\n\t},\r\n\t\r\n\tshow: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._panel) {\r\n\t\t\tZ._panel = Z._create();\r\n\t\t}\r\n\t\tZ._panel.style.left = left + 'px';\r\n\t\tZ._panel.style.top = top + 'px';\r\n\t\tjQuery(Z._panel).show('fast');\r\n\t\twindow.setTimeout(function(){\r\n\t\t\tZ._filterDataset.focusEditControl('value');\r\n\t\t},5);\r\n\t},\r\n\r\n\thide: function () {\r\n\t\tthis._filterDataset.cancel();\r\n\t\tjQuery(this._panel).hide('fast');\r\n\t},\r\n\t\r\n\tcancelFilter: function() {\r\n\t\tthis._filterDataset.cancel();\r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._panel) {\r\n\t\t\tZ._panel = document.createElement('div');\r\n\t\t\tZ._dbtable.el.appendChild(Z._panel);\r\n\t\t}\r\n\t\tjQuery(Z._panel).addClass('panel panel-default jl-filter-panel');\r\n\t\tZ._panel.innerHTML = '<div class=\"\"><div data-jslet=\"type: \\'DBEditPanel\\', dataset: \\'' + Z._filterDataset.name() + \r\n\t\t'\\', columnCount: 1,hasLabel:false \" style=\"width:100%;height:100%\" ></div></div>' +\r\n\t\t'<div class=\"jl-filter-panel-toolbar\"><button class=\"btn btn-default btn-sm jl-filter-panel-ok\" tabIndex=\"90990\">' + jsletlocale.FilterPanel.ok +\r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-cancel\" tabIndex=\"90991\">' + jsletlocale.FilterPanel.cancel + \r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-clear\" tabIndex=\"90992\">' + jsletlocale.FilterPanel.clear + \r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-clearall\" tabIndex=\"90993\">' + jsletlocale.FilterPanel.clearAll + \r\n\t\t'</button></div>';\r\n\t\tjslet.ui.install(Z._panel);\r\n\t\tvar jqPanel = jQuery(Z._panel);\r\n\t\tjqPanel.find('.jl-filter-panel-ok').on('click', function(){\r\n\t\t\tvar dsFilter = Z._filterDataset;\r\n\t\t\tdsFilter.confirm();\r\n\t\t\tif(jslet.isEmpty(dsFilter.getFieldValue('value'))) {\r\n\t\t\t\tdsFilter.deleteRecord();\r\n\t\t\t}\r\n\t\t\tvar filter = Z._filterDatasetObj.getFilterExpr();\r\n\t\t\tZ._dbtable.dataset().filter(filter).filtered(true);\r\n\t\t\tZ._currFilterExpr = filter;\r\n\t\t\t\r\n\t\t\tZ.hide();\r\n\t\t\tZ._setFilterBtnStyle();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-cancel').on('click', function(){\r\n\t\t\tZ._filterDataset.cancel();\r\n\t\t\tZ.hide();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-clear').on('click', function(){\r\n\t\t\tZ._filterDataset.deleteRecord();\r\n\t\t\tvar filter = Z._filterDatasetObj.getFilterExpr();\r\n\t\t\tZ._dbtable.dataset().filter(filter).filtered(true);\r\n\t\t\tZ.hide();\r\n\t\t\tZ._currFilterExpr = filter;\r\n\t\t\tZ._setFilterBtnStyle();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-clearall').on('click', function(){\r\n\t\t\tZ._filterDataset.records(null);\r\n\t\t\tZ._dbtable.dataset().filter(null).filtered(false);\r\n\t\t\tZ.hide();\r\n\t\t\tZ._clearFilterBtnStyle();\r\n\t\t});\r\n\t\t//prevent to fire the dbtable's keydown event.\r\n\t\tjqPanel.on('keydown', function(event) {\r\n       \t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\treturn Z._panel;\r\n\t},\r\n\r\n\t_clearFilterBtnStyle: function() {\r\n\t\tvar jqPanel = jQuery(this._panel);\r\n\t\tjQuery(this._dbtable.el).find('.jl-tbl-filter-hasfilter').attr('title', '').removeClass('jl-tbl-filter-hasfilter');\r\n\t\tjqPanel.find('.jl-filter-panel-clearall').attr('title', '');\r\n\t\tthis._currFilterExpr = null;\r\n\t},\r\n\t\r\n\tcheckFilterBtnStyle: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currFilterExpr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsHost = Z._dbtable.dataset(),\r\n\t\t\tdsFilterExpr = dsHost.filter();\r\n\t\tif(dsHost.filtered() && dsFilterExpr == Z._currFilterExpr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._clearFilterBtnStyle();\r\n\t\tvar dsFilter = Z._filterDataset;\r\n\t\tif(!dsFilterExpr || !dsHost.filtered()) {\r\n\t\t\tdsFilter.records(null);\r\n\t\t}\r\n\t\tvar filterText = Z._filterDatasetObj.getFilterExprText();\r\n\t\tjQuery(Z._dbtable.el).find('button.jl-tbl-filter').each(function(){\r\n\t\t\tvar fldName = this.getAttribute('jsletfilterfield');\r\n\t\t\tvar jqFilterBtn = jQuery(this);\r\n\t\t\tif(dsFilter.find('[field] == \"' + fldName + '\" || like([field], \"' + fldName + '.%' + '\")')) {\r\n\t\t\t\tjqFilterBtn.addClass('jl-tbl-filter-hasfilter');\r\n\t\t\t} else {\r\n\t\t\t\tjqFilterBtn.removeClass('jl-tbl-filter-hasfilter');\r\n\t\t\t}\r\n\t\t\tjqFilterBtn.attr('title', filterText || '');\r\n\t\t});\r\n\t\tjQuery(Z._panel).find('.jl-filter-panel-clearall').attr('title', filterText || '');\r\n\t},\r\n\t\r\n\t_setFilterBtnStyle: function() {\r\n\t\tvar Z = this;\r\n\t\tvar filterText = Z._filterDatasetObj.getFilterExprText();\r\n\t\t\r\n\t\tvar dsFilter = Z._filterDataset;\r\n\t\tif(dsFilter.find('[field] == \"' + Z._currFieldName + '\" || like([field], \"' + Z._currFieldName + '.%' + '\")')) {\r\n\t\t\tZ._jqFilterBtn.addClass('jl-tbl-filter-hasfilter');\r\n\t\t} else {\r\n\t\t\tZ._jqFilterBtn.removeClass('jl-tbl-filter-hasfilter');\r\n\t\t}\r\n\t\tZ._jqFilterBtn.attr('title', filterText || '');\r\n\t\tjQuery(Z._dbtable.el).find('.jl-tbl-filter-hasfilter').attr('title', filterText || '');\r\n\t\tjQuery(Z._panel).find('.jl-filter-panel-clearall').attr('title', filterText || '');\r\n\t},\r\n\t\r\n\tdestroy: function(){\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.uninstall(Z._panel);\r\n\t\tZ._panel.innerHTML = '';\r\n\t\tZ._panel = null;\r\n\t\tZ._dbtable = null;\r\n\t\tZ._jqFilterBtn = null;\r\n\t}\r\n};\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/*\r\n * Find dialog for DBTable\r\n */\r\njslet.ui.table.FindDialog = function (dbContainer) {\r\n\tvar _dialog;\r\n\tvar _dataset = dbContainer.dataset();\r\n\tvar _containerEl = dbContainer.el;\r\n\tvar _currfield = null;\r\n\tvar _findingField = null;\r\n\tvar _left = -1;\r\n\tvar _top = -1;\r\n\tfunction initialize() {\r\n\t\tvar opt = { type: 'window', caption: jslet.formatMessage(jsletlocale.findDialog.caption, ['']), isCenter: false, resizable: true, minimizable: false, maximizable: false, \r\n\t\t\t\tstopEventBubbling: true, styleClass: 'jl-finddlg'};\r\n\t\t_dialog = jslet.ui.createControl(opt, _containerEl);\r\n\t\t_dialog.onClosed(function(){\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\t\t\r\n\t\tvar content = '<div class=\"input-group input-group-sm\"><input class=\"form-control jl-finddlg-value\" placeholder=\"' + \r\n\t\tjsletlocale.findDialog.placeholder + '\"/>' + \r\n\t\t'<div class=\"input-group-btn\"><button class=\"btn btn-default jl-finddlg-find\"><i class=\"fa fa-search\" /></button></div></div>';\r\n\t\t\r\n\t\t_dialog.setContent(content);\r\n\t\t_dialog.onPositionChanged(function(left, top) {\r\n\t\t\t_left = (left > 0? left: 0);\r\n\t\t\t_top = (top > 0? top: 0);\r\n\t\t});\r\n\t\tvar dlgEl = _dialog.el;\r\n\r\n\t\tvar jqFindingValue = jQuery(dlgEl).find('.jl-finddlg-value');\r\n\t\tvar isStart = true;\r\n\t\tjqFindingValue.on('keydown', function(event){\r\n\t\t\tif(event.keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\t\tfindData();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tisStart = true;\r\n\t\t});\r\n\t\t\r\n\t\tvar jqFind = jQuery(dlgEl).find('.jl-finddlg-find');\r\n\t\tjqFind.on('click', function(event) {\r\n\t\t\tfindData();\r\n\t\t});\r\n\r\n\t\tfunction findData() {\r\n\t\t\tif(_dataset.recordCount() < 2) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar findingValue = jqFindingValue.val(),\r\n\t\t\t\tcurrRecno = 0;\r\n\t\t\tif(!isStart) {\r\n\t\t\t\tcurrRecno = _dataset.recno() + 1;\r\n\t\t\t}\r\n\t\t\tvar options = {startRecno: currRecno, findingByText: true, matchType: 'any'};\r\n\t\t\tvar found = _dataset.findByField(_findingField, findingValue, options);\r\n\t\t\tisStart = !found;\r\n\t\t\tif(!found) {\r\n\t\t\t\tif(currRecno > 0) { //If not found, find from the first position.\r\n\t\t\t\t\tfindData();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn found;\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.show = function(left, top) {\r\n\t\tif(!_findingField) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(_left >= 0) {\r\n\t\t\tleft = _left;\r\n\t\t}\r\n\t\tif(_top >= 0) {\r\n\t\t\ttop = _top;\r\n\t\t}\r\n\t\tleft = left || 0;\r\n\t\ttop = top || 0;\r\n\t\t_dialog.show(left, top);\r\n\t\tthis.focus();\r\n\t};\r\n\t\r\n\tthis.hide = function() {\r\n\t\t_dialog.hide();\r\n\t};\r\n\t\r\n\tthis.findingField = function(findingField) {\r\n\t\tif(findingField === undefined) {\r\n\t\t\treturn _findingField;\r\n\t\t}\r\n\t\tvar oldField = _findingField;\r\n\t\t_findingField = findingField;\r\n\t\tif(_findingField) {\r\n\t\t\tvar fldObj = _dataset.getField(_findingField);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tvar dataType = fldObj.getType();\r\n\t\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\t\t_findingField = null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t_dialog.changeCaption(jslet.formatMessage(jsletlocale.findDialog.caption, [fldObj.label()]));\r\n\t\t\t\tif(oldField != findingField) {\r\n\t\t\t\t\tjQuery(_dialog.el).find('.jl-finddlg-value').val('');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.focus = function() {\r\n\t\tjQuery(_dialog.el).find('.jl-finddlg-value').focus();\r\n\t};\r\n\t\r\n\tthis.destroy = function() {\r\n\t\t_dialog.destroy();\r\n\t};\r\n\t\r\n\tinitialize();\r\n};\r\n\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBChart, show data as a chart. We use an open source chart component to show chart: EChart(http://echarts.baidu.com/).\r\n * EChart is very powerful, but we implement these usual chart: column, bar, line, area, pie. <br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBChart\", dataset:\"summary\", chartType:\"column\",categoryField:\"month\",valueFields:\"amount\",recordRange: jslet.data.RecordRange.ALL, reverse: false};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DBChart\",chartType:\"column\",categoryField:\"month\",valueFields:\"amount,netProfit\", dataset:\"summary\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.DBChart = jslet.Class.create(jslet.ui.DBControl, {\r\n\tchartTypes: ['line', 'stackline', 'bar', 'stackbar', 'pie'],\r\n\t\r\n\tlegendPositions: ['none', 'top', 'bottom', 'left', 'right'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,chartType,chartTitle,categoryField,valueFields,legendPos,recordRange,reverse';\r\n\t\tZ.requiredProperties = 'valueFields,categoryField';\r\n\t\t\r\n\t\tZ._chartType = \"line\";\r\n\t\t\r\n\t\tZ._categoryField = null;\r\n\t\t\r\n\t\tZ._valueFields = null;\r\n\t\t\r\n\t\tZ._chartTitle = null;\r\n\r\n\t\tZ._legendPos = 'none';\r\n\t\t\r\n\t\tZ._recordRange = jslet.data.RecordRange.ALL;\r\n\t\t\r\n\t\tZ._reverse = false;\r\n\t\t\r\n\t\tZ._fieldValidated = false;\r\n\t\t\r\n\t\tZ._oldHeight = -1;\r\n\t\t\r\n\t\tZ._echart = null;\r\n\t\t\r\n\t\tZ._onSetChartOption = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart type. Optional chart type: line(default), column, bar, area, pie.\r\n\t * \r\n\t * @param {String | undefined} chartType Chart type, optional value: 'line'(default), 'stackline', 'bar', 'stackbar', 'pie'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tchartType: function(chartType) {\r\n\t\tif(chartType === undefined) {\r\n\t\t\treturn this._chartType;\r\n\t\t}\r\n\t\tchartType = jQuery.trim(chartType);\r\n\t\tvar checker = jslet.Checker.test('DBChart.chartType', chartType).isString().required();\r\n\t\tchecker.testValue(chartType.toLowerCase()).inArray(this.chartTypes);\r\n\t\tthis._chartType = chartType;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get category field.\r\n\t * \r\n\t * @param {String | undefined} categoryField Category field.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcategoryField: function(categoryField) {\r\n\t\tif(categoryField === undefined) {\r\n\t\t\treturn this._categoryField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.categoryField', categoryField).isString().required();\r\n\t\tcategoryField = jQuery.trim(categoryField);\r\n\t\tthis._categoryField = categoryField;\r\n\t\tthis._fieldValidated = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get value fields, multiple fields are separated with comma(,).\r\n\t * \r\n\t * @param {String | undefined} valueFields Value fields.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tvalueFields: function(valueFields) {\r\n\t\tif(valueFields === undefined) {\r\n\t\t\treturn this._valueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.valueFields', valueFields).isString().required();\r\n\t\tvalueFields = jQuery.trim(valueFields);\r\n\t\tthis._valueFields = valueFields.split(',');\r\n\t\tthis._fieldValidated = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart title.\r\n\t * \r\n\t * @param {String | undefined} chartTitle Chart title.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tchartTitle: function(chartTitle) {\r\n\t\tif(chartTitle === undefined) {\r\n\t\t\treturn this._chartTitle;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.chartTitle', chartTitle).isString();\r\n\t\tthis._chartTitle = chartTitle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart legend position, optional value: 'none', 'top'(default), 'bottom', 'left', 'right'.\r\n\t * \r\n\t * @param {String | undefined} legendPos Chart legend position.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlegendPos: function(legendPos) {\r\n\t\tif(legendPos === undefined) {\r\n\t\t\treturn this._legendPos;\r\n\t\t}\r\n\t\tlegendPos = jQuery.trim(legendPos);\r\n\t\tvar checker = jslet.Checker.test('DBChart.legendPos', legendPos).isString().required();\r\n\t\tchecker.testValue(legendPos.toLowerCase()).inArray(this.legendPositions);\r\n\t\tthis._legendPos = legendPos;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get record range, optional value: jslet.data.RecordRange.ALL, jslet.data.RecordRange.CURRENT, jslet.data.RecordRange.SELECTED.\r\n\t * \r\n\t * @param {jslet.data.RecordRange | undefined} recordRange default is jslet.data.RecordRange.ALL.\r\n\t * \r\n\t * @return {this | jslet.data.RecordRange}\r\n\t */\r\n\trecordRange: function(recordRange) {\r\n\t\tif(recordRange === undefined) {\r\n\t\t\treturn this._recordRange;\r\n\t\t}\r\n\t\tthis._recordRange = recordRange;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether reverse the X-axis and Y-axis or not.\r\n\t * \r\n\t * @param {Boolean | undefined} reverse True - reverse the X-axis and Y-axis, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treverse: function(reverse) {\r\n\t\tif(reverse === undefined) {\r\n\t\t\treturn this._reverse;\r\n\t\t}\r\n\t\tthis._reverse = reverse? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tonSetChartOption: function(onSetChartOption) {\r\n\t\tif(onSetChartOption === undefined) {\r\n\t\t\treturn this._onSetChartOption;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.onSetChartOption', onSetChartOption).isFunction();\r\n\t\tthis._onSetChartOption = onSetChartOption;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(this);\r\n\t},\r\n\t\r\n\t_getEChart: function() {\r\n\t\tif(!this._echart) {\r\n\t\t\tthis._echart = jslet.global.echarts.init(this.el);\r\n\t\t}\r\n\t\treturn this._echart;\r\n\t},\r\n\r\n\t_validateFields: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._fieldValidated) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsObj = Z._dataset,\r\n\t\t\tfldName = Z._categoryField;\r\n\t\tif (!dsObj.getField(fldName)) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tif(Z._valueFields) {\r\n\t\t\tfor(var i = 0, len = Z._valueFields.length; i < len; i++) {\r\n\t\t\t\tfldName = Z._valueFields[i];\r\n\t\t\t\tif(!dsObj.getField(fldName)) {\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._fieldValidated = true;\r\n\t},\r\n\t\r\n\t_getLineRecord: function(dsObj, xLabels, yValues, yFields, legendLabels) {\r\n\t\tvar Z = this,\r\n\t\t\tstartRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tvar isInit = false, valueFldName,\r\n\t\t\tvalueFldCnt = Z._valueFields.length,\r\n\t\t\tvalueArr, \r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\tdsObj.recnoSilence(k);\r\n\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\txLabels.push(dsObj.getFieldText(Z._categoryField));\r\n\t\t\tfor(var i = 0; i < valueFldCnt; i++) {\r\n\t\t\t\tvalueFldName = Z._valueFields[i];\r\n\t\t\t\tif(!isInit) {\r\n\t\t\t\t\tvalueArr = [];\r\n\t\t\t\t\tyValues.push(valueArr);\r\n\t\t\t\t\tlegendLabels.push(dsObj.getField(valueFldName).label());\r\n\t\t\t\t\tyFields.push(valueFldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalueArr = yValues[i];\r\n\t\t\t\t}\r\n\t\t\t\tvalueArr.push(dsObj.getFieldValue(valueFldName));\r\n\t\t\t}\r\n\t\t\tisInit = true;\r\n\t\t} //End for k\r\n\t},\r\n\t\r\n\t_getLineRecordReverse: function(dsObj, xLabels, yValues, yFields, legendLabels) {\r\n\t\tvar Z = this,\r\n\t\t\tstartRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tvar isInit = false, valueFldName,\r\n\t\t\tvalueFldCnt = Z._valueFields.length,\r\n\t\t\tvalueArr, \r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\tdsObj.recnoSilence(k);\r\n\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlegendLabels.push(dsObj.getFieldText(Z._categoryField));\r\n\t\t\tvalueArr = [];\r\n\t\t\tfor(var i = 0; i < valueFldCnt; i++) {\r\n\t\t\t\tvalueFldName = Z._valueFields[i];\r\n\t\t\t\tif(!isInit) {\r\n\t\t\t\t\txLabels.push(dsObj.getField(valueFldName).label());\r\n\t\t\t\t\tyFields.push(valueFldName);\r\n\t\t\t\t}\r\n\t\t\t\tvalueArr.push(dsObj.getFieldValue(valueFldName));\r\n\t\t\t}\r\n\t\t\tyValues.push(valueArr);\r\n\t\t\tisInit = true;\r\n\t\t} //End for k\r\n\t},\r\n\t\r\n\t_getLineData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\txLabels = [],\r\n\t\t\tyValues = [],\r\n\t\t\tyFields = [],\r\n\t\t\tlegendLabels = [];\r\n\r\n\t\tif(dsObj.recordCount() === 0 || !Z._valueFields) {\r\n\t\t\treturn {xLabels: xLabels, yValues: yValues, yFields: yFields, legendLabels: legendLabels};\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence();\r\n\t\ttry {\r\n\t\t\tif(Z._reverse) {\r\n\t\t\t\tZ._getLineRecordReverse(dsObj, xLabels, yValues, yFields, legendLabels);\r\n\t\t\t} else {\r\n\t\t\t\tZ._getLineRecord(dsObj, xLabels, yValues, yFields, legendLabels);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn {xLabels: xLabels, yValues: yValues, yFields: yFields, legendLabels: legendLabels};\r\n\t},\r\n\r\n\t_getPieData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\tchartData = [],\r\n\t\t\tlegendLabels = [],\r\n\t\t\tresult = {chartData: chartData, legendLabels: legendLabels, title: ''};\r\n\t\tif(dsObj.recordCount() === 0 || !Z._valueFields) {\r\n\t\t\tchartData = [['', 0]];\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tvar startRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT || Z._reverse) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tif(Z._reverse) {\r\n\t\t\tresult.title = Z._dataset.getField(Z._valueFields[0]).displayLabel();\r\n\t\t} else {\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence(), k, len, valueFldName, label, value,\r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\ttry {\r\n\t\t\tif(!Z._reverse) {\r\n\t\t\t\tresult.title = Z._dataset.getField(Z._valueFields[0]).displayLabel();\r\n\t\t\t\tvalueFldName = Z._valueFields[0];\r\n\t\t\t\tfor(k = startRecno; k <= endRecno; k++) {\r\n\t\t\t\t\tdsObj.recnoSilence(k);\r\n\t\t\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlabel = dsObj.getFieldText(Z._categoryField);\r\n\t\t\t\t\tvalue = dsObj.getFieldValue(valueFldName);\r\n\t\t\t\t\tchartData.push({name: label, value: value});\r\n\t\t\t\t\tlegendLabels.push(label);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.recnoSilence(startRecno);\r\n\t\t\t\tresult.title = Z._dataset.getField(Z._categoryField).displayLabel();\r\n\t\t\t\tvar fldObj;\r\n\t\t\t\tfor(k = 0, len = Z._valueFields.length; k < len; k++) {\r\n\t\t\t\t\tvalueFldName = Z._valueFields[k];\r\n\t\t\t\t\tfldObj = dsObj.getField(valueFldName);\r\n\t\t\t\t\tlabel = fldObj.displayLabel();\r\n\t\t\t\t\tvalue = fldObj.getValue();\r\n\t\t\t\t\tchartData.push([label, value]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_drawLineChart: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartData = Z._getLineData(),\r\n\t\t\techart = Z._getEChart(),\r\n\t\t\tlegendLabels = chartData.legendLabels,\r\n\t\t\toption = {title: {text: Z._chartTitle},\r\n\t\t\t\tlegend: {data: legendLabels},\r\n\t\t\t\txAxis: {data: chartData.xLabels},\r\n\t\t\t\tyAxis: {type: 'value'}\r\n\t\t\t};\r\n\t\tvar yValues = chartData.yValues,\r\n\t\t\tyFields = chartData.yFields,\r\n\t\t\tseries = [], stack = null,\r\n\t\t\tchtype = Z._chartType;\r\n\t\tif(chtype === 'stackline'){\r\n\t\t\tstack = 'stack';\r\n\t\t\tchtype = 'line';\r\n\t\t}\r\n\t\tif(chtype === 'stackbar') {\r\n\t\t\tstack = 'stack';\r\n\t\t\tchtype = 'bar';\r\n\t\t}\r\n\t\tfor(var i = 0, len = yValues.length; i < len; i++) {\r\n\t\t\tseries.push({field: yFields[i], name: legendLabels[i], data: yValues[i], type: chtype, stack: stack});\r\n\t\t}\r\n\t\toption.series = series;\r\n\t\t\r\n\t\tif(Z._onSetChartOption) {\r\n\t\t\tZ._onSetChartOption(option);\r\n\t\t}\r\n\t\techart.setOption(option);\r\n\t},\r\n\t\t\r\n\t_drawPieChart: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartData = Z._getPieData(),\r\n\t\t\techart = Z._getEChart(),\r\n\t\t\ttitle = chartData.title,\r\n\t\t\tchartTitle = (Z._chartTitle? Z._chartTitle + ' - ' : '') + title,\r\n\t\tlegendLabels = chartData.legendLabels;\r\n\t\tchartData = chartData.chartData;\r\n\t\t\t\r\n\t\tvar option = {title: {text: chartTitle},\r\n\t\t\t\tlegend: {data: legendLabels}\r\n\t\t\t};\r\n\t\t\r\n\t\tvar series = [{type: 'pie', data: chartData}];\r\n\t\toption.series = series;\r\n\t\tif(Z._onSetChartOption) {\r\n\t\t\tZ._onSetChartOption(option);\r\n\t\t}\r\n\t\techart.setOption(option);\r\n\t},\r\n\t\r\n\tdrawChart: function () {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset;\r\n\t\tif(jQuery(Z.el).is(':hidden')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._getEChart().clear();\r\n\t\t\r\n\t\tif(dsObj.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.SELECTED) {\r\n\t\t\tif(!Z._dataset.hasSelectedRecords()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._validateFields();\r\n\t\tif(Z._chartType == 'pie') {\r\n\t\t\tZ._drawPieChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartType == 'line' || Z._chartType == 'bar' || \r\n\t\t\tZ._chartType == 'stackline' || Z._chartType == 'stackbar') {\r\n\t\t\tZ._drawLineChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\r\n\trefreshControl: function (evt) {\r\n\t\tvar evtType = evt.eventType;\r\n\t\tif (evtType === jslet.data.RefreshEvent.UPDATEALL || \r\n\t\t\tevtType === jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType === jslet.data.RefreshEvent.UPDATECOLUMN || \r\n\t\t\tevtType === jslet.data.RefreshEvent.INSERT || \r\n\t\t\tevtType === jslet.data.RefreshEvent.DELETE || \r\n\t\t\t(evtType === jslet.data.RefreshEvent.SCROLL && this._recordRange === jslet.data.RecordRange.CURRENT) || \r\n\t\t\t((evtType === jslet.data.RefreshEvent.SELECTRECORD || evtType === jslet.data.RefreshEvent.SELECTALL) &&\r\n\t\t\t\tthis._recordRange === jslet.data.RecordRange.SELECTED)\r\n\t\t\t) {\r\n\t\t\tthis.drawChart();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this;\r\n\t\tvar currHeight = jQuery(Z.el).height();\r\n\t\tif(Z._oldHeight < 0 || Z._oldHeight === currHeight) {\r\n\t\t\treturn;\r\n\t\t} \r\n\t\tZ._oldHeight = currHeight;\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ.drawChart();\r\n\t\t}, 10);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis.jqplot = null;\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(this);\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBChart', jslet.ui.DBChart);\r\njslet.ui.DBChart.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBEditPanel is a container control used for user to input data. \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBEditPanel\",dataset:\"employee\",columnCount:3};\r\n * \r\n *     //1. Declaring:\r\n *       <div id='ctrlId' data-jslet='type:\"DBEditPanel\",dataset:\"employee\",columnCount:3' />\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\n\r\njslet.ui.DBEditPanel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t\r\n\t_totalColumns: 12, //Bootstrap column count \r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t*/\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,columnCount,labelCols,onlySpecifiedFields,fields,hasLabel,includeFields,excludeFields,layout';\r\n\t\t\r\n\t\tZ._columnCount = 3;\r\n\r\n\t\tZ._labelCols = 1;\r\n\r\n\t\tZ._onlySpecifiedFields = false;\r\n\t\t\r\n\t\tZ._includeFields = null;\r\n\t\t\r\n\t\tZ._excludeFields = null;\r\n\t\t\r\n\t\tZ._layout = null;\r\n\t\t\r\n\t\tZ._hasLabel = true;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get display column count of field label. According to Bootstrap document, this property is in range: [1,11].\r\n\t * \r\n\t * @param {Integer | undefined} labelCols The display column count of field label.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tlabelCols: function(labelCols) {\r\n\t\tif(labelCols === undefined) {\r\n\t\t\treturn this._labelCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.labelCols', labelCols).isNumber().between(1,10);\r\n\t\tthis._labelCols = parseInt(labelCols);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it only displays the fields which specified by \"fields\" property.\r\n\t * \r\n\t * @param {Boolean | undefined} onlySpecifiedFields True - only display the specified fields, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlySpecifiedFields: function(onlySpecifiedFields) {\r\n\t\tif(onlySpecifiedFields === undefined) {\r\n\t\t\treturn this._onlySpecifiedFields;\r\n\t\t}\r\n\t\tthis._onlySpecifiedFields = onlySpecifiedFields ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it exists the field label part.\r\n\t * \r\n\t * @param {Boolean | undefined} hasLabel True - exists field label part, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasLabel: function(hasLabel) {\r\n\t\tif(hasLabel === undefined) {\r\n\t\t\treturn this._hasLabel;\r\n\t\t}\r\n\t\tthis._hasLabel = hasLabel ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/*\r\n\t * @deprecated\r\n\t * Use 'layout' instead.\r\n\t */\r\n\tfields: function(fields) {\r\n\t\treturn this.layout(fields);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get editing field's layout.\r\n\t * \r\n\t * @param {Object[] | undefined} layout Editing fields setting.\r\n\t * @param {String} layout.field Field name.\r\n\t * @param {Integer} layout.labelCols Label display column, range: [1, 3].\r\n\t * @param {Integer} layout.dataCols Edit control display column, range: [1, 11].\r\n\t * @param {Boolean} layout.inFirstCol Display field at first column.\r\n\t * @param {Boolean} layout.showLine Display line separator.\r\n\t * @param {Boolean} layout.visible The field is visible or not.\r\n\t * @param {String | Number} layout.height The height of the edit field, if the value is numberic, the unit is 'px'.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.prefix The prefix part of the field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.suffix The suffix part of the field.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\tlayout: function(layout) {\r\n\t\tif(layout === undefined) {\r\n\t\t\treturn this._layout;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.layout', layout).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = layout.length; i < len; i++) {\r\n\t\t\tfldCfg = layout[i];\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.field', fldCfg.field).isString().required();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.labelCols', fldCfg.labelCols).isNumber().between(1,3);\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.dataCols', fldCfg.dataCols).isNumber().between(1,11);\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.prefix', fldCfg.prefix).isArray();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.suffix', fldCfg.suffix).isArray();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.height', fldCfg.height).isGTZero();\r\n\t\t\tfldCfg.inFirstCol = fldCfg.inFirstCol ? true: false;\r\n\t\t\tfldCfg.showLine = fldCfg.showLine ? true: false;\r\n\t\t\tfldCfg.visible = (fldCfg.visible || fldCfg.visible === undefined) ? true: false;\r\n\t\t}\r\n\t\tthis._layout = layout;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\tincludeFields: function(includeFields) {\r\n\t\tif(includeFields === undefined) {\r\n\t\t\treturn this._includeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.includeFields', includeFields).isArray();\r\n\t\tthis._includeFields = includeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are not displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are not displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\texcludeFields: function(excludeFields) {\r\n\t\tif(excludeFields === undefined) {\r\n\t\t\treturn this._excludeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.excludeFields', excludeFields).isArray();\r\n\t\tthis._excludeFields = excludeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t*/\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\t\r\n\t_calcLayout: function () {\r\n\t\tvar Z = this,\r\n\t\t\tallFlds = Z._dataset.getNormalFields(), \r\n\t\t\tfldLayout,  fldObj, i, fldName, found, \r\n\t\t\tfcnt = allFlds.length,\r\n\t\t\tfldLayouts = [], \r\n\t\t\tlayoutCnt = Z._layout ? Z._layout.length : 0;\r\n\t\t\r\n\t\tif(Z._onlySpecifiedFields && Z._layout) {\r\n\t\t\t\r\n\t\t\tfor(i = 0; i < layoutCnt; i++) {\r\n\t\t\t\tfldLayout = Z._layout[i];\r\n\t\t\t\tif(fldLayout.visible || fldLayout.visible === undefined) {\r\n\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar exFields = Z._excludeFields,\r\n\t\t\t\tinFields = Z._includeFields;\r\n\t\t\tfor(i = 0; i < fcnt; i++) {\r\n\t\t\t\tfldObj = allFlds[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = false;\r\n\t\t\t\tif(inFields && inFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = false;\r\n\t\t\t\tfor(var j = 0; j < layoutCnt; j++) {\r\n\t\t\t\t\tfldLayout = Z._layout[j];\r\n\t\t\t\t\tif(fldLayout.field !== fldName) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tif(fldLayout.visible || fldLayout.visible === undefined) {\r\n\t\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(!found) {\r\n\t\t\t\t\tfldLayouts.push({field: fldName});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar dftDataCols = Math.floor((Z._totalColumns - Z._labelCols * Z._columnCount) / Z._columnCount);\r\n\t\tif(dftDataCols <= 0) {\r\n\t\t\tdftDataCols = 1;\r\n\t\t}\r\n\r\n\t\t//calc row, col\r\n\t\tvar layout, r = 0, c = 0, colsInRow = 0, itemCnt;\r\n\t\tfor (i = 0, layoutCnt = fldLayouts.length; i < layoutCnt; i++) {\r\n\t\t\tlayout = fldLayouts[i];\r\n\t\t\tif(!layout.labelCols) {\r\n\t\t\t\tlayout._innerLabelCols = Z._labelCols;\r\n\t\t\t}\r\n\t\t\tif(!layout.dataCols) {\r\n\t\t\t\tlayout._innerDataCols = dftDataCols;\r\n\t\t\t} else {\r\n\t\t\t\tlayout._innerDataCols = layout.dataCols;\t\r\n\t\t\t}\r\n\t\t\titemCnt = layout._innerLabelCols + layout._innerDataCols;\r\n\t\t\tif (layout.inFirstCol || layout.showLine || colsInRow + itemCnt > Z._totalColumns) {\r\n\t\t\t\tr++;\r\n\t\t\t\tcolsInRow = 0;\r\n\t\t\t}\r\n\t\t\tlayout.row = r;\r\n\t\t\tcolsInRow += itemCnt;\r\n\t\t}\r\n\t\treturn fldLayouts;\r\n\t},\r\n\t\r\n\tgetEditField: function (fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._layout) {\r\n\t\t\tZ._layout = [];\r\n\t\t}\r\n\t\tvar editFld;\r\n\t\tfor (var i = 0, cnt = Z._layout.length; i < cnt; i++) {\r\n\t\t\teditFld = Z._layout[i];\r\n\t\t\tif (editFld.field == fieldName) {\r\n\t\t\t\treturn editFld;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fieldName);\r\n\t\tif (!fldObj) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\teditFld = {\r\n\t\t\tfield: fieldName\r\n\t\t};\r\n\t\tZ._layout.push(editFld);\r\n\t\treturn editFld;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-editpanel')) {\r\n\t\t\tjqEl.addClass('jl-editpanel form-horizontal');\r\n\t\t}\r\n\t\tjqEl.html('');\r\n\t\tvar allFlds = Z._dataset.getNormalFields(),\r\n\t\t\tfcnt = allFlds.length;\r\n\t\tvar layouts = Z._calcLayout();\r\n\t\t//calc max label width\r\n\t\t\t\r\n\t\tvar layout, editor, r = -1, oLabel, editorCfg, fldName, fldObj, ohr, octrlDiv, opanel, ctrlId, dbCtrl;\r\n\t\tfor (var i = 0, cnt = layouts.length; i < cnt; i++) {\r\n\t\t\tlayout = layouts[i];\r\n\t\t\tif (layout.showLine) {\r\n\t\t\t\tohr = document.createElement('hr');\r\n\t\t\t\tZ.el.appendChild(ohr);\r\n\t\t\t}\r\n\t\t\tif (layout.row != r) {\r\n\t\t\t\topanel = document.createElement('div');\r\n\t\t\t\topanel.className = 'form-group form-group-sm';\r\n\t\t\t\t//jQuery(opanel).css('width','100%').css('margin', '0px');\r\n\t\t\t\tZ.el.appendChild(opanel);\r\n\t\t\t\tr = layout.row;\r\n\t\t\t}\r\n\t\t\tfldName = layout.field;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\teditorCfg = fldObj.editControl();\r\n\t\t\tvar isCheckBox = editorCfg.type.toLowerCase() == 'dbcheckbox';\r\n\t\t\tif(isCheckBox) {\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('div');\r\n\t\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\t\t\t\t}\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + (Z._hasLabel? layout._innerDataCols: 12);\r\n\t\t\t\t\r\n\t\t\t\teditorCfg.dataset = Z._dataset;\r\n\t\t\t\teditorCfg.field = fldName;\r\n\t\t\t\teditor = jslet.ui.createControl(editorCfg, null);\r\n\t\t\t\toctrlDiv.appendChild(editor.el);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\t\toctrlDiv.appendChild(oLabel);\r\n\t\t\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\t\tfield: fldName\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t} else {\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\t\t\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\t\tfield: fldName\r\n\t\t\t\t\t});\r\n\t\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + (Z._hasLabel? layout._innerDataCols: 12);\r\n\t\t\t\t\r\n\t\t\t\teditor = jslet.ui.createControl({type: 'DBPlace', dataset: this._dataset, field: fldName, \r\n\t\t\t\t\tprefix: layout.prefix, suffix: layout.suffix}, octrlDiv);\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tvar layoutHeight = layout.height;\r\n\t\t\t\tif(layoutHeight) {\r\n\t\t\t\t\tif(jslet.isNumber(layoutHeight)) {\r\n\t\t\t\t\t\tlayoutHeight = layoutHeight + 'px'; \r\n\t\t\t\t\t}\r\n\t\t\t\t\tjQuery(editor.el).css('height', layoutHeight);\r\n\t\t\t\t\tjQuery(editor.el.firstChild).css('height', '100%');\r\n\t\t\t\t}\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBEditPanel', jslet.ui.DBEditPanel);\r\njslet.ui.DBEditPanel.htmlTemplate = '<div></div>';\r\n\n\"use strict\";\r\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team\r\n * Released under GNU AGPL v3.0 license\r\n */\r\n\r\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBInspector. \r\n * Display & Edit fields in two columns: Label column and Value column. If in edit mode, this control takes the field editor configuration from dataset field object. <br />\r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100};\r\n * \r\n *     //1. Declaring:\r\n *       <div id='ctrlId' data-jslet='type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100' />\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBInspector = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,columnCount,layout';\r\n\t\t\r\n\t\tZ._columnCount = 1;\r\n\t\t\r\n\t\tZ._layout = null;\r\n\t\t\r\n\t\tZ._includeFields = null;\r\n\t\t\r\n\t\tZ._excludeFields = null;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the edit layout.\r\n\t * \r\n\t * @param {Object[] | undefined} layout Edit layout.\r\n\t * @param {String} layout.field Field name.\r\n\t * @param {Boolean} layout.visible Visible of field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.prefix The prefix part of the field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.suffix The suffix part of the field.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\tlayout: function(layout) {\r\n\t\tif(layout === undefined) {\r\n\t\t\treturn this._layout;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.layout', layout).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = layout.length; i < len; i++) {\r\n\t\t\tfldCfg = layout[i];\r\n\t\t\tjslet.Checker.test('DBInspector.layout.field', fldCfg.field).isString().required();\r\n\t\t}\r\n\t\tthis._layout = layout;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\tincludeFields: function(includeFields) {\r\n\t\tif(includeFields === undefined) {\r\n\t\t\treturn this._includeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.includeFields', includeFields).isArray();\r\n\t\tthis._includeFields = includeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are not displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are not displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\texcludeFields: function(excludeFields) {\r\n\t\tif(excludeFields === undefined) {\r\n\t\t\treturn this._excludeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.excludeFields', excludeFields).isArray();\r\n\t\tthis._excludeFields = excludeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar colCnt = Z._columnCount;\r\n\t\tif (colCnt) {\r\n\t\t\tcolCnt = parseInt(colCnt);\r\n\t\t}\r\n\t\tif (colCnt && colCnt > 0) {\r\n\t\t\tZ._columnCount = colCnt;\r\n\t\t} else {\r\n\t\t\tZ._columnCount = 1;\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t_calcLayout: function () {\r\n\t\tvar Z = this,\r\n\t\t\tallFlds = Z._dataset.getNormalFields(), \r\n\t\t\tfldObj, i, fldName, found, fldLayout,\r\n\t\t\tfcnt = allFlds.length,\r\n\t\t\tlayoutCnt = Z._layout ? Z._layout.length : 0,\r\n\t\t\tfldLayouts = [];\r\n\t\t\r\n\t\tvar exFields = Z._excludeFields,\r\n\t\t\tinFields = Z._includeFields;\r\n\t\tfor(i = 0; i < fcnt; i++) {\r\n\t\t\tfldObj = allFlds[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfound = false;\r\n\t\t\tif(inFields && inFields.indexOf(fldName) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfound = false;\r\n\t\t\tfor(var j = 0; j < layoutCnt; j++) {\r\n\t\t\t\tfldLayout = Z._layout[j];\r\n\t\t\t\tif(fldLayout.field !== fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = true;\r\n\t\t\t\tif(fldLayout.visible === undefined || fldLayout.visible) {\r\n\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tfldLayouts.push({field: fldName});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fldLayouts;\r\n\t},\r\n\r\n\t_calcLabelWidth: function(fields) {\r\n\t\tvar Z = this,\r\n\t\t\tfcnt = fields.length,\r\n\t\t\tcolumnCnt = Math.min(fcnt, Z._columnCount), \r\n\t\t\tarrLabelWidth = [],\r\n\t\t\tw, c, i;\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\tarrLabelWidth[i] = 0;\r\n\t\t}\r\n\t\tvar charWidth = jslet.ui.textMeasurer.getWidth('*');\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar dsObj = Z._dataset, fldObj, fldName;\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldName = fields[i].field; \r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tw = Math.round(jslet.ui.textMeasurer.getWidth(fldObj.displayLabel()) + charWidth) + 15;\r\n\t\t\tif (arrLabelWidth[c] < w) {\r\n\t\t\t\tarrLabelWidth[c] = w;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\treturn arrLabelWidth;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.removeAllChildControls();\r\n\t\t\r\n\t\tif (!jqEl.hasClass('jl-inspector'))\r\n\t\t\tjqEl.addClass('jl-inspector jl-round5');\r\n\t\tvar totalWidth = jqEl.width(),\r\n\t\t\tallFlds = Z._dataset.getFields();\r\n\t\tjqEl.html('<table cellpadding=0 cellspacing=0 style=\"margin:0;padding:0;table-layout:fixed;width:100%;height:100%\"><tbody></tbody></table>');\r\n\t\tvar fldObj, i, found, visible, fldName, cfgFld, fcnt,\r\n\t\t\tfieldLayouts = Z._calcLayout();\r\n\t\tfcnt = fieldLayouts.length;\r\n\t\tif (fcnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tcolumnCnt = Math.min(fcnt, Z._columnCount), \r\n\t\t\tarrLabelWidth = Z._calcLabelWidth(fieldLayouts);\r\n\t\t\r\n\t\tvar otable = Z.el.firstChild,\r\n\t\t\ttHead = otable.createTHead(), otd, otr = tHead.insertRow(-1);\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.style.width = arrLabelWidth[i] + 'px';\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t}\r\n\t\t\r\n\t\tvar oldRowNo = -1, oldC = -1, rowNo, odiv, oLabel, editor, fldCtrl, dbCtrl, c, fldCfg;\r\n\t\tZ.preRowIndex = -1;\r\n\t\tvar dsObj = Z._dataset;\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldCfg = fieldLayouts[i];\r\n\t\t\tfldName = fldCfg.field;\r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\trowNo = Math.floor(i / columnCnt);\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tif (oldRowNo != rowNo) {\r\n\t\t\t\totr = otable.insertRow(-1);\r\n\t\t\t\toldRowNo = rowNo;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.labelColCls;\r\n\t\t\t\r\n\t\t\toLabel = document.createElement('label');\r\n\t\t\totd.appendChild(oLabel);\r\n\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\tfield: fldName\r\n\t\t\t});\r\n\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.editorColCls;\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.align = 'left';\r\n\t\t\todiv = document.createElement('div');\r\n\t\t\todiv.noWrap = true;\r\n\t\t\totd.appendChild(odiv);\r\n\t\t\tfldCtrl = {type: 'DBPlace'};\r\n\t\t\tfldCtrl.dataset = Z._dataset;\r\n\t\t\tfldCtrl.field = fldName;\r\n\t\t\tfldCtrl.prefix = fldCfg.prefix;\r\n\t\t\tfldCtrl.suffix = fldCfg.suffix;\r\n\t\t\t\r\n\t\t\teditor = jslet.ui.createControl(fldCtrl, odiv);\r\n\t\t\tif (!editor.isCheckBox) {\r\n\t\t\t\teditor.el.style.width = '100%';//editorWidth - 10 + 'px';\r\n\t\t\t}\r\n\t\t\tZ.addChildControl(editor);\r\n\t\t} // end for\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.DBINSPECTOR = {\r\n\tlabelColCls: 'jl-inspector-label',\r\n\teditorColCls: 'jl-inspector-editor'\r\n};\r\n\r\njslet.ui.register('DBInspector', jslet.ui.DBInspector);\r\njslet.ui.DBInspector.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBError. Display dataset error. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBError\",dataset:\"employee\"};\r\n *  \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBError\",dataset:\"employee\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBError = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-errorpanel')) {\r\n\t\t\tjqEl.addClass('jl-errorpanel');\r\n\t\t}\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType == jslet.data.RefreshEvent.ERROR) {\r\n\t\t\tthis.el.innerHTML = evt.message || '';\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n});\r\n\r\njslet.ui.register('DBError', jslet.ui.DBError);\r\njslet.ui.DBError.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBPageBar. Features: <br />\r\n * 1. First page, Prior Page, Next Page, Last Page; <br />\r\n * 2. Can go to specified page; <br />\r\n * 3. Can specify page size on runtime; <br />\r\n * 4. Need not write any code; <br />\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBPageBar = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,showPageSize,pageSizeList';\r\n\t\tZ._showPageSize = true;\r\n\t\t\r\n\t\tZ._pageSizeList = [100, 200, 500];\r\n\r\n\t\tZ._currPageCount = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether show \"Page Size\" part or not.\r\n\t * \r\n\t * @param {Boolean | undefined} showPageSize True - show \"PageSize\", false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tshowPageSize: function(showPageSize) {\r\n\t\tif(showPageSize === undefined) {\r\n\t\t\treturn this._showPageSize;\r\n\t\t}\r\n\t\tthis._showPageSize = showPageSize ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get a list of page size.\r\n\t * \r\n\t * @param {Integer[] | undefined} pageSizeList Array of integer, like: [50,100,200].\r\n\t * \r\n\t * @return {this | Integer[]} \r\n\t */\r\n\tpageSizeList: function(pageSizeList) {\r\n\t\tif(pageSizeList === undefined) {\r\n\t\t\treturn this._pageSizeList;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBPageBar.pageSizeList', pageSizeList).isArray();\r\n\t\tvar size;\r\n\t\tfor(var i = 0, len = pageSizeList.length; i < len; i++) {\r\n\t\t\tsize = pageSizeList[i];\r\n\t\t\tjslet.Checker.test('DBPageBar.pageSizeList', size).isGTZero();\r\n\t\t}\r\n\t\tthis._pageSizeList = pageSizeList;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-pagebar')) {\r\n\t\t\tjqEl.addClass('jl-pagebar');\r\n\t\t}\r\n\t\tvar template = [\r\n\t\t'<div class=\"form-inline form-group\">',\r\n\t  \t'<select class=\"form-control input-sm jl-pb-pagesize\" title=\"', jsletlocale.DBPageBar.pageSize, '\"></select>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-first\" title=\"', jsletlocale.DBPageBar.first, '\"><i class=\"fa fa-angle-double-left\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-prior\" title=\"', jsletlocale.DBPageBar.prior, '\"><i class=\"fa fa-angle-left\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-next\" title=\"', jsletlocale.DBPageBar.next, '\"><i class=\"fa fa-angle-right\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-last\" title=\"', jsletlocale.DBPageBar.last, '\"><i class=\"fa fa-angle-double-right\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-refresh\" title=\"', jsletlocale.DBPageBar.refresh, '\"><i class=\"fa fa-refresh\" aria-hidden=\"true\"></i></button>',\r\n\t  \t'<select class=\"form-control input-sm jl-pb-pagenum\" title=\"', jsletlocale.DBPageBar.pageNum, '\"></select>',\r\n\t    '</div>'];\r\n\t\t\r\n\t\tjqEl.html(template.join(''));\r\n\r\n\t\tZ._jqPageSize = jqEl.find('.jl-pb-pagesize');\r\n\t\tif (Z._showPageSize) {\r\n\t\t\tZ._jqPageSize.removeClass('jl-hidden');\r\n\t\t\tvar pgSizeList = Z._pageSizeList;\r\n\t\t\tvar cnt = pgSizeList.length, s = '', pageSize;\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tpageSize = pgSizeList[i];\r\n\t\t\t\ts += '<option value=\"' + pageSize + '\">' + pageSize + '</option>';\r\n\t\t\t}\r\n\r\n\t\t\tZ._jqPageSize.html(s);\r\n\t\t\tif(cnt > 0) {\r\n\t\t\t\tZ._dataset.pageSize(parseInt(pgSizeList[0]));\r\n\t\t\t}\r\n\t\t\tZ._jqPageSize.on('change', function (event) {\r\n\t\t\t\tvar dsObj = Z.dataset();\r\n\t\t\t\tdsObj.pageNo(1);\r\n\t\t\t\tdsObj.pageSize(parseInt(this.value));\r\n\t\t\t\tdsObj.requery();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._jqPageSize.addClass('jl-hidden');\r\n\t\t}\r\n\r\n\t\tZ._jqFirstBtn = jqEl.find('.jl-pb-first');\r\n\t\tZ._jqPriorBtn = jqEl.find('.jl-pb-prior');\r\n\t\tZ._jqNextBtn = jqEl.find('.jl-pb-next');\r\n\t\tZ._jqLastBtn = jqEl.find('.jl-pb-last');\r\n\t\tZ._jqRefreshBtn = jqEl.find('.jl-pb-refresh');\r\n\t\tZ._jqPageNum = jqEl.find('.jl-pb-pagenum');\r\n\t\t\r\n\t\tZ._jqFirstBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset();\r\n\t\t\tdsObj.pageNo(1);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqPriorBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset(),\r\n\t\t\t\tnum = dsObj.pageNo();\r\n\t\t\tif (num == 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(num - 1);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqPageNum.on('change', function (event) {\r\n\t\t\tvar dsObj = Z.dataset();\r\n\t\t\tvar num = parseInt(this.value);\r\n\t\t\tdsObj.pageNo(num);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqNextBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset(),\r\n\t\t\t\tnum = dsObj.pageNo();\r\n\t\t\tif (num >= dsObj.pageCount()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(++num);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqLastBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset();\r\n\r\n\t\t\tif (dsObj.pageCount() < 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(dsObj.pageCount());\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqRefreshBtn.on('click', function (event) {\r\n\t\t\tZ.dataset().requery();\r\n\t\t});\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType != jslet.data.RefreshEvent.CHANGEPAGE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._refreshPageNum();\r\n\t\tthis._refreshButtonStatus();\r\n\t},\r\n\r\n\t_refreshPageNum: function() {\r\n\t\tvar Z = this,\r\n\t\t\tnum = Z._dataset.pageNo(), \r\n\t\t\tcount = Z._dataset.pageCount();\r\n\t\tif(count !== Z._currPageCount) {\r\n\t\t\tvar s = '';\r\n\t\t\tfor(var i = 1; i <= count; i++) {\r\n\t\t\t\ts += '<option value=\"' + i + '\">' + i + '</option>';\r\n\t\t\t}\r\n\t\t\tZ._jqPageNum.html(s);\r\n\t\t\tZ._currPageCount = count;\r\n\t\t}\r\n\t\tZ._jqPageNum.val(num);\r\n\t},\r\n\t\r\n\t_refreshButtonStatus: function() {\r\n\t\tvar Z = this, \r\n\t\t\tds = Z._dataset,\r\n\t\t\tpageNo = ds.pageNo(),\r\n\t\t\tpageCnt = ds.pageCount(),\r\n\t\t\tprevDisabled = true,\r\n\t\t\tnextDisabled = true;\r\n\t\tif(pageNo > 1) {\r\n\t\t\tprevDisabled = false;\r\n\t\t}\r\n\t\tif(pageNo < pageCnt) {\r\n\t\t\tnextDisabled = false;\r\n\t\t}\r\n\t\tZ._jqFirstBtn.attr('disabled', prevDisabled);\r\n\t\tZ._jqPriorBtn.attr('disabled', prevDisabled);\r\n\t\tZ._jqNextBtn.attr('disabled', nextDisabled);\r\n\t\tZ._jqLastBtn.attr('disabled', nextDisabled);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z._jqPageSize) {\r\n\t\t\tZ._jqPageSize.off();\r\n\t\t\tZ._jqPageSize = null;\r\n\t\t}\r\n\t\tZ._jqFirstBtn.off();\r\n\t\tZ._jqPriorBtn.off();\r\n\t\tZ._jqNextBtn.off();\r\n\t\tZ._jqLastBtn.off();\r\n\t\tZ._jqPageNum.off();\r\n\t\tZ._jqRefreshBtn.off();\r\n\r\n\t\tZ._jqFirstBtn = null;\r\n\t\tZ._jqPriorBtn = null;\r\n\t\tZ._jqNextBtn = null;\r\n\t\tZ._jqLastBtn = null;\r\n\t\tZ._jqPageNum = null;\r\n\t\tZ._jqRefreshBtn = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBPageBar', jslet.ui.DBPageBar);\r\njslet.ui.DBPageBar.htmlTemplate = '<div></div>';\r\n\n/**\r\n * A dialog for dataset batch editing. Example:\r\n * \r\n *     @example\r\n *     var dialog = new jslet.ui.BatchEditDialog(dsObj, 'fld1,fld2');\r\n *     dialog.show();\r\n *       \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name which need to be modified in bulk.\r\n * @param {String[] | String} editFields A String array or a string which separate by comma, to identify which fields will be modified in bulk.\r\n */\r\njslet.ui.BatchEditDialog = function(dataset, editFields) {\r\n\tjslet.Checker.test('BatchEditDialog#dataset', dataset).required();\r\n\tif(editFields && jslet.isString(editFields)) {\r\n\t\teditFields = editFields.split(',');\r\n\t}\r\n\tjslet.Checker.test('BatchEditDialog#editFields', editFields).isArray();\r\n\tdataset = jslet.data.getDataset(dataset);\r\n\tvar Z = this;\r\n\tZ._dataset = dataset;\r\n\tZ._editFields = editFields;\r\n\tZ._onChanging = null;\r\n\tZ._batchDataset = new jslet.data.Dataset({name: dataset.name() + '_batch' + jslet.nextId(), fields: []});\r\n\tvar fields = dataset.getEditableFields(), \r\n\t\tfldName, i;\r\n\tif(editFields && editFields.length > 0) {\r\n\t\tfor(i = editFields.length - 1; i >= 0; i--) {\r\n\t\t\tfldName = editFields[i];\r\n\t\t\tif(fields.indexOf(fldName) < 0) {\r\n\t\t\t\teditFields.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfields = editFields;\r\n\t}\r\n\tvar fldObj;\r\n\tfor(i = fields.length - 1; i >= 0; i--) {\r\n\t\tfldName = fields[i];\r\n\t\tfldObj = dataset.getField(fldName);\r\n\t\t//If the field value is unique, it can't be batch modified.\r\n\t\tif(fldObj.unique()) {\r\n\t\t\tfields.splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tZ._batchDataset.addFieldFromDataset(dataset, fields);\r\n\tfields = Z._batchDataset.getNormalFields();\r\n\tvar len = fields.length;\r\n\tfor(i = 0; i < len; i++) {\r\n\t\tfldObj = fields[i];\r\n\t\tfldObj.defaultValue(null);\r\n\t\tfldObj.defaultExpr(null);\r\n\t\tfldObj.required(false);\r\n\t}\r\n};\r\n\r\njslet.ui.BatchEditDialog.prototype = {\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Changing event. Fired when modify the field's value. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var dialog = new jslet.ui.BatchEditDialog(dsObj, 'fld1,fld2');\r\n\t *     dialog.onChanging(function(fldName, theValue) {});\r\n\t *     dialog.show();\r\n\t *     \r\n\t * @param {Function} onChanging Changing event handler.\r\n\t * @param {String} onChanging.fieldName The changing field name;\r\n\t * @param {Object} onChanging.theValue The changing field value;\r\n\t * \r\n\t * @return {Boolean} True - The terminal the default field changing action. False - Perform the default changing action.\r\n\t */\t\r\n\tonChanging: function(onChanging) {\r\n\t\tif(onChanging === undefined) {\r\n\t\t\treturn this._onChanging;\r\n\t\t}\r\n\t\tthis._onChanging = onChanging;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show the batch edit dialog.\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._batchDataset.records(null);\r\n\t\t\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar bedLocale = jsletlocale.BatchEditDialog;\r\n\t\t\r\n\t\tvar opt = { type: 'window', caption: bedLocale.caption, isCenter: true, resizable: true, minimizable: false, maximizable: false, animation: 'fade', styleClass: 'jl-bedlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar onlySelectedId = jslet.nextId(), \r\n\t\t\tonlyNullId = jslet.nextId();\r\n\t\t\r\n\t\tvar html = [\r\n\t\t            '<div class=\"input-group input-group-sm\">',\r\n\t\t            '<div class=\"jl-bedlg-fields\" data-jslet=\"type:\\'DBInspector\\',dataset:\\'', this._batchDataset.name(), \r\n\t\t            '\\'\"></div></div>',\r\n\r\n\t\t            '<div class=\"input-group input-group-sm jl-bedlg-option\">',\r\n\t\t            '<div class=\"col-sm-6\"><label><input id=\"' + onlySelectedId + '\" name=\"jlOnlySelected\" type=\"checkbox\" aria-label=\"...\">',\r\n\t\t            bedLocale.onlySelected,\r\n\t\t            '</label></div>',\r\n\t\t            '<div class=\"col-sm-6\"><label><input id=\"' + onlyNullId + '\" name=\"jlOnlyNull\" type=\"checkbox\" aria-label=\"...\">',\r\n\t\t            bedLocale.onlyNullValue,\r\n\t\t            '</label></div>',\r\n\t\t            '</div>',\r\n\t\t\t\t\t\r\n\t\t            '<div class=\"input-group input-group-sm jl-bedlg-toolbar\"><label class=\"control-label col-sm-7\">&nbsp</label>',\r\n\t\t            '<div class=\"col-sm-5\"><button name=\"jlbtnOk\" class=\"btn btn-default btn-sm\">',\t\t            \r\n\t\t            bedLocale.ok,\r\n\t\t            '</button><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm\">',\r\n\t\t            bedLocale.cancel,\r\n\t\t            '</button></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el), \r\n\t\t\tZ = this;\r\n\t\t\r\n\t\tjqEl.find('[name=jlbtnOk]').on('click', function(event) {\r\n\t\t\tvar onlySelected = jqEl.find('[name=jlOnlySelected]').prop('checked');\r\n\t\t\tvar onlyNull = jqEl.find('[name=jlOnlyNull]').prop('checked');\r\n\t\t\tif(Z._modifyData(onlySelected, onlyNull)) {\r\n\t\t\t\towin.close();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.find('[name=jlbtnCancel]').on('click', function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\t\r\n\t\tjslet.ui.install(owin.el);\r\n\t},\r\n\t\r\n\t_modifyData: function(onlySelected, onlyNull) {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._batchDataset;\r\n\t\tdsObj.confirm();\r\n\t\tif(dsObj.recordCount() === 0 || dsObj.existDatasetError()) {\r\n\t\t\tjslet.showInfo(jsletlocale.BatchEditDialog.errorData);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tdsObj.first();\r\n\t\tvar fldNames = [], fldObj, fldValue, inputValue = {},\r\n\t\t\tallFldObjs = dsObj.getNormalFields();\r\n\t\tfor(var i = 0, len = allFldObjs.length; i < len; i++) {\r\n\t\t\tfldObj = allFldObjs[i];\r\n\t\t\tfldValue = fldObj.getValue();\r\n\t\t\tif(fldValue !== null && fldValue !== undefined) {\r\n\t\t\t\tfldNames.push(fldObj.name());\r\n\t\t\t\tinputValue[fldObj.name()] = fldValue;\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\tvar cnt = fldNames.length, fldName;\r\n\t\tZ._dataset.iterate(function() {\r\n\t\t\tif(onlySelected && !this.selected()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var j = 0; j < cnt; j++) {\r\n\t\t\t\tfldName = fldNames[j];\r\n\t\t\t\tif(onlyNull) {\r\n\t\t\t\t\tfldValue = this.getFieldValue(fldName);\r\n\t\t\t\t\tif(fldValue !== null && fldValue !== '' && fldValue !== undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onChanging) {\r\n\t\t\t\t\tif(Z._onChanging.call(this, fldName, inputValue[fldName])) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.setFieldValue(fldName, inputValue[fldName]);\r\n\t\t\t}\r\n\t\t\tthis.confirm();\r\n\t\t});\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n\n/**\r\n * Show chart for a dataset. Example:\r\n * \r\n *     @example\r\n *     var dialog = new jslet.ui.ChartDialog(dsObj, options);\r\n *     dialog.show();\r\n *       \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name which the chart is shown on.\r\n * @param {Object} options Chart dialog options.\r\n * @param {Object} options.chartTypes See property \"chartTypes\".\r\n * @param {Object} options.categoryField See property \"categoryField\".\r\n * @param {Object} options.valueFields See property \"valueFields\".\r\n * @param {Object} options.excludeValueFields See property \"excludeValueFields\".\r\n * @param {Object} options.width See property \"width\".\r\n * @param {Object} options.height See property \"height\".\r\n */\r\njslet.ui.ChartDialog = function(dataset, options) {\r\n\tjslet.Checker.test('ChartDialog#dataset', dataset).required();\r\n\t\r\n\tvar Z = this;\r\n\tZ._dataset = jslet.data.getDataset(dataset);\r\n\t\r\n\tZ._width = 800;\r\n\tZ._height = 500;\r\n\r\n\tfunction setProp(options, propName) {\r\n\t\tif(options && options[propName] !== undefined && Z[propName] !== undefined) {\r\n\t\t\tZ[propName](options[propName]);\r\n\t\t}\r\n\t}\r\n\tsetProp(options, 'chartTypes');\r\n\tsetProp(options, 'categoryField');\r\n\tsetProp(options, 'valueFields');\r\n\tsetProp(options, 'excludeValueFields');\r\n\tsetProp(options, 'width');\r\n\tsetProp(options, 'height');\r\n\t\r\n\tZ._dlgId = null;\r\n\tZ._chartId = null;\r\n\tZ._parsedValueFields = null;\r\n\t\r\n\tZ._chartSettingDs = null;\r\n\tZ._chartSettingDsName = null;\r\n\tZ._chartTypeDs = null;\r\n\tZ._initialize();\r\n};\r\n\r\njslet.ui.ChartDialog.prototype = {\r\n\t\t\r\n\t_initialize: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartLocale = jsletlocale.ChartDialog;\r\n\t\tvar chartTypes = [{code: 'line', name:  chartLocale.ctLine}, \r\n\t\t                  {code: 'bar', name:  chartLocale.ctBar},\r\n\t\t                  {code: 'pie', name:  chartLocale.ctPie},\r\n\t\t\t              {code: 'stackbar', name:  chartLocale.ctStackBar}],\r\n\t\t\tchartTypeDs = new jslet.data.Dataset({name: 'chartTypeDs' + jslet.nextId(), isEnum: true, defaultValue: 'line', \r\n\t\t\t\trecords: chartTypes});\r\n\t\tvar ranges = [{code: jslet.data.RecordRange.ALL, name: chartLocale.rrAll}, \r\n\t\t              {code: jslet.data.RecordRange.CURRENT, name:  chartLocale.rrCurrent},\r\n\t\t\t          {code: jslet.data.RecordRange.SELECTED, name:  chartLocale.rrSelected}],\r\n\t\t\trangeDs = new jslet.data.Dataset({name: 'rangeDs' + jslet.nextId(), isEnum: true, defaultValue: 'line', \r\n\t\t\t\trecords: ranges});\r\n\t\t\r\n\t\tZ._chartTypeDs = chartTypeDs;\r\n\t\tvar valueFldLkDs = new jslet.data.Dataset({name: 'chartDlgDs' + jslet.nextId(), isEnum: true});\r\n\t\tvar fldCfg = [{name: 'chartType', dataType: 'S', label: chartLocale.chartType, lookup: {dataset: chartTypeDs}, required: true}, \r\n\t\t              {name: 'recordRange', dataType: 'N', label: chartLocale.recordRange, lookup: {dataset: rangeDs}, required: true, defaultValue: jslet.data.RecordRange.ALL},\r\n\t\t              {name: 'reverse', dataType: 'B', label: chartLocale.reverse, defaultValue: false, visible: false},\r\n\t\t              {name: 'valueFields', dataType: 'S', label: chartLocale.valueFields, required: true, lookup: {dataset: valueFldLkDs}, \r\n\t\t\tvalueStyle: jslet.data.FieldValueStyle.MULTIPLE, editControl: {type:\"DBComboSelect\", textReadOnly: true}}];\r\n\t\tZ._chartSettingDsName = 'chartSetting' + jslet.nextId();\r\n\t\tZ._chartSettingDs = new jslet.data.Dataset({name: Z._chartSettingDsName, fields: fldCfg});\r\n\t\tZ._chartSettingDs.appendRecord();\r\n\t\tZ._chartSettingDs.onFieldChanged(jQuery.proxy(Z._doFieldChanged, Z));\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the valid chart types, the optional values are: 'line', 'stackline', 'pie', 'bar', 'stackbar'.\r\n\t *     \r\n\t * @param {String[] | undefined} chartTypes The valid chart types;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\tchartTypes: function(chartTypes) {\r\n\t\tif(chartTypes === undefined) {\r\n\t\t\treturn this._chartTypes;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#chartTypes', chartTypes).isArray();\r\n\t\tthis._chartTypes = chartTypes;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the category field name of chart.\r\n\t *     \r\n\t * @param {String | undefined} categoryField The category field name;\r\n\t * \r\n\t * @return {this | String}\r\n\t */\t\r\n\tcategoryField: function(categoryField) {\r\n\t\tif(categoryField === undefined) {\r\n\t\t\treturn this._categoryField;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#categoryField', categoryField).isString().required();\r\n\t\tthis._categoryField = categoryField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the value fields name of chart. If this property is not set, it will use the all number fields as value fields.\r\n\t * \r\n\t * @param {String[] | undefined} valueFields The value field name;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\tvalueFields: function(valueFields) {\r\n\t\tif(valueFields === undefined) {\r\n\t\t\treturn this._valueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#valueFields', valueFields).isArray();\r\n\t\tthis._valueFields = valueFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get which the fields name can not be value fields.\r\n\t *     \r\n\t * @param {String[] | undefined} valueFields The exclude value field names;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\texcludeValueFields: function(excludeValueFields) {\r\n\t\tif(excludeValueFields === undefined) {\r\n\t\t\treturn this._excludeValueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#excludeValueFields', excludeValueFields).isArray();\r\n\t\tthis._excludeValueFields = excludeValueFields;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Set or get the dialog width.\r\n\t * \r\n\t * @param {Integer | undefined} width Dialog width;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog.width', width).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get the dialog height.\r\n\t * \r\n\t * @param {Integer | undefined} height Dialog height;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog.height', height).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show chart dialog.\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.Checker.test('ChartDialog#categoryField', Z._categoryField).isString().required();\r\n\t\tZ._refreshValueFields();\r\n\t\t\r\n\t\tif(!Z._parsedValueFields || Z._parsedValueFields.length === 0) {\r\n\t\t\tjslet.ui.info(jsletlocale.ChartDialog.valueFieldsRequired);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartTypes && Z._chartTypes.length > 0) {\r\n\t\t\tZ._chartTypeDs.filter('inArray([code], ' + JSON.stringify(Z._chartTypes) + ')');\r\n\t\t\tZ._chartTypeDs.filtered(true);\r\n\t\t} else {\r\n\t\t\tZ._chartTypeDs.filtered(false);\r\n\t\t}\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\tjslet('#' + Z._chartId).drawChart();\r\n\t},\r\n\t\r\n\t_refreshValueFields: function() {\r\n\t\tvar Z = this, i, len, fldObj, fldName;\r\n\t\tif(Z._valueFields && Z._valueFields.length > 0) {\r\n\t\t\tZ._parsedValueFields = Z._valueFields;\r\n\t\t} else {\r\n\t\t\tZ._parsedValueFields = [];\r\n\t\t\tvar fields = Z._dataset.getNormalFields(),\r\n\t\t\t\texFields = Z._excludeValueFields;\r\n\t\t\tfor(i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(fldObj.dataType() !== jslet.data.DataType.NUMBER || fldObj.lookup()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ._parsedValueFields.push(fldName); \r\n\t\t\t}\r\n\t\t}\r\n\t\tvar records = [], values = [];\r\n\t\tfor(i = 0, len = Z._parsedValueFields.length; i < len; i++) {\r\n\t\t\tfldName = Z._parsedValueFields[i];\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\trecords.push({code: fldName, name: fldObj.displayLabel()});\r\n\t\t\tvalues.push(fldName);\r\n\t\t}\r\n\t\tvar dsObj = Z._chartSettingDs,\r\n\t\t\tlkds = dsObj.getField('valueFields').lookup().dataset();\r\n\t\tdsObj.setFieldValue('valueFields', values);\r\n\t\tlkds.records(records);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartLocale = jsletlocale.ChartDialog;\r\n\t\tvar opt = { type: 'window', caption: chartLocale.caption, isCenter: true, resizable: true, minimizable: false, maximizable: true, animation: 'fade', styleClass: 'jl-chartdlg', \r\n\t\t\t\tonSizeChanged: function() {\r\n\t\t\t\t\twindow.setTimeout(function() {jslet('#' + Z._chartId).drawChart();}, 10);\r\n\t\t\t\t}};\r\n\t\tif(Z._width) {\r\n\t\t\topt.width = Z._width;\r\n\t\t}\r\n\t\tif(Z._height) {\r\n\t\t\topt.height = Z._height;\r\n\t\t}\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tvar chartCfg = \"type: 'DBChart', dataset: '\" + Z._dataset.name() + \r\n\t\t\t\"', categoryField: '\" + Z._categoryField + \r\n\t\t\t\"', valueFields: '\" + Z._parsedValueFields.join(',') + \"'\";\r\n\t\tvar html = '';\r\n\t\thtml += '<div class=\"jl-chartdlg-editor\" data-jslet=\"type: \\'DBEditPanel\\', dataset: \\'' + Z._chartSettingDsName + \r\n\t\t'\\'\"></div>';\r\n\t\thtml += '<div class=\"jl-chartdlg-chart\" data-jslet=\"' + chartCfg + '\" style=\"width: 100%;height: 100%\"></div>';\r\n\t\towin.setContent(html);\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\t\r\n\t\tjslet.ui.install(owin.el, function() {\r\n\t\t\tZ._chartId = jqEl.find('.jl-chartdlg-chart')[0].id;\r\n\t\t});\r\n\t},\r\n\r\n\t_doFieldChanged: function(fldName, fldValue) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._chartId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsObj = Z._chartSettingDs;\r\n\t\tvar chartObj = jslet('#' + Z._chartId);\r\n\t\tif(fldName === 'chartType') {\r\n\t\t\tif(fldValue === 'pie') {\r\n\t\t\t\tchartObj.chartType(fldValue);\r\n\t\t\t\tdsObj.getField('valueFields').valueStyle(jslet.data.FieldValueStyle.NORMAL);\r\n\t\t\t\tvar valueFlds = dsObj.getFieldValue('valueFields');\r\n\t\t\t\tif(valueFlds && jslet.isArray(valueFlds) && valueFlds.length > 1) {\r\n\t\t\t\t\tdsObj.setFieldValue('valueFields', valueFlds[0]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.getField('valueFields').valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fldName === 'valueFields' && jslet.isArray(fldValue)) {\r\n\t\t\tfldValue = fldValue.join(',');\r\n\t\t}\r\n\t\tchartObj[fldName](fldValue);\r\n\t\t\r\n\t\tchartObj.drawChart();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tvar Z = this;\r\n    \tif(Z._chartSettingDs) {\r\n    \t\tvar lkds = Z._chartSettingDs.getField('valueFields').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tZ._chartSettingDs.destroy();\r\n    \t\tZ._chartSettingDs = null;\r\n    \t}\r\n    \tZ._dataset = null;\r\n    \t\r\n\t}\r\n\r\n};\r\n\r\n\n/**\r\n * @class\r\n * \r\n * Export dialog for specified Dataset object. Example:\r\n * \r\n *     @example\r\n *     var dlg = new jslet.ui.ExportDialog('employee');\r\n *     //var dlg = new jslet.ui.ExportDialog(dsObj, {includeFields: ['fld1', 'fld2']});\r\n *     dlg.show('employee.xml');\r\n * \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name.\r\n * @param {Object} options (Optional)Export options. \r\n * @param {Boolean} options.hasSchemaSection Identify whether export schema section is visible or not. \r\n * @param {String[]} options.includeFields Specify which fields need export. \r\n * @param {String[]} options.excludeFields Specify which fields need not export. \r\n */\r\njslet.ui.ExportDialog = function(dataset, options) {\r\n\tthis._dataset = jslet.data.getDataset(dataset);\r\n\t\r\n\tthis._exportDataset = null;\r\n\t\r\n\tthis._dlgId = null;\r\n\t\r\n\tthis._onExported = null;\r\n\r\n\tthis._onQuerySchema = null;\r\n\t\r\n\tthis._onSubmitSchema = null;\r\n\t\r\n\tthis._progressBar = null;\r\n\r\n\tthis._hasSchemaSection = false;\r\n\t\r\n\tthis._includeFields = null;\r\n\t\r\n\tthis._excludeFields = null;\r\n\t\r\n\tif(options) {\r\n\t\tthis._hasSchemaSection = (options.hasSchemaSection? true: false);\r\n\t\tthis._includeFields = options.includeFields;\r\n\t\tthis._excludeFields = options.excludeFields;\r\n\t}\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.ExportDialog.prototype = {\r\n\t/**\r\n\t * Show export dialog.\r\n\t * \r\n\t * @param {String} fileName Excel file name.\r\n\t */\t\r\n\tshow: function(fileName) {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.confirm();\r\n\t\tif(Z._dataset.existDatasetError()) {\r\n\t        jslet.ui.confirm(jsletlocale.ExportDialog.existedErrorData, null, function(button){\r\n\t        \tif(button == 'cancel') {\r\n\t        \t\treturn;\r\n\t        \t}\r\n\t    \t\treturn Z._innerShow(fileName);\r\n\t        });\r\n\t\t} else {\r\n\t\t\treturn Z._innerShow(fileName);\r\n\t\t}\r\n        \r\n\t},\r\n\t\r\n\t_innerShow: function(fileName) {\r\n\t\tvar Z = this;\r\n    \tif(Z._hasSchemaSection) {\r\n\t    \tvar exportDsClone = Z._exportDataset;\r\n\t\t\tZ._querySchema();\r\n    \t}\r\n\t\tZ._hasDetailDataset = false;\r\n\t\tZ._refreshFields();\r\n\t\tvar jqEl = jQuery('#' + this._dlgId);\r\n\t\tvar owin = jqEl[0].jslet;\r\n\t\tfileName = (fileName || Z._dataset.description() + '.xlsx');\r\n\t\tvar jqExpportFile = jqEl.find('[name=\"jltxtExportFile\"]');\r\n\t\tjqExpportFile.val(fileName);\r\n\t\tif(Z._hasDetailDataset) {\r\n\t\t\tjqEl.find('[name=\"jlOnlyOnceDiv\"]').show();\r\n\t\t}\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\treturn owin;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Query export schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset, {hasSchemaSection: true});\r\n\t *     var querySchemaFn = function(callBackFn) {\r\n\t * \t      var exportSchemaData = [{schema: '', fields: ['field1','field2']}];\r\n\t * \t      callBackFn(exportSchemaData); //For asynchronous operation.\r\n\t * \t     //return exportSchemaData; \t//For synchronous operation.\r\n\t *     };\r\n\t * \r\n\t *     exportDialog.onQuerySchema(querySchemaFn);\r\n\t *     \r\n\t * @param {Function} onQuerySchema Query schema event handler.\r\n\t * @param {Function} onQuerySchema.callBackFn Query schema callback function.\r\n\t * @param {Function} onQuerySchema.callBackFn.exportSchemaData Query schema.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonQuerySchema: function(onQuerySchema) {\r\n\t\tif(onQuerySchema === undefined) {\r\n\t\t\treturn this._onQuerySchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onQuerySchema', onQuerySchema).isFunction();\r\n\t\tthis._onQuerySchema = onQuerySchema;\r\n\t\treturn this;\r\n\t},\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Submit export schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset, {hasSchemaSection: true});\r\n\t *     var submitSchemaFn = function(action, changedRec) {\r\n\t * \t     if(action == 'insert') {}\r\n\t * \t     if(action == 'update') {}\r\n\t * \t     if(action == 'delete') {}\r\n\t *     };\r\n\t * \r\n\t *     exportDialog.onSubmitSchema(submitSchemaFn);\r\n\t *     \r\n\t * @param {Function | undefined} onSubmitSchema Submitting schema event handler.\r\n\t * @param {String} onSubmitSchema.action Submit action, optional value: 'insert', 'update', 'delete'.\r\n\t * @param {Object} onSubmitSchema.changedRecord Changed record.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSubmitSchema: function(onSubmitSchema) {\r\n\t\tif(onSubmitSchema === undefined) {\r\n\t\t\treturn this._onSubmitSchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onSubmitSchema', onSubmitSchema).isFunction();\r\n\t\tthis._onSubmitSchema = onSubmitSchema;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Exported event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset);\r\n\t *     exportDialog.onExported(function(dataset) {});\r\n\t * \r\n\t * @param {Function | undefined} onExported Exported event.\r\n\t * @param {jslet.data.Dataset} onExported.dataset Exporting dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonExported: function(onExported) {\r\n\t\tif(onExported === undefined) {\r\n\t\t\treturn this._onExported;\r\n\t\t}\r\n\t\tjslet.Checker.test('ExportDialog#onExported', onExported).isFunction();\r\n\t\tthis._onExported = onExported;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tvar edLocale = jsletlocale.ExportDialog;\r\n\t\tvar fldCfg = [\r\n\t\t    \t      {name: 'field', type: 'S', length: 100, label: 'Field Name', nullText: 'default'}, \r\n\t\t    \t      {name: 'label', type: 'S', length: 50, label: 'Field Label'},\r\n\t\t    \t      {name: 'parent', type: 'S', length: 100, label: 'Field Name'}, \r\n\t\t    \t      {name: 'required', type: 'B', length: 8, visible: false} \r\n\t\t    \t    ];\r\n\t\tvar exportLKDs = new jslet.data.Dataset({name: 'exportLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'field', codeField: 'field', nameField: 'label', parentField: 'parent', isFireGlobalEvent: false});\r\n\t\texportLKDs.onCheckSelectable(function(){\r\n\t        return !this.hasChildren(); \r\n\t    });\r\n\t\t\r\n\t\tvar expFldCfg = [\r\n    \t      {name: 'schema', type: 'S', length: 30, label: 'Export Schema'}, \r\n    \t      {name: 'fields', type: 'S', length: 500, label: 'Export Fields', visible: false, valueStyle: jslet.data.FieldValueStyle.MULTIPLE, lookup: {dataset: exportLKDs}}\r\n    \t    ];\r\n\t\tvar Z = this;\r\n    \tZ._exportDataset = new jslet.data.Dataset({name: 'exportDs' + jslet.nextId(), fields: expFldCfg, keyField: 'schema', nameField: 'schema', isFireGlobalEvent: false});\r\n\t\tvar opt = { type: 'window', caption: edLocale.caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar expHtml = '';\r\n    \tif(Z._hasSchemaSection) {\r\n    \t\texpHtml = \r\n\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\"><span class=\"input-group-addon\">' +\r\n\t            edLocale.schemaName + \r\n\t            '</span>' + \r\n\t            '<select data-jslet=\"type:\\'DBSelectView\\', displayFields:\\'schema\\'\"></select>' + \r\n\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSaveAs\">' + \r\n\t            edLocale.saveAsSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSave\">' + \r\n\t            edLocale.saveSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnDelete\">' + \r\n\t            edLocale.deleteSchema + \r\n\t            '</button></span>' +\r\n\t            '</div>';\r\n    \t}\r\n\t\tvar html = ['<div class=\"form-horizontal jl-expdlg-content\" data-jslet=\"dataset: \\'', Z._exportDataset.name(),\r\n\t\t            '\\'\">',\r\n\t\t            expHtml,\r\n\t\t            '<div class=\"input-group input-group-sm\" style=\"width: 100%;margin-bottom: 10px\">',\r\n\t\t            '<div class=\"col-sm-12 jl-expdlg-fields\" data-jslet=\"type:\\'DBList\\',field:\\'fields\\',correlateCheck:true\" style=\"padding:0px!important\"></div></div>',\r\n\r\n\t\t            '<div class=\"input-group input-group-sm\"><span class=\"input-group-addon\">',\r\n\t\t            edLocale.fileName,\r\n\t\t            '</span>',\r\n\t\t\t\t\t'<input name=\"jltxtExportFile\" class=\"form-control\"></input>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"checkbox col-sm-6\">',\r\n\t\t\t\t\t'<label>',\r\n\t\t\t\t\t'<input name=\"jlOnlySelected\" type=\"checkbox\">', edLocale.onlySelected,\r\n\t\t\t\t    '</label>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"checkbox col-sm-6\" name=\"jlOnlyOnceDiv\" style=\"display:none\">',\r\n\t\t\t\t\t'<label>',\r\n\t\t\t\t\t'<input name=\"jlOnlyOnce\" type=\"checkbox\" checked=\"true\">', edLocale.onlyOnce,\r\n\t\t\t\t    '</label>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"col-sm-12\"></div>',\r\n\t\t            '<div class=\"input-group input-group-sm jl-expdlg-toolbar\" style=\"margin-bottom: 0;width:100%\">',\r\n\t\t            '<div class=\"col-sm-8\"><div name=\"jlProgressExport\" data-jslet=\"type:\\'ProgressBar\\', value: 50\" style=\"display:none;width:100%\"></div></div><div class=\"col-sm-4\"><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm jl-expdlg-toolbutton\">',\r\n\t\t            edLocale.cancel,\r\n\t\t            '</button><button name=\"jlbtnExport\" class=\"btn btn-default btn-sm jl-expdlg-toolbutton\">',\r\n\t\t            edLocale.exportData,\r\n\t\t            '</button></div></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tjslet.ui.install(owin.el);\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tZ._progressBar = jqEl.find('[name=\"jlProgressExport\"]')[0].jslet;\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnExport\"]').click(function(event) {\r\n\t\t\tZ._exportData();\r\n\t\t});\r\n\t\tjqEl.find('[name=\"jlbtnSave\"]').click(function(event) {\r\n\t\t\tZ._saveSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnSaveAs\"]').click(function(event) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnDelete\"]').click(function(event) {\r\n\t\t\tZ._deleteSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnCancel\"]').click(function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t},\r\n\t\r\n\t_saveSchema: function() {\r\n\t\tvar dsExport = this._exportDataset;\r\n\t\tif(!dsExport.getFieldValue('schema')) {\r\n\t\t\tthis._saveAsSchema();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsExport.confirm();\r\n\t\tvar currRec = dsExport.getRecord();\r\n\t\tthis._submitSchema('update', {schema: currRec.schema, fields: currRec.fields});\r\n\t},\r\n\t\r\n\t_saveAsSchema: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.prompt(jsletlocale.ExportDialog.inuputSchemaLabel, null, function(button, value){\r\n\t\t\tif(button === 'ok' && value) {\r\n\t\t\t\tvar fields = Z._exportDataset.getFieldValue('fields');\r\n\t\t\t\tvar dsObj = Z._exportDataset;\r\n\t\t\t\tdsObj.disableControls();\r\n\t\t\t\tZ._isProgChanged = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdsObj.cancel();\r\n\t\t\t\t\tdsObj.appendRecord();\r\n\t\t\t\t\tdsObj.setFieldValue('schema', value);\r\n\t\t\t\t\tdsObj.setFieldValue('fields', fields);\r\n\t\t\t\t\tdsObj.confirm();\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._isProgChanged = false;\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t}\r\n\t\t\t\tvar currRec = Z._exportDataset.getRecord();\r\n\t\t\t\tZ._submitSchema('insert', {schema: currRec.schema, fields: currRec.fields});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_deleteSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcurrRec = this._exportDataset.getRecord();\r\n\t\tvar result = this._submitSchema('delete', {schema: currRec.schema, fields: currRec.fields});\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function() {\r\n\t\t\t\tZ._exportDataset.deleteRecord();\r\n\t\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\t\tZ._refreshFields();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._exportDataset.deleteRecord();\r\n\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\tZ._refreshFields();\r\n\t\t\t}\r\n\t\t}\r\n\t},\t\r\n\r\n\t_querySchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tqueryFn = this._onQuerySchema || jslet.global.exportDialog.onQuerySchema;\r\n\t\tif(!queryFn) {\r\n\t\t\tconsole.warn('Event handler: onQuerySchema NOT set, can not query export schema!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar result = queryFn();\r\n\t\tif(jslet.isPromise(result)) {\r\n\t\t\tresult.done(function(schemaData) {\r\n\t\t\t\tif(schemaData) {\r\n\t\t\t\t\tZ._exportDataset.records(schemaData);\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\t\tZ._refreshFields();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif(result) {\r\n\t\t\t\tZ._exportDataset.records(result);\r\n\t\t\t}\r\n\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\tZ._refreshFields();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_submitSchema: function(action, changedRecord) {\r\n\t\tvar Z = this,\r\n\t\t\tactionFn = Z._onSubmitSchema || jslet.global.exportDialog.onSubmitSchema;\r\n\t\tif(actionFn) {\r\n\t\t\treturn actionFn(action, changedRecord);\r\n\t\t} else {\r\n\t\t\tconsole.warn('Event handler: onSubmitSchema NOT set, can not save export schema!');\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_exportData: function() {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery('#' + Z._dlgId);\r\n\t\tvar jqExpportFile = jqEl.find('[name=\"jltxtExportFile\"]');\r\n\t\tvar fileName = jqExpportFile.val();\r\n\t\tif(!fileName || !fileName.trim()) {\r\n\t\t\tjslet.showInfo(jsletlocale.ExportDialog.fileAndFieldsRequired);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fields = Z._exportDataset.getFieldValue('fields');\r\n\t\tif(!fields || fields.length === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ExportDialog.fileAndFieldsRequired);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tjqEl.find('[name=\"jlProgressExport\"]').css('display', '');\r\n\t\tvar onlySelected = jqEl.find('[name=\"jlOnlySelected\"]').prop('checked');\r\n\t\tvar onlyOnce = jqEl.find('[name=\"jlOnlyOnce\"]').prop('checked');\r\n\t\tjslet.data.defaultXPorter.excelXPorter().exportData(Z._dataset, fileName, \r\n\t\t\t\t{includeFields: fields, onlySelected: onlySelected, onlyOnce: onlyOnce, exportAggregated: true, \r\n\t\t\tonExporting: jQuery.proxy(Z._doExporting, Z), \r\n\t\t\tonExported: jQuery.proxy(Z._doExported, Z)});\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_doExported: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onExported) {\r\n\t\t\tZ._onExported.call(Z, Z._dataset);\r\n\t\t}\r\n\t\tjslet('#' + Z._dlgId).close();\r\n\t},\r\n\t\r\n\t_doExporting: function(percent) {\r\n\t\tthis._progressBar.value(percent);\r\n\t},\r\n\t\r\n\t_refreshFields: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfieldRecords = [{field: '_all_', label: jsletlocale.ExportDialog.all}],\r\n\t\t\tfieldNames = [],\r\n\t\t\tincludeFields = Z._includeFields,\r\n\t\t\texcludeFields = Z._excludeFields;\r\n\t\t\r\n\t\tfunction addFields(fieldRecords, fieldNames, fields, parentField, isDetailDs) {\r\n\t\t\tvar fldObj, fldName, dataType;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tdataType = fldObj.dataType();\r\n\t\t\t\tvar isActionCol = (dataType === jslet.data.DataType.ACTION);\r\n\t\t\t\tvar isEdtActCol = (dataType === jslet.data.DataType.EDITACTION);\r\n\t\t\t\tif(isActionCol || isEdtActCol) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(parentField && isDetailDs) {\r\n\t\t\t\t\tfldName = parentField + '.' + fldName;\r\n\t\t\t\t}\r\n\t\t\t\tvar detailDs = fldObj.detailDataset();\r\n\t\t\t\tif(detailDs) {\r\n\t\t\t\t\tZ._hasDetailDataset = true;\r\n\t\t\t\t\tfieldRecords.push({field: fldName, label: fldObj.label(), parent: parentField || '_all_'});\r\n\t\t\t\t\taddFields(fieldRecords, fieldNames, detailDs.getNormalFields(), fldName, true);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(includeFields) {\r\n\t\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t\tif(excludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar required = fldObj.required();\r\n\t\t\t\tfieldRecords.push({field: fldName, label: fldObj.label() + (required? '<span class=\"jl-lbl-required\">*</span>': ''), \r\n\t\t\t\t\tparent: parentField || '_all_', required: required});\r\n\t\t\t\tvar fldChildren = fldObj.children();\r\n\t\t\t\tif(fldChildren) {\r\n\t\t\t\t\taddFields(fieldRecords, fieldNames, fldChildren, fldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfieldNames.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\taddFields(fieldRecords, fieldNames, this._dataset.getFields());\r\n\t\tvar exportLKDs = this._exportDataset.getField('fields').lookup().dataset();\r\n\t\texportLKDs.records(fieldRecords);\r\n\t\tthis._exportDataset.setFieldValue('fields', fieldNames);\r\n\t\texportLKDs.first();\r\n\t},\r\n\r\n\tdestroy: function() {\r\n    \tif(this._exportDataset) {\r\n    \t\tvar lkds = this._exportDataset.getField('fields').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tthis._exportDataset.destroy();\r\n    \t\tthis._exportDataset = null;\r\n    \t}\r\n    \tthis._dataset = null;\r\n    \tthis._progressBar = null;\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * A dialog to view image. Example:\r\n * \r\n *     @example\r\n *     var imgViewer = new jslet.ui.ImageViewer({width: 500, height: 600, isModal: true});\r\n *     imgViewer.show('./img/igm1.jpg', 'Dog');\r\n * \r\n * @param {Object} dialogCfg Dialog configuration.\r\n * @param {Integer} dialogCfg.width Dialog width.\r\n * @param {Integer} dialogCfg.height Dialog height.\r\n * @param {Boolean} dialogCfg.isModal Show image viewer as a modal dialog. \r\n */\r\njslet.ui.ImageViewer = function(dialogCfg) {\r\n\tthis._imageUrl = null;\r\n\tthis._width = 400;\r\n\tthis._height = 500;\r\n\tthis._isModal = false;\r\n\tif(dialogCfg){\r\n\t\tif(dialogCfg.width) {\r\n\t\t\tthis.width(dialogCfg.width);\r\n\t\t}\r\n\t\tif(dialogCfg.height) {\r\n\t\t\tthis.height(dialogCfg.height);\r\n\t\t}\r\n\t\tthis.isModal(dialogCfg.isModal);\r\n\t}\r\n};\r\n\r\njslet.ui.ImageViewer.prototype = {\r\n\t\r\n\t/**\r\n\t * Set or get the dialog width.\r\n\t * \r\n\t * @param {Integer | undefined} width Dialog width;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImageViewer.width', width).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get the dialog height.\r\n\t * \r\n\t * @param {Integer | undefined} height Dialog height;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImageViewer.height', height).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify showing the dialog as modal or not.\r\n\t * \r\n\t * @param {Boolean | undefined} isModal True - Showing as modal, false -otherwise;\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tisModal: function(isModal) {\r\n\t\tif(isModal === undefined) {\r\n\t\t\treturn this._isModal;\r\n\t\t}\r\n\t\tthis._isModal = isModal? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set image URL and show it.\r\n\t * \r\n\t * @param {String} imageUrl Image URL.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\timageUrl: function(imageUrl) {\r\n\t\tthis._imageUrl = imageUrl;\r\n\t\tthis.show(imageUrl);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show dialog.\r\n\t * \r\n\t */\r\n\tshow: function(imageUrl, name) {\r\n\t\tvar Z = this;\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\tvar jqViewer = jQuery(owin.el).find('*[name=viewer]').css('background-image', 'url(' + imageUrl + ')');\r\n\t\towin.changeCaption(jsletlocale.ImageViewer.caption + (name? ' - ' + name: ''));\r\n\t\tif(Z._isModal) {\r\n\t\t\towin.showModal();\r\n\t\t} else {\r\n\t\t\towin.show();\r\n\t\t}\r\n\t\t\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar opt = { type: 'window', caption: jsletlocale.ImageViewer.caption, isCenter: true, resizable: true, minimizable: false, maximizable: true, \r\n\t\t\t\twidth: this._width, height: this._height, animation: 'fade', styleClass: 'jl-isdlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar html = '<div name=\"viewer\" style=\"width: 100%; height: 100%;background-size:contain;background-origin:content;background-position:50% 50%;background-repeat:no-repeat;\"/>';\r\n\t\towin.setContent(html);\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tjslet.ui.install(owin.el);\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * Import dialog for specified Dataset object. Example:\r\n * \r\n *     @example\r\n *     var dlg = new jslet.ui.ImportDialog(dsObj, {includeFields: ['fld1', 'fld2']});\r\n *     var dlg = new jslet.ui.ImportDialog('employee');\r\n * \r\n * @param {jslet.data.Dataset | String} dataset (Required)Dataset object or dataset name.\r\n * @param {Object} options (Optional)Import options. \r\n * @param {Boolean} options.hasSchemaSection Identify whether import schema section is visible or not. \r\n * @param {String[]} options.includeFields Specify which fields need import. \r\n * @param {String[]} options.excludeFields Specify which fields need not import. \r\n */\r\njslet.ui.ImportDialog = function(dataset, options) {\r\n\tthis._dataset = jslet.data.getDataset(dataset);\r\n\tthis._importDataset = null;\r\n\t\r\n\tthis._parsedData = null;\r\n\t\r\n\tthis._dlgId = null;\r\n\t\r\n\tthis._onCustomImport = null;\r\n\tthis._onImporting = null;\r\n\tthis._onImported = null;\r\n\t\r\n\tthis._onQuerySchema = null;\r\n\tthis._onSubmitSchema = null;\r\n\t\r\n\tthis._schemaDsName = null;\r\n\tthis._schemaLkDsName = null;\r\n\t\r\n\tthis._colHeaders = null;\r\n\t\r\n\tthis._progressBar = null;\r\n\t\r\n\tthis._hasSchemaSection = false;\r\n\t\r\n\tthis._includeFields = null;\r\n\t\r\n\tthis._excludeFields = null;\r\n\t\r\n\tif(options) {\r\n\t\tthis._hasSchemaSection = (options.hasSchemaSection? true: false);\r\n\t\tthis._includeFields = options.includeFields;\r\n\t\tthis._excludeFields = options.excludeFields;\r\n\t}\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.ImportDialog.prototype = {\r\n\t/**\r\n\t * Show import dialog\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._hasSchemaSection) {\r\n\t\t\tZ._querySchema();\r\n\t\t}\r\n\t\tZ._refreshFields();\r\n\t\tvar jqEl = jQuery('#' + this._dlgId);\r\n\t\tjqEl.find('#jltxtImportFile').val('');\r\n\t\tvar owin = jqEl[0].jslet;\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\treturn owin;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Query import schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset, {hasSchemaSection: true});\r\n\t *     var querySchemaFn = function(callBackFn) {\r\n\t * \t      var exportSchemaData = [{schema: '', fields: ['field1','field2']}];\r\n\t * \t      callBackFn(exportSchemaData); //For asynchronous operation.\r\n\t * \t     //return exportSchemaData; \t//For synchronous operation.\r\n\t *     };\r\n\t * \r\n\t *     importDialog.onQuerySchema(querySchemaFn);\r\n\t *     \r\n\t * @param {Function} onQuerySchema Query schema event handler.\r\n\t * @param {Function} onQuerySchema.callBackFn Query schema callback function.\r\n\t * @param {Function} onQuerySchema.callBackFn.exportSchemaData Query schema.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonQuerySchema: function(onQuerySchema) {\r\n\t\tif(onQuerySchema === undefined) {\r\n\t\t\treturn this._onQuerySchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onQuerySchema', onQuerySchema).isFunction();\r\n\t\tthis._onQuerySchema = onQuerySchema;\r\n\t\treturn this;\r\n\t},\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Submit import schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset, {hasSchemaSection: true});\r\n\t *     var submitSchemaFn = function(action, changedRec) {\r\n\t * \t     if(action == 'insert') {}\r\n\t * \t     if(action == 'update') {}\r\n\t * \t     if(action == 'delete') {}\r\n\t *     };\r\n\t * \r\n\t *     importDialog.onSubmitSchema(submitSchemaFn);\r\n\t *     \r\n\t * @param {Function | undefined} onSubmitSchema Submitting schema event handler.\r\n\t * @param {String} onSubmitSchema.action Submit action, optional value: 'insert', 'update', 'delete'.\r\n\t * @param {Object} onSubmitSchema.changedRecord Changed record.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSubmitSchema: function(onSubmitSchema) {\r\n\t\tif(onSubmitSchema === undefined) {\r\n\t\t\treturn this._onSubmitSchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onSubmitSchema', onSubmitSchema).isFunction();\r\n\t\tthis._onSubmitSchema = onSubmitSchema;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Customized importing event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.onCustomImport(function(importingDataset, parsedData, fieldMaps) { });\r\n\t *     \r\n\t * @param {Function | undefined} onCustomImport Customized importing event.\r\n\t * @param {jslet.data.Dataset} onCustomImport.importingDataset Importing dataset object.\r\n\t * @param {Object[]} onCustomImport.parsedData Parsed data from excel file.\r\n\t * @param {Object[]} onCustomImport.fieldMaps Field map to excel header.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCustomImport: function(onCustomImport) {\r\n\t\tif(onCustomImport === undefined) {\r\n\t\t\treturn this._onCustomImport;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onCustomImport', onCustomImport).isFunction();\r\n\t\tthis._onCustomImport = onCustomImport;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Importing event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.onImporting(function(fieldName, excelColValue) { });\r\n\t *     \r\n\t * @param {Function | undefined} onImporting Importing event.\r\n\t * @param {String} onImporting.fieldName The importing field name.\r\n\t * @param {String} onImporting.excelColValue The mapping column value of excel file.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonImporting: function(onImporting) {\r\n\t\tif(onImporting === undefined) {\r\n\t\t\treturn this._onImporting;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onImporting', onImporting).isFunction();\r\n\t\tthis._onImporting = onImporting;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Imported event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.imported(function(dataset) { });\r\n\t *     \r\n\t * @param {Function | undefined} onImported Imported event.\r\n\t * @param {jslet.data.Dataset} onImported.dataset Importing dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonImported: function(onImported) {\r\n\t\tif(onImported === undefined) {\r\n\t\t\treturn this._onImported;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onImported', onImported).isFunction();\r\n\t\tthis._onImported = onImported;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fldCfg = [\r\n\t\t              {name: 'schema', type: 'S', length: 100, label: 'Schema'},\r\n\t\t              {name: 'fieldMaps', type: 'S', length: 5000, label: 'fieldMaps', visible: false},\r\n\t\t              {name: 'colHeaders', type: 'S', length: 5000, label: 'fieldMaps', visible: false}\r\n\t\t              ];\r\n\t\tvar schemaLKDs = new jslet.data.Dataset({name: 'schemaLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'schema', codeField: 'schema', nameField: 'schema', autoRefreshHostDataset: true, auditLogEnabled: false, logChanges: false});\r\n\t\t\r\n\t\tvar importDialogLocale = jsletlocale.ImportDialog;\r\n\t\tZ._schemaLkDsName = schemaLKDs.name();\r\n\t\tfldCfg = [\r\n\t\t    {name: 'schema', type: 'S', length: 100, label: 'Schema', lookup: {dataset: schemaLKDs}}\r\n        ];\t\t\r\n\t\tZ._schemaDsName = 'schemaDs' + jslet.nextId();\r\n\t\tvar schemaDs = new jslet.data.Dataset({name: Z._schemaDsName, fields: fldCfg}); \r\n\t\tschemaDs.onFieldChanged(function(fldName, fldValue) {\r\n\t\t\tZ._doSchemaChanged(this, fldValue);\r\n\t\t});\r\n\t\t\r\n\t\tfldCfg = [\r\n\t    \t      {name: 'colHeader', type: 'S', length: 100, label: 'Column Header', displayWidth: 16}\r\n\t    \t    ];\r\n\t\tvar exportLKDs = new jslet.data.Dataset({name: 'exportLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'colHeader', codeField: 'colHeader', nameField: 'colHeader', autoRefreshHostDataset: true});\r\n\t\t\r\n\t\tvar expFldCfg = [\r\n       \t      {name: 'field', type: 'S', length: 100, label: 'Field Name', visible: false}, \r\n\t   \t      {name: 'label', type: 'S', length: 100, visible: false},\r\n\t   \t      {name: 'displayLabel', type: 'S', length: 100, label: importDialogLocale.fieldLabel, displayWidth: 12, readOnly: true},\r\n    \t      {name: 'colHeader', type: 'S', length: 100, label: importDialogLocale.columnHeader, displayWidth: 12, editControl: 'DBSelect',\r\n    \t    \t  lookup: {dataset: exportLKDs}},\r\n    \t      {name: 'required', type: 'B', length: 10, label: 'required', visible: false},\r\n    \t      {name: 'fixedValue', type: 'S', length: 50, label: importDialogLocale.fixedValue, displayWidth: 12}\r\n    \t    ];\r\n    \tZ._importDataset = new jslet.data.Dataset({name: 'importDs' + jslet.nextId(), fields: expFldCfg, keyField: 'schema', nameField: 'schema', isFireGlobalEvent: false});\r\n\t\tvar opt = { type: 'window', caption: importDialogLocale.caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar expHtml = '';\r\n    \tif(Z._hasSchemaSection) {\r\n    \t\texpHtml = \r\n\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\"><span class=\"input-group-addon\">' +\r\n\t            importDialogLocale.schemaName + \r\n\t            '</span>' + \r\n\t            '<select data-jslet=\"type:\\'DBSelect\\',dataset: \\'' + schemaDs.name() + '\\', field:\\'schema\\'\"></select>' + \r\n\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSaveAs\">' + \r\n\t            importDialogLocale.saveAsSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSave\">' + \r\n\t            importDialogLocale.saveSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnDelete\">' + \r\n\t            importDialogLocale.deleteSchema + \r\n\t            '</button></span>' +\r\n\t            '</div>';\r\n    \t}\r\n\r\n\t\tvar html = ['<div class=\"form-horizontal jl-impdlg-content\">',\r\n\t            expHtml,\r\n\t            '<div class=\"input-group input-group-sm\"><span class=\"input-group-addon\">',\r\n\t            importDialogLocale.fileName,\r\n\t            '</span>',\r\n\t\t\t\t'<input name=\"jltxtImportFile\" title=\"*.xls|*.xlsx|*.xlsb|*.xlsm|*.ods\" class=\"form-control\" type=\"file\"></input>',\r\n\t\t\t\t'</div>',\r\n\t\t\t\t\r\n\t            '<div class=\"col-sm-12 jl-impdlg-fieldmap\" style=\"padding: 0!important\">',\r\n\t            '<div data-jslet=\"type:\\'DBTable\\', dataset: \\'', \r\n\t            Z._importDataset.name(), \r\n\t            '\\', editable: true, hasFilterDialog:false, disableHeadSort: true\"></div></div>',\r\n\r\n\t\t\t\t'<div class=\"col-sm-12\"></div>',\r\n\t            '<div class=\"input-group input-group-sm jl-impdlg-toolbar\" style=\"margin-bottom: 0;width:100%\">',\r\n\t            '<div class=\"col-sm-9\"><div name=\"jlProgressImport\" data-jslet=\"type:\\'ProgressBar\\', value: 50\" style=\"display:none;width:100%\"></div></div>',\r\n\t            '<div class=\"col-sm-3\"><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm jl-impdlg-toolbutton\">',\r\n\t            importDialogLocale.cancel,\r\n\t            '</button><button name=\"jlbtnImport\" class=\"btn btn-default btn-sm jl-impdlg-toolbutton\">',\r\n\t            importDialogLocale.importData,\r\n\t            '</button></div></div></div>',\r\n\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tjslet.ui.install(owin.el);\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tZ._progressBar = jqEl.find('[name=\"jlProgressImport\"]')[0].jslet;\r\n\r\n\t\tjqEl.find('[name=\"jlbtnSaveAs\"]').click(function(event) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnSave\"]').click(function(event) {\r\n\t\t\tZ._saveSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnDelete\"]').click(function(event) {\r\n\t\t\tZ._deleteSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jltxtImportFile\"]').on('change', function(event) {\r\n\t\t\tvar files = event.delegateTarget.files;\r\n\t\t\tif(files.length > 0) {\r\n\t\t\t\tZ._readFile(files[0]);\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.find('[name=\"jlbtnImport\"]').click(function(event) {\r\n\t\t\tZ._importData();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnCancel\"]').click(function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t}, //End of '_initialize'\r\n\t\r\n\t_querySchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tqueryFn = this._onQuerySchema || jslet.global.importDialog.onQuerySchema;\r\n\t\t\r\n\t\tfunction innerRefresh(schemaData) {\r\n\t\t\tif(!schemaData) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tjslet.data.getDataset(Z._schemaLkDsName).records(schemaData);\r\n\t\t}\r\n\t\t\r\n\t\tif(!queryFn) {\r\n\t\t\tconsole.warn('Event handler: onQuerySchema NOT set, can not query export schema!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = queryFn();\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function(schemaData) {\r\n\t\t\t\tinnerRefresh(schemaData);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tinnerRefresh(result);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_submitSchema: function(action, changedRecord) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tvar actionFn = Z._onSubmitSchema || jslet.global.importDialog.onSubmitSchema;\r\n\t\tif(actionFn) {\r\n\t\t\tdelete changedRecord._jl_;\r\n\t\t\treturn actionFn(action, changedRecord);\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_saveAsSchema: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.prompt(jsletlocale.ExportDialog.inuputSchemaLabel, null, function(button, schemaName){\r\n\t\t\tif(button === 'ok' && schemaName) {\r\n\t\t\t\tvar dsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\t\t\tvar dsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName);\r\n\t\t\t\tvar context = dsSchemaLk.startSilenceMove();\r\n\t\t\t\tvar foundRecno = -1;\r\n\t\t\t\tvar breakDown = false;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif(dsSchemaLk.findByKey(schemaName)) {\r\n\t\t            \tfoundRecno = dsSchemaLk.recno();\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tdsSchemaLk.endSilenceMove(context);\r\n\t\t\t\t}\r\n\t\t\t\tif(foundRecno >= 0) {\r\n\t\t            jslet.ui.confirm(jsletlocale.ImportDialog.existedSchema, null, function(button){\r\n\t\t            \tif(button == 'cancel') {\r\n\t\t            \t\treturn;\r\n\t\t            \t}\r\n\t\t            \tdsSchemaLk.recno(foundRecno);\r\n\t\t\t\t\t\tdsSchemaLk.editRecord();\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('fieldMaps', strMaps);\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\t\t\t\tdsSchemaLk.confirm();\r\n\t\t\t\t\t\tZ._isSaving = true;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tdsSchema.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tZ._isSaving = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tZ._submitSchema('insert', dsSchemaLk.getRecord());\r\n\t\t            });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdsSchemaLk.appendRecord();\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('schema', schemaName);\r\n\t\t\t\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('fieldMaps', strMaps);\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\t\t\tdsSchemaLk.confirm();\r\n\t\t\t\t\tZ._isSaving = true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdsSchema.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tZ._isSaving = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._submitSchema('insert', dsSchemaLk.getRecord());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_saveSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName),\r\n\t\t\tdsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchemaLk.recordCount() === 0 || !dsSchema.getFieldValue('schema')) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsSchemaLk.editRecord();\r\n\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\tdsSchemaLk.setFieldValue('fieldMaps', fieldMaps);\r\n\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\r\n\t\tdsSchemaLk.confirm();\r\n\t\tZ._submitSchema('update', dsSchemaLk.getRecord());\r\n\t},\r\n\t\r\n\t_deleteSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName),\r\n\t\t\tdsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchemaLk.recordCount() === 0 || !dsSchema.getFieldValue('schema')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = Z._submitSchema('delete', dsSchemaLk.getRecord());\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function() {\r\n\t\t\t\tdsSchemaLk.deleteRecord();\r\n\t\t\t\tdsSchema.setFieldValue('schema', null);\r\n\t\t\t\tdsSchema.confirm();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdsSchemaLk.deleteRecord();\r\n\t\t\tdsSchema.setFieldValue('schema', null);\r\n\t\t\tdsSchema.confirm();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_refreshFields: function() {\r\n\t\tvar fieldRecords = [], fldObj, fldName, required, label,\r\n\t\t\tfields = this._dataset.getNormalFields(), \r\n\t\t\tlabels = {}, errLabels = null,\r\n\t\t\tincludeFields = this._includeFields,\r\n\t\t\texcludeFields = this._excludeFields;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(includeFields) {\r\n\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\tif(excludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\trequired = fldObj.required();\r\n\t\t\tlabel = fldObj.label();\r\n\t\t\tif(labels[label]) {\r\n\t\t\t\tif(errLabels) {\r\n\t\t\t\t\terrLabels += ',' + errLabels;\r\n\t\t\t\t} else {\r\n\t\t\t\t\terrLabels = label;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlabels[label] = true;\r\n\t\t\t}\r\n\t\t\tfieldRecords.push({field: fldName, label: label, displayLabel: label + (required? '<span class=\"jl-lbl-required\">*</span>': ''), required: required});\r\n\t\t}\r\n\t\tif(errLabels) {\r\n\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.ImportDialog.duplicateFields, [errLabels]));\r\n\t\t}\r\n\t\tthis._importDataset.records(fieldRecords);\r\n\t\tthis._importDataset.first();\r\n\t\tthis._colHeaders = null;\r\n\t},\r\n\r\n\t_readFile: function(fileObj) {\r\n\t\tvar Z = this,\r\n\t\t\tname = fileObj.name,\r\n\t\t\tsuffix = name.substring(name.lastIndexOf('.') + 1) || '';\r\n\t\tsuffix = suffix.toLowerCase();\r\n\t\tif(suffix != 'xls' && suffix != 'xlsx' && suffix != 'xlsb' && suffix != 'xlsm' && suffix != 'ods') {\r\n\t\t\tjslet.showError(jsletlocale.ImportDialog.notSupportFile);\r\n\t\t\treturn;\r\n\t\t}\r\n\t    var\treader = new window.FileReader();\r\n\t\treader.onload = function(e) {\r\n\t\t\tvar fileContent,\r\n\t\t\t\tparsedResult = null;\r\n\t\t\tif(e) {\r\n\t\t\t\tfileContent = e.target.result;\r\n\t\t\t} else {\r\n\t\t\t\tfileContent = reader.content;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tparsedResult = jslet.data.defaultXPorter.excelXPorter().importData(Z._dataset, fileContent);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tjslet.showError(jsletlocale.ImportDialog.notSupportFile);\r\n\t\t\t}\r\n\t\t\tif(parsedResult) {\r\n\t\t\t\tZ._colHeaders = parsedResult.header;\r\n\t\t\t\tZ._addColumnHeader(Z._colHeaders);\r\n\t\t\t\tZ._parsedData = parsedResult.data;\r\n\t\t\t} else {\r\n\t\t\t\tjslet.showError(jsletlocale.ImportDialog.noData);\r\n\t\t\t}\r\n\t\t};\r\n\t\treader.readAsBinaryString(fileObj);\r\n\t},\r\n\t\r\n\t_addColumnHeader: function(headers) {\r\n\t\tif(!headers) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldRecords = [], i, len;\r\n\t\tfor(i = 0, len = headers.length; i < len; i++) {\r\n\t\t\tfieldRecords.push({/*colNum: i,*/ colHeader: headers[i]});\r\n\t\t}\r\n\t\tthis._importDataset.getField('colHeader').lookup().dataset().records(fieldRecords);\r\n\t\tthis._mapFieldColumn();\r\n\t},\r\n\t\r\n\t_mapFieldColumn: function() {\r\n\t\tvar headers = this._colHeaders;\r\n\t\tif(!headers) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar records = this._importDataset.records(),\r\n\t\t\tlabel, rec, found = false;\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tif(!rec.fixedValue) {\r\n\t\t\t\tlabel = rec.colHeader || rec.label;\r\n\t\t\t\tif(headers.indexOf(label) >= 0) {\r\n\t\t\t\t\trec.colHeader = label;\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trec.colHeader = null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(rec.colHeader) {\r\n\t\t\t\t\trec.colHeader = null;\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tthis._importDataset.records(records);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doSchemaChanged: function(dsSchema, schemaName) {\r\n\t\tif(this._isSaving) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mapFlds = null,\r\n\t\t\tcolHeaders, records,\r\n\t\t\tmapFldCnt = 0,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(this._schemaLkDsName);\r\n\t\tif(schemaName) {\r\n\t\t\tmapFlds = JSON.parse(dsSchema.getFieldValue('schema.fieldMaps'));\r\n\t\t\tmapFldCnt = mapFlds.length;\r\n\t\t\t\r\n\t\t\tvar arrColHeaders = JSON.parse(dsSchema.getFieldValue('schema.colHeaders'));\r\n\t\t\trecords = [];\r\n\t\t\tfor(var k = 0, headerCnt = arrColHeaders.length; k < headerCnt; k++) {\r\n\t\t\t\trecords.push({colHeader: arrColHeaders[k]});\r\n\t\t\t}\r\n\t\t\tvar dsColHeader = this._importDataset.getField('colHeader').lookup().dataset();\r\n\t\t\tdsColHeader.records(records);\r\n\t\t}\r\n\t\trecords = this._importDataset.records();\r\n\t\tvar rec, fldName, schColHeader, mapFld;\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tfldName = rec.field;\r\n\t\t\trec.colHeader = null;\r\n\t\t\trec.fixedValue = null;\r\n\t\t\tschColHeader = null;\r\n\t\t\tif(mapFlds) {\r\n\t\t\t\tfor(var j = 0; j < mapFldCnt; j++) {\r\n\t\t\t\t\tmapFld = mapFlds[j];\r\n\t\t\t\t\tif(mapFld.field == fldName) {\r\n\t\t\t\t\t\trec.colHeader = mapFld.colHeader;\r\n\t\t\t\t\t\trec.fixedValue = mapFld.fixedValue;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._importDataset.records(records);\r\n\t},\r\n\t\r\n\t_getFieldMaps: function() {\r\n\t\tvar records = this._importDataset.records(), \r\n\t\t\trow, fieldMaps = [];\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trow = records[i];\r\n\t\t\tif(row.colHeader || row.fixedValue) {\r\n\t\t\t\tfieldMaps.push({field: row.field, colHeader: row.colHeader, fixedValue: row.fixedValue});\r\n\t\t\t} else if(row.required) {\r\n\t\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noColHeader);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldCnt = fieldMaps.length;\r\n\t\tif(fldCnt === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noColHeader);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn fieldMaps;\r\n\t},\r\n\t\r\n\t_getColHeaders: function() {\r\n\t\tvar colHeaders = [],\r\n\t\t\trecords = this._importDataset.getField('colHeader').lookup().dataset().records();\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\tcolHeaders.push(records[i].colHeader);\r\n\t\t}\r\n\t\treturn colHeaders;\r\n\t},\r\n\t\r\n\t_importData: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._parsedData || Z._parsedData.length === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noData);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._onCustomImport) {\r\n\t\t\tvar isSuccess = Z._onCustomImport(Z._dataset, Z._parsedData, fieldMaps);\r\n\t\t\tif(!isSuccess) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar fldMap, text, colHeader,\r\n\t\t\t\tmasterDs = Z._dataset, \r\n\t\t\t\tparsedData = Z._parsedData,\r\n\t\t\t\ttextList = [], textRec, row,\r\n\t\t\t\tfldCnt = fieldMaps.length,\r\n\t\t\t\timportingFn = Z._onImporting;\r\n\t\t\t\r\n\t\t\tfor(var i = 0, len = parsedData.length; i < len; i++) {\r\n\t\t\t\trow = parsedData[i];\r\n\t\t\t\ttextRec = {};\r\n\t\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\t\tfldMap = fieldMaps[j];\r\n\t\t\t\t\tcolHeader = fldMap.colHeader; \r\n\t\t\t\t\tif(colHeader) {\r\n\t\t\t\t\t\tif(importingFn) {\r\n\t\t\t\t\t\t\ttext = importingFn(fldMap.field, row[colHeader]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = row[colHeader];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext = fldMap.fixedValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(text) {\r\n\t\t\t\t\t\ttextRec[fldMap.field] = text;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttextList.push(textRec);\r\n\t\t\t}\r\n\t\t\tvar jqEl = jQuery('#' + Z._dlgId);\r\n\t\t\tjqEl.find('[name=\"jlProgressImport\"]').css('display', '');\r\n\t\t\tvar dsObj = Z._dataset;\r\n\t\t\tvar progressBarObj = Z._progressBar;\r\n\t\t\tdsObj.disableControls();\r\n\t\t\tnew jslet.StepProcessor(textList.length, function(start, end, percent) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdsObj.importTextList(textList, start, end);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t\tprogressBarObj.value(percent);\r\n\t\t\t\tif(percent === 100) {\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t\tdsObj.first();\r\n\t\t\t\t\tZ._doImported();\r\n\t\t\t\t}\r\n\t\t\t}).run();\r\n\t\t}\r\n\t\t\r\n\t\treturn;\r\n\t},\r\n\t\r\n\t_doImported: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onImported) {\r\n\t\t\tZ._onImported(Z._dataset);\r\n\t\t}\r\n\t\tjslet('#' + Z._dlgId).close();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._onImporting = null;\r\n\t\tZ._onImported = null;\r\n\t\tZ._onCustomImport = null;\r\n\t\tZ._progressBar = null;\r\n\t\t\r\n\t\tZ._dataset = null;\r\n\t\tvar dsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName);\r\n\t\tif(dsSchemaLk) {\r\n\t\t\tdsSchemaLk.destroy();\r\n\t\t}\r\n\t\tvar dsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchema) {\r\n\t\t\tdsSchema.destroy();\r\n\t\t}\r\n\t\tif(Z._importDataset) {\r\n    \t\tvar lkds = Z._importDataset.getField('colHeader').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tthis._importDataset.destroy();\r\n    \t\tthis._importDataset = null;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\n/**\r\n * @class\r\n * \r\n * A dialog to configure input settings like 'defaultValue', 'valueFollowed', 'focused'. <br />\r\n * It's used for ender user to configure their own preferences. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.defaultInputSettingDialog.show(dataset); \r\n */\r\njslet.ui.InputSettingDialog = function() {\r\n\tthis._inputSettingDs = null;\r\n\t\r\n\tthis._hostDataset = null;\r\n\t\r\n\tthis._onClosed = null;\r\n\t\r\n\tthis._onRestoreDefault = null;\r\n\t\r\n\tthis._settings = null;\r\n\tvar Z = this;\r\n\t\r\n\tfunction doProxyFieldChanged(dataRec, proxyFldName, proxyFldObj) {\r\n\t\tvar hostFldObj = jslet.data.getDataset(dataRec.dataset).getField(proxyFldName);\r\n\t\tproxyFldObj.dataType(hostFldObj.dataType());\r\n\t\tproxyFldObj.length(hostFldObj.length());\r\n\t\tproxyFldObj.scale(hostFldObj.scale());\r\n\t\tproxyFldObj.editMask(hostFldObj.editMask());\r\n\r\n\t\tproxyFldObj.displayFormat(hostFldObj.displayFormat());\r\n\t\tproxyFldObj.dateFormat(hostFldObj.dateFormat());\r\n\t\tproxyFldObj.displayControl(hostFldObj.displayControl());\r\n\t\tproxyFldObj.validChars(hostFldObj.validChars());\r\n\t\tif(hostFldObj.lookup()) {\r\n\t\t\tvar hostLkObj = hostFldObj.lookup();\r\n\t\t\tvar lkObj = hostLkObj.toPlanObject();\r\n\t\t\tlkObj.onlyLeafLevel = false;\r\n\t\t\t\r\n\t\t\tproxyFldObj.lookup(lkObj);\r\n\t\t\tproxyFldObj.editControl('DBComboSelect');\r\n\t\t} else {\r\n\t\t\tproxyFldObj.lookup(null);\r\n\t\t\tvar editorObj = hostFldObj.editControl();\r\n\t\t\tvar fldType = hostFldObj.getType();\r\n\t\t\tif(fldType !== jslet.data.DataType.DATE && fldType !== jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\teditorObj = {type: 'DBText'};\r\n\t\t\t}\r\n\t\t\tproxyFldObj.editControl(editorObj);\r\n\t\t}\r\n\t\tproxyFldObj.valueStyle(jslet.data.FieldValueStyle.NORMAL);\r\n\t}\r\n\r\n\tfunction initialize() {\r\n\t\tvar fldCfg = [{name: 'dataset', type: 'S', length: 30, visible: false},\r\n\t\t              {name: 'field', type: 'S', length: 30, displayWidth: 20, visible: false},\r\n\t\t              {name: 'label', type: 'S', label: jsletlocale.InputSettingDialog.labelLabel, length: 50, displayWidth: 15, disabled: true},\r\n\t\t              {name: 'parentField', type: 'S', length: 30, visible: false},\r\n\t\t              {name: 'tabIndex', type: 'N', label: 'tabIndex', length: 3, visible: false},\r\n\t\t              {name: 'focused', type: 'B', label: jsletlocale.InputSettingDialog.labelFocused, displayWidth: 6},\r\n\t\t              {name: 'valueFollow', type: 'B', label: jsletlocale.InputSettingDialog.labelValueFollow, displayWidth: 6},\r\n\t\t              {name: 'defaultValue', type: 'P', label: jsletlocale.InputSettingDialog.labelDefaultValue, length: 200, displayWidth:30, proxyHostFieldName: 'field', proxyFieldChanged: doProxyFieldChanged},\r\n\t\t              {name: 'isDatasetField', type: 'B', label: '', visible: false}\r\n\t\t              ];\r\n\t\t\r\n\t\tZ._inputSettingDs = new jslet.data.Dataset({name: 'custDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'field', nameField: 'label', parentField: 'parentField', logChanges: false, indexFields: 'tabIndex', isFireGlobalEvent: false});\r\n\t\t\r\n\t\tvar custContextFn = function(fldObj, changingFldName){\r\n\t\t\tvar dataset = fldObj.dataset();\r\n\t\t\tfldObj.disabled(dataset.getFieldValue('isDatasetField'));\r\n\t\t};\r\n\t\t\r\n\t\tZ._inputSettingDs.contextRules([{\"condition\": \"true\", \"rules\": [\r\n\t\t     {\"field\": 'defaultValue', \"customized\": custContextFn},\r\n\t\t     {\"field\": 'focused', \"customized\": custContextFn},\r\n\t\t     {\"field\": 'valueFollow', \"customized\": custContextFn}\r\n\t\t]}]);\r\n\t\tZ._inputSettingDs.enableContextRule();\r\n\t\tZ._inputSettingDs.onFieldChanged(function(propName, propValue){\r\n\t\t\tif(Z._isInit) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!Z._settings) {\r\n\t\t\t\tZ._settings = {};\r\n\t\t\t}\r\n\t\t\tvar hostDsName = this.getFieldValue('dataset'),\r\n\t\t\t\thostFldName = this.getFieldValue('field'),\r\n\t\t\t\tdsSetting = Z._settings[hostDsName];\r\n\t\t\tif(!dsSetting) {\r\n\t\t\t\tdsSetting = {};\r\n\t\t\t\tZ._settings[hostDsName] = dsSetting;\r\n\t\t\t}\r\n\t\t\tvar fldSetting = dsSetting[hostFldName];\r\n\t\t\tif(!fldSetting) {\r\n\t\t\t\tfldSetting = {};\r\n\t\t\t\tdsSetting[hostFldName] = fldSetting; \r\n\t\t\t}\r\n\t\t\tfldSetting[propName] = propValue;\r\n\t\t});\r\n\t}\r\n\t\r\n\tinitialize.call(this);\r\n};\r\n\r\njslet.ui.InputSettingDialog.prototype = {\r\n\t\t\r\n\thostDataset: function(hostDataset) {\r\n\t\tif(hostDataset === undefined) {\r\n\t\t\treturn this._hostDataset;\r\n\t\t}\r\n\t\tthis._hostDataset = hostDataset;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close event, you can use this event to store input settings. Example:\r\n\t * \r\n\t *     @example\r\n\t *     jslet.ui.defaultInputSettingDialog.show(dataset);\r\n\t *     jslet.ui.defaultInputSettingDialog.onClosed(function(settings) {\r\n\t *        //Save into DB\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onClosed Close event.\r\n\t * @param {Object} onClosed.settings Input settings.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonClosed: function(onClosedFn) {\r\n\t\tif(onClosedFn === undefined) {\r\n\t\t\treturn this._onClosed;\r\n\t\t}\r\n\t\tthis._onClosed = onClosedFn;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tonRestoreDefault: function(onRestoreDefaultFn) {\r\n\t\tif(onRestoreDefaultFn === undefined) {\r\n\t\t\treturn this._onRestoreDefault;\r\n\t\t}\r\n\t\tthis._onRestoreDefault = onRestoreDefaultFn;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show dialog.\r\n\t * \r\n\t * @param {jslet.data.Dataset | String} hostDataset The dataset will be changed input setting.\r\n\t */\r\n\tshow: function(hostDataset) {\r\n\t\tjslet.Checker.test('InputSettingDialog.show#hostDataset', hostDataset).required();\r\n\t\tvar Z = this;\r\n\t\tZ._hostDataset = jslet.data.getDataset(hostDataset);\r\n\t\tZ._isInit = true;\r\n\t\tZ._settings = null;\r\n\t\tZ._inputSettingDs.disableControls();\r\n\t\ttry {\r\n\t\t\tZ._initializeFields();\r\n\t\t} finally {\r\n\t\t\tZ._isInit = false;\r\n\t\t\tZ._inputSettingDs.first();\r\n\t\t\tZ._inputSettingDs.enableControls();\r\n\t\t}\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar tblFields = jQuery('#' + Z._dlgId).find('.jl-isdlg-fields')[0].jslet;\r\n\t\ttblFields.expandAll();\r\n\t\tvar tableWidth = tblFields.getTotalWidth() + tblFields.getTotalWidth(true);\r\n\t\tif(creating) {\r\n\t\t\ttblFields.onRowClick(function() {\r\n\t\t\t\tif(this.dataset().getFieldValue('isDatasetField')) {\r\n\t\t\t\t\tthis.toggle();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.changeSize(tableWidth + 60);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_initializeFields: function(hostDs, isKeepFields, parentField) {\r\n\t\tvar Z = this,\r\n\t\t\tdataset = Z._inputSettingDs,\r\n\t\t\tfldObj;\r\n\t\tif(!hostDs) {\r\n\t\t\thostDs = jslet.data.getDataset(Z._hostDataset);\r\n\t\t}\r\n\t\tvar fields = hostDs.getNormalFields();\r\n\t\tif(!isKeepFields) {\r\n\t\t\tdataset.records(null);\r\n\t\t}\r\n\t\tvar isDsFld;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tisDsFld = fldObj.detailDataset()? true: false;\r\n\t\t\tvar dataType = fldObj.dataType;\r\n\t\t\tif(!isDsFld && !fldObj.visible() || \r\n\t\t\t\t\tdataType === jslet.data.DataType.ACTION || \r\n\t\t\t\t\tdataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tdataset.appendRecord();\r\n\t\t\tdataset.setFieldValue('isDatasetField', isDsFld);\r\n\t\t\t\r\n\t\t\tdataset.setFieldValue('dataset', hostDs.name());\r\n\t\t\tdataset.setFieldValue('field', fldObj.name());\r\n\t\t\tdataset.setFieldValue('label', fldObj.label());\r\n\t\t\tdataset.setFieldValue('tabIndex', fldObj.tabIndex());\r\n\t\t\tif(parentField) {\r\n\t\t\t\tdataset.setFieldValue('parentField', parentField);\r\n\t\t\t}\r\n\t\t\tif(!isDsFld) {\r\n\t\t\t\tdataset.setFieldValue('defaultValue', fldObj.defaultValue());\r\n\t\t\t\tdataset.setFieldValue('focused', fldObj.focused());\r\n\t\t\t\tdataset.setFieldValue('valueFollow', fldObj.valueFollow());\r\n\t\t\t}\r\n\t\t\tdataset.confirm();\r\n\t\t\tif(isDsFld) {\r\n\t\t\t\tthis._initializeFields(fldObj.detailDataset(), true, fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar opt = { type: 'window', caption: jsletlocale.InputSettingDialog.caption, isCenter: true, resizable: true, minimizable: false, maximizable: false, animation: 'fade', styleClass: 'jl-isdlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar html = [\r\n\t\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\">',\r\n\t\t            '<div class=\"jl-isdlg-fields\" data-jslet=\"type:\\'DBTable\\',dataset:\\'', this._inputSettingDs.name(), \r\n\t\t            '\\',treeField:\\'label\\',readOnly:false,hasFilterDialog:false\"></div></div>',\r\n\r\n//\t\t            '<div class=\"input-group input-group-sm\">',\r\n//\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\r\n//\t\t            '<button id=\"jlbtnUp\" class=\"btn btn-default btn-sm\">', jsletlocale.InputSettingDialog.save, '</button>',\r\n//\t\t            '<button id=\"jlbtnDown\" class=\"btn btn-default btn-sm\">', jsletlocale.InputSettingDialog.save, '</button>',\r\n//\t\t            '</div>',\r\n//\t\t            '<label class=\"control-label col-sm-6\">&nbsp</label>',\r\n//\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\r\n//\t\t            '<hr class=\"col-sm-11\" />',\r\n\t\t            '<div class=\"input-group input-group-sm jl-isdlg-toolbar\"><label class=\"control-label col-sm-9\">&nbsp</label>',\r\n\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\t\t            \r\n\t\t            jsletlocale.InputSettingDialog.save,\r\n\t\t            '</button><button id=\"jlbtnCancel\" class=\"btn btn-default btn-sm\">',\r\n\t\t            jsletlocale.InputSettingDialog.cancel,\r\n\t\t            '</button></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el), \r\n\t\t\tZ = this;\r\n\t\t\r\n//\t\tjqEl.find('#jlbtnUp').on('click', function(event) {\r\n//\t\t\tvar dataset = Z._inputSettingDs;\r\n//\t\t\tif(dataset.recordCount() === 0) {\r\n//\t\t\t\treturn;\r\n//\t\t\t}\r\n//\t\t\tvar idx = dataset.getFieldValue('tabIndex');\r\n//\t\t\tif(!idx) {\r\n//\t\t\t\tidx = dataset.recno();\r\n//\t\t\t}\r\n//\t\t\tif(idx === 0) {\r\n//\t\t\t\treturn;\r\n//\t\t\t}\r\n//\t\t\tvar context = dataset.startSilenceMove();\r\n//\t\t\ttry {\r\n//\t\t\t\tdataset.setFieldValue('tabIndex', idx - 1);\r\n//\t\t\t\tdataset.prior();\r\n//\t\t\t\tdataset.setFieldValue('tabIndex', idx);\r\n//\t\t\t\tdataset.confirm();\r\n//\t\t\t} finally {\r\n//\t\t\t\tdataset.endSilenceMove(context);\r\n//\t\t\t}\r\n//\t\t\tdataset.indexFields(dataset.indexFields());\r\n//\t\t});\r\n\t\t\r\n\t\tjqEl.find('#jlbtnSave').on('click', function(event) {\r\n\t\t\tif(Z._settings) {\r\n\t\t\t\tvar hostDs, fldObj, fldSetting, propSetting;\r\n\t\t\t\tfor(var dsName in Z._settings) {\r\n\t\t\t\t\thostDs = jslet.data.getDataset(dsName);\r\n\t\t\t\t\tfldSetting = Z._settings[dsName]; \r\n\t\t\t\t\tfor(var fldName in fldSetting) {\r\n\t\t\t\t\t\tfldObj = hostDs.getField(fldName);\r\n\t\t\t\t\t\tpropSetting = fldSetting[fldName];\r\n\t\t\t\t\t\tfor(var propName in propSetting) {\r\n\t\t\t\t\t\t\tfldObj[propName](propSetting[propName]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onClosed) {\r\n\t\t\t\t\tZ._onClosed(Z._settings);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\tjqEl.find('#jlbtnCancel').on('click', function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\t\r\n\t\tjslet.ui.install(owin.el);\r\n\t}\r\n};\r\n\r\n/**\r\n * Default input setting dialog. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.defaultInputSettingDialog.show(dataset);\r\n *      \r\n * @member jslet.ui\r\n * @type {jslet.ui.InputSettingDialog}\r\n * \r\n */\r\njslet.ui.defaultInputSettingDialog = new jslet.ui.InputSettingDialog();\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Dataset designer, it can be used to design a dataset object. <br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DatasetDesigner\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DatasetDesigner\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.DatasetDesigner = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'onLoadDatasetMeta, onSaveDatasetMeta';\r\n\t\tZ.requiredProperties = 'onLoadDatasetMeta, onSaveDatasetMeta';\r\n\t\t\r\n\t\tZ._datasetMetas = null;\r\n\t\t\r\n\t\tZ._onLoadDatasetMeta = null;\r\n\t\t\r\n\t\tZ._onSaveDatasetMeta = null;\r\n\t\t\r\n\t\tZ._prepareDataset();\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Dataset meta loading event. It can be a Function or a global function name.\r\n\t * \r\n\t * @param {Function | String} onLoadDatasetMeta Dataset meta loading event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonLoadDatasetMeta: function(onLoadDatasetMeta) {\r\n\t\tjslet.Checker.test('DatasetDesigner.onLoadDatasetMeta', onLoadDatasetMeta).required();\r\n\t\tthis._onLoadDatasetMeta = onLoadDatasetMeta;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Dataset meta saving event. It can be a Function or a global function name.\r\n\t * \r\n\t * @param {Function | String} onSaveDatasetMeta Dataset meta saving event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonSaveDatasetMeta: function(onSaveDatasetMeta) {\r\n\t\tjslet.Checker.test('DatasetDesigner.onSaveDatasetMeta', onSaveDatasetMeta).required();\r\n\t\tthis._onSaveDatasetMeta = onSaveDatasetMeta;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_prepareDataset: function() {\r\n\t\tvar dsgnLocale = jsletlocale.DatasetDesigner;\r\n\t\tnew jslet.data.Dataset({name: 'dsgnDatatype', isEnum: true, records: \r\n\t\t\t'S:' + dsgnLocale.dtString + \r\n\t\t\t',N:' + dsgnLocale.dtNumber + \r\n\t\t\t',D:' + dsgnLocale.dtDate + \r\n\t\t\t',B:' + dsgnLocale.dtBoolean +\r\n\t\t\t',V:' + dsgnLocale.dtDataset +\r\n\t\t\t',A:' + dsgnLocale.dtAction +\r\n\t\t\t',E:' + dsgnLocale.dtEdit\r\n\t\t\t});\r\n\t\t\r\n\t\tnew jslet.data.Dataset({name: 'dsgnAlignment', isEnum: true, records: \r\n\t\t\t'left:' + dsgnLocale.alLeft + \r\n\t\t\t',center:' + dsgnLocale.alCenter + \r\n\t\t\t',right:' + dsgnLocale.alRight}); \r\n\t\t\r\n\t\tnew jslet.data.Dataset({name: 'dsgnValueStyle', isEnum: true, records: \r\n\t\t\t'0:' + dsgnLocale.vsNormal + \r\n\t\t\t',1:' + dsgnLocale.vsBetween + \r\n\t\t\t',2:' + dsgnLocale.vsMultiple});\r\n\r\n\t\tnew jslet.data.Dataset({name: 'dsgnEditor', fields: [{name: 'code', type: 'S'}], keyField: 'code', \r\n\t\t\trecords: \r\n\t\t[{code: 'DBText'}, {code: 'DBCheckBox'}, {code: 'DBSelect'}, {code: 'DBComboSelect'},\r\n\t\t{code: 'DBAutoComplete'}, {code: 'DBDatePicker'}, {code: 'DBPassword'}, {code: 'DBTextArea'},\r\n\t\t{code: 'DBSpinEdit'}, {code: 'DBBetweenEdit'}, {code: 'DBCheckBoxGroup'}, {code: 'DBRadioGroup'},\r\n\t\t{code: 'DBRangeSelect'}, {code: 'DBDataLabel'}, {code: 'DBTimePicker'}, {code: 'DBImage'},\r\n\t\t{code: 'DBRating'}, {code: 'DBHtml'}, {code: 'DBCKEditor'}, {code: 'DBUEditor'}]\r\n\t\t});\r\n\r\n\t\tvar objAccessor = {\r\n\t\t\tgetValue: function(dataRec, fldName) {\r\n\t\t\t\tif(dataRec) {\r\n\t\t\t\t\tvar origValue = dataRec[fldName];\r\n\t\t\t\t\tif(origValue) {\r\n\t\t\t\t\t\treturn JSON.stringify(origValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tsetValue: function(dataRec, fldName, value) {\r\n\t\t\t\tif(!dataRec) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} \r\n\t\t\t\tif(value && jslet.isString(value)) {\r\n\t\t\t\t\tdataRec[fldName] = JSON.parse(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\t\r\n\t\tvar fldCfg = [\r\n          \t{name: 'name', type: 'S', length: 30, label: dsgnLocale.fName, displayWidth: 20, required: true, unique: true},\r\n          \t{name: 'shortName', type: 'S', length: 10, label: dsgnLocale.fShortName, displayWidth: 10},\r\n          \t{name: 'label', type: 'S', length: 30, label: dsgnLocale.fLabel, displayWidth: 20},\r\n          \t{name: 'displayLabel', type: 'S', length: 30, label: dsgnLocale.fDisplayLabel, displayWidth: 20},\r\n          \t{name: 'tip', type: 'S', length: 30, label: dsgnLocale.fTip, displayWidth: 20},\r\n          \t{name: 'dataType', type: 'S', length: 1, label: dsgnLocale.fDateType, lookup: {dataset:\"dsgnDatatype\"}, displayWidth: 10, defaultValue:'S'},\r\n            {name: 'detailDataset', type: 'S', length: 30, label: dsgnLocale.fDetailDataset, displayWidth: 10},\r\n          \t{name: 'length', type: 'N', length: 3, label: dsgnLocale.fLength, displayWidth: 10, diaplayFormat: '##0', editControl: 'DBSpinEdit', dataRange: {min: 0, max: 10000}, defaultValue: 10},\r\n          \t{name: 'scale', type: 'N', length: 3, label: dsgnLocale.fScale, displayWidth: 6, diaplayFormat: '##0', editControl:'DBSpinEdit', dataRange: {min: 0, max: 10}},\r\n          \t{name: 'defaultExpr', type: 'S', length: 100, label: dsgnLocale.fDefaultExpr, displayWidth: 10},\r\n          \t{name: 'defaultValue', type: 'S', length: 100, label: dsgnLocale.fDefaultValue, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'valueStyle', type: 'S', label: dsgnLocale.fValueStyle, displayWidth: 10, lookup: {dataset:\"dsgnValueStyle\"}, defaultValue: 0},\r\n\r\n          \t{name: 'displayWidth', type: 'N', length: 3, label: dsgnLocale.fDisplayWidth, displayWidth: 10, dataRange: {min: 0, max: 10000}, diaplayFormat: '##0',editControl:'DBSpinEdit'},\r\n          \t{name: 'displayOrder', type: 'N', length: 3, label: dsgnLocale.fDisplayOrder, displayWidth: 6, defaultValue: 0, diaplayFormat: '##0', editControl:'DBSpinEdit', dataRange: {min: 0, max: 10000}},\r\n          \t{name: 'alignment', type: 'S', length: 3, label: dsgnLocale.fAlignment, displayWidth: 10, lookup: {dataset:\"dsgnAlignment\"}},\r\n          \t{name: 'displayFormat', type: 'S', length: 30, label: dsgnLocale.fDisplayFormat, displayWidth: 10},\r\n          \t{name: 'editControl', type: 'S', length: 100, label: dsgnLocale.fEditControl, displayWidth: 10, lookup: {dataset: \"dsgnEditor\"}, nullText: dsgnLocale.fvEditControl},\r\n          \t{name: 'nullText', type: 'S', label: dsgnLocale.fNullText, displayWidth: 10, defaultValue: dsgnLocale.fvNullText},\r\n\r\n          \t{name: 'formula', type: 'S', length: 100, label: dsgnLocale.fFormula, displayWidth: 50},\r\n          \t{name: 'readOnly', type: 'B', label: dsgnLocale.fReadOnly, displayWidth: 10},\r\n          \t{name: 'visible', type: 'B', label: dsgnLocale.fVisible, displayWidth: 10},\r\n          \t{name: 'unitConverted', type: 'B', label: dsgnLocale.fUnitConverted, displayWidth: 10},\r\n\r\n          \t{name: 'required', type: 'B', label: dsgnLocale.fRequired, displayWidth: 10},\r\n          \t{name: 'dataRange', type: 'S', length: 50, label: dsgnLocale.fDataRange, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'regularExpr', type: 'S', length: 50, label: dsgnLocale.fRegularExpr, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'unique', type: 'B', label: dsgnLocale.fUnique, displayWidth: 10},\r\n          \t{name: 'editMask', type: 'S', label: dsgnLocale.fEditMask, displayWidth: 10},\r\n          \t{name: 'valueCountLimit', type: 'N', length: 3, label: dsgnLocale.fValueCountLimit, displayWidth: 8, dataRange: {min: 0, max: 10}, diaplayFormat: '##0', editControl:'DBSpinEdit'},\r\n          \t{name: 'validChars', type: 'S', label: dsgnLocale.fValidChars, displayWidth: 10},\r\n          \t\r\n          \t{name: 'mergeSame', type: 'B', label: dsgnLocale.fMergeSame, displayWidth: 10},\r\n          \t{name: 'mergeSameBy', type: 'S', label: dsgnLocale.fMmergeSameBy, displayWidth: 10},\r\n          \t{name: 'aggraded', type: 'B', label: dsgnLocale.fAggraded, displayWidth: 10},\r\n          \t{name: 'aggradedBy', type: 'S', label: dsgnLocale.fAggradedBy, displayWidth: 10},\r\n          \t{name: 'valueFollow', type: 'B', label: dsgnLocale.fValueFollow, displayWidth: 10},\r\n          \t{name: 'focused', type: 'B', label: dsgnLocale.fFocused, displayWidth: 10},\r\n          \t{name: 'fixedValue', type: 'S', label: dsgnLocale.fFixedValue, displayWidth: 10},\r\n          \t{name: 'antiXss', type: 'B', label: dsgnLocale.fAntiXss, displayWidth: 10},\r\n\r\n          \t{name: 'trueValue', type: 'S', label: dsgnLocale.fTrueValue, displayWidth: 10},\r\n          \t{name: 'falseValue', type: 'S', label: dsgnLocale.fFalseValue, displayWidth: 10},\r\n          \t{name: 'trueText', type: 'S', label: dsgnLocale.fTrueText, displayWidth: 10},\r\n          \t{name: 'falseText', type: 'S', label: dsgnLocale.fFalseText, displayWidth: 10},\r\n          \t\r\n          \t{name: 'lookup', type: 'S', length: 100, label: dsgnLocale.fLookup, displayWidth: 10, customValueAccessor: objAccessor}\r\n          ];\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tvar dsgnField = new jslet.data.Dataset({name: 'dsgnField', fields: fldCfg});\r\n\t\tdsgnField.onFieldChanged(function(fldName, fldValue) {\r\n\t\t\tif(fldName === 'dataType') {\r\n\t\t\t\tZ._doDataTypeChanged(fldValue);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar contextRules = [\r\n\t\t    {condition: '[valueStyle] === 2',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'valueCountLimit', meta: {disabled: false}}\r\n\t\t\t\t],\r\n\t\t\t\totherwise: [\r\n\t\t\t\t\t{field: 'valueCountLimit', meta: {disabled: true}, value: null}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"B\"',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBCheckBox\", \"DBText\", \"DBDataLabel\") '}},\r\n\t\t\t\t    {field: 'valueStyle', meta: {disabled: true}},\r\n\t\t\t\t    {field: 'displayFormat', meta: {disabled: true}},\r\n\t\t\t\t    {field: 'editMask', meta: {disabled: true}}\r\n\t\t\t\t],\r\n\t\t\t\totherwise: [\r\n\t\t\t\t    {field: 'valueStyle', meta: {disabled: false}},\r\n\t\t\t\t    {field: 'displayFormat', meta: {disabled: false}},\r\n\t\t\t\t    {field: 'editMask', meta: {disabled: false}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"D\"',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBDatePicker\", \"DBText\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBComboSelect\", \"DBSelect\", \"DBAutoComplete\", \"DBCheckBoxGroup\", \"DBRadioGroup\",\"DBText\", \"DBDataLabel\")'}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"N\" && ![lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBText\", \"DBSpinEdit\", \"DBRangeSelect\", \"DBRating\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"S\" && ![lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBText\", \"DBTextArea\", \"DBPassword\", \"DBHtml\", \"DBImage\", \"DBCKEditor\", \"DBUEditor\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t];\r\n\t\t\r\n\t\tdsgnField.contextRules(contextRules);\r\n\t\t\r\n\t\tfldCfg = [\r\n\t      \t{name: 'name', type: 'S', length: 30, label: dsgnLocale.dsName, displayWidth: 20, required: true, unique: true},\r\n\t      \t{name: 'description', type: 'S', length: 100, label: dsgnLocale.dsDesc, displayWidth: 20},\r\n\t      \t\r\n\t      \t{name: 'isEnum', type: 'B', defaultValue: false},\r\n\t      \t{name: 'records', type: 'S', length: 2000, editControl: 'DBTextArea'},\r\n\t      \t{name: 'keyField', type: 'S', length: 30, label: dsgnLocale.dsKeyField, displayWidth: 10},\r\n\t      \t{name: 'codeField', type: 'S', length: 30, label: dsgnLocale.dsCodeField, displayWidth: 10},\r\n\t      \t{name: 'nameField', type: 'S', length: 30, label: dsgnLocale.dsNameField, displayWidth: 10},\r\n\t      \t{name: 'parentField', type: 'S', length: 30, label: dsgnLocale.dsParentField, displayWidth: 10},\r\n\t      \t{name: 'selectField', type: 'S', length: 30, label: dsgnLocale.dsSelectField, displayWidth: 10, visible: false},\r\n\t      \t{name: 'statusField', type: 'S', length: 30, label: dsgnLocale.dsStatusField, displayWidth: 10, visible: false},\r\n\t      \t{name: 'contextRules', type: 'S', length: 3000, label: dsgnLocale.dsContextRules, displayWidth: 10},\r\n\t      \t{name: 'queryUrl', type: 'S', length: 300, label: dsgnLocale.dsQueryUrl, displayWidth: 10, visible: false},\r\n\t      \t{name: 'submitUrl', type: 'S', length: 300, label: dsgnLocale.dsSubmitUrl, displayWidth: 10, visible: false},\r\n\t      \t{name: 'recordClass', type: 'S', length: 50, label: dsgnLocale.dsRecordClass, displayWidth: 10, visible: false},\r\n\t      \t{name: 'pageSize', type: 'N', length: 5, label: dsgnLocale.dsPageSize, displayWidth: 10, visible: false},\r\n\t      \t\r\n\t      \t{name: 'fixedIndexFields', type: 'S', length: 100, label: dsgnLocale.dsFixedIndexFields, displayWidth: 10},\r\n\t      \t{name: 'indexFields', type: 'S', length: 100, label: dsgnLocale.dsIndexFields, displayWidth: 10},\r\n\t      \t{name: 'fixedFilter', type: 'S', length: 200, label: dsgnLocale.dsFixedFilter, displayWidth: 10},\r\n\t      \t{name: 'filter', type: 'S', length: 200, label: dsgnLocale.dsFilter, displayWidth: 10},\r\n\t      \t\r\n\t      \t{name: 'filtered', type: 'B', label: dsgnLocale.dsFiltered, displayWidth: 10, visible: false},\r\n\t      \t{name: 'readOnly', type: 'B', label: dsgnLocale.dsReadOnly, displayWidth: 10, visible: false},\r\n\t      \t{name: 'auditLogEnabled', type: 'B', label: dsgnLocale.dsAuditLogEnabled, displayWidth: 10, visible: false},\r\n\t\t\t{name: 'fields', type: 'V', label: 'Fields', detailDataset:'dsgnField', visible:false}\r\n\t    ];\r\n\t\t\r\n\t\tvar dsgnDataset = new jslet.data.Dataset({name: 'dsgnDataset', fields: fldCfg});\r\n\t\t\r\n\t\tfldCfg = [\r\n\t      \t{name: 'id', type: 'S', length: 30},\r\n\t      \t{name: 'objCode', type: 'S', length: 50},\r\n\t      \t{name: 'objName', type: 'S', length: 50},\r\n\t      \t{name: 'objType', type: 'S', length: 2},\r\n\t      \t{name: 'parentId', type: 'S', length: 30},\r\n\t      \t{name: 'changed', type: 'B'},\r\n\t      \t{name: 'isEnum', type: 'B'},\r\n\t      \t{name: 'dsName', type: 'S'},\r\n\t      \t{name: 'fldName', type: 'S'}\r\n\t\t];\r\n\t\tvar dsObject = new jslet.data.Dataset({name: 'dsgnObject', fields: fldCfg, keyField: 'id', codeField: 'objCode', nameField: 'objName', parentField: 'parentId', logChanges: false});\r\n\t\tdsObject.on(jslet.data.DatasetEvent.AFTERSCROLL, function() {\r\n\t\t\tZ._doObjectChanged();\r\n\t\t});\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(jqEl.hasClass('jl-dsgn-ds')) {\r\n\t\t\tjqEl.addClass('form-group form-group-sm jl-dsgn-ds');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el);\r\n\t\tvar html = '<div class=\"col-xs-3\" style=\"height: 100%\"><div style=\"height: 100%\" name=\"dsgnObject\" ' + \r\n\t\t\t'data-jslet=\"type: \\'DBTreeView\\', dataset: \\'dsgnObject\\', displayFields: \\'[objName] + %22(%22 + [objCode] + %22)%22\\', expandLevel: 1\"' +\r\n\t\t\t'></div></div>' + \r\n\t\t\t'<div class=\"col-xs-9\">' + \r\n\t\t\t'<div name=\"dsgnDs\" style=\"display: none\">' + \r\n\t\t\t'<div name=\"dsgnDsBase\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'name\\'}, {field: \\'description\\', dataCols: 6}]\"></div>' + \r\n\r\n\t\t\t'<div name=\"dsgnEnumValues\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'records\\'}]\"></div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnDsLookup\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'keyField\\'}, {field: \\'codeField\\'}, {field: \\'nameField\\'}, {field: \\'parentField\\'}]\"></div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnDsFilter\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'fixedIndexFields\\'}, {field: \\'indexFields\\'}, {field: \\'fixedFilter\\'}, {field: \\'filter\\'}]\"></div>' + \r\n\t\t\t'</div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFld\" style=\"display: none\">' + \r\n\t\t\t'<div name=\"dsgnFldBase\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'name\\'}, {field: \\'label\\'}, {field: \\'shortName\\'}, {field: \\'dataType\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldDetail\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'detailDataset\\', dataCols: 6}]\"></div>' +\r\n\r\n\t\t\t'<div name=\"dsgnFldCommon\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'displayOrder\\'},{field: \\'displayWidth\\'}, {field: \\'alignment\\'}, {field: \\'visible\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldLookup\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'lookup\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldEditable\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'editControl\\'}, {field: \\'readOnly\\'}, {field: \\'required\\'}, {field: \\'unique\\'}, {field: \\'nullText\\'}, {field: \\'valueStyle\\'}, {field: \\'valueCountLimit\\'}, ' + \r\n\t\t\t'{field: \\'defaultValue\\'}, {field: \\'displayFormat\\'}, {field: \\'editMask\\'}, {field: \\'focused\\'}, ' + \r\n\t\t\t'{field: \\'valueFollow\\'}, {field: \\'dataRange\\'}, {field: \\'regularExpr\\'}, {field: \\'mergeSame\\', inFirstCol: true}, {field: \\'mergeSameBy\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldAction\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'fixedValue\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldBool\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'trueValue\\'}, {field: \\'falseValue\\'}, {field: \\'trueText\\'}, {field: \\'falseText\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldString\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'antiXss\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldNumber\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'aggraded\\'}, {field: \\'aggradedBy\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'</div>';\r\n\t\tconsole.log(html);\r\n\t\t\r\n\t\tjqEl.html(html);\r\n\t\tjslet.ui.install(Z.el);\r\n\t\tjslet(jqEl.find('[name=\"dsgnObject\"]')).onGetIconClass(function() {\r\n\t\t\tvar dsObj = this.dataset();\r\n\t\t\tif(dsObj.getFieldValue('objType') === 'd') {\r\n\t\t\t\treturn 'fa fa-table';\r\n\t\t\t} else {\r\n\t\t\t\treturn 'fa fa-dot-circle-o';\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.queryDatasetMeta();\r\n\t},\r\n\t\r\n\tqueryDatasetMeta: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._onLoadDatasetMeta) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsMetas = Z._onLoadDatasetMeta();\r\n\t\tif(!dsMetas) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(dsMetas.done) {\r\n\t\t\tdsMetas.done(function(result) {\r\n\t\t\t\tZ._parse(result);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._parse(dsMetas);\r\n\t\t}\r\n\t},\r\n\t\r\n\taddDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.appendRecord();\r\n\t\tdsObject.setFieldValue('isEnum', true);\r\n\t},\r\n\t\r\n\taddEnumDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.appendRecord();\r\n\t\tdsObject.setFieldValue('isEnum', false);\r\n\t},\r\n\t\r\n\tdeleteDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.deleteRecord();\r\n\t},\r\n\t\r\n\t_parse: function (dsMetas) {\r\n\t\tthis._datasetMetas = dsMetas;\r\n\t\tjslet.data.getDataset('dsgnDataset').records(dsMetas);\r\n\t\tif(!dsMetas || dsMetas.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar dsMeta, arrObj = [];\r\n\t\t\r\n\t\tfunction addFields(fields, parentId, dsName) {\r\n\t\t\tvar fldMeta, fldId, fldName;\r\n\t\t\tfor(var j = 0, fldLen = fields.length; j < fldLen; j++) {\r\n\t\t\t\tfldMeta = fields[j];\r\n\t\t\t\tfldName = fldMeta.name;\r\n\t\t\t\tfldId = 'f-' + fldName;\r\n\t\t\t\tarrObj.push({id: fldId, objCode: fldName, objName: fldMeta.label || fldMeta.name, objType: 'f', parentId: parentId, dsName: dsName, fldName: fldName});\r\n\t\t\t\tif(fldMeta.children) {\r\n\t\t\t\t\taddFields(fldMeta.children, fldId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar dsId, isEnum, dsName;\r\n\t\tfor(var i = 0, len = dsMetas.length; i < len; i++) {\r\n\t\t\tdsMeta = dsMetas[i];\r\n\t\t\tdsName = dsMeta.name;\r\n\t\t\tdsId = 'd-' + dsName;\r\n\t\t\tisEnum = dsMeta.isEnum? true: false;\r\n\t\t\tarrObj.push({id: dsId, objCode: dsName, objName: dsMeta.description || dsName, objType: 'd', isEnum: isEnum, dsName: dsName});\r\n\t\t\tif(!isEnum) {\r\n\t\t\t\taddFields(dsMeta.fields, dsId, dsName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.data.getDataset('dsgnObject').records(arrObj);\r\n\t},\r\n\t\r\n\t_doObjectChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObject = jslet.data.getDataset('dsgnObject'),\r\n\t\t\tobjType = dsObject.getFieldValue('objType'),\r\n\t\t\tdsName = dsObject.getFieldValue('dsName'),\r\n\t\t\tfldName = dsObject.getFieldValue('fldName'),\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqDataset = jqEl.find('[name=dsgnDs]'),\r\n\t\t\tjqDsLookup = jqEl.find('[name=dsgnDsLookup]'),\r\n\t\t\tjqDsFilter = jqEl.find('[name=dsgnDsFilter]'),\r\n\t\t\t\r\n\t\t\tjqField = jqEl.find('[name=dsgnFld]'),\r\n\t\t\tdsgnDataset = jslet.data.getDataset('dsgnDataset'),\r\n\t\t\tdsgnField = jslet.data.getDataset('dsgnField');\r\n\t\tif(objType === 'd' ) {\r\n\t\t\tdsgnDataset.findByField('name', dsName);\r\n\t\t\tvar isEnum = dsObject.getFieldValue('isEnum');\r\n\t\t\tif(isEnum) {\r\n\t\t\t\tjqDsLookup.hide();\r\n\t\t\t\tjqDsFilter.hide();\r\n\t\t\t} else {\r\n\t\t\t\tjqDsLookup.show();\r\n\t\t\t\tjqDsFilter.show();\r\n\t\t\t}\r\n\t\t\tjqField.hide();\r\n\t\t\tjqDataset.show();\r\n\t\t} else {\r\n\t\t\tdsgnDataset.findByField('name', dsName);\r\n\t\t\tdsgnField.findByField('name', fldName);\r\n\t\t\tvar dataType = dsgnField.getFieldValue('dataType');\r\n\t\t\tZ._doDataTypeChanged(dataType);\r\n\t\t\tjqDataset.hide();\r\n\t\t\tjqField.show();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDataTypeChanged: function(dataType) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tdsgnField = jslet.data.getDataset('dsgnField'),\r\n\t\t\tjqFldDetail = jqEl.find('[name=dsgnFldDetail]'),\r\n\t\t\tjqFldCommon = jqEl.find('[name=dsgnFldCommon]'),\r\n\t\t\tjqFldAction = jqEl.find('[name=dsgnFldAction]'),\r\n\t\t\tjqFldEditAction = jqEl.find('[name=dsgnFldEditAction]'),\r\n\r\n\t\t\tjqFldEditable = jqEl.find('[name=dsgnFldEditable]'),\r\n\t\t\tjqFldBool = jqEl.find('[name=dsgnFldBool]'),\r\n\t\t\tjqFldLookup = jqEl.find('[name=dsgnFldLookup]'),\r\n\t\t\tjqFldString = jqEl.find('[name=dsgnFldString]'),\r\n\t\t\tjqFldNumber = jqEl.find('[name=dsgnFldNumber]');\r\n\t\t\r\n\t\tjqFldDetail.hide();\r\n\t\tjqFldCommon.hide();\r\n\t\tjqFldAction.hide();\r\n\t\tjqFldEditAction.hide();\r\n\t\tjqFldBool.hide();\r\n\t\tjqFldEditable.hide();\r\n\t\tjqFldLookup.hide();\r\n\t\tjqFldString.hide();\r\n\t\tjqFldNumber.hide();\r\n\t\tif(dataType === jslet.data.DataType.DATASET) {\r\n\t\t\tjqFldDetail.show();\r\n\t\t\tdsgnField.getField('detailDataset').required(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsgnField.getField('detailDataset').required(false);\r\n\t\t\r\n\t\tjqFldCommon.show();\r\n\t\tif(dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(dataType === jslet.data.DataType.ACTION) {\r\n\t\t\tjqFldAction.show();\r\n\t\t\tdsgnField.getField('fixedValue').required(true);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tdsgnField.getField('fixedValue').required(false);\r\n\t\t}\r\n\t\t\r\n\t\tjqFldEditable.show();\r\n\t\tif(dataType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\tjqFldBool.show();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(dataType === jslet.data.DataType.DATE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjqFldLookup.show();\r\n\t\tif(dataType === jslet.data.DataType.STRING) {\r\n\t\t\tjqFldString.show();\r\n\t\t}\r\n\t\t\r\n\t\tif(dataType === jslet.data.DataType.NUMBER) {\r\n\t\t\tjqFldNumber.show();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DatasetDesigner', jslet.ui.DatasetDesigner);\r\njslet.ui.DatasetDesigner.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class jslet.Report\r\n * \r\n * A class to connect to jslet report assistant. It provides the following feature:\r\n * design report, preview report, print report.\r\n */\r\n\r\n(function() {\r\n\tvar wsSocket, serverIp, onSavingReport;\r\n\tjslet.Report = function(reportServerIp) {\r\n\t\tserverIp = reportServerIp;\r\n\t};\r\n\t\r\n\tjslet.Report.prototype = {\r\n\t\t\r\n\t\tgetWsSocket: function() {\r\n\t\t\tif(!wsSocket) {\r\n\t\t\t\twsSocket = new WsSocket(serverIp);\r\n\t\t\t\t\r\n\t\t\t\twsSocket.onSavingReport = function(reportBo) {\r\n\t\t\t\t\tvar template = window.decodeURIComponent(window.escape(window.atob(reportBo.template)));\r\n\t\t\t\t\treportBo.template = template;\r\n\t\t\t\t\tif(onSavingReport) {\r\n\t\t\t\t\t\tonSavingReport.call(reportBo);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn wsSocket;\r\n\t\t},\r\n\t\t\r\n\t\tonSavingReport: function(savingReportFn) {\r\n\t\t\tif(savingReportFn === undefined) {\r\n\t\t\t\treturn onSavingReport;\r\n\t\t\t}\r\n\t\t\tonSavingReport = savingReportFn;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Design a report template. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     //Design a new report template.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List');\r\n\t\t *     \r\n\t\t *     var template = '...';\r\n\t\t *     //Design an existed report template.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List', null, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t */\r\n\t\tdesign: function(datasets, reportId, reportName, templateXml, printFields) {\r\n\t\t\tjslet.Checker.test('Report.design#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#template', templateXml).isString();\r\n\t\t\tjslet.Checker.test('Report.design#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields);\r\n\t\t\tthis.getWsSocket().designReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Preview a report. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     var template = '...';\r\n\t\t *     //Preview all records.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t *     //Preview the current record.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}}, jslet.data.RecordRange.CURRENT);\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t * @param {jslet.data.RecordRange} printRange Record range to preview, \r\n\t\t * \t\tthe optional values are jslet.data.RecordRange.ALL(default), \r\n\t\t * \t\tjslet.data.RecordRange.SELECTED, jslet.data.RecordRange.CURRENT.\r\n\t\t */\r\n\t\tpreview: function(datasets, reportId, reportName, templateXml, printFields, printRange) {\r\n\t\t\tjslet.Checker.test('Report.preview#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#template', templateXml).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields, printRange);\r\n\t\t\tvar wsSocket = new WsSocket();\r\n\t\t\tthis.getWsSocket().previewReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Print a report. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     var template = '...';\r\n\t\t *     //Print all records.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t *     //Print the current record.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}}, jslet.data.RecordRange.CURRENT);\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t * @param {jslet.data.RecordRange} printRange Record range to print, \r\n\t\t * \t\tthe optional values are jslet.data.RecordRange.ALL(default), \r\n\t\t * \t\tjslet.data.RecordRange.SELECTED, jslet.data.RecordRange.CURRENT.\r\n\t\t */\r\n\t\tprint: function(datasets, reportId, reportName, templateXml, printFields, printRange) {\r\n\t\t\tjslet.Checker.test('Report.print#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#template', templateXml).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields, printRange);\r\n\t\t\tvar wsSocket = new WsSocket();\r\n\t\t\tthis.getWsSocket().printReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t_combineReportBo: function(reportId, reportName, datasets, templateXml, printFields, printRange, inDesign) {\r\n\t\t\tvar reportBO = {reportId: reportId, reportName: reportName};\r\n\t\t\tvar template = templateXml? window.btoa(window.unescape(window.encodeURIComponent(templateXml))): null;\r\n\t\t\treportBO.template = template;\r\n\r\n\t\t\tvar rptDatasets = [];\r\n\t\t\treportBO.datasets = rptDatasets;\r\n\t\t\tvar dsCodes = datasets.split(','), dsCode, rtnCfg, \r\n\t\t\t\trecordRange = null, dsPrintFields;\r\n\t\t\tfor(var i = 0, len = dsCodes.length; i < len; i++) {\r\n\t\t\t\tdsCode = dsCodes[i];\r\n\t\t\t\trtnCfg = this._createRptDataset(rptDatasets, dsCode, null, printFields);\r\n\t\t\t\tif(inDesign) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(printRange) {\r\n\t\t\t\t\trecordRange = printRange[dsCode] || null;\r\n\t\t\t\t}\r\n\t\t\t\trtnCfg.rptDataset.data = rtnCfg.dataset.exportTextArray({exportHeader: false, recordRange: recordRange, includeFields: rtnCfg.fieldNames});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn reportBO;\r\n\t\t},\r\n\t\t\r\n\t\t_createRptDataset: function(rptDatasets, dsCode, dsName, printFields) {\r\n\t\t\tvar dsObj = jslet.data.getDataset(dsCode);\r\n\t\t\tif(!dsObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Report.notFoundDs, dsCode));\r\n\t\t\t}\r\n\t\t\tif(!dsName) {\r\n\t\t\t\tdsName = dsObj.description();\r\n\t\t\t}\r\n\t\t\tvar rptDataset = {name: dsName};\r\n\t\t\trptDatasets.push(rptDataset);\r\n\t\t\tvar rptFields = [];\r\n\t\t\trptDataset.fields = rptFields;\r\n\t\t\tvar dsPrintFields = printFields && printFields[dsCode], includeFields, excludeFields;\r\n\t\t\tif(dsPrintFields) {\r\n\t\t\t\tincludeFields = dsPrintFields && dsPrintFields.includeFields;\r\n\t\t\t\texcludeFields = dsPrintFields && dsPrintFields.excludeFields;\r\n\t\t\t}\r\n\r\n\t\t\tvar fields = dsObj.getNormalFields(), fldObj, dataType, fldName,\r\n\t\t\t\tarrFldNames = [];\r\n\t\t\tfor(var i = 0 , len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(includeFields && includeFields.indexOf(fldName) < 0 || \r\n\t\t\t\t\texcludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tdataType = fldObj.getType();\r\n\t\t\t\tif(fldObj.lookup()) { //\r\n\t\t\t\t\tdataType = 'S';\r\n\t\t\t\t}\r\n\t\t\t\tif(dataType == 'V') { //\r\n\t\t\t\t\tthis._createRptDataset(rptDatasets, fldObj.detailDataset(), fldObj.label(), printFields);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\t\tif(!includeFields || includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trptFields.push(jslet.trim(fldObj.label()) + '|' + dataType);\r\n\t\t\t\tarrFldNames.push(fldName);\r\n\t\t\t}\r\n\t\t\treturn {dataset: dsObj, fieldNames: arrFldNames, rptDataset: rptDataset};\r\n\t\t}\r\n\t};\r\n\r\n\tjslet.defaultReport = new jslet.Report();\r\n/*\r\n**************************************************************************\r\n sgcWebSocket component\r\n\r\n written by eSeGeCe\r\n \r\n            copyright ?2016\r\n            Email : info@esegece.com\r\n            Web : http://www.esegece.com\r\n**************************************************************************\r\n*/\r\n/* jshint ignore:start */\r\nfunction GUID(){var a=function(){return Math.floor(Math.random()*65536).toString(16)};return(a()+a()+a()+a()+a()+a()+a()+a())}function event(a){this.name=a;this.eventAction=null;this.subscribe=function(b){this.eventAction=b};this.fire=function(c,b){if(this.eventAction!=null){this.eventAction(c,b)}}}function sgcStreamToString(b,c){var a=new FileReader();a.readAsText(b);a.onload=function(){vResult=a.result;c(vResult)}}function sgcWSStreamRead(b,c){var a=b.slice(0,10);sgcStreamToString(a,function(f){var e=parseInt(f);var d=b.slice(10,10+e);sgcStreamToString(d,function(h){var g=h;var i=b.slice(10+e,b.size);c(g,i)})})}function sgcWebSocket(){if(arguments.length==0){return}if(typeof arguments[0]==\"object\"){this.host=arguments[0][\"host\"];this.subprotocol=arguments[0][\"subprotocol\"];this.user=arguments[0][\"user\"];this.password=arguments[0][\"password\"];this.transport=arguments[0][\"transport\"]}else{if(typeof arguments[0]==\"string\"){this.host=arguments[0];this.subprotocol=arguments[1];this.transport=arguments[2]}else{return}}if(this.host==undefined){this.host=\"127.0.0.1\"}if(this.subprotocol==undefined){this.subprotocol=\"\"}if(this.transport==undefined){this.transport=[\"websocket\",\"sse\"]}var a=new event(\"onopen\");var c=new event(\"onclose\");var f=new event(\"onmessage\");var e=new event(\"onerror\");if((window.WebSocket)&&(this.transport.indexOf(\"websocket\")>-1)){var d=new event(\"onstream\");this.open=function(){if((this.host!==\"\")&&(this.user!==\"\")&&(this.user!==undefined)){if(this.password==undefined){this.password==\"\"}if((this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.websocket=new WebSocket(this.host+\"/sgc/auth/url/\"+this.user+\"/\"+this.password,this.subprotocol)}else{this.websocket=new WebSocket(this.host+\"/sgc/auth/url/\"+this.user+\"/\"+this.password)}}else{if((this.host!==\"\")&&(this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.websocket=new WebSocket(this.host,this.subprotocol)}else{if(this.host!==\"\"){this.websocket=new WebSocket(this.host)}}}this.websocket.onopen=function(){a.fire({name:\"onopen\",message:\"\"})};this.websocket.onmessage=function(g){if(typeof g.data===\"object\"){d.fire({name:\"onstream\",stream:g.data})}else{f.fire({name:\"onmessage\",message:g.data})}};this.websocket.onclose=function(g){c.fire({name:\"onclose\",message:\"\",code:g.code,reason:g.reason,clean:g.wasClean})};this.websocket.onerror=function(g){e.fire({name:\"onerror\",message:g.data})}};if(this.websocket==undefined){this.open()}this.send=function(g){this.websocket.send(g)};this.close=function(){this.websocket.close()};this.state=function(){switch(this.websocket.readyState){case 0:return\"connecting\";break;case 1:return\"open\";break;case 2:return\"closing\";break;case 3:return\"closed\";break;default:return\"undefined\";break}};this.on=function(g,h){if(g==\"open\"){a.subscribe(h)}else{if(g==\"close\"){c.subscribe(h)}else{if(g==\"message\"){f.subscribe(h)}else{if(g==\"stream\"){d.subscribe(h)}else{if(g==\"error\"){e.subscribe(h)}}}}}}}else{if((window.EventSource)&&(this.transport.indexOf(\"sse\")>-1)){var b=\"\";this.open=function(){if((this.host!==\"\")&&(this.user!==\"\")&&(this.user!==undefined)){if(this.password==undefined){this.password==\"\"}if((this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\\:\\/{2}[a-z,0-9,.]{1,}\\:[0-9]{1,4}.(.*)/,\"$1\")+\"/sgc/auth/url/\"+this.user+\"/\"+this.password+\"/\"+this.subprotocol)}else{this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\\:\\/{2}[a-z,0-9,.]{1,}\\:[0-9]{1,4}.(.*)/,\"$1\")+\"/sgc/auth/url/\"+this.user+\"/\"+this.password)}}else{if((this.host!==\"\")&&(this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.EventSource=new EventSource(this.subprotocol)}else{if(this.host!==\"\"){this.EventSource=new EventSource(\"/\")}}}this.EventSource.onopen=function(){a.fire({name:\"onopen\",message:\"\"})};this.EventSource.onmessage=function(g){if(b==\"\"){b=g.data}else{f.fire({name:\"onmessage\",message:g.data})}};this.EventSource.onerror=function(g){e.fire({name:\"onerror\",message:g.data})}};if(this.EventSource==undefined){this.open()}this.send=function(g){if(b!==\"\"){if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else{if(window.ActiveXObject){xhr=new ActiveXObject(\"Microsoft.XMLHTTP\")}else{return}}xhr.open(\"POST\",\"/sgc/xhr/\"+b,true);xhr.send(g)}};this.close=function(){this.EventSource.close();c.fire({name:\"onclose\",message:\"\",code:1000,reason:\"\",clean:true})};this.state=function(){switch(this.EventSource.readyState){case 0:return\"connecting\";break;case 1:return\"open\";break;case 2:return\"closed\";break;default:return\"undefined\";break}};this.on=function(g,h){if(g==\"open\"){a.subscribe(h)}else{if(g==\"close\"){c.subscribe(h)}else{if(g==\"message\"){f.subscribe(h)}else{if(g==\"error\"){e.subscribe(h)}}}}}}else{alert(\"WebSockets not supported by your Browser.\")}}};\r\n/* jshint ignore:end */\r\nvar assistantURL, authURL;\r\nvar WsSocket = function(serverIp) {\r\n\tserverIp = serverIp || '127.0.0.1';\r\n\tassistantURL = 'wss://' + serverIp + ':20169';\r\n\tauthURL = 'https://' + serverIp + ':20169';\r\n\t\r\n\tthis.ws = null;\r\n\t\r\n\tthis.connected = false;\r\n\t\r\n\tthis.onSavingReport = null;\r\n\t\r\n\tthis.needAlert = true;\r\n\t\r\n\tthis.version = null;\r\n};\r\n\r\nWsSocket.prototype = {\r\n\topen: function(openCallBackFn) {\r\n        this.connected = false;\r\n\t\tvar self = this;\r\n\t\t/* jshint ignore:start */\r\n        this.ws = new sgcWebSocket(assistantURL);\r\n        /* jshint ignore:end */\r\n        this.ws.on('open', function(evt){\r\n            self.connected = true;\r\n\t\t\tif(openCallBackFn) {\r\n\t\t\t\topenCallBackFn();\r\n\t\t\t}\r\n\t\t});\r\n\r\n        this.ws.on('message', function(event) {\r\n        \tvar messageText = event.message;\r\n        \tvar message = JSON.parse(messageText);\r\n        \t\r\n\t\t\tvar msgName = message.name;\r\n\t\t\tvar msgBody = message.body;\r\n\t\t\tif(msgName == 'save' && self.onSavingReport) {\r\n\t\t\t\tself.onSavingReport(msgBody);\r\n\t\t\t}\r\n        \r\n\t\t\tif(msgName == 'version') {\r\n\t\t\t\tself.version = msgBody;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(self.onMessage) {\r\n\t\t\t\tself.onMessage(message);\r\n\t\t\t}\r\n\t\t\t\r\n        });\r\n        \r\n        this.ws.on('close', function() {\r\n        \tself.connected = false;\r\n        });\r\n        \r\n        this.ws.on('error', function(event, msg) {\r\n        \tvar tips = jsletlocale.Report.tips;\r\n\t\t\tif(self.needAlert) {\r\n\t\t\t\ttips += '<br /><br />' + jsletlocale.Report.tips1;\r\n\t            jslet.ui.confirm(tips, null, function(button){\r\n\t\t\t\t\tif(button == 'ok') {\r\n\t\t\t\t\t\tjslet.ui.info(jsletlocale.Report.ignoreWarning);\r\n\t\t\t\t\t\twindow.open(authURL);\r\n\t\t\t\t\t}\r\n                });\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(tips);\r\n\t\t\t}\r\n        \tthis.connected = false;\r\n        });\r\n\t},\r\n\t\r\n\tsend: function(msgText) {\r\n\t\tvar self = this;\r\n\t\tif(!this.ws || !this.connected) {\r\n\t\t\tthis.open(function() {\r\n\t\t\t\tself._innerSend(msgText);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tself._innerSend(msgText);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_innerSend: function(msgText) {\r\n\t\tif(!this.ws || !this.connected) {\r\n\t\t\tif(this.needAlert) {\r\n\t\t\t\tconsole.log(jsletlocale.tips);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!msgText) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar state = this.ws.state();\r\n\t\tif(state == 'open') {\r\n\t\t\tvar self = this;\r\n\t\t\ttry {\r\n\t\t\t\tself.ws.send(JSON.stringify(msgText));\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(jsletlocale.tips);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdesignReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"design\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tpreviewReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"preview\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tprintReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"print\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tupgrade: function(upgradeUrl) {\r\n\t\tthis.needAlert = false;\r\n\t\tthis.send({\"name\": \"upgrade\", \"body\": upgradeUrl});\r\n\t},\r\n\t\r\n\tgetVersion: function() {\r\n\t\tvar msg = {\"name\": \"version\"};\r\n\t\tthis.needAlert = false;\r\n\t\tthis.send(msg);\r\n\t}\r\n};\r\n})();\r\n\n/* jshint ignore:start */\r\n\treturn jslet;\r\n});\r\n/* jshint ignore:end */\r\n"],"sourceRoot":"/source/"}