{"version":3,"sources":["jslet-ui.js"],"names":["root","factory","define","amd","require","exports","module","jslet","jsletlocale","window","this","ui","Control","Class","create","initialize","el","ctrlParams","Z","binded","allProperties","_evalParams","isValidTemplateTag","template","ctrlClass","getControlClass","type","htmlTemplate","Error","formatMessage","DBControl","invalidHtmlTag","_styleClass","styleClass","undefined","_childControls","setParams","checkRequiredProperty","beforeBind","id","nextId","bind","jqEl","jQuery","addClass","afterBind","renderAll","ctrlType","name","prop","call","requiredProperties","arrProps","split","cnt","length","i","trim","expectedProperty","addChildControl","childCtrl","push","doUIChanged","removeAllChildControls","len","destroy","innerHTML","$super","_dataset","_isDBControl","dataset","isString","data","getDataset","Checker","test","required","isClass","Dataset","className","dsName","getDatasetInParentElement","addLinkedControl","refreshControl","evt","evtType","eventType","RefreshEvent","UPDATEALL","CHANGEMETA","metaName","_field","fieldName","doMetaChanged","UPDATELOOKUP","doLookupChanged","isMetaChanged","SCROLL","INSERT","DELETE","doValueChanged","UPDATERECORD","UPDATECOLUMN","pEl","getParentElement","removeLinkedControl","DBFieldControl","_valueIndex","_enableInvalidTip","_tableId","_tabIndex","field","fldName","k","lastIndexOf","_fieldMeta","substring","fieldMeta","valueIndex","isNumber","parseInt","tabIndex","value","tbIdx","existField","fldObj","getField","tip","title","setTabIndex","tabIdx","tableId","getValue","getFieldValue","getText","isEditing","getFieldText","getFieldError","renderInvalid","errObj","parent","message","removeClass","canFocus","focus","flag","disabled","readOnly","visible","gotoField","innerFocus","selectText","autoSelectAll","e","console","warn","cannotFocusControl","p","startsWith","indexOf","Function","unescape","invalidJsletProp","controls","register","ctrlName","toLowerCase","createControl","jsletparam","width","height","hidden","container","document","createElement","ctrlParam","controlType","DBTEXT","firstChild","removeChild","style","display","appendChild","body","bindControl","jsletParam","isInstalling","isHTMLElement","attr","unbindControl","rebindControl","install","pElement","onJsletReady","isFunction","isRtl","jqBody","hasClass","htmlTags","find","existIds","duplicatedId","global","afterInstall","uninstall","menuManager","off","hideAll","DnD","oldX","oldY","x","y","deltaX","deltaY","bindedControl","dragDelta","dragged","mouseDowned","self","_docMouseDown","event","fix","pageX","pageY","_doMouseDown","_docMouseMove","Math","abs","_doDragStart","_doDragging","_doMouseMove","_docMouseUp","_doDragEnd","_doMouseUp","_docKeydown","which","_doDragCancel","_docSelectStart","preventDefault","ctrl","doc","on","dnd","EditMask","_mask","_keepChar","_transform","_literalChars","_parsedMask","_format","_target","_buffer","prototype","maskChars","#","regexpr","RegExp","0","9","L","l","A","a","C","c","transforms","setMask","mask","keepChar","transform","checker","inArray","_parseMask","attach","target","jqText","_doKeypress","_doKeydown","_doBur","currentTarget","_doCut","originalEvent","clipboardData","_doPaste","detach","setValue","_clearBuffer","pos","ch","vch","fixedChar","prePos","preValuePos","valuePos","_getFixedCharAndPos","charAt","_showValue","maskObj","result","isMask","join","validateValue","cfg","begin","prevChar","notFound","iteralCnt","slice","_validateChar","maskChar","inputChar","maskCfg","regExpr","_getValidPos","toLeft","end","_packEmpty","str","_updateBuffer","_moveCursor","TextUtil","setCursorPos","chCode","String","fromCharCode","toUpperCase","getCursorPos","legnth","msk","setTimeout","getSelectedText","range","setData","pasteValue","getData","txtEl","start","v","setSelectionRange","createTextRange","moveStart","moveEnd","select","selectionStart","selectionEnd","selection","createRange","text","duplicate","collapse","FocusManager","_onChangingFocus","_focusKeyCode","_containerIds","_activeDataset","_activeField","_activeValueIndex","_initialize","onChangingFocus","focusKeyCode","activeDataset","activeField","activeValueIndex","pushContainer","containerId","popContainer","pop","tabPrev","_getContainer","proxy","_doChangingFocus","tabNext","jqContainer","ele","reverse","dsObj","focusedFlds","mergedFocusedFields","cancelFocus","focusedFields","idx","masterFldName","masterField","masterDataset","focusEditControl","isTabableElement","tagName","typeAttr","handleHostKeyDown","defaultFocusKeyCode","keyCode","shiftKey","stopImmediatePropagation","keydown","globalFocusManager","$","selectNextTabbableOrFocusable","selector","isLoop","selectables","sortByTabIndex","current","nextIndex","currEle","currentIndex","index","eq","selectPrevTabbableOrFocusable","prevIndex","items","item","item1","j","splice","focusable","element","expr","filters","parents","addBack","filter","css","map","mapName","img","nodeName","isTabIndexNotNaN","isNaN","parentNode","href","focusNext","focusPrev","extend","createPseudo","dataName","elem","match","tabbable","isTabIndexNaN","MessageBus","_messages","SIZECHANGED","_timeoutHandlers","sendMessage","messageName","messageBody","sender","handler","clearTimeout","ctrls","onReceiveMessage","subscribe","ctrlObj","unsubscribe","messageBus","ResizeEventBus","getResizableChild","childElements","children","child","getAttribute","RESIZABLE","resize","jsletCtrl","_activePopup","hide","checkSizeChanged","_bodyResize","debounce","removeAttr","resizeEventBus","htmlclass","GlobalZIndex","KeyCode","BACKSPACE","TAB","ENTER","SHIFT","CONTROL","ALT","CAPSLOCK","ESCAPE","SPACE","PAGEUP","PAGEDOWN","END","HOME","LEFT","UP","RIGHT","DOWN","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","IME","htmlElement","level","parentElement","findFirstParent","conditionFn","stopConditionFn","findJsletParent","isChild","testNode","TextMeasurer","updateText","lastText","rule","felementWidth","felement","createRule","position","left","top","margin","padding","overflow","setElement","fontSize","fontStyle","fontWeight","fontFamily","lineHeight","textTransform","letterSpacing","setElementWidth","getSize","ruleObj","getWidth","getHeight","textMeasurer","getCssValue","styleName","odiv","setEditableStyle","formElement","onlySetStyle","scrollbarSize","appendTo","innerWidth","remove","fn","getStyleObject","dom","get","returns","getComputedStyle","camelize","b","camel","replace","val","getPropertyValue","currentStyle","Clipboard","clipboard","getElementById","addEventListener","putText","Accordion","params","_selectedIndex","_onChanged","_items","selectedIndex","isGTEZero","onChanged","isArray","caption","panels","headHeight","captionCnt","before","jqCaptions","click","_doCaptionClick","outerHeight","contentHeight","innerHeight","wrap","setSelectedIndex","jqCaption","isRenderAll","jqBodies","pnlCnt","show","Desktop","_header","_onLoadMenu","_menuType","_menuWidth","_expanded","header","onLoadMenu","menuType","menuWidth","desktop","html","isTop","menuEl","wbEl","wbCfg","newable","isFixedHeight","enableLoading","onContentLoading","_doContentLoading","onContentLoaded","_doContentLoaded","onRemoveTabItem","_doRemoveTabItem","_workbench","menuCfg","onItemClick","_openMenu","menuItems","done","_mainMenu","_autoOpenMenu","_toggleMenu","autoOpen","menuContainer","jqHeader","jqWB","expand","showTabPanel","tabPanelId","setContentLoadedState","setTabPanelChanged","changed","setContentChangedState","openMenuById","menuId","_getMenuCfg","openMenuByName","menuName","tabItemId","key","isById","tabItemCfg","timeout","fadeIn","hideLoading","isActive","menuUrl","url","urlUtil","addParam","addTabItem","closable","userIFrame","iconClass","onclick","DesktopUtil","getCurrTabItemId","currTabItemId","location","getParam","isPageDebounce","getDesktop","checkDatasetChangedHandler","changingDatasets","registerEditableDataset","datasetNames","chgDatasets","setInterval","oldChanged","newChanged","isDiff","hasChangedData","clearInterval","desktopUtil","FieldSet","_caption","_collapsed","collapsed","tmpl","nodes","childNodes","obody","_doExpandBtnClick","fsBody","slideDown","slideUp","_menus","menuid","unregister","menu","menus","menuBarShown","_contextObject","MenuBar","_onItemClick","_preHoverItem","_createMenuBar","setDisabled","operator","Menu","Operator","setChecked","checked","isPopup","_createBarItem","_menubarclick","_showSubMenu","omi","itemCfg","jsletvar","subMenu","jqMi","offset","posX","_activeMenuItem","obar","onClick","stopPropagation","_inPopupMenu","each","_invoker","_activeSubMenu","invoker","_createMenuPopup","timerId","outerWidth","jqWin","winWidth","scrollLeft","winHeight","scrollTop","showAt","hostEl","jqHost","ctxElement","showContextMenu","contextObj","panel","_createMenuItem","_createLine","_ItemClick","itemType","_hideSubMenu","zIndex","delayTime","func","jqPmi","_ItemOver","defaultClickHandler","isCheckBox","isRadioBox","mi","disabledIconClass","onmouseover","onmouseout","menuObj","_menuObj","getMenuItemById","getItem","getMenuGroup","excludeSelf","getItemGroup","groupName","group","size","groupItems","changedCfg","otherGroups","jqIcon","Portal","_parts","_partChanged","parts","clearParts","part","loadParts","partChanged","addPart","partCfg","_createPart","removePart","partId","elId","close","setPartCaption","partWin","getPartWindow","setCaption","setPartContent","content","setContent","winCfg","animation","isSmallHeader","onMoving","_doMoving","onPositionChanged","_doPosChanged","onSizeChanged","_doSizeChanged","onClosed","_doClosed","owin","currPartCfg","_getPartCfgWithElId","left0","top0","right0","bottom0","right","bottom","delta","dLeft","dRight","dTop","dBottom","SideMenuBar","_hasSubTitle","_popupWidth","_containerId","_closeTimeout","_showTimeout","oldHeight","hasSubTitle","popupWidth","_clearShowTimeout","_clearCloseTimeout","_doMouseLeave","_doMouseEnter","_doMenuClick","_itemHeight","parseFloat","jqItems","scrTop","maxScrTop","scrollHeight","_getItemById","isFirstLevel","_innerCreateMenuItem","append","getMenuItems","groups","isLine","grpCnt","jqPopupContainer","jqItem","isHidden","posY","jqBox","containerHeight","visiCnt","floor","lastItemH","SplitPanel","directions","_direction","_floatIndex","_onExpanded","_onResize","_oldSize","_oldHeight","_oldWidth","_changeFloatSizeDebounce","_changeFloatSize","floatIndex","direction","onExpanded","onResize","_isHori","_splitterClsName","_splitterMouseDown","jqBtn","jqSplitter","panelDivs","lastIndex","jqPanel","oPanel","minSize","maxSize","Infinity","expanded","_splitterTracker","jqTracker","fixedSize","clsName","splitterSize","after","floatPanel","minBtnCls","splitters","oSplitter","_splitterDragStart","_splitterDragging","_splitterDragEnd","_splitterDragCancel","visiblePanel","panelCnt","floatSize","floatMinSize","panelCfg","notChangeSize","prev","next","_draggingId","jqFp","panelSize","_dragRangeMin","_dragRangeMax","fpMax","endDelta","currWidth","currHeight","TabControl","_activeIndex","_newable","_closable","_onActiveIndexChanged","_onAddTabItem","_onRemoveTabItem","_onCreateContextMenu","_hasContent","_isFixedHeight","_itemsWidth","_containerWidth","_ready","_leftIndex","_rightIndex","_maxHeaderWidth","_tabControlWidth","_tabControlHeight","_contextItemIndex","_onContentLoading","_onContentLoaded","_enableLoading","activeIndex","_chgActiveIndex","activeItemId","itemId","activeItem","hasContent","onAddTabItem","onActiveIndexChanged","onCreateContextMenu","innerAdd","_calcItemsWidth","_createContextMenu","oul","newTab","_newTabItem","isPromise","jqNavBtn","_setVisiTabItems","oitem","_renderTabItem","_checkTabItemCount","addItem","tabHeader","_getTabItemCfg","panelContainer","tabDisabled","jqPanels","jqTabPanels","innerChgActiveIndex","oli","itemContainer","oIframe","scrollWidth","canChanged","_totalItemsWidth","w","_setNavBtnVisible","leftIndex","rightIndex","leftPos","jqBtnLeft","jqBtnRight","totalCnt","_createHeader","canClose","lastNode","insertBefore","_changeTabItem","_doCloseBtnClick","contextMenu","oncontextmenu","removeTabItem","_createBody","jqDiv","contentId","ocontent","jlTabItemId","useIFrame","h","s","jqHead","newItemCfg","noDuplicate","tabItems","newId","reloadTabItem","hasChangedFlag","hasChanged","noTabIndex","tabItemIndex","confirm","contentChanged","MessageBox","button","_innerRemoveTabItem","innerRemove","animate","elItem","tabPanel","active","_getNextValidIndex","canRemoved","isLeft","reload","currIdx","closeOther","closeAll","_menuItemClick","head","TabItem","Window","_resizable","_minimizable","_maximizable","_iconClass","_left","_top","_width","_height","_minWidth","_minHeight","_maxWidth","_maxHeight","_isCenter","_isSmallHeader","_animation","_onSizeChanged","_onPositionChanged","_onMoving","_onActive","_onClosed","_stopEventBubbling","_isModal","_state","resizable","minimizable","maximizable","isCenter","stopEventBubbling","isGTZero","minWidth","minHeight","maxWidth","maxHeight","onActive","_doMovingDebounce","_doWinMouseMove","_doWinMouseDown","_changeBodyHeight","temp_dragging","cursor","activate","maximize","restore","setPosition","_createTrackerMask","_createTracker","trackerMask","_changeTrackerSize","tracker","pOffset","offsetParent","changeSize","_removeTrackerMask","_removeTracker","jqClose","jqMin","minimize","jqMax","btnMax","jqOffsetP","pw","ph","wh","ww","round","showModal","overlay","OverlayPanel","setZIndex","fadeOut","action","pnode","_tempHeight","_tempWidth","_getHeaderHeight","jqParent","bringToFront","notUpdateLeftTop","newLeft","newTop","newDeltaX","newDeltaY","getCaptionPanel","captionDiv","getContentPanel","showError","bodyDiv","node","jqNode","winIdx","maxIndex","nodeType","styleObj","_checkSize","srcEl","jqSrcEl","wdelta","hdelta","ojslet","holder","onmousedown","Calendar","_value","_onDateSelected","_minDate","_maxDate","_currYear","_currMonth","_currDate","isDate","minDate","maxDate","onDateSelected","calendarLocale","yearPrev","monthPrev","monthNext","yearNext","Sun","Mon","Tue","Wed","Thu","Fri","Sat","today","jqTable","_doTableClick","dvalue","Date","d","getFullYear","getMonth","getDate","_fireSelectedEvent","incYear","incMonth","ctrlKey","incDate","_getNotNullDate","deltaDay","setDate","deltaMonth","oldDate","setMonth","newDate","deltaYear","setFullYear","_innerSetValue","oldValue","getTime","m","_setCurrDateCls","_refreshDateCell","_checkNaviState","btnToday","minY","minM","btnYearPrev","visibility","btnMonthPrev","maxY","maxM","btnYearNext","jslet_disabled","btnMonthNext","year","month","monthnames","monthNames","mname","otitle","otable","rows","tBodies","firstDay","w1","getDay","oneDayMs","date","otr","otd","oa","rowCnt","tdCnt","cells","jslet_date_value","jqLink","currM","currY","currD","buttons","callbackFn","hasInput","defaultValue","validateFn","opt","iconHtml","btnName","btnCount","btnHtml","inputHtml","toolBar","inputCtrl","obtn","toolBtn","info","alert","omsgBox","error","isYesNo","prompt","isMultiLine","color","srcEle","PopupPanel","popupElement","checkAndHide","backgroundColor","oldResizeHanlder","onresize","overlayPanel","excludedEl","_onHidePopup","_excludedEl","_contentEl","onHidePopup","excludedElement","contentElement","contentEl","ajustX","ajustY","PopupElement","createPanel","sharedPopPnl","documentClickHandler","changeContent","newPopup","oldContent","border","activePopup","inPopupPanel","activePop","hideCallBack","ProgressBar","_labelText","_setValue","labelText","jqLabel","jqValue","_oldValue","strValue","ProgressPopup","cancellable","onCancelled","_dialog","_cancellable","_onCancelled","progressBar","Rating","_itemCount","_splitCount","_itemWidth","_readOnly","_isReady","itemCount","splitCount","_mouseMove","_mouseOut","_mouseUp","html1","html2","sTd","_getMovedWidth","_changed","cellIndex","offsetX","movedWidth","_round","ceil","intPart","decPart","unit","itemCnt","TipPanel","_hideTimerId","_showTimerId","_oldElement","_tipPanel","tips","leftOrEvent","arguments","isSameCtrl","WaitingBox","overlayColor","tipsAtNewLine","box","tipPanel","jqPnl","FieldControlAddon","DBPlace","editControl","_expandChildWidth","prefix","_prefix","setting","suffix","_suffix","expandChildWidth","hasAddon","_renderEditor","_renderOtherPart","editorEl","parentEl","param","valueStyle","FieldValueStyle","BETWEEN","dbCtrl","ctrlDiv","arrPrefixOrSuffix","fixCfg","partEl","jqCtrlDiv","first","DBText","_beforeUpdateToDataset","_enterProcessed","_autoSelectAll","editMask","_position","beforeUpdateToDataset","enableInvalidTip","doFocus","doBlur","doKeydown","doKeypress","_skipFocusEvent","updateToDataset","_isBluring","K","status","editRecord","existStr","cutString","cursorPos","fieldValidator","checkInputChar","inputText","getType","DataType","STRING","chs","isForce","afterRefreshControl","editMaskCfg","maxLength","getEditLength","_keep_silence_","align","alignment","textAlign","activeElement","antiXss","htmlDecode","updateAllEvent","setFieldText","updateRecordEvent","onKeyDown","DBPassword","DBTextArea","DBCustomComboBox","_textReadOnly","textReadOnly","textCtrl","btnCls","comboButtonCls","dbtext","_textField","buttonClick","blur","dbbtn","popupUp","DBAutoComplete","MatchModes","_lookupField","_minChars","_minDelay","_beforePopup","_filterFields","_defaultFilterFields","_onGetFilterField","_matchMode","_timeoutHandler","lookupField","minChars","minDelay","matchMode","testValue","filterFields","beforePopup","onGetFilterField","contentPanel","isShowing","_isSelecting","canBlur","lkf","lookup","lkds","recordCount","closePopup","doChange","_invokePopup","confirmSelect","isPop","prior","_populate","_getDefaultFilterFields","lookupFldObj","codeFld","codeField","nameFld","nameField","lkDs","codeFldObj","nameFldObj","arrFields","_getFilterFields","lkFldObj","inputValue","filterFlds","eventFunc","getFunction","filterValue","lkFld","oldFlag","autoRefreshHostDataset","editFilter","filtered","fixedFilter","dataRec","getRecord","DBAutoCompletePanel","r","dlgWidth","showPopup","_destroyPopPanel","autoCompleteObj","comboCfg","lkfld","lkDataset","fields","getNormalFields","totalChars","displayWidth","totalWidth","defaultCharWidth","cnth","dlgHeight","tableparam","noborder","hasSelectCol","hasSeqCol","hideHead","onRowClick","fldValue","keyValue","setFieldValue","afterSelect","popup","doClosePopup","oldRecno","recno","DBBetweenEdit","_minEleId","_maxEleId","lbl","betweenLabel","ctrlCfg","JSON","stringify","DBCheckBox","_beforeClick","_skipRefresh","beforeClick","_doClick","DBCheckBoxGroup","_columnCount","_hasSelectAllBox","_itemIds","columnCount","hasSelectAllBox","activeEle","activeId","delegateTarget","chkEle","chkBoxes","checkbox","checkboxs","chkcnt","values","valueCnt","lookupNotFound","lkCnt","noOptions","isNewRow","_innerEditFilterExpr","editItemDisabled","Expression","disableOption","selectAll","recnoSilence","eval","keyField","getCurrentDisplayValue","currCheckBox","_is_silence_","chkBox","allCnt","allBoxes","isAllSelected","limitCount","valueCountLimit","NORMAL","count","showInfo","invalidCheckedCount","itemIds","DBCKEditor","_editorId","_editor","CKEDITOR","editorId","editor","_doFocus","_doBlur","_doChange","state","setReadOnly","resetDirty","checkDirty","DBComboSelect","showStyles","_showStyle","_popupHeight","_contentPanel","_pickupField","_onGetSearchField","_correlateCheck","_autoSelected","textField","popupHeight","showStyle","onGetSearchField","correlateCheck","autoSelected","btnEle","parentField","DBComboSelectPanel","customButtonLabel","onCustomButtonClick","comboSelectObj","_isShowing","fieldObject","searchBoxEle","_oldFilter","_oldFiltered","_restoreLkDsEvent","_confirmSelectDebounce","_confirmSelect","lookupDs","isMultiple","MULTIPLE","_initSelected","showType","otree","_create","_setLookupDsEvent","_showTips","_focus","dispCtrl","_oldLkDsCheckSelectable","onlyLeafLevel","onCheckSelectable","hasChildren","_oldLkDsListener","datasetListener","DatasetEvent","AFTERSELECT","jqPh","_confirmAndClose","F","_findData","treeParam","displayFields","hasCheckBox","expandLevel","tableParam","hasFindDialog","hasFilterDialog","findByKey","disableControls","arrKeyValues","valueSeparator","selectByKeyValue","enableControls","searchText","findFldName","searchField","findingValue","findFldNames","currRecno","options","startRecno","findingByText","matchType","found","findByField","isEqual","isMulti","selectedKeyValues","cannotSelect","_afterSelect","DBDataLabel","DBDatePicker","dateValue","dataRange","min","max","DBHtml","DBImage","_locked","_baseUrl","_altField","_enableViewer","_viewUrlField","baseUrl","enableViewer","viewUrlField","altField","locked","ImageViewer","viewer","_getImgUrl","isForViewer","srcUrl","alt","lockedImageTips","src","srcURL","altText","DBLabel","isLabel","METANAMES","subType","REQUIREDCHAR","displayLabel","DBList","pfld","afterCheckBoxClick","afterSelectAll","selected","DBLookupLabel","_lookupValue","_returnField","lookupValue","returnField","DBRadioGroup","radioEle","radios","radio","DBRangeSelect","_beginItem","_endItem","_step","beginItem","endItem","step","multiple","_doChanged","_currOption","inProcessing","renderOptions","arrhtm","nullText","arrValue","optCnt","vcnt","opts","DBRating","_required","DBSelect","_groupField","_lookupDataset","_isRendering","groupField","lookupDataset","_doCheckLimitCount","_setDefaultValue","firstItemValue","dftValue","changedStatus","FieldLookup","groupLookup","groupFldObj","groupIsLookup","indexFields","groupValue","groupDisplayValue","preGroupValue","optValue","label","moreLookupRecords","_checkOptionEditable","valueChanged","DBSelectView","_displayFields","dispFields","dispField","_innerDisplayFieldsExpr","_renderOptions","fixedIndexFields","dispFieldExpr","DBSpinEdit","tag","_createControl","upButton","downButton","_isDisabled","decValue","incValue","minValue","Number","NEGATIVE_INFINITY","maxValue","POSITIVE_INFINITY","setValueToDataset","silence","_getRange","jqUpBtn","jqDownBtn","DBTimePicker","_is12Hour","_hasSecond","is12Hour","hasSecond","minTimePart","hour","minute","second","maxTimePart","_splitTime","minHour","maxHour","_getOptions","timePart","jqHour","jqMinute","jqAmPm","getHours","getMinutes","getSeconds","DATE","setHours","setMinutes","setSeconds","DBUEditor","UE","getEditor","addListener","getContent","ListViewModel","isTree","visibleCount","visibleStartRow","visibleEndRow","needShowRows","allRows","currentRowno","currentRecno","onTopRownoChanged","onVisibleCountChanged","onCurrentRownoChanged","onNeedShowRowsCountChanged","onCheckStateChanged","fixedRows","initial","ds","_parentField","_keyField","refreshModel","pId","tmpNode","tmpKeyValue","currRec","recCnt","pnodes","parentValue","keyvalue","isbold","_updateNodeBoldStyle","_setLastFlag","_refreshNeedShowRows","update","cnode","selectedByRecno","pNode","islast","notFireChangedEvent","_findVisibleNode","currCnt","_innerFindNode","getLevel","rownoToRecno","rowno","recnoToRowno","setVisibleStartRow","notFireEvt","maxVisibleNo","getNeedShowRowCount","getVisibleStartRow","setVisibleEndRow","endRow","getVisibleEndRow","setVisibleCount","getVisibleCount","getCurrentRow","skipSetCurrentRowno","_skipSetCurrentRowno","setCurrentRowno","checkVisible","preRowno","currRow","lowestRowno","maxRow","getCurrentRowno","getCurrentRecno","nextRow","priorRow","num","nextPage","priorPage","_iterateNode","_callbackFn","expandAll","collapseAll","syncDataset","checkNode","relativeCheck","onlyCheckChildren","_updateChildState","_updateParentState","checkChildNodes","childNode","newState","childState","pState","reset","DBTreeView","_useArrow","_hasLine","_hasCheckBox","_correlative","_onlyCheckChildren","_iconClassField","_expandLevel","_onItemDblClick","_beforeCheckBoxClick","_afterCheckBoxClick","_onGetIconClass","_onRenderItem","_enableErrorFinding","iconWidth","itemHeight","iconClassField","useArrow","hasLine","correlative","enableErrorFinding","onItemDblClick","beforeCheckBoxClick","onGetIconClass","onRenderItem","scrBarSize","ti","E","gotoNextError","last","notFF","onmousewheel","wheelEvent","wheelDelta","detail","listvm","scrollEvent","evaluator","oldWidth","nodeHeight","strHeight","treePanelHeight","treePanelWidth","nodeCount","_initVm","_initFrame","strCheckbox","lines","NODETYPE","strLines","_doRowClick","_doRowDblClick","sb","numb","_skip_","nextError","firstError","_fillData","_doCurrentRowChanged","_syncScrollBar","allCount","prevRowno","_doCheckBoxClick","_getTrByRowno","row","jsletrowno","prevRow","_getTextTd","TREENODECLASS","_doExpand","treeNode","_syncToDs","hasCheckbox","vCnt","topRowno","availbleCnt","nodeWidth","preRowNo","ajustScrBar","maxNodeWidth","_fillNode","_checkScrollBar","_setCheckClsName","oCheckBox","jqCheckBox","nodeTbl","rowNo","cellCnt","requiredCnt","insertCell","pitem","TREELINECLASS","empty","line","jqSign","oexpander","noWrap","minusBottom","plusBottom","minus","plus","joinBottom","checkSelectable","ocheckbox","oIcon","iconClsId","isLeaf","oText","jqTd","existRecordError","getRecordErrorInfo","jqScr","scr","clientHeight","checkAll","uncheckAll","SELECTALL","SELECTRECORD","noLineMinus","noLinePlus","TREECHECKBOXCLASS","unChecked","mixedChecked","childChecked","treeNodeLevel","table","TableCellEditor","tableCtrl","colCfg","columns","_tableCtrl","_sysColumns","tblDataset","innerColumns","isBool","dataType","isManual","editorTabIndex","alignStr","editableFields","readOnlyFields","ACTION","EDITACTION","fieldReadOnly","fieldDisabled","additionStr","BOOLEAN","widthCssName","_editPanel","rowHeight","_currField","showEditor","hideEditor","cellPos","firstId","firstOffset","offsetHeight","jqEditor","currentField","CellRender","createHeader","cellPanel","colSetting","createCell","refreshCell","recNo","DefaultCellRender","noRefresh","getFieldTextByRecno","urlExpr","calcUrl","urlTarget","jqCellPanel","_showSelected","SequenceCellRender","_seqColHeader","_reverseSeqCol","SelectCellRender","_beforeSelectAll","_onSelectAll","_afterSelectAll","ocheck","jqCheck","_doSelectBoxClick","EditActionCellRender","jqCell","DBTable","appendTip","_doAppendRecord","deleteTip","_doDeleteRecord","SubgroupCellRender","BoolCellRender","getFieldValueByRecno","TreeCellRender","indentWidth","jqExpBtn","expandedByRecno","getIconClass","iconCls","cellRenders","defaultCellRender","treeCellRender","boolCellRender","sequenceCellRender","selectCellRender","editActionCellRender","subgroupCellRender","TABLECLASS","currentrow","scrollBarWidth","selectColWidth","hoverrow","TableColumn","disableHeadSort","disableFilter","mergeSame","cellRender","colNum","displayOrder","colSpan","TableSubgroup","hasExpander","TableHead","subHeads","rowSpan","AbstractDBTable","_fixedRows","_fixedCols","_hasSeqCol","_hasSelectCol","_noborder","_editable","_hideHead","_onlySpecifiedCol","_disableHeadSort","_disableMouseWheel","_aggregated","_autoClearSelection","_selectBy","_rowHeight","_headRowHeight","_footerRowHeight","_treeField","_columns","_editableFields","_readOnlyFields","_onRowClick","_onRowDblClick","_onCellClick","_onSelect","_beforeSelect","_onFillRow","_onFillCell","_onAppendRecord","_onDeleteRecord","_defaultCellRender","_hasFindDialog","_hasFilterDialog","_repairHeight","subgroup","_isHoriOverflow","_currRow","_currColNum","_editingField","_editorTabIndex","_rowHeightChanged","_autoStretch","_minVisibleRows","_maxVisibleRows","_oldVisibleRows","_cellEditor","fixedCols","cols","headRowHeight","footerRowHeight","reverseSeqCol","seqColHeader","editable","aggregated","autoClearSelection","disableMouseWheel","onlySpecifiedCol","selectBy","treeField","isObject","currColNum","oldColNum","_adjustCurrentCellPos","_showCurrentCell","_findDialog","findingField","onRowDblClick","onCellClick","onSelect","onSelectAll","beforeSelect","beforeSelectAll","onFillRow","onFillCell","onAppendRecord","onDeleteRecord","autoStretch","minVisibleRows","maxVisibleRows","cellEditor","colObj","getColNumByField","gotoColumn","lastColNum","getFieldByColNum","_calcTabIndex","masterFldObj","getMasterFieldObject","charHeight","charWidth","_widthStyleId","_initializeVm","_bindEvents","DataSetStatus","BROWSE","_filterPanel","DBTableFilterPanel","jqFilterBtn","tblPos","changeField","_doDblCellClick","offsetY","_doCellClick","checkFn","jsletrecno","callBackFn","aborted","altKey","showFindDialog","selectAllCells","copySelection","isTabKey","tabPrior","movePriorCell","moveNextCell","_doBeforeSelect","_processSelection","copy","fixed","fixedCol","fixedRow","copyInfo","FindDialog","headSectionHt","fitExcel","selectedText","getSelectionText","_refreshSelection","editingFields","_getEditingFields","focusMngr","onChangingFocusFn","_showCurrentRow","_hideCurrentRow","_innerDestroy","_calcParams","_createFrame","_updateSortFlag","hasCtrlKey","hasShiftKey","hasAltKey","_getSelectionFields","startColNum","endColNum","tmp","isSelected","add","_preRecno","_preColNum","_preTmpRecno","_preTmpColNum","removeAll","_processColumnSelection","_processRowSelection","_prepareColumn","getColumnObj","colCnt1","cobj","seqColWidth","isSeqCol","isSelectCol","isSubgroup","tmpColumns","colCnt2","fldcnt","colCnt","getFields","getTopField","isUnique","n","sort","cobj1","cobj2","ord1","ord2","innerHeads","ohead","context","depth","_convertField2Head","maxHeadRows","_calcHeadSpan","preColCnt","fixedColNum","heads","childCnt","parentHeadObj","checkHtml","htmlStr","reg","fldChildren","isBoolColumn","sWidth","fixedSectionHt","checkAggregated","footSectionHt","hasFixedCol","fixedColWidth","_setScrollBarMaxValue","jqVScrollBar","contentSectionHt","_changeColWidthCssRule","cssName","styleEle","styleSheet","sheet","cssRules","rules","cssRule","selectorText","_changeColWidth","deltaW","designMode","_changeContentWidth","_refreshSeqColWidth","oldSeqColWidth","getTotalWidth","totalWidthStr","leftHeadTbl","leftFixedTbl","leftContentTbl","rightHeadTbl","rightFixedTbl","rightContentTbl","rightFootTbl","_checkHoriOverflow","generateWidthStyle","styleHtml","checkDropable","currCell","jsletColCfg","srcRowIndex","dragTransfer","rowIndex","srcCellIndex","currRowIndex","currCellIndex","srcFldName","currFldName","srcPFldObj","currPFldObj","dbtableframe","norecord","leftFootTbl","jqRightHead","_doSplitHookDown","_doSplitHookUp","isDraggingColumn","_doHeadClick","_head_label_cliecked","transfer","dataTransfer","dropEffect","effectAllowed","destField","_moveColumn","jqLeftFixedTbl","jqRightFixedTbl","jqLeftContentTbl","jqRightContentTbl","hasLeft","_isCurrCellInView","temp","focusing","splitter","bodyMleft","currColId","_renderHeader","noRecordDiv","_renderBody","destCellIndex","moveOneRow","srcStart","srcEnd","destStart","destEnd","colNo","srcCells","destCells","destCell","insertAfter","moveOneTableColumn","rowObj","createTHead","preColNo","srcCell","srcColCfg","destColCfg","destFldName","moveField","currField","dataRows","_changeColNum","headRows","srcCellLen","destCellLen","firstDestColNum","newStart","_calcAndSetContentHeight","rh","_stretchContentHeight","_stretchContentRow","contentWidth","clientWidth","_refreshHeadCell","oth","ochild","sh","_isCellEditable","_createHeadCell","sorttitle","travHead","arrHeadCfg","ccnt","leftHeadObj","rightHeadObj","insertRow","jqTr1","jqTr2","sortedCell","indexField","ohook","tblContainer","jqTblContainer","bodyMTop","jqHook","currLeft","splitDiv","lastChild","_getColumnByField","ctrlKeyPressed","_doSort","sortField","isMultiSort","toggleIndexField","leftHeadCells","rightHeadCells","sortFields","mergedIndexFields","allHeadCells","sortDiv","sortFlag","sortObj","order","oJslet","_getTableRow","offsetTop","otrRecno","focusedEle","_renderCell","isFirstCol","_renderRow","sectionNum","onlyRefreshContent","rightBody","leftBody","isfirstCol","startRow","fldCnt","sysColLen","rightRows","visibleRowCnt","leftRows","oldRowCount","_renderTotalSection","_fillTotalSection","aggregateValues","aggregatedValues","otrLeft","otrRight","sysColCnt","totalValue","aggregateValueObj","labelDisplayed","canShowLabel","totalLabel","NUMBER","sum","dispFmt","displayFormat","displayValue","formatNumber","noRecord","_fillRow","isFixed","clen","contentRows","sameValueNodes","isFirst","actualCnt","_fillCell","isSameAsPrevious","cell","sameNode","jqFirstTd","getFieldErrorByRecno","refreshCurrentRow","contentBody","fixedBody","_getLeftRowByRecno","_getCurrCellEl","cellEl","contentRow","jqContentPanel","currTd","currTdLeft","offsetLeft","currTdWidth","offsetWidth","containerWidth","containerLeft","borderW","oldScrLeft","currColLeft","scrWidth","prevCell","ocells","sw","scrBar","toggle","_doMetaChanged","currFld","col","AGGREGATED","BEFORESCROLL","checkFilterBtnStyle","preRecno","defaultChecked","leftFixedBody","leftContentBody","isEditable","appendRecord","deleteRecord","newHeight","parsedHeads","Splitter","_splitDiv","isDragging","unattach","onSplitEnd","onSplitCancel","tblCtrl","_filterDatasetObj","FilterDataset","_filterDataset","filterDataset","_dbtable","_jqFilterBtn","_currFieldName","_currFilterExpr","dsFilter","cancel","_panel","cancelFilter","FilterPanel","ok","clear","clearAll","isEmpty","getFilterExpr","_setFilterBtnStyle","records","_clearFilterBtnStyle","dsHost","dsFilterExpr","filterText","getFilterExprText","dbContainer","findData","jqFindingValue","isStart","_findingField","findDialog","_containerEl","placeholder","dlgEl","jqFind","oldField","changeCaption","DBChart","chartTypes","legendPositions","_chartType","_categoryField","_valueFields","_chartTitle","_legendPos","_recordRange","RecordRange","ALL","_reverse","_fieldValidated","_echart","_onSetChartOption","chartType","categoryField","valueFields","chartTitle","legendPos","recordRange","onSetChartOption","_getEChart","echarts","init","_validateFields","fieldNotFound","_getLineRecord","xLabels","yValues","yFields","legendLabels","endRecno","CURRENT","valueFldName","valueArr","isInit","valueFldCnt","isSelectedRange","SELECTED","_getLineRecordReverse","_getLineData","_getPieData","chartData","_drawLineChart","echart","option","legend","xAxis","yAxis","series","stack","chtype","setOption","_drawPieChart","drawChart","is","hasSelectedRecords","jqplot","DBEditPanel","_totalColumns","_labelCols","_onlySpecifiedFields","_includeFields","_excludeFields","_layout","_hasLabel","_metaChangedDebounce","labelCols","between","onlySpecifiedFields","hasLabel","layout","fldCfg","dataCols","inFirstCol","showLine","includeFields","excludeFields","_calcLayout","fldLayout","allFlds","fcnt","fldLayouts","layoutCnt","exFields","inFields","dftDataCols","colsInRow","_innerLabelCols","_innerDataCols","getEditField","editFld","oLabel","editorCfg","ohr","octrlDiv","opanel","ctrlId","layouts","layoutHeight","DBInspector","_calcLabelWidth","columnCnt","arrLabelWidth","fieldLayouts","tHead","fldCtrl","oldRowNo","preRowIndex","DBINSPECTOR","labelColCls","editorColCls","DBError","ERROR","DBPageBar","_showPageSize","_pageSizeList","_currPageCount","showPageSize","pageSizeList","pageSize","refresh","pageNum","_jqPageSize","pgSizeList","pageNo","requery","_jqFirstBtn","_jqPriorBtn","_jqNextBtn","_jqLastBtn","_jqRefreshBtn","_jqPageNum","pageCount","CHANGEPAGE","_refreshPageNum","_refreshButtonStatus","pageCnt","prevDisabled","nextDisabled","BatchEditDialog","editFields","_editFields","_onChanging","_batchDataset","getEditableFields","unique","addFieldFromDataset","defaultExpr","onChanging","creating","_dlgId","_createDialog","bedLocale","onlySelectedId","onlyNullId","onlySelected","onlyNullValue","onlyNull","_modifyData","existDatasetError","errorData","fldNames","allFldObjs","iterate","ChartDialog","setProp","propName","_chartId","_parsedValueFields","_chartSettingDs","_chartSettingDsName","_chartTypeDs","chartLocale","code","ctLine","ctBar","ctPie","ctStackBar","chartTypeDs","isEnum","ranges","rrAll","rrCurrent","rrSelected","rangeDs","valueFldLkDs","onFieldChanged","_doFieldChanged","_chartTypes","excludeValueFields","_excludeValueFields","_refreshValueFields","valueFieldsRequired","chartCfg","chartObj","valueFlds","ExportDialog","_exportDataset","_onExported","_onQuerySchema","_onSubmitSchema","_progressBar","_hasSchemaSection","hasSchemaSection","fileName","existedErrorData","_innerShow","_querySchema","_hasDetailDataset","_refreshFields","description","jqExpportFile","onQuerySchema","onSubmitSchema","onExported","edLocale","exportLKDs","isFireGlobalEvent","expFldCfg","expHtml","schemaName","saveAsSchema","saveSchema","deleteSchema","onlyOnce","exportData","_exportData","_saveSchema","_saveAsSchema","_deleteSchema","dsExport","_submitSchema","schema","inuputSchemaLabel","_isProgChanged","queryFn","exportDialog","schemaData","changedRecord","actionFn","fileAndFieldsRequired","defaultXPorter","excelXPorter","exportAggregated","onExporting","_doExporting","_doExported","percent","addFields","fieldRecords","fieldNames","isDetailDs","isActionCol","isEdtActCol","detailDs","detailDataset","all","dialogCfg","_imageUrl","isModal","imageUrl","ImportDialog","_importDataset","_parsedData","_onCustomImport","_onImporting","_onImported","_schemaDsName","_schemaLkDsName","_colHeaders","onCustomImport","onImporting","onImported","schemaLKDs","auditLogEnabled","logChanges","importDialogLocale","schemaDs","_doSchemaChanged","fieldLabel","columnHeader","fixedValue","importData","files","_readFile","_importData","innerRefresh","importDialog","_jl_","fieldMaps","_getFieldMaps","dsSchema","dsSchemaLk","startSilenceMove","foundRecno","endSilenceMove","existedSchema","strMaps","_getColHeaders","_isSaving","labels","errLabels","duplicateFields","fileObj","notSupportFile","reader","FileReader","onload","fileContent","parsedResult","_addColumnHeader","noData","readAsBinaryString","headers","colHeader","_mapFieldColumn","rec","mapFlds","mapFldCnt","parse","arrColHeaders","headerCnt","dsColHeader","schColHeader","mapFld","noColHeader","colHeaders","isSuccess","fldMap","textRec","parsedData","textList","importingFn","progressBarObj","StepProcessor","importTextList","_doImported","run","InputSettingDialog","doProxyFieldChanged","proxyFldName","proxyFldObj","hostFldObj","scale","dateFormat","displayControl","validChars","hostLkObj","lkObj","toPlanObject","editorObj","fldType","labelLabel","labelFocused","labelValueFollow","labelDefaultValue","proxyHostFieldName","proxyFieldChanged","_inputSettingDs","custContextFn","changingFldName","contextRules","condition","customized","enableContextRule","propValue","_isInit","_settings","hostDsName","hostFldName","dsSetting","fldSetting","_hostDataset","_onRestoreDefault","hostDataset","onClosedFn","onRestoreDefault","onRestoreDefaultFn","_initializeFields","tblFields","tableWidth","hostDs","isKeepFields","isDsFld","focused","valueFollow","save","propSetting","defaultInputSettingDialog","DatasetDesigner","_datasetMetas","_onLoadDatasetMeta","_onSaveDatasetMeta","_prepareDataset","onLoadDatasetMeta","onSaveDatasetMeta","dsgnLocale","dtString","dtNumber","dtDate","dtBoolean","dtDataset","dtAction","dtEdit","alLeft","alCenter","alRight","vsNormal","vsBetween","vsMultiple","objAccessor","origValue","fName","fShortName","fLabel","fDisplayLabel","fTip","fDateType","fDetailDataset","fLength","diaplayFormat","fScale","fDefaultExpr","fDefaultValue","customValueAccessor","fValueStyle","fDisplayWidth","fDisplayOrder","fAlignment","fDisplayFormat","fEditControl","fvEditControl","fNullText","fvNullText","fFormula","fReadOnly","fVisible","fUnitConverted","fRequired","fDataRange","fRegularExpr","fUnique","fEditMask","fValueCountLimit","fValidChars","fMergeSame","fMmergeSameBy","fAggraded","fAggradedBy","fValueFollow","fFocused","fFixedValue","fAntiXss","fTrueValue","fFalseValue","fTrueText","fFalseText","fLookup","dsgnField","_doDataTypeChanged","meta","otherwise","dsDesc","dsKeyField","dsCodeField","dsNameField","dsParentField","dsSelectField","dsStatusField","dsContextRules","dsQueryUrl","dsSubmitUrl","dsRecordClass","dsPageSize","dsFixedIndexFields","dsIndexFields","dsFixedFilter","dsFiltered","dsReadOnly","dsAuditLogEnabled","dsObject","AFTERSCROLL","_doObjectChanged","log","queryDatasetMeta","dsMetas","_parse","addDatasetMeta","addEnumDatasetMeta","deleteDatasetMeta","parentId","fldMeta","fldId","fldLen","arrObj","objCode","objName","objType","dsMeta","dsId","jqDataset","jqDsLookup","jqDsFilter","jqField","dsgnDataset","jqFldDetail","jqFldCommon","jqFldAction","jqFldEditAction","jqFldEditable","jqFldBool","jqFldLookup","jqFldString","jqFldNumber","DATASET","eventAction","fire","sgcWebSocket","host","subprotocol","user","password","transport","f","open","websocket","WebSocket","onopen","onmessage","g","stream","onclose","reason","clean","wasClean","onerror","send","readyState","EventSource","XMLHttpRequest","xhr","ActiveXObject","wsSocket","serverIp","onSavingReport","Report","reportServerIp","getWsSocket","WsSocket","reportBo","decodeURIComponent","escape","atob","savingReportFn","design","datasets","reportId","reportName","templateXml","printFields","isPlanObject","_combineReportBo","designReport","preview","printRange","previewReport","print","printReport","inDesign","reportBO","btoa","encodeURIComponent","rptDatasets","dsCode","rtnCfg","dsCodes","_createRptDataset","rptDataset","exportTextArray","exportHeader","notFoundDs","rptFields","dsPrintFields","arrFldNames","defaultReport","assistantURL","authURLSSL","isSSL","protocol","ws","connected","needAlert","version","openCallBackFn","messageText","msgName","msgBody","onMessage","msg","tips1","ignoreWarning","msgText","_innerSend","report","upgrade","upgradeUrl","getVersion"],"mappings":"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","file":"jslet-ui.min.js","sourcesContent":["/*!\r\n * Jslet JavaScript Framework v4.0.0\r\n * http://www.jslet.com\r\n *\r\n * Copyright 2016 Jslet Team\r\n * Released under GNU AGPL v3.0 license and commercial license\r\n */\r\n\r\n/* jshint ignore:start */\r\n\"use strict\";\r\n(function (root, factory) {\r\n    if (typeof define === 'function') {\r\n    \tif(define.amd) {\r\n\t        define('jslet-ui', ['jslet-data', 'jslet-locale'], factory);\r\n\t    } else {\r\n\t    \tdefine(function(require, exports, module) {\r\n\t    \t\trequire('jslet-css');\r\n\t    \t\tvar jslet = require('jslet-data');\r\n\t    \t\tvar jsletlocale = require('jslet-locale');\r\n\t    \t\tmodule.exports = factory(jslet, jsletlocale);\r\n\t    \t});\r\n\t    }\r\n    } else {\r\n    \tfactory(window.jslet, window.jsletlocale);\r\n    }\r\n})(this, function (jslet, jsletlocale) {\r\n\tif(!jslet.ui) {\r\n\t\t/**\r\n\t\t * @class\r\n\t\t * @static\r\n\t\t */\r\n\t\tjslet.ui = {};\r\n\t}\r\n\r\n/* jshint ignore:end */\r\n\n/**\r\n* @class\r\n* \r\n* Control Class, base class for all control.\r\n*/\r\njslet.ui.Control = jslet.Class.create({\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Constructor method.\r\n\t * \r\n\t * @param {HtmlElement} el HTML element.\r\n\t * @param {String | Object} ctrlParams Parameters of this control, it would be a JSON string or plan object, like: '{prop1: value1, prop2: value2}'.\r\n\t */\r\n\tinitialize: function (el, ctrlParams) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.binded = false;\r\n\t\t\r\n\t\tZ.allProperties = null;\r\n\t\tctrlParams = jslet.ui._evalParams(ctrlParams);\r\n\t\tif (Z.isValidTemplateTag\t&& !Z.isValidTemplateTag(Z.el)) {\r\n\t\t\tvar ctrlClass = jslet.ui.getControlClass(ctrlParams.type), template;\r\n\t\t\tif (ctrlClass) {\r\n\t\t\t\ttemplate = ctrlClass.htmlTemplate;\r\n\t\t\t} else {\r\n\t\t\t\ttemplate = '';\r\n\t\t\t}\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.invalidHtmlTag, template));\r\n\t\t}\r\n\t\tZ._styleClass = null;\r\n\t\t\r\n\t\tZ.styleClass = function(styleClass) {\r\n\t\t\tif(styleClass === undefined) {\r\n\t\t\t\treturn Z._styleClass;\r\n\t\t\t}\r\n\t\t\tZ._styleClass = styleClass;\r\n\t\t};\r\n\t\t\r\n\t\tZ._childControls = null;\r\n\t\tZ.setParams(ctrlParams);\r\n\t\tZ.checkRequiredProperty();\r\n\t\tZ.el.jslet = this;\r\n\t\tZ.beforeBind();\r\n\t\tif(!Z.el.id) {\r\n\t\t\tZ.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tZ.bind();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(Z._styleClass) {\r\n\t\t\tjqEl.addClass(Z._styleClass);\r\n\t\t}\r\n\t\tZ.afterBind();\r\n\t\tZ.binded = true;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Before bind.\r\n\t * Child control can extend this method.\r\n\t */\r\n\tbeforeBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Bind this control to a HTML element.\r\n\t */\r\n\tbind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * After bind.\r\n\t */\r\n\tafterBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Render this control, if control configuration is changed, call this method to refresh control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\trenderAll: function() {\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tsetParams: function (ctrlParams) {\r\n\t\tif (!ctrlParams) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ctrlType = ctrlParams.type;\r\n\t\tthis.styleClass(ctrlParams.styleClass);\r\n\t\t\r\n\t\tfor(var name in ctrlParams) {\r\n\t\t\tvar prop = this[name];\r\n\t\t\tif(name == 'type' || name == 'styleClass') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(prop && prop.call) {\r\n\t\t\t\tprop.call(this, ctrlParams[name]);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(ctrlType +  \" NOT support control property: \" + name);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tcheckRequiredProperty: function () {\r\n\t\tif (!this.requiredProperties) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar arrProps = this.requiredProperties.split(','),\r\n\t\t\tcnt = arrProps.length, name;\r\n\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\tname = arrProps[i].trim();\r\n\t\t\tif (!this[name]) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.expectedProperty, [name]));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Add child control into this control.\r\n\t */\r\n\taddChildControl: function(childCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._childControls) {\r\n\t\t\tZ._childControls = [];\r\n\t\t}\r\n\t\tif(childCtrl) {\r\n\t\t\tZ._childControls.push(childCtrl);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh dataset when user changed the value.\r\n\t */\r\n\tdoUIChanged: function () {},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Remove all child controls from this control.\r\n\t */\r\n\tremoveAllChildControls: function() {\r\n\t\tvar Z = this, childCtrl;\r\n\t\tif(Z._childControls) {\r\n\t\t\tfor(var i = 0, len = Z._childControls.length; i < len; i++) {\r\n\t\t\t\tchildCtrl = Z._childControls[i];\r\n\t\t\t\tchildCtrl.destroy();\r\n\t\t\t}\r\n\t\t\tZ._childControls = null;\r\n\t\t}\r\n        if(Z.el) {\r\n            Z.el.innerHTML = '';\r\n        }\r\n\t},\r\n\t\r\n\t/**\r\n\t * Destroy method\r\n\t */\r\n\tdestroy: function(){\r\n\t\tif(this.el) {\r\n\t\t\tthis.el.jslet = null;\r\n\t\t\tthis.el = null;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Base data sensitive control.\r\n */\r\njslet.ui.DBControl = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_dataset: undefined,\r\n\r\n\t_isDBControl: true,\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Dataset which to link to control.\r\n\t * \r\n\t * @param {String | undefined} dataset Dataset name.\r\n\t * \r\n\t * @return {this | jslet.data.Dataset}\r\n\t */\r\n\tdataset: function(dataset) {\r\n\t\tif(dataset === undefined) {\r\n\t\t\treturn this._dataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(dataset)) {\r\n\t\t\tdataset = jslet.data.getDataset(jQuery.trim(dataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBControl.dataset', dataset).required().isClass(jslet.data.Dataset.className);\r\n\t\tthis._dataset = dataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tif(this._isDBControl && !this._dataset) {\r\n\t\t\tvar dsName = this.getDatasetInParentElement();\r\n\t\t\tthis.dataset(dsName);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t * \r\n\t * Call this method before binding parameters to a HTML element, you can rewrite this in your owner control.\r\n\t */\r\n\tbeforeBind: function ($super) {\r\n\t\t$super();\r\n\t\tif(this._isDBControl) {\r\n\t\t\tthis._dataset.addLinkedControl(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcheckRequiredProperty: function($super) {\r\n\t\tif(this._isDBControl) {\r\n\t\t\tjslet.Checker.test('DBControl.dataset', this._dataset).required();\r\n\t\t}\r\n\t\t$super();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh control when data changed.\r\n\t * There are three type changes: meta changed, data changed, lookup data changed.\r\n\t * \r\n\t * @param {jslet.data.RefreshEvent} evt jslet refresh event object.\r\n\t * \r\n\t * @return {Boolean} if refresh successfully, return true, otherwise false.\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this, evtType;\r\n\t\tif(evt) {\r\n\t\t\tevtType = evt.eventType;\r\n\t\t} else {\r\n\t\t\tevtType = jslet.data.RefreshEvent.UPDATEALL;\r\n\t\t}\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tvar metaName = evt.metaName;\r\n\t\t\tif(Z._field && Z._field == evt.fieldName) {\r\n\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t} else {\r\n\t\t\t\tif(!Z._field && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//Lookup data changed\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATELOOKUP && evt.fieldName == Z._field) {\r\n\t\t\tZ.doLookupChanged(evt.isMetaChanged);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t//Value changed\r\n\t\tif (evtType == jslet.data.RefreshEvent.SCROLL || \r\n\t\t\t\tevtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif((evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) && \r\n\t\t\tevt.fieldName === undefined || evt && evt.fieldName == Z._field){\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.doMetaChanged();\r\n\t\t\tZ.doLookupChanged();\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}, // end refreshControl\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field meta is changed.\r\n\t * \r\n\t * @param {String} metaName Field meta name, like: readOnly, disabled,...\r\n\t */\r\n\tdoMetaChanged: function(metaName){},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field value is changed.\r\n\t */\r\n\tdoValueChanged: function() {},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Refresh UI when field lookup value is changed.\r\n\t */\r\n\tdoLookupChanged: function() {},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetDatasetInParentElement: function () {\r\n\t\tvar el = this.el, pEl = null;\r\n\t\twhile (true) {\r\n\t\t\tpEl = jslet.ui.getParentElement(el, 1);\r\n\t\t\tif (!pEl) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (pEl.jslet) {\r\n\t\t\t\treturn pEl.jslet.dataset;\r\n\t\t\t}\r\n\t\t\tel = pEl;\r\n\t\t} //end while\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function ($super) {\r\n\t\tthis.removeAllChildControls();\r\n\t\tif (this._isDBControl && this._dataset) {\r\n\t\t\tthis._dataset.removeLinkedControl(this);\r\n\t\t}\r\n\t\tthis._dataset = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n * \r\n * Base data sensitive field control. It's the base class for all form controls.\r\n */\r\njslet.ui.DBFieldControl = jslet.Class.create(jslet.ui.DBControl, {\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_field: undefined,\r\n\t\r\n\t_valueIndex: undefined,\r\n\t\r\n\t_enableInvalidTip: true,\r\n\t\r\n\t_tableId: null,\r\n\t\r\n\t_tabIndex: null,\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Field name which to link to control.\r\n\t * \r\n\t * @param {String | undefined} fldName Field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tfield: function(fldName) {\r\n\t\tif(fldName === undefined) {\r\n\t\t\treturn this._field;\r\n\t\t}\r\n\t\t\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\tjslet.Checker.test('DBControl.field', fldName).isString().required();\r\n\t\tvar k = fldName.lastIndexOf('#');\r\n\t\tif(k > 0) {\r\n\t\t\tthis._fieldMeta = fldName.substring(k+1);\r\n\t\t\tfldName = fldName.substring(0, k);\r\n\t\t}\r\n\t\t\r\n\t\tthis._field = fldName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfieldMeta: function() {\r\n\t\treturn this._fieldMeta;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Field value index which to link to control. \r\n\t * \r\n\t * @param {Integer | undefined} valueIndex Field value index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalueIndex: function(valueIndex) {\r\n\t\tif(valueIndex === undefined) {\r\n\t\t\treturn this._valueIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBControl.valueIndex', valueIndex).isNumber();\r\n\t\t\r\n\t\tthis._valueIndex = parseInt(valueIndex);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Tab index of control. \r\n\t * \r\n\t * @param {Integer | undefined} tabIndex Tab index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\ttabIndex: function(tabIndex) {\r\n\t\tif(tabIndex === undefined) {\r\n\t\t\treturn this._tabIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBControl.tabIndex', tabIndex).isNumber();\r\n\t\tthis._tabIndex = tabIndex;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tif(this._isDBControl) {\r\n\t\t\tvar value = ctrlParams.valueIndex;\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tthis.valueIndex(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar tbIdx = ctrlParams.tabIndex;\r\n\t\tif(tbIdx !== undefined) {\r\n\t\t\tthis.tabIndex(tbIdx);\r\n\t\t}\r\n\t\t\r\n\t},\r\n \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcheckRequiredProperty: function($super) {\r\n\t\t$super();\r\n\t\tif(this._isDBControl) {\r\n\t\t\tjslet.Checker.test('DBControl.field', this._field).required();\r\n\t\t\tthis.existField(this._field);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tif(!metaName || metaName == 'tip') {\r\n\t\t\tvar fldObj = this._dataset.getField(this._field);\r\n\t\t\tif(!fldObj) {\r\n\t\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t\t}\r\n\t\t\tvar tip = fldObj.tip();\r\n\t\t\ttip = tip ? tip: '';\r\n\t\t\tthis.el.title = tip;\r\n\t\t}\r\n\t},\r\n\t\r\n\tsetTabIndex: function() {\r\n\t\tvar Z = this,\r\n\t\t\ttabIdx = Z._tabIndex;\r\n\t\tif(Z._isDBControl) {\r\n\t\t\tif(tabIdx !== 0 && !tabIdx) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tif(fldObj) {\r\n\t\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(tabIdx === 0 || tabIdx) {\r\n\t\t\tZ.el.tabIndex = tabIdx;\r\n\t\t}\r\n\t},\r\n\t\r\n\texistField: function(fldName) {\r\n\t\tvar fldObj = this._dataset.getField(fldName);\r\n\t\treturn fldObj ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * The table id when this control is embed into a DBTable control. This property is used internally, don't call it directly.\r\n\t */\r\n\ttableId: function(tableId) {\r\n\t\tif(tableId === undefined) {\r\n\t\t\treturn this._tableId;\r\n\t\t}\r\n\t\tthis._tableId = tableId;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field value.\r\n\t * \r\n\t * @return {Object} Field value.\r\n\t */\r\n\tgetValue: function() {\r\n\t\treturn this._dataset.getFieldValue(this._field, this._valueIndex); \r\n\t},\r\n\t\r\n\t/**\r\n\t * Get display text of field.\r\n\t * \r\n\t * @param {Boolean} isEditing True - get editing text, false - get display text.\r\n\t * \r\n\t * @return {String}\r\n\t */\r\n\tgetText: function(isEditing) {\r\n\t\treturn this._dataset.getFieldText(this._field, isEditing, this._valueIndex); \r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field error.\r\n\t * \r\n\t * @return {Object} Error Object, like {message: 'Not Exists!', inputText: 'Foo'}\r\n\t */\r\n\tgetFieldError: function() {\r\n\t\treturn this._dataset.getFieldError(this._field, this._valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Render invalid message and change the control to \"invalid\" style.\r\n\t * \r\n\t *  @param {String} errObj error object: {code: xxx, message}, if it's null, clear the 'invalid' style. \r\n\t */\r\n\trenderInvalid: function (errObj) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._field) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (errObj){\r\n\t\t\tjQuery(Z.el).parent().addClass('has-error');\r\n\t\t\tZ.el.title = errObj.message || '';\r\n\t\t} else {\r\n\t\t\tjQuery(Z.el).parent().removeClass('has-error');\r\n\t\t\tZ.el.title = '';\r\n\t\t}\r\n\t},\r\n \r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Identify this control can be focused or not.  \r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Focus to this control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tfocus: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.canFocus()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._isDBControl) {\r\n\t\t\tvar\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tflag = !fldObj || fldObj.disabled() || fldObj.readOnly() || !fldObj.visible();\r\n\t\t\tif(flag) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._tableId) {\r\n\t\t\t\tjslet('#' + Z._tableId).gotoField(Z._field);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.innerFocus();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar Z = this,\r\n\t\t\tel = Z.el;\r\n\t\tif (el.focus) {\r\n\t\t\ttry {\r\n\t\t\t\tel.focus();\r\n\t\t\t\tif(Z.selectText && Z.autoSelectAll && Z.autoSelectAll()) {\r\n\t\t\t\t\tZ.selectText();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} catch (e) {\r\n\t\t\t\t//Can\\'t focus on this control, maybe it\\'s disabled!\r\n\t\t\t\tconsole.warn(jsletlocale.Dataset.cannotFocusControl);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function ($super) {\r\n\t\t$super();\r\n\t\tthis._field = null;\r\n\t}\r\n\t\r\n});\r\n\r\n/*\r\n * Convert string parameters to object\r\n * \r\n * @param {String | Object} ctrlParams Control parameters.\r\n * @return {Object}\r\n */\r\njslet.ui._evalParams = function (ctrlParams) {\r\n\tjslet.Checker.test('evalParams#ctrlParams', ctrlParams).required();\r\n\tif (jslet.isString(ctrlParams)) {\r\n\t\tvar p = jQuery.trim(ctrlParams);\r\n\t\tif (!p.startsWith('{') && p.indexOf(':')>0) {\r\n\t\t\tp = '{' + p +'}';\r\n\t\t}\r\n\t\ttry {\r\n\t\t\t/* jshint ignore:start */\r\n\t\t\tctrlParams = new Function('return ' + unescape(p))();\r\n\t\t\t/* jshint ignore:end */\r\n\t\t\tif(ctrlParams['var']) {\r\n\t\t\t\tctrlParams = ctrlParams['var'];\r\n\t\t\t}\r\n\t\t\treturn ctrlParams;\r\n\t\t} catch (e) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.DBControl.invalidJsletProp, [ctrlParams]));\r\n\t\t}\r\n\t}\r\n\treturn ctrlParams;\r\n};\r\n\r\n/*\r\n * Hold all jslet control's configurations.\r\n */\r\njslet.ui.controls = {};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Register jslet control class. This method is used to create a new Jslet control. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.register('DBTable', jslet.ui.DBTable);\r\n * \r\n * @param {String} ctrlName Control name.\r\n * @param {jslet.ui.Control} ctrlType Control Class.\r\n */\r\njslet.ui.register = function (ctrlName, ctrlType) {\r\n\tjslet.Checker.test('jslet.ui.register#ctrlName', ctrlName).required().isString();\r\n\tjslet.Checker.test('jslet.ui.register#ctrlType', ctrlType).required();\r\n\tjslet.ui.controls[ctrlName.toLowerCase()] = ctrlType;\r\n};\r\n\r\n/**\r\n * Create jslet control according to control configuration, and add it to parent element. Example:\r\n * \r\n *     @example\r\n *     var pElement = document.getElementById('div1');\r\n *     jslet.ui.createControl({type:'DBTable', dataset: 'employee'}, pElement, 300, 500); \r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String | Object} jsletparam Jslet Parameter.\r\n * @param {HtmlElement} parent Parent html element which created control will be added to.\r\n * @param {Integer} width (Optional)Control width, unit: px.\r\n * @param {Integer} height (Optional)Control height, Unit: px. \r\n * @param {Boolean} hidden (Optional)Hide control or not.\r\n *  \r\n * @return {jslet.ui.Control}\r\n */\r\njslet.ui.createControl = function (jsletparam, parent, width, height, hidden) {\r\n\tjslet.Checker.test('jslet.ui.createControl#jsletparam', jsletparam).required();\r\n\tvar isAuto = false, \r\n\t\tpnode = parent,\r\n\t\tcontainer = document.createElement('div'),\r\n\t\tctrlParam = jslet.ui._evalParams(jsletparam),\r\n\t\tcontrolType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tcontrolType = jslet.ui.controls.DBTEXT;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls[controlType.toLowerCase()];\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\tcontainer.innerHTML = ctrlClass.htmlTemplate;\r\n\r\n\tvar el = container.firstChild;\r\n\tcontainer.removeChild(el);\r\n\tif(hidden) {\r\n\t\tel.style.display = 'none';\r\n\t}\t\r\n\tif (parent) {\r\n\t\tparent.appendChild(el);\r\n\t} else {\r\n\t\tdocument.body.appendChild(el);\r\n\t}\r\n\tif (width) {\r\n\t\tif (parseInt(width) == width)\r\n\t\t\twidth = width + 'px';\r\n\t\tel.style.width = width;\r\n\t}\r\n\tif (height) {\r\n\t\tif (parseInt(height) == height)\r\n\t\t\theight = height + 'px';\r\n\t\tel.style.height = height;\r\n\t}\r\n\r\n\treturn new ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Get jslet class with class name.\r\n * \r\n * @param {String} name Class name.\r\n * \r\n * @return {jslet.ui.Control}\r\n */\r\njslet.ui.getControlClass = function (name) {\r\n\tjslet.Checker.test('jslet.ui.getControlClass#name', name).required().isString();\r\n\treturn jslet.ui.controls[name.toLowerCase()];\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Bind jslet control to an existing html element. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.bindControl(tblDiv, {type:'DBTable', dataset: 'employee'}); \r\n * \r\n * @param {HtmlElement} el HTML element.\r\n * @param {String | Object} jsletParam Control parameters.\r\n */\r\njslet.ui.bindControl = function (el, jsletParam, isInstalling) {\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.bindControl#el', el).required().isHTMLElement();\r\n\t}\r\n\tif (!jsletParam)\r\n\t\tjsletParam = jQuery(el).attr('data-jslet');\r\n\tif(el.jslet) {\r\n\t\tconsole.warn('Control has installed! Don\\'t install it again!');\r\n\t\treturn null;\r\n\t}\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.bindControl#jsletParam', jsletParam).required();\r\n\t}\r\n\tvar ctrlParam = jslet.ui._evalParams(jsletParam);\r\n\tvar controlType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tel.jslet = ctrlParam;\r\n\t\treturn null;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls[controlType.toLowerCase()];\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\treturn new ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Unbind jslet control and clear jslet property. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.unbindControl(tblDiv); \r\n * \r\n * @param {HtmlElement} el HTML element.\r\n */\r\njslet.ui.unbindControl = function(el, isInstalling) {\r\n\tif(!isInstalling) {\r\n\t\tjslet.Checker.test('jslet.ui.unbindControl#el', el).required().isHTMLElement();\r\n\t}\r\n\tif (el.jslet && el.jslet.destroy) {\r\n\t\tel.jslet.destroy();\r\n\t}\r\n\tel.jslet = null;\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Re-bind jslet control. Example:\r\n * \r\n *     @example\r\n *     var tblDiv = document.getElementById('tblDiv');\r\n *     jslet.ui.rebindControl(tblDiv); \r\n * \r\n * @param {HtmlElement} el HTML element which binded a Jslet control.\r\n */\r\njslet.ui.rebindControl = function(el) {\r\n\tjslet.Checker.test('jslet.ui.rebindControl#el', el).required().isHTMLElement();\r\n\tjslet.ui.unbindControl(el);\r\n\tjslet.ui.bindControl(el);\r\n};\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Scan the specified HTML element children and bind jslet control to these HTML element with 'data-jslet' attribute. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.install(); //Install jslet on document.body\r\n *     \r\n *     var dialogDiv = document.getElementById('dlgId');\r\n *     jslet.ui.install(dialogDiv); //Install jslet on a dialog.\r\n * \r\n * @param {HtmlElement} pElement (Optional)Parent HTML element which need to be scan, if null, document.body is used.\r\n * @param {Function} onJsletReady (Optional)Call back function after jslet installed.\r\n */\r\njslet.ui.install = function (pElement, onJsletReady) {\r\n\tif(pElement && (onJsletReady === undefined)) {\r\n\t\t//Match case: jslet.ui.install(onJsletReady);\r\n\t\tif(jQuery.isFunction(pElement)) {\r\n\t\t\tonJsletReady = pElement;\r\n\t\t\tpElement = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(!pElement && jsletlocale.isRtl){\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tif(!jqBody.hasClass('jl-rtl')) {\r\n\t\t\tjqBody.addClass('jl-rtl');\r\n\t\t}\r\n\t}\r\n\tvar htmlTags;\r\n\tif (!pElement){\r\n\t\tpElement = document.body;\r\n\t} else {\r\n\t\tjslet.Checker.test('jslet.ui.install#pElement', pElement).isHTMLElement();\t\t\r\n\t}\r\n\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\r\n\tvar cnt = htmlTags.length, el, id, \r\n\t\texistIds = jslet.existIds;\r\n\tif(!existIds) {\r\n\t\texistIds = {};\r\n\t\tjslet.existIds = existIds;\r\n\t}\r\n\tfor (var i = 0; i < cnt; i++) {\r\n\t\tel = htmlTags[i];\r\n\t\tid = el.id;\r\n\t\tif(id) {\r\n\t\t\tif(existIds[id]) {\r\n\t\t\t\tconsole.warn(jslet.formatMessage(jsletlocale.Control.duplicatedId, [id]));\r\n\t\t\t} else {\r\n\t\t\t\texistIds[id] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.bindControl(el, undefined, true);\r\n\t}\r\n\tif(onJsletReady){\r\n\t\tonJsletReady();\r\n\t\t//jslet.ui.onReady();\r\n\t}\r\n\tif(jslet.global.afterInstall) {\r\n\t\tjslet.global.afterInstall(pElement);\r\n\t}\r\n};\r\n\r\n///**\r\n// * {Event} Fired after jslet has installed all controls.\r\n// * Pattern: function(){};\r\n// */\r\n//jslet.ui.onReady = null;\r\n\r\n/**\r\n * @member jslet.ui\r\n * \r\n * Scan the specified HTML element children and unbind jslet control to these HTML element with 'data-jslet' attribute.\r\n * \r\n * @param {HtmlElement} pElement (Optional)Parent HTML element which need to be scan, if null, document.body is used.\r\n */\r\njslet.ui.uninstall = function (pElement) {\r\n\tvar htmlTags;\r\n\tif (!pElement) {\r\n\t\thtmlTags = jQuery('*[data-jslet]');\r\n\t} else {\r\n\t\tjslet.Checker.test('jslet.ui.install#pElement', pElement).isHTMLElement();\t\t\r\n\t\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\t}\r\n\tvar el;\r\n\tfor(var i =0, cnt = htmlTags.length; i < cnt; i++){\r\n\t\tel = htmlTags[i];\r\n\t\tif (el.jslet && el.jslet.destroy) {\r\n\t\t\tel.jslet.destroy();\r\n\t\t}\r\n\t\tel.jslet = null;\r\n\t}\r\n\tif(jslet.ui.menuManager) {\r\n\t\tjQuery(document).off('mousedown', jslet.ui.menuManager.hideAll);\r\n\t}\r\n//\tjslet.ui.onReady = null;\r\n};\r\n\n/**\r\n * @private\r\n * @class\r\n * \r\n* Drag & Drop. A common framework to implement drag & drop. Example:\r\n* \r\n*     @example\r\n*     //Define a delegate class\r\n*     dndDelegate = {}\r\n*     dndDelegate._doDragStart = function(){}\r\n*     dndDelegate._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*     dndDelegate._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*     dndDelegate._doDragCancel = function () {}\r\n* \r\n*     //Initialize jslet.ui.DnD\r\n*     //var dnd = new jslet.ui.DnD();\r\n*     //Or use global jslet.ui.DnD instance to bind 'dndDelegate'\r\n*     jslet.ui.dnd.bindControl(dndDelegate);\r\n*\t\r\n*     //After end dragging, you need unbind it\r\n*     jslet.ui.dnd.unbindControl();\r\n* \r\n*/\r\njslet.ui.DnD = function () {\r\n\tvar oldX, oldY, x, y, deltaX, deltaY,\r\n\t\tdragDelta = 2, \r\n\t\tdragged = false, \r\n\t\tbindedControl, \r\n\t\tmouseDowned = true,\r\n\t\tself = this;\r\n\r\n\tthis._docMouseDown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tmouseDowned = true;\r\n\t\tdeltaX = 0;\r\n\t\tdeltaY = 0;\r\n\t\toldX = event.pageX;\r\n\t\toldY = event.pageY;\r\n\t\tdragged = false;\r\n\r\n\t\tif (bindedControl && bindedControl._doMouseDown) {\r\n\t\t\tbindedControl._doMouseDown(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseMove = function (event) {\r\n\t\tif (!mouseDowned) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tx = event.pageX;\r\n\t\ty = event.pageY;\r\n\t\tif (!dragged) {\r\n\t\t\tif (Math.abs(deltaX) > dragDelta || Math.abs(deltaY) > dragDelta) {\r\n\t\t\t\tdragged = true;\r\n\t\t\t\toldX = x;\r\n\t\t\t\toldY = y;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragStart) {\r\n\t\t\t\t\tbindedControl._doDragStart(oldX, oldY);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdeltaX = x - oldX;\r\n\t\tdeltaY = y - oldY;\r\n\t\tif (dragged) {\r\n\t\t\tif (bindedControl && bindedControl._doDragging) {\r\n\t\t\t\tbindedControl._doDragging(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseMove) {\r\n\t\t\t\tbindedControl._doMouseMove(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t\toldX = x;\r\n\t\t\toldY = y;\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseUp = function (event) {\r\n\t\tmouseDowned = false;\r\n\t\tif (dragged) {\r\n\t\t\tdragged = false;\r\n\t\t\tif (bindedControl && bindedControl._doDragEnd) {\r\n\t\t\t\tbindedControl._doDragEnd(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseUp) {\r\n\t\t\t\tbindedControl._doMouseUp(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t}\r\n\t\tself.unbindControl();\r\n\t};\r\n\r\n\tthis._docKeydown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tif (event.which == 27) {//Esc key\r\n\t\t\tif (dragged) {\r\n\t\t\t\tdragged = false;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragCancel) {\r\n\t\t\t\t\tbindedControl._doDragCancel();\r\n\t\t\t\t\tself.unbindControl();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docSelectStart = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tevent.preventDefault();\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\t/**\r\n\t * Bind control.\r\n\t * \r\n\t * @param {Object} ctrl The control need drag & drop, there are four method in it: <br />\r\n\t *  ctrl._doDragStart = function(){} <br />\r\n\t *  ctrl._doDragging = function(oldX, oldY, x, y, deltaX, deltaY){} <br />\r\n\t *  ctrl._doDragEnd = function(oldX, oldY, x, y, deltaX, deltaY){} <br />\r\n\t *  ctrl._doDragCancel = function(){} <br />\r\n\t *  ctrl_doDragStart = function{}\r\n\t */\r\n\tthis.bindControl = function (ctrl) {\r\n\t\tbindedControl = ctrl;\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.on('mousedown', this._docMouseDown);\r\n\t\tdoc.on('mouseup', this._docMouseUp);\r\n\t\tdoc.on('mousemove', this._docMouseMove);\r\n\t\tdoc.on('selectstart', this._docSelectStart);\r\n\t\tdoc.on('keydown', this._docKeydown);\r\n\t};\r\n\r\n\t/**\r\n\t * Unbind the current control\r\n\t */\r\n\tthis.unbindControl = function () {\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.off('mousedown', this._docMouseDown);\r\n\t\tdoc.off('mouseup', this._docMouseUp);\r\n\t\tdoc.off('mousemove', this._docMouseMove);\r\n\t\tdoc.off('selectstart', this._docSelectStart);\r\n\t\tdoc.off('keydown', this._docKeydown);\r\n\t\t\r\n\t\tbindedControl = null;\r\n\t};\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Global Drag & drop object.\r\n * \r\n * @member jslet.ui\r\n */\r\njslet.ui.dnd = new jslet.ui.DnD();\r\n\r\n\n/**\r\n * @class\r\n * \r\n * EditMask.\r\n * \r\n * Create edit mask class and attach to a HTML text element. Example:\r\n * \r\n *     @example\r\n *     var htmlText = jQuery('#textId')[0];\r\n *     var mask = new jslet.ui.EditMask();\r\n *     mask.attach(htmlText);\r\n *     mask.setMask('L00-000');\r\n * \r\n */\r\njslet.ui.EditMask = function () {\r\n\tthis._mask = null;\r\n\tthis._keepChar = true;\r\n\tthis._transform = null;\r\n\r\n\tthis._literalChars = null;\r\n\tthis._parsedMask = null;\r\n\tthis._format = null;\r\n\tthis._target = null;\r\n\tthis._buffer = null;\r\n};\r\n\r\njslet.ui.EditMask.prototype = {\r\n\tmaskChars: {\r\n\t\t'#': { regexpr: new RegExp('[0-9\\\\-]'), required: false }, \r\n\t\t'0': { regexpr: new RegExp('[0-9]'), required: true },\r\n\t\t'9': { regexpr: new RegExp('[0-9]'), required: false },\r\n\t\t'L': { regexpr: new RegExp('[A-Za-z]'), required: true },\r\n\t\t'l': { regexpr: new RegExp('[A-Za-z]'), required: false },\r\n\t\t'A': { regexpr: new RegExp('[0-9a-zA-Z]'), required: true },\r\n\t\t'a': { regexpr: new RegExp('[0-9a-zA-Z]'), required: false },\r\n\t\t'C': { regexpr: null, required: true },\r\n\t\t'c': { regexpr: null, required: false }\r\n\t},\r\n\t\r\n\ttransforms: ['upper','lower'],\r\n\r\n\t/**\r\n\t * Set edit mask. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var htmlText = jQuery('#textId')[0];\r\n\t *     var mask = new jslet.ui.EditMask();\r\n\t *     mask.attach(htmlText);\r\n\t *     mask.setMask('L00-000');\r\n\t * \r\n\t * @param {String} mask Mask string, rule: <br />\r\n\t *  '#': char set: 0-9 and -, not required. <br />\r\n\t *  '0': char set: 0-9, required. <br />\r\n\t *  '9': char set: 0-9, not required. <br />\r\n\t *  'L': char set: A-Z,a-z, required. <br />\r\n\t *  'l': char set: A-Z,a-z, not required. <br />\r\n\t *  'A': char set: 0-9,a-z,A-Z, required. <br />\r\n\t *  'a': char set: 0-9,a-z,A-Z, not required. <br />\r\n\t *  'C': char set: any char, required. <br />\r\n\t *  'c': char set: any char, not required.\r\n\t *\r\n\t * @param {Boolean} keepChar Keep the literal character or not.\r\n\t * @param {String} transform Transform character into UpperCase or LowerCase, optional value: 'upper', 'lower' or null.\r\n\t */\r\n\tsetMask: function(mask, keepChar, transform){\r\n\t\tmask = jQuery.trim(mask);\r\n\t\tjslet.Checker.test('EditMask#mask', mask).isString();\r\n\t\tthis._mask = mask;\r\n\t\tthis._keepChar = keepChar ? true: false;\r\n\t\t\r\n\t\tthis._transform = null;\r\n\t\tif(transform){\r\n\t\t\tvar checker = jslet.Checker.test('EditMask#transform', transform).isString();\r\n\t\t\ttransform = jQuery.trim(transform);\r\n\t\t\ttransform = transform.toLowerCase();\r\n\t\t\tchecker.inArray(this.transforms);\r\n\t\t\tthis._transform = transform;\r\n\t\t}\r\n\t\tthis._parseMask();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Attach edit mask to a HTML text element.\r\n\t * \r\n\t * @param {HtmlElement} target HTML text element.\r\n\t */\r\n\tattach: function (target) {\r\n\t\tjslet.Checker.test('EditMask.attach#target', target).required();\r\n\t\tvar Z = this, jqText = jQuery(target);\r\n\t\tZ._target = target;\r\n\t\tjqText.on('keypress.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar c = event.which;\r\n\t\t\tif (c === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeypress(c)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqText.on('keydown.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('blur.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doBur()) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.currentTarget.focus();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('cut.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tZ._doCut(event.originalEvent.clipboardData || window.clipboardData);\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqText.on('paste.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doPaste(event.originalEvent.clipboardData || window.clipboardData)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Detach edit mask from a HTML text element\r\n\t */\r\n\tdetach: function(){\r\n\t\tvar jqText = jQuery(this._target);\r\n\t\tjqText.off('keypress.editmask');\r\n\t\tjqText.off('keydown.editmask');\r\n\t\tjqText.off('blur.editmask');\r\n\t\tjqText.off('cut.editmask');\r\n\t\tjqText.off('paste.editmask');\r\n\t\tthis._target = null; \r\n\t},\r\n\t\r\n\t/**\r\n\t * Set value to text box.\r\n\t * \r\n\t * @param {String} value New value.\r\n\t */\r\n\tsetValue: function (value) {\r\n\t\tjslet.Checker.test('EditMask.setValue#value', value).isString();\r\n\t\tvalue = jQuery.trim(value);\r\n\t\tvalue = value ? value : '';\r\n\t\tif(!this._mask) {\r\n\t\t\tthis._target.value = value;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tZ._clearBuffer(0);\r\n\t\tvar prePos = 0, pos, preValuePos = 0, k, i, \r\n\t\t\tch, vch, valuePos = 0, fixedChar, \r\n\t\t\tmaskLen = Z._parsedMask.length;\r\n\t\twhile (true) {\r\n\t\t\tfixedChar = Z._getFixedCharAndPos(prePos);\r\n\t\t\tpos = fixedChar.pos;\r\n\t\t\tch = fixedChar.ch;\r\n\t\t\tif (pos < 0) {\r\n\t\t\t\tpos = prePos;\r\n\t\t\t}\r\n\t\t\tif (ch) {\r\n\t\t\t\tvaluePos = value.indexOf(ch, preValuePos);\r\n\t\t\t\tif (valuePos < 0) {\r\n\t\t\t\t\tvaluePos = value.length;\r\n\t\t\t\t}\r\n\t\t\t\tk = -1;\r\n\t\t\t\tfor (i = valuePos - 1; i >= preValuePos; i--) {\r\n\t\t\t\t\tvch = value.charAt(i);\r\n\t\t\t\t\tZ._buffer[k + pos] = vch;\r\n\t\t\t\t\tk--;\r\n\t\t\t\t}\r\n\t\t\t\tpreValuePos = valuePos + 1;\r\n\t\t\t} else {\r\n\t\t\t\tk = 0;\r\n\t\t\t\tvar c, cnt = Z._buffer.length;\r\n\t\t\t\tfor (i = prePos; i < cnt; i++) {\r\n\t\t\t\t\tc = value.charAt(preValuePos + k);\r\n\t\t\t\t\tif (!c) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._buffer[i] = c;\r\n\t\t\t\t\tk++;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tprePos = pos + 1;\r\n\t\t}\r\n\t\tZ._showValue();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get unmasked value.\r\n\t * \r\n\t * @return {String} Unmasked value.\r\n\t */\r\n\tgetValue: function(){\r\n\t\tvar value = this._target.value;\r\n\t\tif(this._keepChar) {\r\n\t\t\treturn value;\r\n\t\t} else {\r\n\t\t\tvar result = [], maskObj;\r\n\t\t\tfor(var i = 0, cnt = value.length; i< cnt; i++){\r\n\t\t\t\tmaskObj = this._parsedMask[i];\r\n\t\t\t\tif(maskObj.isMask) {\r\n\t\t\t\t\tresult.push(value.charAt(i));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the value is valid or not.\r\n\t * \r\n\t * @return {Boolean} True - the value is valid, false - otherwise.\r\n\t */\r\n\tvalidateValue: function(){\r\n\t\tvar Z = this, len = Z._parsedMask.length, cfg;\r\n\t\tfor(var i = 0; i< len; i++){\r\n\t\t\tcfg = Z._parsedMask[i];\r\n\t\t\tif(cfg.isMask && Z.maskChars[cfg.ch].required){\r\n\t\t\t\tif(Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_getFixedCharAndPos: function (begin) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._literalChars || Z._literalChars.length === 0) {\r\n\t\t\treturn { pos: 0, ch: null };\r\n\t\t}\r\n\t\tif (!begin) {\r\n\t\t\tbegin = 0;\r\n\t\t}\r\n\t\tvar ch, mask;\r\n\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tch = mask.ch;\r\n\t\t\tif (Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\t\treturn { ch: ch, pos: i };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { pos: -1, ch: null };\r\n\t},\r\n\r\n\t_parseMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._mask) {\r\n\t\t\tZ._parsedMask = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._parsedMask = [];\r\n\t\t\r\n\t\tZ._format = [];\r\n\t\tvar c, prevChar = null, isMask;\r\n\r\n\t\tfor (var i = 0, cnt = Z._mask.length; i < cnt; i++) {\r\n\t\t\tc = Z._mask.charAt(i);\r\n\t\t\tif (c == '\\\\') {\r\n\t\t\t\tprevChar = c;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tisMask = false;\r\n\t\t\tif (Z.maskChars[c] === undefined) {\r\n\t\t\t\tif (prevChar) {\r\n\t\t\t\t\tZ._parsedMask.push({ ch: prevChar, isMask: isMask });\r\n\t\t\t\t}\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t} else {\r\n\t\t\t\tisMask = prevChar ? false : true;\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t}\r\n\t\t\tif(Z._keepChar && !isMask){\r\n\t\t\t\tif(!Z._literalChars) {\r\n\t\t\t\t\tZ._literalChars = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar notFound = true;\r\n\t\t\t\tfor(var k = 0, iteralCnt = Z._literalChars.length; k < iteralCnt; k++){\r\n\t\t\t\t\tif(Z._literalChars[k] == c){\r\n\t\t\t\t\t\tnotFound = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(notFound) {\r\n\t\t\t\t\tZ._literalChars.push(c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevChar = null;\r\n\t\t\tZ._format.push(isMask ? '_' : c);\r\n\t\t} //end for\r\n\r\n\t\tZ._buffer = Z._format.slice(0);\r\n\t\tif(Z._target) {\r\n\t\t\tZ._target.value = Z._format.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_validateChar: function (maskChar, inputChar) {\r\n\t\tvar maskCfg = this.maskChars[maskChar];\r\n\t\tvar regExpr = maskCfg.regexpr;\r\n\t\tif (regExpr) {\r\n\t\t\treturn regExpr.test(inputChar);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t_getValidPos: function (pos, toLeft) {\r\n\t\tvar Z = this, \r\n\t\t\tcnt = Z._parsedMask.length, i;\r\n\t\tif (pos >= cnt) {\r\n\t\t\treturn cnt - 1;\r\n\t\t}\r\n\t\tif (!toLeft) {\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\t_clearBuffer: function (begin, end) {\r\n\t\tif(!this._buffer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!end) {\r\n\t\t\tend = this._buffer.length - 1;\r\n\t\t}\r\n\t\tfor (var i = begin; i <= end; i++) {\r\n\t\t\tthis._buffer[i] = this._format[i];\r\n\t\t}\r\n\t},\r\n\r\n\t_packEmpty: function (begin, end) {\r\n\t\tvar c, k = 0, Z = this, i;\r\n\t\tfor (i = begin; i >= 0; i--) {\r\n\t\t\tc = Z._format[i];\r\n\t\t\tif (Z._literalChars && Z._literalChars.indexOf(c) >= 0) {\r\n\t\t\t\tk = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbegin = k;\r\n\t\tvar str = [];\r\n\t\tfor (i = begin; i < end; i++) {\r\n\t\t\tc = Z._buffer[i];\r\n\t\t\tif (c != Z._format[i]) {\r\n\t\t\t\tstr.push(c);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar len = str.length - 1;\r\n\r\n\t\tfor (i = end - 1; i >= begin; i--) {\r\n\t\t\tif (len >= 0) {\r\n\t\t\t\tZ._buffer[i] = str[len];\r\n\t\t\t\tlen--;\r\n\t\t\t} else {\r\n\t\t\t\tZ._buffer[i] = Z._format[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_updateBuffer: function (pos, ch) {\r\n\t\tvar begin = pos.begin, end = pos.end, Z = this;\r\n\r\n\t\tbegin = Z._getValidPos(begin);\r\n\t\tif (begin < 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tZ._clearBuffer(begin + 1, end);\r\n\t\tif (Z._literalChars && Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].ch == ch) {\r\n\t\t\t\t\tZ._packEmpty(begin, i);\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar maskObj = Z._parsedMask[begin];\r\n\t\t\tif (Z._validateChar(maskObj.ch, ch)) {\r\n\t\t\t\tZ._buffer[begin] = ch;\r\n\t\t\t\treturn begin;\r\n\t\t\t} else\t{\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_moveCursor: function (begin, toLeft) {\r\n\t\tbegin = this._getValidPos(begin, toLeft);\r\n\t\tif (begin >= 0) {\r\n\t\t\tjslet.ui.TextUtil.setCursorPos(this._target, begin);\r\n\t\t}\r\n\t},\r\n\r\n\t_showValue: function () {\r\n\t\tthis._target.value = this._buffer.join('');\r\n\t},\r\n\r\n\t_doKeypress: function (chCode) {\r\n\t\tif (chCode == 13) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar ch = String.fromCharCode(chCode), Z = this;\r\n\t\tif (Z._transform == 'upper') {\r\n\t\t\tch = ch.toUpperCase();\r\n\t\t} else {\r\n\t\t\tif (Z._transform == 'lower') {\r\n\t\t\t\tch = ch.toLowerCase();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pos = jslet.ui.TextUtil.getCursorPos(Z._target);\r\n\t\tvar begin = Z._updateBuffer(pos, ch);\r\n\t\tZ._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tZ._moveCursor(begin + 1);\r\n\t\t} else {\r\n\t\t\tZ._moveCursor(pos.begin);\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doKeydown: function (chCode) {\r\n\t\tvar Z = this,\r\n\t\t\tpos = jslet.ui.TextUtil.getCursorPos(Z._target),\r\n\t\t\tbegin = pos.begin,\r\n\t\t\tend = pos.end;\r\n\r\n\t\tif (chCode == 229) {//IME showing\r\n\t\t\tvar flag = (Z._parsedMask.legnth > begin);\r\n\t\t\tif (flag) {\r\n\t\t\t\tvar msk = Z._parsedMask[begin];\r\n\t\t\t\tflag = msk.isMask;\r\n\t\t\t\tif (flag) {\r\n\t\t\t\t\tvar c = msk.ch;\r\n\t\t\t\t\tflag = (c == 'c' || c == 'C');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!flag) {\r\n\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\tZ._showValue();\r\n\t\t\t\t\tZ._moveCursor(begin);\r\n\t\t\t\t}, 50);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (chCode == 13) //enter\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (chCode == 8) //backspace\r\n\t\t{\r\n\t\t\tif (begin == end) {\r\n\t\t\t\tbegin = Z._getValidPos(--begin, true);\r\n\t\t\t\tend = begin;\r\n\t\t\t}\r\n\t\t\tZ._clearBuffer(begin, end);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin, true);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 27) // Allow to send 'ESC' command\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 39) // Move Left\r\n\t\t{\r\n\t\t}\r\n\r\n\t\tif (chCode == 46) // delete the selected text\r\n\t\t{\r\n\t\t\tZ._clearBuffer(begin, end - 1);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doBur: function () {\r\n\t\tvar mask, c, Z = this;\r\n\t\tfor (var i = 0, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (!mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tc = mask.ch;\r\n\t\t\tif (Z.maskChars[c].required) {\r\n\t\t\t\tif (Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\t//jslet.ui.TextUtil.setCursorPos(Z._target, i);\r\n\t\t\t\t\t//return false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doCut: function (clipboardData) {\r\n\t\tvar Z = this,\r\n\t\t\tdata = jslet.ui.TextUtil.getSelectedText(Z._target),\r\n\t\t\trange = jslet.ui.TextUtil.getCursorPos(Z._target),\r\n\t\t\tbegin = range.begin;\r\n\t\tZ._clearBuffer(begin, range.end - 1);\r\n\t\tZ._showValue();\r\n\t\tZ._moveCursor(begin, true);\r\n\t\tclipboardData.setData('Text', data);\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doPaste: function (clipboardData) {\r\n\t\tvar pasteValue = clipboardData.getData('Text');\r\n\t\tif (!pasteValue) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar pos = jslet.ui.TextUtil.getCursorPos(this._target), begin = 0, ch;\r\n\t\tpos.end = pos.begin;\r\n\t\tfor (var i = 0; i < pasteValue.length; i++) {\r\n\t\t\tch = pasteValue.charAt(i);\r\n\t\t\tbegin = this._updateBuffer(pos, ch);\r\n\t\t\tpos.begin = i;\r\n\t\t\tpos.end = pos.begin;\r\n\t\t}\r\n\t\tthis._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tthis._moveCursor(begin + 1);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n/**\r\n * @class\r\n * @static\r\n * \r\n * Util of \"Text\" control.\r\n */\r\njslet.ui.TextUtil = {\r\n\t/**\r\n\t * Select text from an Input(Text) element.\r\n\t * \r\n\t * @param {HtmlElement} txtEl The HTML text element .  \r\n\t * @param {Integer} start Start position.\r\n\t * @param {Integer} end End position.\r\n\t */\r\n\tselectText: function(txtEl, start, end){\r\n\t\tvar v = txtEl.value;\r\n\t\tif (v.length > 0) {\r\n\t\t\tstart = start === undefined ? 0 : start;\r\n\t\t\tend = end === undefined ? v.length : end;\r\n \r\n\t\t\tif (txtEl.setSelectionRange) {\r\n\t\t\t\ttxtEl.setSelectionRange(start, end);\r\n\t\t\t} else if (txtEl.createTextRange) {\r\n\t\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\t\trange.moveStart('character', start);\r\n\t\t\t\trange.moveEnd('character', end - v.length);\r\n\t\t\t\trange.select();\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get selected text.\r\n\t * \r\n\t * @param {HtmlElement} textEl HTML Text Element.\r\n\t * \r\n\t * @return {String}  \r\n\t */\r\n\tgetSelectedText: function (txtEl) {\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tvar begin = txtEl.selectionStart;\r\n\t\t\tvar end = txtEl.selectionEnd;\r\n\t\t\treturn txtEl.value.substring(begin, end);\r\n\t\t}\r\n\t\tif (document.selection && document.selection.createRange) {\r\n\t\t\treturn document.selection.createRange().text;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get cursor postion of a HTML text element.\r\n\t * \r\n\t * @param {HtmlElement} txtEl HTML Text Element.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tgetCursorPos: function(txtEl){\r\n\t\tvar result = { begin: 0, end: 0 };\r\n\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tresult.begin = txtEl.selectionStart;\r\n\t\t\tresult.end = txtEl.selectionEnd;\r\n\t\t}\r\n\t\telse if (document.selection && document.selection.createRange) {\r\n\t\t\tvar range = document.selection.createRange();\r\n\t\t\tresult.begin = 0 - range.duplicate().moveStart('character', -100000);\r\n\t\t\tresult.end = result.begin + range.text.length;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set cursor postion of html text element\r\n\t * \r\n\t * @param {HtmlElement} txtEl Html Text Element\r\n\t * @param {Integer} pos Cusor position\r\n\t */\r\n\tsetCursorPos: function(txtEl, pos){\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\ttxtEl.focus();\r\n\t\t\ttxtEl.setSelectionRange(pos, pos);\r\n\t\t}\r\n\t\telse if (txtEl.createTextRange) {\r\n\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\trange.collapse(true);\r\n\t\t\trange.moveEnd('character', pos);\r\n\t\t\trange.moveStart('character', pos);\r\n\t\t\trange.select();\r\n\t\t}\t\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * Control focus manager.\r\n */\r\njslet.ui.FocusManager = function() {\r\n\tthis._onChangingFocus = null;\r\n\tthis._focusKeyCode = null;\r\n\tthis._containerIds = null;\r\n\tthis._activeDataset = null;\r\n\tthis._activeField = null;\r\n\tthis._activeValueIndex = null;\r\n\t\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.FocusManager.prototype = {\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get onChangingFocus event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var doChangingFocus = function (element, reserve, datasetObj, fieldName, focusingFieldList, valueIndex) {\r\n\t * \t     console.log('Changing focus');\r\n\t *     };\r\n\t *     jslet.ui.globalFocusManager.onChangingFocus(doChangingFocus);\r\n\t * \r\n\t * @param {Function | undefined} onChangingFocus Focus changing event handler.\r\n\t * \r\n\t * @param {HtmlElement} element Focusing HTML element;\r\n\t * @param {Boolean} reserve If it's focusing prior element, reserve is true, otherwise false;\r\n\t * @param {jslet.data.Dataset} datasetObj Current dataset object. If the UI control is not jslet UI control, it's null;\r\n\t * @param {String} fieldName Current field name. If the UI control is not jslet UI field control, it's null;\r\n\t * @param {String[]} focusingFieldList Focusing field name list. You can use 'focusingFieldList' and 'fieldName' to check the position of field name.  \r\n\t * @param {Integer} valueIndex Identify the value index of BETWEEN-style or MULTIPLE-style field.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonChangingFocus: function(onChangingFocus) {\r\n\t\tif(onChangingFocus === undefined) {\r\n\t\t\treturn this._onChangingFocus;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.onChangingFocus', onChangingFocus).isFunction();\r\n\t\tthis._onChangingFocus = onChangingFocus;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get 'focusKeyCode'\r\n\t * \r\n\t * @param {Integer | undefined} focusKeyCode Key code for changing focus, default is 9 ('Tab' key).\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfocusKeyCode: function(focusKeyCode) {\r\n\t\tif(focusKeyCode === undefined) {\r\n\t\t\treturn this._focusKeyCode;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.focusKeyCode', focusKeyCode).isNumber();\r\n\t\tthis._focusKeyCode = focusKeyCode;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveDataset: function(dsName) {\r\n\t\tif(dsName === undefined) {\r\n\t\t\treturn this._activeDataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeDataset', dsName).isString();\r\n\t\tthis._activeDataset = dsName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveField: function(fldName) {\r\n\t\tif(fldName === undefined) {\r\n\t\t\treturn this._activeField;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeField', fldName).isString();\r\n\t\tthis._activeField = fldName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tactiveValueIndex: function(valueIndex) {\r\n\t\tif(valueIndex === undefined) {\r\n\t\t\treturn this._activeValueIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.activeValueIndex', valueIndex).isNumber();\r\n\t\tthis._activeValueIndex = valueIndex;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tpushContainer: function(containerId) {\r\n\t\tjslet.Checker.test('FocusManager.pushContainer#containerId', containerId).required().isString();\r\n\t\tif(this._containerIds === null) {\r\n\t\t\tthis._containerIds = [];\r\n\t\t}\r\n\t\tthis._containerIds.push(containerId);\r\n\t},\r\n\t\r\n\tpopContainer: function(containerId) {\r\n\t\tjslet.Checker.test('FocusManager.pushContainer#containerId', containerId).required().isString();\r\n\t\tif(this._containerIds[this._containerIds.length - 1] == containerId) {\r\n\t\t\tthis._containerIds.pop();\r\n\t\t}\r\n\t},\r\n\t\r\n\ttabPrev: function() {\r\n\t\tjQuery.tabPrev(this._getContainer(), true, jQuery.proxy(this._doChangingFocus, this));\r\n\t},\r\n\t\r\n\ttabNext: function() {\r\n\t\tjQuery.tabNext(this._getContainer(), true, jQuery.proxy(this._doChangingFocus, this));\r\n\t},\r\n\t\r\n\t_getContainer: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqContainer;\r\n\t\tif(Z._containerIds && Z._containerIds.length > 0) {\r\n\t\t\tvar containerId = Z._containerIds[Z._containerIds.length - 1];\r\n\t\t\tjqContainer = jQuery('#' + containerId);\r\n\t\t\tif(jqContainer.length === 0) {\r\n\t\t\t\tthrow new Error('Not found container: ' + containerId);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tjqContainer = jQuery(document);\r\n\t\t}\r\n\t\treturn jqContainer;\r\n\t},\r\n\t\r\n\t_doChangingFocus: function(ele, reverse) {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = jslet.data.getDataset(Z._activeDataset),\r\n\t\t\tfocusedFlds = dsObj && dsObj.mergedFocusedFields();\r\n\t\tif(Z._onChangingFocus) {\r\n\t\t\tvar cancelFocus = Z._onChangingFocus(ele, reverse, dsObj, Z._activeField, focusedFlds, Z._activeValueIndex);\r\n\t\t\tif(!cancelFocus) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z._activeDataset && !Z._activeField) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(!dsObj || !dsObj.focusedFields()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar idx = focusedFlds.indexOf(Z._activeField);\r\n\t\tif(idx < 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar masterFldName;\r\n\t\tif(!reverse) {\r\n\t\t\tif(idx === focusedFlds.length - 1) {\r\n\t\t\t\tmasterFldName = dsObj.masterField();\r\n\t\t\t\tif(masterFldName) {\r\n\t\t\t\t\tZ._activeDataset = dsObj.masterDataset();\r\n\t\t\t\t\tZ._activeField = masterFldName;\r\n\t\t\t\t\treturn Z._doChangingFocus(ele, reverse);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.focusEditControl(focusedFlds[idx + 1]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(idx === 0) {\r\n\t\t\t\tmasterFldName = dsObj.masterField();\r\n\t\t\t\tif(masterFldName) {\r\n\t\t\t\t\tZ._activeDataset = dsObj.masterDataset();\r\n\t\t\t\t\tZ._activeField = masterFldName;\r\n\t\t\t\t\treturn Z._doChangingFocus(ele, reverse);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.focusEditControl(focusedFlds[idx - 1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tfunction isTabableElement(ele) {\r\n\t\t\tvar tagName = ele.tagName;\r\n\t\t\tif(tagName == 'TEXTAREA' || tagName == 'A' || tagName == 'BUTTON') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(tagName == 'INPUT') {\r\n\t\t\t\tvar typeAttr = ele.type;\r\n\t\t\t\tif(typeAttr == 'button' || typeAttr == 'image' || typeAttr == 'reset' || typeAttr == 'submit' || typeAttr == 'url' || typeAttr == 'file') {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction handleHostKeyDown(event) {\r\n\t\t\tvar focusKeyCode = Z._focusKeyCode || jslet.global.defaultFocusKeyCode || 9;\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === focusKeyCode || keyCode === 9) {\r\n\t\t\t\tif(keyCode !== 9 && !isTabableElement(event.target)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(event.shiftKey){\r\n\t\t\t\t\tZ.tabPrev();\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tZ.tabNext();\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjQuery(document).keydown(handleHostKeyDown);\r\n\t}\r\n};\r\n\r\n/**\r\n * Global focus manager.\r\n * \r\n * @member jslet.ui\r\n * @type {jslet.ui.FocusManager}\r\n */\r\njslet.ui.globalFocusManager = new jslet.ui.FocusManager();\r\n\r\n/*!\r\n * jQuery.tabbable 1.0 - Simple utility for selecting the next / previous ':tabbable' element.\r\n * https://github.com/marklagendijk/jQuery.tabbable\r\n *\r\n * Includes ':tabbable' and ':focusable' selectors from jQuery UI Core\r\n *\r\n * Copyright 2013, Mark Lagendijk\r\n * Released under the MIT license\r\n *\r\n */\r\n\r\n(function($){\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the next :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusNext = function(container, isLoop, onChangingFocus){\r\n\t\tselectNextTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the previous :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the next :tabable element.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabNext = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectNextTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusses the previous :tabbable element\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\tfunction selectNextTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar nextIndex = 0;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex + 1 < selectables.length){\r\n\t\t\t\tnextIndex = currentIndex + 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tnextIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, false);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(nextIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectPrevTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar prevIndex = selectables.length - 1;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex > 0){\r\n\t\t\t\tprevIndex = currentIndex - 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tprevIndex = selectables.length - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, true);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(prevIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sortByTabIndex(items) {\r\n\t\tif(!items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar item, item1, k;\r\n\t\tfor(var i = 1, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tk = 0;\r\n\t\t\tfor(var j = i - 1; j >= 0; j--) {\r\n\t\t\t\titem1 = items[j];\r\n\t\t\t\tif(item1.tabIndex <= item.tabIndex) {\r\n\t\t\t\t\tk = j + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t\tif(i !== k) {\r\n\t\t\t\titems.splice(i, 1);\r\n\t\t\t\titems.splice(k, 0, item);\r\n\t\t\t}\r\n\t\t} //end for i\r\n\t}\r\n\t\r\n\t/*\r\n\t * :focusable and :tabbable, both taken from jQuery UI Core\r\n\t */\r\n\t$.extend($.expr[ ':' ], {\r\n\t\tdata: $.expr.createPseudo ?\r\n\t\t\t$.expr.createPseudo(function(dataName){\r\n\t\t\t\treturn function(elem){\r\n\t\t\t\t\treturn !!$.data(elem, dataName);\r\n\t\t\t\t};\r\n\t\t\t}) :\r\n\t\t\t// support: jQuery <1.8\r\n\t\t\tfunction(elem, i, match){\r\n\t\t\t\treturn !!$.data(elem, match[ 3 ]);\r\n\t\t\t},\r\n\r\n\t\tfocusable: function(element){\r\n\t\t\treturn focusable(element, !isNaN($.attr(element, 'tabindex')));\r\n\t\t},\r\n\r\n\t\ttabbable: function(element){\r\n\t\t\tvar tabIndex = $.attr(element, 'tabindex'),\r\n\t\t\t\tisTabIndexNaN = isNaN(tabIndex);\r\n\t\t\treturn ( isTabIndexNaN || tabIndex >= 0 ) && focusable(element, !isTabIndexNaN);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * @private\r\n\t * \r\n\t * Focusable function, taken from jQuery UI Core\r\n\t * @param element\r\n\t * @returns {*}\r\n\t */\r\n\tfunction focusable(element){\r\n\t\tvar map, mapName, img,\r\n\t\t\tnodeName = element.nodeName.toLowerCase(),\r\n\t\t\tisTabIndexNotNaN = !isNaN($.attr(element, 'tabindex'));\r\n\t\tif('area' === nodeName){\r\n\t\t\tmap = element.parentNode;\r\n\t\t\tmapName = map.name;\r\n\t\t\tif(!element.href || !mapName || map.nodeName.toLowerCase() !== 'map'){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\timg = $('img[usemap=#' + mapName + ']')[0];\r\n\t\t\treturn !!img && visible(img);\r\n\t\t}\r\n\t\treturn ( /input|select|textarea/.test(nodeName) ?\r\n\t\t\t!element.disabled :\r\n\t\t\t'a' === nodeName ?\r\n\t\t\t\telement.href || isTabIndexNotNaN :\r\n\t\t\t\tisTabIndexNotNaN) &&\r\n\t\t\t// the element and all of its ancestors must be visible\r\n\t\t\tvisible(element);\r\n\r\n\t\tfunction visible(element){\r\n\t\t\treturn $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function(){\r\n\t\t\t\treturn $.css(this, 'visibility') === 'hidden';\r\n\t\t\t}).length;\r\n\t\t}\r\n\t}\r\n})(jQuery);\r\n\n/**\r\n* @class\r\n* Message bus. Example:\r\n* \r\n*     @example\r\n*     var myCtrlObj = {onReceiveMessage: function(messageName, messageBody){alert(messageBody.x);}};\r\n*     \r\n*     jslet.messageBus.subcribe('MyMessage', myCtrlObj); //Subcribe a message from MessageBus\r\n*     \r\n*     jslet.messageBus.unsubcribe('MyMessage', myCtrlObj); //Unsubcribe a message from MessageBus\r\n*     \r\n*     jslet.messageBus.sendMessage('MyMessage', {x: 10, y:10}); //Send a mesasge to MessageBus\r\n* \r\n*/\r\njslet.MessageBus = function () {\r\n\tvar _messages = {};\r\n\t//SizeChanged is predefined message\r\n\t_messages[jslet.MessageBus.SIZECHANGED] = [];\r\n\t\r\n\tvar _timeoutHandlers = [];\r\n\t/**\r\n\t * Send a message.\r\n\t * \r\n\t * @param {String} messageName Message name.\r\n\t * @param {Object} mesageBody Message body.\r\n\t */\r\n\tthis.sendMessage = function (messageName, messageBody, sender) {\r\n\t\tif(!_messages[messageName]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar handler = _timeoutHandlers[messageName];\r\n\t\t\r\n\t\tif (handler){\r\n\t\t\twindow.clearTimeout(handler);\r\n\t\t}\r\n\t\thandler = setTimeout(function(){\r\n\t\t\t_timeoutHandlers[messageName] = null;\r\n\t\t\tvar ctrls = _messages[messageName], ctrl;\r\n\t\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\t\tctrl = ctrls[i];\r\n\t\t\t\tif (ctrl && ctrl.onReceiveMessage){\r\n\t\t\t\t\tctrl.onReceiveMessage(messageName, messageBody);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 30);\r\n\t\t_timeoutHandlers[messageName] = handler;\r\n\t};\r\n\r\n\t/**\r\n\t* Subscribe a message.\r\n\t* \r\n\t* @param {String} messageName message name.\r\n\t* @param {Object} ctrlObj control object which need subscribe a message.<br /> \r\n\t*   there must be a function: onReceiveMessage in ctrlObj.<br />\r\n\t*\tonReceiveMessage: function(messageName, messageBody){}<br />\r\n\t*   //messageName: String, message name;<br />\r\n\t*   //messageBody: Object, message body;<br />\r\n\t*/\r\n\tthis.subscribe = function(messageName, ctrlObj){\r\n\t\tif (!messageName || !ctrlObj) {\r\n\t\t\tthrow new Error(\"MessageName and ctrlObj required!\");\r\n\t\t}\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls){\r\n\t\t\tctrls = [];\r\n\t\t\t_messages[messageName] = ctrls;\r\n\t\t}\r\n\t\tctrls.push(ctrlObj);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Subscribe a message.\r\n\t * \r\n\t * @param {String} messageName message name.\r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(messageName, ctrlObj){\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar k = ctrls.indexOf(ctrlObj);\r\n\t\tif (k >= 0) {\r\n\t\t\tctrls.splice(k,1);\r\n\t\t}\r\n\t};\r\n};\r\n\r\njslet.MessageBus.SIZECHANGED = \"SIZECHANGED\";\r\n\r\njslet.messageBus = new jslet.MessageBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.messageBus.sendMessage(jslet.MessageBus.SIZECHANGED, null, window);\r\n});\r\n\n/**\r\n * @class\r\n * \r\n * Resize event bus, manage all resize event. Example:\r\n * \r\n *     @example\r\n *     var myCtrlObj = {\r\n *       checkSizeChanged: function(){}\r\n *     }\r\n *\r\n *     //Subcribe a message from MessageBus\r\n *     jslet.resizeEventBus.subcribe(myCtrlObj);\r\n *\r\n *     //Unsubcribe a message from MessageBus\r\n *     jslet.resizeEventBus.unsubcribe(myCtrlObj);\r\n * \r\n *     //Send a mesasge to MessageBus\r\n *     jslet.resizeEventBus.sendMessage('MyMessage', {x: 10, y:10});\r\n * \r\n */\r\njslet.ui.ResizeEventBus = function () {\r\n\t\r\n\tvar handler = null;\r\n\t\r\n\tfunction getResizableChild(sender, childElements) {\r\n\t\tif(!sender) {\r\n\t\t\tsender = document.body;\r\n\t\t}\r\n\t\tvar children = sender.children;\r\n\t\tif(!children) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar child;\r\n\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\tchild = children[i];\r\n\t\t\tif(child.getAttribute(jslet.ui.ResizeEventBus.RESIZABLE)) {\r\n\t\t\t\tchildElements.push(child);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(child.children) {\r\n\t\t\t\tgetResizableChild(child, childElements);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fire a \"resize\" message.\r\n\t * \r\n\t * @param {HtmlElement} sender Sender which sends the \"resize\" event.\r\n\t */\r\n\tthis.resize = function (sender) {\r\n\t\tvar ctrls = [];\r\n\t\tgetResizableChild(sender, ctrls);\r\n\t\tvar ctrl, jsletCtrl;\r\n\t\tif(jslet.ui._activePopup) {\r\n\t\t\tjslet.ui._activePopup.hide();\r\n\t\t}\r\n\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\tctrl = ctrls[i];\r\n\t\t\tif (ctrl){\r\n\t\t\t\tjsletCtrl = ctrl.jslet;\r\n\t\t\t\tif (jsletCtrl && jsletCtrl.checkSizeChanged){\r\n\t\t\t\t\tjsletCtrl.checkSizeChanged();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._bodyResize = jslet.debounce(this.resize, 100);\r\n\t\r\n\t/**\r\n\t * Subscribe a control to response a resize event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var uiCtrl = {\r\n\t *       checkSizeChanged: function() {}\r\n\t *     };\r\n\t * \r\n\t *     jslet.ui.resizeEventBus.subscribe(uiCtrl);\r\n\t * \r\n\t * @param {Object} ctrlObj Control object which need subscribe a message, there must be a function: checkSizeChanged in ctrlObj.\r\n\t */\r\n\tthis.subscribe = function(ctrlObj) {\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tif(!ctrlObj.checkSizeChanged || !jQuery.isFunction(ctrlObj.checkSizeChanged)) {\r\n\t\t\tthrow new Error('subscribe#ctrlObj must have a method named: \"checkSizeChanged\"!');\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).attr(jslet.ui.ResizeEventBus.RESIZABLE, true);\r\n\t\tvar p = ctrlObj.el.parentNode;\r\n\t\twhile(p) {\r\n\t\t\tif(jQuery(p).attr(jslet.ui.ResizeEventBus.RESIZABLE)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tp = p.parentNode;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * Unsubscribe a control to response a resize event.\r\n\t * \r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(ctrlObj){\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).removeAttr(jslet.ui.ResizeEventBus.RESIZABLE);\r\n\t};\r\n\t\r\n};\r\n\r\njslet.ui.ResizeEventBus.RESIZABLE = \"data-jslet-resizable\";\r\n\r\n/**\r\n * Global resize event bus object.\r\n * \r\n * @member jslet.ui\r\n * @type {jslet.ui.ResizeEventBus}\r\n */\r\njslet.ui.resizeEventBus = new jslet.ui.ResizeEventBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.ui.resizeEventBus._bodyResize();\r\n});\r\n\njslet.ui.htmlclass = {};\r\njslet.ui.GlobalZIndex = 100;\r\n\r\n/**\r\n * @enum\r\n * \r\n * Key code.\r\n */\r\njslet.ui.KeyCode = {\r\n\tBACKSPACE: 8, \r\n\tTAB: 9,\r\n\tENTER: 13,\r\n\tSHIFT: 16,\r\n\tCONTROL: 17,\r\n\tALT: 18,\r\n\r\n\tCAPSLOCK: 20,\r\n\tESCAPE: 27,\r\n\tSPACE: 32,\r\n\tPAGEUP: 33,\r\n\tPAGEDOWN: 34,\r\n\tEND: 35,\r\n\tHOME: 36,\r\n\tLEFT: 37,\r\n\tUP: 38,\r\n\tRIGHT: 39,\r\n\tDOWN: 40,\r\n\t\r\n\tINSERT: 45,\r\n\tDELETE: 46,\r\n\r\n\tF1: 112,\r\n\tF2: 113,\r\n\tF3: 114,\r\n\tF4: 115,\r\n\tF5: 116,\r\n\tF6: 117,\r\n\tF7: 118,\r\n\tF8: 119,\r\n\tF9: 120,\r\n\tF10: 121,\r\n\tF11: 122,\r\n\tF12: 123,\r\n\r\n\tIME: 229\r\n};\r\n\r\nfor(var i = 65; i < 90; i++) {\r\n\tjslet.ui.KeyCode[String.fromCharCode(i)] = i;\r\n}\r\n\r\n/**\r\n * @method\r\n * @member jslet.ui\r\n * \r\n * Get the specified level parent element. Example:\r\n * \r\n *     @example\r\n *     //html snippet is: body -> div1 -> div2 ->table\r\n *     jslet.ui.getParentElement(div2); // return div1\r\n *     jslet.ui.getParentElement(div2, 2); //return body \r\n * \r\n * @param {HtmlElement} htmlElement HTML element.\r\n * @param {Integer} level level\r\n * \r\n * @return {HtmlElement} Parent element, if not found, return null.\r\n */\r\njslet.ui.getParentElement = function (htmlElement, level) {\r\n\tif (!level) {\r\n\t\tlevel = 1;\r\n\t}\r\n\tvar flag = htmlElement.parentElement ? true : false,\r\n\tresult = htmlElement;\r\n\tfor (var i = 0; i < level; i++) {\r\n\t\tif (flag) {\r\n\t\t\tresult = result.parentElement;\r\n\t\t} else {\r\n\t\t\tresult = result.parentNode;\r\n\t\t}\r\n\t\tif (!result) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Find first parent with specified condition. Example:\r\n * \r\n *      @example\r\n *      //Html snippet: body ->div1 ->div2 -> div3\r\n *\t   var odiv = jslet.ui.findFirstParent(\r\n *\t\t  odiv3, \r\n *\t\t  function (node) {return node.class == 'head';},\r\n *\t\t  function (node) {return node.tagName != 'BODY'}\r\n *       );\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} element The start checking html element.\r\n * @param {Function} startConditionFn Callback function.\r\n * @param {HtmlElement} startConditionFn.node: function(node}{...}, node is html element;\r\n * @param {Boolean} startConditionFn.return True - Start to get parent node, false - otherwise. \r\n * @param {Function} stopConditionFn Callback function.\r\n * @param {HtmlElement} stopConditionFn.node: function(node}{...}, node is html element;\r\n * @param {Boolean} startConditionFn.return True - End to get parent node, false - otherwise. \r\n * \r\n * @return {HtmlElement} Parent element or null.\r\n */\r\njslet.ui.findFirstParent = function (htmlElement, conditionFn, stopConditionFn) {\r\n\tvar p = htmlElement;\r\n\tif (!p) {\r\n\t\treturn null;\r\n\t}\r\n\tif (!conditionFn) {\r\n\t\treturn p.parentNode;\r\n\t}\r\n\tif (conditionFn(p)) {\r\n\t\treturn p;\r\n\t} else {\r\n\t\tif (stopConditionFn && stopConditionFn(p.parentNode)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn jslet.ui.findFirstParent(p.parentNode, conditionFn, stopConditionFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Find parent element that has 'jslet' property.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} element The start checking html element.\r\n * \r\n * @return {HtmlElement} Parent element or null.\r\n */\r\njslet.ui.findJsletParent = function(element){\r\n\treturn jslet.ui.findFirstParent(element, function(ele){\r\n\t\treturn ele.jslet ? true:false; \r\n\t});\r\n};\r\n\r\n/**\r\n * @private\r\n * \r\n * Check one node is a child of another node or not.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {HtmlElement} parentNode parent node.\r\n * @param {HtmlElement} testNode, testing node.\r\n * \r\n * @return {Boolean} true - 'testNode' is a child of 'parentNode', false - otherwise.\r\n */\r\njslet.ui.isChild = function(parentNode, testNode) {\r\n\tif(!parentNode || !testNode) {\r\n\t\treturn false;\r\n\t}\r\n\tvar p = testNode;\r\n\twhile(p) {\r\n\t\tif(p == parentNode) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tp = p.parentNode;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @class\r\n * \r\n * Text Measurer, measure the display width or height of the given text. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.textMeasurer.setElement(document.body);\r\n *     try{\r\n *       var width = jslet.ui.textMeasurer.getWidth('HellowWorld');\r\n *       var height = jslet.ui.textMeasurer.getHeight('HellowWorld');\r\n *     }finally{\r\n *       jslet.ui.textMeasurer.setElement();\r\n *     }\r\n * \r\n */\r\njslet.ui.TextMeasurer = function () {\r\n\tvar rule,felement = document.body,felementWidth;\r\n\r\n\tvar lastText = null;\r\n\t\r\n\tvar createRule = function () {\r\n\t\tif (!rule) {\r\n\t\t\trule = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(rule);\r\n\t\t\trule.style.position = 'absolute';\r\n\t\t\trule.style.left = '-9999px';\r\n\t\t\trule.style.top = '-9999px';\r\n\t\t\trule.style.display = 'none';\r\n\t\t\trule.style.margin = '0px';\r\n\t\t\trule.style.padding = '0px';\r\n\t\t\trule.style.overflow = 'hidden';\r\n\t\t}\r\n\t\tif (!felement) {\r\n\t\t\tfelement = document.body;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Set HTML element which to be used to merge. \r\n\t * \r\n\t * @param {HtmlElement} element.\r\n\t */\r\n\tthis.setElement = function (element) {\r\n\t\tfelement = element;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcreateRule();\r\n\t\trule.style.fontSize = felement.style.fontSize;\r\n\t\trule.style.fontStyle = felement.style.fontStyle;\r\n\t\trule.style.fontWeight = felement.style.fontWeight;\r\n\t\trule.style.fontFamily = felement.style.fontFamily;\r\n\t\trule.style.lineHeight = felement.style.lineHeight;\r\n\t\trule.style.textTransform = felement.style.textTransform;\r\n\t\trule.style.letterSpacing = felement.style.letterSpacing;\r\n\t};\r\n\r\n\tthis.setElementWidth = function (width) {\r\n\t\tfelementWidth = width;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (width) {\r\n\t\t\tfelement.style.width = width;\r\n\t\t} else {\r\n\t\t\tfelement.style.width = '';\r\n\t\t}\r\n\t};\r\n\r\n\tfunction updateText(text){\r\n\t\tif (lastText != text) {\r\n\t\t\trule.innerHTML = text;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get the display size of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display size, unit: px.\r\n\t */\r\n\tthis.getSize = function (text) {\r\n\t\tcreateRule();\r\n\t\tupdateText(text);\r\n\t\tvar ruleObj = jQuery(rule);\r\n\t\treturn {width:ruleObj.width(),height:ruleObj.height()};\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display width of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display width, unit: px.\r\n\t */\r\n\tthis.getWidth = function (text) {\r\n\t\treturn this.getSize(text).width;\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display height of specified text.\r\n\t * \r\n\t * @param {String} text The text to be measured.\r\n\t * \r\n\t * @return {Integer} Display height, unit: px.\r\n\t */\r\n\tthis.getHeight = function (text) {\r\n\t\treturn this.getSize(text).height;\r\n\t};\r\n};\r\n\r\n/**\r\n * Text measurer. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.textMeasurer.setElement(document.body);\r\n *     try{\r\n *       var width = jslet.ui.textMeasurer.getWidth('HellowWorld');\r\n *       var height = jslet.ui.textMeasurer.getHeight('HellowWorld');\r\n *     }finally{\r\n *       jslet.ui.textMeasurer.setElement();\r\n *     }\r\n\r\n * @type {jslet.ui.TextMeasurer}\r\n * \r\n * @member jslet.ui\r\n */\r\njslet.ui.textMeasurer = new jslet.ui.TextMeasurer();\r\n\r\n/**\r\n * Get css property value. Example:\r\n * \r\n *     @example\r\n *     var width = jslet.ui.getCssValue('fooClass', 'width'); //Return value like '100px' or '200em'\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} className Css class name.\r\n * @param {String} styleName style name\r\n * \r\n * @return {String} Css property value.\r\n */\r\njslet.ui.getCssValue = function(className, styleName){\r\n\tvar odiv = document.createElement('div');\r\n\todiv.className = className;\r\n\todiv.style.display = 'none';\r\n\tdocument.body.appendChild(odiv);\r\n\tvar result = jQuery(odiv).css(styleName);\r\n\t\r\n\tdocument.body.removeChild(odiv);\r\n\treturn result;\r\n};\r\n\r\njslet.ui.setEditableStyle = function(formElement, disabled, readOnly, onlySetStyle, required) {\r\n\tif(!onlySetStyle) {\r\n\t\tformElement.disabled = disabled;\r\n\t\tformElement.readOnly = readOnly;\r\n\t}\r\n\tvar jqEl = jQuery(formElement);\r\n\tif(disabled || readOnly) {\r\n\t\tif (!jqEl.hasClass('jl-readonly')) {\r\n\t\t\tjqEl.addClass('jl-readonly');\r\n\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t}\r\n\t} else {\r\n\t\tjqEl.removeClass('jl-readonly');\r\n\t\tif(required) {\r\n\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Get system scroll bar width.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @return {Integer} scroll bar width.\r\n */\r\njslet.ui.scrollbarSize = function() {\r\n\tvar parent, child, width, height;\r\n\r\n\tif (width === undefined) {\r\n\t\tparent = jQuery('<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>').appendTo('body');\r\n\t\tchild = parent.children();\r\n\t\twidth = child.innerWidth() - child.height(99).innerWidth();\r\n\t\tparent.remove();\r\n\t}\r\n\r\n\treturn width;\r\n};\r\n\r\n/*\r\n * getStyleObject Plugin for jQuery JavaScript Library\r\n * From: http://upshots.org/?p=112\r\n *\r\n * Copyright: Unknown, see source link\r\n * Plugin version by Dakota Schneider (http://hackthetruth.org)\r\n */\r\n(function($){\r\n    $.fn.getStyleObject = function(){\r\n        var dom = this.get(0);\r\n        var style, prop;\r\n        var returns = {};\r\n        if(window.getComputedStyle){\r\n            var camelize = function(a,b){\r\n                return b.toUpperCase();\r\n            };\r\n            style = window.getComputedStyle(dom, null);\r\n            for(var i=0;i<style.length;i++){\r\n                prop = style[i];\r\n                var camel = prop.replace(/\\-([a-z])/g, camelize);\r\n                var val = style.getPropertyValue(prop);\r\n                returns[camel] = val;\r\n            }\r\n            return returns;\r\n        }\r\n        if(dom.currentStyle){\r\n            style = dom.currentStyle;\r\n            for(prop in style){\r\n                returns[prop] = style[prop];\r\n            }\r\n            return returns;\r\n        }\r\n        return this.css();\r\n    };\r\n})(jQuery);\r\n\r\njslet.Clipboard = function() {\r\n\tvar doc = window.document;\r\n\tvar clipboard = doc.getElementById('jsletClipboard');\r\n\tif(!clipboard) {\r\n\t\tjQuery('<textarea id=\"jsletClipboard\" style=\"position:absolute;top:-1000px\" tabindex=\"-1\"></textarea>').appendTo(doc.body);\r\n\t\r\n\t    window.addEventListener('copy', function (event) {\r\n\t        var text = jQuery('#jsletClipboard').val();\r\n\t        if(text) {\r\n\t\t        if(event.clipboardData) {\r\n\t\t        \tevent.clipboardData.setData('text/plain', text);\r\n\t\t        } else {\r\n\t\t        \twindow.clipboardData.setData('text', text);\r\n\t\t        }\r\n\t\t        jQuery('#jsletClipboard').val(null);\r\n\t\t        event.preventDefault();\r\n\t\t        return false;\r\n\t        }\r\n\t    });\r\n\t}\r\n};\r\n\r\njslet.Clipboard.putText = function(text) {\r\n\tvar clipboard = jQuery('#jsletClipboard').val(text);\r\n\tclipboard[0].select();\r\n};\r\n\r\njslet.Clipboard();\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Accordion. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"Accordion\",selectedIndex:1,items:[{caption:\"Caption1\"},{caption:\"Caption2\"}]};\r\n * \r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *  \r\n *     //2. Binding\r\n *       <div id='ctrlId'>\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.Accordion = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,selectedIndex,onChanged,items';\r\n\r\n\t\tZ._selectedIndex = 0;\r\n\t\t\r\n\t\tZ._onChanged = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Selected index.\r\n\t * \r\n\t * @param {Integer | undefined} index selected index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tselectedIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._selectedIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.selectedIndex', index).isGTEZero();\r\n\t\tthis._selectedIndex = index;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user changes accordion panel. Example:\r\n\t * \r\n\t *     @example \r\n\t *\t   accordionObj.onChanged(function(index){\r\n\t *     });\r\n\t *\r\n\t * @param {Function | undefined} onChanged Accordion panel changed event.\r\n\t * @param {Integer} onChanged.index Accordion panel index.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonChanged: function(onChanged) {\r\n\t\tif(onChanged === undefined) {\r\n\t\t\treturn this._onChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.onChanged', onChanged).isFunction();\r\n\t\tthis._onChanged = onChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Accordion item settings. Example:\r\n\t * \r\n\t *     @example\r\n\t *     accordObj.items([caption: 'caption1'}, {caption: 'caption2'},...]);\r\n\t *     \r\n\t * @param {Object[] | undefined} items Items settings.\r\n\t * @param {String} items.caption Item caption.\r\n\t * \r\n\t * @return {this | Object[]} \r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Accordion.items.caption', item.caption).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-accordion')) {\r\n\t\t\tjqEl.addClass('jl-accordion jl-border-box jl-round5');\r\n\t\t}\r\n\t\tvar panels = jqEl.find('>div'), jqCaption, headHeight = 0, item;\r\n\r\n\t\tvar captionCnt = Z._items ? Z._items.length - 1: -1, caption;\r\n\t\tpanels.before(function(index) {\r\n\t\t\tif (index <= captionCnt) {\r\n\t\t\t\tcaption = Z._items[index].caption;\r\n\t\t\t} else {\r\n\t\t\t\tcaption = 'caption' + index;\r\n\t\t\t}\r\n\t\t\treturn '<button class=\"btn btn-default jl-accordion-head btn-sm\" jsletindex = \"' + index + '\">' + caption + '</button>';\r\n\t\t});\r\n\r\n\t\tvar jqCaptions = jqEl.find('>.jl-accordion-head');\r\n\t\tjqCaptions.click(Z._doCaptionClick);\r\n\t\t\r\n\t\theadHeight = jqCaptions.outerHeight() * panels.length;\r\n\t\tvar contentHeight = jqEl.innerHeight() - headHeight-1;\r\n\t\t\r\n\t\tpanels.wrap('<div class=\"jl-accordion-body\" style=\"height:'+contentHeight+'px;display:none\"></div>');\r\n\t\tvar index = Z._selectedIndex;\r\n\t\tif(index > 0) {\r\n\t\t\tZ._selectedIndex = 0;\r\n\t\t}\r\n        Z.setSelectedIndex(index, true);\r\n\t},\r\n\t\r\n\t_doCaptionClick: function(event){\r\n\t\tvar jqCaption = jQuery(event.currentTarget),\r\n\t\t\tZ = jslet.ui.findJsletParent(jqCaption[0]).jslet,\r\n\t\t\tk = parseInt(jqCaption.attr('jsletindex'));\r\n\t\tZ.setSelectedIndex(k);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set selected index\r\n\t * \r\n\t * @param {Integer} index Panel index, start at 0.\r\n\t */\r\n\tsetSelectedIndex: function(index, isRenderAll){\r\n\t\tif (!index) {\r\n\t\t\tindex = 0;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar jqBodies = jQuery(Z.el).find('>.jl-accordion-body');\r\n\t\tvar pnlCnt = jqBodies.length - 1;\r\n\t\tif (index > pnlCnt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (Z._selectedIndex == index && index < pnlCnt){\r\n\t\t\tjQuery(jqBodies[index]).hide();\r\n\t\t\tif(!isRenderAll || isRenderAll && index > 0) {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tjQuery(jqBodies[index]).show();\r\n\t\t\tZ._selectedIndex = index;\r\n\t\t\tif (Z._onChanged){\r\n\t\t\t\tZ._onChanged.call(this, index);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._selectedIndex >= 0 && Z._selectedIndex != index) {\r\n\t\t\tjQuery(jqBodies[Z._selectedIndex]).hide();\r\n\t\t}\r\n\t\tjQuery(jqBodies[index]).show();\r\n\t\tZ._selectedIndex = index;\r\n\t\tif (Z._onChanged) {\r\n\t\t\tZ._onChanged.call(this, index);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('>.jl-accordion-head').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Accordion', jslet.ui.Accordion);\r\njslet.ui.Accordion.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Jslet Desktop, this control is combined with a main menu and a workbench.<br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"Desktop\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"Desktop\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.Desktop = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'header,onLoadMenu,menuType,menuWidth';\r\n\t\tZ.requiredProperties = 'onLoadMenu';\r\n\t\t\r\n\t\tZ._header = null;\r\n\t\tZ._onLoadMenu = null;\r\n\t\tZ._menuType = 'side';\r\n\t\t\r\n\t\tZ._menuWidth = 160;\r\n\t\tZ._expanded = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu header.\r\n\t * \r\n\t * @param {String | undefined} header Menu header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\theader: function(header) {\r\n\t\tif(header === undefined) {\r\n\t\t\treturn this._header;\r\n\t\t}\r\n\t\tthis._header = header;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Loading menu event. It can be a Function or a global function name.<br />\r\n\t * Loaded menu configuration is used for jslet.ui.Menu or jslet.ui.SideMenu control.\r\n\t * \r\n\t * @param {Function | String} onLoadMenu Menu loading event handler.\r\n\t * @param {Object[] | Promise} onLoadMenu.return Menu loading event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonLoadMenu: function(onLoadMenu) {\r\n\t\tjslet.Checker.test('DeskTop.onLoadMenu', onLoadMenu).required();\r\n\t\tthis._onLoadMenu = onLoadMenu;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Menu position. The optional values: left or top.\r\n\t * \r\n\t * @param {String | undefined} menuType Menu type. The optional values: 'side', 'top', 'tree', default is 'side'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tmenuType: function(menuType) {\r\n\t\tif(menuType === undefined) {\r\n\t\t\treturn this._menuType;\r\n\t\t}\r\n\t\tjslet.Checker.test('Desktop.menuType', menuType).inArray(['side', 'top', 'tree']);\r\n\t\tthis._menuType = menuType;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Menu width for side menu. It's valid when 'menuType' is 'side'.\r\n\t * \r\n\t * @param {Integer | undefined} menuWidth Menu width for side menu.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmenuWidth: function(menuWidth) {\r\n\t\tif(menuWidth === undefined) {\r\n\t\t\treturn this._menuWidth;\r\n\t\t}\r\n\t\tthis._menuWidth = menuWidth;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(!jqEl.hasClass('jl-desktop')) {\r\n\t\t\tjqEl.addClass('jl-desktop');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.desktop = this;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el), html,\r\n\t\t\tisTop = (Z._menuType === 'top');\r\n\t\tif(isTop) {\r\n\t\t\thtml = '<div name=\"mainMenu\" class=\"jl-dsk-menu-top\"></div><div name=\"workbench\" class=\"jl-dsk-bench-top\"></div>';\r\n\t\t} else {\r\n\t\t\tZ._expanded = true;\r\n\t\t\thtml = '<div class=\"jl-dsk-menu-left\" style=\"width: ' + Z._menuWidth + 'px\">' + \r\n\t\t\t'<div class=\"jl-dsk-header\"><span class=\"jl-dsk-headercontent\">' + (Z._header || '') + \r\n\t\t\t'</span><a class=\"jl-dsk-toggle\" href=\"javascript:void(0)\"><i class=\"fa fa-exchange\"></i></a></div>' +\r\n\t\t\t'<div class=\"jl-dsk-menu\" name=\"mainMenu\"></div></div><div name=\"workbench\" class=\"jl-dsk-bench-left\" style=\"padding-left: ' + Z._menuWidth + 'px\"></div>';\r\n\t\t}\r\n \t\t\r\n\t\tjqEl.html(html);\r\n\t\tvar menuEl = jqEl.find('[name=\"mainMenu\"]')[0],\r\n\t\t\twbEl = jqEl.find('[name=\"workbench\"]')[0];\r\n\t\t\r\n\t\tvar wbCfg = {type: 'TabControl', newable: false, isFixedHeight: true, styleClass: (Z.styleClass() || '') + ' jl-dsk-bench', \r\n\t\t\t\tenableLoading: true, \r\n\t\t\t\tonContentLoading: Z._doContentLoading, onContentLoaded: Z._doContentLoaded, onRemoveTabItem: Z._doRemoveTabItem};\r\n\t\tZ._workbench = jslet.ui.bindControl(wbEl, wbCfg);\r\n\t\t\r\n\t\tvar menuCfg = {type: (isTop? 'MenuBar': 'SideMenuBar'), onItemClick: jQuery.proxy(Z._openMenu, Z)},\r\n\t\t\tmenuItems = null;\r\n\t\tif(Z._onLoadMenu) {\r\n\t\t\tvar result = Z._onLoadMenu();\r\n\t\t\tif(result.done) {\r\n\t\t\t\tresult.done(function(items) {\r\n\t\t\t\t\tjslet.Checker.test('Desktop.MenuItems', items).isArray();\r\n\t\t\t\t\tZ._mainMenu.items(items);\r\n\t\t\t\t\tZ._mainMenu.renderAll();\r\n\t\t\t\t\tZ._autoOpenMenu(items);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tmenuCfg.items = result;\r\n\t\t\t\tmenuItems = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._mainMenu = jslet.ui.bindControl(menuEl, menuCfg);\r\n\t\tif(menuItems) {\r\n\t\t\tZ._autoOpenMenu(menuItems);\r\n\t\t}\r\n\t\tif(!isTop) {\r\n\t\t\tjqEl.find('.jl-dsk-toggle').off().on('click', function() {\r\n\t\t\t\tZ._toggleMenu();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t_autoOpenMenu: function(menuItems) {\r\n\t\tif(!menuItems) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuCfg;\r\n\t\tfor(var i = 0, len = menuItems.length; i < len; i++) {\r\n\t\t\tmenuCfg = menuItems[i];\r\n\t\t\tif(menuCfg.items) {\r\n\t\t\t\tthis._autoOpenMenu(menuCfg.items);\r\n\t\t\t} else if(menuCfg.autoOpen) {\r\n\t\t\t\tthis._openMenu(menuCfg);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_toggleMenu: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._expanded = !Z._expanded;\r\n\t\tvar menuContainer = jqEl.find('.jl-dsk-menu-left'),\r\n\t\t\tjqHeader = jqEl.find('.jl-dsk-headercontent'),\r\n\t\t\tjqWB = jQuery(Z._workbench.el);\r\n\t\tif(Z._expanded) {\r\n\t\t\tZ._mainMenu.expand();\r\n\t\t\tmenuContainer.removeClass('jl-dsk-menu-left-collapsed');\r\n\t\t\tjqHeader.show();\r\n\t\t\tjqWB.css('padding-left', Z._menuWidth);\r\n\t\t} else {\r\n\t\t\tZ._mainMenu.collapse();\r\n\t\t\tjqHeader.hide();\r\n\t\t\tmenuContainer.addClass('jl-dsk-menu-left-collapsed');\r\n\t\t\tjqWB.css('padding-left', 40);\r\n\t\t}\r\n\t},\r\n\t\r\n\tshowTabPanel: function(tabPanelId) {\r\n\t\tthis._workbench.setContentLoadedState(tabPanelId);\r\n\t},\r\n\t\r\n\tsetTabPanelChanged: function(tabPanelId, changed) {\r\n\t\tthis._workbench.setContentChangedState(tabPanelId, changed);\r\n\t},\r\n\t\r\n\topenMenuById: function(menuId) {\r\n\t\tvar menuCfg = this._getMenuCfg(this._mainMenu.items(), menuId, true);\r\n\t\tthis._openMenu(menuCfg);\r\n\t},\r\n\t\r\n\topenMenuByName: function(menuName) {\r\n\t\tvar menuCfg = this._getMenuCfg(this._mainMenu.items(), menuName);\r\n\t\tthis._openMenu(menuCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set tab item to changed state or not.\r\n\t * \r\n\t * @param {String} tabItemId Tab item id.\r\n\t * @param {Boolean} changed Changed state.\r\n\t */\r\n\tsetContentChangedState: function(tabItemId, changed) {\r\n\t\tthis._workbench.setContentChangedState(tabItemId, changed);\r\n\t},\r\n\t\r\n\t/**\r\n\t * set the specified tab item to loaded state. It will fire the \"onContentLoaded\" event.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t */\r\n\tsetContentLoadedState: function(tabItemId) {\r\n\t\tthis._workbench.setContentLoadedState(tabItemId);\r\n\t},\r\n\t\r\n\t_getMenuCfg: function(items, key, isById) {\r\n\t\tvar result = null, item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tif(item.items) {\r\n\t\t\t\tresult = this._getMenuCfg(item.items, key, isById);\r\n\t\t\t\tif(result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(isById) {\r\n\t\t\t\t\tif(item.id === key) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(item.name === key) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_doContentLoading: function(id, tabItemCfg) {\r\n    \tif(tabItemCfg.debounce) {\r\n    \t\tjQuery('#' + id).hide();\r\n    \t\tvar self = this;\r\n    \t\tvar timeout = window.setTimeout(function() {\r\n    \t\t\tjQuery('#' + id).fadeIn('fast');\r\n    \t\t\tself.hideLoading(id);\r\n    \t\t\tconsole.warn('Show tab panel after 5 minutes automatically. There must be the code \"jslet.ui.desktopUtil.showTabPanel();\" in the iframe page!');\r\n    \t\t\twindow.clearTimeout(timeout);\r\n    \t\t}, 5000);\r\n    \t}\r\n\t},\r\n\t\r\n\t_doContentLoaded: function(id, tabItemCfg) {\r\n    \tif(tabItemCfg.debounce) {\r\n    \t\tjQuery('#' + id).fadeIn('fast');\r\n    \t}\r\n\t},\r\n\t\r\n\t_doRemoveTabItem: function(tabItemCfg, isActive) {\r\n//    \tvar iframe = document.getElementById(tabItemCfg.contentId);\r\n//    \tvar iframeWin = iframe.contentWindow || iframe;\r\n//    \tif(iframeWin.onMainTabClosed) {\r\n//    \t\tiframeWin.onMainTabClosed(tabItemCfg);\r\n//    \t}\r\n    \treturn true;\r\n\t},\r\n\t\r\n\t_openMenu: function(menuCfg) {\r\n\t\tif(!menuCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuUrl = jQuery.trim(menuCfg.url);\r\n\t\t\r\n\t\tif(menuUrl) {\r\n\t\t\tvar menuId = menuCfg.id;\r\n\t\t\tmenuUrl = jslet.urlUtil.addParam(menuUrl, {menuId: menuId});\r\n\t    \tthis._workbench.addTabItem({id: 'if-' + menuId, header: menuCfg.name, url: menuUrl, closable: true, userIFrame: true, debounce: menuCfg.debounce, iconClass: menuCfg.iconClass});\r\n\t    \treturn;\r\n\t\t}\r\n\t\tif(menuCfg.onclick) {\r\n\t\t\tmenuCfg.onclick.call(menuCfg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.warn('Menu: ' + menuCfg.name + ' not exists properties: \"url\" or \"onclick\"');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('.jl-dsk-toggle').off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Desktop', jslet.ui.Desktop);\r\njslet.ui.Desktop.htmlTemplate = '<div></div>';\r\n\r\njslet.ui.DesktopUtil = function() {\r\n\tvar checkDatasetChangedHandler, currTabItemId, changingDatasets, debounce = null;\r\n\t\r\n\tfunction getCurrTabItemId() {\r\n\t\tif(!currTabItemId) {\r\n\t\t\tvar url = window.document.location.href;\r\n\t\t\tcurrTabItemId = jslet.urlUtil.getParam(url, 'jlTabItemId');\r\n\t\t}\r\n\t\treturn currTabItemId;\r\n\t}\r\n\t\r\n\tfunction isPageDebounce() {\r\n\t\tif(debounce === null) {\r\n\t\t\tvar url = window.document.location.href;\r\n\t\t\tdebounce = jslet.urlUtil.getParam(url, 'debounce');\r\n\t\t}\r\n\t\treturn !!debounce;\r\n\t}\r\n\t\r\n\tfunction getDesktop() {\r\n\t\tvar p = window.parent;\r\n\t\tvar result = null;\r\n\t\tif(p !== window) {\r\n\t\t\twhile(true) {\r\n\t\t\t\tif(!p) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(p.jslet && p.jslet.desktop) {\r\n\t\t\t\t\tresult = p.jslet.desktop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(p === p.parent) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tp = p.parent;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!result) { //If parent not exists desktop object, check current window object.\r\n\t\t\tif(window.jslet) {\r\n\t\t\t\tresult = window.jslet.desktop;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tthis.showTabPanel = function() {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.showTabPanel(getCurrTabItemId());\r\n\t};\r\n\t\r\n\tthis.registerEditableDataset = function(datasetNames) {\r\n\t\tjslet.Checker.test('registerEditableDatasetString', datasetNames).isString();\r\n\t\tif(datasetNames) {\r\n\t\t\tvar chgDatasets = datasetNames;\r\n\t\t\tif(jslet.isString(chgDatasets)) {\r\n\t\t\t\tchgDatasets = datasetNames.split(',');\r\n\t\t\t}\r\n\t\t\tchangingDatasets = {};\r\n\t\t\tfor(var i = 0, len = chgDatasets.length; i < len; i++) {\r\n\t\t\t\tchangingDatasets[chgDatasets[i]] = false;\r\n\t\t\t}\r\n\t\t\tif(!checkDatasetChangedHandler && getCurrTabItemId()) {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t//Check whether dataset is changed\r\n\t\t\t\tcheckDatasetChangedHandler = window.setInterval(function() {\r\n\t\t\t\t\tvar dsObj, isDiff = false,\r\n\t\t\t\t\t\tchanged = false, oldChanged, newChanged;\r\n\t\t\t\t\tfor(var dsName in changingDatasets) {\r\n\t\t\t\t\t\tdsObj = jslet.data.getDataset(dsName);\r\n\t\t\t\t\t\tif(dsObj) {\r\n\t\t\t\t\t\t\toldChanged = changingDatasets[dsName];\r\n\t\t\t\t\t\t\tnewChanged = dsObj.hasChangedData(true);\r\n\t\t\t\t\t\t\tchanged = changed || newChanged;\r\n\t\t\t\t\t\t\tif(oldChanged !== newChanged) {\r\n\t\t\t\t\t\t\t\tisDiff = true;\r\n\t\t\t\t\t\t\t\tchangingDatasets[dsName] = newChanged;\r\n\t\t\t\t\t\t\t\tif(changed) {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isDiff) {\r\n\t\t\t\t\t\tvar desktop = getDesktop();\r\n\t\t\t\t\t\tif(!desktop) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdesktop.setContentChangedState(getCurrTabItemId(), changed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 500);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!checkDatasetChangedHandler) {\r\n\t\t\t\twindow.clearInterval(checkDatasetChangedHandler);\r\n\t\t\t\tcheckDatasetChangedHandler = null;\r\n\t\t\t}\r\n\t\t\tchangingDatasets = null;\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.openMenuById = function(menuId) {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.openMenuById(menuId);\r\n\t};\r\n\r\n\tthis.openMenuByName = function(menuName) {\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.openMenuByName(menuName);\r\n\t};\r\n\t\r\n\tthis.setContentLoadedState = function() {\r\n\t\tif(!isPageDebounce()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar desktop = getDesktop();\r\n\t\tif(!desktop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdesktop.setContentLoadedState(getCurrTabItemId());\r\n\t};\r\n};\r\n\r\njslet.ui.desktopUtil = new jslet.ui.DesktopUtil();\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * FieldSet. Example:\r\n * \r\n *     @example\r\n *     //1. Declaring:\r\n *       <div data-jslet='type:\"FieldSet\"' />\r\n *\r\n *     //2. Binding\r\n *       <div id='ctrlId' />\r\n *       //Js snippet\r\n *       var jsletParam = {type:\"FieldSet\"};\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       var jsletParam = {type:\"FieldSet\"};\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.FieldSet = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,caption,collapsed';\r\n\r\n\t\tZ._caption = null; \r\n\t\t\r\n\t\tZ._collapsed = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get caption of FieldSet.\r\n\t * \r\n\t * @param {String | undefined} caption Caption of FieldSet.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldSet.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify FieldSet is collapsed or not.\r\n\t * \r\n\t * @param {Boolean | undefined} collapsed True - FieldSet is collapsed, false(default) - otherwise. \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcollapsed: function(collapsed) {\r\n\t\tif(collapsed === undefined) {\r\n\t\t\treturn this._collapsed;\r\n\t\t}\r\n\t\tthis._collapsed = collapsed ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-fieldset')) {\r\n\t\t\tjqEl.addClass('jl-fieldset jl-round5');\r\n\t\t}\r\n\t\t\r\n\t\tvar tmpl = ['<legend class=\"jl-fieldset-legend\">'];\r\n\t\ttmpl.push('<span class=\"jl-fieldset-title\"><i class=\"fa fa-chevron-circle-up jl-fieldset-btn\">');\r\n\t\ttmpl.push('<span>');\r\n\t\ttmpl.push(Z._caption);\r\n\t\ttmpl.push('</span></span></legend><div class=\"jl-fieldset-body\"></div>');\r\n\t\t\r\n\t\tvar nodes = Z.el.childNodes, \r\n\t\t\tchildren = [],\r\n\t\t\ti, cnt;\r\n\t\tcnt = nodes.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tchildren.push(nodes[i]);\r\n\t\t}\r\n\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tvar obody = jQuery(Z.el).find('.jl-fieldset-body')[0];\r\n\t\tcnt = children.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tobody.appendChild(children[i]);\r\n\t\t}\r\n\t\t\r\n\t\tjqEl.find('.jl-fieldset-btn').click(jQuery.proxy(Z._doExpandBtnClick, this));\r\n\t},\r\n\t\r\n\t_doExpandBtnClick: function(){\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tvar fsBody = jqEl.find('.jl-fieldset-body');\r\n\t\tif (!Z._collapsed){\r\n\t\t\tfsBody.slideUp();\r\n\t\t\tjqEl.addClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').addClass('fa-chevron-circle-down');\r\n\t\t}else{\r\n\t\t\tfsBody.slideDown();\r\n\t\t\tjqEl.removeClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').removeClass('fa-chevron-circle-down');\r\n\t\t}\r\n\t\tfsBody[0].focus();\r\n\t\tZ._collapsed = !Z._collapsed;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('input.jl-fieldset-btn').off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('FieldSet', jslet.ui.FieldSet);\r\njslet.ui.FieldSet.htmlTemplate = '<fieldset></fieldset>';\r\n\njslet.ui.menuManager = {};\r\n/*\r\n * Global menu id collection, array of string\r\n */\r\njslet.ui.menuManager._menus = [];\r\n\r\n/*\r\n * Register menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.register = function (menuid) {\r\n\tjslet.ui.menuManager._menus.push(menuid);\r\n};\r\n\r\n/*\r\n * Unregister menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.unregister = function (menuid) {\r\n\tfor (var i = 0, len = this._menus.length; i < len; i++) {\r\n\t\tjslet.ui.menuManager._menus.splice(i, 1);\r\n\t}\r\n};\r\n\r\n/*\r\n * Hide all menu item.\r\n */\r\njslet.ui.menuManager.hideAll = function (event) {\r\n\tvar id, menu, menus = jslet.ui.menuManager._menus;\r\n\tfor (var i = 0, len = menus.length; i < len; i++) {\r\n\t\tid = menus[i];\r\n\t\tmenu = jslet('#'+id);\r\n\t\tif (menu) {\r\n\t\t\tmenu.hide();\r\n\t\t}\r\n\t}\r\n\tjslet.ui.menuManager.menuBarShown = false;\r\n\tjslet.ui.menuManager._contextObject = null;\r\n};\r\n\r\njQuery(document).on('mousedown', jslet.ui.menuManager.hideAll);\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * MenuBar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'MenuBar', onItemClick: globalMenuItemClick, items: [\r\n *       {name: 'File', items: [\r\n *         {id: 'new', name: 'New Tab', iconClass: 'icon1' }]\r\n *       }]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id='ctrlId' />\r\n *      //js snippet:\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.MenuBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,onItemClick,items';\r\n\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {MouseEvent} items.onClick.event Mouse event.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} items.items Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tif(!items) {\r\n\t\t\tthis._items = null;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('MenuBar.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-menubar')) {\r\n\t\t\tjqEl.addClass('jl-menubar jl-unselectable jl-round5');\r\n\t\t}\r\n\r\n\t\tthis.renderAll();\r\n\t\tjqEl.on('mouseout',function (event) {\r\n\t\t\tif (Z._preHoverItem && !jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-menubar-item').off();\r\n\t\tthis._createMenuBar();\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be disabled/enabled.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} disabled True - the menu item is disabled, otherwise it's enabled.\r\n\t */\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setDisabled(menuId, disabled);\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be checked or non-checked.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} checked True - the menu item is checked, otherwise it's non-checked.\r\n\t */\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setChecked(menuId, checked);\r\n\t},\r\n\t\r\n\t_createMenuBar: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.isPopup || !Z._items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (var i = 0, cnt = Z._items.length, item; i < cnt; i++) {\r\n\t\t\titem = Z._items[i];\r\n\t\t\tZ._createBarItem(Z.el, item, Z._menubarclick);\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (omi) {\r\n\t\tvar Z = omi.parentNode.jslet,\r\n\t\t\titemCfg = omi.jsletvar;\r\n\t\tif (!itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!itemCfg.subMenu) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items });\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body),\r\n\t\t\tbodyMTop = parseInt(jqBody.css('margin-top')),\r\n\t\t\tbodyMleft = parseInt(jqBody.css('margin-left')),\r\n\t\t\tjqMi = jQuery(omi), \r\n\t\t\tpos = jqMi.offset(), \r\n\t\t\tposX = pos.left;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tposX +=  jqMi.width() + 10;\r\n\t\t}\r\n\t\titemCfg.subMenu.show(posX, pos.top + jqMi.height());\r\n\t\tjslet.ui.menuManager.menuBarShown = true;\r\n\t\tZ._activeMenuItem = omi;\r\n\t},\r\n\r\n\t_createBarItem: function (obar, itemCfg) {\r\n\t\tif (itemCfg.visible !== undefined && !itemCfg.visible) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar omi = document.createElement('div');\r\n\t\tjQuery(omi).addClass('jl-menubar-item');\r\n\t\tomi.jsletvar = itemCfg;\r\n\t\tvar Z = this, jqMi = jQuery(omi);\r\n\t\tjqMi.on('click',function (event) {\r\n\t\t\tvar cfg = this.jsletvar;\r\n\t\t\tif(!cfg.items) {\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\tif (cfg.onClick) {\r\n\t\t\t\t\tcfg.onClick.call(Z, cfg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (Z._onItemClick)\r\n\t\t\t\t\t\tZ._onItemClick.call(Z, cfg);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t}\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tjQuery(this).addClass('jl-menubar-item-hover');\r\n\t\t\tif (jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<a class=\"jl-focusable-item\" href=\"javascript:void(0)\">');\r\n\t\ttemplate.push(itemCfg.name);\r\n\t\ttemplate.push('</a>');\r\n\t\t\r\n\t\tomi.innerHTML = template.join('');\r\n\t\tobar.appendChild(omi);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tZ._activeMenuItem = null;\r\n\t\tZ._preHoverItem = null;\r\n\t\tZ._menubarclick = null;\r\n\t\tZ._onItemClick = null;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menubar-item').off();\r\n\t\tjqEl.find('.jl-menubar-item').each(function(){\r\n\t\t\tvar omi = this;\r\n\t\t\tif (omi.jsletvar){\r\n\t\t\t\tomi.jsletvar.subMenu = null;\r\n\t\t\t\tomi.jsletvar = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('MenuBar', jslet.ui.MenuBar);\r\njslet.ui.MenuBar.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Menu. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'Menu', onItemClick: globalMenuItemClick, items: [\r\n *       {id: 'back', name: 'Backward', iconClass: 'icon1' },\r\n *       {id: 'go', name: 'Forward', disabled: true },\r\n *       {name: '-' }]};\r\n *\r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *       <div id='menu1' />\r\n *       //js snippet:\r\n *       var el = document.getElementById('menu1');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n *       //Use the below code to show context menu\r\n *       jslet('#ctrlId').showContextMenu(event);\r\n *       //Show menu at the specified position\r\n *       jslet('#ctrlId').show(left, top);\r\n * \r\n */\r\njslet.ui.Menu = jslet.Class.create(jslet.ui.Control, {\r\n\t_onItemClick: undefined,\r\n\t_items:undefined,\r\n\t_invoker: null,\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'onItemClick,items,invoker'; //'invoker' is used for inner\r\n\t\t//items is an array, menu item's properties: id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items\r\n\t\t$super(el, params);\r\n\t\tZ._activeSubMenu = null;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {MouseEvent} items.onClick.event Mouse event.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Menu.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tinvoker: function(invoker) {\r\n\t\tif(invoker === undefined) {\r\n\t\t\treturn this._invoker;\r\n\t\t}\r\n\t\tthis._invoker = invoker;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tele = Z.el;\r\n\t\tif (!jqEl.hasClass('jl-menu')) {\r\n\t\t\tjqEl.addClass('jl-menu');\r\n\t\t}\r\n\t\tele.style.display = 'none';\r\n\r\n\t\tif (!ele.id) {\r\n\t\t\tele.id = jslet.nextId();\r\n\t\t}\r\n\r\n\t\tjslet.ui.menuManager.register(ele.id);\r\n\t\tZ._createMenuPopup();\r\n\t\tjqEl.on('mousedown',function (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseover', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\tif (jslet.ui.menuManager.timerId) {\r\n\t\t\t\twindow.clearTimeout(jslet.ui.menuManager.timerId);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseout', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = false;\r\n\t\t\tjslet.ui.menuManager.timerId = window.setTimeout(function () {\r\n\t\t\t\tif (!jslet.ui.menuManager._inPopupMenu) {\r\n\t\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\t}\r\n\t\t\t\tjslet.ui.menuManager.timerId = null;\r\n\t\t\t}, 800);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be disabled/enabled.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} disabled True - the menu item is disabled, otherwise it's enabled.\r\n\t */\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setDisabled(menuId, disabled);\r\n\t},\r\n\r\n\t/**\r\n\t * Set a menu item to be checked or non-checked.\r\n\t * \r\n\t * @param {String} menuId Menu id.\r\n\t * @param {Boolean} checked True - the menu item is checked, otherwise it's non-checked.\r\n\t */\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar operator = new jslet.ui.Menu.Operator(this);\r\n\t\toperator.setChecked(menuId, checked);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show menu at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\twidth = jqEl.outerWidth(),\r\n\t\t\theight = jqEl.outerHeight(),\r\n\t\t\tjqWin = jQuery(window),\r\n\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\twinHeight = jqWin.scrollTop() + jqWin.height();\r\n\t\t\t\r\n\t\tleft = left || Z.left || 10;\r\n\t\ttop = top || Z.top || 10;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tleft -= width;\r\n\t\t}\r\n\t\tif(left + width > winWidth) {\r\n\t\t\tleft += winWidth - left - width - 1;\r\n\t\t}\r\n\t\tif(top + height > winHeight) {\r\n\t\t\ttop += winHeight - top - height - 1;\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 0;\r\n\t\t}\r\n\t\tZ.el.style.left = left + 'px';\r\n\t\tZ.el.style.top = parseInt(top) + 'px';\r\n\t\tZ.el.style.display = 'block';\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu at the position which specifed by a HTML element. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menuObj.showAt('#btn1'); //\r\n\t *     menuObj.showAt(document.getElementById('btn1'));\r\n\t * \r\n\t * @param {String | HtmlElement} hostEl Host HTML element or jQuery query string.\r\n\t */\r\n\tshowAt: function(hostEl) {\r\n\t\tvar jqHost = jQuery(hostEl);\r\n\t\tif(jqHost.length === 0) {\r\n\t\t\tthrow new Error('Host control NOT found When showing menu, check it first!');\r\n\t\t}\r\n\t\tvar offset = jqHost.offset();\r\n\t\tthis.show(offset.left, offset.top + jqHost.outerHeight());\r\n\t},\r\n\t\r\n\t/**\r\n\t * Hide menu item and all its sub menu item.\r\n\t */\r\n\thide: function () {\r\n\t\tthis.ctxElement = null;\r\n\t\tthis.el.style.display = 'none';\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu on context menu. Example:\r\n\t * \r\n\t *     @example\r\n\t *     //Html\r\n\t *     <div id=\"popmenu\" oncontextmenu=\"popMenu(event);\">\r\n\t *     //Js\r\n\t *\t   function popMenu(event) {\r\n\t *\t     jslet(\"#popmenu\").showContextMenu(event);\r\n\t *     }\r\n\t */\r\n\tshowContextMenu: function (event, contextObj) {\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tjslet.ui.menuManager._contextObject = contextObj;\r\n\t\tthis.show(event.pageX, event.pageY);\r\n\t\tevent.preventDefault();\r\n\t},\r\n\r\n\t_createMenuPopup: function () {\r\n\t\tvar panel = this.el,\r\n\t\t\titems = this._items, itemCfg, name, i, cnt;\r\n\t\tcnt = items.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\titemCfg = items[i];\r\n\t\t\tif (!itemCfg.name) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tname = itemCfg.name.trim();\r\n\t\t\tif (name != '-') {\r\n\t\t\t\tthis._createMenuItem(panel, itemCfg);\r\n\t\t\t} else {\r\n\t\t\t\tthis._createLine(panel, itemCfg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdocument.body.appendChild(panel);\r\n\t},\r\n\r\n\t_ItemClick: function (sender, cfg) {\r\n\t\t//has sub menu items\r\n\t\tif (cfg.items) {\r\n\t\t\tthis._showSubMenu(sender, cfg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (cfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\t\tif (cfg.itemType == 'check' || cfg.itemType == 'radio') {\r\n\t\t\tthis.setChecked(sender.id, !cfg.checked);\r\n\t\t}\r\n\t\tvar contextObj = jslet.ui.menuManager._contextObject || this;\r\n\t\tif (cfg.onClick) {\r\n\t\t\tcfg.onClick.call(contextObj, cfg);\r\n\t\t} else {\r\n\t\t\tif (this._onItemClick) {\r\n\t\t\t\tthis._onItemClick.call(contextObj, cfg);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_hideSubMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._activeSubMenu) {\r\n\t\t\tZ._activeSubMenu._hideSubMenu();\r\n\t\t\tZ._activeSubMenu.hide();\r\n\t\t\tZ._activeSubMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex'));\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (sender, cfg, delayTime) {\r\n\t\tvar Z = this;\r\n\t\tvar func = function () {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tif (!cfg.subMenu) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqPmi = jQuery(sender),\r\n\t\t\t\tpos = jqPmi.offset(), \r\n\t\t\t\tx = pos.left;\r\n\t\t\tif (!jsletlocale.isRtl) {\r\n\t\t\t\tx += jqPmi.width();\r\n\t\t\t}\r\n\r\n\t\t\tcfg.subMenu.show(x - 2, pos.top);\r\n\t\t\tcfg.subMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex')) + 1;\r\n\t\t\tZ._activeSubMenu = cfg.subMenu;\r\n\t\t};\r\n\t\tif (delayTime) {\r\n\t\t\twindow.setTimeout(func, delayTime);\r\n\t\t} else {\r\n\t\t\tfunc();\r\n\t\t}\r\n\t},\r\n\r\n\t_ItemOver: function (sender, cfg) {\r\n\t\tif (this._activeSubMenu) {\r\n\t\t\tthis._showSubMenu(sender, cfg, 200);\r\n\t\t}\r\n\t},\r\n\r\n\t_createMenuItem: function (container, itemCfg, defaultClickHandler) {\r\n\t\t//id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items,subMenuId\r\n\t\tvar isCheckBox = false, \r\n\t\t\tisRadioBox = false,\r\n\t\t\titemType = itemCfg.itemType;\r\n\t\tif (itemType) {\r\n\t\t\tisCheckBox = (itemType == 'check');\r\n\t\t\tisRadioBox = (itemType == 'radio');\r\n\t\t}\r\n\t\tif (isCheckBox) {\r\n\t\t\titemCfg.iconClass = 'fa fa-check';//'jl-menu-check';\r\n\t\t}\r\n\t\tif (isRadioBox) {\r\n\t\t\titemCfg.iconClass = 'fa fa-circle'; //kjl-menu-radio';\r\n\t\t}\r\n\t\tif (itemCfg.items) {\r\n\t\t\titemCfg.disabled = false;\r\n\t\t}\r\n\t\tvar mi = document.createElement('div'), Z = this, jqMi = jQuery(mi);\r\n\t\tjqMi.addClass('jl-menu-item ' + (itemCfg.disabled ? 'jl-menu-disabled' : ''));\r\n\r\n\t\tif (!itemCfg.id) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tmi.id = itemCfg.id;\r\n\t\tmi.jsletvar = itemCfg;\r\n\t\tjqMi.on('click', function (event) {\r\n\t\t\tZ._ItemClick(this, this.jsletvar);\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tZ._ItemOver(this, this.jsletvar);\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tif (!this.jsletvar.disabled) {\r\n\t\t\t\tjQuery(this).addClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseout', function (event) {\r\n\t\t\tif (!this.jsletvar.subMenu) {\r\n\t\t\t\tjQuery(this).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<span class=\"jl-menu-icon-placeholder ');\r\n\t\tif ((isCheckBox || isRadioBox) && !itemCfg.checked) {\r\n\t\t\t//Empty \r\n\t\t} else {\r\n\t\t\tif (itemCfg.iconClass) {\r\n\t\t\t\ttemplate.push((!itemCfg.disabled || !itemCfg.disabledIconClass) ? itemCfg.iconClass : itemCfg.disabledIconClass);\r\n\t\t\t}\r\n\t\t}\r\n\t\ttemplate.push('\"></span>');\r\n\r\n\t\tif (itemCfg.items) {\r\n\t\t\ttemplate.push('<div class=\"jl-menu-arrow\"><i class=\"fa fa-caret-right\" aria-hidden=\"true\"></i></div>');\r\n\t\t}\r\n\r\n\t\ttemplate.push('<a  href=\"javascript:void(0)\" class=\"jl-focusable-item jl-menu-content ');\r\n\t\ttemplate.push(' jl-menu-content-left jl-menu-content-right');\r\n\t\ttemplate.push('\">');\r\n\t\ttemplate.push(itemCfg.name + \"&nbsp;&nbsp;&nbsp;&nbsp;\");\r\n\t\ttemplate.push('</a>');\r\n\t\tmi.innerHTML = template.join('');\r\n\t\tcontainer.appendChild(mi);\r\n\t\tif (itemCfg.items) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items, invoker: mi });\r\n\t\t}\r\n\t},\r\n\r\n\t_createLine: function (container, itemCfg) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\tjQuery(odiv).addClass('jl-menu-line');\r\n\t\tcontainer.appendChild(odiv);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._activeSubMenu = null;\r\n\t\tjslet.ui.menuManager.unregister(Z.el.id);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menu-item').each(function(){\r\n\t\t\tthis.onmouseover = null;\r\n\t\t\tthis.onclick = null;\r\n\t\t\tthis.onmouseout = null;\r\n\t\t});\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Menu', jslet.ui.Menu);\r\njslet.ui.Menu.htmlTemplate = '<div></div>';\r\n\r\n\r\njslet.ui.Menu.Operator = function(menuObj) {\r\n\tthis._menuObj = menuObj;\r\n};\r\n\r\njslet.ui.Menu.Operator.prototype = {\r\n\tgetMenuItemById: function(id) {\r\n\t\tjslet.Checker.test('getMenuItemById#id', id).required().isString();\r\n\t\t\r\n\t\tfunction getItem(items, id) {\r\n\t\t\tvar item, itemObj;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif(item.id === id) {\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.items) {\r\n\t\t\t\t\titem = getItem(item.items, id);\r\n\t\t\t\t\tif(item) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar items = this._menuObj.items();\r\n\t\tif(!items) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn getItem(items, id);\r\n\t},\r\n\t\t\r\n\tgetMenuGroup: function(id, excludeSelf) {\r\n\t\tjslet.Checker.test('getMenuGroup#id', id).required().isString();\r\n\t\t\r\n\t\tfunction getItemGroup(items, id) {\r\n\t\t\tvar item, itemObj;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif(item.id === id && item.itemType === 'radio') {\r\n\t\t\t\t\tvar groupName = item.group,\r\n\t\t\t\t\t\tresult = [], itemCfg;\r\n\t\t\t\t\tfor(var j = 0, size = items.length; j < size; j++) {\r\n\t\t\t\t\t\titemCfg = items[j];\r\n\t\t\t\t\t\tif(excludeSelf && itemCfg.id === id) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(itemCfg.itemType === 'radio' && itemCfg.group === groupName) {\r\n\t\t\t\t\t\t\tresult.push(itemCfg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.items) {\r\n\t\t\t\t\tvar groupItems = getItemGroup(item.items, id);\r\n\t\t\t\t\tif(groupItems) {\r\n\t\t\t\t\t\treturn groupItems;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar items = this._menuObj.items();\r\n\t\tif(!items) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn getItemGroup(items, id);\r\n\t},\r\n\t\t\r\n\tsetDisabled: function (menuId, disabled) {\r\n\t\tvar itemCfg = this.getMenuItemById(menuId);\r\n\t\titemCfg.disabled = disabled? true: false;\r\n\t\tif (itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqMi = jQuery('#'+menuId);\r\n\t\tif(jqMi.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (disabled) {\r\n\t\t\tjqMi.removeClass('jl-menu-enabled');\r\n\t\t\tjqMi.addClass('jl-menu-disabled');\r\n\t\t} else {\r\n\t\t\tjqMi.removeClass('jl-menu-disabled');\r\n\t\t\tjqMi.addClass('jl-menu-enabled');\r\n\t\t}\r\n\t},\r\n\t\r\n\tsetChecked: function (menuId, checked) {\r\n\t\tvar itemCfg = this.getMenuItemById(menuId);\r\n\t\tvar itemType = itemCfg.itemType;\r\n\t\tchecked = itemType === 'radio'? true: checked; //Radio menu item can not be unchecked.\r\n\t\tif (itemCfg.disabled || itemType != 'check' && itemType != 'radio' || itemCfg.checked == checked) {\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.checked = checked;\r\n\t\tvar changedCfg = [itemCfg], i, len;\r\n\t\tif(itemType == 'radio') {\r\n\t\t\tvar otherGroups = this.getMenuGroup(menuId, true);\r\n\t\t\tfor(i = 0, len = otherGroups.length; i < len; i++) {\r\n\t\t\t\titemCfg = otherGroups[i];\r\n\t\t\t\tif(itemCfg.checked) {\r\n\t\t\t\t\titemCfg.checked = false;\r\n\t\t\t\t\tchangedCfg.push(itemCfg);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqIcon;\r\n\t\tfor(i = 0, len = changedCfg.length; i < len; i++) {\r\n\t\t\titemCfg = changedCfg[i];\r\n\t\t\tjqIcon = jQuery('#'+itemCfg.id).find('.jl-menu-icon-placeholder');\r\n\t\t\tif (itemCfg.checked) {\r\n\t\t\t\tjqIcon.addClass(itemCfg.iconClass);\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass(itemCfg.iconClass);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Jslet Portal, it is combined with some parts, and the end user can adjust the layout of these windows.<br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"Portal\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"Portal\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.Portal = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'parts,partChanged';\r\n\t\tZ.requiredProperties = '';\r\n\t\t\r\n\t\tZ._parts = null;\r\n\t\t\r\n\t\tZ._partChanged = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get parts in the portal.\r\n\t * \r\n\t * @param {Object[] | undefined} parts Parts in the portal.\r\n\t * @param {String} parts.id Part id.\r\n\t * @param {String} parts.caption Part caption.\r\n\t * @param {String} parts.url Part content URL.\r\n\t * @param {Integer} parts.left Left position of left-top point.\r\n\t * @param {Integer} parts.top Top position of left-top point.\r\n\t * @param {Integer} parts.width Part's width.\r\n\t * @param {Integer} parts.height Part's height.\r\n\t * @param {Integer} parts.closable Identify whether part is closable or not.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\tparts: function(parts) {\r\n\t\tif(parts === undefined) {\r\n\t\t\treturn this._parts;\r\n\t\t}\r\n\t\tthis.clearParts();\r\n\t\tthis._parts = parts;\r\n\t\tif(parts) {\r\n\t\t\tjslet.Checker.test('Portal.parts', parts).isArray();\r\n\t\t\tvar part;\r\n\t\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\t\tpart = parts[i];\r\n\t\t\t\tjslet.Checker.test('Portal.part.id', part.id).required().isString();\r\n\t\t\t\tjslet.Checker.test('Portal.part.caption', part.caption).isString();\r\n\t\t\t\tjslet.Checker.test('Portal.part.url', part.url).isString();\r\n\t\t\t\tjslet.Checker.test('Portal.part.top', part.top).isNumber();\r\n\t\t\t\tjslet.Checker.test('Portal.part.left', part.left).isNumber();\r\n\t\t\t\tjslet.Checker.test('Portal.part.width', part.width).isNumber();\r\n\t\t\t\tjslet.Checker.test('Portal.part.height', part.height).isNumber();\r\n\t\t\t}\r\n\t\t\tif(this.binded) {\r\n\t\t\t\tthis.loadParts();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Identify whether part is changed(added, deleted or layout changed).\r\n\t * \r\n\t * @return {Boolean} True - changed, false - otherwise.\r\n\t */\r\n\tpartChanged: function() {\r\n\t\treturn this._partChanged? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(!jqEl.hasClass('jl-portal')) {\r\n\t\t\tjqEl.addClass('jl-portal');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.clearParts();\r\n\t\tthis.loadParts();\r\n\t},\r\n\r\n\t/**\r\n\t * Add a part into portal.\r\n\t * \r\n\t * @param {Object} partCfg Part configuration.\r\n\t * @param {String} partCfg.id Part id.\r\n\t * @param {String} partCfg.caption Part caption.\r\n\t * @param {String} partCfg.url Part content URL.\r\n\t * @param {String} partCfg.content Part content.\r\n\t * @param {Integer} partCfg.left Left position of left-top point.\r\n\t * @param {Integer} partCfg.top Top position of left-top point.\r\n\t * @param {Integer} partCfg.width Part's width.\r\n\t * @param {Integer} partCfg.height Part's height.\r\n\t * @param {Integer} partCfg.closable Identify whether part is closable or not.\r\n\t */\r\n\taddPart: function(partCfg) {\r\n\t\tif(!partCfg) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tif(!Z._parts) {\r\n\t\t\tZ._parts = [];\r\n\t\t}\r\n\t\tZ._parts.push(partCfg);\r\n\t\tZ._createPart(partCfg);\r\n\t\tZ._partChanged = true;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove a part from portal.\r\n\t * \r\n\t * @param {String} partId Part id.\r\n\t */\r\n\tremovePart: function(partId) {\r\n\t\tif(!partId) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tvar Z = this, partCfg;\r\n\t\tfor(var i = 0, len = Z._parts.length; i < len; i++) {\r\n\t\t\tpartCfg = Z._parts[i];\r\n\t\t\tif(partCfg.id == partId && partCfg.elId) {\r\n\t\t\t\tjslet('#' + partCfg.elId).close();\r\n\t\t\t\tZ._parts.splice(i, 1);\r\n\t\t\t\tZ._partChanged = true;\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tloadParts: function() {\r\n\t\tvar Z = this,\r\n\t\t\tparts = Z._parts;\r\n\t\tif(!parts) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tZ._createPart(parts[i]);\r\n\t\t}\r\n\t\tthis._partChanged = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Clear all parts.\r\n\t */\r\n\tclearParts: function() {\r\n\t\tvar parts = this._parts, partCfg;\r\n\t\tif(!parts) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tpartCfg = parts[i];\r\n\t\t\tif(partCfg.elId) {\r\n\t\t\t\tjslet('#' + elId).close();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._parts = null;\r\n\t\tthis._partChanged = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set part caption.\r\n\t * \r\n\t * @param {String} partId Part Id.\r\n\t * @param {String} caption Part caption.\r\n\t */\r\n\tsetPartCaption: function(partId, caption) {\r\n\t\tjslet.Checker.test('setPartCaption.partId', partId).required().isString();\r\n\t\tjslet.Checker.test('setPartCaption.caption', caption).isString();\r\n\t\tvar partWin = this.getPartWindow(partId);\r\n\t\tif(partWin) {\r\n\t\t\tpartWin.setCaption(caption);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set part content.\r\n\t * \r\n\t * @param {String} partId Part Id.\r\n\t * @param {String} caption Part content.\r\n\t */\r\n\tsetPartContent: function(partId, content) {\r\n\t\tjslet.Checker.test('setPartCaption.partId', partId).required().isString();\r\n\t\tvar partWin = this.getPartWindow(partId);\r\n\t\tif(partWin) {\r\n\t\t\tpartWin.setContent(content);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tgetPartWindow: function(partId) {\r\n\t\tvar parts = this._parts, partCfg;\r\n\t\tif(!parts) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tpartCfg = parts[i];\r\n\t\t\tif(partCfg.id == partId && partCfg.elId) {\r\n\t\t\t\treturn jslet('#' + partCfg.elId);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_createPart: function(partCfg) {\r\n\t\tvar Z = this,\r\n    \t\twinCfg = {type: \"Window\", animation: 'none', \r\n\t\t\t\ticonClass: partCfg.iconClass, \r\n    \t\t\tcaption: partCfg.caption, \r\n    \t\t\tisSmallHeader: true,\r\n    \t\t\twidth: partCfg.width, \r\n    \t\t\theight: partCfg.height,\r\n    \t\t\tclosable: partCfg.closable,\r\n    \t\t\tonMoving: function(x, y, deltaX, deltaY) {\r\n    \t\t\t\treturn Z._doMoving(this.el.id, x, y, deltaX, deltaY);\r\n    \t\t\t},\r\n    \t\t\tonPositionChanged: function(left, top) {\r\n    \t\t\t\tZ._doPosChanged(this.el.id, left, top);\r\n    \t\t\t},\r\n    \t\t\tonSizeChanged: function(width, height) {\r\n    \t\t\t\tZ._doSizeChanged(this.el.id, width, height);\r\n    \t\t\t},\r\n    \t\t\tonClosed: function() {\r\n    \t\t\t\tZ._doClosed(this.el.id);\r\n    \t\t\t}\r\n\t\t};\r\n        var owin = jslet.ui.createControl(winCfg, Z.el);\r\n        if(partCfg.url) {\r\n        \towin.setContent(\"<iframe src='\" + partCfg.url + \"' style='width: 100%;height: calc(100% - 5px); border:none' />\");\r\n        } else {\r\n        \tif(partCfg.content) {\r\n        \t\towin.setContent(partCfg.content);\r\n        \t}\r\n        }\r\n        owin.show(partCfg.left, partCfg.top);\r\n        partCfg.elId = owin.el.id;\r\n\t},\r\n\t\r\n\t_doMoving: function(elId, x, y, deltaX, deltaY) {\r\n\t\tvar Z = this,\r\n\t\t\tparts = Z._parts, partCfg,\r\n\t\t\tcurrPartCfg = this._getPartCfgWithElId(elId),\r\n\t\t\tleft0 = x, top0 = y,\r\n\t\t\tright0 = x + currPartCfg.width,\r\n\t\t\tbottom0 = y + currPartCfg.height,\r\n\t\t\tresult = {};\r\n\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tpartCfg = parts[i];\r\n\t\t\tif(currPartCfg === partCfg) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar left = partCfg.left || 0,\r\n\t\t\t\ttop = partCfg.top || 0,\r\n\t\t\t\tright = left + partCfg.width,\r\n\t\t\t\tbottom = top + partCfg.height,\r\n\t\t\t\tdelta = 10;\r\n\t\t\tif(deltaX !== 0 && (top >= top0 && top <= bottom0 || bottom >= top0 && bottom <= bottom0)) {\r\n\t\t\t\tvar dLeft = left0 - right,\r\n\t\t\t\t\tdRight = right0 - left;\r\n\t\t\t\tif(Math.abs(dLeft) < delta) {\r\n\t\t\t\t\tresult.deltaX = deltaX - dLeft;\r\n\t\t\t\t}\r\n\t\t\t\tif(Math.abs(dRight) < delta) {\r\n\t\t\t\t\tresult.deltaX = deltaX - dRight;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(deltaY !== 0 && (left >= left0 && left <= right0 || right >= left0 && right <= right0)) {\r\n\t\t\t\tvar dTop = top0 - bottom,\r\n\t\t\t\t\tdBottom = bottom0 - top;\r\n\t\t\t\tif(Math.abs(dTop) < delta) {\r\n\t\t\t\t\tresult.deltaY = deltaY - dTop;\r\n\t\t\t\t}\r\n\t\t\t\tif(Math.abs(dBottom) < delta) {\r\n\t\t\t\t\tresult.deltaY = deltaY - dBottom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} //end for\r\n\t\tthis._partChanged = true;\t\t\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_doPosChanged: function(elId, left, top) {\r\n\t\tvar partCfg = this._getPartCfgWithElId(elId);\r\n\t\tif(partCfg) {\r\n\t\t\tpartCfg.left = left;\r\n\t\t\tpartCfg.top = top;\r\n\t\t\tthis._partChanged = true;\t\t\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doSizeChanged: function(elId, width, height) {\r\n\t\tvar partCfg = this._getPartCfgWithElId(elId);\r\n\t\tif(partCfg) {\r\n\t\t\tpartCfg.width = width;\r\n\t\t\tpartCfg.height = height;\r\n\t\t\tthis._partChanged = true;\t\t\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doClosed: function(elId) {\r\n\t\tvar partCfg;\r\n\t\tfor(var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpartCfg = this._parts[i];\r\n\t\t\tif(partCfg.elId == elId) {\r\n\t\t\t\tthis._parts.splice(i, 1);\r\n\t\t\t\tthis._partChanged = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getPartCfgWithElId: function(elId) {\r\n\t\tvar Z = this,\r\n\t\t\tparts = Z._parts;\r\n\t\tif(!parts) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar partCfg;\r\n\t\tfor(var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tpartCfg = parts[i];\r\n\t\t\tif(partCfg.elId === elId) {\r\n\t\t\t\treturn partCfg;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Portal', jslet.ui.Portal);\r\njslet.ui.Desktop.htmlTemplate = '<div></div>';\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Side menu bar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: 'SideMenuBar', onItemClick: globalMenuItemClick, items: [\r\n *       {name: 'File', items: [\r\n *         {id: 'new', name: 'New Tab', iconClass: 'icon1' }]\r\n *       }]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id='ctrlId' />\r\n *      //js snippet:\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.SideMenuBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,hasSubTitle,onItemClick,items,popupWidth';\r\n\r\n\t\tZ._hasSubTitle = true;\r\n\t\t\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\tZ._popupWidth = null;\r\n\t\t\r\n\t\tZ._containerId = null;\r\n\t\t\r\n\t\tZ._closeTimeout = null;\r\n\t\tZ._showTimeout = null;\r\n\t\t\r\n\t\tZ.oldHeight = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify to show sub-menu title or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSubTitle True - show sub menu title, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSubTitle: function(hasSubTitle) {\r\n\t\tif(hasSubTitle === undefined) {\r\n\t\t\treturn this._hasSubTitle;\r\n\t\t}\r\n\t\tthis._hasSubTitle = hasSubTitle? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get menuItem click event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     menubarObj.onItemClick(function(menuId){});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick MenuItem click event handler.\r\n\t * @param {String} onItemClick.menuId MenuItem click event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get menu items configuration.\r\n\t * \r\n\t * @param {Object[] | undefined} items Menu items.\r\n\t * @param {String} items.id Menu item id.\r\n\t * @param {String} items.name Menu item name.\r\n\t * @param {Function} items.onClick Menu item onClick event, example: onClick: function(event) {}.\r\n\t * @param {Boolean} items.disabled True - Menu item is disabled, false - otherwise.\r\n\t * @param {Boolean} items.checked True - Menu item is checked, false - otherwise.\r\n\t * @param {String} items.iconClass Menu item icon class name.\r\n\t * @param {String} items.disabledIconClass Menu item icon disabled class name.\r\n\t * @param {String} items.itemType Menu item type, optional value: null, 'radio', 'check'.\r\n\t * @param {String} items.group Group name, only work when itemType equals 'radio'.\r\n\t * @param {Object[]} items.items Sub menu items.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tif(!items) {\r\n\t\t\tthis._items = null;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('SideMenuBar.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('SideMenuBar.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t\tif(!Z.el.id) {\r\n\t\t\tZ.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-sidemenubar')) {\r\n\t\t\tjqEl.addClass('jl-sidemenubar jl-unselectable jl-round4');\r\n\t\t}\r\n\t\tjqEl.on('mouseenter', '.jl-smb-baritem', function(event) {\r\n\t\t\tZ._clearShowTimeout();\r\n\t\t\tZ._clearCloseTimeout();\r\n\t\t\tvar omi = event.currentTarget;\r\n\t\t\tZ._showTimeout = window.setTimeout(function() {\r\n\t\t\t\tZ._showSubMenu(omi);\r\n\t\t\t}, 100);\r\n\t\t});\r\n\t\tjqEl.on('mouseleave', function() {\r\n\t\t\tZ._doMouseLeave();\r\n\t\t});\r\n\t\tvar containerId = Z.el.id + '_panel';\r\n\t\tZ._containerId = containerId;\r\n\t\tvar container = document.getElementById(containerId);\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(container);\r\n\t\t\tcontainer.id = containerId;\r\n\t\t\tcontainer.className = 'jl-smb-popup';\r\n\t\t\tjQuery(container).on('mouseleave', function() {\r\n\t\t\t\tZ._doMouseLeave();\r\n\t\t\t}).on('mouseenter', function() {\r\n\t\t\t\tZ._doMouseEnter();\r\n\t\t\t}).on('click', '.jl-smb-item', function(event) {\r\n\t\t\t\tZ._doMenuClick(event.currentTarget);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContainer = jQuery('#' + Z._containerId);\r\n\t\tjqEl.find('.jl-smb-up').off();\r\n\t\tjqEl.find('.jl-smb-down').off();\r\n\t\tjqContainer.html('<span class=\"jl-smb-box\"></span>');\r\n\t\tif(Z._popupWidth) {\r\n\t\t\tjqContainer.css('width', Z._popupWidth + 'px');\r\n\t\t}\r\n\t\tZ._itemHeight = parseFloat(jslet.ui.getCssValue('jl-smb-baritem', 'height'));\r\n\r\n\t\tvar html = '';\r\n\t\thtml += '<div class=\"jl-smb-up\"><a href=\"javascript:void(0)\"><i class=\"fa fa-chevron-up\"></i></a></div>';\r\n\t\thtml += '<div class=\"jl-smb-items\"><ul class=\"jl-smb-ul\">';\r\n\t\tvar items = Z._items || [];\r\n\t\tfor (var i = 0, cnt = items.length, item; i < cnt; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tif(item.id === null || item.id === undefined) {\r\n\t\t\t\titem.id = jslet.nextId();\r\n\t\t\t}\r\n\t\t\tif(!item.items || item.items.length === 0) {\r\n\t\t\t\tconsole.warn('Menu item: ' + item.name + ' does not have items!');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\thtml += '<li><a class=\"jl-smb-baritem\" id=\"' + item.id + '\" href=\"javascript:void(0)\">';\r\n\t\t\thtml += '<i class=\"jl-smb-icon ' + (item.iconClass || 'jl-hidden') + '\"></i>';\r\n\t\t\thtml += '<span>' + item.name + '</span><i class=\"jl-smb-arrow fa fa-chevron-right\"></i>';\r\n\t\t\thtml += '</a></li>';\r\n\t\t\tZ._createMenuItem(jqContainer, item.id, item.items);\r\n\t\t}\r\n\t\thtml += '<li class=\"jl-smb-lastbaritem\"></li></ul></div>';\r\n\t\thtml += '<div class=\"jl-smb-down\"><a href=\"javascript:void(0)\"><i class=\"fa fa-chevron-down\"></i></a></div>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.find('.jl-smb-up').on('click', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tjqEl.find('.jl-smb-down').show();\r\n\t\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\t\tvar scrTop = jqItems.scrollTop();\r\n\t\t\tscrTop -= Z._itemHeight;\r\n\t\t\tif(scrTop <= 0) {\r\n\t\t\t\tjQuery(this).hide();\r\n\t\t\t}\r\n\t\t\tjqItems.scrollTop(scrTop);\r\n\t\t}).on('mouseenter', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t});\r\n\t\tjqEl.find('.jl-smb-down').on('click', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tjqEl.find('.jl-smb-up').show();\r\n\t\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\t\tvar scrTop = jqItems.scrollTop() + Z._itemHeight;\r\n\t\t\tvar maxScrTop = jqItems[0].scrollHeight - jqItems.innerHeight();\r\n\t\t\tif(scrTop > maxScrTop) {\r\n\t\t\t\tjQuery(this).hide();\r\n\t\t\t}\r\n\t\t\tjqItems.scrollTop(scrTop);\r\n\t\t}).on('mouseenter', function() {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t});\r\n\t\tZ.resize();\r\n\t},\r\n\r\n\tcollapse: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-smb-baritem > .jl-smb-arrow').hide();\r\n\t\tjqEl.find('.jl-smb-baritem > span').hide();\r\n\t},\r\n\t\r\n\texpand: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-smb-baritem > .jl-smb-arrow').show();\r\n\t\tjqEl.find('.jl-smb-baritem > span').show();\r\n\t},\r\n\t\r\n\t_clearShowTimeout: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._showTimeout) {\r\n\t\t\twindow.clearTimeout(Z._showTimeout);\r\n\t\t\tZ._showTimeout = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_clearCloseTimeout: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._closeTimeout) {\r\n\t\t\twindow.clearTimeout(Z._closeTimeout);\r\n\t\t\tZ._closeTimeout = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getItemById: function(items, id, isFirstLevel) {\r\n\t\tvar Z = this, itemCfg;\r\n\t\tfor(var i = 0, cnt = items.length; i < cnt; i++) {\r\n\t\t\titemCfg = items[i]; \r\n\t\t\tif(itemCfg.id === id) {\r\n\t\t\t\treturn itemCfg;\r\n\t\t\t}\r\n\t\t\tif(!isFirstLevel && itemCfg.items) {\r\n\t\t\t\titemCfg = Z._getItemById(itemCfg.items, id);\r\n\t\t\t\tif(itemCfg) {\r\n\t\t\t\t\treturn itemCfg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_createMenuItem: function(jqContainer, id, items) {\r\n\t\tvar Z = this;\r\n\t\tvar html = Z._innerCreateMenuItem(id, items, 0);\r\n\t\tjqContainer.append(html);\r\n\t},\r\n\t\r\n\t_innerCreateMenuItem: function(id, items, level) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction getMenuItems(menuItems, result) {\r\n\t\t\tvar itemCfg;\r\n\t\t\tfor(var k = 0, len = menuItems.length; k < len; k++) {\r\n\t\t\t\titemCfg = menuItems[k];\r\n\t\t\t\tif(itemCfg.items) {\r\n\t\t\t\t\tgetMenuItems(itemCfg.items, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(itemCfg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar groups = [], group = null, groupItems, menuName, menuItems, itemCfg;\r\n\t\tfor (var i = 0, cnt = items.length - 1; i <= cnt; i++) {\r\n\t\t\titemCfg = items[i];\r\n\t\t\tif(itemCfg.items) {\r\n\t\t\t\tmenuItems = [];\r\n\t\t\t\tgetMenuItems(itemCfg.items, menuItems);\r\n\t\t\t\tgroups.push({id: itemCfg.id || jslet.nextId(), name: itemCfg.name, items: menuItems});\r\n\t\t\t\tgroup = null;\r\n\t\t\t} else {\r\n\t\t\t\tif(group === null) {\r\n\t\t\t\t\tgroupItems = [];\r\n\t\t\t\t\tgroup = {id: jslet.nextId(), items: groupItems, isLine: true};\r\n\t\t\t\t\tgroups.push(group);\r\n\t\t\t\t}\r\n\t\t\t\tmenuName = jQuery.trim(itemCfg.name);\r\n\t\t\t\tif(menuName === '-') {\r\n\t\t\t\t\tgroup = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tgroupItems.push(itemCfg);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar html = '<ul id=\"' + id +'_popup\" class=\"jl-smb-popup-ul ' + (level === 0? 'jl-hidden': '') + '\">';\r\n\t\tfor(var j = 0, grpCnt = groups.length - 1; j <= grpCnt; j++) {\r\n\t\t\tgroup = groups[j];\r\n\t\t\tmenuName = jQuery.trim(group.name);\r\n\t\t\thtml += '<li class=\"jl-smb-group' + (j < grpCnt? ' jl-smb-line': '') + '\">';\r\n\t\t\tif(!group.isLine) {\r\n\t\t\t\tif(Z._hasSubTitle && menuName) {\r\n\t\t\t\t\thtml += '<div class=\"jl-smb-subtitle\">' + menuName + '</div>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thtml += '<ul id=\"' + group.id +'_popup\" class=\"jl-smb-popup-ul\">';\r\n\t\t\tgroupItems = group.items;\r\n\t\t\tfor (i = 0, cnt = groupItems.length - 1; i <= cnt; i++) {\r\n\t\t\t\titemCfg = groupItems[i];\r\n\t\t\t\tid = itemCfg.id;\r\n\t\t\t\tif(!id && id !== 0) {\r\n\t\t\t\t\tid = jslet.nextId();\r\n\t\t\t\t\titemCfg.id = id;\r\n\t\t\t\t}\r\n\t\t\t\tmenuName = jQuery.trim(itemCfg.name);\r\n\t\t\t\thtml += '<li>';\r\n\t\t\t\thtml += '<a id=\"' + id + '\" class=\"jl-smb-item' + (itemCfg.disabled ? ' jl-smb-disabled': '') +\r\n\t\t\t\t  '\" href=\"javascript:void(0)\">';\r\n\t\t\t\thtml += '<span class=\"jl-smb-popup-icon ' + (itemCfg.iconClass || '') + '\"></span>' + menuName + '</a>';\r\n\t\t\t\thtml += '</li>';\r\n\t\t\t} //End for i\r\n\t\t\thtml += '</ul>';\r\n\t\t\thtml += '</li>';\r\n\t\t} //End for j\r\n\t\thtml += '</ul>';\r\n\t\treturn html;\r\n\t},\r\n\t\r\n\t_hideSubMenu: function() {\r\n\t\tthis._clearShowTimeout();\r\n\t\tjQuery('#' + this._containerId).hide();\r\n\t},\r\n\t\r\n\t_showSubMenu: function (omi) {\r\n\t\tvar Z = this,\r\n\t\t\titemCfg = Z._getItemById(Z._items, omi.id, true);\r\n\t\tif (!itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar jqPopupContainer = jQuery('#' + Z._containerId);\r\n\t\tjqPopupContainer.children().each(function(index) {\r\n\t\t\tvar jqItem = jQuery(this);\r\n\t\t\tif(jqItem.hasClass('jl-smb-box')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar isHidden = jqItem.hasClass('jl-hidden');\r\n\t\t\tif(this.id !== itemCfg.id + '_popup') {\r\n\t\t\t\tif(!isHidden) {\r\n\t\t\t\t\tjqItem.addClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(isHidden) {\r\n\t\t\t\t\tjqItem.removeClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar jqMi = jQuery(omi), \r\n\t\t\tpos = jqMi.offset(), \r\n\t\t\tposX = pos.left + jqMi.width() + 2,\r\n\t\t\tposY = pos.top;\r\n\t\tvar delta = pos.top + jqPopupContainer.outerHeight() - jQuery(window).innerHeight() - document.body.scrollTop;\r\n\t\tvar jqBox = jqPopupContainer.find('.jl-smb-box');\r\n\t\tif(delta > 0) {\r\n\t\t\tposY = posY - delta;\r\n\t\t\tjqBox.css('top', delta +'px');\r\n\t\t} else {\r\n\t\t\tjqBox.css('top', '0');\r\n\t\t}\r\n\t\tjqPopupContainer.show();\r\n\t\tjqPopupContainer.offset({left: posX, top: posY - 1});\r\n\t},\r\n\r\n\t_doMouseEnter: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._clearCloseTimeout();\r\n\t},\r\n\t\r\n\t_doMouseLeave: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._closeTimeout = window.setTimeout(function() {\r\n\t\t\twindow.clearTimeout(Z._closeTimeout);\r\n\t\t\tZ._closeTimeout = null;\r\n\t\t\tZ._hideSubMenu();\r\n\t\t}, 200);\r\n\t},\r\n\t\r\n\t_doMenuClick: function(omi) {\r\n\t\tvar Z = this,\r\n\t\t\titemCfg = Z._getItemById(Z._items, omi.id);\r\n\t\tif (itemCfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hideSubMenu();\r\n\t\tif(itemCfg.onClick) {\r\n\t\t\titemCfg.onClick(itemCfg);\r\n\t\t}\r\n\t\tif(Z._onItemClick) {\r\n\t\t\tZ._onItemClick(itemCfg);\r\n\t\t}\r\n\t},\r\n\t\r\n\tresize: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\theight = jqEl.height();\r\n\t\tif (height === Z.oldHeight){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.oldHeight = height;\r\n\t\tvar jqItems = jqEl.find('.jl-smb-items');\r\n\t\tjqItems.height(height);\r\n\t\tvar containerHeight = jqItems.innerHeight();\r\n\t\tif(jqItems[0].scrollHeight <= containerHeight) {\r\n\t\t\tjqEl.find('.jl-smb-up').hide();\r\n\t\t\tjqEl.find('.jl-smb-down').hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(jqItems.scrollTop() > 0) {\r\n\t\t\tjqEl.find('.jl-smb-up').show();\r\n\t\t}\r\n\t\tjqEl.find('.jl-smb-down').show();\r\n\t\tvar visiCnt = Math.floor(containerHeight / Z._itemHeight);\r\n\t\tvar lastItemH = containerHeight - visiCnt * Z._itemHeight;\r\n\t\tjqEl.find('.jl-smb-lastbaritem').css('height', lastItemH + 'px');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tthis.resize();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tZ._clearShowTimeout();\r\n\t\tZ._activeMenuItem = null;\r\n\t\tZ._preHoverItem = null;\r\n\t\tZ._menubarclick = null;\r\n\t\tZ._onItemClick = null;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\tjQuery('#' + Z._containerId).off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('SideMenuBar', jslet.ui.SideMenuBar);\r\njslet.ui.SideMenuBar.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Split Panel. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"SplitPanel\",direction:\"hori\",floatIndex: 1};\r\n *     //1. Binding:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *     \r\n *     //2. Binding on fly\r\n *       <div id='ctrlId'>\r\n *         <div>content1</div>\r\n *         <div>content2</div>\r\n *       </div>\r\n *     //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.SplitPanel = jslet.Class.create(jslet.ui.Control, {\r\n\tdirections: ['hori', 'vert'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,direction,floatIndex,onExpanded,onResize';\r\n\r\n\t\tZ._direction = 'hori';\r\n\r\n\t\tZ._floatIndex = 1;\r\n\t\t\r\n\t\tZ._onExpanded = null;\r\n\t\t\r\n\t\tZ._onResize = null;\r\n\t\t\r\n\t\tZ.panels = null; //Array, panel configuration, {size:100, maxSize: 100, minSize:10}\r\n\r\n\t\tZ._oldSize = 0;\r\n\t\t\r\n\t\tZ._oldHeight = 0;\r\n\t\t\r\n\t\tZ._oldWidth = 0;\r\n\t\t\r\n\t\tZ._changeFloatSizeDebounce = jslet.debounce(Z._changeFloatSize, 110);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get float panel index, only one panel can be a floating panel.\r\n\t * \r\n\t * @param {Integer | undefined} index float panel index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfloatIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._floatIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.floatIndex', index).isGTEZero();\r\n\t\tthis._floatIndex = index;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get Split direction, optional value: 'hori', 'vert'. Default value is 'hori'\r\n\t * \r\n\t * @param {String | undefined} direction optional value: 'hori', 'vert'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdirection: function(direction) {\r\n\t\tif(direction === undefined) {\r\n\t\t\treturn this._direction;\r\n\t\t}\r\n\t\tdirection = jQuery.trim(direction);\r\n\t\tvar checker = jslet.Checker.test('SplitPanel.direction', direction).required().isString();\r\n\t\tdirection = direction.toLowerCase();\r\n\t\tchecker.inArray(this.directions);\r\n\t\tthis._direction = direction;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user expand/collapse one panel.. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.onExpanded(function(panelIndex){}); \r\n\t *\r\n\t * @param {Function | undefined} onExpanded Expanded event handler.\r\n\t * @param {Integer} onExpanded.panelIndex The changing panel index.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonExpanded: function(onExpanded) {\r\n\t\tif(onExpanded === undefined) {\r\n\t\t\treturn this._onExpanded;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onExpanded', onExpanded).isFunction();\r\n\t\tthis._onExpanded = onExpanded;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after user change size of one panel. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.onResize(function(panelIndex, newSize){}); \r\n\t *\r\n\t * @param {Function | undefined} onResize Resize event handler.\r\n\t * @param {Integer} onResize.panelElement The changing panel element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonResize: function(onResize) {\r\n\t\tif(onResize === undefined) {\r\n\t\t\treturn this._onResize;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onResize', onResize).isFunction();\r\n\t\tthis._onResize = onResize;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-splitpanel')) {\r\n\t\t\tjqEl.addClass('jl-splitpanel jl-border-box jl-round5');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tZ._isHori = (Z._direction == 'hori');\r\n\t\tZ._splitterClsName = Z._isHori ? 'jl-sp-splitter-hori': 'jl-sp-splitter-vert';\r\n\t\tjqEl.off();\r\n\t\tjqEl.on('mousedown', '.' + Z._splitterClsName, Z._splitterMouseDown);\r\n\t\tjqEl.on('click', '.jl-sp-button', function(event){\r\n\t\t\tvar jqBtn = jQuery(event.currentTarget),\r\n\t\t\t\tjqSplitter = jqBtn.parent(),\r\n\t\t\t\tindex = parseInt(jqSplitter.attr('jsletindex'));\r\n\t\t\tZ.expand(index);\r\n\t\t\tevent.stopPropagation();\r\n\t\t});\r\n\t\t\r\n\t\tvar panelDivs = jqEl.find('>div'),\r\n\t\t\tlastIndex = panelDivs.length - 1;\r\n\t\tif (!Z._floatIndex && Z._floatIndex !== 0 || Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (!Z.panels) {\r\n\t\t\tZ.panels = [];\r\n\t\t}\r\n\r\n\t\tpanelDivs.each(function(k){\r\n\t\t\tvar jqPanel = jQuery(panelDivs[k]),\r\n\t\t\t\toPanel = Z.panels[k];\r\n\t\t\tif (!oPanel){\r\n\t\t\t\toPanel = {};\r\n\t\t\t\tZ.panels[k] = oPanel;\r\n\t\t\t}\r\n\r\n\t\t\tvar minSize = parseInt(jqPanel.css(Z._isHori ?'min-width': 'min-height'));\r\n\t\t\toPanel.minSize = minSize ? minSize : 5;\r\n\t\t\t\r\n\t\t\tvar maxSize = parseInt(jqPanel.css(Z._isHori ?'max-width': 'max-height'));\r\n\t\t\toPanel.maxSize = maxSize ? maxSize : Infinity;\r\n\t\t\toPanel.expanded = jqPanel.css('display') != 'none';\r\n\t\t\t\r\n\t\t\tvar size = oPanel.size;\r\n\t\t\tif (size !== null && size !== undefined) {\r\n\t\t\t\tif (Z._isHori) {\r\n\t\t\t\t\tjqPanel.outerWidth(size - 5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.outerHeight(size - 5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.width = jqEl.innerWidth();\r\n\t\tZ.height = jqEl.innerHeight();\r\n\t\t\r\n\t\tZ._splitterTracker = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z._splitterTracker);\r\n\t\tjqTracker.addClass('jl-sp-splitter-tracker');\r\n\t\tvar fixedSize = 0,\r\n\t\t\tclsName = Z._isHori ? 'jl-sp-panel-hori': 'jl-sp-panel-vert';\r\n\t\tZ.el.appendChild(Z._splitterTracker);\r\n\t\tif (Z._isHori) {\r\n\t\t\tZ._splitterTracker.style.height = '100%';\r\n\t\t} else {\r\n\t\t\tZ._splitterTracker.style.width = '100%';\r\n\t\t}\r\n\t\tvar splitterSize = parseInt(jslet.ui.getCssValue(Z._splitterClsName, Z._isHori? 'width' : 'height'));\r\n\t\tpanelDivs.after(function(k){\r\n\t\t\tvar panel = panelDivs[k],\r\n\t\t\t\tjqPanel = jQuery(panel),\r\n\t\t\t\texpanded = Z.panels[k].expanded;\r\n\t\t\tif (Z._isHori) {\r\n\t\t\t\tjqPanel.outerHeight(Z.height);\r\n\t\t\t}\r\n\t\t\tjqPanel.addClass(clsName);\r\n\r\n\t\t\tif (k === Z._floatIndex) {\r\n\t\t\t\tZ.floatPanel = panel;\r\n\t\t\t} else {\r\n\t\t\t\tif (expanded) {\r\n\t\t\t\t\tfixedSize += splitterSize + Z.panels[k].size;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.css('display', 'none');\r\n\t\t\t\t\tfixedSize += splitterSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (k === lastIndex){\r\n\t\t\t\tif (Z._isHori) {\r\n\t\t\t\t\treturn '<div style=\"clear:both;width:0px\"></div>';\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tvar id = jslet.nextId(),\r\n\t\t\t\tminBtnCls = Z._isHori ? 'fa-caret-left' : 'fa-caret-up';\r\n\t\t\t\t\r\n\t\t\tif (Z._floatIndex <= k || !expanded) {\r\n\t\t\t\tminBtnCls += Z._isHori ? ' fa-caret-right' : ' fa-caret-down';\r\n\t\t\t}\r\n\t\t\treturn '<div class=\"'+ Z._splitterClsName + ' jl-unselectable\" id = \"' + id + \r\n\t\t\t'\" jsletindex=\"'+ (k >= Z._floatIndex ? k+1: k)+ '\"><div class=\"jl-sp-button ' +  \r\n\t\t\t(Z._isHori? 'jl-sp-button-hori': 'jl-sp-button-vert')+ '\"' + \r\n\t\t\t(expanded ? '': ' jsletcollapsed=\"1\"') +'><i class=\"fa ' + \r\n\t\t\tminBtnCls  + '\" aria-hidden=\"true\"></i></div></div>';\r\n\t\t});\r\n\t\tvar splitters = jqEl.find('.' + Z._splitterClsName);\r\n\t\tif (Z._isHori) {\r\n\t\t\tsplitters.outerHeight(Z.height);\r\n\t\t}\r\n\r\n\t\tvar oSplitter;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\toSplitter = splitters[i];\r\n\t\t\toSplitter._doDragStart = Z._splitterDragStart;\r\n\t\t\toSplitter._doDragging = Z._splitterDragging;\r\n\t\t\toSplitter._doDragEnd = Z._splitterDragEnd;\r\n\t\t\toSplitter._doDragCancel = Z._splitterDragCancel;\r\n\t\t}\r\n\t\tZ._changeFloatSize();\r\n\t},\r\n\t\r\n\t_changeFloatSize: function(visiblePanel) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tpanelDivs = jqEl.find('>div'),\r\n\t\t\tfixedSize = 0,\r\n\t\t\tpanelCnt = Z.panels.length * 2;\r\n\t\t\r\n\t\tpanelDivs.each(function(k){\r\n\t\t\tif(k >= panelCnt) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqPanel = jQuery(this);\r\n\t\t\tif(this !== Z.floatPanel && (visiblePanel === this || jqPanel.css('display') != 'none')) {\r\n\t\t\t\tfixedSize += Z._isHori ? jqPanel.outerWidth(true) : jqPanel.outerHeight(true);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar floatSize, floatMinSize = 5;\r\n\t\tvar panelCfg = Z.panels[Z._floatIndex];\r\n\t\tif(panelCfg) {\r\n\t\t\tfloatMinSize = panelCfg.minSize? panelCfg.minSize: 5;\r\n\t\t}\r\n\t\tif(Z._isHori) {\r\n\t\t\tfloatSize = jqEl.innerWidth() - fixedSize - 6;\r\n\t\t\tif(floatSize < floatMinSize) {\r\n\t\t\t\tfloatSize = floatMinSize;\r\n\t\t\t}\r\n\t\t\tjQuery(Z.floatPanel).outerWidth(floatSize);\r\n\t\t} else {\r\n\t\t\tfloatSize = jqEl.innerHeight() - fixedSize - 6;\r\n\t\t\tif(floatSize < floatMinSize) {\r\n\t\t\t\tfloatSize = floatMinSize;\r\n\t\t\t}\r\n\t\t\tjQuery(Z.floatPanel).outerHeight(floatSize);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand or collapse the specified panel. Example:\r\n\t * \r\n\t *     @example\r\n\t *     splitter.expand(1, true); //Expand the second panel.\r\n\t *     splitter.expand(0, false); //Collapse the first panel.\r\n\t * \r\n\t * \r\n\t * @param {Integer} index Panel index.\r\n\t * @param {Boolean} expanded True for expanded, false otherwise.\r\n\t */\r\n\texpand: function(index, expanded, notChangeSize){\r\n\t\tvar Z = this, jqPanel, jqEl = jQuery(Z.el),\r\n\t\t\tsplitters = jqEl.find('.'+Z._splitterClsName);\r\n\t\tif (index < 0 || index > splitters.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tjqSplitter = jQuery(splitters[(index >= Z._floatIndex ? index - 1: index)]),\r\n\t\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\t\t\r\n\t\tif (expanded === undefined) {\r\n\t\t\texpanded  = jqBtn.attr('jsletcollapsed')=='1';\r\n\t\t}\r\n\t\tif (index < Z._floatIndex) {\r\n\t\t\tjqPanel = jqSplitter.prev();\r\n\t\t} else {\r\n\t\t\tjqPanel = jqSplitter.next();\r\n\t\t}\r\n\t\tvar jqIcon = jqBtn.find(':first-child');\r\n\t\tif (Z._isHori){\r\n\t\t\tif (jqIcon.hasClass('fa-caret-right')) {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-right');\r\n\t\t\t\tjqIcon.addClass('fa-caret-left');\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-left');\r\n\t\t\t\tjqIcon.addClass('fa-caret-right');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (jqIcon.hasClass('fa-caret-down')) {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-down');\r\n\t\t\t\tjqIcon.addClass('fa-caret-up');\r\n\t\t\t} else {\r\n\t\t\t\tjqIcon.removeClass('fa-caret-up');\r\n\t\t\t\tjqIcon.addClass('fa-caret-down');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (expanded){\r\n\t\t\tZ._changeFloatSize(jqPanel[0]);\r\n\t\t\tjqPanel.css('display', 'block');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '0');\r\n\t\t}else{\r\n\t\t\tjqPanel.css('display','none');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '1');\r\n\t\t\tZ._changeFloatSize();\r\n\t\t}\r\n\t\tif(notChangeSize) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.panels[index].expanded = expanded;\r\n\t\tif (Z._onExpanded) {\r\n\t\t\tZ._onExpanded.call(Z, index);\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t},\r\n\t\r\n\t_splitterMouseDown: function(event){\r\n\t\tvar pos = jQuery(this).position(),\r\n\t\t\tZ = this.parentNode.jslet;\r\n\t\tZ._splitterTracker.style.top = pos.top + 'px';\r\n\t\tZ._splitterTracker.style.left = pos.left + 'px';\r\n\t\tZ._draggingId = this.id;\r\n\t\tvar jqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\tif(jqBtn.attr('jsletcollapsed')=='1') { //Collapsed\r\n\t\t\tjqBtn.click();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t},\r\n\t\t\r\n\t_splitterDragStart: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tjqPanel = index < Z._floatIndex ? jqSplitter.prev(): jqSplitter.next(),\r\n\t\t\tcfg = Z.panels[index],\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\t\t\r\n\t\tvar panelSize = Z._isHori ? jqPanel.outerWidth(true) : jqPanel.outerHeight(true);\r\n\t\tZ._dragRangeMin = panelSize  - cfg.minSize;\r\n\t\tZ._dragRangeMax = cfg.maxSize - panelSize;\r\n\t\tvar fpMax = (Z._isHori ? jqFp.outerWidth(true) : jqFp.outerHeight(true)) - Z.panels[Z._floatIndex].minSize;\r\n\t\tif (Z._dragRangeMax > fpMax) {\r\n\t\t\tZ._dragRangeMax = fpMax;\r\n\t\t}\r\n\t\tjqTracker.show();\r\n\t},\r\n\t\r\n\t_splitterDragging: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tdelta = Math.abs(Z._isHori ? deltaX : deltaY),\r\n\t\t\texpanded;\r\n\t\t\t\r\n\t\tif (Z._isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tif (expanded && delta > Z._dragRangeMax){\r\n\t\t\tZ.endDelta = Z._dragRangeMax;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (!expanded && delta > Z._dragRangeMin){\r\n\t\t\tZ.endDelta = Z._dragRangeMin;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tZ.endDelta = Math.abs(Z._isHori ? deltaX : deltaY);\r\n\t\tvar pos = jqTracker.offset();\r\n\t\tif (Z._isHori) {\r\n\t\t\tpos.left = x;\r\n\t\t} else {\r\n\t\t\tpos.top = y;\r\n\t\t}\r\n\t\tjqTracker.offset(pos);\r\n\t},\r\n\t\r\n\t_splitterDragEnd: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z._draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tjqPanel = index < Z._floatIndex ? jqSplitter.prev(): jqSplitter.next(),\r\n\t\t\texpanded,\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\r\n\t\tif (Z._isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tvar delta = Z.endDelta * (expanded ? 1: -1);\r\n\t\t\r\n\t\tif (Z._isHori) {\r\n\t\t\tif(delta < 0) {\r\n\t\t\t\tjqPanel.outerWidth(jqPanel.outerWidth() + delta);\r\n\t\t\t\tjqFp.outerWidth(jqFp.outerWidth() - delta);\r\n\t\t\t} else {\r\n\t\t\t\tjqFp.outerWidth(jqFp.outerWidth() - delta);\r\n\t\t\t\tjqPanel.outerWidth(jqPanel.outerWidth() + delta);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(delta < 0) { \r\n\t\t\t\tjqPanel.outerHeight(jqPanel.outerHeight() + delta);\r\n\t\t\t\tjqFp.outerHeight(jqFp.outerHeight() - delta);\r\n\t\t\t} else {\r\n\t\t\t\tjqFp.outerHeight(jqFp.outerHeight() - delta);\r\n\t\t\t\tjqPanel.outerHeight(jqPanel.outerHeight() + delta);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z._onResize) {\r\n\t\t\tZ._onResize.call(Z, jqPanel[0]);\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t_splitterDragCancel: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z._splitterTracker);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tcurrWidth = jqEl.innerWidth(),\r\n\t\t\tcurrHeight = jqEl.innerHeight();\r\n\t\tif (Z._isHori && currWidth !== Z._oldWidth ||\r\n\t\t\t!Z._isHori && currHeight !== Z._oldHeight) {\r\n\t\t\tZ._changeFloatSizeDebounce();\r\n\t\t}\r\n\t\tif(Z._oldWidth != currWidth || Z._oldHeight != currHeight) {\r\n\t\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t\t}\r\n\t\tZ._oldWidth = currWidth;\r\n\t\tZ._oldHeight = currHeight;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._splitterTracker = null;\r\n\t\tZ._draggingId = null;\r\n\t\tZ.floatPanel = null;\r\n\t\tvar splitters = jqEl.find('.'+Z._splitterClsName);\r\n\t\tsplitters.off('mousedown', Z._splitterMouseDown);\r\n\t\tZ._splitterMouseDown = null;\r\n\t\tvar item;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\titem = splitters[i];\r\n\t\t\tjslet.ui.dnd.unbindControl(item);\r\n\t\t\titem._doDragStart = null;\r\n\t\t\titem._doDragging = null;\r\n\t\t\titem._doDragEnd = null;\r\n\t\t\titem._doDragCancel = null;\r\n\t\t}\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('SplitPanel', jslet.ui.SplitPanel);\r\njslet.ui.SplitPanel.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * TabControl. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type: \"TabControl\", \r\n *       activeIndex: 1, \r\n *       onCreateContextMenu: doCreateContextMenu, \r\n *       items: [\r\n *         {header: \"one\", userIFrame: true, url: \"http://www.google.com\", iconClass: \"tabIcon\"},\r\n *         {header: \"two\", closable: true, divId: \"p2\"},\r\n *         {header:\"three\",closable:true,divId:\"p3\"},\r\n *       ]};\r\n *     //1. Binding:\r\n *     <div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\" />\r\n *\r\n *     //2. Binding on fly\r\n *     <div id='ctrlId' />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.TabControl = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,activeIndex,newable,closable,items,isFixedHeight,hasContent,onAddTabItem,onActiveIndexChanged,onRemoveTabItem,onCreateContextMenu,onContentLoading,onContentLoaded,enableLoading';\r\n\t\t\r\n\t\tZ._activeIndex = -1;\r\n\t\t\r\n\t\tZ._newable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._onActiveIndexChanged = null;\r\n\t\t\r\n\t\tZ._onAddTabItem = null;\r\n\t\t\r\n\t\tZ._onRemoveTabItem = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ._items = [];\r\n\t\t\r\n\t\tZ._hasContent = true;\r\n\t\t\r\n\t\tZ._isFixedHeight = false;\r\n\t\t\r\n\t\tZ._itemsWidth = [];\r\n\t\tZ._containerWidth = 0;\r\n\t\tZ._ready = false;\r\n\t\t\r\n\t\tZ._leftIndex = 0;\r\n\t\tZ._rightIndex = 0;\r\n\t\tZ._maxHeaderWidth = 160;\r\n\t\tZ._tabControlWidth = jQuery(Z.el).width();\r\n\t\tZ._tabControlHeight = jQuery(Z.el).height();\r\n\t\tZ._contextItemIndex = 0;\r\n\t\t\r\n\t\tZ._onContentLoading = null;\r\n\t\tZ._onContentLoaded = null;\r\n\t\t\r\n\t\tZ._enableLoading = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get active tab item index.\r\n\t * \r\n\t * @param {Integer | undefined} index active tabItem index.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tactiveIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._activeIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.activeIndex', index).isGTEZero();\r\n\t\tif(this._ready) {\r\n\t\t\tthis._chgActiveIndex(index);\r\n\t\t} else {\r\n\t\t\tthis._activeIndex = index;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get active tab item id.\r\n\t * \r\n\t * @param {String | undefined} itemId active tabItem id.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tactiveItemId: function(itemId) {\r\n\t\tvar Z = this;\r\n\t\tif(itemId === undefined) {\r\n\t\t\tvar itemCfg = Z._items[this._activeIndex];\r\n\t\t\tif(itemCfg) {\r\n\t\t\t\treturn itemCfg.id;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.activeItemId', itemId).isString();\r\n\t\tif(this._ready) {\r\n\t\t\tvar items = Z._items;\r\n\t\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\t\tif(itemId === items[i].id) {\r\n\t\t\t\t\tthis._chgActiveIndex(i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get active tab item configuration.\r\n\t * \r\n\t * @return {jslet.ui.TabItem}\r\n\t */\r\n\tactiveItem: function() {\r\n\t\tvar items = this._items;\r\n\t\tif(items && items.length > 0) {\r\n\t\t\treturn this._items[this._activeIndex || 0];\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether user can add tab item on fly.\r\n\t * \r\n\t * @param {Boolean | undefined} newable True(default) - user can add tab item on fly, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tnewable: function(newable) {\r\n\t\tif(newable === undefined) {\r\n\t\t\treturn this._newable;\r\n\t\t}\r\n\t\tthis._newable = newable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if user can close tab item on fly.\r\n\t * \r\n\t * @param {Boolean | undefined} closable True(default) - user can close tab item on fly, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if the TabControl has content panel. Sometimes, you only need the TabControl which is without content panel. \r\n\t * \r\n\t * @param {Boolean | undefined} hasContent True(default) - TabControl has content panel, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\thasContent: function(hasContent) {\r\n\t\tif(hasContent === undefined) {\r\n\t\t\treturn this._hasContent;\r\n\t\t}\r\n\t\tthis._hasContent = hasContent? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the height of TabPanel is same. \r\n\t * \r\n\t * @param {Boolean | undefined} isFixedHeight True - the height of TabPanel is same, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tisFixedHeight: function(isFixedHeight) {\r\n\t\tif(isFixedHeight === undefined) {\r\n\t\t\treturn this._isFixedHeight;\r\n\t\t}\r\n\t\tthis._isFixedHeight = isFixedHeight? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether enable loading icon when open a tab panel. \r\n\t * \r\n\t * @param {Boolean | undefined} enableLoading True - enable loading icon, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean} \r\n\t */\r\n\tenableLoading: function(enableLoading) {\r\n\t\tif(enableLoading === undefined) {\r\n\t\t\treturn this._enableLoading;\r\n\t\t}\r\n\t\tthis._enableLoading = enableLoading? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after add a new tab item.\r\n\t * Pattern: \r\n\t *   function(){}\r\n\t *   \r\n\t * @param {Function | undefined} onAddTabItem tab item added event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonAddTabItem: function(onAddTabItem) {\r\n\t\tif(onAddTabItem === undefined) {\r\n\t\t\treturn this._onAddTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onAddTabItem', onAddTabItem).isFunction();\r\n\t\tthis._onAddTabItem = onAddTabItem;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user toggle tab item.\r\n\t * Pattern: \r\n\t *   function(oldIndex, newIndex){}\r\n\t *   //oldIndex: Integer\r\n\t *   //newIndex: Integer\r\n\t *   \r\n\t * @param {Function | undefined} onActiveIndexChanged tab item active event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonActiveIndexChanged: function(onActiveIndexChanged) {\r\n\t\tif(onActiveIndexChanged === undefined) {\r\n\t\t\treturn this._onActiveIndexChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onActiveIndexChanged', onActiveIndexChanged).isFunction();\r\n\t\tthis._onActiveIndexChanged = onActiveIndexChanged;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired after remove a tab item.\r\n\t * Pattern: \r\n\t *  function(tabItemIndex, active){}\r\n\t *  //tabItemIndex: Integer\r\n\t *  //active: Boolean Identify if the removing item is active\r\n\t *  //return: Boolean, false - cancel removing tab item, true - remove tab item. \r\n\t *   \r\n\t * @param {Function | undefined} onRemoveTabItem tab item removed event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRemoveTabItem: function(onRemoveTabItem) {\r\n\t\tif(onRemoveTabItem === undefined) {\r\n\t\t\treturn this._onRemoveTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onRemoveTabItem', onRemoveTabItem).isFunction();\r\n\t\tthis._onRemoveTabItem = onRemoveTabItem;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired before show context menu.\r\n\t * Pattern: \r\n\t *   function(menuItems){}\r\n\t *   //menuItems: Array of MenuItem, see menu item configuration in jslet.ui.menu.js.\r\n\t *   \r\n\t * @param {Function | undefined} onCreateContextMenu creating context menu event handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Fired before loading content of tab item;\r\n\t * Pattern: \r\n\t *   function(contentId, itemCfg){}\r\n\t *   //contentId: {String} the content element's id.\r\n\t *   //itemCfg: {Plan Object} tab item config\r\n\t *   \r\n\t * @param {Function | undefined} onContentLoading before loading tab panel content handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonContentLoading: function(onContentLoading) {\r\n\t\tif(onContentLoading === undefined) {\r\n\t\t\treturn this._onContentLoading;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onContentLoading', onContentLoading).isFunction();\r\n\t\tthis._onContentLoading = onContentLoading;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Fired after loading content of tab item;\r\n\t * Pattern: \r\n\t *   function(contentId, itemCfg){}\r\n\t *   //contentId: {String} the content element's id.\r\n\t *   //itemCfg: {Plan Object} tab item config\r\n\t *   \r\n\t * @param {Function | undefined} onContentLoading after loading tab panel content handler.\r\n\t * \r\n\t * @return {this | Function} \r\n\t */\r\n\tonContentLoaded: function(onContentLoaded) {\r\n\t\tif(onContentLoaded === undefined) {\r\n\t\t\treturn this._onContentLoaded;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onContentLoaded', onContentLoaded).isFunction();\r\n\t\tthis._onContentLoaded = onContentLoaded;\r\n\t\treturn this;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Set or get tab item configuration.\r\n\t * \r\n\t * @param {jslet.ui.TabItem[] | undefined} items tab items.\r\n\t * \r\n\t * @return {this | jslet.ui.TabItem[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('TabControl.items.header', item.header).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(this);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tfunction innerAdd(itemCfg) {\r\n\t\t\tif (!itemCfg) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ.addTabItem(itemCfg);\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ.activeIndex(Z._items.length - 1);\r\n\t\t}\r\n\t\t\r\n\t\tZ._createContextMenu();\r\n\r\n\t\tvar\ttemplate = [\r\n\t\t\t'<div class=\"jl-tab-header jl-unselectable\"><div class=\"jl-tab-container jl-unselectable\"><ul class=\"jl-tab-list\">',\r\n\t\t\tZ._newable ? '<li><a href=\"javascript:;\" class=\"jl-tab-inner\"><span class=\"jl-tab-new\">+</span></a></li>' : '',\r\n\t\t\t'</ul></div><a class=\"jl-tab-left jl-hidden\"><span class=\"jl-nav-btn fa fa-arrow-circle-left\"></span></a><a class=\"jl-tab-right jl-hidden\"><span class=\"jl-nav-btn fa fa-arrow-circle-right\"></span></a></div>',\r\n\t\t\t'<div class=\"jl-tab-panels jl-round5 jl-hidden' + (Z._isFixedHeight ? ' jl-tab-panels-fixed': '') + ' \"',\r\n\t\t\tZ._hasContent? '': ' style=\"border: 0;height:0\"',\r\n\t\t\t'></div>'];\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-tabcontrol')) {\r\n\t\t\tjqEl.addClass('jl-tabcontrol jl-round5');\r\n\t\t}\r\n\t\tjqEl.html(template.join(''));\r\n\t\tif (Z._newable) {\r\n\t\t\tvar oul = jqEl.find('.jl-tab-list')[0];\r\n\t\t\tvar newTab = oul.childNodes[oul.childNodes.length - 1];\r\n\t\t\tZ._newTabItem = newTab;\r\n\t\t\t\r\n\t\t\tnewTab.onclick = function () {\r\n\t\t\t\tif (!Z._onAddTabItem) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar\titemCfg = Z._onAddTabItem.call(Z);\r\n\t\t\t\tif(jslet.isPromise(itemCfg)) {\r\n\t\t\t\t\titemCfg.done(function(result) {\r\n\t\t\t\t\t\tinnerAdd(result);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinnerAdd(itemCfg);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar jqNavBtn = jqEl.find('.jl-tab-left');\r\n\t\t\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex - 1);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn = jqEl.find('.jl-tab-right');\r\n\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex + 1);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tif (Z._items && Z._items.length > 0) {\r\n\t\t\tvar oitem, \r\n\t\t\t\tcnt = Z._items.length;\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\toitem = Z._items[i];\r\n\t\t\t\tZ._renderTabItem(oitem);\r\n\t\t\t}\r\n\t\t\tZ._activeIndex = 0;\r\n\t\t}\r\n\t\tZ._calcItemsWidth();\r\n\t\tZ._ready = true;\r\n\t\tZ._chgActiveIndex(Z._activeIndex);\r\n\t\tZ._checkTabItemCount();\r\n\t},\r\n\r\n\taddItem: function (itemCfg) {\r\n\t\tthis._items[this._items.length] = itemCfg;\r\n\t},\r\n\r\n\t/**\r\n\t * Change tab item's header.\r\n\t * \r\n\t * @param {Integer} index - tab item index.\r\n\t * @param {String} header - tab item header.\r\n\t */\r\n\ttabHeader: function(index, header) {\r\n\t\tjslet.Checker.test('tabHeader#index', index).isGTEZero();\r\n\t\tjslet.Checker.test('tabHeader#label', header).required().isString();\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\titemCfg.header = header;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar panelContainer = jqEl.find('.jl-tab-list')[0];\r\n\t\tvar nodes = panelContainer.childNodes;\r\n\t\tjQuery(nodes[index]).find('.jl-tab-title').html(header);\r\n\t\tZ._calcItemsWidth();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable tab item.\r\n\t * \r\n\t * @param {Integer} index - tab item index.\r\n\t * @param {Boolean} disabled - true - disabled, false - otherwise.\r\n\t */\r\n\ttabDisabled: function(index, disabled) {\r\n\t\tjslet.Checker.test('tabDisabled#index', index).isGTEZero();\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(index == Z._activeIndex) {\r\n\t\t\tconsole.warn('Cannot set current tab item to disabled.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.disabled(disabled);\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqPanels = jqEl.find('.jl-tab-panels'),\r\n\t\t\tpanelContainer = jqPanels[0],\r\n\t\t\tnodes = panelContainer.childNodes,\r\n\t\t\tjqItem = jQuery(nodes[index]);\r\n\t\tif(disabled) {\r\n\t\t\tjqItem.addClass('jl-tab-disabled');\r\n\t\t} else {\r\n\t\t\tjqItem.removeClass('jl-tab-disabled');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_checkTabItemCount: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqTabPanels = jQuery(Z.el).find('.jl-tab-panels');\r\n\t\tif(!Z._items || Z._items.length === 0) {\r\n\t\t\tif(!jqTabPanels.hasClass('jl-hidden')) {\r\n\t\t\t\tjqTabPanels.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tjqTabPanels.removeClass('jl-hidden');\r\n\r\n\t\t} \r\n\t},\r\n\t\r\n\t/*\r\n\t * Change active tab item.\r\n\t * \r\n\t * @param {Integer} index Tab item index which will be toggled to.\r\n\t */\r\n\t_chgActiveIndex: function (index) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction innerChgActiveIndex() {\r\n\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\toli, \r\n\t\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\t\tnodes = oul.childNodes,\r\n\t\t\t\tcnt = nodes.length - (Z._newable ? 2 : 1);\r\n\t\r\n\t\t\tvar itemContainer = jqEl.find('.jl-tab-panels')[0],\r\n\t\t\t\titem,\r\n\t\t\t\titems = itemContainer.childNodes;\r\n\t\t\tfor (var i = 0; i <= cnt; i++) {\r\n\t\t\t\toli = jQuery(nodes[i]);\r\n\t\t\t\titem = items[i];\r\n\t\t\t\tif (i === index) {\r\n\t\t\t\t\toli.addClass('jl-tab-active');\r\n\t\t\t\t\titem.style.display = 'block';\r\n\t\t\t\t\t//To fix Chrome bug: scrollbar disappeared.\r\n\t\t\t\t\tvar oIframe = item.childNodes[0];\r\n\t\t\t\t\tif(oIframe.tagName == 'IFRAME') {\r\n\t\t\t\t\t\titem.style.overflow = 'hidden';\r\n\t\t\t\t\t\tvar oldHeight = oIframe.style.height;\r\n\t\t\t\t\t\toIframe.style.height = \"0\";\r\n\t\t\t\t\t\t/* jshint ignore:start */\r\n\t\t\t\t\t\toIframe.scrollWidth;\r\n\t\t\t\t\t\t/* jshint ignore:end */\r\n\t\t\t\t\t\toIframe.style.height = oldHeight || \"100%\";\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\toli.removeClass('jl-tab-active');\r\n\t\t\t\t\titem.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ._activeIndex = index;\r\n\t\t\tif(index < Z._leftIndex || index >= Z._rightIndex) {\r\n\t\t\t\tZ._setVisiTabItems(null, Z._activeIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg || itemCfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (index != Z._activeIndex && Z._onActiveIndexChanged) {\r\n\t\t\tvar result = Z._onActiveIndexChanged.call(Z, Z._activeIndex, index);\r\n\t\t\tif(jslet.isPromise(result)) {\r\n\t\t\t\tresult.done(function(canChanged) {\r\n\t\t\t\t\tif(canChanged === undefined || canChanged) {\r\n\t\t\t\t\t\tinnerChgActiveIndex();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(result === undefined || result) {\r\n\t\t\t\t\tinnerChgActiveIndex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tinnerChgActiveIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getTabItemCfg: function(index) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._items.length <= index) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn Z._items[index];\r\n\t},\r\n\t\r\n\t_calcItemsWidth: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl =jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tab-list').children();\r\n\t\tZ._itemsWidth = [];\r\n\t\tZ._totalItemsWidth = 0;\r\n\t\tnodes.each(function(index){\r\n\t\t\tvar w = jQuery(this).outerWidth() + 5;\r\n\t\t\tZ._itemsWidth[index] = w;\r\n\t\t\tZ._totalItemsWidth += w;\r\n\t\t});\r\n\r\n\t\tZ._containerWidth = jqEl.find('.jl-tab-container').innerWidth();\r\n\t\tZ._setNavBtnVisible();\r\n\t},\r\n\t\r\n\t_setVisiTabItems: function(leftIndex, rightIndex) {\r\n\t\tvar Z = this, w, i, len;\r\n\t\tif(!leftIndex && leftIndex !== 0) {\r\n\t\t\tif(!rightIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._newable) {\r\n\t\t\t\trightIndex++;\r\n\t\t\t}\r\n\t\t\tw = Z._itemsWidth[rightIndex];\r\n\t\t\tZ._leftIndex = rightIndex;\r\n\t\t\tfor(i = rightIndex - 1; i >= 0; i--) {\r\n\t\t\t\tw += Z._itemsWidth[i];\r\n\t\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\t\tZ._leftIndex = i + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ._leftIndex = i;\r\n\t\t\t}\r\n\t\t\tleftIndex = Z._leftIndex;\r\n\t\t} else {\r\n\t\t\tZ._leftIndex = leftIndex;\r\n\t\t}\r\n\t\tw = 0;\r\n\t\tZ._rightIndex = leftIndex;\r\n\t\tfor(i = leftIndex, len = Z._itemsWidth.length; i < len; i++) {\r\n\t\t\tw += Z._itemsWidth[i];\r\n\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\tZ._rightIndex = i - 1;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tZ._rightIndex = i;\r\n\t\t}\r\n\t\tvar leftPos = 0;\r\n\t\tfor(i = 0; i < Z._leftIndex; i++) {\r\n\t\t\tleftPos += Z._itemsWidth[i];\r\n\t\t}\r\n\t\tleftPos += 5;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-tab-container').scrollLeft(jsletlocale.isRtl ? 50000 - leftPos: leftPos);\r\n\t\tZ._setNavBtnVisible();\r\n\t},\r\n\t\r\n\t_setNavBtnVisible: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqBtnLeft = jqEl.find('.jl-tab-left'),\r\n\t\t\tisHidden = jqBtnLeft.hasClass('jl-hidden');\r\n\t\tif(Z._leftIndex > 0 && Z._totalItemsWidth > Z._containerWidth) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnLeft.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnLeft.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqBtnRight = jqEl.find('.jl-tab-right');\r\n\t\tvar totalCnt = Z._itemsWidth.length;\r\n\t\tisHidden = jqBtnRight.hasClass('jl-hidden');\r\n\t\tif(Z._rightIndex < totalCnt - 1 && Z._totalItemsWidth > Z._containerWidth) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnRight.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnRight.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeader: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tcanClose = Z._closable && itemCfg.closable,\r\n\t\t\ttmpl = [];\r\n\t\t\r\n\t\tif(Z._enableLoading) {\r\n\t\t\ttmpl.push('<div class=\"jl-tab-loading jl-hidden\"><i class=\"fa fa-spinner fa-pulse fa-fw\"></i></div>');\r\n\t\t}\r\n\t\ttmpl.push('<a href=\"javascript:;\" class=\"jl-tab-inner' + (canClose? ' jl-tab-close-loc': '') + \r\n\t\t        '\" onclick=\"javascript:this.blur();\" title=\"' + itemCfg.header + '\">');\r\n\r\n\t\ttmpl.push('<span class=\"jl-tab-icon ' + (itemCfg.iconClass || '') + '\"></span>');\r\n\r\n\t\ttmpl.push('<span class=\"jl-tab-title\">');\r\n\t\ttmpl.push(itemCfg.header);\r\n\t\ttmpl.push('</span>');\r\n\t\ttmpl.push('<span class=\"fa fa-times close jl-tab-close' + (!canClose || itemCfg.disabled? ' jl-hidden': '') + '\"></span><span style=\"clear:both\"></span>');\r\n\t\ttmpl.push('</a>');\r\n\t\tif(!itemCfg.id && itemCfg.id !== 0) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar oli = document.createElement('li');\r\n\t\toli.id = itemCfg.id + '_h';\r\n\t\tif(itemCfg.disabled) {\r\n\t\t\tjQuery(oli).addClass('jl-tab-disabled');\r\n\t\t}\r\n\t\toli.innerHTML = tmpl.join('');\r\n\r\n\t\tif (Z._newable) {\r\n\t\t\tvar lastNode = parent.childNodes[parent.childNodes.length - 1];\r\n\t\t\tparent.insertBefore(oli, lastNode);\r\n\t\t} else {\r\n\t\t\tparent.appendChild(oli);\r\n\t\t}\r\n\t\toli.jslet = Z;\r\n\t\tjQuery(oli).on('click', Z._changeTabItem);\r\n\r\n\t\tif (canClose) {\r\n\t\t\tjQuery(oli).find('.jl-tab-close').click(Z._doCloseBtnClick);\r\n\t\t}\r\n\t\tif(Z.contextMenu && !itemCfg.disabled) {\r\n\t\t\toli.oncontextmenu = function (event) {\r\n\t\t\t\tvar k = 0;\r\n\t\t\t\tvar items = jQuery(Z.el).find('.jl-tab-list li').each(function() {\r\n\t\t\t\t\tif(this === event.currentTarget) {\r\n\t\t\t\t\t\tZ._contextItemIndex = k;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tk++;\r\n\t\t\t\t});\r\n\t\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\r\n\t_changeTabItem: function (event) {\r\n\t\tvar nodes = this.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == this) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet._chgActiveIndex(index);\r\n\t},\r\n\r\n\t_doCloseBtnClick: function (event) {\r\n\t\tvar oli = this.parentNode.parentNode,\r\n\t\t\tnodes = oli.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == oli) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\toli.jslet.removeTabItem(index);\r\n\t\tevent.preventDefault();\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_createBody: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqDiv = jQuery(document.createElement('div'));\r\n\t\tif (!jqDiv.hasClass('jl-tab-panel')) {\r\n\t\t\tjqDiv.addClass('jl-tab-panel');\r\n\t\t}\r\n\t\tparent.appendChild(jqDiv[0]);\r\n\t\t\r\n\t\tif (itemCfg.content || itemCfg.contentId) {\r\n\t\t\tvar ocontent = itemCfg.content;\r\n\t\t\tif(itemCfg.contentId) {\r\n\t\t\t\tocontent = jQuery('#'+itemCfg.contentId)[0];\r\n\t\t\t}\r\n\t\t\tif (ocontent) {\r\n\t\t\t\tjqDiv.html('');\r\n\t\t\t\tjqDiv.append(ocontent);\r\n\t\t\t\tjqDiv.children().show();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar url = itemCfg.url;\r\n\t\tif (url) {\r\n\t\t\turl = jslet.urlUtil.addParam(url, {jlTabItemId: itemCfg.id});\r\n\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\turl = jslet.urlUtil.addParam(url, {debounce: true});\r\n\t\t\t}\r\n\t\t\titemCfg.url = url;\r\n\t\t\tif (itemCfg.useIFrame || itemCfg.useIFrame === undefined) {\r\n\t\t\t\tvar h = itemCfg.height;\r\n\t\t\t\tif(h && !jslet.isString(h)) {\r\n\t\t\t\t\th += 'px';\r\n\t\t\t\t}\r\n\t\t\t\th = h ? h: '100%';\r\n\t\t\t\t\r\n\t\t\t\tvar id = itemCfg.id || jslet.nextId(); \r\n\t\t\t\tvar s = '<iframe id=\"' + id + '\" scrolling=\"yes\" frameborder=\"0\" allowtransparency=\"true\" src=\"' + \r\n\t\t\t\t\turl + \r\n\t\t\t\t'\" style=\"background-color:transparent;width: 100%;' + (Z._isFixedHeight? '': 'height:' + h) + '\"' +\r\n\t\t\t\t(Z._isFixedHeight? 'class=\"jl-tab-frame-fixed\"': '') + '></iframe>';\r\n\t\t\t\tjqDiv.html(s);\r\n\t\t\t\titemCfg.contentId = id;\r\n\t\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\t\tif(Z._enableLoading) {\r\n\t\t\t\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\t\t\t\tjqHead = jqEl.find('.jl-tab-header');\r\n\t\t\t\t\t\tjqHead.find('#' + id + '_h .jl-tab-loading').removeClass('jl-hidden');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(Z._onContentLoading) {\r\n\t\t\t\t\t\tZ._onContentLoading.call(Z, id, itemCfg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Add tab item dynamically.\r\n\t * \r\n\t * @param {Object} newItemCfg Tab item configuration\r\n\t * @param {Boolean} noDuplicate Identify if the same \"tabItem.id\" can be added or not, default is true. \r\n\t */\r\n\taddTabItem: function (newItemCfg, noDuplicate) {\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\tnewId = newItemCfg.id;\r\n\t\tif(!newId) {\r\n\t\t\tnewId = jslet.nextId();\r\n\t\t\tnewItemCfg.id = newId;\r\n\t\t}\r\n\t\tvar itemCfg;\r\n\t\tif((noDuplicate === undefined || noDuplicate) && newId) {\r\n\t\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\t\titemCfg = tabItems[i];\r\n\t\t\t\tif(newId === itemCfg.id) {\r\n\t\t\t\t\tif(itemCfg.url !== newItemCfg.url) {\r\n\t\t\t\t\t\titemCfg.url = newItemCfg.url;\r\n\t\t\t\t\t\tZ.reloadTabItem(itemCfg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ.activeIndex(i);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttabItems.push(newItemCfg);\r\n\t\tZ._renderTabItem(newItemCfg);\r\n\t\tZ._calcItemsWidth();\r\n\t\tZ._chgActiveIndex(tabItems.length - 1);\r\n\t\tZ._checkTabItemCount();\r\n\t},\r\n\r\n\thideLoading: function(tabItemId) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(Z._enableLoading) {\r\n\t\t\tjqEl.find('#' + tabItemId + '_h .jl-tab-loading').addClass('jl-hidden');\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * set the specified tab item to loaded state. It will fire the \"onContentLoaded\" event.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t */\r\n\tsetContentLoadedState: function(tabItemId) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.hideLoading(tabItemId);\r\n\t\tif(!Z._onContentLoaded) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\ttabItems = Z._items,\r\n\t\t\tcontentId = null,\r\n\t\t\titemCfg;\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(tabItemId === itemCfg.id) {\r\n\t\t\t\tcontentId = itemCfg.contentId;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!contentId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._onContentLoaded.call(Z, contentId, itemCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set tab item to changed state or not.\r\n\t * \r\n\t * @param {String} tabItemId - tab item id.\r\n\t * @param {Boolean} changed - changed state.\r\n\t */\r\n\tsetContentChangedState: function(tabItemId, changed) {\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\titemCfg,\r\n\t\t\tidx = -1;\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(tabItemId === itemCfg.id) {\r\n\t\t\t\tidx = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(idx < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.changed = changed;\r\n\t\tvar header = itemCfg.header,\r\n\t\t\thasChangedFlag = (header.charAt(0) === '*');\r\n\t\tif(changed) {\r\n\t\t\tif(!hasChangedFlag) {\r\n\t\t\t\theader = '*' + header;\r\n\t\t\t\tZ.tabHeader(idx, header);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(hasChangedFlag) {\r\n\t\t\t\theader = header.substring(1);\r\n\t\t\t\tZ.tabHeader(idx, header);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify which exists changed tab item or not.\r\n\t */\r\n\thasChanged: function(tabIndex) {\r\n\t\tjslet.Checker.test('TabControl.hasChanged#tabIndex', tabIndex).isGTEZero();\r\n\t\tvar Z = this,\r\n\t\t\ttabItems = Z._items,\r\n\t\t\titemCfg,\r\n\t\t\tidx = -1,\r\n\t\t\tnoTabIndex = (tabIndex === undefined || tabIndex === null);\r\n\t\tfor(var i = 0, len = tabItems.length; i < len; i++) {\r\n\t\t\titemCfg = tabItems[i];\r\n\t\t\tif(itemCfg.changed) {\r\n\t\t\t\tif(noTabIndex || tabIndex === i) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_renderTabItem: function(itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tpanelContainer = jqEl.find('.jl-tab-panels')[0];\r\n\t\tif(!itemCfg.id) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tZ._createHeader(oul, itemCfg);\r\n\t\tZ._createBody(panelContainer, itemCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove tab item with tabItemIndex\r\n\t * \r\n\t * @param {Integer} tabItemIndex Tab item index\r\n\t */\r\n\tremoveTabItem: function (tabItemIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (tabItemIndex >= Z._items.length || tabItemIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar itemCfg = Z._items[tabItemIndex];\r\n\t\tif(itemCfg.changed) {\r\n            jslet.ui.confirm(jsletlocale.TabControl.contentChanged, jsletlocale.MessageBox.confirm, function(button){\r\n\t\t\t\tif(button === 'ok') {\r\n\t\t\t\t\tZ._innerRemoveTabItem(tabItemIndex);\r\n\t\t\t\t}\r\n            });\r\n\t\t} else {\r\n\t\t\tZ._innerRemoveTabItem(tabItemIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_innerRemoveTabItem: function (tabItemIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tnodes = oul.childNodes,\r\n\t\t\toli = jQuery(nodes[tabItemIndex]),\r\n\t\t\tactive = oli.hasClass('jl-tab-active');\r\n\t\t\r\n\t\tfunction innerRemove() {\r\n\t\t\toli.find('.jl-tab-close').hide();\r\n\t\t\toli.animate({width:'toggle'},200, function() {\r\n\t\t\t\tvar elItem = oli[0]; \r\n\t\t\t\telItem.oncontextmenu = null;\r\n\t\t\t\toul.removeChild(elItem);\r\n\t\t\t\tZ._items.splice(tabItemIndex, 1);\r\n\t\t\t\tvar panelContainer = jqEl.find('.jl-tab-panels')[0];\r\n\t\t\t\tnodes = panelContainer.childNodes;\r\n\t\t\t\tvar tabPanel = nodes[tabItemIndex];\r\n\t\t\t\tpanelContainer.removeChild(tabPanel);\r\n\t\t\t\tZ._calcItemsWidth();\r\n\t\t\t\tZ._checkTabItemCount();\r\n\t\t\t\tif (active) {\r\n\t\t\t\t\tvar cnt = nodes.length - (Z._newable ? 2 : 1);\r\n\t\t\t\t\ttabItemIndex = Z._getNextValidIndex(tabItemIndex, tabItemIndex >= cnt);\r\n\t\t\t\t\tif (tabItemIndex >= 0) {\r\n\t\t\t\t\t\tZ._chgActiveIndex(tabItemIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tZ._activeIndex = -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(Z._activeIndex > tabItemIndex) {\r\n\t\t\t\t\t\tZ._activeIndex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._onRemoveTabItem) {\r\n\t\t\tvar result = Z._onRemoveTabItem.call(Z, Z._items[tabItemIndex], active);\r\n\t\t\tif(jslet.isPromise(result)) {\r\n\t\t\t\tresult.done(function(canRemoved) {\r\n\t\t\t\t\tif (canRemoved === undefined || canRemoved) {\r\n\t\t\t\t\t\tinnerRemove();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (result === undefined || result) {\r\n\t\t\t\t\tinnerRemove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getNextValidIndex: function(start, isLeft) {\r\n\t\tvar Z = this, i, len;\r\n\t\tif(isLeft) {\r\n\t\t\tfor(i = start - 1; i >= 0; i--) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i = start, len = Z._items.length; i < len; i++) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Reload the active tab panel.\r\n\t */\r\n\treload: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcurrIdx = Z._contextItemIndex,\r\n\t\t\titemCfg = Z._items[currIdx];\r\n\t\tZ.reloadTabItem(itemCfg);\r\n\t},\r\n\t\r\n\treloadTabItem: function(itemCfg) {\r\n\t\tvar Z = this;\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar contentId = itemCfg.contentId;\r\n\t\tif(contentId) {\r\n\t\t\tif(itemCfg.debounce) {\r\n\t\t\t\tif(Z._enableLoading) {\r\n\t\t\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\t\t\tjqHead = jqEl.find('.jl-tab-header');\r\n\t\t\t\t\tjqHead.find('#' + contentId + '_h .jl-tab-loading').removeClass('jl-hidden');\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onContentLoading) {\r\n\t\t\t\t\tZ._onContentLoading.call(Z, contentId, itemCfg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tjQuery('#' + contentId).attr('src', itemCfg.url);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close the current active tab item  if this tab item is closable.\r\n\t */\r\n\tclose: function (tabItemIndex) {\r\n\t\tvar Z = this;\r\n\t\tif(tabItemIndex === undefined) {\r\n\t\t\ttabItemIndex = Z._activeIndex;\r\n\t\t}\r\n\t\tvar itemCfg = Z._items[tabItemIndex];\r\n\t\tif (itemCfg && tabItemIndex >= 0 && itemCfg.closable && !itemCfg.disabled) {\r\n\t\t\tZ.removeTabItem(tabItemIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close all closable tab item except current active tab item.\r\n\t */\r\n\tcloseOther: function () {\r\n\t\tvar Z = this, oitem;\r\n\t\tfor (var i = Z._items.length - 1; i >= 0; i--) {\r\n\t\t\toitem = Z._items[i];\r\n\t\t\tif (oitem.closable && !oitem.disabled) {\r\n\t\t\t\tif (Z._contextItemIndex == i) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ.removeTabItem(i);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close all closable tab item.\r\n\t */\r\n\tcloseAll: function() {\r\n\t\tvar Z = this, oitem;\r\n\t\tfor (var i = Z._items.length - 1; i >= 0; i--) {\r\n\t\t\toitem = Z._items[i];\r\n\t\t\tif (oitem.closable && !oitem.disabled) {\r\n\t\t\t\tZ.removeTabItem(i);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tcurrWidth = jqEl.width(),\r\n\t\t\tcurrHeight = jqEl.height();\r\n\t\tif(currWidth === Z._tabControlWidth && currHeight === Z._tabControlHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ( Z._tabControlWidth != currWidth){\r\n\t\t\tZ._tabControlWidth = currWidth;\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex);\r\n\t\t}\r\n\t\tZ._tabControlHeight = currHeight;\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\t\t\r\n\t},\r\n\t\r\n\t_createContextMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.contextMenu = null;\r\n\t\tif (!jslet.ui.Menu || !Z._closable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: [\r\n   \t\t\t{ id: 'reload', name: jsletlocale.TabControl.reload},\r\n\t\t\t{ id: 'close', name: jsletlocale.TabControl.close},\r\n\t\t\t{ id: 'closeOther', name: jsletlocale.TabControl.closeOther},\r\n\t\t\t{ id: 'closeAll', name: jsletlocale.TabControl.closeAll}]\r\n\t\t\t};\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t},\r\n\r\n\t_menuItemClick: function (menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tif(menuId === 'reload') {\r\n\t\t\tthis.reload();\r\n\t\t} else if (menuId === 'close') {\r\n\t\t\tthis.close(this._contextItemIndex);\r\n\t\t} else if (menuId === 'closeOther') {\r\n\t\t\tthis.closeOther();\r\n\t\t} else if (menuId === 'closeAll') {\r\n\t\t\tthis.closeAll();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z._newTabItem) {\r\n\t\t\tZ._newTabItem.onclick = null;\r\n\t\t\tZ._newTabItem = null;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\thead = jqEl.find('.jl-tab-header')[0];\r\n\t\t\r\n\t\tjqEl.find('.jl-tab-left').off();\r\n\t\tjqEl.find('.jl-tab-right').off();\r\n\t\thead.oncontextmenu = null;\r\n\t\tjqEl.find('.jl-tab-close').off();\r\n\t\tvar items = jqEl.find('.jl-tab-list').find('li');\r\n\t\titems.off();\r\n\t\titems.each(function(){\r\n\t\t\tthis.jslet = null;\r\n\t\t});\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(this);\r\n\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('TabControl', jslet.ui.TabControl);\r\njslet.ui.TabControl.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n * @class\r\n * \r\n* Tab Item\r\n*/\r\njslet.ui.TabItem = function () {\r\n\tvar Z = this;\r\n\tZ.id = null; //{String} Element Id\r\n\tZ.index = -1; //{Integer} TabItem index\r\n\tZ.header = null; //{String} Head of tab item\r\n\tZ.closable = false; //{Boolean} Can be closed or not\r\n\tZ.disabled = false; //{Boolean} \r\n\tZ.useIFrame = false; //{Boolean}\r\n\tZ.height = '100%';\r\n\tZ.url = null; //{String} \r\n\tZ.contentId = null; //{String} \r\n\tZ.content = null; //{String} \r\n};\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Window, there are the following features: <br /> \r\n * 1. Show as modal or modeless; <br />\r\n * 2. User can change window size; <br />\r\n * 3. User can minimize/maximize/restore/close window; <br />\r\n * 4. User can move window; <br />\r\n * \r\n * Example:\r\n *\r\n *     @example\r\n *     var oWin = jslet.ui.createControl({ type: \"Window\", iconClass:\"winicon\", caption: \"test window\", minimizable: false, maximizable:false,onActive: doWinActive, onPositionChanged: doPositionChanged });\r\n *     oWin.setContent(\"Open modeless window in the Body(with icon)!\");\r\n *     oWin.show(350,250);\r\n *     //or oWin.showModel(350, 250);\r\n *\r\n */\r\njslet.ui.Window = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onMoving,onActive,left,top,width,height,minWidth,maxWidth,minHeight,maxHeight,isCenter,isSmallHeader,stopEventBubbling,animation';\r\n\r\n\t\tZ._caption = null;\r\n\t\t\r\n\t\tZ._resizable = true;\r\n\t\t\r\n\t\tZ._minimizable = true;\r\n\r\n\t\tZ._maximizable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._iconClass = null;\r\n\t\t\r\n\t\tZ._left = 0;\r\n\t\t\r\n\t\tZ._top = 0;\r\n\t\t\r\n\t\tZ._width = 0;\r\n\t\t\r\n\t\tZ._height = 0;\r\n\t\t\r\n\t\tZ._minWidth = 20;\r\n\t\t\r\n\t\tZ._minHeight = 30;\r\n\t\t\r\n\t\tZ._maxWidth = -1;\r\n\r\n\t\tZ._maxHeight = -1;\r\n\r\n\t\tZ._isCenter = false;\r\n \r\n\t\tZ._isSmallHeader = false;\r\n\t\t\r\n\t\tZ._animation = 'linear';\r\n\t\t\r\n\t\tZ._onSizeChanged = null;\r\n\t\t\r\n\t\tZ._onPositionChanged = null;\r\n\t\t\r\n\t\tZ._onMoving = null;\r\n\t\t\r\n\t\tZ._onActive = null;\r\n\t\t\r\n\t\tZ._onClosed = null;\r\n\r\n\t\tZ._stopEventBubbling = false;\r\n\t\t\r\n\t\tZ._isModal = false;\r\n\t\t\r\n\t\tZ._state = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window caption.\r\n\t * \r\n\t * @param {String | undefined} caption Window caption.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the icon class of window header.\r\n\t * \r\n\t * @param {String | undefined} iconClass The icon css class of window header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ticonClass: function(iconClass) {\r\n\t\tif(iconClass === undefined) {\r\n\t\t\treturn this._iconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.iconClass', iconClass).isString();\r\n\t\tthis._iconClass = iconClass;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be resized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} resizable True - window can be resized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tresizable: function(resizable) {\r\n\t\tif(resizable === undefined) {\r\n\t\t\treturn this._resizable;\r\n\t\t}\r\n\t\tthis._resizable = resizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be minimized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} minimizable True - window can be minimized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tminimizable: function(minimizable) {\r\n\t\tif(minimizable === undefined) {\r\n\t\t\treturn this._minimizable;\r\n\t\t}\r\n\t\tthis._minimizable = minimizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be maximized or not.\r\n\t * \r\n\t * @param {Boolean | undefined} maximizable True - window can be maximized, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tmaximizable: function(maximizable) {\r\n\t\tif(maximizable === undefined) {\r\n\t\t\treturn this._maximizable;\r\n\t\t}\r\n\t\tthis._maximizable = maximizable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window can be closed or not.\r\n\t * \r\n\t * @param {Boolean | undefined} closable True - window can be closed, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window is shown in center of container.\r\n\t * \r\n\t * @param {Boolean | undefined} isCenter True - window is shown in center of container, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tisCenter: function(isCenter) {\r\n\t\tif(isCenter === undefined) {\r\n\t\t\treturn this._isCenter;\r\n\t\t}\r\n\t\tthis._isCenter = isCenter? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the window's header is in small size.\r\n\t * \r\n\t * @param {Boolean | undefined} isSmallHeader True - window's header is in small size, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tisSmallHeader: function(isSmallHeader) {\r\n\t\tif(isSmallHeader === undefined) {\r\n\t\t\treturn this._isSmallHeader;\r\n\t\t}\r\n\t\tthis._isSmallHeader = isSmallHeader? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Animation effect for showing and hiding.\r\n\t * \r\n\t * @param {String | undefined} animation Animation effect for showing and hiding, optional value: 'none', 'linear', 'slide', 'fade', default is 'linear'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tanimation: function(animation) {\r\n\t\tif(animation === undefined) {\r\n\t\t\treturn this._animation;\r\n\t\t}\r\n\t\tthis._animation = animation;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether stopping the event bubble.\r\n\t * \r\n\t * @param {Boolean | undefined} stopEventBubbling True - stop event bubbling, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tstopEventBubbling: function(stopEventBubbling) {\r\n\t\tif(stopEventBubbling === undefined) {\r\n\t\t\treturn this._stopEventBubbling;\r\n\t\t}\r\n\t\tthis._stopEventBubbling = stopEventBubbling? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial left.\r\n\t * \r\n\t * @param {Integer | undefined} left Window initial left.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tleft: function(left) {\r\n\t\tif(left === undefined) {\r\n\t\t\treturn this._left;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.left', left).isNumber();\r\n\t\tthis._left = left;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial top.\r\n\t * \r\n\t * @param {Integer | undefined} top Window initial top.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\ttop: function(top) {\r\n\t\tif(top === undefined) {\r\n\t\t\treturn this._top;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.top', top).isNumber();\r\n\t\tthis._top = top;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial width.\r\n\t * \r\n\t * @param {Integer | undefined} width Window initial width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.width', width).isGTZero();\r\n\t\tthis._width = width;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height Window initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window minimum width.\r\n\t * \r\n\t * @param {Integer | undefined} minWidth Window minimum width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminWidth: function(minWidth) {\r\n\t\tif(minWidth === undefined) {\r\n\t\t\treturn this._minWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minWidth', minWidth).isGTZero();\r\n\t\tif(minWidth < 20) {\r\n\t\t\tminWidth = 20;\r\n\t\t}\r\n\t\tthis._minWidth = minWidth;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window minimum height.\r\n\t * \r\n\t * @param {Integer | undefined} minHeight Window minimum height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminHeight: function(minHeight) {\r\n\t\tif(minHeight === undefined) {\r\n\t\t\treturn this._minHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minHeight', minHeight).isGTZero();\r\n\t\tif(minHeight < 30) {\r\n\t\t\tminHeight = 30;\r\n\t\t}\r\n\t\tthis._minHeight = minHeight;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window maximum width.\r\n\t * \r\n\t * @param {Integer | undefined} maxWidth Window maximum width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxWidth: function(maxWidth) {\r\n\t\tif(maxWidth === undefined) {\r\n\t\t\treturn this._maxWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxWidth', maxWidth).isNumber();\r\n\t\tthis._maxWidth = maxWidth;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get window maximum height.\r\n\t * \r\n\t * @param {Integer | undefined} maxHeight Window maximum height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxHeight: function(maxHeight) {\r\n\t\tif(maxHeight === undefined) {\r\n\t\t\treturn this._maxHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxHeight', maxHeight).isNumber();\r\n\t\tthis._maxHeight = maxHeight;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window size changed event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onSizeChanged(function(width, height){\r\n\t *     \r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onSizeChanged Window size changed event handler.\r\n\t * @param {Integer} onSizeChanged.width Changed width.\r\n\t * @param {Integer} onSizeChanged.height Changed height.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSizeChanged: function(onSizeChanged) {\r\n\t\tif(onSizeChanged === undefined) {\r\n\t\t\treturn this._onSizeChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onSizeChanged', onSizeChanged).isFunction();\r\n\t\tthis._onSizeChanged = onSizeChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired while user is moving the window. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onMoving(function(left, top){\r\n\t *     \r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onMoving Window moving event handler.\r\n\t * @param {Integer} onMoving.left left.\r\n\t * @param {Integer} onMoving.top top.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonMoving: function(onMoving) {\r\n\t\tif(onMoving === undefined) {\r\n\t\t\treturn this._onMoving;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onMoving', onMoving).isFunction();\r\n\t\tthis._onMoving = onMoving;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window position changed event handler. <br />\r\n\t * Fired when user changes the window's position. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onPositionChanged(function(left, top){\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onPositionChanged window position changed event handler\r\n\t * @param {Integer} onPositionChanged.left The left of changing position.\r\n\t * @param {Integer} onPositionChanged.top The top of changing position.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonPositionChanged: function(onPositionChanged) {\r\n\t\tif(onPositionChanged === undefined) {\r\n\t\t\treturn this._onPositionChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onPositionChanged', onPositionChanged).isFunction();\r\n\t\tthis._onPositionChanged = onPositionChanged;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window activated event handler. <br />\r\n\t * Fired when the window is active. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onActive(function(winObj){\r\n\t *       //windObj: jslet.ui.Window Window Object\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onActive Window activated event handler.\r\n\t * @param {jslet.ui.Window} onActive.winObj Jslet window object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonActive: function(onActive) {\r\n\t\tif(onActive === undefined) {\r\n\t\t\treturn this._onActive;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onActive', onActive).isFunction();\r\n\t\tthis._onActive = onActive;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get window closed event handler. <br />\r\n\t * Fired when uses closes window. Example:\r\n\t * \r\n\t *     @example\r\n\t *     owin.onClosed(function(winObj){});\r\n\t * \r\n\t * @param {Function | undefined} onClosed Window closed event handler.\r\n\t * @param {jslet.ui.Window} onClosed.winObj Jslet window object.\r\n\t * @param {String} onClosed.return If return value equals 'hidden', then hide window instead of closing.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonClosed: function(onClosed) {\r\n\t\tif(onClosed === undefined) {\r\n\t\t\treturn this._onClosed;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onClosed', onClosed).isFunction();\r\n\t\tthis._onClosed = onClosed;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._doMovingDebounce = jslet.debounce(Z._doMoving, 10);\r\n\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-window')) {\r\n\t\t\tjqEl.addClass('panel panel-default jl-window');\r\n\t\t}\r\n\t\tif (Z._width) {\r\n\t\t\tjqEl.outerWidth(Z._width);\r\n\t\t}\r\n\t\tif (Z._height) {\r\n\t\t\tjqEl.outerHeight(Z._height);\r\n\t\t}\r\n\t\tjqEl.css('display','none');\r\n\t\tvar template = [\r\n\t\t'<div class=\"panel-heading jl-win-header' + (Z._isSmallHeader? ' jl-win-header-sm': '') + '\" style=\"cursor:move\">',\r\n\t\t\tZ._iconClass ? '<span class=\"jl-win-header-icon ' + Z._iconClass + '\"></span>' : '',\r\n\t\t\t'<span class=\"panel-title jl-win-caption\">', Z._caption ? Z._caption : '', '</span>',\r\n\t\t\t'<span class=\"jl-win-tool jl-unselectable\">'];\r\n\t\t\ttemplate.push(Z._closable ? '<button class=\"jl-win-tool-btn close jl-win-close\" onfocus=\"this.blur();\">x</button>' : '');\r\n\t\t\ttemplate.push(Z._maximizable ? '<button class=\"jl-win-tool-btn close jl-win-max\" onfocus=\"this.blur();\"></button>' : '');\r\n\t\t\ttemplate.push(Z._minimizable ? '<button class=\"jl-win-tool-btn close jl-win-min\" onfocus=\"this.blur();\">-</button>' : '');\r\n\t\ttemplate.push('</span></div>');\r\n\t\ttemplate.push('<div class=\"panel-body jl-win-body\"></div>');\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tjqEl.on('mousemove', Z._doWinMouseMove);\r\n\t\tjqEl.on('mousedown', Z._doWinMouseDown);\r\n\t\tjqEl.on('dblclick', function(event){\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqEl.on('click', function(event){\r\n\t\t\tif(Z._stopEventBubbling) {\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tZ._changeBodyHeight();\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tvar jqBody = jqEl.find('.jl-win-body');\r\n\t\tjqBody.on('mouseenter',function (event) {\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tif (jslet.temp_dragging) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tZ.cursor = null;\r\n\t\t\t},300);\r\n\t\t});\r\n\t\tjqBody.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\t\r\n\t\tjqHeader.on('mousedown',function (event) {\r\n\t\t\tZ.activate();\r\n\t\t\tif (Z._state == 'max') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t});\r\n\r\n\t\tjqHeader.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (!Z._maximizable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (Z._state != 'max') {\r\n\t\t\t\tZ.maximize();\r\n\t\t\t} else {\r\n\t\t\t\tZ.restore();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\theader._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar offset = jqEl.position();\r\n\t\t\tZ._left = offset.left;\r\n\t\t\tZ._top = offset.top;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\theader._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._doMovingDebounce.call(Z, deltaX, deltaY);\r\n\t\t};\r\n\r\n\t\theader._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar offset = jQuery(Z.el).position(),\r\n\t\t\t\tleft = offset.left,\r\n\t\t\t\ttop = offset.top;\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\theader._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ.setPosition(Z._left, Z._top);\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._createTrackerMask(this);\r\n\t\t\tZ._createTracker();\r\n\t\t\tZ.trackerMask.style.cursor = Z.el.style.cursor;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._changeTrackerSize(deltaX, deltaY);\r\n\t\t};\r\n\r\n\t\tZ.el._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tif (!Z.tracker) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqTracker = jQuery(Z.tracker),\r\n\t\t\t\toffset = jqTracker.offset(),\r\n\t\t\t\twidth = jqTracker.width(),\r\n\t\t\t\theight = jqTracker.height(),\r\n\t\t\t\tpOffset = jQuery(Z.el).offsetParent().offset(),\r\n\t\t\t\tleft = offset.left - pOffset.left,\r\n\t\t\t\ttop = offset.top - pOffset.top;\r\n\t\t\t\t\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ.changeSize(width, height);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tif (Z._closable) {\r\n\t\t\tvar jqClose = jqEl.find('.jl-win-close');\r\n\t\t\tjqClose.click(function (event) {\r\n\t\t\t\tZ.close();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._minimizable) {\r\n\t\t\tvar jqMin = jqEl.find('.jl-win-min');\r\n\t\t\tjqMin.click(function (event) {\r\n\t\t\t\tZ.minimize();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._maximizable) {\r\n\t\t\tvar jqMax = jqEl.find('.jl-win-max'),\r\n\t\t\t\tbtnMax = jqMax[0];\r\n\t\t\tjqMax.click(function (event) {\r\n\t\t\t\tif (Z._state != 'max') {\r\n\t\t\t\t\tbtnMax.innerHTML = '';\r\n\t\t\t\t\tZ.maximize();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbtnMax.innerHTML = '';\r\n\t\t\t\t\tZ.restore();\r\n\t\t\t\t}\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show window at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (Z._isCenter) {\r\n\t\t\tvar jqOffsetP = jqEl.offsetParent(),\r\n\t\t\t\tpw = jqOffsetP.width(),\r\n\t\t\t\tph = jqOffsetP.height(),\r\n\t\t\t\twh = $(window).height(),\r\n\t\t\t\tww = $(window).width();\r\n\t\t\tpw = pw > ww? ww: pw;\r\n\t\t\tph = ph > wh? wh: ph;\r\n\t\t\tleft = document.body.scrollLeft + Math.round((pw - jqEl.outerWidth()) / 2);\r\n\t\t\ttop = document.body.scrollTop + Math.round((ph - jqEl.outerHeight()) / 2);\r\n\t\t\tif(left < 0) {\r\n\t\t\t\tleft = 0;\r\n\t\t\t}\r\n\t\t\tif(top < 0) {\r\n\t\t\t\ttop = 0;\r\n\t\t\t} \r\n\t\t\tZ._top = top ? top : 0;\r\n\t\t\tZ._left = left ? left : 0;\r\n\t\t} else {\r\n\t\t\tif(top === null || top === undefined) {\r\n\t\t\t\ttop = Z._top;\r\n\t\t\t}\r\n\t\t\tif(left === null || left === undefined) {\r\n\t\t\t\tleft = Z._left;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ.setPosition(left, top);\r\n\t\tif(Z._animation == 'slide') {\r\n\t\t\tjqEl.slideDown(function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._animation == 'fade') {\r\n\t\t\tjqEl.fadeIn(function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t} else if(Z._animation == 'none') {\r\n\t\t\tjqEl.show(0, function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tjqEl.show('fast', function() {\r\n\t\t\t\tZ._changeBodyHeight();\r\n\t\t\t\tZ.activate();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show modal window at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshowModal: function (left, top) {\r\n\t\tvar Z = this;\r\n\t\tZ._isModal = true;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex += 10;\r\n\t\tvar k = jslet.ui.GlobalZIndex;\r\n\t\tZ.el.style.zIndex = k;\r\n\t\tZ.show(left, top);\r\n\t\tZ.overlay.setZIndex(k - 2);\r\n\t\tZ.overlay.show();\r\n\t},\r\n\r\n\t/**\r\n\t * Hide window.\r\n\t */\r\n\thide: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(Z._animation == 'slide') {\r\n\t\t\tjqEl.slideUp();\r\n\t\t} else if(Z._animation == 'fade') {\r\n\t\t\tjqEl.fadeOut();\r\n\t\t} else if(Z._animation == 'none') {\r\n\t\t\tjqEl.hide();\r\n\t\t} else {\r\n\t\t\tjqEl.hide('fast');\r\n\t\t}\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.hide();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close window, this will fire onClosed event.\r\n\t */\r\n\tclose: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.el) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._onClosed) {\r\n\t\t\tvar action = Z._onClosed.call(Z);\r\n\t\t\tif (action && action.toLowerCase() == 'hidden') {\r\n\t\t\t\tZ.hide();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pnode = Z.el.parentNode;\r\n\t\tpnode.removeChild(Z.el);\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.destroy();\r\n\t\t\tZ.overlay = null;\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex -= 10;\r\n\t\tZ.destroy();\r\n\t},\r\n\r\n\t/**\r\n\t * Minimize window.\r\n\t */\r\n\tminimize: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._state == 'min') {\r\n\t\t\tZ.restore();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._state == 'max') {\r\n\t\t\tZ.restore();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tZ._tempHeight = jqEl.height();\r\n\t\tZ._tempWidth = jqEl.width();\r\n\t\tZ.changeSize(Z._tempWidth, Z._getHeaderHeight() + 2);\r\n\t\tZ._state = 'min';\r\n\t},\r\n\r\n\t/**\r\n\t * Maximize window.\r\n\t */\r\n\tmaximize: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqParent = jqEl.offsetParent(),\r\n\t\t\twidth = jqParent.innerWidth(),\r\n\t\t\theight = jqParent.innerHeight(),\r\n\t\t\tpOffset = jqParent.offset();\r\n\t\t\r\n\t\tZ.setPosition(0, 0, true);\r\n\t\tif (Z._state !== 'min') {\r\n\t\t\tZ._tempHeight = jqEl.height();\r\n\t\t\tZ._tempWidth = jqEl.width();\r\n\t\t}\r\n\t\tZ.changeSize(width - 10, height - 10);\r\n\t\tZ._state = 'max';\r\n\t},\r\n\r\n\t/**\r\n\t * Restore window.\r\n\t */\r\n\trestore: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.setPosition(Z._left, Z._top, true);\r\n\t\tZ.changeSize(Z._tempWidth, Z._tempHeight);\r\n\t\tZ._state = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Activate window, this will fire the 'OnActive' event.\r\n\t */\r\n\tactivate: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.bringToFront();\r\n\t\t}\r\n\t\tif (Z._onActive) {\r\n\t\t\tZ._onActive.call();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Change window position.\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t * @param {Boolean} notUpdateLeftTop True - Only change html element position, \r\n\t *\t\tnot change the inner position of Window object, it is usually use for moving action.\r\n\t */\r\n\tsetPosition: function (left, top, notUpdateLeftTop) {\r\n\t\tvar Z = this;\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 0;\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\t\tif (!notUpdateLeftTop) {\r\n\t\t\tZ._left = left;\r\n\t\t\tZ._top = top;\r\n\t\t} else {\r\n\t\t\tif (Z._onPositionChanged) {\r\n\t\t\t\tvar result = Z._onPositionChanged.call(Z, left, top);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tif (result.left) {\r\n\t\t\t\t\t\tleft = result.left;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (result.top) {\r\n\t\t\t\t\t\ttop = result.top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar pOffset = jqEl.offsetParent().offset();\r\n\t\tjqEl.offset({left: pOffset.left + left, top: pOffset.top + top});\r\n\t},\r\n\r\n\t/**\r\n\t * Change window size.\r\n\t * \r\n\t * @param {Integer} width Window width.\r\n\t * @param {Integer} height Window height.\r\n\t * @param {Boolean} notUpdateSize True - Only change html element size, \r\n\t *\t\tnot change the inner size of Window object, it is usually use for moving action.\r\n\t */\r\n\tchangeSize: function (width, height) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onSizeChanged) {\r\n\t\t\tZ._onSizeChanged.call(Z, width, height);\r\n\t\t}\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(width) {\r\n\t\t\tjqEl.width(width);\r\n\t\t}\r\n\t\tif(height) {\r\n\t\t\tjqEl.height(height);\r\n\t\t}\r\n\t\tZ._changeBodyHeight();\r\n\t},\r\n\r\n\t_doMoving: function(deltaX, deltaY) {\r\n\t\tvar Z = this,\r\n\t\t\tnewLeft = Z._left + deltaX,\r\n\t\t\tnewTop = Z._top + deltaY;\r\n\t\tif(Z._onMoving) {\r\n\t\t\tvar result = Z._onMoving.call(Z, newLeft, newTop, deltaX, deltaY);\r\n\t\t\tif(result) {\r\n\t\t\t\tvar newDeltaX = result.deltaX;\r\n\t\t\t\tvar newDeltaY = result.deltaY;\r\n\t\t\t\tdeltaX = newDeltaX || newDeltaX === 0? newDeltaX: deltaX; \r\n\t\t\t\tdeltaY = newDeltaY || newDeltaY === 0? newDeltaY: deltaY; \r\n\t\t\t}\r\n\t\t}\r\n\t\tnewLeft = Z._left + deltaX;\r\n\t\tnewTop = Z._top + deltaY;\r\n\t\tZ.setPosition(newLeft, newTop, true);\r\n\t},\r\n\t\r\n\t_getHeaderHeight: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHeader = jqEl.find('.jl-win-header');\r\n\t\treturn jqHeader.outerHeight() || 30;\r\n\t},\r\n\t\r\n\t_changeBodyHeight: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._height) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqBody = jqEl.find('.jl-win-body');\r\n\t\tjqBody.outerHeight(jqEl.innerHeight() - Z._getHeaderHeight());\r\n\t\tjslet.ui.resizeEventBus.resize(Z.el);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get window caption element. You can use it to customize window caption.\r\n\t * \r\n\t * @return {HtmlElement}\r\n\t */\r\n\tgetCaptionPanel: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-caption')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Set window caption.\r\n\t * \r\n\t * @param {String} caption Window caption.\r\n\t */\r\n\tsetCaption: function (caption) {\r\n\t\tthis.caption = caption;\r\n\t\tvar captionDiv = jQuery(this.el).find('.jl-win-caption');\r\n\t\tcaptionDiv.html(caption);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get window content element. You can use it to customize window content.\r\n\t * \r\n\t * @return {HtmlElement}\r\n\t */\r\n\tgetContentPanel: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-body')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Set window content.\r\n\t * \r\n\t * @param {String} html Html text for window content.\r\n\t */\r\n\tsetContent: function (html) {\r\n\t\tif (!html){\r\n\t\t\tjslet.showError('Window content cannot be null!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar bodyDiv = jQuery(this.el).find('.jl-win-body');\r\n\t\tif (html && html.toLowerCase) {\r\n\t\t\tbodyDiv.html(html);\r\n\t\t} else {\r\n\t\t\tbodyDiv.html('');\r\n\t\t\t\r\n\t\t\thtml.parentNode.removeChild(html);\r\n\t\t\tbodyDiv[0].appendChild(html);\r\n\t\t\tif (html.style && html.style.display == 'none') {\r\n\t\t\t\thtml.style.display = 'block';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Bring window to front.\r\n\t */\r\n\tbringToFront: function () {\r\n\t\tvar Z = this;\r\n\t\tvar p = Z.el.parentNode;\r\n\t\tvar node, jqEl = jQuery(Z.el);\r\n\t\tvar maxIndex = 0, jqNode, winIdx;\r\n\t\tfor (var i = 0, cnt = p.childNodes.length; i < cnt; i++) {\r\n\t\t\tnode = p.childNodes[i];\r\n\t\t\tif (node.nodeType != 1 || node == Z.el) {\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqEl.find('.jl-win-header').addClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tjqNode = jQuery(node);\r\n\t\t\t\r\n\t\t\tif (jqNode.hasClass('jl-window')) {\r\n\t\t\t\twinIdx = parseInt(node.style.zIndex) || 0;\r\n\t\t\t\tif (maxIndex < winIdx) {\r\n\t\t\t\t\tmaxIndex = winIdx;\r\n\t\t\t\t}\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqNode.find('.jl-win-header').removeClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar styleObj = jqEl.getStyleObject();\r\n\t\twinIdx = parseInt(styleObj.zIndex) || 0;\r\n\t\tif (winIdx <= maxIndex) {\r\n\t\t\tZ.setZIndex(maxIndex + 2);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Set window Z-Index.\r\n\t * \r\n\t * @param {Integer} zIndex Z-Index.\r\n\t */\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.el.style.zIndex = zIndex;\r\n\t\tif(this.overlay) {\r\n\t\t\tthis.overlay.setZIndex(zIndex - 2);\r\n\t\t}\r\n\t},\r\n\r\n\t_checkSize: function (width, height) {\r\n\t\tvar Z = this;\r\n\t\tif (width) {\r\n\t\t\tif (width < Z._minWidth || Z._maxWidth > 0 && width > Z._maxWidth) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (height) {\r\n\t\t\tif (height < Z.minHeight || Z._maxHeight > 0 && height > Z._maxHeight) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_changeTrackerSize: function (deltaX, deltaY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.tracker || !Z.cursor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\tw = jqEl.outerWidth(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\ttop = null, left = null;\r\n\r\n\t\tif (Z.cursor == 'nw') {\r\n\t\t\tw = w - deltaX;\r\n\t\t\th = h - deltaY;\r\n\t\t\ttop = Z._top + deltaY;\r\n\t\t\tleft = Z._left + deltaX;\r\n\t\t} else if (Z.cursor == 'n') {\r\n\t\t\th = h - deltaY;\r\n\t\t\ttop = Z._top + deltaY;\r\n\t\t} else if (Z.cursor == 'ne') {\r\n\t\t\th = h - deltaY;\r\n\t\t\tw = w + deltaX;\r\n\t\t\ttop = Z._top + deltaY;\r\n\t\t} else if (Z.cursor == 'e') {\r\n\t\t\tw = w + deltaX;\r\n\t\t} else if (Z.cursor == 'se') {\r\n\t\t\tw = w + deltaX;\r\n\t\t\th = h + deltaY;\r\n\t\t} else if (Z.cursor == 's'){\r\n\t\t\th = h + deltaY;\r\n\t\t} else if (Z.cursor == 'sw') {\r\n\t\t\th = h + deltaY;\r\n\t\t\tw = w - deltaX;\r\n\t\t\tleft = Z._left + deltaX;\r\n\t\t} else if (Z.cursor == 'w') {\r\n\t\t\tw = w - deltaX;\r\n\t\t\tleft = Z._left + deltaX;\r\n\t\t}\r\n\r\n\t\tif (!Z._checkSize(w, h)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqTracker = jQuery(Z.tracker);\r\n\t\tif (w) {\r\n\t\t\tjqTracker.width(w);\r\n\t\t}\r\n\t\tif (h) {\r\n\t\t\tjqTracker.height(h);\r\n\t\t}\r\n\t\tvar pOffset = jQuery(Z.el).offsetParent().offset();\r\n\t\tif(left === null) {\r\n\t\t\tleft = Z._left;\r\n\t\t}\r\n\t\tif(top === null) {\r\n\t\t\ttop = Z._top;\r\n\t\t}\r\n\t\tjqTracker.offset({top: pOffset.top + top, left: pOffset.left + left});\r\n\t\tjqTracker.show();\r\n\t},\r\n\r\n\t_doWinMouseMove: function (event) {\r\n\t\tif (jslet.temp_dragging) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tvar srcEl = event.target, jqSrcEl = jQuery(srcEl);\r\n\t\t\r\n\t\tif (!jqSrcEl.hasClass('jl-window')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!srcEl.jslet._resizable || srcEl.jslet._state) {\r\n\t\t\tsrcEl.jslet.cursor = null;\r\n\t\t\tsrcEl.style.cursor = 'default';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = jqSrcEl.offset(),\r\n\t\t\tx = event.pageX - pos.left,\r\n\t\t\ty = event.pageY - pos.top,\r\n\t\t\tw = jqSrcEl.width(),\r\n\t\t\th = jqSrcEl.height();\r\n\t\tvar delta = 8, wdelta = w - delta, hdelta = h - delta, cursor = null;\r\n\t\tif (x <= delta && y <= delta) {\r\n\t\t\tcursor = 'nw';\r\n\t\t} else if (x > delta && x < wdelta && y <= delta) {\r\n\t\t\tcursor = 'n';\r\n\t\t} else if (x >= wdelta && y <= delta) {\r\n\t\t\tcursor = 'ne';\r\n\t\t} else if (x >= wdelta && y > delta && y <= hdelta) {\r\n\t\t\tcursor = 'e';\r\n\t\t} else if (x >= wdelta && y >= hdelta) {\r\n\t\t\tcursor = 'se';\r\n\t\t} else if (x > delta && x < wdelta && y >= hdelta) {\r\n\t\t\tcursor = 's';\r\n\t\t} else if (x <= delta && y >= hdelta) {\r\n\t\t\tcursor = 'sw';\r\n\t\t} else if (x <= delta && y > delta && y < hdelta) {\r\n\t\t\tcursor = 'w';\r\n\t\t}\r\n\t\t\r\n\t\tsrcEl.jslet.cursor = cursor;\r\n\t\tsrcEl.style.cursor = cursor ? cursor + '-resize' : 'default';\r\n\t},\r\n\r\n\t_doWinMouseDown: function (event) {\r\n\t\tvar ojslet = this.jslet;\r\n\t\tojslet.activate();\r\n\t\tif (ojslet.cursor) {\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_createTrackerMask: function (holder) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body);\r\n\r\n\t\tZ.trackerMask = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z.trackerMask);\r\n\t\tjqTracker.addClass('jl-win-tracker-mask');\r\n\t\tZ.trackerMask.style.top = '0px';\r\n\t\tZ.trackerMask.style.left = '0px';\r\n\t\tZ.trackerMask.style.zIndex = 99998;\r\n\t\tZ.trackerMask.style.width = jqBody.width() + 'px';\r\n\t\tZ.trackerMask.style.height = jqBody.height() + 'px';\r\n\t\tZ.trackerMask.style.display = 'block';\r\n\t\tjqTracker.on('mousedown', function () {\r\n\t\t\tif (holder && holder._doDragCancel) {\r\n\t\t\t\tholder._doDragCancel();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqBody[0].appendChild(Z.trackerMask);\r\n\t},\r\n\r\n\t_removeTrackerMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t\tdocument.body.removeChild(Z.trackerMask);\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t},\r\n\r\n\t_createTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tZ.tracker = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z.tracker);\r\n\t\tjqTracker.hide();\r\n\t\tjqTracker.addClass('jl-win-tracker');\r\n\t\tZ.tracker.style.zIndex = 99999;\r\n\t\tZ.el.parentNode.appendChild(Z.tracker);\r\n\t},\r\n\r\n\t_removeTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\tZ.el.parentNode.removeChild(Z.tracker);\r\n\t\t}\r\n\t\tZ.tracker = null;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjslet.ui.uninstall(Z.el);\r\n\r\n\t\tjqEl.find('.jl-win-max').off();\r\n\t\tjqEl.find('.jl-win-min').off();\r\n\t\tjqEl.find('.jl-win-close').off();\r\n\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tjqHeader.off();\r\n\t\tjqEl.find('.jl-win-body').off();\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t\tZ.tracker = null;\r\n\t\tZ._onMoving = null;\r\n\t\tZ._onPositionChanged = null;\r\n\t\tZ._onSizeChanged = null;\r\n\t\tZ._onActive = null;\r\n\t\tZ._onClosed = null;\r\n\t\tZ.el._doDragCancel = null;\r\n\t\tZ.el._doDragEnd = null;\r\n\t\tZ.el._doDragging = null;\r\n\t\tZ.el._doDragStart = null;\r\n\t\theader._doDragCancel = null;\r\n\t\theader._doDragEnd = null;\r\n\t\theader._doDragging = null;\r\n\t\theader._doDragStart = null;\r\n\t\tif ($super) {\r\n\t\t\t$super();\r\n\t\t}\r\n\t}\r\n});\r\njslet.ui.register('Window', jslet.ui.Window);\r\njslet.ui.Window.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * Calendar. Example:\r\n * \r\n *     @example\r\n *     //1. Declaring:\r\n *       <div data-jslet='type:\"Calendar\"' />\r\n *\r\n *     //2. Binding\r\n *       <div id='ctrlId' />\r\n *       //js snippet \r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, {type:\"Calendar\"});\r\n *\t\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl({type:\"Calendar\"}, document.body);\r\n */\r\njslet.ui.Calendar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,value,onDateSelected,minDate,maxDate';\r\n\r\n\t\tZ._value = null;\r\n\t\t\r\n\t\tZ._onDateSelected = null;\r\n\t\t\r\n\t\tZ._minDate = null;\r\n\r\n\t\tZ._maxDate = null;\r\n\t\t\r\n\t\tZ._currYear = 0;\r\n\t\tZ._currMonth = 0;\r\n\t\tZ._currDate = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Calendar value.\r\n\t * \r\n\t * @param {Date | undefined} value calendar value.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.value', value).isDate();\r\n\t\tthis._value = value;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get minimum date of calendar range.\r\n\t * \r\n\t * @param {Date | undefined} minDate Minimum date of calendar range.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tminDate: function(minDate) {\r\n\t\tif(minDate === undefined) {\r\n\t\t\treturn this._minDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.minDate', minDate).isDate();\r\n\t\tthis._minDate = minDate;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get maximum date of calendar range.\r\n\t * \r\n\t * @param {Date | undefined} maxDate Maximum date of calendar range.\r\n\t * \r\n\t * @return {this | Date}\r\n\t */\r\n\tmaxDate: function(maxDate) {\r\n\t\tif(maxDate === undefined) {\r\n\t\t\treturn this._maxDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.maxDate', maxDate).isDate();\r\n\t\tthis._maxDate = maxDate;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user select a date. Example:\r\n\t * \r\n\t *     @example\r\n\t *     calendar.onDateSelected(function(value){});\r\n\t *\r\n\t * @param {Function | undefined} onDateSelected Date selected event handler.\r\n\t * @param {Date} onDateSelected.value Calendar value.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonDateSelected: function(onDateSelected) {\r\n\t\tif(onDateSelected === undefined) {\r\n\t\t\treturn this._onDateSelected;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.onDateSelected', onDateSelected).isFunction();\r\n\t\tthis._onDateSelected = onDateSelected;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-calendar')) {\r\n\t\t\tjqEl.addClass('jl-calendar panel panel-default');\r\n\t\t}\r\n\t\tvar calendarLocale = jsletlocale.Calendar;\r\n\t\tvar template = ['<div class=\"jl-cal-header\">',\r\n\t\t\t'<a class=\"jl-cal-btn jl-cal-yprev\" title=\"', calendarLocale.yearPrev,\r\n\t\t\t'\" href=\"javascript:;\">&lt;&lt;</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mprev\" title=\"', calendarLocale.monthPrev, '\">&lt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-title\"></a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mnext\" title=\"', calendarLocale.monthNext, '\">&gt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-ynext\" title=\"', calendarLocale.yearNext, '\">&gt;&gt;</a>',\r\n\t\t'</div>',\r\n\t\t'<div class=\"jl-cal-body\">',\r\n\t\t\t'<table cellpadding=\"0\" cellspacing=\"0\">',\r\n\t\t\t\t'<thead><tr><th class=\"jl-cal-weekend\">',\r\n\t\t\t\tcalendarLocale.Sun,\r\n\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Mon,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Tue,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Wed,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Thu,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tcalendarLocale.Fri,\r\n\t\t\t\t\t\t'</th><th class=\"jl-cal-weekend\">',\r\n\t\t\t\t\tcalendarLocale.Sat,\r\n\t\t\t\t\t\t'</th></tr></thead><tbody>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'</tbody></table></div><div class=\"jl-cal-footer\"><a class=\"jl-cal-today\" href=\"javascript:;\">', calendarLocale.today, '</a></div>'];\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tvar jqTable = jqEl.find('.jl-cal-body table');\r\n\t\tZ._currYear = -1;\r\n\t\tjqTable.on('click', Z._doTableClick);\r\n\t\t\r\n\t\tvar dvalue = Z._value && jslet.isDate(Z._value) ? Z._value : new Date();\r\n\t\tthis.setValue(dvalue);\r\n\t\tjqEl.find('.jl-cal-today').click(function (event) {\r\n\t\t\tvar d = new Date();\r\n\t\t\tZ.setValue(new Date(d.getFullYear(), d.getMonth(), d.getDate()));\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-yprev').click(function (event) {\r\n\t\t\tZ.incYear(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mprev').click(function (event) {\r\n\t\t\tZ.incMonth(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-ynext').click(function (event) {\r\n\t\t\tZ.incYear(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mnext').click(function (event) {\r\n\t\t\tZ.incMonth(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.on('keydown', function(event){\r\n\t\t\tvar ctrlKey = event.ctrlKey,\r\n\t\t\t\tkeyCode = event.keyCode;\r\n\t\t\tvar delta = 0;\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.UP) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\t\t\tif(keyCode == jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.LEFT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.RIGHT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_getNotNullDate: function() {\r\n\t\tvar value =this._value;\r\n\t\tif(!value) {\r\n\t\t\tvalue = new Date();\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tincDate: function(deltaDay) {\r\n\t\tvar value = this._getNotNullDate();\r\n\t\tvalue.setDate(value.getDate() + deltaDay);\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincMonth: function(deltaMonth) {\r\n\t\tvar value = this._getNotNullDate(),\r\n\t\t\toldDate = value.getDate();\r\n\t\tvalue.setMonth(value.getMonth() + deltaMonth);\r\n\t\tif(oldDate >=29) {\r\n\t\t\tvar newDate = value.getDate();\r\n\t\t\tif(oldDate != newDate) {\r\n\t\t\t\tvalue = new Date(value.getFullYear(), value.getMonth(), 1) - 24*3600*1000;\r\n\t\t\t\tvalue = new Date(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincYear: function(deltaYear) {\r\n\t\tvar value = this._getNotNullDate(),\r\n\t\t\toldDate = value.getDate();\r\n\t\tvalue.setFullYear(value.getFullYear() + deltaYear);\r\n\t\tif(oldDate >=29) {\r\n\t\t\tvar newDate = value.getDate();\r\n\t\t\tif(oldDate != newDate) {\r\n\t\t\t\tvalue = new Date(value.getFullYear(), value.getMonth(), 1) - 24*3600*1000;\r\n\t\t\t\tvalue = new Date(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\t_innerSetValue: function(value) {\r\n\t\tvar Z = this,\r\n\t\t\toldValue = Z._getNotNullDate();\r\n\t\tif(value) { //Overwrite Year/Month/Date part, keep time part.\r\n\t\t\toldValue.setFullYear(value.getFullYear(), value.getMonth(), value.getDate());\r\n\t\t}\r\n\t\tZ._value = oldValue;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set date value of calendar.\r\n\t * \r\n\t * @param {Date} value Calendar date.\r\n\t */\r\n\tsetValue: function (value) {\r\n\t\tif (!value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar Z = this;\r\n\t\tif (Z._minDate && value < Z._minDate) {\r\n\t\t\tvalue = new Date(Z._minDate.getTime());\r\n\t\t}\r\n\t\tif (Z._maxDate && value > Z._maxDate) {\r\n\t\t\tvalue = new Date(Z._maxDate.getTime());\r\n\t\t}\r\n\t\tZ._innerSetValue(value);\r\n\t\tvar y = value.getFullYear(), \r\n\t\t\tm = value.getMonth();\r\n\t\tif (Z._currYear == y && Z._currMonth == m) {\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t} else {\r\n\t\t\tZ._refreshDateCell(y, m);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override.\r\n\t */\r\n\tfocus: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-cal-current')[0].focus();\r\n\t},\r\n\t\r\n\t_checkNaviState: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), flag, btnToday;\r\n\t\tif (Z._minDate) {\r\n\t\t\tvar minY = Z._minDate.getFullYear(),\r\n\t\t\t\tminM = Z._minDate.getMonth(),\r\n\t\t\t\tbtnYearPrev = jqEl.find('.jl-cal-yprev')[0];\r\n\t\t\tflag = (Z._currYear <= minY);\r\n\t\t\tbtnYearPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == minY && Z._currMonth <= minM);\r\n\t\t\tvar btnMonthPrev = jqEl.find('.jl-cal-mprev')[0];\r\n\t\t\tbtnMonthPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._minDate > new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\r\n\t\tif (Z._maxDate) {\r\n\t\t\tvar maxY = Z._maxDate.getFullYear(),\r\n\t\t\t\tmaxM = Z._maxDate.getMonth(),\r\n\t\t\t\tbtnYearNext = jqEl.find('.jl-cal-ynext')[0];\r\n\t\t\tflag = (Z._currYear >= maxY);\r\n\t\t\tbtnYearNext.jslet_disabled = flag;\r\n\t\t\tbtnYearNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == maxY && Z._currMonth >= maxM);\r\n\t\t\tvar btnMonthNext = jqEl.find('.jl-cal-mnext')[0];\r\n\t\t\tbtnMonthNext.jslet_disabled = flag;\r\n\t\t\tbtnMonthNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._maxDate < new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshDateCell: function (year, month) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tmonthnames = jsletlocale.Calendar.monthNames,\r\n\t\t\tmname = monthnames[month],\r\n\t\t\totitle = jqEl.find('.jl-cal-title')[0];\r\n\t\totitle.innerHTML = mname + ',' + year;\r\n\t\tvar otable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\tfirstDay = new Date(year, month, 1),\r\n\t\t\tw1 = firstDay.getDay(),\r\n\t\t\toneDayMs = 86400000, //24 * 60 * 60 * 1000\r\n\t\t\tdate = new Date(firstDay.getTime() - (w1 + 1) * oneDayMs);\r\n\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\r\n\t\tvar rowCnt = rows.length, otr, otd, m, oa;\r\n\t\tfor (var i = 1; i <= rowCnt; i++) {\r\n\t\t\totr = rows[i - 1];\r\n\t\t\tfor (var j = 1, tdCnt = otr.cells.length; j <= tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j - 1];\r\n\t\t\t\tdate = new Date(date.getTime() + oneDayMs);\r\n\t\t\t\toa = otd.firstChild;\r\n\t\t\t\tif (Z._minDate && date < Z._minDate || Z._maxDate && date > Z._maxDate) {\r\n\t\t\t\t\toa.innerHTML = '';\r\n\t\t\t\t\totd.jslet_date_value = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toa.innerHTML = date.getDate();\r\n\t\t\t\t\totd.jslet_date_value = date;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\tif (m != month) {\r\n\t\t\t\t\tjQuery(otd).addClass('jl-cal-disable');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjQuery(otd).removeClass('jl-cal-disable');\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t} //end for i\r\n\t\tZ._currYear = year;\r\n\t\tZ._currMonth = month;\r\n\t\tZ._setCurrDateCls();\r\n\t\tZ._checkNaviState();\r\n\t},\r\n\t\r\n\t_fireSelectedEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onDateSelected) {\r\n\t\t\tZ._onDateSelected.call(Z, Z._value);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doTableClick: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar node = event.target,\r\n\t\t\totd = node.parentNode;\r\n\t\t\r\n\t\tif (otd && otd.tagName && otd.tagName.toLowerCase() == 'td') {\r\n\t\t\tif (!otd.jslet_date_value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = jslet.ui.findFirstParent(otd, function (node) { return node.jslet; });\r\n\t\t\tvar Z = el.jslet;\r\n\t\t\tZ._innerSetValue(otd.jslet_date_value);\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t\ttry{\r\n\t\t\t\totd.firstChild.focus();\r\n\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t}\r\n\t},\r\n\r\n\t_setCurrDateCls: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!jslet.isDate(Z._value)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currM = Z._value.getMonth(),\r\n\t\t\tcurrY = Z._value.getFullYear(),\r\n\t\t\tcurrD = Z._value.getDate(),\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\totable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\trowCnt = rows.length, otr, otd, m, d, y, date, jqLink;\r\n\t\tfor (var i = 0; i < rowCnt; i++) {\r\n\t\t\totr = rows[i];\r\n\t\t\tfor (var j = 0, tdCnt = otr.cells.length; j < tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j];\r\n\t\t\t\tdate = otd.jslet_date_value;\r\n\t\t\t\tif (!date) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\ty = date.getFullYear();\r\n\t\t\t\td = date.getDate();\r\n\t\t\t\tjqLink = jQuery(otd.firstChild);\r\n\t\t\t\tif (y == currY && m == currM && d == currD) {\r\n\t\t\t\t\tif (!jqLink.hasClass('jl-cal-current')) {\r\n\t\t\t\t\t\tjqLink.addClass('jl-cal-current');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\totd.firstChild.focus();\r\n\t\t\t\t\t} catch(e){\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqLink.removeClass('jl-cal-current');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-cal-body table').off();\r\n\t\tjqEl.find('.jl-cal-today').off();\r\n\t\tjqEl.find('.jl-cal-yprev').off();\r\n\t\tjqEl.find('.jl-cal-mprev').off();\r\n\t\tjqEl.find('.jl-cal-mnext').off();\r\n\t\tjqEl.find('.jl-cal-ynext').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Calendar', jslet.ui.Calendar);\r\njslet.ui.Calendar.htmlTemplate = '<div></div>';\r\n\n/**\r\n* @class\r\n* \r\n* MessageBox, it can be used to display info, warn, error, confirm, prompt dialog.\r\n*/\r\njslet.ui.MessageBox = function () {\r\n\r\n\t/**\r\n\t * Show message box.\r\n\t * \r\n\t * @param {String} message Message text.\r\n\t * @param {String} caption Caption text.\r\n\t * @param {String} iconClass Caption icon class.\r\n\t * @param {String[]} buttons Array of button names, it's the subset of array ['ok','cancel', 'yes', 'no'], like : ['ok','cancel'].\r\n\t * @param {Function} callbackFn Callback function when user click one button. \r\n\t * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n\t * @param {String} callbackFn.value Text which user inputted. \r\n\t * @param {Integer} hasInput Value inputting flag, options: 0 - none, 1 - single line input, 2 - multiple line input.\r\n\t * @param {String} defaultValue The default value of Input element, if 'hasInput' = 0, this argument is be ignored.\r\n\t * @param {Function} validateFn Validate function of input element, if 'hasInput' = 0, this argument is be ignored.\r\n\t * @param {String} validateFn.value The value which need to be validated, if 'hasInput' = 0, this argument is be ignored.\r\n\t */\r\n\tthis.show = function (message, caption, iconClass, buttons, callbackFn, hasInput, defaultValue, validateFn) {\r\n\r\n\t\tvar opt = { type: 'window', caption: caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, stopEventBubbling: true, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar iconHtml = '';\r\n\t\tif (iconClass) {\r\n\t\t\ticonHtml = '<div class=\"jl-msg-icon ';\r\n\t\t\tif (iconClass == 'info' || iconClass == 'error' || iconClass == 'question' || iconClass == 'warning') {\r\n\t\t\t\ticonHtml += 'jl-msg-icon-' + iconClass;\r\n\t\t\t} else {\r\n\t\t\t\ticonHtml += iconClass;\r\n\t\t\t}\r\n\t\t\ticonHtml += '\"><i class=\"fa ';\r\n\t\t\tswitch (iconClass) {\r\n\t            case 'info':\r\n\t            \ticonHtml += 'fa-info';\r\n\t                break;\r\n\t            case 'error':\r\n\t            \ticonHtml += 'fa-times';\r\n\t                break;\r\n\t            case 'success':\r\n\t            \ticonHtml += 'fa-check';\r\n\t                break;\r\n\t            case 'warning':\r\n\t            \ticonHtml += 'fa-exclamation';\r\n\t                break;\r\n\t            case 'question':\r\n\t            \ticonHtml += 'fa-question';\r\n\t                break;\r\n\t            default :\r\n\t            \ticonHtml += 'fa-info';\r\n                 \tbreak;\r\n\t        }\r\n\t\t\ticonHtml += '\"></i></div>';\r\n\t\t}\r\n\r\n\t\tvar btnCount = buttons.length;\r\n\t\tvar btnHtml = [], btnName, i;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tfor (i = btnCount - 1; i >=0; i--) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-xs\" ');\r\n\t\t\t\tbtnHtml.push(' data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\">');\r\n\t\t\t\tbtnHtml.push(jsletlocale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < btnCount; i++) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-xs\" ');\r\n\t\t\t\tbtnHtml.push('\" data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\">');\r\n\t\t\t\tbtnHtml.push(jsletlocale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar inputHtml = ['<br />'];\r\n\t\tif (hasInput) {\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push('<input type=\"text\"');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('<textarea rows=\"5\"');\r\n\t\t\t}\r\n\t\t\tinputHtml.push(' style=\"width:');\r\n\t\t\tinputHtml.push('98%\"');\r\n\t\t\tif (defaultValue !== null && defaultValue !== undefined) {\r\n\t\t\t\tinputHtml.push(' value=\"');\r\n\t\t\t\tinputHtml.push(defaultValue);\r\n\t\t\t\tinputHtml.push('\"');\r\n\t\t\t}\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push(' />');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('></textarea>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(message) {\r\n\t\t\tmessage = message.replace('\\n', '<br />');\r\n\t\t}\r\n\t\tvar html = ['<div class=\"jl-msg-container\">', iconHtml, '<div class=\"' + (hasInput? 'jl-msg-message-noicon': 'jl-msg-message') + '\">',\r\n\t\t\t\t\tmessage, inputHtml.join(''), '</div>', '</div>',\r\n\t\t\t\t\t'<div class=\"jl-msg-tool\"><div>', btnHtml.join(''), '</div></div>'\r\n\t\t];\r\n\r\n\t\towin.setContent(html.join(''));\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tvar toolBar = jqEl.find('.jl-msg-tool')[0].firstChild;\r\n\t\tvar inputCtrl = null;\r\n\t\tif (hasInput == 1) {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container input')[0];\r\n\t\t} else {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container textarea')[0];\r\n\t\t}\r\n\t\t\r\n\t\tjQuery(toolBar).on('click', 'button', function(event) {\r\n\t\t\tvar obtn = event.currentTarget;\r\n\t\t\tvar btnName = jQuery(obtn).attr('data-jsletname');\r\n\t\t\tvar value = null;\r\n\t\t\tif (hasInput && btnName == 'ok') {\r\n\t\t\t\tvalue = inputCtrl.value;\r\n\t\t\t\tif (validateFn && !validateFn(value)) {\r\n\t\t\t\t\tinputCtrl.focus();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\towin.close();\r\n\t\t\tif (callbackFn) {\r\n\t\t\t\tcallbackFn(btnName, value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(99981);\r\n\t\tvar k = btnCount - 1;\r\n\t\tif (jsletlocale.isRtl) {\r\n\t\t\tk = 0;\r\n\t\t}\r\n\t\tif(inputCtrl) {\r\n\t\t\tinputCtrl.focus();\r\n\t\t} else {\r\n\t\t\tvar toolBtn = toolBar.childNodes[k];\r\n\t\t\tif(toolBtn) {\r\n\t\t\t\ttoolBtn.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn owin;\r\n\t};\r\n};\r\n\r\n/**\r\n * Show info message. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.info('Finished!', 'Tips');\r\n *     jslet.ui.info('Finished!', 'Tips', function(){console.log('info')});\r\n *     jslet.ui.info('Finished!', 'Tips', null, 1000); //Auto close after 1 second.\r\n *     \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.info = jslet.ui.alert = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.info;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'info', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Show error message. Example:\r\n * \r\n *     @examle\r\n *     jslet.ui.error('You have made a mistake!', 'Error');\r\n *     jslet.ui.error('You have made a mistake!', 'Error', function(){console.log('error')});\r\n *     jslet.ui.error('You have made a mistake!', 'Error', null, 1000); //Auto close after 1 second.\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.error = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.error;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'error', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show warning message. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning');\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning', function(){console.log('warning')});\r\n *     jslet.ui.warn('Program will be shut down!', 'Warning', null, 1000); //Auto close after 1 second.\r\n *     \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button.\r\n * @param {Integer} timeout Auto close message box after 'timeout'(ms) elapses. \r\n */\r\njslet.ui.warn = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.warn;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'warning', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(!window.isNaN(timeout)) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close();\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show confirm message. Example:\r\n * \r\n *     @example\r\n *     var callbackFn = function(button){\r\n *       alert('Button: ' + button + ' clicked!');\r\n *     }\r\n *     jslet.ui.confirm('Are you sure?', 'Confirm', callbackFn);//show Ok/Cancel\r\n *     jslet.ui.confirm('Are you sure?', 'Confirm', callbackFn, true);//show Yes/No/Cancel\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button. \r\n * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n */\r\njslet.ui.confirm = function(message, caption, callbackFn, isYesNo){\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jsletlocale.MessageBox.confirm;\r\n\t}\r\n\tif (!isYesNo) {\r\n\t\tomsgBox.show(message, caption, 'question',['ok', 'cancel'], callbackFn);\t\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, 'question', ['yes', 'no', 'cancel'], callbackFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * Prompt user to input some value. Example:\r\n * \r\n *     @example\r\n *     var callbackFn = function(button, value){\r\n *       alert('Button: ' + button + ', value:' + value);\r\n *     };\r\n *     \r\n *     var validateFn = function(value){\r\n *       if (!value){\r\n *         alert('Please input some thing!');\r\n *         return false;\r\n *       }\r\n *       return true;\r\n *     };\r\n *     \r\n *     jslet.ui.prompt('Input your name: ', 'Prompt', callbackFn, 'Bob', validateFn);\r\n *     jslet.ui.prompt('Input your comments: ', 'Prompt', callbackFn, null, validateFn, true);\r\n * \r\n * @member jslet.ui\r\n * \r\n * @param {String} message Message text.\r\n * @param {String} caption Caption text.\r\n * @param {Function} callbackFn Callback function when user click one button. \r\n * @param {String} callbackFn.button Button name which clicked, optional value: ok, cancel, yes, no. \r\n * @param {String} callbackFn.value Text which user inputted. \r\n * @param {String} defaultValue The default value of Input element, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {Function} validateFn Validate function of input element, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {String} validateFn.value The value which need to be validated, if 'hasInput' = 0, this argument is be ignored.\r\n * @param {Boolean} isMultiLine True - user can input multiple lines text, false - only one line text.\r\n */\r\njslet.ui.prompt = function (message, caption, callbackFn, defaultValue, validateFn, isMultiLine) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption && !message) {\r\n\t\tcaption = jsletlocale.MessageBox.prompt;\r\n\t}\r\n\tif (!isMultiLine) {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 1, defaultValue, validateFn);\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 2, defaultValue, validateFn);\r\n\t}\r\n};\r\n\n/**\r\n* @class \r\n* \r\n* Overlay panel. Example:\r\n* \r\n*     @example\r\n*     var overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n*     overlay.setZIndex(999, '#ddd');\r\n*     overlay.show();\r\n* \r\n* @param {HtmlElement} container HTML Element that OverlayPanel will cover.\r\n* @param {String} color Color String.\r\n*/\r\njslet.ui.OverlayPanel = function (container, color) {\r\n\tvar odiv = document.createElement('div');\r\n\tjQuery(odiv).addClass('jl-overlay').on('click', function(event){\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar srcEle = event.target;\r\n\t\tif(!jslet.ui.PopupPanel.popupElement.checkAndHide(srcEle)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t});\r\n\t\r\n\tif (color) {\r\n\t\todiv.style.backgroundColor = color;\r\n\t}\r\n\tvar left, top, width, height;\r\n\tif (!container) {\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tleft = 0;\r\n\t\ttop = 0;\r\n\t\twidth = jqBody.width();\r\n\t\theight = jqBody.height();\r\n\t} else {\r\n\t\twidth = jQuery(container).width();\r\n\t\theight = jQuery(container).height();\r\n\t}\r\n\todiv.style.left = '0px';\r\n\todiv.style.top = '0px';\r\n\todiv.style.bottom = '0px';\r\n\todiv.style.right = '0px';\r\n\tif (!container) {\r\n\t\tdocument.body.appendChild(odiv);\r\n\t} else {\r\n\t\tcontainer.appendChild(odiv);\r\n\t}\r\n\todiv.style.display = 'none';\r\n\r\n\tvar oldResizeHanlder = null;\r\n\tif (!container) {\r\n\t\toldResizeHanlder = window.onresize;\r\n\r\n\t\twindow.onresize = function () {\r\n\t\t\todiv.style.width = document.body.scrollWidth + 'px';\r\n\t\t\todiv.style.height = document.body.scrollHeight + 'px';\r\n\t\t};\r\n\t} else {\r\n\t\toldResizeHanlder = container.onresize;\r\n\t\tcontainer.onresize = function () {\r\n\t\t\tvar width = jQuery(container).width() - 12;\r\n\t\t\tvar height = jQuery(container).height() - 12;\r\n\t\t\todiv.style.width = width + 'px';\r\n\t\t\todiv.style.height = height + 'px';\r\n\t\t};\r\n\t}\r\n\r\n\tthis.overlayPanel = odiv;\r\n\r\n\t/**\r\n\t * Show overlay panel.\r\n\t */\r\n\tthis.show = function () {\r\n\t\todiv.style.display = 'block';\r\n\t\treturn odiv;\r\n\t};\r\n\r\n\t/**\r\n\t * Hide overlay panel.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\todiv.style.display = 'none';\r\n\t\treturn odiv;\r\n\t};\r\n\t\r\n\t/**\r\n\t * Set Z-index.\r\n\t * \r\n\t * @param {Integer} zIndex Z-Index.\r\n\t */\r\n\tthis.setZIndex = function(zIndex){\r\n\t\tthis.overlayPanel.style.zIndex = zIndex;\r\n\t};\r\n\r\n\t/**\r\n\t * Destroy overlay panel.\r\n\t */\r\n\tthis.destroy = function () {\r\n\t\tthis.hide();\r\n\t\tif (!container) {\r\n\t\t\twindow.onresize = oldResizeHanlder;\r\n\t\t\tdocument.body.removeChild(odiv);\r\n\t\t} else {\r\n\t\t\tcontainer.onresize = oldResizeHanlder;\r\n\t\t\tcontainer.removeChild(odiv);\r\n\t\t}\r\n\t\tjQuery(this.overlayPanel).off();\r\n\t};\r\n};\r\n\n/**\r\n * @private\r\n * @class\r\n * \r\n * Popup Panel. Example: \r\n * \r\n *     @example\r\n *     var popPnl = new jslet.ui.PopupPanel();\r\n *     popPnl.contentElement(document.getElementById('id'));\r\n *     popPnl.show(10, 10, 100, 100);\r\n * \r\n *     popPnl.hide(); //or\r\n *     popPnl.destroy();\r\n *  \r\n */\r\njslet.ui.PopupPanel = function (excludedEl) {\r\n\tthis._onHidePopup = null;\r\n\tthis._excludedEl = excludedEl;\r\n\tthis._contentEl = null;\r\n};\r\n\r\njslet.ui.PopupPanel.prototype = {\r\n\t/**\r\n\t * Event handler when hide popup panel: function(){}\r\n\t */\r\n\tonHidePopup: function(onHidePopup) {\r\n\t\tif(onHidePopup === undefined) {\r\n\t\t\treturn this._onHidePopup;\r\n\t\t}\r\n\t\tthis._onHidePopup = onHidePopup;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\texcludedElement: function(excludedEl) {\r\n\t\tif(excludedEl === undefined) {\r\n\t\t\treturn this._excludedEl;\r\n\t\t}\r\n\t\tthis._excludedEl = excludedEl;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcontentElement: function(contentEl) {\r\n\t\tif(contentEl === undefined) {\r\n\t\t\treturn this._contentEl;\r\n\t\t}\r\n\t\tthis._contentEl = contentEl;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tshow: function(left, top, width, height, ajustX, ajustY) {\r\n\t\tjslet.ui.PopupPanel.popupElement.show(this, left, top, width, height, ajustX, ajustY);\r\n\t},\r\n\t\r\n\thide: function() {\r\n\t\tjslet.ui.PopupPanel.popupElement.hide();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tthis._onHidePopup = null;\r\n\t\tthis._excludedEl = null;\r\n\t\tthis._contentEl = null;\r\n\t}\r\n};\r\n\r\n(function () {\r\n\tvar PopupElement = function() {\r\n\t\tvar sharedPopPnl = null;\r\n\t\tvar activePopup = null;\r\n\t\t\r\n\t\tvar inPopupPanel = function (htmlElement) {\r\n\t\t\tif (!htmlElement || htmlElement === document) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (jQuery(htmlElement).hasClass('jl-popup-panel')) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn inPopupPanel(htmlElement.parentNode);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar self = this;\r\n\t\tvar documentClickHandler = function (event) {\r\n\t\t\tif(!activePopup) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tvar srcEle = event.target;\r\n\t\t\tself.checkAndHide(srcEle);\r\n\t\t};\r\n\t\t\r\n\t\tfunction createPanel() {\r\n\t\t\tif(sharedPopPnl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar p = document.createElement('div');\r\n\t\t\tp.style.display = 'none';\r\n\t\t\tp.className = 'jl-popup-panel jl-opaque jl-border-box dropdown-menu';\r\n\t\t\tp.style.position = 'absolute';\r\n\t\t\tp.style.zIndex = 99000;\r\n\t\t\tdocument.body.appendChild(p);\r\n\t\t\t\r\n\t\t\tjQuery(document).on('click', documentClickHandler);\r\n\t\t\tsharedPopPnl = p;\r\n\t\t}\r\n\t\t\r\n\t\tfunction changeContent(newPopup) {\r\n\t\t\tvar oldContent = sharedPopPnl.childNodes[0];\r\n\t\t\tif (oldContent) {\r\n\t\t\t\tsharedPopPnl.removeChild(oldContent);\r\n\t\t\t}\r\n\t\t\tif(newPopup) {\r\n\t\t\t\tvar content = newPopup.contentElement();\r\n\t\t\t\tif(!content) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tsharedPopPnl.appendChild(content);\r\n\t\t\t\tcontent.style.border = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.show = function(activePop, left, top, width, height, ajustX, ajustY) {\r\n\t\t\tcreatePanel();\r\n\t\t\tif(activePopup !== activePop) {\r\n\t\t\t\tthis.hide();\r\n\t\t\t\tchangeContent(activePop);\r\n\t\t\t}\r\n\t\t\tactivePopup = activePop;\r\n\t\t\t\r\n\t\t\tleft = parseInt(left);\r\n\t\t\ttop = parseInt(top);\r\n\t\t\t\r\n\t\t\tif (height) {\r\n\t\t\t\tsharedPopPnl.style.height = parseInt(height) + 'px';\r\n\t\t\t}\r\n\t\t\tif (width) {\r\n\t\t\t\tsharedPopPnl.style.width = parseInt(width) + 'px';\r\n\t\t\t}\r\n\t\t\tvar jqWin = jQuery(window),\r\n\t\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\t\twinHeight = jqWin.scrollTop() + jqWin.height(),\r\n\t\t\t\tpanel = jQuery(sharedPopPnl),\r\n\t\t\t\tw = panel.outerWidth(),\r\n\t\t\t\th = panel.outerHeight();\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tleft -= w;\r\n\t\t\t}\r\n\t\t\tif(left + w > winWidth) {\r\n\t\t\t\tleft += winWidth - left - w - 1;\r\n\t\t\t}\r\n\t\t\tif(top + h > winHeight) {\r\n\t\t\t\ttop -= (h + 2 + ajustY);\r\n\t\t\t}\r\n\t\t\tif(left < 0) {\r\n\t\t\t\tleft = 1;\r\n\t\t\t}\r\n\t\t\tif(top < 0) {\r\n\t\t\t\ttop = 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (top) {\r\n\t\t\t\tsharedPopPnl.style.top = top + 'px';\r\n\t\t\t}\r\n\t\t\tif (left) {\r\n\t\t\t\tsharedPopPnl.style.left = left + 'px';\r\n\t\t\t}\r\n\t\t\tsharedPopPnl.style.display = 'block';\r\n\t\t};\r\n\t\t\r\n\t\tthis.hide = function() {\r\n\t\t\tif(activePopup) {\r\n\t\t\t\tif (sharedPopPnl) {\r\n\t\t\t\t\tsharedPopPnl.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tvar hideCallBack = activePopup.onHidePopup();\r\n\t\t\t\tif(hideCallBack) {\r\n\t\t\t\t\thideCallBack.call(activePopup);\r\n\t\t\t\t}\r\n\t\t\t\tactivePopup = null;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\t/**\r\n\t\t * Check the specified element is in the active popup panel or not. If it is not in the popup panel, hide the popup panel. \r\n\t\t */\r\n\t\tthis.checkAndHide = function(el) {\r\n\t\t\tif(!activePopup) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (jslet.ui.isChild(activePopup.excludedElement(), el) ||\r\n\t\t\t\t\tinPopupPanel(el)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.hide();\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\t\r\n\t\tthis.destroy = function() {\r\n\t\t\tif(!sharedPopPnl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdocument.body.removeChild(sharedPopPnl);\r\n\t\t\tjQuery(sharedPopPnl).off();\r\n\t\t\tjQuery(document).off('click', documentClickHandler);\r\n\t\t}; \r\n\t};\r\n\t\r\n\tjslet.ui.PopupPanel.popupElement = new PopupElement();\r\n})();\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * ProgressBar. Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"ProgressBar\",value:10, labelText: 'Starting...']};\r\n * \r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' style=\"width: 300px\"></div>\r\n *  \r\n *     //2. Binding\r\n *       <div id='ctrlId'></div>\r\n *     //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.ProgressBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'styleClass,value,labelText';\r\n\r\n\t\tZ._value = 0;\r\n\t\t\r\n\t\tZ._labelText = '0%';\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar value.\r\n\t * \r\n\t * @param {Integer | undefined} value Progress bar value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tvalue = parseInt(value);\r\n\t\tif(!value) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value > 100) {\r\n\t\t\tvalue = 100;\r\n\t\t}\r\n\t\tthis._value = value;\r\n\t\tthis._setValue();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar label text.\r\n\t * \r\n\t * @param {String | undefined} labelText Progress bar label text.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlabelText: function(labelText) {\r\n\t\tif(labelText === undefined) {\r\n\t\t\treturn this._labelText;\r\n\t\t}\r\n\t\tthis._labelText = labelText;\r\n\t\tif(this.binded) {\r\n\t\t\tvar jqEl = jQuery(this.el);\r\n\t\t\tvar jqLabel = jqEl.find('.jl-progressbar-label');\r\n\t\t\tjqLabel.text(labelText);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-progressbar')) {\r\n\t\t\tjqEl.addClass('jl-progressbar jl-border-box jl-round5');\r\n\t\t}\r\n\t\tjqEl.attr('role', 'progressbar').attr('aria-valuemax', '100').attr('aria-valuemin', '0').attr('aria-valuenow', this._value);\r\n\t\tjqEl.html('<div class=\"jl-progressbar-label\">' + Z._labelText + '</div><div class=\"jl-progressbar-value\"></div>');\r\n\t},\r\n\t\r\n\t_setValue: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.binded) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar jqLabel = jqEl.find('.jl-progressbar-label');\r\n\t\tvar jqValue = jqEl.find('.jl-progressbar-value');\r\n\t\tZ._oldValue = -1;\r\n\t\tvar value = Z._value, strValue = value + '%';\r\n\t\tif(value != Z._oldValue) {\r\n\t\t\tjqLabel.text(strValue);\r\n\t\t\tjqValue.css('width', strValue);\r\n\t\t\tjqEl.attr('aria-valuenow', value);\r\n\t\t\tZ._oldValue = value;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('ProgressBar', jslet.ui.ProgressBar);\r\njslet.ui.ProgressBar.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.Control\r\n * \r\n * ProgressBar. Example:\r\n * \r\n *     @example\r\n *     var progressObj = jslet.ui.ProgressPopup(document.body, 'saving...');\r\n *     progressObj.value(40);\r\n *     progressObj.show();\r\n *\r\n * @param {HtmlElement} container The container where the progress popup control show in.\r\n * @param {String} caption The progress caption.\r\n * @param {Boolean} cancellable True - the progress popup can be cancelled, false - otherwise.\r\n * @param {Function} onCancelled The cancelled event, fired when user clicking the close button.\r\n * \r\n */\r\njslet.ui.ProgressPopup = function(container, caption, cancellable, onCancelled) {\r\n\tjslet.Checker.test('ProgressPopus#container', container).isHTMLElement();\r\n\tjslet.Checker.test('ProgressPopus#onCancelled', onCancelled).isFunction();\r\n\t\r\n\tthis._dialog = null;\r\n\tthis._value = 0;\r\n\tthis._cancellable = false;\r\n\tif(cancellable !== undefined) {\r\n\t\tthis._cancellable = !!cancellable;\r\n\t}\r\n\tthis._onCancelled = onCancelled;\r\n\t\r\n\tthis.initialize(container || document.body, caption || '');\r\n};\r\n\r\njslet.ui.ProgressPopup.prototype = {\r\n\t\t\r\n\tinitialize: function(container, caption) {\r\n\t\tvar opt = { type: 'window', caption: caption, isCenter: true, resizable: true, minimizable: false, closable: this._cancellable, maximizable: false, \r\n\t\t\t\twidth: 500, height: 80, animation: 'fade', onClosed: this._onCancelled};\r\n\t\tvar owin = jslet.ui.createControl(opt, container);\r\n\t\tvar html = '<div name=\"progressBar\" data-jslet=\"type: \\'ProgressBar\\'\" style=\"width: 100%\"/>';\r\n\t\towin.setContent(html);\r\n\t\tthis._dialog = owin;\r\n\t\tjslet.ui.install(owin.el);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show progress popup control.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tshow: function() {\r\n\t\tthis._dialog.showModal();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get progress bar value.\r\n\t * \r\n\t * @param {Integer | undefined} value Progress bar value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tvalue = parseInt(value);\r\n\t\tif(!value) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif(value > 100) {\r\n\t\t\tvalue = 100;\r\n\t\t}\r\n\t\tthis._value = value;\r\n\t\tvar progressBar = jQuery(this._dialog.el).find('[name=progressBar]')[0].jslet;\r\n\t\tprogressBar.value(value);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close and destroy the progress popup control.\r\n\t */\r\n\tdestroy: function(){\r\n\t\tif(this._dialog) {\r\n\t\t\tthis._dialog.close();\r\n\t\t\tthis._dialog = null;\r\n\t\t}\r\n\t}\r\n};\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRating. A control which usually displays some star to user, and user can click to rate something. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRating\",dataset:\"employee\",field:\"grade\", itemCount: 5};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRating\",dataset:\"employee\",field:\"grade\"', itemCount: 5' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.Rating = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t_isDBControl: false,\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,value,itemCount,splitCount,readOnly';\r\n\t\t\r\n\t\tZ._itemCount = 5;\r\n\r\n\t\tZ._splitCount = 0;\r\n\t\t\r\n\t\tZ._itemWidth = 0;\r\n\t\t\r\n\t\tZ._value = 0;\r\n\t\t\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ._isReady = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the rate item count, In other words, the count of 'Star' sign.\r\n\t * \r\n\t * @param {Integer | undefined} itemCount Rate item count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\titemCount: function(itemCount) {\r\n\t\tif(itemCount === undefined) {\r\n\t\t\treturn this._itemCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.itemCount', itemCount).isGTZero();\r\n\t\tthis._itemCount = parseInt(itemCount);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the rating value.\r\n\t * \r\n\t * @param {Number | undefined} value Rating value.\r\n\t * \r\n\t * @return {this | Number}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.value', value).isGTZero();\r\n\t\tthis._value = value;\r\n\t\tif(this._isReady) {\r\n\t\t\tthis._setValue(value);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identity whether the rating is read only or not.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly True - the rating is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Value splitCount for one item. <br />\r\n\t * if \"splitCount\" is 0.5, the possible value will be 0.5, 1, 1.5, ... <br />\r\n\t * if \"splitCount\" is 0.25, the possible value will be 0.25, 0.5, 0.75, 1, 1.25, 1.5, ... \r\n\t * \r\n\t * @param {Integer | undefined} splitCount \r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tsplitCount: function(splitCount) {\r\n\t\tif(splitCount === undefined) {\r\n\t\t\treturn this._splitCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.splitCount', splitCount).isGTEZero();\r\n\t\tthis._splitCount = splitCount;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-rating')) {\r\n\t\t\tjqEl.addClass('jl-rating');\r\n\t\t}\r\n\r\n\t\tZ.renderAll();\r\n\t\tjqEl.on('mousemove', 'td', jQuery.proxy(Z._mouseMove, Z));\r\n\t\tjqEl.on('mouseleave', jQuery.proxy(Z._mouseOut, Z));\r\n\t\tjqEl.on('mouseup', 'td', jQuery.proxy(Z._mouseUp, Z));\r\n\t\tZ._isReady = true;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\ti, len, \r\n\t\t\thtml1 = '',\r\n\t\t\thtml2 = '',\r\n\t\t\tsTd = '<td><i class=\"fa fa-star\" aria-hidden=\"true\"></i></td>';\r\n\t\tfor(i = 0, len = Z._itemCount; i < len; i++) {\r\n\t\t\thtml1 += sTd;\r\n\t\t\thtml2 += sTd;\r\n\t\t}\r\n\t\tvar html = '<div class=\"jl-rating\"><table><tr>' + html1 +\r\n\t\t\t'</tr></table><div class=\"jl-rating-value\"><table><tr>' + html2 + \r\n\t\t\t'</tr></table></div></div>';\r\n\t\tjqEl.html(html);\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ._itemWidth = jqEl.find('td:first').outerWidth();\r\n\t\t\tZ._setValue(Z._value);\r\n\t\t}, 5);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_mouseMove: function domove(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-rating-value').width(Z._getMovedWidth(event));\r\n\t\tZ._changed = true;\r\n\t},\r\n\r\n\t_getMovedWidth: function(event) {\r\n\t\tvar otd = event.currentTarget,\r\n\t\t\tcellIndex = otd.cellIndex;\r\n\t\treturn this._itemWidth * cellIndex + event.offsetX;\r\n\t},\r\n\t\r\n\t_mouseOut: function doout(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._changed) {\r\n\t\t\tZ._setValue(Z._value);\r\n\t\t}\r\n\t},\r\n\r\n\t_mouseUp: function dodown(event) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._changed = false;\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tmovedWidth = Z._getMovedWidth(event);\r\n\r\n\t\tZ._value = Z._round(Z._itemCount * movedWidth / (Z._itemCount * Z._itemWidth));\r\n\t\tZ.doUIChanged();\r\n\t},\r\n\t\r\n\t_round: function(value) {\r\n\t\tvar splitCount = this._splitCount;\r\n\t\tif(!splitCount || splitCount === 1) {\r\n\t\t\treturn Math.ceil(value);\r\n\t\t}\r\n\t\tvar intPart = parseInt(value),\r\n\t\t\tdecPart = value - intPart,\r\n\t\t\tunit = 1 / splitCount,\r\n\t\t\tceil;\r\n\t\tfor(var i = 1, len = splitCount; i <= len; i++) {\r\n\t\t\tceil = i * unit;\r\n\t\t\tif(decPart < ceil) {\r\n\t\t\t\treturn intPart + ceil; \r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\t_setValue: function(value) {\r\n\t\tjslet.Checker.test('Rating.value', value).isNumber();\r\n\t\tif(value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\titemCnt = Z._itemCount;\r\n\t\tif(value > itemCnt) {\r\n\t\t\tvalue = itemCnt;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-rating-value').width(value * Z._itemWidth);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('Rating', jslet.ui.Rating);\r\njslet.ui.Rating.htmlTemplate = '<Div></Div>';\r\n\n/**\r\n* @class \r\n* \r\n* TipPanel. Example:\r\n* \r\n*     @example\r\n*     var tipPnl = new jslet.ui.TipPanel();\r\n*     tipPnl.show('Hello world', 10, 10);\r\n*/\r\njslet.ui.TipPanel = function () {\r\n\tthis._hideTimerId = null;\r\n\tthis._showTimerId = null;\r\n\tthis._oldElement = null;\r\n\tvar p = document.createElement('div');\r\n\tjQuery(p).addClass('jl-tip-panel');\r\n\tdocument.body.appendChild(p);\r\n\tthis._tipPanel = p;\r\n\r\n\t/**\r\n\t * Show tips at specified position. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tipPnl.show('foo...', event);\r\n\t *     tipPnl.show('foo...', 100, 200);\r\n\t * \r\n\t * @param {String} tips Tips text.\r\n\t * @param {Integer | MouseEvent} leftOrEvent Position left or mouse event, if it is mouse event, the \"top\" argument is undefined.\r\n\t * @param {Integer | undefined} top Position top.\r\n\t */\r\n\tthis.show = function (tips, leftOrEvent, top) {\r\n\t\tvar Z = this;\r\n\t\tvar len = arguments.length;\r\n\t\tvar isSameCtrl = false, left = leftOrEvent;\r\n\t\tif (len == 2) { //this.show(tips)\r\n\t\t\tvar evt = left;\r\n\t\t\tevt = jQuery.event.fix( evt );\r\n\r\n\t\t\ttop = evt.pageY + 16; left = evt.pageX + 2;\r\n\t\t\tvar ele = evt.currentTarget;\r\n\t\t\tisSameCtrl = (ele === Z._oldElement);\r\n\t\t\tZ._oldElement = ele;\r\n\t\t} else {\r\n\t\t\tleft = parseInt(left);\r\n\t\t\ttop = parseInt(top);\r\n\t\t}\r\n\r\n\t\tif (Z._hideTimerId) {\r\n\t\t\twindow.clearTimeout(Z._hideTimerId);\r\n\t\t\tif (isSameCtrl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._showTimerId = window.setTimeout(function () {\r\n\t\t\tvar p = Z._tipPanel;\r\n\t\t\tp.innerHTML = tips;\r\n\t\t\tp.style.left = left + 'px';\r\n\t\t\tp.style.top = top + 'px';\r\n\t\t\tZ._tipPanel.style.display = 'block';\r\n\t\t\tZ._showTimerId = null;\r\n\t\t}, 300);\r\n\t};\r\n\r\n\t/**\r\n\t * Hide tip panel.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._showTimerId) {\r\n\t\t\twindow.clearTimeout(Z._showTimerId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hideTimerId = window.setTimeout(function () {\r\n\t\t\tZ._tipPanel.style.display = 'none';\r\n\t\t\tZ._hideTimerId = null;\r\n\t\t\tZ._oldElement = null;\r\n\t\t}, 300);\r\n\t};\r\n};\r\n\n/**\r\n * @class \r\n * \r\n * WaitingBox. Example:\r\n * \r\n *     @example\r\n *     var wb = new jslet.ui.WaitingBox(document.getElementById(\"test\"), \"Gray\", true);\r\n *\t   wb.show(\"Please wait a moment...\");\r\n * \r\n * @param {HtmlElement} container The container which waiting box resides on.\r\n * @param {String} overlayColor Overlay color.\r\n * @param {Boolean} tipsAtNewLine Tips is at new line or not. If false, tips and waiting icon is at the same line.\r\n */\r\njslet.ui.WaitingBox = function (container, overlayColor, tipsAtNewLine) {\r\n\tvar overlay = new jslet.ui.OverlayPanel(container);\r\n\tvar s = '<div class=\"jl-waitingbox jl-round4\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw jl-waitingbox-icon\"></i>';\r\n\t\ts += '<span class=\"jl-waitingbox-text\"></span></div>';\r\n\r\n\tjQuery(overlay.overlayPanel).html(s);\r\n\r\n\t/**\r\n\t * Show waiting box.\r\n\t * \r\n\t * @param {String} tips Tips.\r\n\t */\r\n\tthis.show = function (tips) {\r\n\t\tvar p = overlay.overlayPanel,\r\n\t\t\tbox = p.firstChild,\r\n\t\t\ttipPanel = box.childNodes[1];\r\n\t\ttipPanel.innerHTML = tips ? tips : '';\r\n\t\tvar jqPnl = jQuery(p),\r\n\t\t\tph = jqPnl.height(),\r\n\t\t\tpw = jqPnl.width();\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar jqBox = jQuery(box);\r\n\t\t\tbox.style.top = Math.round((ph - jqBox.height()) / 2) + 'px';\r\n\t\t\tbox.style.left = Math.round((pw - jqBox.width()) / 2) + 'px';\r\n\t\t}, 10);\r\n\r\n\t\toverlay.show();\r\n\t};\r\n\r\n\t/**\r\n\t * Hide waiting box.\r\n\t */\r\n\tthis.hide = function () {\r\n\t\toverlay.hide();\r\n\t};\r\n\r\n\t/**\r\n\t * Destroy waiting box.\r\n\t */\r\n\tthis.destroy = function () {\r\n\t\toverlay.overlayPanel.innerHTML = '';\r\n\t\toverlay.destroy();\r\n\t};\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * Field control add-on.\r\n */\r\njslet.ui.FieldControlAddon = {\r\n\t/**\r\n\t * @property {String} field Field name if the add-on is another field, like: 'currency' \r\n\t */\r\n\tfield: null,\r\n\t/**\r\n\t * @property {String} content Fixed content if the add-on is the fixed content, like: 'kg'\r\n\t */\r\n\tcontent: null,\r\n\t\r\n\t/**\r\n\t * @property {String} width The add-on width.\r\n\t */\r\n\twidth: '10px'\r\n};\r\n\r\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBPlace. It's an placeholder for other DBControls. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBPlace\",dataset: \"dataset\", \"field\":\"fieldName\", suffix: [{\"content\": \"KG\", \"width\": \"10px\"}] };\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBPlace = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field,prefix,suffix,expandChildWidth';\r\n\t\t\r\n\t\tthis.editControl = null;\r\n\t\t\r\n\t\tthis._expandChildWidth = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Prefix of this control. Example:\r\n\t * \r\n\t *     @example\r\n\t *     dbPlaceObj.prefix([{field: '', content: '', width: 30}]);\r\n\t * \r\n\t * @param {jslet.ui.FieldControlAddon[] | undefined} prefix - The prefix settings.\r\n\t * \r\n\t * @return {this | jslet.ui.FieldControlAddon[]}\r\n\t */\r\n\tprefix: function(prefix) {\r\n\t\tif(prefix === undefined) {\r\n\t\t\treturn this._prefix;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBPlace#prefix', prefix).isArray();\r\n\t\tvar setting;\r\n\t\tfor(var i = 0, len = prefix.length; i < len; i++) {\r\n\t\t\tsetting = prefix[i];\r\n\t\t\tif(!setting.field && !setting.content) {\r\n\t\t\t\tthrow new Error('In DBPlace#prefix setting, one of property \"field\" or \"content\" is required!');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(prefix && prefix.length === 0) {\r\n\t\t\tprefix = null;\r\n\t\t}\r\n\t\tthis._prefix = prefix;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * Suffix of this control. Example:\r\n\t * \r\n\t *     @example\r\n\t *     dbPlaceObj.suffix([{field: '', content: '', width: 30}]);\r\n\t * \r\n\t * @param {jslet.ui.FieldControlAddon[] | undefined} suffix - The suffix settings. \r\n\t * \r\n\t * @return {this | jslet.ui.FieldControlAddon[]}\r\n\t */\r\n\tsuffix: function(suffix) {\r\n\t\tif(suffix === undefined) {\r\n\t\t\treturn this._suffix;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBPlace#suffix', suffix).isArray();\r\n\t\tjslet.Checker.test('DBPlace#suffix', suffix).isArray();\r\n\t\tvar setting;\r\n\t\tfor(var i = 0, len = suffix.length; i < len; i++) {\r\n\t\t\tsetting = suffix[i];\r\n\t\t\tif(!setting.field && !setting.content) {\r\n\t\t\t\tthrow new Error('In DBPlace#suffix setting, one of property \"field\" or \"content\" is required!');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(suffix && suffix.length === 0) {\r\n\t\t\tsuffix = null;\r\n\t\t}\r\n\t\tthis._suffix = suffix; \r\n\t\treturn this;\r\n\t},\r\n\t\r\n\texpandChildWidth: function(expandChildWidth) {\r\n\t\tif(expandChildWidth === undefined) {\r\n\t\t\treturn this._expandChildWidth;\r\n\t\t}\r\n\t\tthis._expandChildWidth = expandChildWidth? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA &&\r\n\t\t\tZ._field == evt.fieldName && \r\n\t\t\t(evt.metaName == 'editControl' || evt.metaName == 'valueStyle')) {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\t\r\n\t\tvar fldName, i, len,\r\n\t\t\thasAddon = Z._prefix || Z._suffix;\r\n\t\tif(!hasAddon) {\r\n\t\t\tZ._renderEditor(Z._field, Z.el);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tjQuery(Z.el).addClass('jl-comb-editor');\r\n\t\tif(Z._prefix) {\r\n\t\t\tZ._renderOtherPart(Z.el, Z._prefix);\r\n\t\t}\r\n\t\tvar editorEl = Z._renderEditor(Z._field, Z.el);\r\n\t\tjQuery(editorEl).addClass('jl-comb-master');\r\n\t\t\r\n\t\tif(Z._suffix) {\r\n\t\t\tZ._renderOtherPart(Z.el, Z._suffix);\r\n\t\t}\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_renderEditor: function(fldName, parentEl) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(fldName),\r\n\t\t\tparam = fldObj.editControl();\r\n\t\tif (fldObj.valueStyle() == jslet.data.FieldValueStyle.BETWEEN && Z._valueIndex === undefined) {\r\n\t\t\tparam = {\r\n\t\t\t\ttype: 'DBBetweenEdit'\r\n\t\t\t};\r\n\t\t}\r\n\t\tparam.dataset = Z._dataset;\r\n\t\tparam.field = fldName;\r\n\t\tif(Z._valueIndex !== undefined) {\r\n\t\t\tparam.valueIndex = Z._valueIndex;\r\n\t\t}\r\n\t\tif(Z._tabIndex || Z._tabIndex === 0) {\r\n\t\t\tparam.tabIndex = Z._tabIndex;\r\n\t\t}\r\n\t\tvar dbCtrl = jslet.ui.createControl(param, parentEl);\r\n\t\tZ.addChildControl(dbCtrl);\r\n\t\tif(dbCtrl.tableId) {\r\n\t\t\tdbCtrl.tableId(Z._tableId);\r\n\t\t}\r\n\t\tvar elId = jslet.nextId();\r\n\t\tdbCtrl.el.id = elId;\r\n\t\treturn dbCtrl.el;\r\n\t},\r\n\t\r\n\t_renderOtherPart: function(ctrlDiv, arrPrefixOrSuffix) {\r\n\t\tvar fixCfg, editorEl, width, partEl, \r\n\t\t\tjqCtrlDiv = jQuery(ctrlDiv);\r\n\t\tfor(var i = 0, len = arrPrefixOrSuffix.length; i < len; i++) {\r\n\t\t\tfixCfg = arrPrefixOrSuffix[i];\r\n\t\t\twidth = fixCfg.width;\r\n\t\t\tvar id = jslet.nextId();\r\n\t\t\tjqCtrlDiv.append('<span id = \"' + id + '\"></span>');\r\n\t\t\tpartEl = document.getElementById(id);\r\n\t\t\tif(fixCfg.field) {\r\n\t\t\t\t this._renderEditor(fixCfg.field, partEl);\r\n\t\t\t} else if(fixCfg.content) {\r\n\t\t\t\tpartEl.innerHTML = fixCfg.content;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('prefix or suffix: field or content is required!');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(!width) {\r\n\t\t\t\tconsole.warn('Width is empty, use 5% instead!');\r\n\t\t\t\twidth = '5%';\r\n\t\t\t}\r\n\t\t\tjQuery(partEl).addClass('jl-comb-addon').children().first().addClass('input-sm');\r\n\t\t\t\r\n\t\t\tpartEl.style.width = width;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPlace', jslet.ui.DBPlace);\r\njslet.ui.DBPlace.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBText is a powerful control, it can input any data type, like: Number, Date etc. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBText,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBText,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBText = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll,readOnly';\r\n\r\n\t\t/**\r\n\t\t * @protected\r\n\t\t */\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\t\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._enterProcessed = false;\r\n\t\t\r\n\t\tZ._autoSelectAll = true;\r\n\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ.oldValue = null;\r\n\t\tZ.editMask = null;\r\n\t\tZ._position = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeUpdateToDataset: function(beforeUpdateToDataset) {\r\n\t\tif(beforeUpdateToDataset === undefined) {\r\n\t\t\treturn this._beforeUpdateToDataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.beforeUpdateToDataset', beforeUpdateToDataset).isFunction();\r\n\t\tthis._beforeUpdateToDataset = beforeUpdateToDataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tenableInvalidTip: function(enableInvalidTip) {\r\n\t\tif(enableInvalidTip === undefined) {\r\n\t\t\treturn this._enableInvalidTip;\r\n\t\t}\r\n\t\tthis._enableInvalidTip = enableInvalidTip? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly? true: false;\r\n\t\tif(readOnly) {\r\n\t\t\tthis.el.readOnly = true;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether selecting all text when the text box got focus.\r\n\t * \r\n\t * @param {Boolean | undefined} autoSelectAll True - select all text, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoSelectAll: function(autoSelectAll) {\r\n\t\tif(autoSelectAll === undefined) {\r\n\t\t\treturn this._autoSelectAll;\r\n\t\t}\r\n\t\tthis._autoSelectAll = autoSelectAll? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' && \r\n\t\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('form-control input-sm');\r\n\t\tZ.el.name = Z._field;\r\n\t\tif (Z.doFocus) {\r\n\t\t\tjqEl.on('focus', jQuery.proxy(Z.doFocus, Z));\r\n\t\t}\r\n\t\tif (Z.doBlur) {\r\n\t\t\tjqEl.on('blur', jQuery.proxy(Z.doBlur, Z));\r\n\t\t}\r\n\t\tif (Z.doKeydown) {\r\n\t\t\tjqEl.on('keydown', Z.doKeydown);\r\n\t\t}\r\n\t\tif (Z.doKeypress) {\r\n\t\t\tjqEl.on('keypress', Z.doKeypress);\r\n\t\t}\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipFocusEvent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\tZ.doValueChanged();\r\n\t\tZ.oldValue = Z.el.value;\r\n\t\tif(Z._autoSelectAll) {\r\n\t\t\tjslet.ui.TextUtil.selectText(Z.el);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(jqEl.attr('readOnly') || jqEl.attr('disabled')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t\tZ._isBluring = true;\r\n\t\ttry {\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tZ._isBluring = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which;\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tvar Z = this.jslet,\r\n\t\t\tK = jslet.ui.KeyCode;\r\n\t\tif(keyCode === K.ENTER) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\t//Process 'ArrowUp', 'ArrowDown', 'PageUp', 'PageDown' key when it is editing. \r\n\t\tvar isEditing = Z._dataset.status() > 0;\r\n\t\tif(isEditing && (keyCode === K.UP || keyCode === K.DOWN || keyCode === K.PAGEUP || keyCode === K.PAGEDOWN)) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.readOnly() && !fldObj.disabled() && (keyCode === K.BACKSPACE || keyCode === K.DELETE)) {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t}\r\n\t\tif(keyCode === K.LEFT || keyCode === K.RIGHT) { //Arrow-left, Arrow-right\r\n\t\t\tvar pos = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\t\tif((keyCode === K.LEFT && pos.begin > 0) || \r\n\t\t\t\t\t(keyCode === 39 && pos.begin < Z.el.value.length)) {\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tvar Z = this.jslet,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which,\r\n\t\t\texistStr = jslet.cutString(Z.el.value, jslet.ui.TextUtil.getSelectedText(Z.el)),\r\n\t\t\tcursorPos = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\tif (!Z._dataset.fieldValidator().checkInputChar(fldObj, String.fromCharCode(keyCode), existStr, cursorPos.begin)) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tif(keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\tif(!Z._enterProcessed) {\r\n\t\t\t\tZ.updateToDataset();\r\n\t\t\t} else {\r\n\t\t\t\tZ._enterProcessed = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select text.\r\n\t * \r\n\t * @param {Integer} start (Optional) Start of cursor position.\r\n\t * @param {Integer} end (Optional) End of cursor position.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tselectText: function(start, end){\r\n\t\tjslet.ui.TextUtil.selectText(this.el, start, end);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Input a text into text control at current cursor position.\r\n\t * \r\n\t * @param {String} text The text need to be input.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tinputText: function(text) {\r\n\t\tif(!text) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.inputText#text', text).isString();\r\n\t\t\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(fldObj.getType() !== jslet.data.DataType.STRING) {\r\n\t\t\tconsole.warn('Only String Field can be input!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ch, chs = [];\r\n\t\tfor(var i = 0, len = text.length; i < len; i++) {\r\n\t\t\tch = text[i];\r\n\t\t\tif (Z._dataset.fieldValidator().checkInputChar(fldObj, ch)) {\r\n\t\t\t\tchs.push(ch);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z._position) {\r\n\t\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\r\n\t\t}\r\n\t\tvar subStr = chs.join(''),\r\n\t\t\tvalue =Z.el.value,\r\n\t\t\tbegin = Z._position.begin,\r\n\t\t\tend = Z._position.end;\r\n\t\tvar prefix = value.substring(0, begin), \r\n\t\t\tsuffix = value.substring(end); \r\n\t\tZ.el.value = prefix + text + suffix;\r\n\t\tZ._position = jslet.ui.TextUtil.getCursorPos(Z.el);\t\t\r\n\t\tZ.updateToDataset();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function ($super, evt, isForce) {\r\n\t\tif($super(evt, isForce) && this.afterRefreshControl) {\r\n\t\t\tthis.afterRefreshControl(evt);\r\n\t\t}\r\n\t}, \r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!Z._readOnly && (!metaName || metaName == \"disabled\" || metaName == \"readOnly\")) {\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, fldObj.disabled(), fldObj.readOnly(), false, fldObj.required());\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'editMask') {\r\n\t\t\tvar editMaskCfg = fldObj.editMask();\r\n\t\t\tif (editMaskCfg) {\r\n\t\t\t\tif(!Z.editMask) {\r\n\t\t\t\t\tZ.editMask = new jslet.ui.EditMask();\r\n\t\t\t\t\tZ.editMask.attach(Z.el);\r\n\t\t\t\t}\r\n\t\t\t\tvar mask = editMaskCfg.mask,\r\n\t\t\t\t\tkeepChar = editMaskCfg.keepChar,\r\n\t\t\t\t\ttransform = editMaskCfg.transform;\r\n\t\t\t\tZ.editMask.setMask(mask, keepChar, transform);\r\n\t\t\t} else {\r\n\t\t\t\tif(Z.editMask) {\r\n\t\t\t\t\tZ.editMask.detach();\r\n\t\t\t\t\tZ.editMask = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\t\r\n\t\tZ.el.maxLength = fldObj.getEditLength();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText || Z._dataset.getFieldText(Z._field);\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tvar align = fldObj.alignment();\r\n\t\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tif (align == 'left') {\r\n\t\t\t\talign= 'right';\r\n\t\t\t} else {\r\n\t\t\t\talign = 'left';\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.el.style.textAlign = align;\r\n\t\tvar value;\r\n\t\tif (Z.editMask){\r\n\t\t\tvalue = Z.getText();\r\n\t\t\tZ.editMask.setValue(value);\r\n\t\t} else {\r\n\t\t\tif (document.activeElement != Z.el || Z.el.readOnly || Z._isBluring) {\r\n\t\t\t\tvalue = Z.getText(false);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getText(true);\r\n\t\t\t}\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.STRING && fldObj.antiXss()) {\r\n\t\t\t\tvalue = jslet.htmlDecode(value);\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t}\r\n\t\tZ.oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tthis.doValueChanged();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t}, // end renderAll\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar value = Z.el.value;\r\n\t\tif(Z.oldValue == value) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tif (this.editMask && !this.editMask.validateValue()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (Z._beforeUpdateToDataset) {\r\n\t\t\tif (!Z._beforeUpdateToDataset.call(Z)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tif (Z.editMask) {\r\n\t\t\t\tvalue = Z.editMask.getValue();\r\n\t\t\t}\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tif (Z.editMask){\r\n\t\t\tZ.editMask.detach();\r\n\t\t\tZ.editMask = null;\r\n\t\t}\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\tZ.onKeyDown = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBText', jslet.ui.DBText);\r\njslet.ui.DBText.htmlTemplate = '<input type=\"text\"></input>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBPassword.\r\n */\r\njslet.ui.DBPassword = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tjQuery(el).attr('type', 'password');\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPassword', jslet.ui.DBPassword);\r\njslet.ui.DBPassword.htmlTemplate = '<input type=\"password\"></input>';\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBTextArea.\r\n */\r\njslet.ui.DBTextArea = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'textarea';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBTextArea', jslet.ui.DBTextArea);\r\njslet.ui.DBTextArea.htmlTemplate = '<textarea></textarea>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCustomComboBox: used for jslet.ui.DBComboSelect and jslet.ui.DBDatePicker.\r\n */\r\njslet.ui.DBCustomComboBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textReadOnly';\r\n\t\tZ._textReadOnly = false;\r\n\t\tZ.enableInvalidTip = false;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the text box is read only.\r\n\t * \r\n\t * @param {Boolean | undefined} textReadOnly True - text box is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\ttextReadOnly: function(textReadOnly) {\r\n\t\tif(textReadOnly === undefined) {\r\n\t\t\treturn this._textReadOnly;\r\n\t\t}\r\n\t\tthis._textReadOnly = textReadOnly ? true: false;\r\n\t\tif(this.textCtrl) {\r\n\t\t\tthis.textCtrl.readOnly(textReadOnly);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n//\t/**\r\n//\t * @protected\r\n//\t * @override\r\n//\t */\r\n//\tafterBind: function ($super) {\r\n//\t\t$super();\r\n//\t\t\r\n//\t\tif (this._textReadOnly) {\r\n//\t\t\tthis.el.childNodes[0].readOnly = true;\r\n//\t\t}\r\n//\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('input-group')) {\r\n\t\t\tjqEl.addClass('input-group input-group-sm');\r\n\t\t}\r\n\t\tvar btnCls = Z.comboButtonCls ? Z.comboButtonCls:'fa-caret-down'; \r\n\t\tvar s = '<input type=\"text\" class=\"form-control\">' + \r\n    \t'<span class=\"input-group-btn jl-comb-btn-group\"><button class=\"btn btn-default btn-sm \" tabindex=\"-1\"><i class=\"fa ' + btnCls + '\"></i></button></span>'; \r\n\t\tjqEl.html(s);\r\n\t\tvar dbtext = jqEl.find('[type=\"text\"]')[0];\r\n\t\tZ.textCtrl = new jslet.ui.DBText(dbtext, {\r\n\t\t\ttype: 'dbtext',\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._textField || Z._field,\r\n\t\t\tenableInvalidTip: true,\r\n\t\t\tvalueIndex: Z._valueIndex,\r\n\t\t\ttabIndex: Z._tabIndex,\r\n\t\t\treadOnly: Z._textReadOnly\r\n\t\t});\r\n\t\tjQuery(dbtext).on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.BACKSPACE && !this.value) {\r\n\t\t\t\tZ.buttonClick();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(dbtext).on('click', function(event) {\r\n\t\t\tif(Z._textReadOnly) {\r\n\t\t\t\tZ.buttonClick();\r\n\t\t\t}\r\n       \t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n       \t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tZ.addChildControl(Z.textCtrl);\r\n\t\t\r\n\t\tvar jqBtn = jqEl.find('button');\r\n\t\tif (this.buttonClick) {\r\n\t\t\t\r\n\t\t\tjqBtn.on('click', function(event){\r\n\t\t\t\tZ.buttonClick(jqBtn[0]);\r\n\t\t\t});\r\n\t\t\tjqBtn.focus(function(event) {\r\n\t\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t\t});\r\n\t\t\tjqBtn.blur(function(event) {\r\n\t\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function ($super, tableId) {\r\n\t\t$super(tableId);\r\n\t\tthis.textCtrl.tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._textReadOnly) {\r\n\t\t\tjQuery(Z.el).find('button').focus();\r\n\t\t} else {\r\n\t\t\tZ.textCtrl.focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this;\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tflag = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tjqEl.find('button').attr(\"disabled\", flag);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tvar dbbtn = Z.el.childNodes[1];\r\n\t\tdbbtn.onclick = null;\r\n\t\tjQuery(Z.textCtrl.el).off('keydown', this.popupUp);\r\n\t\tZ.textCtrl.destroy();\r\n\t\tZ.textCtrl = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBText\r\n * \r\n * DBAutoComplete. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBAutoComplete\",field:\"department\", matchType:\"start\"};\r\n *     //1. Declaring:\r\n *      <input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      \r\n *     //2. Binding\r\n *      <input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      //Js snippet\r\n *      var el = document.getElementById('cboAuto');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBAutoComplete = jslet.Class.create(jslet.ui.DBText, {\r\n\t\r\n\tMatchModes: ['start','end', 'any'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.allProperties) {\r\n\t\t\tZ.allProperties = 'styleClass,dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields';\r\n\t\t}\r\n\t\t\r\n\t\tZ._lookupField = null;\r\n\t\t\r\n\t\tZ._minChars = 0;\r\n\r\n\t\tZ._minDelay = 0;\r\n\t\t\r\n\t\tZ._beforePopup = null;\r\n\t\t\r\n\t\tZ._filterFields = null;\r\n\t\t\r\n\t\tZ._defaultFilterFields = null;\r\n\t\t\r\n\t\tZ._onGetFilterField = null;\r\n\t\t\r\n\t\tZ._matchMode = 'start';\r\n\t\t\r\n\t\tZ._timeoutHandler = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get lookup field name.\r\n\t * \r\n\t * @param {String | undefined} lookupField Lookup field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupField: function(lookupField) {\r\n\t\tif(lookupField === undefined) {\r\n\t\t\treturn this._lookupField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.lookupField', lookupField).isString();\r\n\t\tthis._lookupField = lookupField;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get minimum characters before searching. <br />\r\n\t * Suppose minChars = 3, when user input 1 character, the search panel would not pop up. After user input 3 characters, the search panel pops up.\r\n\t * \r\n\t * @param {Integer | undefined} minChars Minimum characters before searching.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminChars: function(minChars) {\r\n\t\tif(minChars === undefined) {\r\n\t\t\treturn this._minChars;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minChars', minChars).isGTEZero();\r\n\t\tthis._minChars = parseInt(minChars);\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get delay time(ms) before auto searching. If user input the value very quickly, the searching panel would not pop up.\r\n\t * \r\n\t * @param {Integer | undefined} minDelay Delay time.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminDelay: function(minDelay) {\r\n\t\tif(minDelay === undefined) {\r\n\t\t\treturn this._minDelay;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minDelay', minDelay).isGTEZero();\r\n\t\tthis._minDelay = parseInt(minDelay);\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get match mode.\r\n\t * \r\n\t * @param {String | undefined} matchMode match mode, optional values: 'start'(default), 'end', 'any'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tmatchMode: function(matchMode) {\r\n\t\tif(matchMode === undefined) {\r\n\t\t\treturn this._matchMode;\r\n\t\t}\r\n\t\tmatchMode = jQuery.trim(matchMode);\r\n\t\tvar checker = jslet.Checker.test('DBAutoComplete.matchMode', matchMode).isString();\r\n\t\tmatchMode = matchMode.toLowerCase();\r\n\t\tchecker.testValue(matchMode).inArray(this.MatchModes);\r\n\t\tthis._matchMode = matchMode;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get filter fields, more than one fields are separated with ','. <br />\r\n\t * Filter fields is used to match the inputting value.\r\n\t * \r\n\t * @param {String | undefined} filterFields Filter fields.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tfilterFields: function(filterFields) {\r\n\t\tvar Z = this;\r\n\t\tif(filterFields === undefined) {\r\n\t\t\treturn Z._filterFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.filterFields', filterFields).isString();\r\n\t\tZ._filterFields = filterFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get before pop up event handler, you can use this to customize the display result. Example:\r\n\t * \r\n\t *     @example\r\n\t *     autoCompleteObj.beforePopup(function(dataset, inputValue){});\r\n\t * \r\n\t * @param {Function | undefined} beforePopup Before pop up event handler.\r\n\t * @param {jslet.data.Dataset} beforePopup.dataset Dataset object.\r\n\t * @param {String} beforePopup.inputValue Input value.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforePopup: function(beforePopup) {\r\n\t\tif(beforePopup === undefined) {\r\n\t\t\treturn this._beforePopup;\r\n\t\t}\r\n\t\tthis._beforePopup = beforePopup;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get filter field event handler, you can use this to customize the display result.. Example:\r\n\t * \r\n\t *     @example\r\n\t *     autoCompleteObj.onGetFilterField(function(dataset, inputValue){});\r\n\t *   \r\n\t * @param {Function | undefined} onGetFilterField Filter field event handler.\r\n\t * @param {jslet.data.Dataset} onGetFilterField.dataset Dataset object.\r\n\t * @param {String} onGetFilterField.inputValue Input value.\r\n\t * @param {String} onGetFilterField.return Filter field name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonGetFilterField: function(onGetFilterField) {\r\n\t\tif(onGetFilterField === undefined) {\r\n\t\t\treturn this._onGetFilterField;\r\n\t\t}\r\n\t\tthis._onGetFilterField = onGetFilterField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' &&\r\n\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.el.disabled || Z.el.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\tif(Z._isSelecting) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar value = Z.el.value, canBlur = true;\r\n\t\t\tif(!Z._lookupField) {\r\n\t\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tvar\tlkf = fldObj.lookup(),\r\n\t\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif(value.length > 0 && lkds.recordCount() === 0) {\r\n\t\t\t\t\tcanBlur = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\t\tZ.contentPanel.closePopup();\r\n\t\t\t}\r\n\t\t\tZ.updateToDataset();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t\tif(!canBlur) {\r\n\t\t\t\tZ.el.focus();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ.updateToDataset();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t}\r\n\t},\r\n\r\n\tdoChange: null,\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\r\n\t\tvar keyCode = event.which, \r\n\t\t\tZ = this.jslet,\r\n\t\t\tK = jslet.ui.KeyCode;\r\n\t\tif(keyCode >= K.F1 && keyCode <= K.F12 || keyCode === K.SHIFT || keyCode === K.CONTROL || keyCode === K.ALT || \r\n\t\t\t\tkeyCode === K.CAPSLOCK || keyCode === K.INSERT || keyCode === K.HOME || keyCode === K.END || \r\n\t\t\t\tkeyCode === K.PAGEUP || keyCode === K.PAGEDOWN || keyCode === K.LEFT || keyCode === K.RIGHT) { \r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(keyCode === K.ESCAPE && Z.contentPanel) {\r\n\t\t\tZ.contentPanel.closePopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyCode === K.UP || keyCode === K.DOWN) {\r\n\t\t\tif(Z.contentPanel && Z.contentPanel.isPop) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\t\tlkf = fldObj.lookup(),\r\n\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif (keyCode === K.UP) { //up arrow\r\n\t\t\t\t\tlkds.prior();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t\tif (keyCode === K.DOWN) {//down arrow\r\n\t\t\t\t\tlkds.next();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!Z.tableId()) {\r\n\t\t\t\t\tZ._invokePopup();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t} \r\n\r\n\t\tif (keyCode === K.DELETE || keyCode === K.BACKSPACE || keyCode === K.IME) {\r\n\t\t\tZ._invokePopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyCode !== K.ENTER && keyCode !== K.TAB) {\r\n\t\t\tZ._invokePopup();\r\n\t\t} else if (Z.contentPanel) {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\tZ.contentPanel.confirmSelect();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n//\t\tvar keyCode = event.keyCode ? event.keyCode : \r\n//\t\t\tevent.which\t? event.which: event.charCode;\r\n//\t\tvar Z = this.jslet;\r\n//\t\tif (keyCode != 13 && keyCode != 9) {\r\n//\t\t\tZ._invokePopup();\r\n//\t\t} else if (Z.contentPanel) {\r\n//\t\t\tif(Z.contentPanel.isShowing()) {\r\n//\t\t\t\tZ.contentPanel.confirmSelect();\r\n//\t\t\t}\r\n//\t\t}\r\n\t},\r\n\r\n\t_invokePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._timeoutHandler) {\r\n\t\t\tclearTimeout(Z._timeoutHandler);\r\n\t\t}\r\n\t\tvar delayTime = 100;\r\n\t\tif (Z._minDelay) {\r\n\t\t\tdelayTime = parseInt(Z._minDelay);\r\n\t\t}\r\n\t\t\r\n\t\tZ._timeoutHandler = setTimeout(function () {\r\n\t\t\tZ._populate(Z.el.value); \r\n\t\t}, delayTime);\r\n\t},\r\n\r\n\t_getDefaultFilterFields: function(lookupFldObj) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._defaultFilterFields) {\r\n\t\t\treturn Z._defaultFilterFields;\r\n\t\t}\r\n\t\tvar codeFld = lookupFldObj.codeField(),\r\n\t\t\tnameFld = lookupFldObj.nameField(),\r\n\t\t\tlkDs = lookupFldObj.dataset(),\r\n\t\t\tcodeFldObj = lkDs.getField(codeFld),\r\n\t\t\tnameFldObj = lkDs.getField(nameFld),\r\n\t\t\tarrFields = [];\r\n\t\tif(codeFldObj && codeFldObj.visible()) {\r\n\t\t\tarrFields.push(codeFld);\r\n\t\t}\r\n\t\tif(codeFld != nameFld && nameFldObj && nameFldObj.visible()) {\r\n\t\t\tarrFields.push(nameFld);\r\n\t\t}\r\n\t\tZ._defaultFilterFields = arrFields;\r\n\t\treturn arrFields;\r\n\t},\r\n\t\r\n\t_getFilterFields: function(lkFldObj, inputValue) {\r\n\t\tvar Z = this;\r\n\t\tvar filterFlds = null;\r\n\t\t\r\n\t\tvar eventFunc = jslet.getFunction(Z._onGetFilterField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfilterFlds = eventFunc.call(Z, lkFldObj.dataset(), inputValue);\r\n\t\t\tjslet.Checker.test('DBAutoComplete.onGetFilterField#return', filterFlds).isString();\r\n\t\t}\r\n\t\tfilterFlds = filterFlds || Z._filterFields;\r\n\t\tvar arrFields;\r\n\t\tif (filterFlds) {\r\n\t\t\tarrFields = filterFlds.split(',');\r\n\t\t} else {\r\n\t\t\tarrFields = Z._getDefaultFilterFields(lkFldObj);\r\n\t\t}\r\n\t\tif(arrFields.length === 0) {\r\n\t\t\tthrow new Error('Not specified [filter fields]!');\r\n\t\t}\r\n\t\tvar filterValue = inputValue;\r\n\t\tif (Z._matchMode == 'start') {\r\n\t\t\tfilterValue = filterValue + '%';\r\n\t\t} else {\r\n\t\t\tif (Z._matchMode == 'end') {\r\n\t\t\t\tfilterValue = '%' + filterValue;\r\n\t\t\t} else {\r\n\t\t\t\tfilterValue = '%' + filterValue + '%';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, result = '';\r\n\t\tfor(var i = 0, len = arrFields.length; i < len; i++) {\r\n\t\t\tfldName = arrFields[i];\r\n\t\t\tif(i > 0) {\r\n\t\t\t\tresult += ' || ';\r\n\t\t\t}\r\n\t\t\tresult += 'like([' + fldName + '],\"' + filterValue + '\")';\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_populate: function (inputValue) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._minChars > 0 && inputValue && inputValue.length < Z._minChars) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\tlkFld = fldObj.lookup();\r\n\t\tif (!lkFld) {\r\n\t\t\tconsole.error(Z._field + ' is NOT a lookup field!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar lkds = lkFld.dataset(),\r\n\t\t\toldFlag = lkds.autoRefreshHostDataset();\r\n\t\tlkds.autoRefreshHostDataset(true);\r\n\t\ttry {\r\n\t\t\tvar\teditFilter = lkFld.editFilter();\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._beforePopup);\r\n\t\t\tif (eventFunc) {\r\n\t\t\t\teventFunc.call(Z, lkds, inputValue, editFilter);\r\n\t\t\t} else if (inputValue) {\r\n\t\t\t\tvar filter = Z._getFilterFields(lkFld, inputValue);\r\n\t\t\t\tif(editFilter) {\r\n\t\t\t\t\tif(filter) {\r\n\t\t\t\t\t\tfilter = '(' + editFilter + ') && (' + filter + ')';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfilter = editFilter;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlkds.filter(filter);\r\n\t\t\t\tlkds.filtered(true);\r\n\t\t\t} else {\r\n\t\t\t\tif(editFilter) {\r\n\t\t\t\t\tlkds.filter(editFilter);\r\n\t\t\t\t\tlkds.filtered(true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkds.filter(null);\r\n\t\t\t\t\tif(!lkds.fixedFilter()) {\r\n\t\t\t\t\t\tlkds.filtered(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tlkds.autoRefreshHostDataset(oldFlag);\r\n\t\t}\r\n\t\t//Clear field value which specified by 'lookupField'.\r\n\t\tif(Z._lookupField) {\r\n\t\t\tvar dataRec = Z._dataset.getRecord();\r\n\t\t\tif(dataRec) {\r\n\t\t\t\tdataRec[Z._lookupField] = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = new jslet.ui.DBAutoCompletePanel(Z);\r\n\t\t} else {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tr = jqEl.offset(),\r\n\t\t\th = jqEl.outerHeight(),\r\n\t\t\tx = r.left,\r\n\t\t\ty = r.top + h;\r\n\t\t\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth() - Z.contentPanel.dlgWidth;\r\n\t\t}\r\n\t\tZ.contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\t_destroyPopPanel: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z.contentPanel){\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function (isMetaChanged) {\r\n\t\tif(isMetaChanged) {\r\n\t\t\tthis._destroyPopPanel();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._destroyPopPanel();\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\n/**\r\n * @private\r\n * @class DBAutoCompletePanel\r\n * \r\n */\r\njslet.ui.DBAutoCompletePanel = function (autoCompleteObj) {\r\n\tvar Z = this;\r\n\tZ.dlgWidth = 320;\r\n\tZ.dlgHeight = 180;\r\n\r\n\tvar lkf, lkds;\r\n\tZ.comboCfg = autoCompleteObj;\r\n\tZ.dataset = autoCompleteObj.dataset();\r\n\tZ.field = autoCompleteObj.lookupField() || autoCompleteObj.field();\r\n\tZ.lkDataset = null;\r\n\r\n\tZ.confirmSelect = function () {\r\n\t\tZ.comboCfg._isSelecting = true;\r\n\t\tvar fldValue = Z.lkDataset.keyValue();\r\n\t\tif (fldValue || fldValue === 0) {\r\n\t\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z.valueIndex);\t\t\t\r\n\t\t\tZ.comboCfg.el.focus();\r\n\t\t}\r\n\t\tif (Z.comboCfg.afterSelect) {\r\n\t\t\tZ.comboCfg.afterSelect(Z.dataset, Z.lkDataset);\r\n\t\t}\r\n\t\tZ.closePopup();\r\n\t};\r\n\r\n\tfunction create () {\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t\tZ.panel.style.width = '100%';\r\n\t\t\tZ.panel.style.height = '100%';\r\n\t\t\tjQuery(Z.panel).on(\"mousedown\", function(event){\r\n\t\t\t\tZ.comboCfg._isSelecting = true;\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t});\r\n\t\t}\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tlkds = lkfld.dataset();\r\n\t\tZ.lkDataset = lkds;\r\n\t\tvar fields = lkds.getNormalFields(),\r\n\t\t\ttotalChars = 0;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.visible()) {\r\n\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 30;\r\n\t\tZ.dlgWidth = totalWidth;\r\n\t\tif(Z.dlgWidth < 150) {\r\n\t\t\tZ.dlgWidth = 150;\r\n\t\t}\r\n\t\tif(Z.dlgWidth > 500) {\r\n\t\t\tZ.dlgWidth = 500;\r\n\t\t}\r\n\r\n\t\tZ.panel.innerHTML = '';\r\n\r\n\t\tvar cntw = Z.dlgWidth - 4,\r\n\t\t\tcnth = Z.dlgHeight - 4,\r\n\t\t\ttableparam = { type: 'DBTable', dataset: lkds, readOnly: true, noborder:true, hasSelectCol: false, hasSeqCol: false, hideHead: true };\r\n\t\ttableparam.onRowClick = Z.confirmSelect;\r\n\r\n\t\tZ.otable = jslet.ui.createControl(tableparam, Z.panel, '100%', cnth);\r\n\t\tZ.otable.el.focus();\r\n\t\tZ.otable.el.style.border = \"0\";\r\n\t\t\r\n\t\treturn Z.panel;\r\n\t}\r\n\r\n\tZ.showPopup = function (left, top, ajustX, ajustY) {\r\n\t\tZ.comboCfg._isSelecting = false;\r\n\t\tZ.isPop = true;\r\n\t\tZ.popup.show(left, top, Z.dlgWidth, Z.dlgHeight, ajustX, ajustY);\r\n\t};\r\n\r\n\tZ.doClosePopup = function () {\r\n\t\tZ.isPop = false;\r\n\t\tvar oldRecno = Z.lkDataset.recno() || 0;\r\n\t\ttry {\r\n\t\t\tZ.lkDataset.filter(null);\r\n\t\t} finally {\r\n\t\t\tif(oldRecno >= 0) {\r\n\t\t\t\tZ.lkDataset.recno(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tZ.closePopup = function () {\r\n\t\tZ.popup.hide();\r\n\t};\r\n\t\r\n\tZ.isShowing = function(){\r\n\t\treturn Z.isPop;\r\n\t};\r\n\t\r\n\tcreate();\r\n\tZ.popup = new jslet.ui.PopupPanel(autoCompleteObj.el);\r\n\tZ.popup.contentElement(Z.panel);\r\n\tZ.popup.onHidePopup(Z.doClosePopup);\r\n\tZ.isPop = false;\r\n\t\r\n\tZ.destroy = function(){\r\n\t\tjQuery(Z.panel).off();\r\n\t\tZ.otable.onRowClick = null;\r\n\t\tZ.otable.destroy();\r\n\t\tZ.otable = null;\r\n\t\tZ.panel = null;\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\tZ.comboCfg = null;\r\n\t\tZ.dataset = null;\r\n\t\tZ.field = null;\r\n\t\tZ.lkDataset = null;\r\n\t};\r\n};\r\n\r\njslet.ui.register('DBAutoComplete', jslet.ui.DBAutoComplete);\r\njslet.ui.DBAutoComplete.htmlTemplate = '<input type=\"text\"></input>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBBetweenEdit. <br /> \r\n * It implements \"From ... To ...\" style editor. This editor usually use in query parameter editor. <br />\r\n * Example:\r\n * \r\n *     @example\r\n *       var jsletParam = {type:\"DBBetweenEdit\",\"field\":\"dateFld\"};\r\n *\r\n *     //1. Declaring:\r\n *       <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBBetweenEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\tthis._minEleId = null;\r\n\t\tthis._maxEleId = null;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @hide\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\treturn;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar lbl = jsletlocale.Dataset.betweenLabel;\r\n\t\tif (!lbl) {\r\n\t\t\tlbl = '-';\r\n\t\t}\r\n\t\tlbl = '&nbsp;' + lbl + '&nbsp;';\r\n\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tvar ctrlCfg = {};\r\n\t\tctrlCfg.dataset = Z._dataset.name();\r\n\t\tctrlCfg.field = Z._field;\r\n\t\tctrlCfg.type = 'DBPlace';\r\n\t\tctrlCfg.valueIndex = 0;\r\n\t\t\r\n\t\tvar template = \r\n\t\t\t'<div class=\"input-group\">' + \r\n\t\t\t'<div class=\"jl-btw-min\" data-jslet=\\'' + JSON.stringify(ctrlCfg) + '\\'></div>' + \r\n\t\t\t'<span class=\"input-group-addon jl-btw-separator\">' + lbl + '</span>';\r\n\t\tctrlCfg.valueIndex = 1;\r\n\t\ttemplate += \r\n\t\t\t'<div class=\"jl-btw-max\" data-jslet=\\'' + JSON.stringify(ctrlCfg) + '\\'></div>' + \r\n\t\t\t'</div>';\r\n\r\n\t\tZ.el.innerHTML = template;\r\n\t\tjslet.ui.install(Z.el);\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tZ._minEleId = jqEl.find('.jl-btw-min')[0].id;\r\n\t\tZ._maxEleId = jqEl.find('.jl-btw-max')[0].id;\r\n\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function($super, tableId){\r\n\t\t$super(tableId);\r\n\t\tjslet('#'+ this._minEleId).tableId(tableId);\r\n\t\tjslet('#'+ this._maxEleId).tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tjslet('#'+ this._minEleId).focus();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBBetweenEdit', jslet.ui.DBBetweenEdit);\r\njslet.ui.DBBetweenEdit.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n *  \r\n * DBCheckBox. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCheckBox\", dataset:\"employee\", field:\"married\"};\r\n * \r\n *     //1. Declaring:\r\n *      <input type='checkbox' data-jslet='type:\"DBCheckBox\",dataset:\"employee\", field:\"married\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <input id=\"ctrlId\" type=\"checkbox\" />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCheckBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.isCheckBox = true;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beforeClick';\r\n\t\tZ._beforeClick = null;\r\n\t\t\r\n\t\tZ._skipRefresh = false;\r\n\t\tjQuery(el).attr('type', 'checkbox');\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeClick: function(beforeClick) {\r\n\t\tif(beforeClick === undefined) {\r\n\t\t\treturn this._beforeClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBox.beforeClick', beforeClick).isFunction();\r\n\t\tthis._beforeClick = beforeClick;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-dbcheck')) {\r\n\t\t\tjqEl.addClass('jl-dbcheck');\r\n\t\t}\r\n\t\tjqEl.on('click', Z._doClick);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('checkbox-inline form-control');\r\n\t}, // end bind\r\n\r\n\t_doClick: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif (Z._beforeClick) {\r\n\t\t\tvar result = Z._beforeClick.call(Z, Z.el);\r\n\t\t\tif (!result) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, false, fldObj.required());\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue();\r\n\t\tif (value) {\r\n\t\t\tZ.el.checked = true;\r\n\t\t} else {\r\n\t\t\tZ.el.checked = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.el.checked;\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBox', jslet.ui.DBCheckBox);\r\njslet.ui.DBCheckBox.htmlTemplate = '<input type=\"checkbox\"></input>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCheckBoxGroup. Display a group of checkbox. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCheckBoxGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,columnCount,hasSelectAllBox';\r\n\t\t\r\n\t\tZ._columnCount = 99999;\r\n\t\t\r\n\t\tZ._hasSelectAllBox = false;\r\n\t\t\r\n\t\tZ._itemIds = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBoxGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether creating \"select all\" box.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSelectAllBox True - has \"select all box\", false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSelectAllBox: function(hasSelectAllBox) {\r\n\t\tif(hasSelectAllBox === undefined) {\r\n\t\t\treturn this._hasSelectAllBox;\r\n\t\t}\r\n\t\tthis._hasSelectAllBox = hasSelectAllBox? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n//\t\tif(fldObj.valueStyle() !== jslet.data.FieldValueStyle.MULTIPLE) {\r\n//\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n//\t\t}\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which, idx, activeEle, activeId;\r\n\t\t\t\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx - 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === Z._itemIds.length - 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx + 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.on('click', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5);\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.on('blur', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\tdisabled = disabled || readOnly;\r\n\t\t\tvar chkBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\t\tchkEle, \r\n\t\t\t\ttabIndex = fldObj.tabIndex(),\r\n\t\t\t\trequired = fldObj.required();\r\n\t\t\tfor(var i = 0, cnt = chkBoxes.length; i < cnt; i++){\r\n\t\t\t\tchkEle = chkBoxes[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(chkEle, disabled, readOnly, false, required);\r\n\t\t\t\tchkEle.tabIndex = tabIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar checkboxs = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\tchkcnt = checkboxs.length, \r\n\t\t\tcheckbox, i;\r\n\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\tcheckbox = checkboxs[i];\r\n\t\t\tif(jQuery(checkbox).hasClass('jl-selectall')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcheckbox.checked = false;\r\n\t\t}\r\n\t\tvar values = Z.getValue();\r\n\t\tif(values && values.length > 0) {\r\n\t\t\tvar valueCnt = values.length, value;\r\n\t\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\t\tcheckbox = checkboxs[i];\r\n\t\t\t\tfor (var j = 0; j < valueCnt; j++) {\r\n\t\t\t\t\tvalue = values[j];\r\n\t\t\t\t\tif (value == checkbox.value) {\r\n\t\t\t\t\t\tcheckbox.checked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatMessage(jsletlocale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n//\t\tif(fldObj.valueStyle() != jslet.data.FieldValueStyle.MULTIPLE) {\r\n//\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n//\t\t}\r\n\t\t\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tlkCnt = lkds.recordCount();\r\n\t\tif(lkCnt === 0) {\r\n\t\t\tZ.el.innerHTML = jsletlocale.DBCheckBoxGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._itemIds = [];\r\n\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\tisNewRow = false;\r\n\t\tvar editFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false,\r\n\t\t\tk = -1,\r\n\t\t\titemId;\r\n\t\tif(Z._hasSelectAllBox && lkCnt > 0) {\r\n\t\t\ttemplate.push('<tr>');\r\n\t\t\titemId = jslet.nextId();\r\n\t\t\ttemplate.push('<td style=\"white-space: nowrap;vertical-align:middle\"><input type=\"checkbox\" class=\"jl-selectall\"');\r\n\t\t\ttemplate.push(' id=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\"/><label for=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\">');\r\n\t\t\ttemplate.push(jsletlocale.DBCheckBoxGroup.selectAll);\r\n\t\t\ttemplate.push('</label></td>');\r\n\t\t\tk = 0;\r\n\t\t\tZ._itemIds.push(itemId);\r\n\t\t}\r\n\t\tZ.el.innerHTML = '';\r\n\t\tvar oldRecno = lkds.recnoSilence();\r\n\t\ttry {\r\n\t\t\tfor (var i = 0; i < lkCnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\tZ._itemIds.push(itemId);\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap; \"><input type=\"checkbox\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\" id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t} // end for\r\n\t\t\tif (lkCnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ.doMetaChanged();\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._is_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar allBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'), chkBox, j, allCnt;\r\n\t\tif(jQuery(currCheckBox).hasClass('jl-selectall')) {\r\n\t\t\tvar isAllSelected = currCheckBox.checked;\r\n\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\tif(chkBox == currCheckBox) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (!chkBox.disabled) {\r\n\t\t\t\t\tchkBox.checked = isAllSelected;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlimitCount = fldObj.valueCountLimit(), \r\n\t\t\tvalues = null;\r\n\t\tif(fldObj.valueStyle() === jslet.data.FieldValueStyle.NORMAL) {\r\n\t\t\tif(currCheckBox.checked) {\r\n\t\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\t\tif(chkBox === currCheckBox || jQuery(chkBox).hasClass('jl-selectall')) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchkBox.checked = false;\r\n\t\t\t\t} //end for j\r\n\t\t\t\tvalues = currCheckBox.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvalues = [];\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\tif(jQuery(chkBox).hasClass('jl-selectall')) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (chkBox.checked) {\r\n\t\t\t\t\tvalues.push(chkBox.value);\r\n\t\t\t\t\tcount ++;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\r\n\t\t\tif (limitCount && count > limitCount) {\r\n\t\t\t\tcurrCheckBox.checked = !currCheckBox.checked;\r\n\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._is_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, values);\r\n\t\t} finally {\r\n\t\t\tZ._is_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar itemIds = this._itemIds;\r\n\t\tif (itemIds && itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-checkboxgroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-checkboxgroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBoxGroup', jslet.ui.DBCheckBoxGroup);\r\njslet.ui.DBCheckBoxGroup.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBCKEditor is a data sensitive CKEditor. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBCKEditor,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBCKEditor,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBCKEditor = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,height';\r\n\r\n\t\tZ._height = 150;\r\n\t\t\r\n\t\tZ._oldValue = null;\r\n\t\t\r\n\t\tZ._editorId = null;\r\n\t\tZ._editor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get CKEditor initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height CKEditor initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCKEditor.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!window.CKEDITOR) {\r\n\t\t\tthrow new Error('Not found CKEDITOR component! Goto for more: http://ckeditor.com/');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('jl-ckeditor');\r\n\t\tvar editorId = jslet.nextId();\r\n\t\tvar html = '<textarea class=\"jl-hidden\"></textarea>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.children().attr('id', editorId).attr('name', Z._field);\r\n\t\t\r\n\t\tvar editor = window.CKEDITOR.replace(editorId, {\r\n\t\t\theight: Z._height\r\n\t\t});\r\n\t\t\r\n\t\teditor.on('focus', jQuery.proxy(Z._doFocus, Z));\r\n\t\teditor.on('blur', jQuery.proxy(Z._doBlur, Z));\r\n\t\teditor.on('change', jQuery.proxy(Z._doChange, Z));\r\n\t\tZ._editor = editor;\r\n\t\tZ._editorId = '#cke_' + editorId;\r\n\t\tZ.renderAll();\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\tjQuery(Z._editorId).addClass('jl-focus');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doBlur: function () {\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z._editorId).removeClass('jl-focus');\r\n\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t},\r\n\t\r\n\t_doChange: function() {\r\n\t\tthis.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar state = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._editor.setReadOnly(state);\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError(), value;\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\tvalue = errObj.inputText;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t\tvalue = Z.getText();\r\n\t\t}\r\n\t\tZ._editor.setData(value);\r\n\t\tZ._editor.resetDirty();\r\n\t\tZ._oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinnerFocus: function($super) {\r\n\t\tthis._editor.focus();\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!Z._editor.checkDirty()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z._editor.getData();\r\n\t\tif(Z._oldValue == value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t\tZ._editor.resetDirty();\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tZ._editor = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBCKEditor', jslet.ui.DBCKEditor);\r\njslet.ui.DBCKEditor.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBCustomComboBox\r\n * \r\n * DBComboSelect. Show data on a popup panel, it can display tree style or table style. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true};\r\n * \r\n *      //1. Declaring:\r\n *      <div data-jslet='type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBComboSelect = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\tshowStyles: ['auto', 'table', 'tree'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck,autoSelected';\r\n\t\tZ._textField = null;\r\n\t\t\r\n\t\tZ._showStyle = 'auto';\r\n\t\t\r\n\t\tZ._popupWidth = 300;\r\n\r\n\t\tZ._popupHeight = 300;\r\n\t\t\r\n\t\tZ._contentPanel = null;\r\n\t\t\r\n\t\tZ._pickupField = null;\r\n\t\t\r\n\t\tZ._onGetSearchField = null;\r\n\t\t\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\tZ._autoSelected = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name of text box.\r\n\t * \r\n\t * @param {String | undefined} textField Field name which binded to the text box.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ttextField: function(textField) {\r\n\t\tif(textField === undefined) {\r\n\t\t\treturn this._textField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.textField', textField).required().isString();\r\n\t\tthis._textField = textField.trim();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel height.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The height of pop up panel.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the content style of pop up panel.\r\n\t * \r\n\t * @param {String | undefined} showStyle The content style of the pop up panel, optional value: \"auto\"(default), \"table\", \"tree\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tshowStyle: function(showStyle) {\r\n\t\tif(showStyle === undefined) {\r\n\t\t\treturn this._showStyle;\r\n\t\t}\r\n\t\tshowStyle = jQuery.trim(showStyle);\r\n\t\tvar checker = jslet.Checker.test('DBComboSelect.showStyle', showStyle).isString();\r\n\t\tshowStyle = showStyle.toLowerCase();\r\n\t\tchecker.testValue(showStyle).inArray(this.showStyles);\r\n\t\tthis._showStyle = showStyle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/*\r\n\t * @event\r\n\t * \r\n\t * Set or get \"onGetSearchField\" event handler.\r\n\t * \r\n\t * @param {Function} Optional onGetSearchField event handler.\r\n\t * \r\n\t * @return {Function or this}\r\n\t */\r\n\tonGetSearchField: function(onGetSearchField) {\r\n\t\tif(onGetSearchField === undefined) {\r\n\t\t\treturn this._onGetSearchField;\r\n\t\t}\r\n\t\tthis._onGetSearchField = onGetSearchField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether correlate checking the tree nodes or not.\r\n\t * \r\n\t * @param {Boolean | undefined} correlateCheck True - correlate checking the tree nodes, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Automatically select the finding record when searching record.\r\n\t * \r\n\t * @param {Boolean | undefined} autoSelected True - Automatically select record, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoSelected: function(autoSelected) {\r\n\t\tif(autoSelected === undefined) {\r\n\t\t\treturn this._autoSelected;\r\n\t\t}\r\n\t\tthis._autoSelected = autoSelected;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tafterBind: function ($super) {\r\n\t\t$super();\r\n\t\t\r\n\t\tif (this._contentPanel) {\r\n\t\t\tthis._contentPanel = null;\r\n\t\t}\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar Z = this, \r\n\t\t\tel = Z.el, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup(),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\t\t\r\n\t\t}\r\n\t\tif (lkf === null || lkf === undefined) {\r\n\t\t\tthrow new Error(Z._field + ' is NOT a lookup field!');\r\n\t\t}\r\n\t\tvar style = Z._showStyle;\r\n\t\tif (Z._showStyle == 'auto') {\r\n\t\t\tstyle = lkf.parentField() ? 'tree' : 'table';\r\n\t\t}\r\n\t\tif (!Z._contentPanel) {\r\n\t\t\tZ._contentPanel = new jslet.ui.DBComboSelectPanel(Z, btnEle);\r\n\t\t\tZ._contentPanel.showStyle = style;\r\n\t\t\tZ._contentPanel.customButtonLabel = Z.customButtonLabel;\r\n\t\t\tZ._contentPanel.onCustomButtonClick = Z.onCustomButtonClick;\r\n\t\t\tif (Z._popupWidth) {\r\n\t\t\t\tZ._contentPanel.popupWidth = Z._popupWidth;\r\n\t\t\t}\r\n\t\t\tif (Z._popupHeight) {\r\n\t\t\t\tZ._contentPanel.popupHeight = Z._popupHeight;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar r = jqEl.offset(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\tx = r.left, y = r.top + h;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ._contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\tclosePopup: function(){\r\n\t\tvar Z = this;\r\n\t\tif(Z._contentPanel) {\r\n\t\t\tZ._contentPanel.closePopup();\r\n\t\t}\r\n\t\tZ._contentPanel = null;\r\n\t\tZ.focus();\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function (isMetaChanged) {\r\n\t\tif(isMetaChanged) {\r\n\t\t\tthis._destroyPopPanel();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_destroyPopPanel: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._contentPanel){\r\n\t\t\tZ._contentPanel.destroy();\r\n\t\t\tZ._contentPanel = null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._destroyPopPanel();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.DBComboSelectPanel = function (comboSelectObj, btnEle) {\r\n\tvar Z = this;\r\n\r\n\tZ.showStyle = 'auto';\r\n\r\n\tZ.customButtonLabel = null;\r\n\tZ.onCustomButtonClick = null;\r\n\tZ.popupWidth = 350;\r\n\tZ.popupHeight = 350;\r\n\tZ._isShowing = false;\r\n\t\r\n\tvar otree, otable, showType, valueSeperator = ',', lkf, lkds, self = this;\r\n\tZ.comboSelectObj = comboSelectObj;\r\n\r\n\tZ.dataset = comboSelectObj._dataset;\r\n\tZ.field = comboSelectObj._field;\r\n\tZ.fieldObject = Z.dataset.getField(Z.field);\r\n\tZ.panel = null;\r\n\tZ.searchBoxEle = null;\r\n\tZ._oldFilter = null;\r\n\tZ._oldFiltered = null;\r\n\t\r\n\tZ.popup = new jslet.ui.PopupPanel(btnEle);\r\n\tZ.popup.onHidePopup = function() {\r\n\t\tZ._isShowing = false;\r\n\t\tZ._restoreLkDsEvent();\r\n\t\tif(Z.comboSelectObj) {\r\n\t\t\tZ.comboSelectObj.focus();\r\n\t\t}\r\n\t};\r\n\tZ._confirmSelectDebounce = jslet.debounce(this._confirmSelect, 50);\r\n};\r\n\r\njslet.ui.DBComboSelectPanel.prototype = {\r\n\t\t\r\n\tlookupDs: function() {\r\n\t\treturn this.fieldObject.lookup().dataset();\r\n\t},\r\n\t\r\n\tisMultiple: function() {\r\n\t\treturn this.fieldObject && this.fieldObject.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t},\r\n\t\t\r\n\tshowPopup: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isShowing) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._initSelected();\r\n\t\tvar showType = Z.showStyle.toLowerCase();\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = Z._create();\r\n\t\t} else {\r\n\t\t\tvar ojslet = Z.otree ? Z.otree : Z.otable;\r\n\t\t\tojslet.dataset().addLinkedControl(ojslet);\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tojslet.renderAll();\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\tvar jqPanel = jQuery(Z.panel);\r\n\t\tjqPanel.find('.jl-combopnl-head input').val('');\r\n\t\tjqPanel.find('.jl-combopnl-head').hide();\r\n\r\n\t\tif(showType == 'table') {\r\n\t\t\tvar fields = Z.lookupDs().getNormalFields(),\r\n\t\t\t\tfldObj, totalChars = 0;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tif(fldObj.visible()) {\r\n\t\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 40;\r\n\t\t\tZ.popupWidth = totalWidth;\r\n\t\t\tif(Z.popupWidth < 150) {\r\n\t\t\t\tZ.popupWidth = 150;\r\n\t\t\t}\r\n\t\t\tif(Z.popupWidth > 500) {\r\n\t\t\t\tZ.popupWidth = 500;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._setLookupDsEvent();\r\n\t\tZ._isShowing = true;\r\n\t\tZ.popup.contentElement(Z.panel);\r\n\t\tZ.popup.show(left, top, Z.popupWidth, Z.popupHeight, ajustX, ajustY);\r\n\t\tZ._showTips(jsletlocale.DBComboSelect.find);\r\n\t\tZ._focus();\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.popup.hide();\r\n\t\tvar dispCtrl = Z.otree ? Z.otree : Z.otable;\r\n\t\tif(dispCtrl) {\r\n\t\t\tdispCtrl.dataset().removeLinkedControl(dispCtrl);\r\n\t\t}\r\n\t\tZ.comboSelectObj.focus();\r\n\t},\r\n\t\r\n\t_setLookupDsEvent: function() {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\t\tvar lkDs = lkfld.dataset();\r\n\t\tvar editFilter = lkfld.editFilter();\r\n\t\tif(editFilter) {\r\n\t\t\tvar filter = lkDs.filter();\r\n\t\t\tZ._oldFilter = filter;\r\n\t\t\tZ._oldFiltered = lkDs.filtered();\r\n\t\t\tif(filter) {\r\n\t\t\t\tfilter = '(' + editFilter + ') && (' + filter + ')';\r\n\t\t\t} else {\r\n\t\t\t\tfilter = editFilter;\r\n\t\t\t}\r\n\t\t\tlkDs.filter(filter);\r\n\t\t\tlkDs.filtered(true);\r\n\t\t\t\r\n\t\t}\r\n\t\tif(Z.isMultiple()) {\r\n\t\t\tZ._oldLkDsCheckSelectable = null;\r\n\t\t\tif(lkfld.onlyLeafLevel()) {\r\n\t\t\t\tZ._oldLkDsCheckSelectable = lkDs.onCheckSelectable();\r\n\t\t\t\tlkDs.onCheckSelectable(function(){\r\n\t\t\t\t\treturn !this.hasChildren();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tlkDs = Z.lookupDs();\r\n\t\t\tZ._oldLkDsListener = lkDs.datasetListener();\r\n\t\t\tlkDs.datasetListener(function(eventType) {\r\n\t\t\t\tif(Z._oldLkDsListener) {\r\n\t\t\t\t\tZ._oldLkDsListener.call(lkDs, eventType);\r\n\t\t\t\t}\r\n\t\t\t\tif(eventType === jslet.data.DatasetEvent.AFTERSELECT) {\r\n\t\t\t\t\tZ._confirmSelectDebounce.call(Z);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_restoreLkDsEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\t\tif(!lkfld) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkDs = lkfld.dataset();\r\n\t\tif(Z.isMultiple()) {\r\n\t\t\tlkDs.onCheckSelectable(Z._oldLkDsCheckSelectable? Z._oldLkDsCheckSelectable: null);\r\n\t\t\tlkDs.datasetListener(Z._oldLkDsListener? Z._oldLkDsListener: null);\r\n\t\t}\r\n\t\tif(Z._oldFiltered) {\r\n\t\t\tlkDs.filtered(Z._oldFiltered);\r\n\t\t}\r\n\t\tif(Z._oldFilter) {\r\n\t\t\tlkDs.filter(Z._oldFilter);\r\n\t\t} \r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t\tZ.panel.style.width = '100%';\r\n\t\t\tZ.panel.style.height = '100%';\r\n\t\t}\r\n\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z.showStyle.toLowerCase(),\r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar template = ['<div class=\"jl-combopnl-tip\" style=\"display:none\"></div>',\r\n\t\t                '<div class=\" col-xs-8 col-xs-offset-4 jl-combopnl-head\">',\r\n\t\t                '<div class=\"input-group input-group-sm\">',\r\n\t\t                '<input class=\"form-control\" type=\"text\" size=\"10\"></input>',\r\n\t\t                '<span class=\"input-group-btn\">',\r\n\t\t                '<button class=\"jl-combopnl-search btn btn-secondary\" type=\"button\"><i class=\"fa fa-search\"></i></button>',\r\n\t\t                '<button class=\"jl-combopnl-closesearch btn btn-secondary\" type=\"button\"><i class=\"fa fa-times\"></i></button>',\r\n\t\t                '</span>',\r\n\t\t                '</div></div>',\r\n\t\t                '<div class=\"jl-combopnl-content\"></div>'];\r\n\r\n\t\tZ.panel.innerHTML = template.join('');\r\n\t\tvar jqPanel = jQuery(Z.panel),\r\n\t\t\tjqPh = jqPanel.find('.jl-combopnl-head');\r\n\t\tjqPanel.on('keydown', function(event){\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\t\tZ._confirmAndClose();\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ESCAPE) {\r\n\t\t\t\tZ.closePopup();\r\n\t\t\t}\r\n\t\t\tif(event.ctrlKey && keyCode === jslet.ui.KeyCode.F) {\r\n\t\t\t\tjqPanel.find('.jl-combopnl-head').slideDown();\r\n\t\t\t\tZ.searchBoxEle.focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.searchBoxEle = jqPh.find('input')[0];\r\n\t\tjQuery(Z.searchBoxEle).on('keydown', function(event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tif (event.which != 13) {//enter\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tZ._findData(event.currentTarget);\r\n\t\t});\r\n\t\t\r\n\t\tjqPanel.find('.jl-combopnl-closesearch').click(function() {\r\n\t\t\tjqPanel.find('.jl-combopnl-head').slideUp();\r\n\t\t\tZ._focus();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-combopnl-search').click(function() {\r\n\t\t\tZ._findData(Z.searchBoxEle);\r\n\t\t});\r\n\t\tvar contentPanel = jqPanel.find('.jl-combopnl-content')[0];\r\n\r\n\t\t//create popup content\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeParam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: Z.isMultiple(),\r\n\t\t\t\texpandLevel:1\r\n\t\t\t};\r\n\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttreeParam.onItemClick = jQuery.proxy(Z._confirmAndClose, Z);\r\n\t\t\t}\r\n\t\t\ttreeParam.correlateCheck = Z.comboSelectObj.correlateCheck();\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otree = jslet.ui.createControl(treeParam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableParam = { type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: Z.isMultiple(), hasSeqCol: false, \r\n\t\t\t\t\thasFindDialog: false, hasFilterDialog: false };\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttableParam.onRowClick = jQuery.proxy(Z._confirmAndClose, Z);\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otable = jslet.ui.createControl(tableParam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn Z.panel;\r\n\t},\r\n\r\n\t_initSelected: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldValue = Z.comboSelectObj.getValue(), \r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\r\n\t\tif(lkfld.onlyLeafLevel()) {\r\n\t\t\tlkds.onCheckSelectable(function(){\r\n\t\t\t\treturn !this.hasChildren();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (!Z.isMultiple()) {\r\n\t\t\tif (fldValue) {\r\n\t\t\t\tlkds.findByKey(fldValue);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlkds.disableControls();\r\n\t\ttry {\r\n\t\t\tlkds.selectAll(false);\r\n\t\t\tif (fldValue) {\r\n\t\t\t\tvar arrKeyValues = fldValue;\r\n\t\t\t\tif(!jslet.isArray(fldValue)) {\r\n\t\t\t\t\tarrKeyValues = fldValue.split(jslet.global.valueSeparator);\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0, len = arrKeyValues.length; i < len; i++){\r\n\t\t\t\t\tlkds.selectByKeyValue(true, arrKeyValues[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tlkds.enableControls();\r\n\t\t}\r\n\t},\r\n\r\n\t_findData: function (searchText) {\r\n\t\tvar Z = this;\r\n\t\tvar findFldName = Z.comboSelectObj.searchField, \r\n\t\t\tfindingValue = this.searchBoxEle.value;\r\n\t\tif (!findingValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar eventFunc = jslet.getFunction(Z.comboSelectObj.onGetSearchField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfindFldName = eventFunc.call(findingValue);\r\n\t\t}\r\n\t\tvar findFldNames = null;\r\n\t\tvar lkds = Z.lookupDs();\r\n\t\tif(!findFldName) {\r\n\t\t\tfindFldNames = [];\r\n\t\t\tvar fields = lkds.getNormalFields(), fldObj;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tif(fldObj.visible()) {\r\n\t\t\t\t\tfindFldNames.push(fldObj.name());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfindFldNames = findFldName.split(',');\r\n\t\t}\r\n\t\tif(!findFldNames || findFldNames.length === 0) {\r\n\t\t\tconsole.warn('Search field NOT specified! Can\\'t search data!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tcurrRecno = lkds.recno() + 1;\r\n\t\tvar options = {startRecno: currRecno, findingByText: true, matchType: 'any'};\r\n\t\tvar found = lkds.findByField(findFldNames, findingValue, options);\r\n\t\tif(!found) {\r\n\t\t\toptions.startRecno = 0;\r\n\t\t\tfound = lkds.findByField(findFldNames, findingValue, options);\r\n\t\t}\r\n\t\tif(found && found.isEqual && Z.comboSelectObj.autoSelected()) {\r\n\t\t\tlkds.select(true);\r\n\t\t}\r\n\t\tif(!found) {\r\n\t\t\tZ._showTips(jsletlocale.DBComboSelect.notFound);\r\n\t\t}\r\n\t\tif(searchText) {\r\n\t\t\tsearchText.focus();\r\n\t\t}\r\n\t\treturn;\r\n\t\t\r\n\t},\r\n\r\n\t_focus: function() {\r\n\t\tvar Z = this;\r\n\t\twindow.setTimeout(function(){\r\n\t\t\tvar dbCtrl = Z.otable || Z.otree;\r\n\t\t\tif(dbCtrl) {\r\n\t\t\t\tdbCtrl.el.focus();\r\n\t\t\t}\r\n\t\t}, 10);\r\n\t},\r\n\t\r\n\t_showTips: function (tips) {\r\n\t\tvar jqPanel = jQuery(this.panel);\r\n\t\tjqPanel.find('.jl-combopnl-tip').html(tips).slideDown();\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tjqPanel.find('.jl-combopnl-tip').slideUp();\r\n\t\t}, 1500);\r\n\t},\r\n\t\r\n\t_confirmSelect: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldValue = Z.comboSelectObj.getValue(),\r\n\t\t\tfldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tisMulti = Z.isMultiple(),\r\n\t\t\tlookupDs = Z.lookupDs();\r\n\t\t\r\n\t\tif (isMulti) {\r\n\t\t\tfldValue = lookupDs.selectedKeyValues();\r\n\t\t} else {\r\n\t\t\tif(lookupDs.hasChildren() && lkfld.onlyLeafLevel()) {\r\n\t\t\t\tZ._showTips(jsletlocale.DBComboSelect.cannotSelect);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfldValue = lookupDs.keyValue();\r\n\t\t}\r\n\r\n\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z._valueIndex);\r\n\t\tif (!isMulti && Z.comboSelectObj._afterSelect) {\r\n\t\t\tZ.comboSelectObj._afterSelect(Z.dataset, lookupDs);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_confirmAndClose: function () {\r\n\t\tif(this._confirmSelect()) {\r\n\t\t\tthis.closePopup();\r\n\t\t}\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\tvar Z = this;\r\n\t\tZ._restoreLkDsEvent();\r\n\t\tif (Z.otree){\r\n\t\t\tZ.otree.destroy();\r\n\t\t\tZ.otree = null;\r\n\t\t}\r\n\t\tif (Z.otable){\r\n\t\t\tZ.otable.destroy();\r\n\t\t\tZ.otable = null;\r\n\t\t}\r\n\t\tZ.comboSelectObj = null;\r\n\t\t\r\n\t\tjQuery(Z.searchBoxEle).off();\r\n\t\tZ.fieldObject = null;\r\n\t\t\r\n\t\tZ.searchBoxEle = null;\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\tZ.panel = null;\r\n\t}\r\n};\r\n\r\njslet.ui.register('DBComboSelect', jslet.ui.DBComboSelect);\r\njslet.ui.DBComboSelect.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBDataLabel. Show field value in a HTML label. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <label data-jslet='type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBDataLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control-static jl-datalabel jl-lbl-normal');//Bootstrap class\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tvar text = Z.getText();\r\n\t\tZ.el.innerHTML = text;\r\n\t\tZ.el.title = text;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tthis.doValueChanged();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBDataLabel', jslet.ui.DBDataLabel);\r\njslet.ui.DBDataLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBCustomComboBox\r\n * \r\n * DBDatePicker. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBDatePicker = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,textReadOnly,popupWidth,popupHeight';\r\n\t\t\r\n\t\tZ._popupWidth = 260;\r\n\r\n\t\tZ._popupHeight = 226;\r\n\r\n\t\tZ.popup = null;\r\n\t\t\r\n\t\tZ.comboButtonCls = 'fa-calendar';\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel height.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The height of pop up panel.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get pop up panel width.\r\n\t * \r\n\t * @param {Integer | undefined} popupHeight The width of pop up panel width.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar el = this.el, \r\n\t\t\tZ = this, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar width = Z._popupWidth,\r\n\t\t\theight = Z._popupHeight,\r\n\t\t\tdateValue = Z.getValue(),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminDate = null,\r\n\t\t\tmaxDate = null;\r\n\t\t\r\n\t\tif (range){\r\n\t\t\tif (range.min) {\r\n\t\t\t\tminDate = range.min;\r\n\t\t\t}\r\n\t\t\tif (range.max) {\r\n\t\t\t\tmaxDate = range.max;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = jslet.ui.createControl({ type: 'Calendar', value: dateValue, minDate: minDate, maxDate: maxDate,\r\n\t\t\t\tonDateSelected: function (date) {\r\n\t\t\t\t\tZ._dataset.setFieldValue(Z._field, new Date(date.getTime()), Z._valueIndex);\r\n\t\t\t\t\tZ.popup.hide();\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tZ.el.focus();\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t//Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, null, width + 'px', height + 'px', true); //Hide panel first\r\n\t\t\t\r\n\t\t\tZ.popup = new jslet.ui.PopupPanel(btnEle);\r\n\t\t\t\r\n\t\t\tZ.popup.onHidePopup = function() {\r\n\t\t\t\tZ.focus();\r\n\t\t\t};\r\n\t\t\tZ.popup.contentElement(Z.contentPanel.el);\r\n\t\t}\r\n\t\t\r\n\t\tvar r = jqEl.offset(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\tx = r.left, y = r.top + h;\r\n\t\tif (jsletlocale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ.contentPanel.el.style.display = 'block';\r\n\t\tZ.popup.show(x, y, width + 3, height + 3, 0, h);\r\n\t\tZ.contentPanel.focus();\r\n\t\tZ.contentPanel.setValue(dateValue);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z.contentPanel) {\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t\tif(Z.popup) {\r\n\t\t\tZ.popup.destroy();\r\n\t\t\tZ.popup = null;\r\n\t\t}\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBDatePicker', jslet.ui.DBDatePicker);\r\njslet.ui.DBDatePicker.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBHtml. Display html text from one field. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBHtml\",dataset:\"employee\",field:\"comment\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBHtml\",dataset:\"employee\",field:\"comment\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBHtml = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar content = this.getText();\r\n\t\tthis.el.innerHTML = content;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBHtml', jslet.ui.DBHtml);\r\njslet.ui.DBHtml.htmlTemplate = '<div style=\"width:200px;height:200px\"></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBImage. Display an image which store in database or which's path store in database. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBImage\",dataset:\"employee\",field:\"photo\"};\r\n * \r\n *     //1. Declaring:\r\n *      <img data-jslet='{type:\"DBImage\",dataset:\"employee\",field:\"photo\"}' />\r\n *      or\r\n *      <img data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <img id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBImage = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,locked,baseUrl,altField,enableViewer,viewUrlField';\r\n\t\t\r\n\t\tZ._locked = false;\r\n\t\t\r\n\t\tZ._baseUrl = null;\r\n\t\t\r\n\t\tZ._altField = null;\r\n\t\t\r\n\t\tZ._enableViewer = false;\r\n\t\t\r\n\t\tZ._viewUrlField = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get base URL for image \"src\". The whole image URL is : \"baseUrl\" + the value of field. \r\n\t * \r\n\t * @param {String | undefined} baseUrl Base URL.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tbaseUrl: function(baseUrl) {\r\n\t\tif(baseUrl === undefined) {\r\n\t\t\treturn this._baseUrl;\r\n\t\t}\r\n\t\tbaseUrl = jQuery.trim(baseUrl);\r\n\t\tjslet.Checker.test('DBImage.baseUrl', baseUrl).isString();\r\n\t\tthis._baseUrl = baseUrl;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether show image viewer. If true, user can click the image to show the image viewer. \r\n\t * \r\n\t * @param {Boolean | undefined} enableViewer True - enable viewer, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableViewer: function(enableViewer) {\r\n\t\tif(enableViewer === undefined) {\r\n\t\t\treturn this._enableViewer;\r\n\t\t}\r\n\t\tthis._enableViewer = enableViewer? true: false;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for image viewer. If 'field' stores the thumbnail url, 'viewUrlField' is stores the initial image url which is \r\n\t * provided for image viewer. Only enabled when 'enableViewer' is true.\r\n\t * \r\n\t * @param {String | undefined} viewUrlField.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tviewUrlField: function(viewUrlField) {\r\n\t\tif(viewUrlField === undefined) {\r\n\t\t\treturn this._viewUrlField;\r\n\t\t}\r\n\t\tviewUrlField = jQuery.trim(viewUrlField);\r\n\t\tjslet.Checker.test('DBImage.viewUrlField', viewUrlField).isString();\r\n\t\tthis._viewUrlField = viewUrlField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for image \"alt\". If not found the image, it displays the \"alt\" value.\r\n\t * \r\n\t * @param {String | undefined} baseUrl Base url.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\taltField: function(altField) {\r\n\t\tif(altField === undefined) {\r\n\t\t\treturn this._altField;\r\n\t\t}\r\n\t\taltField = jQuery.trim(altField);\r\n\t\tjslet.Checker.test('DBImage.altField', altField).isString();\r\n\t\tthis._altField = altField;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether stop refreshing image when moving dataset's cursor.\r\n\t * \r\n\t * @param {Boolean | undefined} locked True - stop refreshing, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tlocked: function(locked) {\r\n\t\tif(locked === undefined) {\r\n\t\t\treturn this._locked;\r\n\t\t}\r\n\t\tthis._locked = locked;\r\n\t\treturn this;\r\n\t},\r\n   \r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'img';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('img-responsive img-rounded');\r\n\t\tif(jslet.ui.ImageViewer) {\r\n\t\t\tjqEl.on('click', function() {\r\n\t\t\t\tif(Z._locked || !Z._enableViewer || !Z._dataset || !Z._field) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._dataset.recordCount() === 0 || !Z._dataset.getFieldValue(Z._field)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar viewer = new jslet.ui.ImageViewer();\r\n\t\t\t\tviewer.show(Z._getImgUrl(true));\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_getImgUrl: function(isForViewer) {\r\n\t\tvar Z = this, srcUrl;\r\n\t\tif(isForViewer && Z._viewUrlField) {\r\n\t\t\tsrcUrl = Z._dataset.getFieldValue(Z._viewUrlField);\r\n\t\t\tif(!srcUrl) {\r\n\t\t\t\tsrcUrl = Z.getValue();\r\n\t\t\t}\r\n\t\t}else {\r\n\t\t\tsrcUrl = Z.getValue();\r\n\t\t}\r\n\t\tif (!srcUrl) {\r\n\t\t\tsrcUrl = '';\r\n\t\t} else {\r\n\t\t\tif (Z._baseUrl) {\r\n\t\t\t\tsrcUrl = Z._baseUrl + srcUrl;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn srcUrl;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (Z._locked) {\r\n\t\t\tZ.el.alt = jsletlocale.DBImage.lockedImageTips;\r\n\t\t\tZ.el.src = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar srcURL = Z._getImgUrl();\r\n\t\tif (Z.el.src != srcURL) {\r\n\t\t\tvar altText = srcURL;\r\n\t\t\tif(Z._altField) {\r\n\t\t\t\taltText = Z._dataset.getFieldText(Z._altField);\r\n\t\t\t}\r\n\t\t\tZ.el.alt = altText || '';\r\n\t\t\tZ.el.src = srcURL;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBImage', jslet.ui.DBImage);\r\njslet.ui.DBImage.htmlTemplate = '<img></img>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBLabel. Display field name, use this control to void hard-coding field name, and you can change field name dynamically. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *      //1. Declaring:\r\n *      <label data-jslet='type:\"DBLabel\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset,field';\r\n\t\tthis.isLabel = true;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tjQuery(this.el).addClass('control-label');\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function(metaName) {\r\n\t\tif(metaName && jslet.ui.DBLabel.METANAMES.indexOf(metaName) < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this, subType = Z._fieldMeta,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tcontent = '';\r\n\t\tif(!fldObj) {\r\n\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif((!subType || subType == 'label') && (!metaName || metaName == 'label' || metaName == 'required')) {\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tcontent += '<span class=\"jl-lbl-required\">' + \r\n\t\t\t\t\tjslet.ui.DBLabel.REQUIREDCHAR + '</span>';\r\n\t\t\t}\r\n\t\t\tcontent += fldObj.displayLabel() || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType && subType == 'tip' && \r\n\t\t\t(!metaName || metaName == subType)) {\r\n\t\t\tcontent = fldObj.tip() || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType  && subType == 'error' && \r\n\t\t\t(metaName && metaName == subType)) {\r\n\t\t\tvar errObj = Z.getFieldError();\r\n\t\t\tcontent = errObj && errObj.message || '';\r\n\t\t\tjqEl.html(content);\r\n\t\t\tZ.el.title = jqEl.text();\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar jqEl = jQuery(this.el),\r\n\t\t\tsubType = this.fieldMeta();\r\n\t\t\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent());\r\n\t\tif(subType == 'error') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-error')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-error');\r\n\t\t\t}\r\n\t\t} else \r\n\t\tif(subType == 'tip') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-tip')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-tip');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\njslet.ui.DBLabel.REQUIREDCHAR = '*';\r\njslet.ui.DBLabel.METANAMES = ['label', 'required', 'tip', 'error'];\r\njslet.ui.register('DBLabel', jslet.ui.DBLabel);\r\njslet.ui.DBLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBList. Show data on list, it can display tree style or table style. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBList\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBList\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBList = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\tshowStyles: ['auto', 'table', 'tree'],\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,showStyle,correlateCheck';\r\n\t\t\r\n\t\tZ._showStyle = 'auto';\r\n\t\t\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the content style of pop up panel.\r\n\t * \r\n\t * @param {String | undefined} showStyle The content style of the pop up panel, optional value: \"auto\"(default), \"table\", \"tree\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tshowStyle: function(showStyle) {\r\n\t\tif(showStyle === undefined) {\r\n\t\t\treturn this._showStyle;\r\n\t\t}\r\n\t\tshowStyle = jQuery.trim(showStyle);\r\n\t\tvar checker = jslet.Checker.test('DBComboSelect.showStyle', showStyle).isString();\r\n\t\tshowStyle = showStyle.toLowerCase();\r\n\t\tchecker.testValue(showStyle).inArray(this.showStyles);\r\n\t\tthis._showStyle = showStyle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether correlate checking the tree nodes or not.\r\n\t * \r\n\t * @param {Boolean | undefined} correlateCheck True - correlate checking the tree nodes, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(jqEl.hasClass('jl-dblist')) {\r\n\t\t\tjqEl.addClass('jl-dblist');\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z._showStyle.toLowerCase(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\tif(showType == 'auto' && pfld) {\r\n\t\t\tshowType = 'tree';\r\n\t\t}\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeParam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: isMulti,\r\n\t\t\t\tcorrelateCheck: Z._correlateCheck,\r\n\t\t\t\texpandLevel: 99\r\n\t\t\t};\r\n\t\t\tif(isMulti) {\r\n\t\t\t\ttreeParam.afterCheckBoxClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\ttreeParam.onItemClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tjslet.ui.createControl(treeParam, Z.el, '100%', '100%');\r\n\t\t\t\tjQuery(Z.el.childNodes[0]).on('focus', function(event) {\r\n\t\t\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t\t\t}).on('blur', function(event) {\r\n\t\t\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t\t\t});\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableParam = {type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: isMulti, hasSeqCol: false, hasFindDialog: false, hasFilterDialog: false};\r\n\t\t\tif(isMulti) {\r\n\t\t\t\ttableParam.afterSelect = tableParam.afterSelectAll = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\ttableParam.onRowClick = function() {\r\n\t\t\t\t\tZ.updateToDataset();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tjslet.ui.createControl(tableParam, Z.el, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tZ.el.disabled = true;\r\n\t\t} else {\r\n\t\t\tZ.el.disabled = false;\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE,\r\n\t\t\tvalue;\r\n\t\tif(!isMulti) {\r\n\t\t\tvalue = lkds.keyValue();\r\n\t\t} else {\r\n\t\t\tvalue = lkds.selectedKeyValues();\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText || '';\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tfldValue = fldObj.getValue(),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tlkds = lkfld.dataset(),\r\n\t\t\tisMulti = fldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\tif(!isMulti) {\r\n\t\t\tlkds.findByKey(fldValue);\r\n\t\t} else {\r\n\t\t\tvar oldRecno = lkds.recno();\r\n\t\t\tlkds.disableControls();\r\n\t\t\ttry {\r\n\t\t\t\tlkds.selectAll(false);\r\n\t\t\t\tif(fldValue) {\r\n\t\t\t\t\tfor(var i = 0, len = fldValue.length; i < len; i++) {\r\n\t\t\t\t\t\tlkds.findByKey(fldValue[i]);\r\n\t\t\t\t\t\tlkds.selected(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tlkds.recno(oldRecno);\r\n\t\t\t\tlkds.enableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBList', jslet.ui.DBList);\r\njslet.ui.DBList.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBLookupLabel. Display field value according to another field and its value. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: '0101', returnField: 'name'};\r\n * \r\n *      //1. Declaring:\r\n *      <label data-jslet='{type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: \"0101\", returnField: \"name\"}' />\r\n *      or\r\n *      <label data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <label id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBLookupLabel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,lookupField,returnField,lookupValue';\r\n\t\tZ.requiredProperties = 'lookupValue,lookupField,returnField';\r\n\r\n\t\tZ._lookupField = null;\r\n\t\t\r\n\t\tZ._lookupValue = null;\r\n\t\t\r\n\t\tZ._returnField = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the field name for looking up.\r\n\t * \r\n\t * @param {String | undefined} lookupField Lookup field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupField: function(lookupField) {\r\n\t\tif(lookupField === undefined) {\r\n\t\t\treturn this._lookupField;\r\n\t\t}\r\n\t\tjslet.Checker.text('lookupField', lookupField).required().isString();\r\n\t\tthis._lookupField = lookupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the lookup value.\r\n\t * \r\n\t * @param {Object | undefined} lookupField Lookup value.\r\n\t * \r\n\t * @return {this | Object}\r\n\t */\r\n\tlookupValue: function(lookupValue) {\r\n\t\tif(lookupValue === undefined) {\r\n\t\t\treturn this._lookupValue;\r\n\t\t}\r\n\t\tjslet.Checker.text('lookupValue', lookupValue).required();\r\n\t\tthis._lookupValue = lookupValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the return field name.\r\n\t * \r\n\t * @param {String | undefined} returnField Return field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\treturnField: function(returnField) {\r\n\t\tif(returnField === undefined) {\r\n\t\t\treturn this._returnField;\r\n\t\t}\r\n\t\tjslet.Checker.text('returnField', returnField).required().isString();\r\n\t\tthis._returnField = returnField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt, isForce) {\r\n\t\tif (evt.eventType != jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isForce) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar result = Z.dataset.lookup(Z._lookupField, Z._lookupValue, Z._returnField);\r\n\t\tif (result === null) {\r\n\t\t\tresult = 'NOT found: ' + Z._lookupValue;\r\n\t\t}\r\n\t\tZ.el.innerHTML = result;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent, true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tcanFocus: function() {\r\n\t\treturn false;\r\n\t}\r\n});\r\njslet.ui.register('DBLookupLabel', jslet.ui.DBLookupLabel);\r\njslet.ui.DBLookupLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRadioGroup. Display a group of radio that user can select one option. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"'' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRadioGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,columnCount';\r\n\t\t\r\n\t\tZ._columnCount = 99999;\r\n\t\t\r\n\t\tZ._itemIds = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRadioGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which, idx, activeEle, activeId;\r\n\t\t\t\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx - 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tif(!Z._itemIds || Z._itemIds.length === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactiveEle = document.activeElement;\r\n\t\t\t\tactiveId = activeEle && activeEle.id;\r\n\t\t\t\t\r\n\t\t\t\tidx = Z._itemIds.indexOf(activeId);\r\n\t\t\t\tif(idx === Z._itemIds.length - 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdocument.getElementById(Z._itemIds[idx + 1]).focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.on('click', 'input[type=\"radio\"]', function(event){\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5);\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"radio\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.on('blur', 'input[type=\"radio\"]', function (event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\r\n\t\t\tZ.disabled = disabled || readOnly;\r\n\t\t\tdisabled = Z.disabled;\r\n\t\t\tvar radios = jQuery(Z.el).find('input[type=\"radio\"]'),\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\tradioEle,\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t\r\n\t\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\t\tradioEle = radios[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(radioEle, disabled, readOnly, false, required);\r\n\t\t\t\tradioEle.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\tradios = jQuery(Z.el).find('input[type=\"radio\"]'), \r\n\t\t\tradio;\r\n\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\tradio = radios[i];\r\n\t\t\tradio.checked = (value == jQuery(radio.parentNode).attr('value'));\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field), lkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatMessage(jsletlocale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tcnt = lkds.recordCount();\r\n\t\tif(cnt === 0) {\r\n\t\t\tZ.el.innerHTML = jsletlocale.DBRadioGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno();\r\n\t\ttry {\r\n\t\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\t\tisNewRow = false, \r\n\t\t\t\titemId;\r\n\t\t\tvar editFilter = lkf.editFilter();\r\n\t\t\tZ._innerEditFilterExpr = null;\r\n\t\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\t\tif(editFilter) {\r\n\t\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t\t}\r\n\t\t\tvar disableOption = false, k = -1;\r\n\t\t\t\r\n\t\t\tZ._itemIds = [];\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\tZ._itemIds.push(itemId);\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap;vertical-align:middle\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\"><input name=\"');\r\n\t\t\t\ttemplate.push(Z._field);\r\n\t\t\t\ttemplate.push('\" type=\"radio\" id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t} // end while\r\n\t\t\tif (cnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ.doMetaChanged();\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_ || Z.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, jQuery(currCheckBox.parentNode).attr('value'));\r\n\t\t\tcurrCheckBox.checked = true;\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar itemIds = this._itemIds;\r\n\t\tif (itemIds && itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-radiogroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-radiogroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRadioGroup', jslet.ui.DBRadioGroup);\r\njslet.ui.DBRadioGroup.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBRangeSelect. Display a select which options produce with 'beginItem' and 'endItem'. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRangeSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,beginItem,endItem,step';\r\n\t\tif (!Z.requiredProperties) {\r\n\t\t\tZ.requiredProperties = 'field,beginItem,endItem,step';\r\n\t\t}\r\n\r\n\t\tZ._beginItem = 0;\r\n\r\n\t\tZ._endItem = 10;\r\n\r\n\t\tZ._step = 1;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the begin item of range.\r\n\t * \r\n\t * @param {Integer | undefined} beginItem Begin item of range.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tbeginItem: function(beginItem) {\r\n\t\tif(beginItem === undefined) {\r\n\t\t\treturn this._beginItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.beginItem', beginItem).isNumber();\r\n\t\tthis._beginItem = parseInt(beginItem);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the end item of range.\r\n\t * \r\n\t * @param {Integer | undefined} endItem End item of range.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tendItem: function(endItem) {\r\n\t\tif(endItem === undefined) {\r\n\t\t\treturn this._endItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.endItem', endItem).isNumber();\r\n\t\tthis._endItem = parseInt(endItem);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the step.\r\n\t * \r\n\t * @param {Integer | undefined} step Step.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.step', step).isNumber();\r\n\t\tthis._step = parseInt(step);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);// end observe\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', function () {\r\n\t\t\t\tZ._currOption = this;\r\n\t\t\t});// end observe\r\n\t\t}\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t}, // end bind\r\n\r\n\t_doChanged: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z.getValue(),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\t\r\n\trenderOptions: function () {\r\n\t\tvar Z = this,\r\n\t\t\tarrhtm = [];\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.required()){\r\n\t\t\tarrhtm.push('<option value=\"_null_\">');\r\n\t\t\tarrhtm.push(fldObj.nullText());\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\r\n\t\tfor (var i = Z._beginItem; i <= Z._endItem; i += Z._step) {\r\n\t\t\tarrhtm.push('<option value=\"');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('\">');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\t\tjQuery(Z.el).html(arrhtm.join(''));\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tvar value = Z.getValue();\r\n\t\t\tif (value !== null) {\r\n\t\t\t\tZ.el.value = value;\r\n\t\t\t} else {\r\n\t\t\t\tZ.el.value = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar arrValue = Z.getValue(),\r\n\t\t\t\toptCnt = Z.el.options.length, opt, selected, i;\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tif (opt) {\r\n\t\t\t\t\t\topt.selected = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar j, vcnt = arrValue.length - 1;\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tfor (j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.renderOptions();\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1, opt;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRangeSelect', jslet.ui.DBRangeSelect);\r\njslet.ui.DBRangeSelect.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Rating\r\n * \r\n * DBRating. A control which usually displays some star to user, and user can click to rate something. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBRating\",dataset:\"employee\",field:\"grade\", itemCount: 5};\r\n * \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBRating\",dataset:\"employee\",field:\"grade\"', itemCount: 5' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBRating = jslet.Class.create(jslet.ui.Rating, {\r\n\t_isDBControl: true,\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t\tthis.refreshControl();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tZ._readOnly = fldObj.disabled() || fldObj.readOnly();\r\n\t\t}\r\n\t\tif(!metaName || metaName == \"required\") {\r\n\t\t\tZ._required = fldObj.required();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue();\r\n\t\t\r\n\t\tZ._value = value;\r\n\t\tZ._setValue(value);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoUIChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.setFieldValue(Z._field, Z.value(), Z._valueIndex);\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBRating', jslet.ui.DBRating);\r\njslet.ui.DBRating.htmlTemplate = '<Div></Div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBSelect. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBSelect\",dataset:\"employee\",field:\"department\"};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBSelect\",dataset:\"employee\",field:\"department\"' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,groupField,lookupDataset';\r\n\r\n\t\tZ._groupField = null;\r\n\t\t\r\n\t\tZ._lookupDataset = null;\r\n\t\t\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\t\r\n\t\tZ._isRendering = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get group field name, you can use this to group options. <br />\r\n\t * Detail to see HTML \"OptGroup\" element.\r\n\t * \r\n\t * @param {String | undefined} groupField Group field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tgroupField: function(groupField) {\r\n\t\tif(groupField === undefined) {\r\n\t\t\treturn this._groupField;\r\n\t\t}\r\n\t\tgroupField = jQuery.trim(groupField);\r\n\t\tjslet.Checker.test('DBSelect.groupField', groupField).isString();\r\n\t\tthis._groupField = groupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the lookup dataset to render \"Select Options\".\r\n\t * \r\n\t * @param {String | undefined} lookupDataset Lookup dataset name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlookupDataset: function(lookupDataset) {\r\n\t\tif(lookupDataset === undefined) {\r\n\t\t\treturn this._lookupDataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(lookupDataset)) {\r\n\t\t\tlookupDataset = jslet.data.getDataset(jQuery.trim(lookupDataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBSelect.lookupDataset', lookupDataset).isClass(jslet.data.Dataset.className);\r\n\t\tthis._lookupDataset = lookupDataset;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tZ.el.name = Z._field;\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqEl.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', Z._doCheckLimitCount);\r\n\t\t}\r\n\t\tjqEl.addClass('form-control input-sm');//Bootstrap class\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t_doChanged: function(event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z._dataset.getFieldValue(Z._field),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\r\n\t_doCheckLimitCount: function(event) {\r\n\t\tvar Z = event.delegateTarget.jslet;\r\n\t\tZ._currOption = this;\r\n\t},\r\n\r\n\t_setDefaultValue: function(fldObj, firstItemValue) {\r\n\t\tif(!firstItemValue || !fldObj.required()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dftValue = fldObj.defaultValue();\r\n\t\tif(dftValue) {\r\n\t\t\tvar lkds = fldObj.lookup().dataset();\r\n\t\t\tvar found = lkds.findByKey(dftValue);\r\n\t\t\tif(found) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tdftValue = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!dftValue) {\r\n\t\t\tfldObj.defaultValue(firstItemValue);\r\n\t\t}\r\n\t\tif(this._dataset.changedStatus() && !fldObj.getValue()) {\r\n\t\t\tfldObj.setValue(firstItemValue);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif(Z._lookupDataset) {\r\n\t\t\tlkf = new jslet.data.FieldLookup(fldObj, {dataset: Z._lookupDataset});\r\n\t\t} else {\r\n\t\t\tif (!lkf) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._isRendering = true;\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tgroupIsLookup = false,\r\n\t\t\tgroupLookup, \r\n\t\t\tgroupFldObj, \r\n\t\t\textraIndex;\r\n\t\tif (Z._groupField) {\r\n\t\t\tgroupFldObj = lkds.getField(Z._groupField);\r\n\t\t\tif (groupFldObj === null) {\r\n\t\t\t\tthrow 'NOT found field: ' + Z._groupField + ' in ' + lkds.name();\r\n\t\t\t}\r\n\t\t\tlkds.indexFields(Z._groupField);\r\n\t\t}\r\n\t\tvar preGroupValue = null, groupValue, groupDisplayValue, content = [];\r\n\r\n\t\tif (!Z.el.multiple && !fldObj.required()){\r\n\t\t\tcontent.push('<option value=\"_null_\">');\r\n\t\t\tcontent.push(fldObj.nullText());\r\n\t\t\tcontent.push('</option>');\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno(),\r\n\t\t\toptValue, optDispValue, \r\n\t\t\tfirstItemValue = null,\r\n\t\t\teditFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.data.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false, allCnt = 0;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = lkds.recordCount(); i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (Z._groupField) {\r\n\t\t\t\t\tgroupValue = lkds.getFieldValue(Z._groupField);\r\n\t\t\t\t\tif (groupValue != preGroupValue) {\r\n\t\t\t\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (groupIsLookup) {\r\n\t\t\t\t\t\t\tif (!groupLookup.dataset()\r\n\t\t\t\t\t\t\t\t\t\t\t.findByField(groupLookup.keyField(), groupValue)) {\r\n\t\t\t\t\t\t\t\tthrow 'Not found: [' + groupValue + '] in Dataset: [' +\r\n\t\t\t\t\t\t\t\t\tgroupLookup.dataset().name() +\r\n\t\t\t\t\t\t\t\t\t']field: [' + groupLookup.keyField() + ']';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupLookup.getCurrentDisplayValue();\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupValue;\r\n\r\n\t\t\t\t\t\tcontent.push('<optgroup label=\"');\r\n\t\t\t\t\t\tcontent.push(groupDisplayValue);\r\n\t\t\t\t\t\tcontent.push('\">');\r\n\t\t\t\t\t\tpreGroupValue = groupValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push('<option value=\"');\r\n\t\t\t\toptValue = lkds.getFieldValue(lkf.keyField());\r\n\t\t\t\tif(firstItemValue === null) {\r\n\t\t\t\t\tfirstItemValue = optValue;\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push(optValue);\r\n\t\t\t\tcontent.push('\"'+ (disableOption? ' disabled': '') +  '>');\r\n\t\t\t\tcontent.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\tcontent.push('</option>');\r\n\t\t\t\tallCnt++;\r\n\t\t\t} // end for\r\n\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t}\r\n\t\t\tif(allCnt > 100) {\r\n\t\t\t\tconsole.warn(fldObj.label() + '(' + Z._field + '): ' + jsletlocale.DBSelect.moreLookupRecords);\r\n\t\t\t}\r\n\r\n\t\t\tjQuery(Z.el).html(content.join(''));\r\n\t\t\tZ._setDefaultValue(fldObj, firstItemValue);\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText;\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar value = Z.getValue();\r\n\t\tif(!Z.el.multiple && value === Z.el.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar i, optCnt = Z.el.options.length, \r\n\t\t\topt;\r\n\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\topt = Z.el.options[i];\r\n\t\t\tif (opt) {\r\n\t\t\t\topt.selected = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tif(!Z._checkOptionEditable(fldObj, value)) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t\tif (value === null){\r\n\t\t\t\tif (!fldObj.required()) {\r\n\t\t\t\t\tvalue = '_null_';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t} else {\r\n\t\t\tvar arrValue = value;\r\n\t\t\tif(arrValue === null || arrValue.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tvar vcnt = arrValue.length - 1, selected;\r\n\t\t\tZ._skipRefresh = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\r\n\t\t\t\t\tfor (var j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n \r\n\t_checkOptionEditable: function(fldObj, fldValue) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerEditFilterExpr || fldValue === null || fldValue === undefined || fldValue === '') {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar lkDs = fldObj.lookup().dataset(); \r\n\t\tif(lkDs.findByKey(fldValue) && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateToDataset: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar opt, value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tif (!value) {\r\n\t\t\t\topt = Z.el.options[Z.el.selectedIndex];\r\n\t\t\t\tvalue = opt.innerHTML;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value ? opt.value : opt.innerHTML);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tZ._skipRefresh = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t\tvar valueChanged = false;\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\t\tvalue = null;\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t\tif(value != Z._dataset.getFieldValue(Z._field, Z._valueIndex)) {\r\n\t\t\t\t\tvalueChanged = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t\tif(value != Z._dataset.getFieldValue(Z._field)) {\r\n\t\t\t\t\tvalueChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(valueChanged) {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t\tZ.doValueChanged();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._skipRefresh = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._currOption = null;\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBSelect', jslet.ui.DBSelect);\r\njslet.ui.DBSelect.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBSelectView. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBSelectView\",dataset:\"employee\",displayFields:\"name\"};\r\n * \r\n *     //1. Declaring:\r\n *      <select data-jslet='type:\"DBSelectView\",dataset:\"employee\",displayFields:\"name\"' />\r\n *      or\r\n *      <select data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <select id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSelectView = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,displayFields,groupField';\r\n\r\n\t\tZ._groupField = null;\r\n\t\t\r\n\t\tZ._displayFields = null;\r\n\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\t\r\n\t\tZ._isRendering = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get group field name, you can use this to group options. <br />\r\n\t * Detail to see HTML \"OptGroup\" element.\r\n\t * \r\n\t * @param {String | undefined} groupField Group field name.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tgroupField: function(groupField) {\r\n\t\tif(groupField === undefined) {\r\n\t\t\treturn this._groupField;\r\n\t\t}\r\n\t\tgroupField = jQuery.trim(groupField);\r\n\t\tjslet.Checker.test('DBSelectView.groupField', groupField).isString();\r\n\t\tthis._groupField = groupField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display fields to render tree node, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @param {String | undefined} displayFields Display fields, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdisplayFields: function(displayFields) {\r\n\t\tif(displayFields === undefined) {\r\n\t\t\tvar dispFields = this._displayFields;\r\n\t\t\tif(dispFields) {\r\n\t\t\t\tif(this._dataset.getField(dispFields)) {\r\n\t\t\t\t\treturn '[' + dispFields + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn dispFields;\r\n\t\t\t} else {\r\n\t\t\t\tvar dataset = this._dataset;\r\n\t\t\t\tvar dispField = dataset.nameField() || dataset.codeField() || dataset.keyField();\r\n\t\t\t\tif(dispField) {\r\n\t\t\t\t\treturn '[' + dispField + ']';\r\n\t\t\t\t}\r\n\t\t\t\tjslet.Checker.test('DBSelectView.displayFields', dispField).required();\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisplayFields = jQuery.trim(displayFields);\r\n\t\tjslet.Checker.test('DBSelectView.displayFields', displayFields).required().isString();\r\n\t\tthis._displayFields = displayFields;\r\n\t\tthis._innerDisplayFieldsExpr = null;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);\r\n\t\tjqEl.addClass('form-control input-sm');//Bootstrap class\r\n\t}, // end bind\r\n\r\n\t_doChanged: function(event) {\r\n\t\tthis.jslet._dataset.recno(parseInt(this.value));\r\n\t},\r\n\t\r\n\t_renderOptions: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._isRendering = true;\r\n\t\tvar dsObj = Z.dataset(),\r\n\t\t\tgroupIsLookup = false,\r\n\t\t\tgroupLookup, \r\n\t\t\tgroupFldObj, \r\n\t\t\textraIndex;\r\n\t\tif (Z._groupField) {\r\n\t\t\tgroupFldObj = dsObj.getField(Z._groupField);\r\n\t\t\tif (groupFldObj === null) {\r\n\t\t\t\tthrow 'NOT found field: ' + Z._groupField + ' in ' + dsObj.name();\r\n\t\t\t}\r\n\t\t\tdsObj.fixedIndexFields(Z._groupField);\r\n\t\t}\r\n\t\tvar preGroupValue = null, groupValue, groupDisplayValue, content = [];\r\n\r\n\t\tvar oldRecno = dsObj.recno(),\r\n\t\t\toptValue, optDispValue, \r\n\t\t\tfirstItemValue = null,\r\n\t\t\tdispFieldExpr = Z.displayFields();\r\n\t\tjslet.Checker.test('DBSelectView.displayFields', dispFieldExpr).required().isString();\r\n\t\tif(!Z._innerDisplayFieldsExpr) {\r\n\t\t\tZ._innerDisplayFieldsExpr = new jslet.data.Expression(dsObj, dispFieldExpr);\r\n\t\t}\r\n\t\tvar allCnt = 0, displayValue;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = dsObj.recordCount(); i < cnt; i++) {\r\n\t\t\t\tdsObj.recnoSilence(i);\r\n\t\t\t\tif (Z._groupField) {\r\n\t\t\t\t\tgroupValue = dsObj.getFieldValue(Z._groupField);\r\n\t\t\t\t\tif (groupValue != preGroupValue) {\r\n\t\t\t\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (groupIsLookup) {\r\n\t\t\t\t\t\t\tif (!groupLookup.dataset()\r\n\t\t\t\t\t\t\t\t\t\t\t.findByField(groupLookup.keyField(), groupValue)) {\r\n\t\t\t\t\t\t\t\tthrow 'Not found: [' + groupValue + '] in Dataset: [' +\r\n\t\t\t\t\t\t\t\t\tgroupLookup.dataset().name() +\r\n\t\t\t\t\t\t\t\t\t']field: [' + groupLookup.keyField() + ']';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupLookup.getCurrentDisplayValue();\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupValue;\r\n\r\n\t\t\t\t\t\tcontent.push('<optgroup label=\"');\r\n\t\t\t\t\t\tcontent.push(groupDisplayValue);\r\n\t\t\t\t\t\tcontent.push('\">');\r\n\t\t\t\t\t\tpreGroupValue = groupValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push('<option value=\"'+ i +'\">');\r\n\t\t\t\tcontent.push(Z._innerDisplayFieldsExpr.eval());\r\n\t\t\t\tcontent.push('</option>');\r\n\t\t\t\tallCnt++;\r\n\t\t\t} // end for\r\n\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t}\r\n\t\t\tif(allCnt > 100) {\r\n\t\t\t\tconsole.warn(dsObj.name() + jsletlocale.DBSelectView.moreLookupRecords);\r\n\t\t\t}\r\n\r\n\t\t\tjQuery(Z.el).html(content.join(''));\r\n\t\t} finally {\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t\tZ.el.value = Z.dataset().recno();\r\n\t\t}\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tthis._renderOptions();\r\n\t\treturn this;\r\n\t},\r\n\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\t//empty\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tZ.el.value = Z.dataset().recno();\r\n\t\t}\r\n\t}, // end refreshControl\r\n\t\t\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBSelectView', jslet.ui.DBSelectView);\r\njslet.ui.DBSelectView.htmlTemplate = '<select></select>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBSpinEdit. \r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5};\r\n * \r\n *    //1. Declaring:\r\n *     <div data-jslet='type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5'></div>\r\n *     or\r\n *     <div data-jslet='jsletParam'></div>\r\n *\r\n *    //2. Binding\r\n *     <div id=\"ctrlId\"></div>\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *    //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBSpinEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,step';\r\n\r\n\t\tZ._step = 1;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get step.\r\n\t * \r\n\t * @param {Integer | undefined} step Step value.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBSpinEdit.step', step).isNumber();\r\n\t\tthis._step = step;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tag = el.tagName.toLowerCase();\r\n\t\treturn tag == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-spinedit')) {\r\n\t\t\tjqEl.addClass('input-group jl-spinedit');\r\n\t\t}\r\n\t\tZ._createControl();\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t_createControl: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\ts = '<input type=\"text\" class=\"form-control\">' + \r\n\t\t    \t'<div class=\"jl-spinedit-btn-group\">' +\r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-up\" tabindex=\"-1\"><i class=\"fa fa-caret-up\"></i></button>' + \r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-down\" tabindex=\"-1\"><i class=\"fa fa-caret-down\"></i></button>';\r\n\t\tjqEl.html(s);\r\n\t\t\r\n\t\tvar editor = jqEl.find('input')[0],\r\n\t\t\tupButton = jqEl.find('.jl-spinedit-up')[0],\r\n\t\t\tdownButton = jqEl.find('.jl-spinedit-down')[0];\r\n\t\tZ.editor = editor;\r\n\t\teditor.name = Z._field;\r\n\t\tjQuery(Z.editor).on(\"keydown\", function(event){\r\n\t\t\tif(Z._isDisabled()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar keyCode = event.keyCode;\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.UP) {\r\n\t\t\t\tZ.decValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tZ.incValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t\tnew jslet.ui.DBText(editor, {\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._field,\r\n\t\t\tbeforeUpdateToDataset: Z.beforeUpdateToDataset,\r\n\t\t\tvalueIndex: Z._valueIndex,\r\n\t\t\ttabIndex: Z._tabIndex\r\n\t\t});\r\n\t\t\r\n\t\tvar jqBtn = jQuery(upButton);\r\n\t\tjqBtn.on('click', function () {\r\n\t\t\tZ.incValue();\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqBtn.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn = jQuery(downButton);\r\n\t\tjqBtn.on('click', function () {\r\n\t\t\tZ.decValue();\r\n\t\t});\r\n\t\t\r\n\t\tjqBtn.focus(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t\t});\r\n\t\tjqBtn.blur(function(event) {\r\n\t\t\tjslet.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_isDisabled: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\treturn fldObj.disabled() || fldObj.readOnly();\r\n\t},\r\n\t\r\n\tbeforeUpdateToDataset: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.el.value;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min || range.min === 0) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max || range.min === 0) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (val) {\r\n\t\t\tval = parseFloat(val);\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.el.value = val;\r\n\t\treturn true;\r\n\t},\r\n\r\n\tsetValueToDataset: function (val) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.silence) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.silence = true;\r\n\t\tif (val === undefined) {\r\n\t\t\tval = Z.value;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, val, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ.silence = false;\r\n\t\t}\r\n\t},\r\n\r\n\tincValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar maxValue = Z._getRange().maxValue;\r\n\t\tif (val === maxValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val < maxValue) {\r\n\t\t\tval += Z._step;\r\n\t\t} else {\r\n\t\t\tval = maxValue;\r\n\t\t}\r\n\t\tif (val > maxValue) {\r\n\t\t\tval = maxValue;\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_getRange: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min || range.min === 0) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max || range.min === 0) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {minValue: minValue, maxValue: maxValue};\r\n\t},\r\n\t\r\n\tdecValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar minValue = Z._getRange().minValue;\r\n\t\tif (val === minValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val > minValue) {\r\n\t\t\tval -= Z._step;\r\n\t\t} else {\r\n\t\t\tval = minValue;\r\n\t\t}\r\n\t\tif (val < minValue)\r\n\t\t\tval = minValue;\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tthis.editor.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\r\n\t\tif(!metaName || metaName == 'disabled' || metaName == 'readOnly') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly(),\r\n\t\t\t\tjqUpBtn = jqEl.find('.jl-spinedit-up'),\r\n\t\t\t\tjqDownBtn = jqEl.find('.jl-spinedit-down');\r\n\t\t\t\t\r\n\t\t\tif (disabled) {\r\n\t\t\t\tjqUpBtn.attr('disabled', 'disabled');\r\n\t\t\t\tjqDownBtn.attr('disabled', 'disabled');\r\n\t\t\t} else {\r\n\t\t\t\tjqUpBtn.attr('disabled', false);\r\n\t\t\t\tjqDownBtn.attr('disabled', false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'dataRange') {\r\n\t\t\tvar range = fldObj.dataRange();\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.min || range.min === 0) ? range.min: '');\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.max || range.max === 0) ? range.max: '');\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function(){\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\ttableId: function($super, tableId){\r\n\t\t$super(tableId);\r\n\t\tthis.editor.jslet.tableId(tableId);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function(){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjQuery(this.editor).off();\r\n\t\tthis.editor = null;\r\n\t\tjqEl.find('.jl-upbtn-up').off();\r\n\t\tjqEl.find('.jl-downbtn-up').off();\r\n\t}\r\n\t\r\n});\r\njslet.ui.register('DBSpinEdit', jslet.ui.DBSpinEdit);\r\njslet.ui.DBSpinEdit.htmlTemplate = '<div></div>';\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBTimePicker is used for time inputting. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBTimePicker\",field:\"time\"};\r\n *     //1. Declaring:\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *      or\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='{type:\"DBTimePicker\",field:\"time\"}' />\r\n *\r\n *     //2. Binding\r\n *      <input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTimePicker = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,is12Hour,hasSecond';\r\n\t\t\r\n\t\tZ._is12Hour = false;\r\n\t\t\r\n\t\tZ._hasSecond = true;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether use 12-hour style.\r\n\t * \r\n\t * @param {Boolean | undefined} is12Hour True - use 12-hour style, false(default) - use 24-hour style.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tis12Hour: function(is12Hour) {\r\n\t\tif(is12Hour === undefined) {\r\n\t\t\treturn this._is12Hour;\r\n\t\t}\r\n\t\tthis._is12Hour = is12Hour? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether exists \"Second\" part or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSecond True(default) - exists \"Second\" part, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSecond: function(hasSecond) {\r\n\t\tif(hasSecond === undefined) {\r\n\t\t\treturn this._hasSecond;\r\n\t\t}\r\n\t\tthis._hasSecond = hasSecond? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div' || tagName == 'span';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-timepicker')) {\r\n\t\t\tjqEl.addClass('form-control jl-timepicker');\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tjqEl.on('change', 'select', function(event){\r\n\t\t\tZ.updateToDataset();\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminTimePart = {hour: 0, minute: 0, second: 0},\r\n\t\t\tmaxTimePart = {hour: 23, minute: 59, second: 59};\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min) {\r\n\t\t\t\tminTimePart = Z._splitTime(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tmaxTimePart = Z._splitTime(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar\ttmpl = [];\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-hour\">');\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tvar minHour = minTimePart.hour;\r\n\t\t\tvar maxHour = maxTimePart.hour;\r\n\t\t\tvar min = 100, max = 0, hour;\r\n\t\t\tfor(var k = minHour; k < maxHour; k++) {\r\n\t\t\t\thour = k;\r\n\t\t\t\tif( k > 11) {\r\n\t\t\t\t\thour = k - 12;\r\n\t\t\t\t}\r\n\t\t\t\tmin = Math.min(min, hour);\r\n\t\t\t\tmax = Math.max(max, hour);\r\n\t\t\t}\r\n\t\t\ttmpl.push(Z._getOptions(min, max));\r\n\t\t} else {\r\n\t\t\ttmpl.push(Z._getOptions(minTimePart.hour, maxTimePart.hour || 23));\r\n\t\t}\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-minute\">');\r\n\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\tif(Z._hasSecond) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-second\">');\r\n\t\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\t\ttmpl.push('</select>');\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-ampm\"><option value=\"am\">AM</option><option value=\"pm\">PM</option></select>');\r\n\t\t}\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_getOptions: function(begin, end) {\r\n\t\tvar result = [], value;\r\n\t\tfor(var i = begin; i <= end; i++) {\r\n\t\t\tif( i < 10) {\r\n\t\t\t\tvalue = '0' + i;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '' + i;\r\n\t\t\t}\r\n\t\t\tresult.push('<option value=\"');\r\n\t\t\tresult.push(i);\r\n\t\t\tresult.push('\">');\r\n\t\t\tresult.push(value);\r\n\t\t\tresult.push('</option>');\r\n\t\t}\r\n\t\treturn result.join('');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar items = jQuery(Z.el).find(\"select\"), item,\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\tfor(var i = 0, cnt = items.length; i < cnt; i++){\r\n\t\t\t\titem = items[i];\r\n\t\t\t\titem.disabled = disabled;\r\n\t\t\t\tjslet.ui.setEditableStyle(item, disabled, disabled, true, required);\r\n\t\t\t\titem.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\ttimePart = Z._splitTime(value),\r\n\t\t\thour = timePart.hour,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHour = jqEl.find('.jl-time-hour'),\r\n\t\t\tjqMinute = jqEl.find('.jl-time-minute');\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tvar jqAmPm = jqEl.find('.jl-time-ampm');\r\n\t\t\tjqAmPm.prop('selectedIndex', hour < 12 ? 0: 1);\r\n\t\t\tif(hour > 11) {\r\n\t\t\t\thour -= 12;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjqHour.val(hour);\r\n\t\tjqMinute.val(timePart.minute);\r\n\t\tif(Z._hasSecond) {\r\n\t\t\tjqMinute = jqEl.find('.jl-time-second');\r\n\t\t\tjqMinute.val(timePart.second);\r\n\t\t}\r\n\t},\r\n\t \r\n\t_splitTime: function(value) {\r\n\t\tvar\thour = 0,\r\n\t\t\tminute = 0,\r\n\t\t\tsecond = 0;\r\n\t\tif(value) {\r\n\t\t\tif(jslet.isDate(value)) {\r\n\t\t\t\thour = value.getHours();\r\n\t\t\t\tminute = value.getMinutes();\r\n\t\t\t\tsecond = value.getSeconds();\r\n\t\t\t} else if(jslet.isString(value)) {\r\n\t\t\t\tvar parts = value.split(\":\");\r\n\t\t\t\thour = parseInt(parts[0]);\r\n\t\t\t\tif(parts.length > 1) {\r\n\t\t\t\t\tminute = parseInt(parts[1]);\r\n\t\t\t\t}\r\n\t\t\t\tif(parts.length > 2) {\r\n\t\t\t\t\tsecond = parseInt(parts[2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {hour: hour, minute: minute, second: second};\r\n\t},\r\n\t\r\n\t_prefix: function(value) {\r\n\t\tif(parseInt(value) < 10) {\r\n\t\t\treturn '0' + value;\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tvalue = null, hour;\r\n\t\t\tif(fldObj.getType() != jslet.data.DataType.DATE) {\r\n\t\t\t\tvalue = [];\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val()) + 12;\r\n\t\t\t\t\tvalue.push(hour);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-hour').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue.push(':');\r\n\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-minute').val()));\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tvalue.push(':');\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-second').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue = value.join('');\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getValue();\r\n\t\t\t\tif(!value) {\r\n\t\t\t\t\tvalue = new Date();\r\n\t\t\t\t}\r\n\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val());\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour += 12;\r\n\t\t\t\t}\r\n\t\t\t\tvar minute = parseInt(jqEl.find('.jl-time-minute').val());\r\n\t\t\t\tvar second = 0;\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tsecond = parseInt(jqEl.find('.jl-time-second').val());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvalue.setHours(hour);\r\n\t\t\t\tvalue.setMinutes(minute);\r\n\t\t\t\tvalue.setSeconds(second);\r\n\t\t\t}\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinnerFocus: function() {\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('.jl-time-hour').focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBTimePicker', jslet.ui.DBTimePicker);\r\njslet.ui.DBTimePicker.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBFieldControl\r\n * \r\n * DBUEditor is a data sensitive UEditor. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:DBUEditor,field:name};\r\n *     //1. Declaring:\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      or\r\n *      <input id=ctrlId type=text data-jslet='{type:DBUEditor,field:name}' /&gt;\r\n * \r\n *     //2. Binding\r\n *      <input id=ctrlId type=text data-jslet='jsletParam' /&gt;\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBUEditor = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,field,height';\r\n\r\n\t\tZ._height = 150;\r\n\t\t\r\n\t\tZ._oldValue = null;\r\n\t\t\r\n\t\tZ._editor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get UEditor initial height.\r\n\t * \r\n\t * @param {Integer | undefined} height UEditor initial height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBUEditor.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!window.UE) {\r\n\t\t\tthrow new Error('Not found UEditor component! Goto for more: http://ueditor.baidu.com/website/');\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('jl-ueditor');\r\n\t\tvar editorId = jslet.nextId();\r\n\t\tvar html = '<textarea></textarea>';\r\n\t\tjqEl.html(html);\r\n\t\tjqEl.children().attr('id', editorId).attr('name', Z._field);\r\n\t\tvar editor = window.UE.getEditor(editorId);\r\n\t\t\r\n\t\teditor.on('focus', jQuery.proxy(Z._doFocus, Z));\r\n\t\teditor.on('contentchange', jQuery.proxy(Z._doChange, Z));\r\n\t\tZ._editor = editor;\r\n\t\teditor.addListener('ready', function(editor) {\r\n\t\t\tZ.renderAll();\r\n\t\t });\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\t_doFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.globalFocusManager.activeDataset(Z._dataset.name()).activeField(Z._field).activeValueIndex(Z._valueIndex);\r\n\t},\r\n\r\n\t_doChange: function() {\r\n\t\tthis.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tconsole.warn('UEditor Not support this feature: set read only!');\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError(), value;\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\tvalue = errObj.inputText;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t\tvalue = Z.getText();\r\n\t\t}\r\n\t\tZ._editor.setContent(value || '');\r\n\t\tZ._oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinnerFocus: function($super) {\r\n\t\tthis._editor.focus();\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z._editor.getContent();\r\n\t\tif(Z._oldValue == value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tZ._editor = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBUEditor', jslet.ui.DBUEditor);\r\njslet.ui.DBUEditor.htmlTemplate = '<div></div>';\r\n\r\n\n/*\r\n * Inner Class for DBTable and DBTreeView control\r\n */\r\n\"use strict\";\r\njslet.ui.ListViewModel = function (dataset, isTree) {// boolean, identify if it's tree model\r\n\tvar visibleCount = 0,\r\n\t\tvisibleStartRow = 0,\r\n\t\tvisibleEndRow = 0,\r\n\t\tneedShowRows = null,//Array of all rows that need show, all of these rows's status will be 'expanded'\r\n\t\tallRows = null,//Array of all rows, include 'expanded' and 'collapsed' rows\r\n\t\tcurrentRowno = 0,\r\n\t\tcurrentRecno = 0;\r\n\tthis.onTopRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onVisibleCountChanged = null; //Event handler: function(visibleRowCount){}\r\n\tthis.onCurrentRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onNeedShowRowsCountChanged = null; //Event handler: function(needShowCount){}\r\n\tthis.onCheckStateChanged = null;  //Event handler: function(){}\r\n\t\t\r\n\tthis.fixedRows = 0;\r\n\tvar initial = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar ds = dataset;\r\n\t\tif (!ds._parentField || !ds._keyField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\tinitial();\r\n\t\r\n\tthis.refreshModel = function (expandLevel) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\texpandLevel = -1;\r\n\t\t}\r\n\t\tvar dsObj = dataset, \r\n\t\t\thiddenCnt = 0, \r\n\t\t\trecno, \r\n\t\t\tallCnt = dsObj.recordCount(), \r\n\t\t\tchildCnt, \r\n\t\t\tresult = [], \r\n\t\t\tpId,\r\n\t\t\toldRecno = dsObj.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdsObj.recnoSilence(this.fixedRows);\r\n\t\t\tvar level = 0, \r\n\t\t\t\tpnodes = [], \r\n\t\t\t\tnode, pnode, \r\n\t\t\t\ttmpNode, tmpKeyValue,\r\n\t\t\t\tcurrRec, keyValue, recCnt;\r\n\t\t\tfor(recno = 0, recCnt = dsObj.recordCount(); recno < recCnt; recno++) {\r\n\t\t\t\tdsObj.recnoSilence(recno);\r\n\t\t\t\tkeyValue = dsObj.keyValue();\r\n\t\t\t\tlevel = 0;\r\n\t\t\t\tpnode = null;\r\n\t\t\t\tpId = dsObj.parentValue();\r\n\t\t\t\tfor(var m = pnodes.length - 1; m>=0; m--) {\r\n\t\t\t\t\ttmpNode = pnodes[m];\r\n\t\t\t\t\ttmpKeyValue = tmpNode.keyvalue; \r\n\t\t\t\t\tif (tmpKeyValue !== null && \r\n\t\t\t\t\t\ttmpKeyValue !== undefined && \r\n\t\t\t\t\t\ttmpKeyValue !== '' && \r\n\t\t\t\t\t\ttmpKeyValue == pId) {\r\n\t\t\t\t\t\tlevel = tmpNode.level + 1;\r\n\t\t\t\t\t\tpnode = tmpNode;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tfor(var k = pnodes.length - 1; k > m; k--) {\r\n\t\t\t\t\t\tpnodes.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcurrRec = dsObj.getRecord();\r\n\t\t\t\tvar expanded = true;\r\n\t\t\t\tif(expandLevel >= 0 && level <= expandLevel) {\r\n\t\t\t\t\texpanded = true;\r\n\t\t\t\t} else { \r\n\t\t\t\t\texpanded = dsObj.expanded();\r\n\t\t\t\t}\r\n\t\t\t\tnode = { parent: pnode, recno: recno, keyvalue: keyValue, expanded: expanded, isbold: 0, level: level };\r\n\t\t\t\tpnodes.push(node);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tif (!pnode.children) {\r\n\t\t\t\t\t\tpnode.children = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpnode.children.push(node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(node);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} //end for recno\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tallRows = result;\r\n\t\tfor(var j = 0, len = allRows.length; j < len; j++) {\r\n\t\t\tthis._updateNodeBoldStyle(allRows[j]);\r\n\t\t}\r\n\t\tthis._setLastFlag(result);\r\n\t\tthis._refreshNeedShowRows();\r\n\t};\r\n\t\t\r\n\tthis._updateNodeBoldStyle = function(node) {\r\n\t\t\r\n\t\tfunction update(pnode) {\r\n\t\t\tvar children = pnode.children, \r\n\t\t\t\tcnode, found = false;\r\n\t\t\tif(!children) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, cnt = children.length; i < cnt; i++) {\r\n\t\t\t\tcnode = children[i];\r\n\t\t\t\tif(cnode.children) {\r\n\t\t\t\t\tupdate(cnode);\r\n\t\t\t\t\tif(!cnode.isbold) {\r\n\t\t\t\t\t\tif (dataset.selectedByRecno(cnode.recno)) {\r\n\t\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (dataset.selectedByRecno(cnode.recno)) {\r\n\t\t\t\t\t\tpnode.isbold = true;\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tpnode.isbold = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!node) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar pNode = node, root = node;\r\n\t\twhile(true) {\r\n\t\t\tpNode = node.parent;\r\n\t\t\tif(pNode === null) {\r\n\t\t\t\troot = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tnode = pNode;\r\n\t\t}\r\n\t\tupdate(root);\r\n\t};\r\n\t\r\n\tthis._setLastFlag = function (nodes) {\r\n\t\tif (!nodes || nodes.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tnodes[nodes.length - 1].islast = true;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._setLastFlag(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._refreshNeedShowRows = function (notFireChangedEvent) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = [], node;\r\n\t\tif (!allRows) {\r\n\t\t\tthis.refreshModel();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar preCnt = needShowRows ? needShowRows.length: 0;\r\n\t\tneedShowRows = [];\r\n\t\tthis._findVisibleNode(allRows);\r\n\t\tvar currCnt = needShowRows.length;\r\n\t\tif (!notFireChangedEvent && this.onNeedShowRowsCountChanged){\r\n\t\t\tthis.onNeedShowRowsCountChanged(currCnt);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.hasChildren = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.children && node.children.length > 0;\r\n\t};\r\n\t\r\n\tthis.getLevel = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.level;\r\n\t};\r\n\t\r\n\tthis._findVisibleNode = function (nodes) {\r\n\t\tif (!nodes) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tneedShowRows.push(node);\r\n\t\t\tif (node.expanded){\r\n\t\t\t\tthis._findVisibleNode(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.rownoToRecno = function (rowno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn rowno + this.fixedRows;\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = rowno + this.fixedRows;\r\n\t\t\treturn rowno >= 0 ? rowno : -1;\r\n\t\t}\r\n\t\tif (rowno >= needShowRows.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn needShowRows[rowno].recno;\r\n\t};\r\n\t\r\n\tthis.recnoToRowno = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn recno - this.fixedRows;\r\n\t\t}\r\n\t\tfor(var i = 0, cnt = needShowRows.length; i < cnt; i++){\r\n\t\t\tif (needShowRows[i].recno == recno) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\t\r\n\tthis.setVisibleStartRow = function (rowno, notFireEvt) {\r\n\t\tif (rowno >= 0) {\r\n\t\t\tvar maxVisibleNo = this.getNeedShowRowCount() + 1 - visibleCount;\r\n\t\t\tif (rowno > maxVisibleNo) {\r\n\t\t\t\trowno = maxVisibleNo;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = 0;\r\n\t\t}\r\n\t\tif (visibleStartRow == rowno) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleStartRow = rowno;\r\n\t\tvisibleEndRow = rowno + visibleCount - 1;\r\n\t\tif (!notFireEvt && this.onTopRownoChanged) {\r\n\t\t\tthis.onTopRownoChanged(rowno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleStartRow = function () {\r\n\t\treturn visibleStartRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleEndRow = function(endRow){\r\n\t\tvisibleEndRow = endRow;\r\n\t};\r\n\t\r\n\tthis.getVisibleEndRow = function(){\r\n\t\treturn visibleEndRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleCount = function (count, notFireEvt) {\r\n\t\tif (visibleCount == count) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleCount = count;\r\n\t\tvisibleEndRow = visibleStartRow + count - 1;\r\n\t\tif (!notFireEvt && this.onVisibleCountChanged) {\r\n\t\t\tthis.onVisibleCountChanged(count);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleCount = function () {\r\n\t\treturn visibleCount;\r\n\t};\r\n\t\r\n\tthis.getNeedShowRowCount = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn dataset.recordCount()- this.fixedRows;\r\n\t\t}\r\n\t\treturn needShowRows.length;\r\n\t};\r\n\t\r\n\tthis.getCurrentRow = function(){\r\n\t\treturn needShowRows[currentRowno];\r\n\t};\r\n\t\r\n\tthis.skipSetCurrentRowno = function() {\r\n\t\tthis._skipSetCurrentRowno = true;\r\n\t};\r\n\t\r\n\tthis.setCurrentRowno = function (rowno, notFireEvt, checkVisible) {\r\n\t\tif(this._skipSetCurrentRowno) {\r\n\t\t\tthis._skipSetCurrentRowno = false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(rowno === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar preRowno = currentRowno, recno = 0, currRow=null;\r\n\t\tif (rowno < 0){//In the fixed row area\r\n\t\t\tvar lowestRowno = -1 * this.fixedRows;\r\n\t\t\tif (rowno < lowestRowno) {\r\n\t\t\t\trowno = lowestRowno;\r\n\t\t\t}\r\n\t\t\trecno = this.fixedRows + rowno;\r\n\t\t} else {\r\n\t\t\tvar maxRow = this.getNeedShowRowCount();\r\n\t\t\tif(maxRow === 0) {\r\n\t\t\t\tcurrentRowno = 0;\r\n\t\t\t\tcurrentRecno = -1;\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (rowno >= maxRow) {\r\n\t\t\t\trowno = maxRow - 1;\r\n\t\t\t}\r\n\t\t\tif (!isTree) {\r\n\t\t\t\trecno = rowno + this.fixedRows;\r\n\t\t\t} else {\r\n\t\t\t\tcurrRow = needShowRows[rowno];\r\n\t\t\t\trecno = currRow.recno;\r\n\t\t\t}\r\n\t\t\tif (checkVisible) {\r\n\t\t\t\tif (rowno >= 0 && rowno < visibleStartRow){\r\n\t\t\t\t\tthis.setVisibleStartRow(rowno);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (rowno >= visibleStartRow + visibleCount) {\r\n\t\t\t\t\t\tthis.setVisibleStartRow(rowno - visibleCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcurrentRowno = rowno;\r\n\t\tcurrentRecno = recno;\r\n\t\tif (!notFireEvt && this.onCurrentRownoChanged) {\r\n\t\t\tthis.onCurrentRownoChanged(preRowno, currentRowno);\r\n\t\t}\r\n\t\treturn currRow;\r\n\t};\r\n\t\r\n\tthis.getCurrentRowno = function () {\r\n\t\treturn currentRowno;\r\n\t};\r\n\t\r\n\tthis.getCurrentRecno = function() {\r\n\t\treturn currentRecno;\r\n\t};\r\n\t\r\n\tthis.nextRow = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno + 1, false, true);\r\n\t};\r\n\t\r\n\tthis.priorRow = function (num) {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno - 1, false, true);\r\n\t};\r\n\t\r\n\tthis.nextPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow + visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis.priorPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow - visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis._innerFindNode = function (nodes, recno) {\r\n\t\tvar node, nextNode;\r\n\t\tfor (var i = 0, cnt = nodes.length - 1; i <= cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.recno == recno) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t\tif (node.children) {\r\n\t\t\t\tvar result = this._innerFindNode(node.children, recno);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis.expand = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tnode.expanded = node.children ? true : false;\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(node.expanded);\r\n\t\t\tvar p = node;\r\n\t\t\twhile (true) {\r\n\t\t\t\tp = p.parent;\r\n\t\t\t\tif (!p) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (!p.expanded) {\r\n\t\t\t\t\tdataset.recnoSilence(p.recno);\r\n\t\t\t\t\tdataset.expanded(true);\r\n\t\t\t\t\tp.expanded = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapse = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(false);\r\n\t\t\tnode.expanded = false;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\t\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._iterateNode = function (nodes, callbackFn) {\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children) {\r\n\t\t\t\tif (callbackFn) {\r\n\t\t\t\t\tcallbackFn(node);\r\n\t\t\t\t}\r\n\t\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\t\tthis._iterateNode(node.children, callbackFn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._callbackFn = function (node, expanded) {\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(expanded);\r\n\t\t\tnode.expanded = expanded;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.expandAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, true); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapseAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, false); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.syncDataset = function(){\r\n\t\tvar recno = dataset.recno();\r\n\t\tif(recno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno()),\r\n\t\t\tpnode = node.parent;\r\n\t\tif (pnode && !pnode.expanded){\r\n\t\t\twhile(true){\r\n\t\t\t\tif (!pnode.expanded) {\r\n\t\t\t\t\tpnode.expanded = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tpnode = pnode.parent;\r\n\t\t\t\tif (!pnode) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tvar rowno = this.recnoToRowno(recno);\r\n\t\tthis.setCurrentRowno(rowno, false, true);\r\n\t};\r\n\t\r\n\tthis.checkNode = function(state, relativeCheck, onlyCheckChildren){\r\n\t\tvar node = this.getCurrentRow();\r\n\t\tdataset.selected(state ? 1 : 0);\r\n\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._updateChildState(node, state);\r\n\t\t\t}\r\n\t\t\tif (node.parent && !onlyCheckChildren) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._updateNodeBoldStyle(node);\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.checkChildNodes = function(state, relativeCheck){\r\n\t\tvar node = this.getCurrentRow();\r\n\t\tdataset.selected(state ? 1 : 0);\r\n\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._updateChildState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._updateNodeBoldStyle(node);\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateChildState = function(node, state){\r\n\t\tvar oldRecno = dataset.recnoSilence(),\r\n\t\t\tchildNode;\r\n\t\ttry{\r\n\t\t\tfor(var i = 0, cnt = node.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = node.children[i];\r\n\t\t\t\tdataset.recnoSilence(childNode.recno);\r\n\t\t\t\tdataset.selected(state);\r\n\t\t\t\tif (childNode.children && childNode.children.length > 0) {\r\n\t\t\t\t\tthis._updateChildState(childNode, state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateParentState = function(node, state){\r\n\t\tvar pNode = node.parent;\r\n\t\tif (!pNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar childNode, newState, childState;\r\n\t\tif (state != 2){\r\n\t\t\tfor(var i = 0, cnt = pNode.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = pNode.children[i];\r\n\t\t\t\tchildState = dataset.selectedByRecno(childNode.recno);\r\n\t\t\t\tif (childState == 2){\r\n\t\t\t\t\tnewState = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (i === 0){\r\n\t\t\t\t\tnewState = childState;\r\n\t\t\t\t} else if (newState != childState){\r\n\t\t\t\t\tnewState =2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}//end for\r\n\t\t} else {\r\n\t\t\tnewState = state;\r\n\t\t}\r\n\t\tvar pState = dataset.selectedByRecno(pNode.recno);\r\n\t\tif (pState != newState){\r\n\t\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\t\ttry{\r\n\t\t\t\tdataset.recnoSilence(pNode.recno);\r\n\t\t\t\tdataset.selected(newState);\r\n\t\t\t}finally{\r\n\t\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateParentState(pNode, newState);\r\n\t};\r\n\t\r\n\tthis.reset = function() {\r\n\t\tvisibleCount = 0;\r\n\t\tvisibleStartRow = 0;\r\n\t\tvisibleEndRow = 0;\r\n\t\tneedShowRows = null;\r\n\t\tallRows = null;\r\n\t\tcurrentRowno = 0;\r\n\t\tcurrentRecno = 0;\r\n\t\tthis.fixedRows = 0;\r\n\t};\r\n\t\r\n\tthis.destroy = function(){\r\n\t\tdataset = null;\r\n\t\tallRows = null;\r\n\t\tthis.reset();\r\n\t\tthis.onTopRownoChanged = null;\r\n\t\tthis.onVisibleCountChanged = null;\r\n\t\tthis.onCurrentRownoChanged = null;\r\n\t\tthis.onNeedShowRowsCountChanged = null;\r\n\t\tthis.onCheckStateChanged = null;\r\n\t};\r\n};\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBTreeView. <br /> \r\n * Features: <br />\r\n * 1. Perfect performance, you can load unlimited data; <br />\r\n * 2. Checkbox on tree node; <br />\r\n * 3. Relative check, when you check one tree node, its children and its parent will check too; <br />\r\n * 4. Many events for you to customize tree control; <br />\r\n * 5. Context menu supported and you can customize your context menu; <br />\r\n * 6. Icon supported on each tree node. <br />\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = { type: \"DBTreeView\", \r\n *     \tdataset: \"dsAgency\", \r\n *     \tdisplayFields: \"[code]+'-'+[name]\",\r\n *      keyField: \"id\", \r\n *     \tparentField: \"parentid\",\r\n *      hasCheckBox: true, \r\n *     \ticonClassField: \"iconcls\", \r\n *     \tonCreateContextMenu: doCreateContextMenu, \r\n *     \tcorrelateCheck: true\r\n *     };\r\n *     \r\n *     //1. Declaring:\r\n *       <div id=\"ctrlId\" data-jslet=\"jsletParam\">\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *     \tvar el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTreeView = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,displayFields,useArrow,itemHeight,hasLine,hasCheckBox,enableErrorFinding,correlateCheck,correlative,onlyCheckChildren,readOnly,expandLevel,onItemClick,onItemDblClick,beforeCheckBoxClick,afterCheckBoxClick,iconClassField,onGetIconClass,onRenderItem,onCreateContextMenu';\r\n\t\tZ.requiredProperties = 'displayFields';\r\n\t\t\r\n\t\tZ._displayFields = null;\r\n\r\n\t\tZ._itemHeight = 22;\r\n\t\t\r\n\t\tZ._useArrow = false;\r\n\r\n\t\tZ._hasLine = true;\r\n\r\n\t\tZ._hasCheckBox = false;\r\n\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\tZ._correlative = false;\r\n\t\t\r\n\t\tZ._onlyCheckChildren = false;\r\n\t\t\r\n\t\tZ._iconClassField = null;\r\n\t\t\r\n\t\tZ._expandLevel = -1;\r\n\t\t\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._onItemDblClick = null;\r\n\r\n\t\tZ._beforeCheckBoxClick = null;\r\n\t\t\r\n\t\tZ._afterCheckBoxClick = null;\r\n\r\n\t\tZ._onGetIconClass = null;\r\n\t\t\r\n\t\tZ._onRenderItem = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ._enableErrorFinding = false;\r\n\t\t\r\n\t\tZ.iconWidth = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display fields to render tree node, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @param {String | undefined} displayFields Display fields, it's a js expresssion, like: \"[code]+'-'+[name]\".\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tdisplayFields: function(displayFields) {\r\n\t\tif(displayFields === undefined) {\r\n\t\t\tvar dispFields = this._displayFields;\r\n\t\t\tif(dispFields) {\r\n\t\t\t\tif(this._dataset.getField(dispFields)) {\r\n\t\t\t\t\treturn '[' + dispFields + ']';\r\n\t\t\t\t}\r\n\t\t\t\treturn dispFields;\r\n\t\t\t} else {\r\n\t\t\t\tvar dataset = this._dataset;\r\n\t\t\t\tvar dispField = dataset.nameField() || dataset.codeField() || dataset.keyField();\r\n\t\t\t\tif(dispField) {\r\n\t\t\t\t\treturn '[' + dispField + ']';\r\n\t\t\t\t}\r\n\t\t\t\tjslet.Checker.test('DBTreeView.displayFields', dispField).required();\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisplayFields = jQuery.trim(displayFields);\r\n\t\tjslet.Checker.test('DBTreeView.displayFields', displayFields).required().isString();\r\n\t\tthis._displayFields = displayFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get tree items' height, default is 22px.\r\n\t * \r\n\t * @param {Integer | undefined} itemHeight Tree items' height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\titemHeight: function(itemHeight) {\r\n\t\tif(itemHeight === undefined) {\r\n\t\t\treturn this._itemHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.itemHeight', itemHeight).isNumber();\r\n\t\tthis._itemHeight = itemHeight;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If icon class is stored one field, you can set this property to display different tree node icon.\r\n\t * \r\n\t * @param {String | undefined} iconClassField Icon class field.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ticonClassField: function(iconClassField) {\r\n\t\tif(iconClassField === undefined) {\r\n\t\t\treturn this._iconClassField;\r\n\t\t}\r\n\t\ticonClassField = jQuery.trim(iconClassField);\r\n\t\tjslet.Checker.test('DBTreeView.iconClassField', iconClassField).isString();\r\n\t\tthis._iconClassField = iconClassField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, use \"Arrow\" as expander, else \"Plus/Minus\" as expander.\r\n\t * \r\n\t * @param {Boolean | undefined} useArrow True - use \"Arrow\" as expander, False - \"Plus/Minus\" as expander.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tuseArrow: function(useArrow) {\r\n\t\tif(useArrow === undefined) {\r\n\t\t\treturn this._useArrow;\r\n\t\t}\r\n\t\tthis._useArrow = useArrow ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is a line before tree node.\r\n\t * \r\n\t * @param {Boolean | undefined} hasLine True - a line before tree node, False - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasLine: function(hasLine) {\r\n\t\tif(hasLine === undefined) {\r\n\t\t\treturn this._hasLine;\r\n\t\t}\r\n\t\tthis._hasLine = hasLine ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is a check box on tree node.\r\n\t * \r\n\t * @param {Boolean | undefined} hasCheckBox True - a check box on tree node, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasCheckBox: function(hasCheckBox) {\r\n\t\tif(hasCheckBox === undefined) {\r\n\t\t\treturn this._hasCheckBox;\r\n\t\t}\r\n\t\tthis._hasCheckBox = hasCheckBox ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\treturn this.correlative(correlateCheck);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, when you check one tree node, its children and its parent will be checked too.\r\n\t * \r\n\t * @param {Boolean | undefined} correlative If true, when checking one tree node, its children and its parent will be checked too.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tcorrelative: function(correlative) {\r\n\t\tif(correlative === undefined) {\r\n\t\t\treturn this._correlative;\r\n\t\t}\r\n\t\tthis._correlative = correlative ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * If true, only check children.\r\n\t * \r\n\t * @param {Boolean | undefined} onlyCheckChildren True - only check children, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlyCheckChildren: function(onlyCheckChildren) {\r\n\t\tif(onlyCheckChildren === undefined) {\r\n\t\t\treturn this._onlyCheckChildren;\r\n\t\t}\r\n\t\tthis._onlyCheckChildren = onlyCheckChildren ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the checkbox is read only or not, ignored if \"hasCheckBox\" is false.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly Checkbox is readOnly or not, ignored if hasCheckBox = false.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the nodes which level is from 0 to \"expandLevel\" will be expanded when initialize tree.\r\n\t * \r\n\t * @param {Integer | undefined} expandLevel Identify the nodes which level is from 0 to \"expandLevel\" will be expanded when initialize tree.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\texpandLevel: function(expandLevel) {\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\treturn this._expandLevel;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.expandLevel', expandLevel).isGTEZero();\r\n\t\tthis._expandLevel = parseInt(expandLevel);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it's showing the 'Error find' menu item in the context menu.\r\n\t * \r\n\t * @param {Boolean | undefined} enableErrorFinding True - show error find menu item in the context menu, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableErrorFinding: function(enableErrorFinding) {\r\n\t\tif(enableErrorFinding === undefined) {\r\n\t\t\treturn this._enableErrorFinding;\r\n\t\t}\r\n\t\tthis._enableErrorFinding = enableErrorFinding ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Get or set item clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onItemClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} onItemClick Item clicking event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Get or set item double clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onItemDblClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} onItemDblClick Double clicking item event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonItemDblClick: function(onItemDblClick) {\r\n\t\tif(onItemDblClick === undefined) {\r\n\t\t\treturn this._onItemDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemDblClick', onItemDblClick).isFunction();\r\n\t\tthis._onItemDblClick = onItemDblClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get before check box clicking event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.beforeCheckBoxClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} beforeCheckBoxClick Before check box clicking event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeCheckBoxClick: function(beforeCheckBoxClick) {\r\n\t\tif(beforeCheckBoxClick === undefined) {\r\n\t\t\treturn this._beforeCheckBoxClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.beforeCheckBoxClick', beforeCheckBoxClick).isFunction();\r\n\t\tthis._beforeCheckBoxClick = beforeCheckBoxClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get after check box click event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.afterCheckBoxClick(function() {});\r\n\t * \r\n\t * @param {Function | undefined} afterCheckBoxClick After check box clicking event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterCheckBoxClick: function(afterCheckBoxClick) {\r\n\t\tif(afterCheckBoxClick === undefined) {\r\n\t\t\treturn this._afterCheckBoxClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.afterCheckBoxClick', afterCheckBoxClick).isFunction();\r\n\t\tthis._afterCheckBoxClick = afterCheckBoxClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * You can use this event to customize your tree node icon flexibly. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onGetIconClass(function(keyValue, level, isLeaf) {\r\n\t *        return 'icon_class';\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} onGetIconClass Get icon class event.\r\n\t * @param {String} onGetIconClass.keyValue Key value of tree node.\r\n\t * @param {Integer} onGetIconClass.level Tree node level.\r\n\t * @param {Boolean} onGetIconClass.isLeaf Identify whether the tree node is the leaf node.\r\n\t * @param {String} onGetIconClass.return Icon class name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonGetIconClass: function(onGetIconClass) {\r\n\t\tif(onGetIconClass === undefined) {\r\n\t\t\treturn this._onGetIconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onGetIconClass', onGetIconClass).isFunction();\r\n\t\tthis._onGetIconClass = onGetIconClass;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get item rendering event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onRenderItem(function(iconEl, textEl, level, isLeaf) {});\r\n\t * \r\n\t * @param {Function | undefined} onRenderItem Item rendering event.\r\n\t * @param {HtmlElement} onRenderItem.iconEl HTML element for rendering icon.\r\n\t * @param {HtmlElement} onRenderItem.textEl HTML element for rendering text.\r\n\t * @param {Integer} onRenderItem.level Tree node level.\r\n\t * @param {Boolean} onRenderItem.isLeaf Identify whether the tree node is the leaf node.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRenderItem: function(onRenderItem) {\r\n\t\tif(onRenderItem === undefined) {\r\n\t\t\treturn this._onRenderItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onRenderItem', onRenderItem).isFunction();\r\n\t\tthis._onRenderItem = onRenderItem;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Set or get context menu creating event. It's used to add customized menu. Example:\r\n\t * \r\n\t *     @example\r\n\t *     treeObj.onCreateContextMenu(function(menuItems) {\r\n\t *       menuItems.push({ name: '-' });\r\n\t *       menuItems.push({ id: 'customMenu', name: 'Customized Menu1', onClick: function() { alert('Customized Menu1 clicked!'); } });\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onCreateContextMenu context menu creating event.\r\n\t * @param {Object[]} onCreateContextMenu.menuItems context menu creating event.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.scrBarSize = jslet.ui.scrollbarSize() + 1;\r\n\t\t\r\n\t\tif (Z._keyField === undefined) {\r\n\t\t\tZ._keyField = Z._dataset.keyField();\r\n\t\t}\r\n\t\tvar ti = jqEl.attr('tabindex');\r\n\t\tif (!ti) {\r\n\t\t\tjqEl.attr('tabindex', -1);\r\n\t\t}\r\n\t\tjqEl.keydown(function(event) {\r\n\t\t\tvar keyCode = event.which, \r\n\t\t\t\tctrlKey = event.ctrlKey;\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.E) { //ctrl + e\r\n\t\t\t\tZ.gotoNextError();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.HOME) { //ctrl + Home\r\n\t\t\t\tZ._dataset.first();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(ctrlKey && keyCode === jslet.ui.KeyCode.END) { //ctrl + Home\r\n\t\t\t\tZ._dataset.last();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.on('mouseenter', 'td.jl-tree-text', function(event) {\r\n\t\t\tjQuery(this).addClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tjqEl.on('mouseleave', 'td.jl-tree-text', function(event) {\r\n\t\t\tjQuery(this).removeClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tif (!jqEl.hasClass('jl-tree')) {\r\n\t\t\tjqEl.addClass('jl-tree');\r\n\t\t}\r\n        var notFF = ((typeof Z.el.onmousewheel) == 'object'); //firefox or nonFirefox browser\r\n        var wheelEvent = (notFF ? 'mousewheel' : 'DOMMouseScroll');\r\n        jqEl.on(wheelEvent, function(event) {\r\n            var originalEvent = event.originalEvent;\r\n            var num = notFF ? originalEvent.wheelDelta / -120 : originalEvent.detail / 3;\r\n            Z.listvm.setVisibleStartRow(Z.listvm.getVisibleStartRow() + num);\r\n       \t\tevent.preventDefault();\r\n        });\r\n\t\t\r\n\t\tZ.renderAll();\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno()));\r\n\t\tZ._createContextMenu();\t\t\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t}, // end bind\r\n\t\r\n\t/**\r\n\t * @override\r\n\t*/\r\n\trenderAll: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.evaluator = new jslet.data.Expression(Z._dataset, Z.displayFields());\r\n\t\tif(Z._useArrow) {\r\n\t\t\tjqEl.removeClass('jl-tree-plus');\r\n\t\t\tjqEl.removeClass('jl-tree-plus-nl');\r\n\t\t\tjqEl.addClass('jl-tree-arrow');\r\n\t\t} else {\r\n\t\t\tjqEl.removeClass('jl-tree-arrow');\r\n\t\t\tif(Z._hasLine) {\r\n\t\t\t\tjqEl.addClass('jl-tree-plus');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.addClass('jl-tree-plus-nl');\r\n\t\t\t}\r\n\t\t}\r\n\t\tjqEl.html('');\r\n\t\tZ.oldWidth = jqEl.width();\r\n\t\tZ.oldHeight = jqEl.height();\r\n\t\tjqEl.css('line-height', Z._itemHeight + 'px');\r\n\t\tZ.nodeHeight = Z.iconWidth = (Z._itemHeight || parseInt(jslet.ui.getCssValue('jl-tree', 'line-height')));\r\n\t\tvar strHeight = jqEl[0].style.height; \r\n\t\tif(strHeight.indexOf('%') > 0) {\r\n\t\t\tZ.treePanelHeight = jqEl.parent().height() * parseFloat(strHeight) / 100;\r\n\t\t} else {\r\n\t\t\tZ.treePanelHeight = jqEl.height();\r\n\t\t}\r\n\t\tZ.treePanelWidth = jqEl.width();\r\n\t\tZ.nodeCount = Math.floor(Z.treePanelHeight / Z.nodeHeight);\r\n\r\n\t\tZ._initVm();\r\n\t\tZ._initFrame();\r\n\t\tZ.listvm.syncDataset();\r\n\t}, // end renderAll\r\n\t\r\n\t_initFrame: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\t\r\n\t\tjqEl.find('.jl-tree-container').off();\r\n\t\tjqEl.find('.jl-tree-scrollbar').off();\r\n\t\t\r\n\t\tvar strCheckbox = '<span class=\"fa-stack jl-tree-mixedchecked jl-hidden\"><i class=\"fa fa-square fa-stack-1x\"></i><i class=\"fa fa-square-o fa-stack-2x\" aria-hidden=\"true\"></i></span>';\r\n\t\tstrCheckbox += '<span class=\"fa fa-check-square-o jl-tree-checked jl-hidden\"></span>';\r\n\t\tstrCheckbox += '<span class=\"fa fa-square-o jl-tree-unchecked jl-hidden\"></span>';\r\n\t\tvar lines = [], i, cnt;\r\n\t\tfor(i = 0; i < 5; i++) {//Default cells for lines is 5\r\n\t\t\tlines.push('<td class=\"jl-tree-unit jl-tree-lines\" ');\r\n\t\t\tlines.push(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tlines.push('=\"0\"></td>');\r\n\t\t}\r\n\t\tvar strLines = lines.join(''),\r\n\t\t\ttmpl = ['<div class=\"jl-tree-container\">'],\r\n\t\t\tflag = !Z._hasLine || Z._useArrow;\r\n\t\tfor(i = 0, cnt = Z.nodeCount; i < cnt; i++) {\r\n\t\t\ttmpl.push('<table class=\"jl-tree-nodes\" cellpadding=\"0\" cellspacing=\"0\"><tr>');\r\n\t\t\ttmpl.push(strLines);\r\n\t\t\ttmpl.push('<td class=\"jl-tree-unit jl-tree-expander\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//expander\r\n\t\t\ttmpl.push('=\"1\">');\r\n\t\t\tif(flag) {\r\n\t\t\t\tif(Z._useArrow) {\r\n\t\t\t\t\ttmpl.push('<i class=\"fa fa-caret-right\" aria-hidden=\"true\"></i>');\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttmpl.push('<i class=\"fa fa-plus-square-o\" aria-hidden=\"true\"></i>');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttmpl.push('</td><td class=\"jl-tree-unit jl-tree-checkbox\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//checkbox\r\n\t\t\ttmpl.push('=\"2\">' + strCheckbox + '</td><td ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//icon\r\n\t\t\ttmpl.push('=\"3\"></td><td class=\"jl-tree-text\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//text\r\n\t\t\ttmpl.push('=\"9\" nowrap=\"nowrap\"></td></tr></table>');\r\n\t\t}\r\n\t\ttmpl.push('</div><div class=\"jl-tree-scrollbar\"><div class=\"jl-tree-tracker\"></div></div>');\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\t\r\n\t\tjqEl.on('click', 'td[data-nodetype]', function(event) {\r\n\t\t\tZ._doRowClick(event.currentTarget);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\tjqEl.on('dblclick', 'td[data-nodetype]', function(event) {\r\n\t\t\tZ._doRowDblClick(event.currentTarget);\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\tZ.listvm.setVisibleCount(Z.nodeCount);\r\n\t\tvar sb = jqEl.find('.jl-tree-scrollbar');\r\n\t\t\r\n\t\tsb.on('scroll',function() {\r\n\t\t\tvar numb = Math.ceil(this.scrollTop/Z.nodeHeight);\r\n\t\t\tif (numb != Z.listvm.getVisibleStartRow()) {\r\n\t\t\t\tZ._skip_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(numb);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._skip_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto next error record if dataset exists error records. Press 'Ctrl + E' to call this method.\r\n\t */\r\n\tgotoNextError: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset.nextError()) {\r\n\t\t\tZ._dataset.firstError();\r\n\t\t}\r\n\t},\r\n\r\n\tresize: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\theight = jqEl.height(),\r\n\t\t\twidth = jqEl.width();\r\n\t\tif (width != Z.oldWidth) {\r\n\t\t\tZ.oldWidth = width;\r\n\t\t\tZ.treePanelWidth = jqEl.innerWidth();\r\n\t\t\tZ._fillData();\r\n\t\t}\r\n\t\tif (height != Z.oldHeight) {\r\n\t\t\tZ.oldHeight = height;\r\n\t\t\tZ.treePanelHeight = jqEl.innerHeight();\r\n\t\t\tZ.nodeCount = Math.floor(height / Z.nodeHeight) - 1;\r\n\t\t\tZ._initFrame();\r\n\t\t}\r\n\t},\r\n\t\r\n\thasChildren: function() {\r\n\t\treturn this.listvm.hasChildren();\r\n\t},\r\n\t\r\n\t_initVm:function() {\r\n\t\tvar Z=this;\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, true);\r\n\t\tZ.listvm.refreshModel(Z._expandLevel);\r\n\t\tZ.listvm.fixedRows=0;\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged=function(rowno) {\r\n\t\t\trowno = Z.listvm.getCurrentRowno();\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onVisibleCountChanged=function() {\r\n\t\t\tZ._fillData();\r\n\t\t\tvar allCount = Z.listvm.getNeedShowRowCount();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * allCount);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged=function(prevRowno, rowno) {\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onNeedShowRowsCountChanged = function(allCount) {\r\n\t\t\tZ._fillData();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * (allCount + 2));\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCheckStateChanged = function() {\r\n\t\t\tZ._fillData();\r\n\t\t};\r\n\t},\r\n\t\r\n\t_doKeydown: function(keyCode) {\r\n\t\tvar Z = this, result = false;\r\n\t\tif (keyCode === jslet.ui.KeyCode.SPACE) {//space\r\n\t\t\tZ._doCheckBoxClick();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.UP) {//KEY_UP\r\n\t\t\tZ.listvm.priorRow();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.DOWN) {//KEY_DOWN\r\n\t\t\tZ.listvm.nextRow();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.LEFT) {//KEY_LEFT\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.RIGHT) {//KEY_RIGHT\r\n\t\t\tif (jsletlocale.isRtl) {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEUP) {//KEY_PAGEUP\r\n\t\t\tZ.listvm.priorPage();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEDOWN) {//KEY_PAGEDOWN\r\n\t\t\tZ.listvm.nextPage();\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tresult = true;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getTrByRowno: function(rowno) {\r\n\t\tvar nodes = jQuery(this.el).find('.jl-tree-nodes'), row;\r\n\t\tfor(var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\trow = nodes[i].rows[0];\r\n\t\t\tif (row.jsletrowno == rowno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_doCurrentRowChanged: function(rowno) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.prevRow) {\r\n\t\t\tjQuery(Z._getTextTd(Z.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tvar otr = Z._getTrByRowno(rowno);\r\n\t\tif (otr) {\r\n\t\t\tjQuery(Z._getTextTd(otr)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tZ.prevRow = otr;\r\n\t},\r\n\t\r\n\t_getTextTd: function(otr) {\r\n\t\treturn otr.cells[otr.cells.length - 1];\r\n\t},\r\n\t\r\n\t_doExpand: function() {\r\n\t\tthis.expand();\r\n\t},\r\n\t\r\n\t_doRowClick: function(treeNode) {\r\n\t\tvar Z = this,\r\n\t\t\tnodeType = treeNode.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif(!nodeType) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (nodeType != '0') {\r\n\t\t\tZ._syncToDs(treeNode);\r\n\t\t}\r\n\t\tif (nodeType == '1' || nodeType == '2') { //expander\r\n\t\t\tvar item = Z.listvm.getCurrentRow();\r\n\t\t\tif (nodeType == '1' && item.children && item.children.length > 0) {\r\n\t\t\t\tif (item.expanded) {\r\n\t\t\t\t\tZ.collapse();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.expand();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (nodeType == '2') {//checkbox\r\n\t\t\t\tZ._doCheckBoxClick();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(nodeType == '9') {\r\n\t\t\tZ._doCheckBoxClick();\r\n\t\t\tif(Z._onItemClick) {\r\n\t\t\t\tZ._onItemClick.call(Z);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doRowDblClick: function(treeNode) {\r\n\t\tthis._syncToDs(treeNode);\r\n\t\tvar nodeType = treeNode.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif (this._onItemDblClick && nodeType == '9') {\r\n\t\t\tthis._onItemDblClick.call(this);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doCheckBoxClick: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = Z.listvm.getCurrentRow();\r\n\t\tif(!node.hasCheckbox) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._beforeCheckBoxClick && !Z._beforeCheckBoxClick.call(Z)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.listvm.checkNode(!Z._dataset.selected()? 1:0, Z._correlative, Z._onlyCheckChildren);\r\n\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncToDs: function(otr) {\r\n\t\tvar rowno = -1, k;\r\n\t\twhile(true) {\r\n\t\t\tk = otr.jsletrowno;\r\n\t\t\tif (k === 0 || k) {\r\n\t\t\t\trowno = k;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\totr = otr.parentNode;\r\n\t\t\tif (!otr) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.listvm.setCurrentRowno(rowno);\r\n\t\tthis._dataset.recno(this.listvm.getCurrentRecno());\r\n\t},\r\n\t\r\n\t_fillData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tvCnt = Z.listvm.getVisibleCount(), \r\n\t\t\ttopRowno = Z.listvm.getVisibleStartRow(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\tavailbleCnt = vCnt + topRowno,\r\n\t\t\tindex = 0,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tree-nodes'), node;\r\n\t\tif (Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._isRendering = true;\r\n\t\tZ._skip_ = true;\r\n\t\tvar oldRecno = Z._dataset.recnoSilence(),\r\n\t\t\tpreRowNo = Z.listvm.getCurrentRowno(),\r\n\t\t\tajustScrBar = true, maxNodeWidth = 0, nodeWidth;\r\n\t\ttry{\r\n\t\t\tif (allCnt < availbleCnt) {\r\n\t\t\t\tfor(var i = availbleCnt - allCnt; i > 0; i--) {\r\n\t\t\t\t\tnode = nodes[vCnt - i];\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tajustScrBar = false; \r\n\t\t\t} else {\r\n\t\t\t\tallCnt = availbleCnt;\r\n\t\t\t}\r\n\t\t\tvar endRow = allCnt - 1;\r\n\t\t\t\r\n\t\t\tfor(var k = topRowno; k <= endRow; k++) {\r\n\t\t\t\tnode = nodes[index++];\r\n\t\t\t\tnodeWidth = Z._fillNode(node, k);\r\n\t\t\t\tif (ajustScrBar && maxNodeWidth < Z.treePanelWidth) {\r\n\t\t\t\t\tif (k == endRow && nodeWidth < Z.treePanelWidth) {\r\n\t\t\t\t\t\tajustScrBar = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaxNodeWidth = Math.max(maxNodeWidth, nodeWidth);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (k == endRow && ajustScrBar) {\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnode.style.display = '';\r\n\t\t\t\t\tnode.jsletrowno = k;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.listvm.setCurrentRowno(preRowNo, false);\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tZ._skip_ = false;\r\n\t\t}\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ._checkScrollBar();\r\n\t\t}, 5);\r\n\t},\r\n\r\n\t_setCheckClsName: function(oCheckBox, expanded) {\r\n\t\tvar jqCheckBox = jQuery(oCheckBox);\r\n\t\tif (!expanded) {\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').removeClass('jl-hidden');\r\n\t\t} else if (expanded == 2) { //mixed checked\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').removeClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').addClass('jl-hidden');\r\n\t\t} else {\r\n\t\t\tjqCheckBox.find('.jl-tree-checked').removeClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-mixedchecked').addClass('jl-hidden');\r\n\t\t\tjqCheckBox.find('.jl-tree-unchecked').addClass('jl-hidden');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillNode: function(nodeTbl, rowNo) {\r\n\t\tvar row = nodeTbl.rows[0],\r\n\t\t\tZ = this,\r\n\t\t\titem = Z.listvm.setCurrentRowno(rowNo, true),\r\n\t\t\tcells = row.cells, \r\n\t\t\tcellCnt = cells.length, \r\n\t\t\trequiredCnt = item.level + 4,\r\n\t\t\totd, i, cnt;\r\n\t\tZ._dataset.recnoSilence(Z.listvm.getCurrentRecno());\r\n\t\trow.jsletrowno = rowNo;\r\n\t\tif (cellCnt < requiredCnt) {\r\n\t\t\tfor(i = 1, cnt = requiredCnt - cellCnt; i <= cnt; i++) {\r\n\t\t\t\totd = row.insertCell(0);\r\n\t\t\t\tjQuery(otd).addClass('jl-tree-unit jl-tree-lines').attr('jsletline', 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cellCnt >= requiredCnt) {\r\n\t\t\tfor(i = 0, cnt = cellCnt - requiredCnt; i < cnt; i++) {\r\n\t\t\t\tcells[i].style.display = 'none';\r\n\t\t\t}\r\n\t\t\tfor(i = cellCnt - requiredCnt; i < requiredCnt; i++) {\r\n\t\t\t\tcells[i].style.display = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tcellCnt = cells.length;\r\n\t\t//Line\r\n\t\tvar pitem = item, k = 1, totalWidth = Z.iconWidth * item.level;\r\n\t\tfor(i = item.level; i > 0; i--) {\r\n\t\t\totd = row.cells[cellCnt- 4 - k++];\r\n\t\t\tpitem = pitem.parent;\r\n\t\t\tif (pitem.islast) {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.empty;\r\n\t\t\t} else {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.line;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//expander\r\n\t\tvar oexpander = row.cells[cellCnt- 4],\r\n\t\t\tjqSign;\r\n\t\toexpander.noWrap = true;\r\n\t\toexpander.style.display = '';\r\n\t\tif (item.children && item.children.length > 0) {\r\n\t\t\tif(!Z._useArrow && Z._hasLine) {\r\n\t\t\t\tif (!item.islast) {\r\n\t\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minus : jslet.ui.htmlclass.TREELINECLASS.plus;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minusBottom : jslet.ui.htmlclass.TREELINECLASS.plusBottom;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjqSign = jQuery(oexpander.childNodes[0]);\r\n\t\t\t\tif(Z._useArrow) {\r\n\t\t\t\t\tif(item.expanded) {\r\n\t\t\t\t\t\tjqSign.addClass('jl-tree-rotate-45');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjqSign.removeClass('jl-tree-rotate-45');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(item.expanded) {\r\n\t\t\t\t\t\tjqSign.removeClass('fa-plus-square-o');\r\n\t\t\t\t\t\tjqSign.addClass('fa-minus-square-o');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjqSign.addClass('fa-plus-square-o');\r\n\t\t\t\t\t\tjqSign.removeClass('fa-minus-square-o');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tjqSign.show();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!Z._useArrow && Z._hasLine) {\r\n\t\t\t\tif (!item.islast) {\r\n\t\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.join;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.joinBottom;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjqSign = jQuery(oexpander.childNodes[0]);\r\n\t\t\t\tjqSign.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t\ttotalWidth += Z.iconWidth;\r\n\t\t\t\t\r\n\t\t// CheckBox\r\n\t\tvar flag = Z._hasCheckBox && Z._dataset.checkSelectable();\r\n\t\tvar node = Z.listvm.getCurrentRow();\r\n\t\tnode.hasCheckbox = flag;\r\n\t\tvar ocheckbox = row.cells[cellCnt- 3];\r\n\t\tif (flag) {\r\n\t\t\tocheckbox.noWrap = true;\r\n\t\t\tZ._setCheckClsName(ocheckbox, Z._dataset.selected());\r\n\t\t\tocheckbox.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\tocheckbox.style.display = 'none';\r\n\t\t}\r\n\t\t//Icon\r\n\t\tvar oIcon = row.cells[cellCnt- 2],\r\n\t\t\tclsName = 'jl-tree-unit jl-tree-icon',\r\n\t\t\ticonClsId = null;\r\n\r\n\t\tvar isLeaf = !(item.children && item.children.length > 0);\r\n\t\tif(Z._iconClassField || Z._onGetIconClass) {\r\n\t\t\tif(Z._iconClassField) {\r\n\t\t\t\ticonClsId = Z._dataset.getFieldValue(Z._iconClassField);\r\n\t\t\t} else if (Z._onGetIconClass) {\r\n\t\t\t\ticonClsId = Z._onGetIconClass.call(Z, Z._dataset.keyValue(), item.level, isLeaf); //keyValue, level, isLeaf\r\n\t\t\t}\r\n\t\t\tif (iconClsId) {\r\n\t\t\t\tclsName = iconClsId + ' '+ clsName;\r\n\t\t\t}\r\n\t\t\tif (oIcon.className != clsName) {\r\n\t\t\t\toIcon.className = clsName;\r\n\t\t\t}\r\n\t\t\toIcon.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\toIcon.style.display = 'none';\r\n\t\t}\r\n\t\t//Text\r\n\t\tvar text = Z.evaluator.eval() || '      ';\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar width = Math.round(jslet.ui.textMeasurer.getWidth(text)) + 10;\r\n\t\ttotalWidth += width + 10;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tvar oText = row.cells[cellCnt- 1];\r\n\t\toText.style.width = width + 'px';\r\n\r\n\t\tvar jqTd = jQuery(oText);\r\n\t\tjqTd.html(text);\r\n\t\tif(Z._dataset.existRecordError()) {\r\n\t\t\tif(!jqTd.hasClass('has-error')) {\r\n\t\t\t\tjqTd.addClass('has-error');\r\n\t\t\t}\r\n\t\t\toText.title = Z._dataset.getRecordErrorInfo();\r\n\t\t} else {\r\n\t\t\tif(jqTd.hasClass('has-error')) {\r\n\t\t\t\tjqTd.removeClass('has-error');\r\n\t\t\t}\r\n\t\t\toText.title = jqTd.text();\r\n\t\t}\r\n\t\t\r\n\t\tif (item.isbold) {\r\n\t\t\tjqTd.addClass('jl-tree-child-checked');\r\n\t\t} else {\r\n\t\t\tjqTd.removeClass('jl-tree-child-checked');\r\n\t\t}\r\n\t\tif(Z._onRenderItem) {\r\n\t\t\tZ._onRenderItem.call(Z, oIcon, oText, item.level, isLeaf); //keyValue, level, isLeaf\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\t\r\n\t_syncScrollBar: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skip_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjQuery(Z.el).find('.jl-tree-scrollbar').scrollTop(Z.nodeHeight * Z.listvm.getVisibleStartRow());\r\n\t},\r\n\t\r\n\t_checkScrollBar: function() {\r\n\t\tvar jqScr = jQuery(this.el).find('.jl-tree-scrollbar');\r\n\t\tvar scr = jqScr[0];\r\n\t\tif(scr.scrollHeight > scr.clientHeight) {\r\n\t\t\tjqScr.removeClass('jl-tree-scrollbar-hidden');\r\n\t\t} else {\r\n\t\t\tif(!jqScr.hasClass('jl-tree-scrollbar-hidden')) {\r\n\t\t\t\tjqScr.addClass('jl-tree-scrollbar-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand the current tree node.\r\n\t */\r\n\texpand: function() {\r\n\t\tthis.listvm.expand();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse the current tree node.\r\n\t */\r\n\tcollapse: function() {\r\n\t\tthis.listvm.collapse();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand all child nodes of the current tree node.\r\n\t */\r\n\texpandAll: function() {\r\n\t\tthis.listvm.expandAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse all child nodes of the current tree node.\r\n\t */\r\n\tcollapseAll: function() {\r\n\t\tthis.listvm.collapseAll();\r\n\t},\r\n\t\r\n\t_createContextMenu: function() {\r\n\t\tif (!jslet.ui.Menu) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: []};\r\n\t\tif (Z._hasCheckBox) {\r\n\t\t\tmenuCfg.items.push({ id: 'checkAll', name: jsletlocale.DBTreeView.checkAll });\r\n\t\t\tmenuCfg.items.push({ id: 'uncheckAll', name: jsletlocale.DBTreeView.uncheckAll });\r\n\t\t\tmenuCfg.items.push({ name: '-' });\r\n\t\t}\r\n\t\tmenuCfg.items.push({ id: 'expandAll', name: jsletlocale.DBTreeView.expandAll });\r\n\t\tmenuCfg.items.push({ id: 'collapseAll', name: jsletlocale.DBTreeView.collapseAll});\r\n\t\tif(Z._enableErrorFinding) {\r\n\t\t\tmenuCfg.items.push({ name: '-' });\r\n\t\t\tmenuCfg.items.push({ id: 'nextError', name: jsletlocale.DBTreeView.nextError});\r\n\t\t}\r\n\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t\tjQuery(Z.el).on('contextmenu', function(event) {\r\n\t\t\tvar node = event.target,\r\n\t\t\t\tnodeType = node.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tif(!nodeType || nodeType == '0') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._syncToDs(node);\r\n\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_menuItemClick: function(menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tvar Z = this;\r\n\t\tif (menuId == 'expandAll') {\r\n\t\t\tZ.expandAll();\r\n\t\t} else if (menuId == 'collapseAll') {\r\n\t\t\tZ.collapseAll();\r\n\t\t} else if (menuId == 'checkAll') {\r\n\t\t\tZ.listvm.checkChildNodes(true, true);\r\n\t\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t\t}\r\n\t\t} else if (menuId == 'uncheckAll') {\r\n\t\t\tZ.listvm.checkChildNodes(false, true);\r\n\t\t\tif (Z._afterCheckBoxClick) {\r\n\t\t\t\tZ._afterCheckBoxClick.call(Z);\r\n\t\t\t}\r\n\t\t} else if (menuId == 'nextError') {\r\n\t\t\tZ.gotoNextError();\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\t//empty\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.listvm.refreshModel(Z._expandLevel);\r\n\t\t\tif(evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\t\tZ.listvm.syncDataset();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) {\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL) {\r\n\t\t\tif (Z._hasCheckBox) {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (Z._hasCheckBox) {\r\n\t\t\t\tZ.listvm.checkNode(Z._dataset.selected(), Z._correlative, Z._onlyCheckChildren);\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tZ.listvm.syncDataset();\r\n\t\t}\r\n\t}, // end refreshControl\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function() {\r\n\t\tthis.resize();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.find('.jl-tree-nodes').off();\r\n\t\tZ.listvm.destroy();\r\n\t\tZ.listvm = null;\r\n\t\tZ.prevRow = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.TREELINECLASS = {\r\n\t\tline : 'jl-tree-unit jl-tree-lines jl-tree-line',// '|'\r\n\t\tjoin : 'jl-tree-unit jl-tree-lines jl-tree-join',// |-\r\n\t\tjoinBottom : 'jl-tree-unit jl-tree-lines jl-tree-join-bottom',// |_\r\n\t\tminus : 'jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-minus',// O-\r\n\t\tminusBottom : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-minus-bottom',// o-_\r\n\t\tnoLineMinus : 'jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-noline-minus',// o-\r\n\t\tplus : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus',// o+\r\n\t\tplusBottom : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus-bottom',// o+_\r\n\t\tnoLinePlus : 'jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-noline-plus',// o+\r\n\t\tempty : 'jl-tree-unit'\r\n};\r\njslet.ui.htmlclass.TREECHECKBOXCLASS = {\r\n\tchecked : 'jl-tree-unit jl-tree-checkbox jl-tree-checked',\r\n\tunChecked : 'jl-tree-unit jl-tree-checkbox jl-tree-unchecked',\r\n\tmixedChecked : 'jl-tree-unit jl-tree-checkbox jl-tree-mixedchecked'\r\n};\r\n\r\njslet.ui.htmlclass.TREENODECLASS = {\r\n\tselected : 'jl-tree-selected',\r\n\tchildChecked : 'jl-tree-child-checked',\r\n\ttreeNodeLevel : 'jl-tree-child-level'\r\n};\r\n\r\njslet.ui.DBTreeView.NODETYPE = 'data-nodetype';\r\n\r\njslet.ui.register('DBTreeView', jslet.ui.DBTreeView);\r\njslet.ui.DBTreeView.htmlTemplate = '<div></div>';\r\n\r\n\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\njslet.ui.table.TableCellEditor = function(tableCtrl) { \r\n\tvar _tableCtrl = tableCtrl; \r\n\tvar _editPanel;\r\n\tvar _currField;\r\n\t\r\n\tfunction _create() { \r\n\t\tvar html = '<div class=\"form-group form-group-sm jl-tbl-editpanel\"><table class=\"jl-tbl-edittable\"><tbody><tr class=\"jl-tbl-editrow\">';\r\n\t\tvar columns = _tableCtrl._sysColumns, colCfg,\r\n\t\t\ttblDataset = tableCtrl.dataset(),\r\n\t\t\tdsName = tblDataset.name(),\r\n\t\t\tleft = 1, i, len;\r\n\t\t\t\r\n\t\tfor(i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolCfg = columns[i];\r\n\t\t\tleft += colCfg.width + 1;\r\n\t\t}\r\n\t\tcolumns = _tableCtrl.innerColumns;\r\n\t\tvar tableId = tableCtrl.el.id,\r\n\t\t\teditorTabIndex = tableCtrl.editorTabIndex(),\r\n\t\t\tisBool, fldObj, fldName, dataType,\r\n\t\t\talignStr = ';text-align: center',\r\n\t\t\teditableFields = tableCtrl.editableFields(),\r\n\t\t\treadOnlyFields = tableCtrl.readOnlyFields(),\r\n\t\t\tisManual;\r\n\t\tisManual = editableFields && editableFields.length > 0 || readOnlyFields && readOnlyFields.length > 0;\r\n\t\tfor(i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolCfg = columns[i];\r\n\t\t\tfldName = colCfg.field;\r\n\t\t\tif(!fldName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(readOnlyFields && readOnlyFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(editableFields && editableFields.indexOf(fldName) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = tblDataset.getField(fldName);\r\n\t\t\tdataType = fldObj.getType();\r\n\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\thtml += '<td class=\"jl-edtfld-' + fldName +  '\" style=\"display:none;vertical-align: middle' + \r\n\t\t\t\t(isBool? alignStr: '') + '\">';\r\n\t\t\tif(isManual || !fldObj.fieldReadOnly() && !fldObj.fieldDisabled()) {\r\n\t\t\t\tvar additionStr = '';\r\n\t\t\t\tif(colCfg.prefix) {\r\n\t\t\t\t\tadditionStr = ', prefix: ' + jslet.JSON.stringify(colCfg.prefix);\r\n\t\t\t\t}\r\n\t\t\t\tif(colCfg.suffix) {\r\n\t\t\t\t\tadditionStr += ', suffix: ' + jslet.JSON.stringify(colCfg.suffix);\r\n\t\t\t\t}\r\n\t\t\t\tisBool = (fldObj.dataType() === jslet.data.DataType.BOOLEAN);\r\n\t\t\t\thtml += '<div data-jslet=\\'type:\"DBPlace\",dataset:\"' + dsName + \r\n\t\t\t\t\t'\",field:\"' + fldName + \r\n\t\t\t\t\t'\", tableId: \"' + tableId + \r\n\t\t\t\t\t'\", expandChildWidth: ' + (isBool? 'false': 'true') + \r\n\t\t\t\t\t(editorTabIndex? ', tabIndex: ' + editorTabIndex: '') + \r\n\t\t\t\t\tadditionStr + \r\n\t\t\t\t\t'\\' class=\"' + colCfg.widthCssName + \r\n\t\t\t\t\t(isBool? ' jl-tbl-check-col': '') + \r\n\t\t\t\t\t'\"></div>';\r\n\t\t\t}\r\n\t\t\thtml += '</td>';\r\n\t\t}\r\n\t\thtml += '</tr></tbody></table></div>';\r\n\t\tvar jqPanel = jQuery(html);\r\n\t\tjqPanel.appendTo(jQuery(_tableCtrl.el));\r\n\t\tjqPanel.css('left', left + 'px');\r\n\t\tjslet.ui.install(jqPanel[0]);\r\n\t\t_editPanel = jqPanel;\r\n\t\tjqPanel.height(_tableCtrl.rowHeight());\r\n\t\tjqPanel.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\t//prevent to fire dbtable's ctrl+c\r\n\t\t\tif(event.ctrlKey && keyCode === jslet.ui.KeyCode.C) { //ctrl + c\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_create();\r\n\t\r\n\tthis.showEditor = function(fldName, otd) {\r\n\t\tvar dataset = _tableCtrl.dataset();\r\n\t\tif(dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!fldName) {\r\n\t\t\tdataset.focusEditControl(_currField);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = dataset.getField(fldName);\r\n\t\tif(!fldObj || fldObj.disabled() || fldObj.readOnly()) {\r\n\t\t\tthis.hideEditor();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqTd = jQuery(otd),\r\n\t\t\tfirstId = jqTd.attr('jsletFirstId'),\r\n\t\t\tcellPos;\r\n\t\tif(firstId) {\r\n\t\t\tvar firstOffset = jQuery('#' + firstId).offset();\r\n\t\t\tvar offsetHeight = parseFloat(jqTd.attr('jsletOffsetHeight'));\r\n\t\t\tcellPos = {left: firstOffset.left, top: firstOffset.top + offsetHeight};\r\n\t\t} else {\r\n\t\t\tcellPos = jqTd.offset();\r\n\t\t}\r\n\t\t_editPanel.show();\r\n\t\tif(_currField) {\r\n\t\t\t_editPanel.find('.jl-edtfld-' + _currField).hide();\r\n\t\t}\r\n\t\tvar jqEditor = _editPanel.find('.jl-edtfld-' + fldName);\r\n\t\t_editPanel.offset(cellPos);\r\n\t\tjqEditor.show();\r\n\t\tdataset.focusEditControl(fldName);\r\n\t\t_currField = fldName;\r\n\t};\r\n\t\r\n\tthis.currentField = function() {\r\n\t\treturn _currField;\r\n\t};\r\n\t\r\n\tthis.hideEditor = function() {\r\n\t\t_editPanel.hide();\r\n\t\t_tableCtrl.el.focus();\r\n\t};\r\n\t\r\n\tthis.destroy = function() { \r\n\t\t_tableCtrl = null; \r\n\t};\r\n};\r\n\r\n\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * \r\n * Cell render.\r\n */\r\njslet.ui.table.CellRender = jslet.Class.create({\r\n\t/**\r\n\t * Create column header.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t */\r\n\tcreateHeader: function(cellPanel, colSetting) {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Create cell.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh cell content.\r\n\t * \r\n\t * @param {HtmlElement} cellPanel Cell panel.\r\n\t * @param {jslet.ui.table.TableColumn} colSetting Column settings.\r\n\t * @param {Integer} recNo Record number.\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Default cell render.\r\n */\r\njslet.ui.table.DefaultCellRender =  jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field,\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tcellPanel.parentNode.style.textAlign = fldObj.alignment();\r\n\t},\r\n\t\t\t\t\t\t\t\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t\t\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl(),\r\n\t\t\t\ttarget = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\tif(text === '' || text === null || text === undefined) {\r\n\t\t\ttext = '&nbsp;';\r\n\t\t}\r\n\t\tvar jqCellPanel = jQuery(cellPanel); \r\n\t\tjqCellPanel.html(text);\r\n\t\tcellPanel.title = jqCellPanel.text();\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t} \r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Sequence column cell render.\r\n */\r\njslet.ui.table.SequenceCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.innerHTML = this._seqColHeader || '&nbsp;';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tjQuery(cellPanel.parentNode).addClass('jl-tbl-sequence');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqDiv = jQuery(cellPanel), \r\n\t\t\ttext,\r\n\t\t\trecno = this.listvm.getCurrentRecno();\r\n\t\tif(this._reverseSeqCol) {\r\n\t\t\ttext = this._dataset.recordCount() - recno;\r\n\t\t} else {\r\n\t\t\ttext = recno + 1;\r\n\t\t}\r\n\t\tvar title;\r\n\t\tif(this._dataset.existRecordError(recno)) {\r\n\t\t\tjqDiv.parent().addClass('has-error');\r\n\t\t\ttitle = this._dataset.getRecordErrorInfo(recno);\r\n\t\t} else {\r\n\t\t\tjqDiv.parent().removeClass('has-error');\r\n\t\t\ttitle = text;\r\n\t\t}\r\n\t\t\r\n\t\tcellPanel.title = title;\r\n\t\tjqDiv.html(text);\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Select column cell render.\r\n */\r\njslet.ui.table.SelectCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\tvar ocheckbox = document.createElement('input');\r\n\t\tocheckbox.type = 'checkbox';\r\n\t\tvar Z = this;\r\n\t\tjQuery(ocheckbox).addClass('jl-tbl-select-check jl-tbl-select-all').on('click', function(event) {\r\n\t\t\tif(Z._beforeSelectAll) {\r\n\t\t\t\tZ._beforeSelectAll.call(Z);\r\n\t\t\t}\r\n\t\t\tZ._dataset.selectAll(this.checked ? 1 : 0, Z._onSelectAll);\r\n\t\t\tif(Z._afterSelectAll) {\r\n\t\t\t\tZ._afterSelectAll.call(Z);\r\n\t\t\t}\r\n\t\t});\r\n\t\tcellPanel.appendChild(ocheckbox);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n    createCell: function(cellPanel, colCfg) {\r\n\t    cellPanel.style.textAlign = 'center';\r\n\t\tvar Z = this, \r\n\t\tocheck = document.createElement('input'),\r\n\t\tjqCheck = jQuery(ocheck);\r\n\t\tjqCheck.attr('type', 'checkbox').addClass('jl-tbl-select-check');\r\n\t\tjqCheck.click(Z._doSelectBoxClick);\r\n\t\tcellPanel.appendChild(ocheck);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tocheck = cellPanel.firstChild;\r\n\t\tif(Z._dataset.checkSelectable(recNo)) {\r\n\t\t\tocheck.checked = Z._dataset.selectedByRecno(recNo);\r\n\t\t\tocheck.style.display = '';\r\n\t\t} else {\r\n\t\t\tocheck.style.display = 'none';\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Edit action column cell render.\r\n */\r\njslet.ui.table.EditActionCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\t\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(cellPanel);\r\n\t\tjqCell.html('<a class=\"jl-tbl-insert\" href=\"javascript: void(0)\" title=\"' + jsletlocale.DBTable.appendTip +\r\n\t\t\t\t'\"><i class=\"fa fa-plus\"></i></a>');\r\n\t\tjqCell.on('click', function(event) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._doAppendRecord();\r\n\t\t\t}, 80);\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n    createCell: function(cellPanel, colCfg) {\r\n\t    cellPanel.style.textAlign = 'center';\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(cellPanel);\r\n\t\tjqCell.html('<a class=\"jl-tbl-delete\" href=\"javascript: void(0)\" title=\"' + jsletlocale.DBTable.deleteTip +\r\n\t\t\t\t'\"><i class=\"fa fa-minus\"></i></a>');\r\n\t\tjqCell.on('click', function(event) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tZ._doDeleteRecord();\r\n\t\t\t}, 80);\r\n\t\t});\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.table.SubgroupCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\t//TODO\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Boolean column cell render.\r\n */\r\njslet.ui.table.BoolCellRender = jslet.Class.create(jslet.ui.table.DefaultCellRender, {\r\n\tcreateCell: function(cellPanel, colCfg) {\r\n\t\tvar jqCell = jQuery(cellPanel);\r\n\t\tjqCell.css('textAlign', 'center');\r\n\t\tjqCell.html('<i class=\"fa fa-square-o\" aria-hidden=\"true\"></i>');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqCell = jQuery(cellPanel);\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field, \r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tif (Z._dataset.getFieldValueByRecno(recNo, fldName)) {\r\n\t\t\tjqCell.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square-o');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjqCell.find('.fa-check-square-o').removeClass('fa-check-square-o').addClass('fa-square-o');\r\n\t\t}\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.table.CellRender\r\n * \r\n * Tree column cell render.\r\n */\r\njslet.ui.table.TreeCellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcreateCell: function(cellPanel, colCfg, recNo) {\r\n\t\tvar Z = this;\r\n\r\n\t\tvar odiv = document.createElement('div'),\r\n\t\t\tjqDiv = jQuery(odiv);\r\n\t\todiv.style.height = Z.rowHeight() - 2 + 'px';\r\n\t\tjqDiv.html('<span class=\"jl-tbltree-indent\"></span><a class=\"jl-tbltree-btn\" href=\"javascript:void()\"><i class=\"fa fa-minus-square-o\" aria-hidden=\"true\"></i></a>' + \r\n\t\t\t\t'<span class=\"jl-tbltree-iconhost\"></span><span class=\"jl-tbltree-text\"></span>');\r\n\t\t\r\n\t\tcellPanel.appendChild(odiv);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshCell: function(cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar odiv = cellPanel.firstChild,\r\n\t\t\tjqDiv = jQuery(odiv),\r\n\t\t\tarrSpan = odiv.childNodes,\r\n\t\t\tZ = this,\r\n\t\t\tlevel = Z.listvm.getLevel(recNo);\r\n\t\t\r\n\t\tif (!jslet.ui.table.TreeCellRender.iconWidth) {\r\n\t\t\tjslet.ui.table.TreeCellRender.iconWidth = parseInt(jslet.ui.getCssValue('jl-tbltree-indent', 'width'));\r\n\t\t}\r\n\t\tvar hasChildren = Z.listvm.hasChildren(recNo),\r\n\t\t\tindentWidth = (!hasChildren ? level + 1 : level) * jslet.ui.table.TreeCellRender.iconWidth;\r\n\t\t//Indent\r\n\t\tjqDiv.find('.jl-tbltree-indent').css('width', indentWidth + 'px');\r\n\t\t\r\n\t\t//Expand button\r\n\t\tvar jqExpBtn = jqDiv.find('.jl-tbltree-btn'); //expand button\r\n\t\tjqExpBtn.css('display', hasChildren ? 'inline-block' : 'none');\r\n\t\tif (hasChildren) {\r\n\t\t\tvar expanded = Z._dataset.expandedByRecno(recNo);\r\n\t\t\tif(expanded) {\r\n\t\t\t\tjqExpBtn.find('.fa-plus-square-o').removeClass('fa-plus-square-o').addClass('fa-minus-square-o');\r\n\t\t\t} else {\r\n\t\t\t\tjqExpBtn.find('.fa-minus-square-o').removeClass('fa-minus-square-o').addClass('fa-plus-square-o');\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Icon\r\n\t\tif (colCfg.getIconClass) {\r\n\t\t\tvar iconCls = colCfg.getIconClass(level, hasChildren);\r\n\t\t\tif (iconCls) {\r\n\t\t\t\tvar jqIcon = jqDiv.find('.jl-tbltree-iconhost');\r\n\t\t\t\tjqIcon.addClass('jl-tbltree-icon ' + iconCls);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Text\r\n\t\tvar fldName = colCfg.field, fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t}\r\n\t\tcellPanel.title = text;\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl();\r\n\t\t\tvar target = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\tjqDiv.find('.jl-tbltree-text').html(text);\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\r\n\r\njslet.ui.table.cellRenders = {\r\n\tdefaultCellRender: new jslet.ui.table.DefaultCellRender(),\r\n\ttreeCellRender: new jslet.ui.table.TreeCellRender(),\r\n\tboolCellRender: new jslet.ui.table.BoolCellRender(),\r\n\tsequenceCellRender: new jslet.ui.table.SequenceCellRender(),\r\n\tselectCellRender: new jslet.ui.table.SelectCellRender(),\r\n\teditActionCellRender: new jslet.ui.table.EditActionCellRender(),\r\n\tsubgroupCellRender: new jslet.ui.table.SubgroupCellRender()\r\n};\r\n\r\n\njslet.ui.htmlclass.TABLECLASS = {\r\n\tcurrentrow: 'jl-tbl-current',\r\n\tscrollBarWidth: 16,\r\n\tselectColWidth: 30,\r\n\thoverrow: 'jl-tbl-row-hover',\r\n};\r\n\r\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/**\r\n * @class\r\n * \r\n * Table column.\r\n */\r\njslet.ui.table.TableColumn = function() {\r\n\tvar Z = this;\r\n\t\r\n\t/**\r\n\t * @property {String} field Field name.\r\n\t */\r\n\tZ.field = null;\r\n\t\r\n\t/**\r\n\t * @property {String} label Column header label.\r\n\t */\r\n\tZ.label = null;\r\n\t\r\n\t/**\r\n\t * @property {String} title Column header title.\r\n\t */\r\n\tZ.title = null;\r\n\t\r\n\t/**\r\n\t * @property {jslet.ui.FieldControlAddon[]} prefix The prefix part of the field when editing.\r\n\t */\r\n\tZ.prefix = null;\r\n\t\r\n\t/**\r\n\t * @property {jslet.ui.FieldControlAddon[]} suffix The suffix part of the field when editing.\r\n\t */\r\n\tZ.suffix = null;\r\n\t \r\n\t/**\r\n\t * @property {Integer} width Column display width.\r\n\t */\r\n\tZ.width = null;   //Integer, column display width\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableHeadSort True - user sort this column by click column header, false - otherwise.\r\n\t */\r\n\tZ.disableHeadSort = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableFilter True - disable to show filter panel, false - otherwise.\r\n\t */\r\n\tZ.disableFilter = false;\r\n\r\n\t/**\r\n\t * @property {Boolean} mergeSame True - if this column value of adjoined rows is same then merge these rows, false - otherwise.\r\n\t */\r\n\tZ.mergeSame = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} noRefresh True - do not refresh for customized column, false - otherwise.\r\n\t */\r\n\tZ.noRefresh = false; //Boolean, true - do not refresh for customized column\r\n\t\r\n\t/**\r\n\t * @property {Boolean} visible True - column is visible, false - otherwise.\r\n\t */\r\n\tZ.visible = true;\r\n\r\n\t/**\r\n\t * @property {jslet.ui.table.CellRender} cellRender Column cell render for customized column.\r\n\t */\r\n\tZ.cellRender = null;  \r\n\r\n\tZ.colNum = null;  //Integer, column number\r\n\tZ.displayOrder = null; //Integer, display order\r\n\tZ.colSpan = null; //Integer, column span\r\n};\r\n\r\n/*\r\n * Sub group, use this class to implement complex requirement in one table row, like master-detail style row\r\n */\r\njslet.ui.table.TableSubgroup = function() {\r\nvar Z = this;\r\n\tZ.hasExpander = true; //Boolean, true - will add a new column automatically, click this column will expand or collapse subgroup panel\r\n\tZ.template = null;//String, html template \r\n\tZ.height = 0; //Integer, subgroup panel height\r\n};\r\n\r\n/**\r\n * @class\r\n * \r\n * Table column header, use this class to implement hierarchical header\r\n */\r\njslet.ui.table.TableHead = function() {\r\n\tvar Z = this;\r\n\t\r\n\t/**\r\n\t * @property {String} label Head label.\r\n\t */\r\n\tZ.label = null;\r\n\t\r\n\t/**\r\n\t * @property {String} title Head title.\r\n\t */\r\n\tZ.title = null;\r\n\t\r\n\t/**\r\n\t * @property {String} id Head id.\r\n\t */\r\n\tZ.id = null;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableHeadSort True - user sort this column by click column header, false - otherwise.\r\n\t */\r\n\tZ.disableHeadSort = false;\r\n\t\r\n\t/**\r\n\t * @property {Boolean} disableFilter True - disable to show filter panel, false - otherwise.\r\n\t */\r\n\tZ.disableFilter = false;\r\n\r\n\t/**\r\n\t * @property {jslet.ui.table.TableHead[]} subHeads Sub heads.\r\n\t */\r\n\tZ.subHeads = null;\r\n\r\n\tZ.rowSpan = 0;\r\n\tZ.colSpan = 0;\r\n\t\r\n};\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n */\r\njslet.ui.AbstractDBTable = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tZ.allProperties = 'styleClass,dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,editable,hideHead,' + \r\n\t\t\t'disableHeadSort,onlySpecifiedCol,disableMouseWheel,selectBy,rowHeight,footerRowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,' + \r\n\t\t\t'beforeSelect,beforeSelectAll,afterSelect,afterSelectAll,onFillRow,onFillCell,treeField,columns,subgroup,aggregated,' + \r\n\t\t\t'autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog,autoStretch,minVisibleRows,maxVisibleRows' +\r\n\t\t\t'onAppendRecord,onDeleteRecord,editableFields,readOnlyFields,enableErrorFinding';\r\n\t\t\r\n\t\tZ._fixedRows = 0;\r\n\r\n\t\tZ._fixedCols = 0;\r\n\r\n\t\tZ._hasSeqCol = true;\r\n\t\t\r\n\t\tZ._reverseSeqCol = false;\r\n\t\r\n\t\tZ._seqColHeader = null;\r\n\r\n\t\tZ._hasSelectCol = false;\r\n\t\t\r\n\t\tZ._noborder = false;\r\n\t\t\r\n\t\tZ._editable = false;\r\n\r\n\t\tZ._hideHead = false;\r\n\t\t\r\n\t\tZ._onlySpecifiedCol = false;\r\n\t\t\r\n\t\tZ._disableHeadSort = false;\r\n\t\t\r\n\t\tZ._disableMouseWheel = false;\r\n\t\t\r\n\t\tZ._aggregated = true;\r\n\t\t\r\n\t\tZ._autoClearSelection = true;\r\n\t\t\r\n\t\tZ._selectBy = null;\r\n\r\n\t\tZ._rowHeight = null;\r\n\r\n\t\tZ._headRowHeight = null;\r\n\r\n\t\tZ._footerRowHeight = null;\r\n\t\t\r\n\t\tZ._treeField = null;\r\n\r\n\t\tZ._columns = null;\r\n\t\t\r\n\t\tZ._editableFields = null;\r\n\t\t\r\n\t\tZ._readOnlyFields = null;\r\n\t\t\r\n\t\tZ._onRowClick = null;\r\n\r\n\t\tZ._onRowDblClick = null;\r\n\t\t\r\n\t\tZ._onCellClick = null;\r\n\t\t\r\n\t\tZ._onSelect = null;\r\n\r\n\t\tZ._onSelectAll = null;\r\n\t\t\r\n\t\tZ._beforeSelect = null;\r\n\t\t\r\n\t\tZ._afterSelect = null;\r\n\t\t\r\n\t\tZ._beforeSelectAll = null;\r\n\t\t\r\n\t\tZ._afterSelectAll = null;\r\n\t\t\r\n\t\tZ._onFillRow = null;\r\n\t\t\r\n\t\tZ._onFillCell = null;\t\t\r\n\r\n\t\tZ._onAppendRecord = null;\r\n\r\n\t\tZ._onDeleteRecord = null;\r\n\t\t\r\n\t\tZ._defaultCellRender = null;\r\n\r\n\t\tZ._hasFindDialog = true;\r\n\t\t\r\n\t\tZ._hasFilterDialog = true;\r\n\t\t\r\n\t\tZ._enableErrorFinding = false;\r\n\t\t\r\n\t\tZ._repairHeight = 0;\r\n\t\tZ.contentHeight = 0;\r\n\t\tZ.subgroup = null;//jslet.ui.table.TableSubgroup\r\n\t\t\r\n\t\tZ._sysColumns = null;//all system column like sequence column, select column, sub-group column\r\n\t\tZ._isHoriOverflow = false;\r\n\t\tZ._oldHeight = null;\r\n\t\t\r\n\t\tZ._currRow = null;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._editingField = null;\r\n\t\tZ._editorTabIndex = 1;\r\n\t\tZ._rowHeightChanged = false;\r\n\t\tZ._autoStretch = false;\r\n\t\tZ._minVisibleRows = 1;\r\n\t\tZ._maxVisibleRows = 0;\r\n\t\tZ._oldVisibleRows = -1;\r\n\t\t\r\n\t\tZ._cellEditor = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get fixed rows.\r\n\t * \r\n\t * @param {Integer | undefined} rows Fixed rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfixedRows: function(rows) {\r\n\t\tif(rows === undefined) {\r\n\t\t\treturn this._fixedRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.fixedRows', rows).isNumber();\r\n\t\tthis._fixedRows = parseInt(rows);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get Fixed columns.\r\n\t * \r\n\t * @param {Integer | undefined} cols Fixed columns.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfixedCols: function(cols) {\r\n\t\tif(cols === undefined) {\r\n\t\t\treturn this._fixedCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.fixedCols', cols).isNumber();\r\n\t\tthis._fixedCols = parseInt(cols);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table row.\r\n\t * \r\n\t * @param {Integer | undefined} rowHeight Table row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\trowHeight: function(rowHeight) {\r\n\t\tvar Z = this;\r\n\t\tif(rowHeight === undefined) {\r\n\t\t\tif(Z._rowHeight === null) {\r\n\t\t\t\tvar clsName = Z._editable? 'jl-tbl-editing-row': 'jl-tbl-row';\r\n\t\t\t\tZ._rowHeight = parseInt(jslet.ui.getCssValue(clsName, 'height')) || 25;\r\n\t\t\t}\r\n\t\t\treturn Z._rowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.rowHeight', rowHeight).isGTZero();\r\n\t\tZ._rowHeight = parseInt(rowHeight);\r\n\t\tZ._rowHeightChanged = true;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table header.\r\n\t * \r\n\t * @param {Integer | undefined} headRowHeight Table header row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theadRowHeight: function(headRowHeight) {\r\n\t\tif(headRowHeight === undefined) {\r\n\t\t\tif(this._headRowHeight === null) {\r\n\t\t\t\tthis._headRowHeight = parseInt(jslet.ui.getCssValue('jl-tbl-header-row', 'height')) || 25;\r\n\t\t\t}\r\n\t\t\treturn this._headRowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.headRowHeight', headRowHeight).isGTZero();\r\n\t\tthis._headRowHeight = parseInt(headRowHeight);\r\n\t\treturn this;\r\n\t},\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get row height of table footer.\r\n\t * \r\n\t * @param {Integer | undefined} footerRowHeight Table footer row height.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tfooterRowHeight: function(footerRowHeight) {\r\n\t\tif(footerRowHeight === undefined) {\r\n\t\t\tif(this._footerRowHeight === null) {\r\n\t\t\t\tthis._footerRowHeight = parseInt(jslet.ui.getCssValue('jl-tbl-footer-row', 'height')) || 20;\r\n\t\t\t}\r\n\t\t\treturn this._footerRowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.footerRowHeight', footerRowHeight).isGTZero();\r\n\t\tthis._footerRowHeight = parseInt(footerRowHeight);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is sequence column in DBTable.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSeqCol True(default) - exists sequence column, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSeqCol: function(hasSeqCol) {\r\n\t\tif(hasSeqCol === undefined) {\r\n\t\t\treturn this._hasSeqCol;\r\n\t\t}\r\n\t\tthis._hasSeqCol = hasSeqCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the sequence number is reverse.\r\n\t * \r\n\t * @param {Boolean | undefined} reverseSeqCol True - the sequence number is reverse, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treverseSeqCol: function(reverseSeqCol) {\r\n\t\tif(reverseSeqCol === undefined) {\r\n\t\t\treturn this._reverseSeqCol;\r\n\t\t}\r\n\t\tthis._reverseSeqCol = reverseSeqCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get sequence column header.\r\n\t * \r\n\t * @param {String | undefined} seqColHeader Sequence column header.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tseqColHeader: function(seqColHeader) {\r\n\t\tif(seqColHeader === undefined) {\r\n\t\t\treturn this._seqColHeader;\r\n\t\t}\r\n\t\tthis._seqColHeader = seqColHeader;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether there is \"select\" column in DBTable.\r\n\t * \r\n\t * @param {Boolean | undefined} hasSelectCol True(default) - has \"select\" column, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasSelectCol: function(hasSelectCol) {\r\n\t\tif(hasSelectCol === undefined) {\r\n\t\t\treturn this._hasSelectCol;\r\n\t\t}\r\n\t\tthis._hasSelectCol = hasSelectCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has border or not.\r\n\t * \r\n\t * @param {Boolean | undefined} noborder True - the table without border, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tnoborder: function(noborder) {\r\n\t\tif(noborder === undefined) {\r\n\t\t\treturn this._noborder;\r\n\t\t}\r\n\t\tthis._noborder = noborder ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @deprecated\r\n\t * Use editable instead.\r\n\t * \r\n\t * Identify the table is read only or not.\r\n\t * \r\n\t * @param {Boolean | undefined} readOnly True(default) - the table is read only, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn !Z._editable;\r\n\t\t}\r\n\t\tZ.editable(!readOnly);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table is editable or not.\r\n\t * \r\n\t * @param {Boolean | undefined} editable True(default) - the table is editable, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\teditable: function(editable) {\r\n\t\tvar Z = this;\r\n\t\tif(editable === undefined) {\r\n\t\t\treturn Z._editable;\r\n\t\t}\r\n\t\tZ._editable = editable ? true: false;\r\n\t\tif(Z._editable && !Z._rowHeightChanged) {\r\n\t\t\tZ._rowHeight = null;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table header is hidden or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hideHead True - the table header is hidden, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thideHead: function(hideHead) {\r\n\t\tif(hideHead === undefined) {\r\n\t\t\treturn this._hideHead;\r\n\t\t}\r\n\t\tthis._hideHead = hideHead ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has aggregated row or not.\r\n\t * \r\n\t * @param {Boolean | undefined} aggregated True - the table has aggregated row, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\taggregated: function(aggregated) {\r\n\t\tif(aggregated === undefined) {\r\n\t\t\treturn this._aggregated;\r\n\t\t}\r\n\t\tthis._aggregated = aggregated ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether automatically clear selection when selecting table cells.\r\n\t * \r\n\t * @param {Boolean | undefined} autoClearSelection True(default) - automatically clear selection, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoClearSelection: function(autoClearSelection) {\r\n\t\tif(autoClearSelection === undefined) {\r\n\t\t\treturn this._autoClearSelection;\r\n\t\t}\r\n\t\tthis._autoClearSelection = autoClearSelection ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify disable table head sorting or not.\r\n\t * \r\n\t * @param {Boolean | undefined} disableHeadSort True - disable table header sorting, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tdisableHeadSort: function(disableHeadSort) {\r\n\t\tif(disableHeadSort === undefined) {\r\n\t\t\treturn this._disableHeadSort;\r\n\t\t}\r\n\t\tthis._disableHeadSort = disableHeadSort ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Disable to use mouse wheel to scroll rows or not.\r\n\t * \r\n\t * @param {Boolean | undefined} disableMouseWheel True - disable to use mouse wheel to scroll rows, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tdisableMouseWheel: function(disableMouseWheel) {\r\n\t\tif(disableMouseWheel === undefined) {\r\n\t\t\treturn this._disableMouseWheel;\r\n\t\t}\r\n\t\tthis._disableMouseWheel = disableMouseWheel ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether showing the specified columns or not.\r\n\t * \r\n\t * @param {Boolean | undefined} onlySpecifiedCol True - only showing the specified columns, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlySpecifiedCol: function(onlySpecifiedCol) {\r\n\t\tif(onlySpecifiedCol === undefined) {\r\n\t\t\treturn this._onlySpecifiedCol;\r\n\t\t}\r\n\t\tthis._onlySpecifiedCol = onlySpecifiedCol ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specified field names for selecting group records, multiple field names are separated with ','.<br />\r\n\t * See jslet.data.Dataset.select(selected, selectBy). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.selectBy('code,gender');\r\n\t * \r\n\t * @param {String | undefined} selectBy group selecting field names.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tselectBy: function(selectBy) {\r\n\t\tif(selectBy === undefined) {\r\n\t\t\treturn this._selectBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.selectBy', selectBy).isString();\r\n\t\tthis._selectBy = selectBy;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Display table as tree style. If this property is set, the dataset must be a tree style dataset, \r\n\t *  means dataset.parentField() and dataset.levelField() can not be empty.<br />\r\n\t * Only one field name allowed. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.treeField('code');\r\n\t * \r\n\t * @param {String | undefined} treeField the field name which will show as tree style.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\ttreeField: function(treeField) {\r\n\t\tif(treeField === undefined) {\r\n\t\t\treturn this._treeField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.treeField', treeField).isString();\r\n\t\tthis._treeField = treeField;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Default cell render, it must be a child class of jslet.ui.table.CellRender. Example:\r\n\t * \r\n\t *     @example\r\n\t * \t   var cellRender = jslet.Class.create(jslet.ui.table.CellRender, {\r\n\t *\t     createHeader: function(cellPanel, colCfg) { },\r\n\t *\t     createCell: function(cellPanel, colCfg) { },\r\n\t *\t     refreshCell: function(cellPanel, colCfg, recNo) { }\r\n\t *     });\r\n\t * \r\n\t * @param {jslet.ui.table.CellRender} defaultCellRender Default cell render.\r\n\t * \r\n\t * @return {this | jslet.ui.table.CellRender}\r\n\t * \r\n\t */\r\n\tdefaultCellRender: function(defaultCellRender) {\r\n\t\tif(defaultCellRender === undefined) {\r\n\t\t\treturn this._defaultCellRender;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.defaultCellRender', defaultCellRender).isObject();\r\n\t\t\r\n\t\tthis._defaultCellRender = defaultCellRender;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcurrColNum: function(currColNum) {\r\n\t\tvar Z = this;\r\n\t\tif(currColNum === undefined) {\r\n\t\t\treturn Z._currColNum;\r\n\t\t}\r\n\t\tvar oldColNum = Z._currColNum;\r\n\t\tZ._currColNum = currColNum;\r\n\t\tif(oldColNum !== currColNum) {\r\n\t\t\tZ._adjustCurrentCellPos(oldColNum > currColNum);\r\n\t\t\tZ._showCurrentCell();\r\n\t\t}\r\n\t\tif(Z._findDialog) {\r\n\t\t\tvar colCfg = Z.innerColumns[currColNum];\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onRowClick(function(otr) {});\r\n\t *     \r\n\t * @param {Function | undefined} onRowClick Table row clicked event handler.\r\n\t * @param {HtmlElement} onRowClick.trElement Table row element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRowClick: function(onRowClick) {\r\n\t\tif(onRowClick === undefined) {\r\n\t\t\treturn this._onRowClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowClick', onRowClick).isFunction();\r\n\t\tthis._onRowClick = onRowClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row double clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onRowDblClick(function(otr) {});\r\n\t *     \r\n\t * @param {Function | undefined} onRowDblClick Table row double clicked event handler.\r\n\t * @param {HtmlElement} onRowDblClick.trElement Table row element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonRowDblClick: function(onRowDblClick) {\r\n\t\tif(onRowDblClick === undefined) {\r\n\t\t\treturn this._onRowDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowDblClick', onRowDblClick).isFunction();\r\n\t\tthis._onRowDblClick = onRowDblClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table cell clicked. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onCellClick(function(otd) {});\r\n\t *     \r\n\t * @param {Function | undefined} onCellClick Table cell clicked event handler.\r\n\t * @param {HtmlElement} onCellClick.tdElement Table cell element.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCellClick: function(onCellClick) {\r\n\t\tif(onCellClick === undefined) {\r\n\t\t\treturn this._onCellClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onCellClick', onCellClick).isFunction();\r\n\t\tthis._onCellClick = onCellClick;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onSelect(function(checked) {});\r\n\t *     \r\n\t * @param {Function | undefined} onSelect Table row selected event handler.\r\n\t * @param {Boolean} onSelect.checked True - table row is selected, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSelect: function(onSelect) {\r\n\t\tif(onSelect === undefined) {\r\n\t\t\treturn this._onSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelect', onSelect).isFunction();\r\n\t\tthis._onSelect = onSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when all table rows are selected. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onSelectAll(function(dataset, checked) {});\r\n\t *     \r\n\t * @param {Function | undefined} onSelectAll All Table row selected event handler.\r\n\t * @param {jslet.data.Dataset} onSelectAll.dataset The current dataset object.\r\n\t * @param {Boolean} onSelectAll.checked True - all rows selected, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSelectAll: function(onSelectAll) {\r\n\t\tif(onSelectAll === undefined) {\r\n\t\t\treturn this._onSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelectAll', onSelectAll).isFunction();\r\n\t\tthis._onSelectAll = onSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired before table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.beforeSelect(function(selected) {\r\n\t *       return true;\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} beforeSelect Table row selecting event handler.\r\n\t * @param {Boolean} beforeSelect.selected True - table row is selected, false - otherwise.\r\n\t * @param {Boolean} beforeSelect.return True - table row is allowed to select, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeSelect: function(beforeSelect) {\r\n\t\tif(beforeSelect === undefined) {\r\n\t\t\treturn this._beforeSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.beforeSelect', beforeSelect).isFunction();\r\n\t\tthis._beforeSelect = beforeSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after table row is selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.afterSelect(function() {});\r\n\t *     \r\n\t * @param {Function | undefined} afterSelect Table row after selected event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterSelect: function(afterSelect) {\r\n\t\tif(afterSelect === undefined) {\r\n\t\t\treturn this._afterSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.afterSelect', afterSelect).isFunction();\r\n\t\tthis._afterSelect = afterSelect;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired before all table rows are selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.beforeSelectAll(function(selected) {\r\n\t *       return true;\r\n\t *     });\r\n\t *     \r\n\t * @param {Function | undefined} beforeSelectAll All table rows are being selected event handler.\r\n\t * @param {Boolean} beforeSelectAll.selected True - all table rows are selected, false - otherwise.\r\n\t * @param {Boolean} beforeSelectAll.return True - all table rows are allowed to select, false - otherwise.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tbeforeSelectAll: function(beforeSelectAll) {\r\n\t\tif(beforeSelectAll === undefined) {\r\n\t\t\treturn this._beforeSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.beforeSelectAll', beforeSelectAll).isFunction();\r\n\t\tthis._beforeSelectAll = beforeSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired after all table rows are selected(select column is checked). Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.afterSelectAll(function() {});\r\n\t *     \r\n\t * @param {Function | undefined} afterSelectAll Event handler for \"after all table rows are selected\".\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tafterSelectAll: function(afterSelectAll) {\r\n\t\tif(afterSelectAll === undefined) {\r\n\t\t\treturn this._afterSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.afterSelectAll', afterSelectAll).isFunction();\r\n\t\tthis._afterSelectAll = afterSelectAll;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when fill row, user can use this to customize each row style like background color, font color. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onFillRow(function(trEle, dsObj) {});\r\n\t *   \r\n\t * @param {Function | undefined} onFillRow Table row filled event handler.\r\n\t * @param {HtmlElement} onFillRow.trElement Table row element.\r\n\t * @param {jslet.data.Dataset} onFillRow.dataset Current dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonFillRow: function(onFillRow) {\r\n\t\tif(onFillRow === undefined) {\r\n\t\t\treturn this._onFillRow;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillRow', onFillRow).isFunction();\r\n\t\tthis._onFillRow = onFillRow;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when fill cell, user can use this to customize each cell style like background color, font color. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onFillRow(function(trEle, dsObj, fldName) {});\r\n\t * \r\n\t * @param {Function | undefined} onFillCell Table cell filled event handler.\r\n\t * @param {HtmlElement} onFillCell.tdElement Table cell element.\r\n\t * @param {jslet.data.Dataset} onFillCell.dataset Current dataset object.\r\n\t * @param {String} onFillCell.fieldName Field name.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonFillCell: function(onFillCell) {\r\n\t\tif(onFillCell === undefined) {\r\n\t\t\treturn this._onFillCell;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillCell', onFillCell).isFunction();\r\n\t\tthis._onFillCell = onFillCell;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user click the '+' button of the 'Edit' column. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onAppendRecord(function() {\r\n\t *        this.dataset().appendRecord();\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onAppendRecord '+ button event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonAppendRecord: function(onAppendRecord) {\r\n\t\tif(onAppendRecord === undefined) {\r\n\t\t\treturn this._onAppendRecord;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onAppendRecord', onAppendRecord).isFunction();\r\n\t\tthis._onAppendRecord = onAppendRecord;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Fired when user click the '-' button of the 'Edit' column. Example:\r\n\t * \r\n\t *     @example\r\n\t *     tblObj.onDeleteRecord(function() {\r\n\t *        this.dataset().deleteRecord();\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onDeleteRecord '- button event handler.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonDeleteRecord: function(onDeleteRecord) {\r\n\t\tif(onDeleteRecord === undefined) {\r\n\t\t\treturn this._onDeleteRecord;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onDeleteRecord', onDeleteRecord).isFunction();\r\n\t\tthis._onDeleteRecord = onDeleteRecord;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has finding dialog or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasFindDialog true(default) - show finding dialog when press 'Ctrl + F', false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasFindDialog: function(hasFindDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFindDialog === undefined) {\r\n\t\t\treturn Z._hasFindDialog;\r\n\t\t}\r\n\t\tZ._hasFindDialog = hasFindDialog? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify the table has filter dialog or not.\r\n\t * \r\n\t * @param {Boolean | undefined} hasFilterDialog true(default) - show filter dialog when creating table, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasFilterDialog: function(hasFilterDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFilterDialog === undefined) {\r\n\t\t\treturn Z._hasFilterDialog;\r\n\t\t}\r\n\t\tZ._hasFilterDialog = hasFilterDialog? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it's showing the 'Error find' menu item in the context menu.\r\n\t * \r\n\t * @param {Boolean | undefined} enableErrorFinding True - show error find menu item in the context menu, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tenableErrorFinding: function(enableErrorFinding) {\r\n\t\tif(enableErrorFinding === undefined) {\r\n\t\t\treturn this._enableErrorFinding;\r\n\t\t}\r\n\t\tthis._enableErrorFinding = enableErrorFinding ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether the table height is stretched automatically according to the dataset's records.\r\n\t * \r\n\t * @param {Boolean | undefined} autoStretch True - The table height is stretched automatically, false(default) - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tautoStretch: function(autoStretch) {\r\n\t\tvar Z = this;\r\n\t\tif(autoStretch === undefined) {\r\n\t\t\treturn Z._autoStretch;\r\n\t\t}\r\n\t\tZ._autoStretch = autoStretch? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the minimum visible rows of the table.\r\n\t * \r\n\t * @param {Integer | undefined} minVisibleRows Minimum visible rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tminVisibleRows: function(minVisibleRows) {\r\n\t\tif(minVisibleRows === undefined) {\r\n\t\t\treturn this._minVisibleRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.minVisibleRows', minVisibleRows).isGTZero();\r\n\t\tthis._minVisibleRows = parseInt(minVisibleRows);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the minimum visible rows of the table.\r\n\t * \r\n\t * @param {Integer | undefined} maxVisibleRows Minimum visible rows.\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\tmaxVisibleRows: function(maxVisibleRows) {\r\n\t\tif(maxVisibleRows === undefined) {\r\n\t\t\treturn this._maxVisibleRows;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.maxVisibleRows', maxVisibleRows).isNumber();\r\n\t\tthis._maxVisibleRows = parseInt(maxVisibleRows);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\tcellEditor: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._editable) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(!Z._cellEditor) {\r\n\t\t\tZ._cellEditor = new jslet.ui.table.TableCellEditor(Z);\r\n\t\t}\r\n\t\treturn Z._cellEditor;\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Table columns configurations, array of jslet.ui.table.TableColumn.\r\n\t * \r\n\t * @param {jslet.ui.table.TableColumn[] | undefined} columns Table columns configurations.\r\n\t * \r\n\t * @return {this | jslet.ui.table.TableColumn[]}\r\n\t */\r\n\tcolumns: function(columns) {\r\n\t\tif(columns === undefined) {\r\n\t\t\treturn this._columns;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.columns', columns).isArray();\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolObj = columns[i];\r\n\t\t\tjslet.Checker.test('DBTable.Column.field', colObj.field).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.label', colObj.label).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colNum', colObj.colNum).isGTEZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.displayOrder', colObj.displayOrder).isNumber();\r\n\t\t\tjslet.Checker.test('DBTable.Column.width', colObj.width).isGTZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colSpan', colObj.colSpan).isGTZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.prefix', colObj.prefix).isArray();\r\n\t\t\tjslet.Checker.test('DBTable.Column.suffix', colObj.suffix).isArray();\r\n\t\t\tif(!colObj.field) {\r\n\t\t\t\tcolObj.disableHeadSort = true;\r\n\t\t\t\tcolObj.disableFilter = true;\r\n\t\t\t} else {\r\n\t\t\t\tcolObj.disableHeadSort = colObj.disableHeadSort ? true: false;\r\n\t\t\t\tcolObj.disableFilter = colObj.disableFilter ? true: false;\r\n\t\t\t}\r\n\t\t\tcolObj.mergeSame = colObj.mergeSame ? true: false;\r\n\t\t\tcolObj.noRefresh = colObj.noRefresh ? true: false;\r\n\t\t\tjslet.Checker.test('DBTable.Column.cellRender', colObj.cellRender).isObject();\r\n\t\t}\r\n\t\tthis._columns = columns;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get editable fields when DBTable is in editable. It is contrast to 'readOnlyFields'.<br />\r\n\t * If the read only columns' count is greater than editable fields, use 'readOnlyFields' instead. <br />\r\n\t * If 'editableFields' and 'readOnlyFields' are not specified, editable fields comes from jslet.data.Field object.\r\n\t * \r\n\t * @param {String[] | String | undefined} editableFields Editable fields.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\teditableFields: function(editableFields) {\r\n\t\tif(editableFields === undefined) {\r\n\t\t\treturn this._editableFields;\r\n\t\t}\r\n\t\tif(jslet.isString(editableFields)) {\r\n\t\t\teditableFields = editableFields.split(',');\r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('DBTable.editableFields', editableFields).isArray();\r\n\t\t}\r\n\t\tfor(var i = 0, len = editableFields.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('DBTable.editableFields#fieldName', editableFields[i]).required().isString();\r\n\t\t\teditableFields[i] = editableFields[i].trim();\r\n\t\t}\r\n\t\tthis._editableFields = editableFields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get read only fields when DBTable is in editable. It is contrast to 'editableFields'.<br />\r\n\t * If the editable columns' count is greater than read only fields, use 'editableFields' instead. <br />\r\n\t * If 'editableFields' and 'readOnlyFields' are not specified, editable fields comes from jslet.data.Field object.\r\n\t * \r\n\t * @param {String[] | String | undefined} readOnlyFields Read only fields.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\treadOnlyFields: function(readOnlyFields) {\r\n\t\tif(readOnlyFields === undefined) {\r\n\t\t\treturn this._readOnlyFields;\r\n\t\t}\r\n\t\tif(jslet.isString(readOnlyFields)) {\r\n\t\t\treadOnlyFields = readOnlyFields.split(',');\r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('DBTable.readOnlyFields', readOnlyFields).isArray();\r\n\t\t}\r\n\t\tfor(var i = 0, len = readOnlyFields.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('DBTable.readOnlyFields#fieldName', readOnlyFields[i]).required().isString();\r\n\t\t\treadOnlyFields[i] = readOnlyFields[i].trim();\r\n\t\t}\r\n\t\tthis._readOnlyFields = readOnlyFields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoField: function(fldName) {\r\n\t\tjslet.Checker.test('DBTable.gotoField#fldName', fldName).required().isString();\r\n\t\tvar colNum = this.getColNumByField(fldName);\r\n\t\tif(colNum >= 0) {\r\n\t\t\tthis.gotoColumn(colNum);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get column number with field name.\r\n\t * \r\n\t * @param {String} fldName Field name.\r\n\t * \r\n\t * @return {Integer} Column number.\r\n\t */\r\n\tgetColNumByField: function(fldName) {\r\n\t\tvar lastColNum = this.innerColumns.length - 1,\r\n\t\t\tcolCfg;\r\n\t\tfor(var i = 0; i <= lastColNum; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tif(colCfg.field == fldName) {\r\n\t\t\t\treturn colCfg.colNum;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field name with column number.\r\n\t * \r\n\t * @param {Integer} colNum Column number.\r\n\t * \r\n\t * @return {String} Field name.\r\n\t */\r\n\tgetFieldByColNum: function(colNum) {\r\n\t\tvar lastColNum = this.innerColumns.length - 1,\r\n\t\t\tcolCfg;\r\n\t\tfor(var i = 0; i <= lastColNum; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tif(colCfg.colNum == colNum) {\r\n\t\t\t\treturn colCfg.field;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoColumn: function(colNum) {\r\n\t\tjslet.Checker.test('DBTable.gotoColumn#colNum', colNum).required().isGTEZero();\r\n\t\tvar lastColNum = this.innerColumns.length - 1;\r\n\t\tif(colNum > lastColNum) {\r\n\t\t\tcolNum = lastColNum;\r\n\t\t}\r\n\t\tthis.currColNum(colNum);\r\n\t},\r\n\t\r\n\teditorTabIndex: function() {\r\n\t\treturn this._editorTabIndex;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function(el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t_calcTabIndex: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(Z._editable) {\r\n\t\t\tvar masterFldObj = Z._dataset.getMasterFieldObject(),\r\n\t\t\t\ttbIdx = null;\r\n\t\t\tif(masterFldObj) {\r\n\t\t\t\ttbIdx = masterFldObj.tabIndex();\r\n\t\t\t}\r\n\t\t\tif(!tbIdx) {\r\n\t\t\t\ttbIdx = Z.el.tabIndex;\r\n\t\t\t}\r\n\t\t\tZ._editorTabIndex = tbIdx && tbIdx > 0? tbIdx: null;\r\n\t\t}\r\n\t\tZ.el.tabIndex = -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.resizeEventBus.subscribe(Z);\r\n\t\t\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tZ.charHeight = jslet.ui.textMeasurer.getHeight('M')+4;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tZ.charWidth = jslet.global.defaultCharWidth || 12;\r\n\t\tZ._widthStyleId = jslet.nextId();\r\n\t\tZ._initializeVm();\r\n\t\tZ._calcTabIndex();\r\n\t\tZ.renderAll();\r\n\t\tZ._bindEvents();\r\n\t}, // end bind\r\n\t\r\n\t_bindEvents: function() {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n        var notFF = ((typeof Z.el.onmousewheel) == 'object'); //firefox or nonFirefox browser\r\n        var wheelEvent = (notFF ? 'mousewheel' : 'DOMMouseScroll');\r\n        jqEl.on(wheelEvent, function(event) {\r\n        \tif(Z._disableMouseWheel) {\r\n        \t\treturn;\r\n        \t}\r\n        \t\r\n            var originalEvent = event.originalEvent;\r\n            var num = notFF ? originalEvent.wheelDelta / -120 : originalEvent.detail / 3;\r\n\t\t\tif(Z._editable && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n            Z.listvm.setVisibleStartRow(Z.listvm.getVisibleStartRow() + num);\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t}\r\n       \t\tevent.preventDefault();\r\n        });\r\n\r\n        jqEl.on('mousedown', function(event) {\r\n        \tif(event.shiftKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n        \r\n        jqEl.on('click', 'button.jl-tbl-filter', function(event) {\r\n    \t\tif (!Z._filterPanel) {\r\n    \t\t\tZ._filterPanel = new jslet.ui.table.DBTableFilterPanel(Z);\r\n    \t\t}\r\n    \t\tvar btnEle = event.currentTarget,\r\n    \t\t\tjqFilterBtn = jQuery(btnEle),\r\n    \t\t\ttblPos = jQuery(Z.el).offset();\r\n    \t\tvar r = jqFilterBtn.offset(), \r\n    \t\t\th = jqFilterBtn.outerHeight(), \r\n    \t\t\tx = r.left - tblPos.left, \r\n    \t\t\ty = r.top + h - tblPos.top;\r\n    \t\tif (jsletlocale.isRtl) {\r\n    \t\t\tx = x + jqFilterBtn.outerWidth();\r\n    \t\t}\r\n    \t\tvar fldName = jqFilterBtn[0].getAttribute('jsletfilterfield');\r\n    \t\tZ._filterPanel.changeField(fldName);\r\n    \t\tZ._filterPanel.jqFilterBtn(jqFilterBtn);\r\n    \t\tZ._filterPanel.show(x, y, 0, h);\r\n        \t\r\n       \t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n        });\r\n        jqEl.on('dblclick', 'td.jl-tbl-cell', function(event) {\r\n        \tvar otd = event.currentTarget;\r\n        \tZ._doDblCellClick(otd, event.offsetY);\r\n        });\r\n        \r\n        jqEl.on('mousedown', 'td.jl-tbl-cell', function(event) {\r\n        \tvar otd = event.currentTarget;\r\n        \tvar offsetY = event.offsetY;\r\n        \tif(event.target != otd) {\r\n        \t\toffsetY = jQuery(event.target).offset().top - jQuery(otd).offset().top + event.offsetY;\r\n        \t}\r\n        \tZ._doCellClick(otd, offsetY, event);\r\n        \t\r\n        \tif(event.shiftKey || event.ctrlKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n\r\n        jqEl.on('click', '.jl-tbltree-btn', function(event) {\r\n        \tfunction checkFn(node) {\r\n\t\t\t\treturn node.tagName && node.tagName.toLowerCase() == 'tr' && (node.jsletrecno || node.jsletrecno === 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfunction callBackFn() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar otr = jslet.ui.findFirstParent(this, checkFn);\r\n\t\t\t\t\t\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tvar recNo = otr.jsletrecno;\r\n\t\t\tZ._dataset.recno(recNo);\r\n\t\t\tif(Z._dataset.aborted()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (Z._dataset.expandedByRecno(recNo)) {\r\n\t\t\t\tZ.listvm.collapse(callBackFn);\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand(callBackFn);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n        });\r\n        \r\n\t\tjqEl.on('keydown', function(event) {\r\n\t\t\tvar keyCode = event.which,\r\n\t\t\t\tctrlKey = event.ctrlKey,\r\n\t\t\t\tshiftKey = event.shiftKey,\r\n\t\t\t\taltKey = event.altKey;\r\n\t\t\tif(ctrlKey) {\r\n\t\t\t\tvar flag = false;\r\n\t\t\t\tif(Z._hasFindDialog && keyCode === jslet.ui.KeyCode.F) { //ctrl + f\r\n\t\t\t\t\tZ.showFindDialog();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.E && (Z._enableErrorFinding || Z._editable)) { //ctrl + e\r\n\t\t\t\t\tZ.gotoNextError();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.A) { //ctrl + a\r\n\t\t\t\t\tZ.selectAllCells();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.HOME) { //ctrl + Home\r\n\t\t\t\t\tZ._dataset.first();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.END) { //ctrl + End\r\n\t\t\t\t\tZ._dataset.last();\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(keyCode === jslet.ui.KeyCode.C) { //ctrl + c\r\n\t\t\t\t\tZ.copySelection(false);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(flag) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar isTabKey = (keyCode === jslet.ui.KeyCode.TAB || keyCode === jslet.global.defaultFocusKeyCode);\r\n\t\t\tif(shiftKey && isTabKey) { //Shift TAB Left\r\n\t\t\t\tif(!Z.tabPrior()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else if(isTabKey) { //TAB Right\r\n\t\t\t\tif(!Z.tabNext()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else if(keyCode === jslet.ui.KeyCode.LEFT) { //Arrow Left\r\n\t\t\t\tZ.movePriorCell(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if( keyCode === jslet.ui.KeyCode.RIGHT) { //Arrow Right\r\n\t\t\t\tZ.moveNextCell(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.UP) {//KEY_UP\r\n\t\t\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\t\t\tZ.listvm.priorRow();\r\n\t\t\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.DOWN) {//KEY_DOWN\r\n\t\t\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\t\t\tZ.listvm.nextRow();\r\n\t\t\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEUP) {//KEY_PAGEUP\r\n\t\t\t\tZ.listvm.priorPage();\r\n\t\t\t} else if (keyCode === jslet.ui.KeyCode.PAGEDOWN) {//KEY_PAGEDOWN\r\n\t\t\t\tZ.listvm.nextPage();\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode === jslet.ui.KeyCode.ENTER && !Z._editable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n\t\t});\t\t\r\n\t\tZ._createContextMenu();\r\n\t},\r\n\t\r\n\t_createContextMenu: function() {\r\n\t\tif (!jslet.ui.Menu) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar menuCfg = {type: 'Menu', onItemClick: jQuery.proxy(Z._menuItemClick, Z), items: []};\r\n\t\tmenuCfg.items.push({id: 'selectAll', name: jsletlocale.DBTable.selectAll});\r\n\t\tmenuCfg.items.push({id: 'copy', name: jsletlocale.DBTable.copy});\r\n\t\tmenuCfg.items.push({name: '-'});\r\n\t\tif(Z._hasFindDialog) {\r\n\t\t\tmenuCfg.items.push({id: 'find', name: jsletlocale.DBTable.find});\r\n\t\t}\r\n\t\tmenuCfg.items.push({id: 'fixed', name: jsletlocale.DBTable.fixed, \r\n\t\t\titems: [{id: 'fixedCol', name: jsletlocale.DBTable.fixedCol},\r\n\t\t\t        {id: 'fixedRow', name: jsletlocale.DBTable.fixedRow},\r\n\t\t\t]});\r\n\t\tif(Z._enableErrorFinding || Z._editable) {\r\n\t\t\tmenuCfg.items.push({name: '-'});\r\n\t\t\tmenuCfg.items.push({id: 'nextError', name: jsletlocale.DBTable.nextError});\r\n\t\t}\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t\tjQuery(Z.el).on('contextmenu', '.jl-tbl-cell', function(event) {\r\n\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_menuItemClick: function(menuCfg, checked) {\r\n\t\tvar menuId = menuCfg.id;\r\n\t\tvar Z = this;\r\n\t\tif (menuId == 'selectAll') {\r\n\t\t\tZ.selectAllCells();\r\n\t\t} else if (menuId == 'find') {\r\n\t\t\tZ.showFindDialog();\r\n\t\t} else if (menuId == 'fixedRow') {\r\n\t\t\tZ.fixedRows(Z._dataset.recno() + 1);\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (menuId == 'fixedCol') {\r\n\t\t\tZ.fixedCols(Z._currColNum + 1);\r\n\t\t\tZ.renderAll();\r\n\t\t} else if (menuId == 'copy') {\r\n\t\t\tjslet.ui.info(jsletlocale.DBTable.copyInfo);\r\n\t\t} else if (menuId == 'nextError') {\r\n\t\t\tZ.gotoNextError();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show finding record dialog. Press 'Ctrl + F' to call this method.\r\n\t */\r\n\tshowFindDialog: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._filterPanel) {\r\n\t\t\tZ._filterPanel.hide();\r\n\t\t}\r\n\t\tif(!Z._hasFindDialog) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!Z._findDialog) {\r\n\t\t\tZ._findDialog = new jslet.ui.table.FindDialog(Z);\r\n\t\t}\r\n\t\tif(!Z._findDialog.findingField()) {\r\n\t\t\tvar colCfg = Z.innerColumns[Z._currColNum];\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t} else {\r\n\t\t\t\t//Get first column with field name.\r\n\t\t\t\tfor(var i = Z._currColNum + 1, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[i];\r\n\t\t\t\t\tif(colCfg.field) {\r\n\t\t\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._findDialog.findingField()) {\r\n\t\t\tZ._findDialog.show(0, Z.headSectionHt);\r\n\t\t}\t\t\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto the next error record if dataset exists errors. Press 'Ctrl + E' to call this method.\r\n\t */\r\n\tgotoNextError: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset.nextError()) {\r\n\t\t\tZ._dataset.firstError();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcopySelection: function(fitExcel) {\r\n\t\tvar Z = this, \r\n\t\t\tselectedText;\r\n\t\tif(fitExcel) {\r\n\t\t\tselectedText = Z._dataset.selection.getSelectionText('\"', true, '\\t');\r\n\t\t} else {\r\n\t\t\tselectedText = Z._dataset.selection.getSelectionText('', false, '\\t');\r\n\t\t}\r\n\t\tif(!selectedText) {\r\n\t\t\tvar fldName = Z.getFieldByColNum(Z._currColNum);\r\n\t\t\tif(fldName) {\r\n\t\t\t\tselectedText = Z._dataset.getFieldText(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(selectedText) {\r\n\t\t\tjslet.Clipboard.putText(selectedText);\r\n\t\t\twindow.setTimeout(function() {Z.el.focus();}, 5);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tselectAllCells: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfields = [], colCfg, fldName;\r\n\t\tfor(var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tcolCfg = Z.innerColumns[i];\r\n\t\t\tfldName = colCfg.field;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tfields.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._dataset.selection.selectAll(fields, true);\r\n\t\tZ._refreshSelection();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Move cursor to the prior editable field.\r\n\t */\r\n\ttabPrior: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = Z.getFieldByColNum(Z._currColNum),\r\n\t\t\tlastColNum, num = null, \r\n\t\t\tfocusedFields = Z._dataset.focusedFields(),\r\n\t\t\teditingFields = Z._getEditingFields();\r\n\t\tif(editingFields && editingFields.indexOf(fldName) >= 0) {\r\n\t\t\tvar focusMngr = jslet.ui.globalFocusManager,\r\n\t\t\t\tonChangingFocusFn = focusMngr.onChangingFocus();\r\n\t\t\t\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfocusedFields = focusedFields.slice(0);\r\n\t\t\t\tfor(var i = focusedFields.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(editingFields.indexOf(focusedFields[i]) < 0) {\r\n\t\t\t\t\t\tfocusedFields.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar idx = -1, fields;\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfields = focusedFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(idx < 0) {\r\n\t\t\t\tfields = editingFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(onChangingFocusFn) {\r\n\t\t\t\tvar cancelFocus = onChangingFocusFn(document.activeElement || Z.el, true, Z._dataset, \r\n\t\t\t\t\t\tfocusMngr.activeField(), fields, focusMngr.activeValueIndex());\r\n\t\t\t\tif(!cancelFocus) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(fields && idx >= 0) {\r\n\t\t\t\tif(idx === 0) {\r\n\t\t\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\t\t\tZ._dataset.prior();\r\n\t\t\t\t\t\tfldName = fields[fields.length - 1];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldName = fields[idx - 1];\r\n\t\t\t\t}\r\n\t\t\t\tnum = Z.getColNumByField(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(num === null) {\r\n\t\t\tlastColNum = Z.innerColumns.length - 1;\r\n\t\t\tif(Z._currColNum === 0) {\r\n\t\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\t\tZ._dataset.prior();\r\n\t\t\t\t\tnum = lastColNum;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnum = Z._currColNum - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.currColNum(num);\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Move cursor to the next editable field.\r\n\t */\r\n\ttabNext: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = Z.getFieldByColNum(Z._currColNum),\r\n\t\t\tlastColNum, num = null, \r\n\t\t\tfocusedFields = Z._dataset.focusedFields(),\r\n\t\t\teditingFields = Z._getEditingFields();\r\n\t\t\t\r\n\t\tif(editingFields && editingFields.indexOf(fldName) >= 0) {\r\n\t\t\tvar focusMngr = jslet.ui.globalFocusManager,\r\n\t\t\t\tonChangingFocusFn = focusMngr.onChangingFocus();\r\n\t\t\t\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfocusedFields = focusedFields.slice(0);\r\n\t\t\t\tfor(var i = focusedFields.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(editingFields.indexOf(focusedFields[i]) < 0) {\r\n\t\t\t\t\t\tfocusedFields.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar idx = -1, fields;\r\n\t\t\tif(focusedFields) {\r\n\t\t\t\tfields = focusedFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(idx < 0) {\r\n\t\t\t\tfields = editingFields;\r\n\t\t\t\tidx = fields.indexOf(fldName);\r\n\t\t\t}\r\n\t\t\tif(onChangingFocusFn) {\r\n\t\t\t\tvar cancelFocus = onChangingFocusFn(document.activeElement || Z.el, false, Z._dataset, \r\n\t\t\t\t\t\tfocusMngr.activeField(), fields, focusMngr.activeValueIndex());\r\n\t\t\t\tif(!cancelFocus) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(fields && idx >= 0) {\r\n\t\t\t\tif(idx === fields.length - 1) {\r\n\t\t\t\t\tif(Z._dataset.recno() < Z._dataset.recordCount() - 1) {\r\n\t\t\t\t\t\tZ._dataset.next();\r\n\t\t\t\t\t\tfldName = fields[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldName = fields[idx + 1];\r\n\t\t\t\t}\r\n\t\t\t\tnum = Z.getColNumByField(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(num === null) {\r\n\t\t\tlastColNum = Z.innerColumns.length - 1;\r\n\t\t\tif(Z._currColNum < lastColNum) {\r\n\t\t\t\tnum = Z._currColNum + 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(Z._dataset.recno() === Z._dataset.recordCount() - 1) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.next();\r\n\t\t\t\tnum = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.currColNum(num);\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\tmovePriorCell: function(ctrlKey, shiftKey, altKey) {\r\n\t\tvar Z = this,\r\n\t\t\tlastColNum = Z.innerColumns.length - 1,\r\n\t\t\tnum;\r\n\t\t\r\n\t\tif(Z._currColNum === 0) {\r\n\t\t\tif(Z._dataset.recno() > 0) {\r\n\t\t\t\tZ._dataset.prior();\r\n\t\t\t\tnum = lastColNum;\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tnum = Z._currColNum - 1;\r\n\t\t}\r\n\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\tZ.currColNum(num);\r\n\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tmoveNextCell: function(ctrlKey, shiftKey, altKey) {\r\n\t\tvar Z = this,\r\n\t\t\tlastColNum = Z.innerColumns.length - 1,\r\n\t\t\tnum;\r\n\t\t\r\n\t\tif(Z._currColNum < lastColNum) {\r\n\t\t\tnum = Z._currColNum + 1;\r\n\t\t} else {\r\n\t\t\tif(Z._dataset.recno() === Z._dataset.recordCount() - 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._dataset.next();\r\n\t\t\tnum = 0;\r\n\t\t}\r\n\t\tZ._doBeforeSelect(ctrlKey, shiftKey, altKey);\r\n\t\tZ.currColNum(num);\r\n\t\tZ._processSelection(ctrlKey, shiftKey, altKey);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_getEditingFields: function() {\r\n\t\tvar Z = this; \r\n\t\tif(!Z._editable) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldName, fldObj,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\tresult = null;\r\n\r\n\t\tfor(var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tfldName = Z.innerColumns[i].field;\r\n\t\t\tif(!fldName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\tif(!fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\tif(!result) {\r\n\t\t\t\t\tresult = [];\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_initializeVm: function() {\r\n\t\tvar Z = this;\r\n\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, Z._treeField ? true : false);\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged = function(rowno) {\r\n\t\t\tif (rowno < 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._fillData();\r\n\t\t\t\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t\tZ._showCurrentRow();\r\n\t\t};\r\n\t\r\n\t\tZ.listvm.onVisibleCountChanged = function() {\r\n\t\t\tZ.renderAll();\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged = function(preRowno, rowno) {\r\n\t\t\tZ._hideCurrentRow();\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno());\r\n\t\t\tvar currRow = Z._getTrByRowno(rowno), otr;\r\n\t\t\tif (!currRow) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\totr = currRow.fixed;\r\n\t\t\tif (otr) {\r\n\t\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totr = currRow.content;\r\n\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\tZ._currRow = currRow;\r\n\t\t\tif(Z._editable) {\r\n\t\t\t\tvar fldName = Z._editingField;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tvar fldObj = Z._dataset.getField(fldName);\r\n\t\t\t\t\tif(fldObj && !fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\t\t\tZ._dataset.focusEditControl(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._innerDestroy();\r\n\t\tZ.el.innerHTML = '';\r\n\t\tZ.listvm.fixedRows = Z._fixedRows;\r\n\t\tZ._calcParams();\r\n\t\tZ.listvm.refreshModel();\r\n\t\tZ._createFrame();\r\n\t\tZ._fillData();\r\n\t\tZ._showCurrentRow(true);\r\n\t\tZ._oldHeight = jQuery(Z.el).height();\r\n\t\tZ._updateSortFlag(true);\r\n\t\treturn this;\r\n\t}, // end renderAll\r\n\r\n\t_doBeforeSelect: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t},\r\n\t\r\n\t_getSelectionFields: function(startColNum, endColNum) {\r\n\t\tif(startColNum > endColNum) {\r\n\t\t\tvar tmp = startColNum;\r\n\t\t\tstartColNum = endColNum;\r\n\t\t\tendColNum = tmp;\r\n\t\t}\r\n\t\tvar fields = [], fldName, colCfg, colNum;\r\n\t\tfor(var i = 0, len = this.innerColumns.length; i < len; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tcolNum = colCfg.colNum;\r\n\t\t\tif(colNum >= startColNum && colNum <= endColNum) {\r\n\t\t\t\tfldName = colCfg.field;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fields;\r\n\t},\r\n\t\r\n\t_processSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tvar Z = this,\r\n\t\t\tcurrRecno = Z._dataset.recno(),\r\n\t\t\tfldName;\r\n\t\tif(hasCtrlKey || !Z._autoClearSelection) { //If autoClearSelection = false, click a cell will select it.\r\n\t\t\tfldName = Z.innerColumns[Z._currColNum].field;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tif(Z._dataset.selection.isSelected(currRecno, fldName)) {\r\n\t\t\t\t\tZ._dataset.selection.remove(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ._dataset.selection.add(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t}\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(hasShiftKey) {\r\n\t\t\tvar fields;\r\n\t\t\tif(Z._preTmpRecno >= 0 && Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, false);\r\n\t\t\t}\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._currColNum);\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._refreshSelection();\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t} else {\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t\tif(Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_processColumnSelection: function(colCfg, hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\trecCnt = Z._dataset.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields, colNum;\r\n\t\tif(hasShiftKey) {\r\n\t\t\tif(Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(0, recCnt, fields, true);\r\n\t\t\t}\r\n\t\t\tcolNum = colCfg.colNum + colCfg.colSpan - 1;\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, colNum);\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preTmpColNum = colNum;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tif(colCfg.colSpan > 1) {\r\n\t\t\t\tfields = [];\r\n\t\t\t\tvar startColNum = colCfg.colNum,\r\n\t\t\t\t\tendColNum = colCfg.colNum + colCfg.colSpan, fldName;\r\n\t\t\t\t\r\n\t\t\t\tfor(colNum = startColNum; colNum < endColNum; colNum++) {\r\n\t\t\t\t\tfldName = Z.innerColumns[colNum].field;\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfields = [colCfg.field];\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preColNum = colCfg.colNum;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_processRowSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfields = Z._getSelectionFields(0, Z.innerColumns.length - 1);\r\n\t\tvar currRecno = Z._dataset.recno();\r\n\t\tif(hasShiftKey) {\r\n\t\t\tif(Z._preTmpRecno >= 0) {\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, true);\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._preTmpColNum = currRecno;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(currRecno, currRecno, fields, true);\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_prepareColumn: function() {\r\n\t\tvar Z = this, cobj;\r\n\t\tZ._sysColumns = [];\r\n\t\t//prepare system columns\r\n\t\tif (Z._hasSeqCol) {\r\n\t\t\tcobj = {label:'&nbsp;',width: Z.seqColWidth, disableHeadSort:true,isSeqCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.sequenceCellRender, widthCssName: Z._widthStyleId + '-s0'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\tif (Z._hasSelectCol) {\r\n\t\t\tcobj = {label:'<input type=\"checkbox\" />', width: Z.selectColWidth, disableHeadSort:true,isSelectCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.selectCellRender, widthCssName: Z._widthStyleId + '-s1'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t\r\n\t\tif (Z.subgroup && Z.subgroup.hasExpander) {\r\n\t\t\tcobj = {label:'&nbsp;', width: Z.selectColWidth, disableHeadSort:true, isSubgroup: true, \r\n\t\t\t\t\tcellRender:jslet.ui.table.cellRenders.subgroupCellRender, widthCssName: Z._widthStyleId + '-s2'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t//prepare data columns\r\n\t\tvar tmpColumns = [], fldObj;\r\n\t\tif (Z._columns) {\r\n\t\t\tfor(var k = 0, colCnt2 = Z._columns.length; k < colCnt2; k++) {\r\n\t\t\t\tcobj = Z._columns[k];\r\n\t\t\t\tif (!cobj.field) {\r\n\t\t\t\t\tcobj.disableHeadSort = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\t\tif(!fldObj) {\r\n\t\t\t\t\t\tthrow new Error('Not found Field: ' + cobj.field);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t}\r\n\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction getColumnObj(fldName) {\r\n\t\t\tif (Z._columns) {\r\n\t\t\t\tfor(var m = 0, colCnt1 = Z._columns.length; m < colCnt1; m++) {\r\n\t\t\t\t\tcobj = Z._columns[m];\r\n\t\t\t\t\tif (cobj.field && cobj.field == fldName) {\r\n\t\t\t\t\t\treturn cobj;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar i, fldcnt, colCnt, fldName;\r\n\t\tif (!Z._onlySpecifiedCol) {\r\n\t\t\tvar fields = Z._dataset.getFields();\r\n\t\t\tfor (i = 0, fldcnt = fields.length; i < fldcnt; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif (fldObj.visible()) {\r\n\t\t\t\t\tcobj = getColumnObj(fldName);\r\n\t\t\t\t\tif(!cobj) {\r\n\t\t\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\t\t\tcobj.field = fldObj.name();\r\n\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t}\r\n\t\t\t\t} // end if visible\r\n\t\t\t} // end for\r\n\t\t\tif (Z._columns) {\r\n\t\t\t\tfor(i = 0, colCnt = Z._columns.length; i < colCnt; i++) {\r\n\t\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\t\tif (!cobj.field) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfldObj = Z._dataset.getTopField(cobj.field);\r\n\t\t\t\t\tif (!fldObj) {\r\n\t\t\t\t\t\tthrow new Error(\"Field: \" + cobj.field + \" doesn't exist!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar children = fldObj.children();\r\n\t\t\t\t\tif (children && children.length > 0) {\r\n\t\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\t\tvar isUnique = true;\r\n\t\t\t\t\t\t// cobj.field is not a child of a groupfield, we need check if the topmost parent field is duplicate or not \r\n\t\t\t\t\t\tif (cobj.field != fldName) {\r\n\t\t\t\t\t\t\tfor(var n = 0; n < tmpColumns.length; n++) {\r\n\t\t\t\t\t\t\t\tif (tmpColumns[n].field == fldName) {\r\n\t\t\t\t\t\t\t\t\tisUnique = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} // end for k\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (isUnique) {\r\n\t\t\t\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\t\t\t\tcobj.field = fldName;\r\n\t\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} //end for i\r\n\t\t\t} //end if Z.columns\r\n\t\t}\r\n\t\t\r\n\t\ttmpColumns.sort(function(cobj1, cobj2) {\r\n\t\t\tvar ord1 = cobj1.displayOrder || 0;\r\n\t\t\tvar ord2 = cobj2.displayOrder || 0;\r\n\t\t\treturn ord1 === ord2? 0: (ord1 < ord2? -1: 1);\r\n\t\t});\r\n\t\t\r\n\t\tZ.innerHeads = [];\r\n\t\tZ.innerColumns = [];\r\n\t\tvar ohead, label, \r\n\t\t\tcontext = {lastColNum: 0, depth: 0};\r\n\t\t\r\n\t\tfor(i = 0, colCnt = tmpColumns.length; i < colCnt; i++) {\r\n\t\t\tcobj = tmpColumns[i];\r\n\t\t\tfldName = cobj.field;\r\n\t\t\tif (!fldName) {\r\n\t\t\t\tohead = new jslet.ui.table.TableHead();\r\n\t\t\t\tlabel = cobj.label;\r\n\t\t\t\tohead.label = label? label: \"\";\r\n\t\t\t\tohead.level = 0;\r\n\t\t\t\tohead.colNum = context.lastColNum++;\r\n\t\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\t\tohead.id = jslet.nextId();\r\n\t\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\tohead.disableHeadSort = cobj.disableHeadSort;\r\n\r\n\t\t\t\tZ.innerHeads.push(ohead);\r\n\t\t\t\tZ.innerColumns.push(cobj);\r\n\t\t\t\t\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tZ._convertField2Head(context, fldObj);\r\n\t\t}\r\n\r\n\t\tZ.maxHeadRows = context.depth + 1;\r\n\t\tZ._calcHeadSpan();\r\n\t\r\n\t\t//check fixedCols property\r\n\t\tvar preColCnt = 0, len,\r\n\t\t\tfixedColNum = Z._fixedCols - Z._sysColumns.length;\r\n\t\tcolCnt = 0;\r\n\t\tfor(i = 1, len = Z.innerHeads.length; i < len; i++) {\r\n\t\t\tohead = Z.innerHeads[i];\r\n\t\t\tcolCnt += ohead.colSpan;\r\n\t\t\tif (fixedColNum <= preColCnt || fixedColNum == colCnt) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (fixedColNum < colCnt && fixedColNum > preColCnt) {\r\n\t\t\t\tZ._fixedCols = preColCnt + Z._sysColumns.length;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpreColCnt = colCnt;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_calcHeadSpan: function(heads) {\r\n\t\tvar Z = this;\r\n\t\tif (!heads) {\r\n\t\t\theads = Z.innerHeads;\r\n\t\t}\r\n\t\tvar ohead, childCnt = 0;\r\n\t\tfor(var i = 0, len = heads.length; i < len; i++ ) {\r\n\t\t\tohead = heads[i];\r\n\t\t\tohead.rowSpan = Z.maxHeadRows - ohead.level;\r\n\t\t\tif (ohead.subHeads) {\r\n\t\t\t\tohead.colSpan = Z._calcHeadSpan(ohead.subHeads);\r\n\t\t\t\tchildCnt += ohead.colSpan;\r\n\t\t\t} else {\r\n\t\t\t\tohead.colSpan = 1;\r\n\t\t\t\tchildCnt++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn childCnt;\r\n\t},\r\n\t\r\n\t_convertField2Head: function(context, fldObj, parentHeadObj) {\r\n\t\tfunction checkHtml(htmlStr) {\r\n\t\t    var  reg = /<[^>]+>/g;\r\n\t\t    return reg.test(htmlStr);\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tif (!fldObj.visible()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar level = 0, heads;\r\n\t\tif (!parentHeadObj) {\r\n\t\t\theads = Z.innerHeads;\r\n\t\t} else {\r\n\t\t\tlevel = parentHeadObj.level + 1;\r\n\t\t\theads = parentHeadObj.subHeads;\r\n\t\t}\r\n\t\tvar ohead, fldName = fldObj.name();\r\n\t\tohead = new jslet.ui.table.TableHead();\r\n\t\tohead.label = fldObj.displayLabel();\r\n\t\tohead.field = fldName;\r\n\t\tohead.level = level;\r\n\t\tohead.colNum = context.lastColNum;\r\n\t\tohead.id = jslet.nextId();\r\n\t\theads.push(ohead);\r\n\t\tcontext.depth = Math.max(level, context.depth);\r\n\t\tvar fldChildren = fldObj.children();\r\n\t\tif (fldChildren && fldChildren.length > 0) {\r\n\t\t\tohead.subHeads = [];\r\n\t\t\tvar added = false;\r\n\t\t\tfor(var i = 0, cnt = fldChildren.length; i< cnt; i++) {\r\n\t\t\t\tZ._convertField2Head(context, fldChildren[i], ohead);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcontext.lastColNum ++;\r\n\t\t\tvar cobj, found = false;\r\n\t\t\tvar len = Z._columns ? Z._columns.length: 0;\r\n\t\t\tfor(var k = 0; k < len; k++) {\r\n\t\t\t\tcobj = Z._columns[k];\r\n\t\t\t\tif (cobj.field == fldName) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!found) {\r\n\t\t\t\tcobj = new jslet.ui.table.TableColumn();\r\n\t\t\t\tcobj.field = fldName;\r\n\t\t\t}\r\n\t\t\tif (!cobj.label) {\r\n\t\t\t\tcobj.label = fldObj.displayLabel();\r\n\t\t\t}\r\n\t\t\tvar dataType = fldObj.getType();\r\n\t\t\tif(dataType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\tcobj.isBoolColumn = true;\r\n\t\t\t}\r\n\t\t\tcobj.mergeSame = fldObj.mergeSame();\r\n\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\tif (!cobj.width) {\r\n\t\t\t\tvar maxWidth = fldObj ? fldObj.displayWidth() : 0;\r\n\t\t\t\tif (!Z._hideHead && cobj.label) {\r\n\t\t\t\t\tif(checkHtml(cobj.label)) {\r\n\t\t\t\t\t\tmaxWidth = Math.max(maxWidth, jQuery(cobj.label).text().length);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaxWidth = Math.max(maxWidth, cobj.label.length);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcobj.width = maxWidth ? (maxWidth * Z.charWidth) : 10;\r\n\t\t\t}\r\n\t\t\t//check and set cell render \r\n\t\t\tif (!cobj.cellRender) {\r\n\t\t\t\tif (dataType === jslet.data.DataType.BOOLEAN) {//data type is boolean\r\n\t\t\t\t\tcobj.cellRender = jslet.ui.table.cellRenders.boolCellRender;\r\n\t\t\t\t} else if (dataType === jslet.data.DataType.EDITACTION) {//data type is edit\r\n\t\t\t\t\tohead.cellRender = cobj.cellRender = jslet.ui.table.cellRenders.editActionCellRender;\r\n\t\t\t\t} else if (cobj.field == Z._treeField) {\r\n\t\t\t\t\tcobj.cellRender = jslet.ui.table.cellRenders.treeCellRender;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tohead.disableHeadSort = true;\r\n\t\t\t\tohead.disableFilter = true;\r\n\t\t\t}\r\n\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\r\n\t\t\tZ.innerColumns.push(cobj);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_calcParams: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._preTmpColNum = -1;\r\n\t\tZ._preTmpRecno = -1;\r\n\t\tZ._preRecno = -1;\r\n\t\tZ._preColNum = -1;\r\n\r\n\t\tif (Z._treeField) {//if tree style table, it can't be sorted by clicking column header\r\n\t\t\tZ._disableHeadSort = true;\r\n\t\t}\r\n\t\t// calculate Sequence column width\r\n\t\tif (Z._hasSeqCol) {\r\n\t\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth + 5;\r\n\t\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\t} else {\r\n\t\t\tZ.seqColWidth = 0;\r\n\t\t}\r\n\t\t// calculate Select column width\r\n\t\tif (Z._hasSelectCol) {\r\n\t\t\tZ.selectColWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t} else {\r\n\t\t\tZ.selectColWidth = 0;\r\n\t\t}\r\n\t\t//calculate Fixed row section's height\r\n\t\tif (Z._fixedRows > 0) {\r\n\t\t\tZ.fixedSectionHt = Z._fixedRows * Z.rowHeight();\r\n\t\t} else {\r\n\t\t\tZ.fixedSectionHt = 0;\r\n\t\t}\r\n\t\t//Calculate Foot section's height\r\n\t\tif (Z.aggregated() && Z.dataset().checkAggregated()) {\r\n\t\t\tZ.footSectionHt = Z.footerRowHeight();\r\n\t\t} else {\r\n\t\t\tZ.footSectionHt = 0;\r\n\t\t}\r\n\t\tZ._prepareColumn();\r\n\r\n\t\t// fixed Column count must be less than total columns\r\n\t\tif (Z._fixedCols) {\r\n\t\t\tif (Z._fixedCols > Z.innerColumns.length) {\r\n\t\t\t\tZ._fixedCols = Z.innerColumns.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.hasFixedCol = Z._sysColumns.length > 0 || Z._fixedCols > 0;\r\n\t\tif (Z.hasFixedCol) {\r\n\t\t\tvar w = 0, i, cnt;\r\n\t\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\t\tw += Z._sysColumns[i].width + 1;\r\n\t\t\t}\r\n\t\t\tfor(i = 0, cnt = Z._fixedCols; i < cnt; i++) {\r\n\t\t\t\tw += Z.innerColumns[i].width + 1;\r\n\t\t\t}\r\n\t\t\tZ.fixedColWidth = w + 1;\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = 0;\r\n\t\t}\r\n\t}, // end _calcParams\r\n\r\n\t_setScrollBarMaxValue: function(maxValue) {\r\n\t\tvar Z = this,\r\n\t\t\tv = maxValue + Z._repairHeight + (Z._autoStretch? Z.footSectionHt: 0);\r\n\t\tZ.jqVScrollBar.find('div').height(v);\r\n\t\tif(Z.contentSectionHt >= v) {\r\n\t\t\tZ.jqVScrollBar.parent().addClass('jl-scrollbar-hidden');\t\r\n\t\t} else {\r\n\t\t\tZ.jqVScrollBar.parent().removeClass('jl-scrollbar-hidden');\t\r\n\t\t}\r\n\t},\r\n\r\n\t_changeColWidthCssRule: function(cssName, width) {\r\n\t\tvar Z = this,\r\n\t\t\tstyleEle = document.getElementById(Z._widthStyleId),\r\n\t\t\tstyleObj = styleEle.styleSheet || styleEle.sheet,\r\n\t\t\tcssRules = styleObj.cssRules || styleObj.rules,\r\n\t\t\tcssRule = null, found = false;\r\n\t\t\tcssName = '.' + cssName;\r\n\t\tfor(var i = 0, len = cssRules.length; i < len; i++) {\r\n\t\t\tcssRule = cssRules[i];\r\n\t\t\tif(cssRule.selectorText == cssName) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tcssRule.style.width = width + 'px';\r\n\t\t}\r\n\t\treturn found;\r\n\t},\r\n\r\n\t_changeColWidth: function(index, deltaW) {\r\n\t\tvar Z = this,\r\n\t\t\tcolObj = Z.innerColumns[index];\r\n\t\tif (colObj.width + deltaW <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolObj.width += deltaW;\r\n\t\tif(colObj.field) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.getField(colObj.field).displayWidth(Math.round(colObj.width/Z.charWidth));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._changeColWidthCssRule(colObj.widthCssName, colObj.width)) {\r\n\t\t\tZ._changeContentWidth(deltaW);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshSeqColWidth: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._hasSeqCol) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldSeqColWidth = Z.seqColWidth;\r\n\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth;\r\n\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\tif(Z.seqColWidth == oldSeqColWidth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\tif(colObj.isSeqCol) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcolObj.width = Z.seqColWidth;\r\n\t\tZ._changeColWidthCssRule(colObj.widthCssName, Z.seqColWidth);\r\n\t\tvar deltaW = Z.seqColWidth - oldSeqColWidth;\r\n\t\tZ._changeContentWidth(deltaW, true);\r\n\t},\r\n\r\n\t_changeContentWidth: function(deltaW, isLeft) {\r\n\t\tvar Z = this,\r\n\t\t\ttotalWidth = Z.getTotalWidth(isLeft),\r\n\t\t\ttotalWidthStr = totalWidth + 'px';\r\n\t\tif(!isLeft) {\r\n\t\t\tZ.rightHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ.rightFootTbl.style.width = totalWidthStr;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = totalWidth;\r\n\t\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 1 + 'px';\r\n\t\t\tZ.leftHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t}\r\n\t\tZ._checkHoriOverflow();\r\n\t},\r\n\r\n\t_createFrame: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.el.style.position = 'relative';\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-table')) {\r\n\t\t\tjqEl.addClass('jl-table jl-border-box jl-round5');\r\n\t\t}\r\n\t\tif(Z._noborder) {\r\n\t\t\tjqEl.addClass('jl-tbl-noborder');\r\n\t\t}\r\n\t\t\r\n\t\tfunction generateWidthStyle() {\r\n\t\t\tvar colObj, cssName, i, len,\r\n\t\t\t\tstyleHtml = ['<style type=\"text/css\" id=\"' + Z._widthStyleId + '\">\\n'];\r\n\t\t\tfor(i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tfor(i = 0, len = Z.innerColumns.length; i< len; i++) {\r\n\t\t\t\tcolObj = Z.innerColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tstyleHtml.push('</style>');\r\n\t\t\treturn styleHtml.join('');\r\n\t\t}\r\n\t\t\r\n\t\tvar dbtableframe = [\r\n\t\t\t'<div class=\"jl-tbl-splitter\" style=\"display: none\"></div>',\r\n\t\t\tgenerateWidthStyle(),\r\n\t\t\t'<div class=\"jl-tbl-norecord\">',\r\n\t\t\tjsletlocale.DBTable.norecord,\r\n\t\t\t'</div>',\r\n\t\t\t'<table class=\"jl-tbl-container\"><tr>',\r\n\t\t\t'<td><div class=\"jl-tbl-fixedcol\"><table class=\"jl-tbl-data\"><tbody /></table><table class=\"jl-tbl-data\"><tbody /></table><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data\"><tbody /></table><table><tbody /></table></div></div></td>',\r\n\t\t\t'<td><div class=\"jl-tbl-contentcol\"><div><table class=\"jl-tbl-data jl-tbl-content-table\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody /></table></div><div><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table></div><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table><table class=\"jl-tbl-content-table jl-tbl-footer\"><tbody /></table></div></div></td>',\r\n\t\t\t'<td class=\"jl-scrollbar-col\"><div class=\"jl-tbl-vscroll-head\"></div><div class=\"jl-tbl-vscroll\"><div /></div></td></tr></table>'];\r\n\t\t\r\n\t\tjqEl.html(dbtableframe.join(''));\r\n\r\n\t\tvar children = jqEl.find('.jl-tbl-fixedcol')[0].childNodes;\r\n\t\tZ.leftHeadTbl = children[0];\r\n\t\tZ.leftFixedTbl = children[1];\r\n\t\tZ.leftContentTbl = children[2].firstChild;\r\n\t\tZ.leftFootTbl = children[2].children[1];\r\n\t\t\r\n\t\tchildren = jqEl.find('.jl-tbl-contentcol')[0].childNodes;\r\n\t\tZ.rightHeadTbl = children[0].firstChild;\r\n\t\tZ.rightFixedTbl = children[1].firstChild;\r\n\t\tZ.rightContentTbl = children[2].firstChild;\r\n\t\tZ.rightFootTbl = children[2].children[1];\r\n\r\n\t\tZ.height = jqEl.height();\r\n\t\tif(Z.height <= 1 && !Z._autoStretch) {\r\n\t\t\tZ.height = 200;\r\n\t\t\tjqEl.height(200);\r\n\t\t}\r\n\t\tif (Z._hideHead) {\r\n\t\t\tZ.leftHeadTbl.style.display = 'none';\r\n\t\t\tZ.rightHeadTbl.style.display = 'none';\r\n\t\t\tjqEl.find('.jl-tbl-vscroll-head').css('display', 'none');\r\n\t\t}\r\n\t\tif (Z._fixedRows <= 0) {\r\n\t\t\tZ.leftFixedTbl.style.display = 'none';\r\n\t\t\tZ.rightFixedTbl.style.display = 'none';\r\n\t\t}\r\n\t\tif (!Z.footSectionHt) {\r\n\t\t\tZ.leftFootTbl.style.display = 'none';\r\n\t\t\tZ.rightFootTbl.style.display = 'none';\r\n\t\t}\r\n\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 'px';\r\n\t\t\r\n\t\tvar jqRightHead = jQuery(Z.rightHeadTbl);\r\n\t\tjqRightHead.off();\r\n\t\tvar x = jqRightHead.on('mousedown', Z._doSplitHookDown);\r\n\t\tvar y = jqRightHead.on('mouseup', Z._doSplitHookUp);\r\n\t\t\r\n\t\tjQuery(Z.leftHeadTbl).on('mousedown', '.jl-tbl-header-cell', function(event) {\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mousedown', '.jl-tbl-header-cell', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjQuery(Z.leftHeadTbl).on('mouseup', '.jl-focusable-item', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mouseup', '.jl-focusable-item', function(event) {\r\n\t\t\tif(event.button) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tvar dragTransfer = null;\r\n\t\tjqRightHead.on('dragstart', '.jl-focusable-item', function(event) {\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode.parentNode.parentNode,\r\n\t\t\t\tcolCfg = otd.jsletColCfg,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\ttransfer.effectAllowed = 'link';\r\n\t\t\tdragTransfer = {fieldName: colCfg.field, rowIndex: otd.parentNode.rowIndex, cellIndex: otd.cellIndex};\r\n\t\t\ttransfer.setData('fieldName', colCfg.field); //must has this row otherwise FF does not work.\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction checkDropable(currCell) {\r\n\t\t\tvar colCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\tvar result = (srcRowIndex == currRowIndex && currCellIndex != srcCellIndex);\r\n\t\t\tif(!result) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\tvar\tsrcFldName = dragTransfer.fieldName,\r\n\t\t\t\tcurrFldName = colCfg.field,\r\n\t\t\t\tsrcPFldObj = Z._dataset.getField(srcFldName).parent(),\r\n\t\t\t\tcurrPFldObj = currFldName && Z._dataset.getField(currFldName).parent();\r\n\t\t\tresult = (srcPFldObj === currPFldObj || (currPFldObj && srcPFldObj.name() == currPFldObj.name()));\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t\r\n\t\tjqRightHead.on('dragover', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\r\n\t\tjqRightHead.on('dragenter', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('dragleave', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\treturn  false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('drop', '.jl-tbl-header-cell .jl-tbl-header-div', function(event) {\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\tvar currCell = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer,\r\n\t\t\t\tcolCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\t\r\n\t\t\tif(!checkDropable(currCell)) { \r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar destField = this.parentNode.jsletColCfg.field;\r\n\t\t\tif(!destField) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar\tsrcField = dragTransfer.fieldName;\r\n\t\t\tZ._moveColumn(srcRowIndex, srcCellIndex, currCellIndex);\r\n\t    \treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tvar jqLeftFixedTbl = jQuery(Z.leftFixedTbl),\r\n\t\t\tjqRightFixedTbl = jQuery(Z.rightFixedTbl),\r\n\t\t\tjqLeftContentTbl = jQuery(Z.leftContentTbl),\r\n\t\t\tjqRightContentTbl = jQuery(Z.rightContentTbl);\r\n\t\t\r\n\t\tjqLeftFixedTbl.off();\r\n\t\tjqLeftFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\r\n\t\tjqRightFixedTbl.off();\r\n\t\tjqRightFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqRightFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqLeftContentTbl.off();\r\n\t\tjqLeftContentTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftContentTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqRightContentTbl.off();\r\n\t\tjqRightContentTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqRightContentTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tZ.jqVScrollBar = jqEl.find('.jl-tbl-vscroll');\r\n\t\t//The scrollbar width must be set explicitly, otherwise it doesn't work in IE. \r\n\t\tZ.jqVScrollBar.width(jslet.ui.scrollbarSize() + 1);\r\n\t\t\r\n\t\tZ.jqVScrollBar.off().on('scroll', function() {\r\n\t\t\tif (Z._keep_silence_) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._editable && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n\t\t\tvar num = Math.round(this.scrollTop / Z.rowHeight());// + Z._fixedRows;\r\n\t\t\tif (num != Z.listvm.getVisibleStartRow()) {\r\n\t\t\t\tZ._keep_silence_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(num);\r\n\t\t\t\t\tZ._showCurrentRow();\r\n\t\t\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\t\t\tif(cellEditor) {\r\n\t\t\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\tjqEl.find('.jl-tbl-contentcol').off().on('scroll', function() {\r\n\t\t\tif(Z._isCurrCellInView()) {\r\n\t\t\t\t//Avoid focusing the current control\r\n\t\t\t\tjslet.temp.focusing = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ._showCurrentCell();\r\n\t\t\t\t\t\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tjslet.temp.focusing = false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t        \tvar cellEditor = Z.cellEditor();\r\n\t        \tif(cellEditor) {\r\n\t       \t\t\tcellEditor.hideEditor();\r\n\t        \t}\r\n\t\t\t}\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tsplitter._doDragStart = function() {\r\n\t\t\tthis.style.display = 'block';\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.hide();\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tsplitter._doDragging = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar bodyMleft = parseInt(jQuery(document.body).css('margin-left'));\r\n\r\n\t\t\tvar ojslet = splitter.parentNode.jslet;\r\n\t\t\tvar colObj = ojslet.innerColumns[ojslet.currColId];\r\n\t\t\tif (colObj.width + deltaX <= 40) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsplitter.style.left = x - jQuery(splitter.parentNode).offset().left - bodyMleft + 'px';\r\n\t\t};\r\n\r\n\t\tsplitter._doDragEnd = function(oldX, oldY, x, y, deltaX,\r\n\t\t\tdeltaY) {\r\n\t\t\tvar Z = splitter.parentNode.jslet;\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tcellEditor.hideEditor();\r\n\t\t\t}\r\n\t\t\tZ._changeColWidth(Z.currColId, deltaX);\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n//\t\t\tif(cellEditor) {\r\n//\t\t\t\tcellEditor.showEditor();\r\n//\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tsplitter._doDragCancel = function() {\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n\t\t};\r\n\r\n\t\tif (Z.footSectionHt) {\r\n\t\t\tZ.leftFootTbl.style.display = '';\r\n\t\t\tZ.rightFootTbl.style.display = '';\r\n\t\t}\r\n\t\tZ._renderHeader();\r\n\t\tif (Z._hideHead) {\r\n\t\t\tZ.headSectionHt = 0;\r\n\t\t} else {\r\n\t\t\tZ.headSectionHt = Z.maxHeadRows * Z.headRowHeight();\r\n\t\t}\r\n\t\tZ._changeContentWidth(0);\r\n\r\n\t\tZ.noRecordDiv = jqEl.find('.jl-tbl-norecord')[0];\r\n\t\tZ.noRecordDiv.style.top = Z.headSectionHt + 'px';\r\n\t\tZ.noRecordDiv.style.left = jqEl.find('.jl-tbl-fixedcol').width() + 5 + 'px';\r\n\t\tjqEl.find('.jl-tbl-vscroll-head').height(Z.headSectionHt + Z.fixedSectionHt);\r\n\t\tZ._renderBody();\r\n\t},\r\n\r\n\t_moveColumn: function(rowIndex, srcCellIndex, destCellIndex) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction moveOneRow(cells, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar cobj, \r\n\t\t\t\tcolNo = 0, \r\n\t\t\t\tsrcCells = [],\r\n\t\t\t\tdestCells = [], i, len;\r\n\t\t\t\r\n\t\t\tfor(i = 0, len = cells.length; i < len; i++) {\r\n\t\t\t\tcobj = cells[i];\r\n\t\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\t\tdestCells.push(cobj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t\t}\r\n\t\t\tvar destCell;\r\n\t\t\tif(srcStart > destStart) {\t\r\n\t\t\t\tdestCell = destCells[0];\r\n\t\t\t\tfor(i = 0, len = srcCells.length; i < len; i++) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertBefore(destCell);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdestCell = destCells[destCells.length - 1];\r\n\t\t\t\tfor(i = srcCells.length; i >= 0; i--) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertAfter(destCell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction moveOneTableColumn(rows, rowIndex, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar rowCnt = rows.length;\r\n\t\t\tif(rowCnt === 0 || rowCnt === rowIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar rowObj, cellCnt;\r\n\t\t\tfor(var i = rowIndex, len = rows.length; i < len; i++) {\r\n\t\t\t\trowObj = rows[i];\r\n\t\t\t\tmoveOneRow(rowObj.cells, srcStart, srcEnd, destStart, destEnd);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar rows = Z.rightHeadTbl.createTHead().rows, cobj,\r\n\t\t\trowObj = rows[rowIndex],\r\n\t\t\tsrcStart = 0,\r\n\t\t\tsrcEnd = 0,\r\n\t\t\tdestStart = 0,\r\n\t\t\tdestEnd = 0, \r\n\t\t\tpreColNo = 0,\r\n\t\t\tcolNo = 0;\r\n\t\t\r\n\t\tfor(var i = 0, len = rowObj.cells.length; i < len; i++) {\r\n\t\t\tcobj = rowObj.cells[i];\r\n\t\t\tpreColNo = colNo; \r\n\t\t\tcolNo += (cobj.colSpan || 1);\r\n\t\t\tif(i === srcCellIndex) {\r\n\t\t\t\tsrcStart = preColNo;\r\n\t\t\t\tsrcEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t\tif(i === destCellIndex) {\r\n\t\t\t\tdestStart = preColNo;\r\n\t\t\t\tdestEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar srcCell = rowObj.cells[srcCellIndex],\r\n\t\t\tdestCell = rowObj.cells[destCellIndex];\r\n\t\tvar srcColCfg = srcCell.jsletColCfg,\r\n\t\t\tdestColCfg = destCell.jsletColCfg,\r\n\t\t\tsrcFldName = srcColCfg.field,\r\n\t\t\tdestFldName = destColCfg.field;\r\n\t\tif(srcFldName && destFldName) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.moveField(srcFldName, destFldName);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar currField = Z.getFieldByColNum(Z._currColNum);\r\n\t\tvar dataRows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tZ._changeColNum(dataRows[0], srcStart, srcEnd, destStart, destEnd);\r\n\t\tvar headRows = Z.rightHeadTbl.createTHead().rows;\r\n\t\tmoveOneTableColumn(headRows, rowIndex, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFixedTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(dataRows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFootTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tZ._dataset.selection.removeAll();\r\n\t\tZ._refreshSelection();\r\n    \tZ.gotoField(currField);\r\n\t},\r\n\t\r\n\t_changeColNum: function(rowObj, srcStart, srcEnd, destStart, destEnd) {\r\n\t\tif(!rowObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar cobj, \r\n\t\t\tcolNo = 0, \r\n\t\t\tsrcCells = [],\r\n\t\t\tdestCells = [],\r\n\t\t\tcells = rowObj.cells, i, len;\r\n\t\t\r\n\t\tfor(i = 0, len = cells.length; i < len; i++) {\r\n\t\t\tcobj = cells[i];\r\n\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\tdestCells.push(cobj);\r\n\t\t\t} else {\r\n\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t}\r\n\t\tvar srcCellLen = srcCells.length,\r\n\t\t\tdestCellLen = destCells.length,\r\n\t\t\tfirstDestColNum= destCells[0].jsletColCfg.colNum,\r\n\t\t\tk = 0, colCfg;\r\n\t\tif(srcStart > destStart) {\r\n\t\t\tfor(i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = firstDestColNum + (k++);\r\n\t\t\t}\r\n\t\t\tfor(i = destStart; i < srcStart; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum + srcCellLen;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar newStart = firstDestColNum - srcCellLen + destCellLen;\r\n\t\t\tfor(i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = newStart + (k++);\r\n\t\t\t}\r\n\t\t\tfor(i = srcEnd + 1; i <= destEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum - srcCellLen;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t_calcAndSetContentHeight: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\r\n\t\tvar rh = Z.rowHeight(), rows;\r\n\t\tif(Z._autoStretch) {\r\n\t\t\trows = Z._dataset.recordCount() - Z._fixedRows;\r\n\t\t\tif(Z._oldVisibleRows === rows) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._maxVisibleRows > 0 && rows > Z._maxVisibleRows) {\r\n\t\t\t\trows = Z._maxVisibleRows;\r\n\t\t\t}\r\n\t\t\tif(rows < Z._minVisibleRows) {\r\n\t\t\t\trows = Z._minVisibleRows;\r\n\t\t\t}\r\n\t\t\tZ.contentSectionHt = rh * rows + Z.footSectionHt;\r\n\t\t\tZ._repairHeight = 0;\r\n\t\t\tZ._oldVisibleRows = rows;\r\n\t\t\tZ.listvm.setVisibleCount(rows, true);\r\n\t\t} else {\r\n\t\t\tZ.contentSectionHt = Z.height - Z.headSectionHt - Z.fixedSectionHt;\r\n\t\t\tif (Z._isHoriOverflow) {\r\n\t\t\t\tZ.contentSectionHt -= jslet.ui.htmlclass.TABLECLASS.scrollBarWidth;\r\n\t\t\t}\r\n\t\t\trows = Math.floor((Z.contentSectionHt - Z.footSectionHt) / rh);\r\n\t\t\tZ.listvm.setVisibleCount(rows, true);\r\n\t\t\tZ._repairHeight = Z.contentSectionHt - rows * rh;\r\n\t\t}\r\n\t\t\r\n\t\t//jqEl.find('.jl-tbl-contentcol').height(Z.height);\r\n\t\tjqEl.find('.jl-tbl-content-div').height(Z.contentSectionHt);\r\n\r\n\t\tZ.jqVScrollBar.height(Z.contentSectionHt);\r\n\t\tZ._setScrollBarMaxValue(Z.listvm.getNeedShowRowCount() * rh);\r\n\t},\r\n\t\r\n\t_stretchContentHeight: function() {\r\n\t\tif(!this._autoStretch) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._calcAndSetContentHeight();\r\n\t\tthis._stretchContentRow();\r\n\t},\r\n\r\n\t_checkHoriOverflow: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcontentWidth = Z.getTotalWidth();\r\n\r\n\t\tif(Z._hideHead) {\r\n\t\t\tZ._isHoriOverflow = contentWidth > jQuery(Z.rightContentTbl.parentNode.parentNode).innerWidth();\r\n\t\t} else {\r\n\t\t\tZ._isHoriOverflow = contentWidth > Z.rightHeadTbl.parentNode.parentNode.clientWidth;\r\n\t\t}\r\n\t\tZ._calcAndSetContentHeight();\r\n\t},\r\n\t\r\n\t_refreshHeadCell: function(fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), oth = null, cobj;\r\n\t\tjqEl.find('.jl-tbl-header-cell').each(function(index, value) {\r\n\t\t\tcobj = this.jsletColCfg;\r\n\t\t\tif(cobj && cobj.field == fldName) {\r\n\t\t\t\toth = this;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!oth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\tcobj.label = fldObj.displayLabel();\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tochild.html('');\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field && Z._isCellEditable(cobj)) {\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tjQuery(oth).find('.jl-focusable-item').html(sh);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeadCell: function(otr, cobj) {\r\n\t\tvar Z = this,\r\n\t\t\trowSpan = 0, colSpan = 0;\r\n\t\t\r\n\t\tif (!cobj.subHeads) {\r\n\t\t\trowSpan = Z.maxHeadRows - (cobj.level ? cobj.level: 0);\r\n\t\t} else {\r\n\t\t\tcolSpan = cobj.colSpan;\r\n\t\t}\r\n\t\tvar oth = document.createElement('th');\r\n\t\toth.className = 'jl-tbl-header-cell jl-unselectable';\r\n\t\toth.noWrap = true;\r\n\t\toth.jsletColCfg = cobj;\r\n\t\tif (rowSpan && rowSpan > 1) {\r\n\t\t\toth.rowSpan = rowSpan;\r\n\t\t}\r\n\t\tif (colSpan && colSpan > 1) {\r\n\t\t\toth.colSpan = colSpan;\r\n\t\t}\r\n\t\toth.innerHTML = '<div style=\"position: relative\" unselectable=\"on\" class=\"jl-unselectable jl-tbl-header-div jl-border-box ' + \r\n\t\t\t(cobj.widthCssName || '') +'\">';\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tochild.innerHTML = [\r\n\t\t\t    Z._hasFilterDialog && cobj.field && !cobj.subHeads && !cobj.disableFilter? '<button class=\"jl-tbl-filter\" jsletfilterfield=\"' + cobj.field + \r\n\t\t\t    \t\t'\"><i class=\"fa fa-filter\"></i></button>': '',\r\n\t\t\t    '<span id=\"',\r\n\t\t\t\tcobj.id, \r\n\t\t\t\t'\" unselectable=\"on\" style=\"width:100%;padding:0px 2px\">',\r\n\t\t\t\t((!Z._disableHeadSort && !cobj.disableHeadSort) ? '<span class=\"jl-focusable-item\" draggable=\"true\">' + sh +'</span>': sh),\r\n\t\t\t\t'</span><span unselectable=\"on\" class=\"jl-tbl-sorter\" title=\"',\r\n\t\t\t\tjsletlocale.DBTable.sorttitle,\r\n\t\t\t\t'\">&nbsp;</span><div  unselectable=\"on\" class=\"jl-tbl-splitter-hook\" colid=\"',\r\n\t\t\t\tcobj.colNum,\r\n\t\t\t\t'\">&nbsp;</div>'].join('');\r\n\t\t}\r\n\t\totr.appendChild(oth);\t\r\n\t}, // end _createHeadCell\r\n\r\n\t_renderHeader: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar otr, otrLeft = null, cobj, otrRight, otd, oth, i, cnt,\r\n\t\t\tleftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead();\r\n\t\tfor(i = 0; i < Z.maxHeadRows; i++) {\r\n\t\t\tleftHeadObj.insertRow(-1);\r\n\t\t\trightHeadObj.insertRow(-1);\r\n\t\t}\r\n\t\totr = leftHeadObj.rows[0];\r\n\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\tcobj = Z._sysColumns[i];\r\n\t\t\tcobj.rowSpan = Z.maxHeadRows;\r\n\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t}\r\n\t\tfunction travHead(arrHeadCfg) {\r\n\t\t\tvar cobj, otr;\r\n\t\t\tfor(var m = 0, ccnt = arrHeadCfg.length; m < ccnt; m++) {\r\n\t\t\t\tcobj = arrHeadCfg[m];\r\n\t\t\t\tif (cobj.colNum < Z._fixedCols) {\r\n\t\t\t\t\totr = leftHeadObj.rows[cobj.level];\r\n\t\t\t\t} else {\r\n\t\t\t\t\totr = rightHeadObj.rows[cobj.level];\r\n\t\t\t\t}\r\n\t\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t\t\tif (cobj.subHeads) {\r\n\t\t\t\t\ttravHead(cobj.subHeads);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttravHead(Z.innerHeads);\r\n\t\tvar jqTr1, jqTr2, h= Z.headRowHeight();\r\n\t\tfor(i = 0; i <= Z.maxHeadRows; i++) {\r\n\t\t\tjqTr1 = jQuery(leftHeadObj.rows[i]);\r\n\t\t\tjqTr2 = jQuery(rightHeadObj.rows[i]);\r\n\t\t\tjqTr1.height(h);\r\n\t\t\tjqTr2.height(h);\r\n\t\t}\r\n\t\tZ.sortedCell = null;\r\n\t\tZ.indexField = null;\r\n\t}, // end renderHead\r\n\r\n\tgetTotalWidth: function(isLeft) {\r\n\t\tvar Z= this,\r\n\t\t\ttotalWidth = 0, i, cnt;\r\n\t\tif(!isLeft) {\r\n\t\t\tfor(i = Z._fixedCols, cnt = Z.innerColumns.length; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i = 0, cnt = Z._sysColumns.length; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z._sysColumns[i].width;\r\n\t\t\t}\r\n\t\t\tfor(i = 0, cnt = Z._fixedCols; i < cnt; i++) {\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\r\n\t_doSplitHookDown: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target;\r\n\t\tif (ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function(el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\t\tvar jqTblContainer = jQuery(tblContainer),\r\n\t\t\tjqBody = jQuery(document.body), \r\n\t\t\tbodyMTop = parseInt(jqBody.css('margin-top')),\r\n\t\t\tbodyMleft = parseInt(jqBody.css('margin-left')),\r\n\t\t\ty = jqTblContainer.position().top - bodyMTop,\r\n\t\t\tjqHook = jQuery(ohook),\r\n\t\t\th = jqTblContainer.height() - 20,\r\n\t\t\tcurrLeft = jqHook.offset().left - jqTblContainer.offset().left - bodyMleft,\r\n\t\t\tsplitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tsplitDiv.style.left = currLeft + 'px';\r\n\t\tsplitDiv.style.top = '1px';\r\n\t\tsplitDiv.style.height = h + 'px';\r\n\t\tjslet.ui.dnd.bindControl(splitDiv);\r\n\t\ttblContainer.jslet.currColId = parseInt(jqHook.attr('colid'));\r\n\t\ttblContainer.jslet.isDraggingColumn = true;\r\n\t},\r\n\r\n\t_doSplitHookUp: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target.lastChild;\r\n\t\tif (!ohook || ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function(el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\r\n\t\tvar jqTblContainer = jQuery(tblContainer),\r\n\t\t\tjqBody = jQuery(document.body); \r\n\t\tjqBody.css('cursor','auto');\r\n\r\n\t\tvar splitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tif (splitDiv.style.display != 'none') {\r\n\t\t\tsplitDiv.style.display = 'none';\r\n\t\t}\r\n\t\ttblContainer.jslet.isDraggingColumn = false;\r\n\t},\r\n\r\n\t_getColumnByField: function(fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.innerColumns) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar cobj;\r\n\t\tfor (var i = 0, cnt = Z.innerColumns.length; i < cnt; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\t\t\tif (cobj.field == fieldName) {\r\n\t\t\t\treturn cobj;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_doHeadClick: function(colCfg, ctrlKeyPressed) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._disableHeadSort || colCfg.disableHeadSort || Z.isDraggingColumn) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._doSort(colCfg.field, ctrlKeyPressed);\r\n\t}, // end _doHeadClick\r\n\r\n\t_doSort: function(sortField, isMultiSort) {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.confirm();\r\n\t\tZ._dataset.disableControls();\r\n\t\ttry {\r\n\t\t\tZ._dataset.toggleIndexField(sortField, !isMultiSort);\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t} finally {\r\n\t\t\tZ._dataset.enableControls();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateSortFlag: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar sortFields = Z._dataset.mergedIndexFields();\r\n\t\t\r\n\t\tvar leftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead(),\r\n\t\t\tleftHeadCells, rightHeadCells,\r\n\t\t\tallHeadCells = [], oth, i, cnt, r,\r\n\t\t\trowCnt = leftHeadObj.rows.length;\r\n\t\tfor(r = 0; r < rowCnt; r++) {\r\n\t\t\tleftHeadCells = leftHeadObj.rows[r].cells;\r\n\t\t\tfor (i = 0, cnt = leftHeadCells.length; i < cnt; i++) {\r\n\t\t\t\toth = leftHeadCells[i];\r\n\t\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(r = 0; r < rowCnt; r++) {\r\n\t\t\trightHeadCells =  rightHeadObj.rows[r].cells;\r\n\t\t\tfor (i = 0, cnt = rightHeadCells.length; i < cnt; i++) {\r\n\t\t\t\toth = rightHeadCells[i];\r\n\t\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sortDiv, \r\n\t\t\tcellCnt = allHeadCells.length;\r\n\t\tfor (i = 0; i < cellCnt; i++) {\r\n\t\t\toth = allHeadCells[i];\r\n\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\tif (sortDiv) {\r\n\t\t\t\tsortDiv.innerHTML = '&nbsp;';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, sortFlag, sortObj, \r\n\t\t\tk = 1,\r\n\t\t\tlen = sortFields.length;\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tsortObj = sortFields[i];\r\n\t\t\tfor (var j = 0; j < cellCnt; j++) {\r\n\t\t\t\toth = allHeadCells[j];\r\n\t\t\t\tfldName = oth.jsletColCfg.field;\r\n\t\t\t\tif (!fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\t\tsortFlag = '&nbsp;';\r\n\t\t\t\tif (fldName == sortObj.fieldName) {\r\n\t\t\t\t\tsortFlag = sortObj.order === 1 ? '<i class=\"fa fa-arrow-up\"></i>' : '<i class=\"fa fa-arrow-down\"></i>';\r\n\t\t\t\t\tif (len > 1) {\r\n\t\t\t\t\t\tsortFlag += k++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsortDiv.innerHTML = sortFlag;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_doSelectBoxClick: function(event) {\r\n\t\tvar ocheck = null;\r\n\t\tif (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tocheck = event.target;\r\n\t\t} else {\r\n\t\t\tocheck = this;\r\n\t\t}\r\n\t\tvar otr = jslet.ui.getParentElement(ocheck, 2);\r\n\t\ttry {\r\n\t\t\tjQuery(otr).click();// tr click\r\n\t\t} finally {\r\n\t\t\tvar otable = jslet.ui.findFirstParent(otr, function(node) {\r\n\t\t\t\treturn node.jslet? true: false;\r\n\t\t\t});\r\n\t\t\tvar oJslet = otable.jslet;\r\n\r\n\t\t\tif (oJslet._onSelect) {\r\n\t\t\t\tvar flag = oJslet._onSelect.call(oJslet, ocheck.checked);\r\n\t\t\t\tif (flag !== undefined && !flag) {\r\n\t\t\t\t\tocheck.checked = !ocheck.checked;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oJslet._beforeSelect) {\r\n\t\t\t\toJslet._beforeSelect.call(oJslet);\r\n\t\t\t}\r\n\t\t\toJslet._dataset.select(ocheck.checked ? 1 : 0, oJslet._selectBy);\r\n\t\t\toJslet._showCurrentCell();\r\n\t\t\tif(oJslet._afterSelect) {\r\n\t\t\t\toJslet._afterSelect.call(oJslet);\r\n\t\t\t}\r\n\t\t}\r\n\t}, // end _doSelectBoxClick\r\n\r\n\t_getTableRow: function(otd, offsetTop) {\r\n\t\tvar otr = otd.parentElement,\r\n\t\t\trowSpan = otd.rowSpan;\r\n\t\tif(rowSpan < 2) {\r\n\t\t\treturn otr;\r\n\t\t}\r\n\t\tvar currIdx = otr.rowIndex;\r\n\t\tvar rows = otr.parentElement.rows;\r\n\t\tvar height = 0;\r\n\t\tfor(var i = currIdx; i < currIdx + rowSpan; i++) {\r\n\t\t\totr = rows[i];\r\n\t\t\theight += otr.offsetHeight;\r\n\t\t\tif(height >= offsetTop) {\r\n\t\t\t\treturn otr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn otr;\r\n\t},\r\n\t\r\n\t_doCellClick: function(otd, offsetTop, event) {\r\n\t\tvar Z = this;\r\n    \tvar colCfg = otd.jsletColCfg;\r\n    \tif(!colCfg) {\r\n    \t\treturn;\r\n    \t}\r\n    \tZ._doRowClick(Z._getTableRow(otd, offsetTop));\r\n\t\tif(colCfg.isSeqCol) { //If the cell is sequence cell, process row selection.\r\n\t\t\tZ._processRowSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t} else {\r\n    \t\tvar colNum = colCfg.colNum;\r\n    \t\tif(colNum !== 0 && !colNum) {\r\n    \t\t\treturn;\r\n    \t\t}\r\n\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n    \t\tZ.currColNum(colNum);\r\n\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t    \tvar cellEditor = Z.cellEditor();\r\n\t    \tif(cellEditor) {\r\n\t    \t\tif(Z._isCellEditable(colCfg)) {\r\n\t    \t\t\tvar fldName = colCfg.field;\r\n\t    \t\t\tcellEditor.showEditor(fldName, otd);\r\n\t    \t\t\tif(colCfg.isBoolColumn) {\r\n\t    \t\t\t\twindow.setTimeout(function() {\r\n\t        \t\t\t\tZ._dataset.setFieldValue(fldName, !Z._dataset.getFieldValue(fldName));\r\n\t    \t\t\t\t}, 5);\r\n\t    \t\t\t}\r\n\t    \t\t} else {\r\n\t    \t\t\tcellEditor.hideEditor();\r\n\t    \t\t}\r\n\t    \t}\r\n\t\t}\r\n\t\tif (Z._onCellClick) {\r\n\t\t\tZ._onCellClick.call(Z, otd);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDblCellClick: function(otd, offsetTop) {\r\n    \tthis._doRowDblClick(this._getTableRow(otd, offsetTop));\r\n\t},\r\n\r\n\t_doRowDblClick: function(otr) {\r\n\t\tif(!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._onRowDblClick) {\r\n\t\t\tthis._onRowDblClick.call(this, otr);\r\n\t\t}\r\n\t},\r\n\r\n\t_doRowClick: function(otr) {\r\n\t\tif(!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z.dataset(),\r\n\t\t\totrRecno = otr.jsletrecno; \r\n\t\tif(otrRecno !== dsObj.recno()) {\r\n\t\t\tif(dsObj.status()) {\r\n\t\t\t\tvar focusedEle = document.activeElement;\r\n\t\t\t\tif(focusedEle) {\r\n\t\t\t\t\tZ.el.focus();\r\n\t\t\t\t\tfocusedEle.focus();\r\n\t\t\t\t}\r\n\t\t\t\tdsObj.confirm();\r\n\t\t\t}\r\n\t\r\n\t\t\tvar rowno = Z.listvm.recnoToRowno(otrRecno);\r\n\t\t\tZ.listvm.setCurrentRowno(rowno);\r\n\t\t\tdsObj.recno(Z.listvm.getCurrentRecno());\r\n\t\t}\r\n\t\tif (Z._onRowClick) {\r\n\t\t\tZ._onRowClick.call(Z, otr);\r\n\t\t}\r\n\t},\r\n\r\n\t_renderCell: function(otr, colCfg, isFirstCol) {\r\n\t\tvar Z = this;\r\n\t\tvar otd = document.createElement('td');\r\n\t\totd.noWrap = true;\r\n\t\totd.jsletColCfg = colCfg;\r\n\t\tjQuery(otd).addClass('jl-tbl-cell');\r\n\t\totd.innerHTML = '<div class=\"jl-tbl-cell-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\tvar ochild = otd.firstChild;\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createCell) {\r\n\t\t\tcellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t} else if (!Z._isCellEditable(colCfg)) {\r\n\t\t\t\tjslet.ui.table.cellRenders.defaultCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\t\tcolCfg.editable = false;\r\n\t\t} else {\r\n\t\t\tjslet.ui.table.cellRenders.defaultCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\tcolCfg.editable = true;\r\n\t\t}\r\n\t\totr.appendChild(otd);\r\n\t},\r\n\r\n\t_renderRow: function(sectionNum, onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tvar rowCnt = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\tswitch (sectionNum) {\r\n\t\t\tcase 1:\r\n\t\t\t\t{//fixed data\r\n\t\t\t\t\trowCnt = Z._fixedRows;\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\tcase 2:\r\n\t\t\t\t{//data content\r\n\t\t\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tvar otr, oth, colCfg, isfirstCol, \r\n\t\t\tstartRow = 0, j,\r\n\t\t\tfldCnt = Z.innerColumns.length;\r\n\t\tif (onlyRefreshContent) {\r\n\t\t\tstartRow = rightBody.rows.length;\r\n\t\t}\r\n\t\tvar rh = Z.rowHeight();\r\n\t\t// create date content table row\r\n\t\tfor (var i = startRow; i < rowCnt; i++) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\t\totr.style.height = rh + 'px';\r\n\r\n\t\t\t\tvar sysColLen = Z._sysColumns.length;\r\n\t\t\t\tfor(j = 0; j < sysColLen; j++) {\r\n\t\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, j === 0);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tisfirstCol = sysColLen === 0;\r\n\t\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, isfirstCol && j === 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisfirstCol = !hasLeft;\r\n\t\t\totr = rightBody.insertRow(-1);\r\n\t\t\totr.style.height = rh + 'px';\r\n\t\t\tfor (j = Z._fixedCols; j < fldCnt; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\tZ._renderCell(otr, colCfg, j == Z._fixedCols);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_stretchContentRow: function() {\r\n\t\tvar Z = this;\r\n\t\tvar visibleRowCnt = Z.listvm.getVisibleCount() - Z._fixedRows, \r\n\t\t\tleftBody = null, leftRows = null,\r\n\t\t\trightBody, rightRows,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\r\n\t\tif (hasLeft) {\r\n\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\tleftRows = leftBody.rows;\r\n\t\t}\r\n\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\trightRows = rightBody.rows;\r\n\t\tvar i, oldRowCount = rightRows.length;\r\n\t\t//Hide the extra rows\r\n\t\tfor(i = visibleRowCnt; i < oldRowCount; i++) {\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tleftRows[i].style.display = 'none';\r\n\t\t\t}\r\n\t\t\trightRows[i].style.display = 'none';\r\n\t\t}\r\n\t\t\r\n\t\tvar otr, colCfg, isfirstCol, j,\r\n\t\t\tfldCnt = Z.innerColumns.length,\r\n\t\t\trh = Z.rowHeight();\r\n\t\t// create date content table row\r\n\t\tfor (i = 0; i < visibleRowCnt; i++) {\r\n\t\t\tif (i < oldRowCount) {\r\n\t\t\t\tif(hasLeft) {\r\n\t\t\t\t\tleftRows[i].style.display = 'table-row';\r\n\t\t\t\t}\r\n\t\t\t\trightRows[i].style.display = 'table-row';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\t\totr.style.height = rh + 'px';\r\n\r\n\t\t\t\tvar sysColLen = Z._sysColumns.length;\r\n\t\t\t\tfor(j = 0; j < sysColLen; j++) {\r\n\t\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, j === 0);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tisfirstCol = sysColLen === 0;\r\n\t\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, isfirstCol && j === 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisfirstCol = !hasLeft;\r\n\t\t\totr = rightBody.insertRow(-1);\r\n\t\t\totr.style.height = rh + 'px';\r\n\t\t\tfor (j = Z._fixedCols; j < fldCnt; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\tZ._renderCell(otr, colCfg, j == Z._fixedCols);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_renderBody: function(onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tif (onlyRefreshContent) {\r\n\t\t\tZ._renderRow(2, true);\r\n\t\t} else {\r\n\t\t\tZ._renderRow(1);\r\n\t\t\tZ._renderRow(2);\r\n\t\t\tZ._renderTotalSection();\r\n\t\t}\r\n\t}, // end _renderBody\r\n\r\n\t_renderTotalSection: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.footSectionHt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar hasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tleftBody,\r\n\t\t\trightBody,\r\n\t\t\totr, colCfg, j, len;\r\n\t\tif (hasLeft) {\r\n\t\t\tleftBody = Z.leftFootTbl.tBodies[0];\r\n\t\t}\r\n\t\trightBody = Z.rightFootTbl.tBodies[0];\r\n\t\t\r\n\t\tfunction createCell(colCfg) {\r\n\t\t\tvar otd = document.createElement('td');\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.innerHTML = '<div class=\"jl-tbl-footer-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\t\totd.jsletColCfg = colCfg;\r\n\t\t\treturn otd;\r\n\t\t}\r\n\t\t\r\n\t\tif (hasLeft) {\r\n\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\totr.style.height = Z.footerRowHeight() + 'px';\r\n\r\n\t\t\tfor(j = 0, len = Z._sysColumns.length; j < len; j++) {\r\n\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor(j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t}\r\n\t\totr = rightBody.insertRow(-1);\r\n\t\totr.style.height = Z.footerRowHeight() + 'px';\r\n\t\tfor (j = Z._fixedCols, len = Z.innerColumns.length; j < len; j++) {\r\n\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillTotalSection: function() {\r\n\t\tvar Z = this,\r\n\t\t\taggregateValues = Z._dataset.aggregatedValues();\r\n\t\tif (!Z.footSectionHt || !aggregateValues) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar sysColCnt = Z._sysColumns.length,\r\n\t\t\thasLeft = Z._fixedCols > 0 || sysColCnt > 0,\r\n\t\t\totrLeft, otrRight;\r\n\t\tif (hasLeft) {\r\n\t\t\totrLeft = Z.leftFootTbl.tBodies[0].rows[0];\r\n\t\t}\r\n\t\totrRight = Z.rightFootTbl.tBodies[0].rows[0];\r\n\r\n\t\tvar otd, k = 0, fldObj, cobj, fldName, totalValue;\r\n\t\tvar aggregateValueObj,\r\n\t\t\tlabelDisplayed = false,\r\n\t\t\tcanShowLabel = true;\r\n\t\tif(sysColCnt > 0) {\r\n\t\t\totd = otrLeft.cells[sysColCnt - 1];\r\n\t\t\totd.innerHTML = jsletlocale.DBTable.totalLabel;\r\n\t\t\tcanShowLabel = false;\r\n\t\t}\r\n\t\tvar colNum;\r\n\t\tfor (var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\t\t\tcolNum = cobj.colNum;\r\n\t\t\tif (colNum < Z._fixedCols) {\r\n\t\t\t\totd = otrLeft.cells[colNum + sysColCnt];\r\n\t\t\t} else {\r\n\t\t\t\totd = otrRight.cells[colNum - Z._fixedCols];\r\n\t\t\t}\r\n\t\t\totd.style.textAlign = 'right';\r\n\r\n\t\t\tfldName = cobj.field;\r\n\t\t\taggregateValueObj = aggregateValues[fldName];\r\n\t\t\tif (!aggregateValueObj) {\r\n\t\t\t\tif(canShowLabel) {\r\n\t\t\t\t\tvar content;\r\n\t\t\t\t\tif(labelDisplayed) {\r\n\t\t\t\t\t\tcontent = '&nbsp;';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontent = jsletlocale.DBTable.totalLabel;\r\n\t\t\t\t\t\tlabelDisplayed = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\totd.firstChild.innerHTML = content;\r\n\t\t\t\t\totd.firstChild.title = '';\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcanShowLabel = false;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\ttotalValue = aggregateValueObj.sum;\r\n\t\t\t} else {\r\n\t\t\t\ttotalValue = aggregateValueObj.count;\r\n\t\t\t}\r\n\t\t\tif(!totalValue) {\r\n\t\t\t\totd.firstChild.innerHTML = '&nbsp;';\r\n\t\t\t\totd.firstChild.title = '';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar dispFmt = fldObj.displayFormat();\r\n\t\t\tvar displayValue = totalValue;\r\n\t\t\tif(dispFmt && fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\tdisplayValue = totalValue? jslet.formatNumber(totalValue, dispFmt) : '';\r\n\t\t\t}\r\n\t\t\totd.firstChild.innerHTML = displayValue;\r\n\t\t\totd.firstChild.title = displayValue;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillData: function() {\r\n\t\tvar Z = this;\r\n\t\tvar preRecno = Z._dataset.recno(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\th = allCnt * Z.rowHeight();\r\n\t\tZ._setScrollBarMaxValue(h);\r\n\t\tvar noRecord = Z.dataset().recordCount() === 0;\r\n\t\tZ.noRecordDiv.style.display = (noRecord ?'block':'none');\r\n\t\tvar oldRecno = Z._dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tZ._fillRow(true);\r\n\t\t\tZ._fillRow(false);\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ._fillTotalSection();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ._refreshSeqColWidth();\r\n\t\tif(Z._cellEditor && noRecord) {\r\n\t\t\tZ._cellEditor.hideEditor();\r\n\t\t}\r\n\t},\r\n\r\n\t_fillRow: function(isFixed) {\r\n\t\tvar Z = this,\r\n\t\t\trowCnt = 0, start = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\t\t\r\n\t\tif (isFixed) {\r\n\t\t\trowCnt = Z._fixedRows;\r\n\t\t\tstart = -1 * Z._fixedRows;\r\n\t\t\tif (rowCnt === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t} else {\r\n\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\tstart = Z.listvm.getVisibleStartRow();\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t}\r\n\t\t\r\n\t\tvar otr, colCfg, isfirstCol, recNo = -1, cells, clen, otd, j, \r\n\t\t\tfldCnt = Z.innerColumns.length,\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount() - Z.listvm.getVisibleStartRow(),\r\n\t\t\tfixedRows = hasLeft ? leftBody.rows : null,\r\n\t\t\tcontentRows = rightBody.rows,\r\n\t\t\tsameValueNodes = {},\r\n\t\t\tisFirst = true,\r\n\t\t\tactualCnt = Math.min(contentRows.length, rowCnt);\r\n\r\n\t\tfor (var i = 0; i < actualCnt ; i++) {\r\n\t\t\tif (i + (isFixed? start: 0) >= allCnt) {\r\n\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\totr = fixedRows[i];\r\n\t\t\t\t\totr.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\totr = contentRows[i];\r\n\t\t\t\totr.style.display = 'none';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tZ.listvm.setCurrentRowno(i + start, true);\r\n\t\t\trecNo = Z.listvm.getCurrentRecno();\r\n\t\t\tZ._dataset.recnoSilence(recNo);\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = fixedRows[i];\r\n\t\t\t\totr.jsletrecno = recNo;\r\n\t\t\t\totr.style.display = '';\r\n\t\t\t\tif (Z._onFillRow) {\r\n\t\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t\t}\r\n\t\t\t\tcells = otr.childNodes;\r\n\t\t\t\tclen = cells.length;\r\n\t\t\t\tfor (j = 0; j < clen; j++) {\r\n\t\t\t\t\totd = cells[j];\r\n\t\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\totr = contentRows[i];\r\n\t\t\totr.jsletrecno = recNo;\r\n\t\t\totr.style.display = '';\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\t// fill content table\r\n\t\t\totr = contentRows[i];\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\tclen = cells.length;\r\n\t\t\tfor (j = 0; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t} //end for data content field\r\n\t\t\tisFirst = 0;\r\n\t\t} //end for records\r\n\t\tZ.listvm.setCurrentRowno(0, true);\r\n\t},\r\n\r\n\t_fillCell: function(recNo, otd, sameValueNodes, isFirst) {\r\n\t\tvar Z = this,\r\n\t\t\tcolCfg = otd.jsletColCfg;\r\n\t\tif (!colCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldName = colCfg.field,\r\n\t\t\tcellPanel = otd.firstChild,\r\n\t\t\tjqTd;\r\n\t\t\r\n\t\tif (Z._onFillCell) {\r\n\t\t\tZ._onFillCell.call(Z, cellPanel, Z._dataset, fldName);\r\n\t\t}\r\n\t\tif (fldName && colCfg.mergeSame && sameValueNodes) {\r\n\t\t\tif (isFirst || !Z._dataset.isSameAsPrevious(fldName)) {\r\n\t\t\t\tsameValueNodes[fldName] = { cell: otd, count: 1 };\r\n\t\t\t\tjqTd = jQuery(otd);\r\n\t\t\t\tjqTd.attr('rowspan', 1);\r\n\t\t\t\tif(Z._editable) {\r\n\t\t\t\t\tvar offset = jqTd.offset();\r\n\t\t\t\t\tjqTd.attr('jsletFirstId', null);\r\n\t\t\t\t\tif(!otd.id) {\r\n\t\t\t\t\t\totd.id = jslet.nextId();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\totd.style.display = '';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar sameNode = sameValueNodes[fldName];\r\n\t\t\t\tsameNode.count++;\r\n\t\t\t\totd.style.display = 'none';\r\n\t\t\t\tvar jqFirstTd = jQuery(sameNode.cell);\r\n\t\t\t\tif(Z._editable) {\r\n\t\t\t\t\tjQuery(otd).attr('jsletOffsetHeight', (sameNode.count -1) * Z.rowHeight()).attr('jsletFirstId', jqFirstTd.attr('id'));\r\n\t\t\t\t}\r\n\t\t\t\tjqFirstTd.attr('rowspan', sameNode.count);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.refreshCell) {\r\n\t\t\tcellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t} else {\r\n\t\t\tjslet.ui.table.cellRenders.defaultCellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t}\r\n\t\tif(fldName) {\r\n\t\t\tvar errObj = Z._dataset.getFieldErrorByRecno(recNo, fldName);\r\n\t\t\tjqTd = jQuery(otd);\r\n\t\t\tvar title = cellPanel.title;\r\n\t\t\tif(errObj && errObj.message) {\r\n\t\t\t\tif(!jqTd.hasClass('has-error')) {\r\n\t\t\t\t\tjqTd.addClass('has-error');\r\n\t\t\t\t}\r\n\t\t\t\tcellPanel.title = errObj.message;\r\n\t\t\t} else {\r\n\t\t\t\tif(jqTd.hasClass('has-error')) {\r\n\t\t\t\t\tjqTd.removeClass('has-error');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefreshCurrentRow: function() {\r\n\t\tvar Z = this,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._hasSeqCol || Z._hasSelectCol,\r\n\t\t\tfixedBody = null, contentBody, idx,\r\n\t\t\trecno = Z._dataset.recno();\r\n\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\tidx = recno;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\tidx = Z.listvm.recnoToRowno(Z._dataset.recno()) - Z.listvm.getVisibleStartRow();\r\n\t\t}\r\n\r\n\t\tvar otr, cells, otd, recNo, colCfg, j, clen;\r\n\r\n\t\tif (hasLeft) {\r\n\t\t\totr = fixedBody.rows[idx];\r\n\t\t\tif (!otr) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\trecNo = otr.jsletrecno;\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\tvar ocheck;\r\n\t\t\tfor (j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tcolCfg = otd.jsletColCfg;\r\n\t\t\t\tif (colCfg && colCfg.isSeqCol) {\r\n\t\t\t\t\tcolCfg.cellRender.refreshCell.call(Z, otd.firstChild, colCfg);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (colCfg && colCfg.isSelectCol) {\r\n\t\t\t\t\tocheck = otd.firstChild;\r\n\t\t\t\t\tocheck.checked = Z._dataset.selected();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ._fillCell(recNo, otd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\totr = contentBody.rows[idx];\r\n\t\tif (!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trecNo = otr.jsletrecno;\r\n\t\tif (Z._onFillRow) {\r\n\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t}\r\n\t\t// fill content table\r\n\t\tcells = otr.childNodes;\r\n\t\tfor (j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\totd = cells[j];\r\n\t\t\tZ._fillCell(recNo, otd);\r\n\t\t}\r\n\t},\r\n\r\n\t_getLeftRowByRecno: function(recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\treturn Z.leftFixedTbl.tBodies[0].rows[recno];\r\n\t\t}\r\n\t\tvar rows = Z.leftContentTbl.tBodies[0].rows, row;\r\n\t\tfor (var i = 0, cnt = rows.length; i < cnt; i++) {\r\n\t\t\trow = rows[i];\r\n\t\t\tif (row.jsletrecno == recno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}, // end _getLeftRowByRecno\r\n\r\n\t_showCurrentRow: function(checkVisible) {//Check if current row is in visible area\r\n\t\tvar Z = this,\r\n\t\t\trowno = Z.listvm.recnoToRowno(Z._dataset.recno());\r\n\t\tZ.listvm.setCurrentRowno(rowno, false, checkVisible);\r\n\t\tZ._showCurrentCell();\r\n\t},\r\n\r\n\t_hideCurrentRow: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._currRow) {\r\n\t\t\tif (Z._currRow.fixed) {\r\n\t\t\t\tjQuery(Z._currRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\tjQuery(Z._currRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_getTrByRowno: function(rowno) {\r\n\t\tvar Z = this, \r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tidx, otr, k, rows, row, fixedRow;\r\n\r\n\t\tif (rowno < 0) {//fixed rows\r\n\t\t\trows = Z.rightFixedTbl.tBodies[0].rows;\r\n\t\t\tk = Z._fixedRows + rowno;\r\n\t\t\trow = rows[k];\r\n\t\t\tfixedRow = (hasLeft ? Z.leftFixedTbl.tBodies[0].rows[k] : null);\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\t//data content\r\n\t\trows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tk = rowno - Z.listvm.getVisibleStartRow();\r\n\t\tif (k >= 0) {\r\n\t\t\trow = rows[k];\r\n\t\t\tif (!row) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tfixedRow = hasLeft ? Z.leftContentTbl.tBodies[0].rows[k] : null;\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_getCurrCellEl: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currRow) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar contentRow = Z._currRow.content,\r\n\t\t\tcells = contentRow.cells, \r\n\t\t\tcellEl, colCfg;\r\n\t\tfor(var i = 0, len = cells.length; i < len; i++) {\r\n\t\t\tcellEl = cells[i];\r\n\t\t\tcolCfg = cellEl.jsletColCfg;\r\n\t\t\tif(colCfg && colCfg.colNum === Z._currColNum) {\r\n\t\t\t\treturn cellEl;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_adjustCurrentCellPos: function(isLeft) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currRow) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\toldScrLeft = contentPanel.scrollLeft;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currTd = Z._getCurrCellEl(),\r\n\t\t\tcurrTdLeft = currTd.offsetLeft,\r\n\t\t\tcurrTdWidth = currTd.offsetWidth,\r\n\t\t\tcontainerWidth = contentPanel.clientWidth,\r\n\t\t\tcontainerLeft = contentPanel.scrollLeft;\r\n\t\tif(currTdLeft < containerLeft) {\r\n\t\t\tcontentPanel.scrollLeft = currTdLeft;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(currTdLeft + currTdWidth > containerLeft + containerWidth) {\r\n\t\t\tcontentPanel.scrollLeft = currTdLeft + currTdWidth - containerWidth;\r\n\t\t}\r\n\t},\r\n\r\n\t_isCurrCellInView: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\tborderW = (Z._noborder ? 0: 2),\r\n\t\t\toldScrLeft = contentPanel.scrollLeft,\r\n\t\t\tcurrColLeft = 0, i, len;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tfor(i = Z._fixedCols, len = Z.innerColumns.length; i < Z._currColNum; i++) {\r\n\t\t\tcurrColLeft += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tif(currColLeft < oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\tvar containerWidth = jqContentPanel.innerWidth(),\r\n\t\t\tcontentWidth = jqContentPanel.find('.jl-tbl-content-div').width(),\r\n\t\t\tscrWidth = 0;\r\n\t\tfor(i = Z.innerColumns.length - 1; i > Z._currColNum; i--) {\r\n\t\t\tscrWidth += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tcurrColLeft = contentWidth - scrWidth - containerWidth;\r\n\t\tcurrColLeft = (currColLeft >= 0? currColLeft: 0);\r\n\t\tif(currColLeft > oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_showCurrentCell: function() {\r\n\t\tvar Z = this,\r\n\t\t\trowObj = Z._currRow;\r\n\t\tif(!rowObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar otr;\r\n\t\tif(Z._currColNum >= Z._fixedCols) {\r\n\t\t\totr = rowObj.content;\r\n\t\t} else {\r\n\t\t\totr = rowObj.fixed;\r\n\t\t}\r\n\t\tvar recno = otr.jsletrecno;\r\n    \tvar cellEditor = Z.cellEditor();\r\n\t\tif(recno !== Z._dataset.recno()) {\r\n    \t\tif(Z.prevCell) {\r\n    \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n    \t\t}\r\n        \tif(cellEditor) {\r\n       \t\t\tcellEditor.hideEditor();\r\n        \t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ocells = otr.cells, otd, colCfg, found = false;\r\n\t\tfor(var i = 0, len = ocells.length; i < len; i++) {\r\n\t\t\totd = ocells[i];\r\n        \tcolCfg = otd.jsletColCfg;\r\n        \tif(colCfg && colCfg.colNum == Z._currColNum) {\r\n        \t\tif(Z.prevCell) {\r\n        \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n        \t\t}\r\n        \t\tvar jqCell = jQuery(otd);\r\n        \t\tjqCell.addClass('jl-tbl-curr-cell');\r\n        \t\tZ.prevCell = jqCell;\r\n        \t\tfound = true;\r\n        \t\tbreak;\r\n        \t}\r\n\t\t}\r\n    \tif(cellEditor && found) {\r\n    \t\tif(Z._isCurrCellInView()) {\r\n    \t\t\tcellEditor.showEditor(colCfg.field, otd);\r\n    \t\t} else {\r\n    \t\t\tcellEditor.hideEditor();\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\t\r\n\t_showSelected: function(otd, fldName, recno) {\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(otd);\r\n\t\tif(recno === undefined) {\r\n\t\t\trecno = Z._dataset.recno();\r\n\t\t}\r\n\t\tvar isSelected = Z._dataset.selection.isSelected(recno, fldName);\r\n\t\tif(isSelected) {\r\n\t\t\tjqCell.addClass('jl-tbl-selected');\r\n\t\t} else {\r\n\t\t\tjqCell.removeClass('jl-tbl-selected');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_refreshSelection: function() {\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).find('td.jl-tbl-cell').each(function(k, otd) {\r\n        \tvar colCfg = otd.jsletColCfg;\r\n        \tvar recno = parseInt(otd.parentNode.jsletrecno);\r\n        \tif((recno || recno === 0) && colCfg) {\r\n        \t\tvar fldName = colCfg.field;\r\n        \t\tif(fldName) {\r\n        \t\t\tZ._showSelected(otd, fldName, recno);\r\n        \t\t}\r\n        \t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_syncScrollBar: function(rowno) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tsw = rowno * Z.rowHeight();\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar scrBar = Z.jqVScrollBar[0];\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tscrBar.scrollTop = sw;\r\n\t\t\t}, 10);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Toggle(expand/collapse) the current record expanded status, enabled for tree style table.\r\n\t */\r\n\ttoggle: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (expanded) {\r\n\t\t\tZ.listvm.collapse(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ.listvm.expand(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand the current record, enabled for tree style table.\r\n\t */\r\n\texpand: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (!expanded) {\r\n\t\t\tZ.listvm.expand(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Collapse the current record, enabled for tree style table.\r\n\t */\r\n\tcollapse: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar expanded = Z._dataset.expandedByRecno(Z._dataset.recno());\r\n\t\tif (expanded) {\r\n\t\t\tZ.listvm.collapse(function() {\r\n\t\t\t\tZ._fillData();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand all records, enabled for tree style table.\r\n\t */\r\n\texpandAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.expandAll(function() {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse all records, enabled for tree style table.\r\n\t */\r\n\tcollapseAll: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.collapseAll(function() {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_doMetaChanged: function(metaName, fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!fldName) {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(metaName == 'label' && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName == 'required' && Z._editable && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(metaName == 'visible') {\r\n\t\t\t\r\n\t\t}\r\n\t\tif(Z._editable && (metaName == 'readOnly' || metaName == 'disabled')) {\r\n\t\t\tvar cellEditor = Z.cellEditor();\r\n\t\t\tif(cellEditor) {\r\n\t\t\t\tvar currFld = cellEditor.currentField();\r\n\t\t\t\tif(currFld == fldName) {\r\n\t\t\t\t\tcellEditor.showEditor(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\trefreshControl: function(evt) {\r\n\t\tvar Z = this, i, cnt, otr, otd, checked, ocheckbox, col, recno,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tZ._doMetaChanged(evt.metaName, evt.fieldName);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.AGGREGATED) {\r\n\t\t\tZ._fillTotalSection();\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.BEFORESCROLL) {\r\n\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tif(!Z.listvm) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._hideCurrentRow();\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\tZ._updateSortFlag(true);\r\n\t\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t}\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t\tif(Z._filterPanel) {\r\n\t\t\t\tZ._filterPanel.checkFilterBtnStyle();\r\n\t\t\t}\r\n\t\t\t//Clear \"Select all\" checkbox\r\n\t\t\tif(Z._hasSelectCol) {\r\n\t\t\t\tjQuery(Z.el).find('.jl-tbl-select-all')[0].checked = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD) {\r\n\t\t\tvar fldName = evt.fieldName;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.mergeSame()) {\r\n\t\t\t\t\tZ._fillData();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.refreshCurrentRow();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATECOLUMN || evtType == jslet.data.RefreshEvent.UPDATELOOKUP) {\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\trecno = Z._dataset.recno();\r\n\t\t\tvar\tpreRecno = evt.preRecno;\r\n\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(recno, preRecno));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._stretchContentHeight();\r\n\t\t\tZ._fillData();\r\n\t\t\tif(Z._dataset.recordCount() === 0) {\r\n\t\t\t\tZ._currRow = null;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcol = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\trecno = evt.recno;\r\n\t\t\tfor(i = 0, cnt = recno.length; i < cnt; i++) {\r\n\t\t\t\totr = Z._getLeftRowByRecno(recno[i]);\r\n\t\t\t\tif (!otr) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\totd = otr.cells[col];\r\n\t\t\t\tchecked = evt.selected ? true : false;\r\n\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcol = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\tvar leftFixedBody = Z.leftFixedTbl.tBodies[0],\r\n\t\t\t\tleftContentBody = Z.leftContentTbl.tBodies[0],\r\n\t\t\t\trec,\r\n\t\t\t\toldRecno = Z._dataset.recno();\r\n\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0, cnt = leftFixedBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftFixedBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = 0, cnt = leftContentBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftContentBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t} //end event selectall\r\n\t}, // refreshControl\r\n\r\n\t_isCellEditable: function(colCfg) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._editable) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Z._editableFields && Z._editableFields.length > 0 && Z._editableFields.indexOf(fldName) < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Z._readOnlyFields && Z._readOnlyFields.length > 0 && Z._readOnlyFields.indexOf(fldName) >=0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fldName),\r\n\t\t\tisEditable = !fldObj.fieldDisabled() && !fldObj.fieldReadOnly() ? 1 : 0;\r\n\t\treturn isEditable;\r\n\t},\r\n\t\r\n\t_doAppendRecord: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onAppendRecord) {\r\n\t\t\tZ._onAppendRecord.call(Z);\r\n\t\t} else {\r\n\t\t\tZ._dataset.appendRecord();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDeleteRecord: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onDeleteRecord) {\r\n\t\t\tZ._onDeleteRecord.call(Z);\r\n\t\t} else {\r\n\t\t\tZ._dataset.deleteRecord();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * \r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnewHeight = jqEl.height();\r\n\t\tif (newHeight == Z._oldHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.height = newHeight;\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t_innerDestroy: function() {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._currRow = null;\r\n\t\tZ._oldVisibleRows = -1;\r\n\t\tZ.listvm.reset();\r\n\t\tZ.leftHeadTbl = null;\r\n\t\tZ.rightHeadTbl = null;\r\n\t\tjQuery(Z.rightHeadTbl).off();\r\n\r\n\t\tZ.leftFixedTbl = null;\r\n\t\tZ.rightFixedTbl = null;\r\n\r\n\t\tZ.leftContentTbl = null;\r\n\t\tZ.rightContentTbl = null;\r\n\r\n\t\tZ.leftFootTbl = null;\r\n\t\tZ.rightFootTbl = null;\r\n\t\t\r\n\t\tZ.noRecordDiv = null;\r\n\t\tif(Z.jqVScrollBar) {\r\n\t\t\tZ.jqVScrollBar.off();\r\n\t\t}\r\n\t\tZ.jqVScrollBar = null;\r\n\t\t\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tif(splitter) {\r\n\t\t\tsplitter._doDragging = null;\r\n\t\t\tsplitter._doDragEnd = null;\r\n\t\t\tsplitter._doDragCancel = null;\r\n\t\t}\r\n\t\tZ.parsedHeads = null;\r\n\t\tZ.prevCell = null;\r\n\t\t\r\n\t\tjqEl.find('.jl-tbl-select-check').off();\r\n\t\tif(Z._filterPanel) {\r\n\t\t\tZ._filterPanel.destroy();\r\n\t\t\tZ._filterPanel = null;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._findDialog) {\r\n\t\t\tZ._findDialog.destroy();\r\n\t\t\tZ._findDialog = null;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._cellEditor) {\r\n\t\t\tZ._cellEditor.destroy();\r\n\t\t\tZ._cellEditor = null;\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super) {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.off();\r\n\t\tZ._innerDestroy();\r\n\t\tZ.listvm.destroy();\r\n\t\tZ.listvm = null;\r\n\t\t$super();\r\n\t} \r\n});\r\n\r\n/**\r\n * @class\r\n * @extend jslet.ui.AbstractDBTable\r\n * \r\n * DBTable is a powerful control, features: <br />\r\n * <ol>\r\n * <li>\r\n * <dl><dt>Sort Data</dt><dd>Clicking column header text to sort data, SHIFT + Clicking column header text to sort data with multiple columns.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Find Data</dt><dd>Pressing CTRL + F to pop up finding dialog.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Filter Data</dt><dd>Pressing the down-arrow of each column header to pop up filtering dialog.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Copy Data to Clipboard</dt><dd>First select cells(CTRL + A, CTRL/SHIFT + Clicking Cell), pressing CTRL + C to copy data.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Find Error Record</dt><dd>When importing records or batch editing records, press CTRL + E to find the next record existing error.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Multi-Layer Column Header</dt><dd>Set dataset field's property \"children\".</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Change Column Width</dt><dd>Drag and drop column line.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Move Column</dt><dd>Drag and drop column header.</dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Sequence Column</dt><dd>Set property \"hasSeqCol\" to true to show sequence column; <br />\r\n * Set property \"reverseSeqCol\" to \"true\" to reverse sequence no; <br />\r\n * Set property \"seqColHeader\" to customize sequence header. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Select Column</dt>\r\n * <dd>Set property \"hasSelectCol\" to \"true\" to show select column.<br />\r\n * Clicking \"Select Column\" header to select all records.<br />\r\n * Set property \"selectBy\" to group select records.<br />\r\n * Set dataset event \"onCheckSelectable\" to check which records can be selected. \r\n * </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Action Column</dt><dd>Add a \"ACTION\" type field to dataset. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Edit Action Column</dt><dd>Add a \"EDITACTION\" type field to dataset. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Fixed rows or columns</dt><dd>Set value to properties \"fixedRows\" or \"fixedCols\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support \"Total\" row</dt><dd>Set the dataset field's properties: \"aggregated\" and \"aggregatedBy\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Support Merge Rows with Same Value</dt><dd>Set the dataset field's properties: \"mergeSame\" and \"mergeSameBy\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Tree-Grid Style</dt><dd>Set property: \"treeField\". </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>In-cell Edit</dt><dd>Set property: \"editable\" to true. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Customize Table Style</dt><dd>Use: \"noborder\", \"onFillRow\", \"onFillCell\", \"hideHead\" to customize. </dd></dl>\r\n * </li>\r\n * <li>\r\n * <dl><dt>Stretch Table Height Automatically</dt><dd>Use: \"autoStretch\", \"minVisibleRows\", \"onFillCell\", \"maxVisibleRows\" to customize. </dd></dl>\r\n * </li>\r\n * </ol>\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBTable\", dataset: \"employee\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DBTable\", dataset: \"employee\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBTable = jslet.Class.create(jslet.ui.AbstractDBTable, {});\r\n\r\njslet.ui.register('DBTable', jslet.ui.DBTable);\r\njslet.ui.DBTable.htmlTemplate = '<div></div>';\r\n\r\n/*\r\n* Splitter: used in jslet.ui.DBTable\r\n*/\r\njslet.ui.Splitter = function() {\r\n\tif (!jslet.ui._splitDiv) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\todiv.className = 'jl-split-column';\r\n\t\todiv.style.display = 'none';\r\n\t\tjslet.ui._splitDiv = odiv;\r\n\t\tdocument.body.appendChild(odiv);\r\n\t\todiv = null;\r\n\t}\r\n\t\r\n\tthis.isDragging = false;\r\n\t\r\n\tthis.attach = function(el, left, top, height) {\r\n\t\tif (!height) {\r\n\t\t\theight = jQuery(el).height();\r\n\t\t}\r\n\t\tvar odiv = jslet.ui._splitDiv;\r\n\t\todiv.style.height = height + 'px';\r\n\t\todiv.style.left = left + 'px';\r\n\t\todiv.style.top = top + 'px';\r\n\t\todiv.style.display = 'block';\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis.unattach = function() {\r\n\t\tjslet.ui._splitDiv.style.display = 'none';\r\n\t\tthis.onSplitEnd = null;\r\n\t\tthis.onSplitCancel = null;\r\n\t};\r\n\t\r\n\tthis.onSplitEnd = null;\r\n\tthis.onSplitCancel = null;\r\n\t\r\n\tthis._doDragEnd = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitEnd) {\r\n\t\t\tthis.onSplitEnd(x - oldX);\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis._doDragging = function(oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tthis.isDragging = true;\r\n\t\tjslet.ui._splitDiv.style.left = x + 'px';\r\n\t};\r\n\t\r\n\tthis._doDragCancel = function() {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitCancel) {\r\n\t\t\tthis.onSplitCancel();\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n};\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/*\r\n * Filter panel for DBTable\r\n */\r\njslet.ui.table.DBTableFilterPanel = function(tblCtrl) {\r\n\tvar Z = this;\r\n\tZ._width = 300;\r\n\tZ._height = 150;\r\n\tZ.fieldName = null;\r\n\tZ._filterDatasetObj = new jslet.data.FilterDataset(tblCtrl.dataset());\r\n\tZ._filterDataset = Z._filterDatasetObj.filterDataset();\r\n\tZ._filterDataset.getField('lParenthesis').visible(false);\r\n\tZ._filterDataset.getField('rParenthesis').visible(false);\r\n\tZ._filterDataset.getField('logicalOpr').visible(false);\r\n\tZ._filterDataset.getField('valueExprInput').visible(false);\r\n\tZ._dbtable = tblCtrl;\r\n\tZ._jqFilterBtn = null;\r\n\tZ._currFieldName = null;\r\n\tZ._currFilterExpr = null;\r\n};\r\n\r\njslet.ui.table.DBTableFilterPanel.prototype = {\r\n\t\r\n\tjqFilterBtn: function(jqFilterBtn) {\r\n\t\tthis._jqFilterBtn = jqFilterBtn;\r\n\t},\r\n\t\t\r\n\tchangeField: function(fldName) {\r\n\t\tvar dsFilter = this._filterDataset,\r\n\t\t\tfldObj = dsFilter.getField('field'),\r\n\t\t\tlkDs = fldObj.lookup().dataset();\r\n\t\tdsFilter.cancel();\r\n\t\tlkDs.filter('[name] == \"' + fldName +'\" || like([name],\"'+ fldName + '.%' + '\")');\r\n\t\tlkDs.filtered(true);\r\n\t\tfldObj.visible(lkDs.recordCount() > 1);\r\n\t\tif(!dsFilter.find('[field] == \"' + fldName + '\" || like([field], \"' + fldName + '.%' + '\")')) {\r\n\t\t\tdsFilter.appendRecord();\r\n\t\t\tdsFilter.setFieldValue('field', fldName);\r\n\t\t}\r\n\t\tthis._currFieldName = fldName;\r\n\t},\r\n\t\r\n\tshow: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._panel) {\r\n\t\t\tZ._panel = Z._create();\r\n\t\t}\r\n\t\tZ._panel.style.left = left + 'px';\r\n\t\tZ._panel.style.top = top + 'px';\r\n\t\tjQuery(Z._panel).show('fast');\r\n\t\twindow.setTimeout(function(){\r\n\t\t\tZ._filterDataset.focusEditControl('value');\r\n\t\t},5);\r\n\t},\r\n\r\n\thide: function () {\r\n\t\tthis._filterDataset.cancel();\r\n\t\tjQuery(this._panel).hide('fast');\r\n\t},\r\n\t\r\n\tcancelFilter: function() {\r\n\t\tthis._filterDataset.cancel();\r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._panel) {\r\n\t\t\tZ._panel = document.createElement('div');\r\n\t\t\tZ._dbtable.el.appendChild(Z._panel);\r\n\t\t}\r\n\t\tjQuery(Z._panel).addClass('panel panel-default jl-filter-panel');\r\n\t\tZ._panel.innerHTML = '<div class=\"\"><div data-jslet=\"type: \\'DBEditPanel\\', dataset: \\'' + Z._filterDataset.name() + \r\n\t\t'\\', columnCount: 1,hasLabel:false \" style=\"width:100%;height:100%\" ></div></div>' +\r\n\t\t'<div class=\"jl-filter-panel-toolbar\"><button class=\"btn btn-default btn-sm jl-filter-panel-ok\" tabIndex=\"90990\">' + jsletlocale.FilterPanel.ok +\r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-cancel\" tabIndex=\"90991\">' + jsletlocale.FilterPanel.cancel + \r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-clear\" tabIndex=\"90992\">' + jsletlocale.FilterPanel.clear + \r\n\t\t'</button><button class=\"btn btn-default btn-sm jl-filter-panel-clearall\" tabIndex=\"90993\">' + jsletlocale.FilterPanel.clearAll + \r\n\t\t'</button></div>';\r\n\t\tjslet.ui.install(Z._panel);\r\n\t\tvar jqPanel = jQuery(Z._panel);\r\n\t\tjqPanel.find('.jl-filter-panel-ok').on('click', function(){\r\n\t\t\tvar dsFilter = Z._filterDataset;\r\n\t\t\tdsFilter.confirm();\r\n\t\t\tif(jslet.isEmpty(dsFilter.getFieldValue('value'))) {\r\n\t\t\t\tdsFilter.deleteRecord();\r\n\t\t\t}\r\n\t\t\tvar filter = Z._filterDatasetObj.getFilterExpr();\r\n\t\t\tZ._dbtable.dataset().filter(filter).filtered(true);\r\n\t\t\tZ._currFilterExpr = filter;\r\n\t\t\t\r\n\t\t\tZ.hide();\r\n\t\t\tZ._setFilterBtnStyle();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-cancel').on('click', function(){\r\n\t\t\tZ._filterDataset.cancel();\r\n\t\t\tZ.hide();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-clear').on('click', function(){\r\n\t\t\tZ._filterDataset.deleteRecord();\r\n\t\t\tvar filter = Z._filterDatasetObj.getFilterExpr();\r\n\t\t\tZ._dbtable.dataset().filter(filter).filtered(true);\r\n\t\t\tZ.hide();\r\n\t\t\tZ._currFilterExpr = filter;\r\n\t\t\tZ._setFilterBtnStyle();\r\n\t\t});\r\n\t\tjqPanel.find('.jl-filter-panel-clearall').on('click', function(){\r\n\t\t\tZ._filterDataset.records(null);\r\n\t\t\tZ._dbtable.dataset().filter(null).filtered(false);\r\n\t\t\tZ.hide();\r\n\t\t\tZ._clearFilterBtnStyle();\r\n\t\t});\r\n\t\t//prevent to fire the dbtable's keydown event.\r\n\t\tjqPanel.on('keydown', function(event) {\r\n       \t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t\treturn Z._panel;\r\n\t},\r\n\r\n\t_clearFilterBtnStyle: function() {\r\n\t\tvar jqPanel = jQuery(this._panel);\r\n\t\tjQuery(this._dbtable.el).find('.jl-tbl-filter-hasfilter').attr('title', '').removeClass('jl-tbl-filter-hasfilter');\r\n\t\tjqPanel.find('.jl-filter-panel-clearall').attr('title', '');\r\n\t\tthis._currFilterExpr = null;\r\n\t},\r\n\t\r\n\tcheckFilterBtnStyle: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._currFilterExpr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsHost = Z._dbtable.dataset(),\r\n\t\t\tdsFilterExpr = dsHost.filter();\r\n\t\tif(dsHost.filtered() && dsFilterExpr == Z._currFilterExpr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._clearFilterBtnStyle();\r\n\t\tvar dsFilter = Z._filterDataset;\r\n\t\tif(!dsFilterExpr || !dsHost.filtered()) {\r\n\t\t\tdsFilter.records(null);\r\n\t\t}\r\n\t\tvar filterText = Z._filterDatasetObj.getFilterExprText();\r\n\t\tjQuery(Z._dbtable.el).find('button.jl-tbl-filter').each(function(){\r\n\t\t\tvar fldName = this.getAttribute('jsletfilterfield');\r\n\t\t\tvar jqFilterBtn = jQuery(this);\r\n\t\t\tif(dsFilter.find('[field] == \"' + fldName + '\" || like([field], \"' + fldName + '.%' + '\")')) {\r\n\t\t\t\tjqFilterBtn.addClass('jl-tbl-filter-hasfilter');\r\n\t\t\t} else {\r\n\t\t\t\tjqFilterBtn.removeClass('jl-tbl-filter-hasfilter');\r\n\t\t\t}\r\n\t\t\tjqFilterBtn.attr('title', filterText || '');\r\n\t\t});\r\n\t\tjQuery(Z._panel).find('.jl-filter-panel-clearall').attr('title', filterText || '');\r\n\t},\r\n\t\r\n\t_setFilterBtnStyle: function() {\r\n\t\tvar Z = this;\r\n\t\tvar filterText = Z._filterDatasetObj.getFilterExprText();\r\n\t\t\r\n\t\tvar dsFilter = Z._filterDataset;\r\n\t\tif(dsFilter.find('[field] == \"' + Z._currFieldName + '\" || like([field], \"' + Z._currFieldName + '.%' + '\")')) {\r\n\t\t\tZ._jqFilterBtn.addClass('jl-tbl-filter-hasfilter');\r\n\t\t} else {\r\n\t\t\tZ._jqFilterBtn.removeClass('jl-tbl-filter-hasfilter');\r\n\t\t}\r\n\t\tZ._jqFilterBtn.attr('title', filterText || '');\r\n\t\tjQuery(Z._dbtable.el).find('.jl-tbl-filter-hasfilter').attr('title', filterText || '');\r\n\t\tjQuery(Z._panel).find('.jl-filter-panel-clearall').attr('title', filterText || '');\r\n\t},\r\n\t\r\n\tdestroy: function(){\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.uninstall(Z._panel);\r\n\t\tZ._panel.innerHTML = '';\r\n\t\tZ._panel = null;\r\n\t\tZ._dbtable = null;\r\n\t\tZ._jqFilterBtn = null;\r\n\t}\r\n};\r\n\nif(!jslet.ui.table) {\r\n\tjslet.ui.table = {};\r\n}\r\n\r\n/*\r\n * Find dialog for DBTable\r\n */\r\njslet.ui.table.FindDialog = function (dbContainer) {\r\n\tvar _dialog;\r\n\tvar _dataset = dbContainer.dataset();\r\n\tvar _containerEl = dbContainer.el;\r\n\tvar _currfield = null;\r\n\tvar _findingField = null;\r\n\tvar _left = -1;\r\n\tvar _top = -1;\r\n\tfunction initialize() {\r\n\t\tvar opt = { type: 'window', caption: jslet.formatMessage(jsletlocale.findDialog.caption, ['']), isCenter: false, resizable: true, minimizable: false, maximizable: false, \r\n\t\t\t\tstopEventBubbling: true, styleClass: 'jl-finddlg'};\r\n\t\t_dialog = jslet.ui.createControl(opt, _containerEl);\r\n\t\t_dialog.onClosed(function(){\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\t\t\r\n\t\tvar content = '<div class=\"input-group input-group-sm\"><input class=\"form-control jl-finddlg-value\" placeholder=\"' + \r\n\t\tjsletlocale.findDialog.placeholder + '\"/>' + \r\n\t\t'<div class=\"input-group-btn\"><button class=\"btn btn-default jl-finddlg-find\"><i class=\"fa fa-search\" /></button></div></div>';\r\n\t\t\r\n\t\t_dialog.setContent(content);\r\n\t\t_dialog.onPositionChanged(function(left, top) {\r\n\t\t\t_left = (left > 0? left: 0);\r\n\t\t\t_top = (top > 0? top: 0);\r\n\t\t});\r\n\t\tvar dlgEl = _dialog.el;\r\n\r\n\t\tvar jqFindingValue = jQuery(dlgEl).find('.jl-finddlg-value');\r\n\t\tvar isStart = true;\r\n\t\tjqFindingValue.on('keydown', function(event){\r\n\t\t\tif(event.keyCode === jslet.ui.KeyCode.ENTER) {\r\n\t\t\t\tfindData();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tisStart = true;\r\n\t\t});\r\n\t\t\r\n\t\tvar jqFind = jQuery(dlgEl).find('.jl-finddlg-find');\r\n\t\tjqFind.on('click', function(event) {\r\n\t\t\tfindData();\r\n\t\t});\r\n\r\n\t\tfunction findData() {\r\n\t\t\tif(_dataset.recordCount() < 2) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar findingValue = jqFindingValue.val(),\r\n\t\t\t\tcurrRecno = 0;\r\n\t\t\tif(!isStart) {\r\n\t\t\t\tcurrRecno = _dataset.recno() + 1;\r\n\t\t\t}\r\n\t\t\tvar options = {startRecno: currRecno, findingByText: true, matchType: 'any'};\r\n\t\t\tvar found = _dataset.findByField(_findingField, findingValue, options);\r\n\t\t\tisStart = !found;\r\n\t\t\tif(!found) {\r\n\t\t\t\tif(currRecno > 0) { //If not found, find from the first position.\r\n\t\t\t\t\tfindData();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn found;\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.show = function(left, top) {\r\n\t\tif(!_findingField) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(_left >= 0) {\r\n\t\t\tleft = _left;\r\n\t\t}\r\n\t\tif(_top >= 0) {\r\n\t\t\ttop = _top;\r\n\t\t}\r\n\t\tleft = left || 0;\r\n\t\ttop = top || 0;\r\n\t\t_dialog.show(left, top);\r\n\t\tthis.focus();\r\n\t};\r\n\t\r\n\tthis.hide = function() {\r\n\t\t_dialog.hide();\r\n\t};\r\n\t\r\n\tthis.findingField = function(findingField) {\r\n\t\tif(findingField === undefined) {\r\n\t\t\treturn _findingField;\r\n\t\t}\r\n\t\tvar oldField = _findingField;\r\n\t\t_findingField = findingField;\r\n\t\tif(_findingField) {\r\n\t\t\tvar fldObj = _dataset.getField(_findingField);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tvar dataType = fldObj.getType();\r\n\t\t\t\tif(dataType === jslet.data.DataType.ACTION || dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\t\t_findingField = null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t_dialog.changeCaption(jslet.formatMessage(jsletlocale.findDialog.caption, [fldObj.label()]));\r\n\t\t\t\tif(oldField != findingField) {\r\n\t\t\t\t\tjQuery(_dialog.el).find('.jl-finddlg-value').val('');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.focus = function() {\r\n\t\tjQuery(_dialog.el).find('.jl-finddlg-value').focus();\r\n\t};\r\n\t\r\n\tthis.destroy = function() {\r\n\t\t_dialog.destroy();\r\n\t};\r\n\t\r\n\tinitialize();\r\n};\r\n\r\n\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBChart, show data as a chart. We use an open source chart component to show chart: EChart(http://echarts.baidu.com/).\r\n * EChart is very powerful, but we implement these usual chart: column, bar, line, area, pie. <br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBChart\", dataset:\"summary\", chartType:\"column\",categoryField:\"month\",valueFields:\"amount\",recordRange: jslet.data.RecordRange.ALL, reverse: false};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DBChart\",chartType:\"column\",categoryField:\"month\",valueFields:\"amount,netProfit\", dataset:\"summary\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.DBChart = jslet.Class.create(jslet.ui.DBControl, {\r\n\tchartTypes: ['line', 'stackline', 'bar', 'stackbar', 'pie'],\r\n\t\r\n\tlegendPositions: ['none', 'top', 'bottom', 'left', 'right'],\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,chartType,chartTitle,categoryField,valueFields,legendPos,recordRange,reverse';\r\n\t\tZ.requiredProperties = 'valueFields,categoryField';\r\n\t\t\r\n\t\tZ._chartType = \"line\";\r\n\t\t\r\n\t\tZ._categoryField = null;\r\n\t\t\r\n\t\tZ._valueFields = null;\r\n\t\t\r\n\t\tZ._chartTitle = null;\r\n\r\n\t\tZ._legendPos = 'none';\r\n\t\t\r\n\t\tZ._recordRange = jslet.data.RecordRange.ALL;\r\n\t\t\r\n\t\tZ._reverse = false;\r\n\t\t\r\n\t\tZ._fieldValidated = false;\r\n\t\t\r\n\t\tZ._oldHeight = -1;\r\n\t\t\r\n\t\tZ._echart = null;\r\n\t\t\r\n\t\tZ._onSetChartOption = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart type. Optional chart type: line(default), column, bar, area, pie.\r\n\t * \r\n\t * @param {String | undefined} chartType Chart type, optional value: 'line'(default), 'stackline', 'bar', 'stackbar', 'pie'.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tchartType: function(chartType) {\r\n\t\tif(chartType === undefined) {\r\n\t\t\treturn this._chartType;\r\n\t\t}\r\n\t\tchartType = jQuery.trim(chartType);\r\n\t\tvar checker = jslet.Checker.test('DBChart.chartType', chartType).isString().required();\r\n\t\tchecker.testValue(chartType.toLowerCase()).inArray(this.chartTypes);\r\n\t\tthis._chartType = chartType;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get category field.\r\n\t * \r\n\t * @param {String | undefined} categoryField Category field.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tcategoryField: function(categoryField) {\r\n\t\tif(categoryField === undefined) {\r\n\t\t\treturn this._categoryField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.categoryField', categoryField).isString().required();\r\n\t\tcategoryField = jQuery.trim(categoryField);\r\n\t\tthis._categoryField = categoryField;\r\n\t\tthis._fieldValidated = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get value fields, multiple fields are separated with comma(,).\r\n\t * \r\n\t * @param {String | undefined} valueFields Value fields.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tvalueFields: function(valueFields) {\r\n\t\tif(valueFields === undefined) {\r\n\t\t\treturn this._valueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.valueFields', valueFields).isString().required();\r\n\t\tvalueFields = jQuery.trim(valueFields);\r\n\t\tthis._valueFields = valueFields.split(',');\r\n\t\tthis._fieldValidated = false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart title.\r\n\t * \r\n\t * @param {String | undefined} chartTitle Chart title.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tchartTitle: function(chartTitle) {\r\n\t\tif(chartTitle === undefined) {\r\n\t\t\treturn this._chartTitle;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.chartTitle', chartTitle).isString();\r\n\t\tthis._chartTitle = chartTitle;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get chart legend position, optional value: 'none', 'top'(default), 'bottom', 'left', 'right'.\r\n\t * \r\n\t * @param {String | undefined} legendPos Chart legend position.\r\n\t * \r\n\t * @return {this | String}\r\n\t */\r\n\tlegendPos: function(legendPos) {\r\n\t\tif(legendPos === undefined) {\r\n\t\t\treturn this._legendPos;\r\n\t\t}\r\n\t\tlegendPos = jQuery.trim(legendPos);\r\n\t\tvar checker = jslet.Checker.test('DBChart.legendPos', legendPos).isString().required();\r\n\t\tchecker.testValue(legendPos.toLowerCase()).inArray(this.legendPositions);\r\n\t\tthis._legendPos = legendPos;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get record range, optional value: jslet.data.RecordRange.ALL, jslet.data.RecordRange.CURRENT, jslet.data.RecordRange.SELECTED.\r\n\t * \r\n\t * @param {jslet.data.RecordRange | undefined} recordRange default is jslet.data.RecordRange.ALL.\r\n\t * \r\n\t * @return {this | jslet.data.RecordRange}\r\n\t */\r\n\trecordRange: function(recordRange) {\r\n\t\tif(recordRange === undefined) {\r\n\t\t\treturn this._recordRange;\r\n\t\t}\r\n\t\tthis._recordRange = recordRange;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether reverse the X-axis and Y-axis or not.\r\n\t * \r\n\t * @param {Boolean | undefined} reverse True - reverse the X-axis and Y-axis, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\treverse: function(reverse) {\r\n\t\tif(reverse === undefined) {\r\n\t\t\treturn this._reverse;\r\n\t\t}\r\n\t\tthis._reverse = reverse? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tonSetChartOption: function(onSetChartOption) {\r\n\t\tif(onSetChartOption === undefined) {\r\n\t\t\treturn this._onSetChartOption;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.onSetChartOption', onSetChartOption).isFunction();\r\n\t\tthis._onSetChartOption = onSetChartOption;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t\tjslet.ui.resizeEventBus.subscribe(this);\r\n\t},\r\n\t\r\n\t_getEChart: function() {\r\n\t\tif(!this._echart) {\r\n\t\t\tthis._echart = jslet.global.echarts.init(this.el);\r\n\t\t}\r\n\t\treturn this._echart;\r\n\t},\r\n\r\n\t_validateFields: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._fieldValidated) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsObj = Z._dataset,\r\n\t\t\tfldName = Z._categoryField;\r\n\t\tif (!dsObj.getField(fldName)) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tif(Z._valueFields) {\r\n\t\t\tfor(var i = 0, len = Z._valueFields.length; i < len; i++) {\r\n\t\t\t\tfldName = Z._valueFields[i];\r\n\t\t\t\tif(!dsObj.getField(fldName)) {\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._fieldValidated = true;\r\n\t},\r\n\t\r\n\t_getLineRecord: function(dsObj, xLabels, yValues, yFields, legendLabels) {\r\n\t\tvar Z = this,\r\n\t\t\tstartRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tvar isInit = false, valueFldName,\r\n\t\t\tvalueFldCnt = Z._valueFields.length,\r\n\t\t\tvalueArr, \r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\tdsObj.recnoSilence(k);\r\n\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\txLabels.push(dsObj.getFieldText(Z._categoryField));\r\n\t\t\tfor(var i = 0; i < valueFldCnt; i++) {\r\n\t\t\t\tvalueFldName = Z._valueFields[i];\r\n\t\t\t\tif(!isInit) {\r\n\t\t\t\t\tvalueArr = [];\r\n\t\t\t\t\tyValues.push(valueArr);\r\n\t\t\t\t\tlegendLabels.push(dsObj.getField(valueFldName).label());\r\n\t\t\t\t\tyFields.push(valueFldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalueArr = yValues[i];\r\n\t\t\t\t}\r\n\t\t\t\tvalueArr.push(dsObj.getFieldValue(valueFldName));\r\n\t\t\t}\r\n\t\t\tisInit = true;\r\n\t\t} //End for k\r\n\t},\r\n\t\r\n\t_getLineRecordReverse: function(dsObj, xLabels, yValues, yFields, legendLabels) {\r\n\t\tvar Z = this,\r\n\t\t\tstartRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tvar isInit = false, valueFldName,\r\n\t\t\tvalueFldCnt = Z._valueFields.length,\r\n\t\t\tvalueArr, \r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\tdsObj.recnoSilence(k);\r\n\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlegendLabels.push(dsObj.getFieldText(Z._categoryField));\r\n\t\t\tvalueArr = [];\r\n\t\t\tfor(var i = 0; i < valueFldCnt; i++) {\r\n\t\t\t\tvalueFldName = Z._valueFields[i];\r\n\t\t\t\tif(!isInit) {\r\n\t\t\t\t\txLabels.push(dsObj.getField(valueFldName).label());\r\n\t\t\t\t\tyFields.push(valueFldName);\r\n\t\t\t\t}\r\n\t\t\t\tvalueArr.push(dsObj.getFieldValue(valueFldName));\r\n\t\t\t}\r\n\t\t\tyValues.push(valueArr);\r\n\t\t\tisInit = true;\r\n\t\t} //End for k\r\n\t},\r\n\t\r\n\t_getLineData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\txLabels = [],\r\n\t\t\tyValues = [],\r\n\t\t\tyFields = [],\r\n\t\t\tlegendLabels = [];\r\n\r\n\t\tif(dsObj.recordCount() === 0 || !Z._valueFields) {\r\n\t\t\treturn {xLabels: xLabels, yValues: yValues, yFields: yFields, legendLabels: legendLabels};\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence();\r\n\t\ttry {\r\n\t\t\tif(Z._reverse) {\r\n\t\t\t\tZ._getLineRecordReverse(dsObj, xLabels, yValues, yFields, legendLabels);\r\n\t\t\t} else {\r\n\t\t\t\tZ._getLineRecord(dsObj, xLabels, yValues, yFields, legendLabels);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn {xLabels: xLabels, yValues: yValues, yFields: yFields, legendLabels: legendLabels};\r\n\t},\r\n\r\n\t_getPieData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset,\r\n\t\t\tchartData = [],\r\n\t\t\tlegendLabels = [],\r\n\t\t\tresult = {chartData: chartData, legendLabels: legendLabels, title: ''};\r\n\t\tif(dsObj.recordCount() === 0 || !Z._valueFields) {\r\n\t\t\tchartData = [['', 0]];\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tvar startRecno = 0, endRecno = dsObj.recordCount() - 1;\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.CURRENT || Z._reverse) {\r\n\t\t\tstartRecno = endRecno = dsObj.recno();\r\n\t\t}\r\n\t\tif(Z._reverse) {\r\n\t\t\tresult.title = Z._dataset.getField(Z._valueFields[0]).displayLabel();\r\n\t\t} else {\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence(), k, len, valueFldName, label, value,\r\n\t\t\tisSelectedRange = Z._recordRange === jslet.data.RecordRange.SELECTED;\r\n\t\ttry {\r\n\t\t\tif(!Z._reverse) {\r\n\t\t\t\tresult.title = Z._dataset.getField(Z._valueFields[0]).displayLabel();\r\n\t\t\t\tvalueFldName = Z._valueFields[0];\r\n\t\t\t\tfor(k = startRecno; k <= endRecno; k++) {\r\n\t\t\t\t\tdsObj.recnoSilence(k);\r\n\t\t\t\t\tif(isSelectedRange && !dsObj.selected()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlabel = dsObj.getFieldText(Z._categoryField);\r\n\t\t\t\t\tvalue = dsObj.getFieldValue(valueFldName);\r\n\t\t\t\t\tchartData.push({name: label, value: value});\r\n\t\t\t\t\tlegendLabels.push(label);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.recnoSilence(startRecno);\r\n\t\t\t\tresult.title = Z._dataset.getField(Z._categoryField).displayLabel();\r\n\t\t\t\tvar fldObj;\r\n\t\t\t\tfor(k = 0, len = Z._valueFields.length; k < len; k++) {\r\n\t\t\t\t\tvalueFldName = Z._valueFields[k];\r\n\t\t\t\t\tfldObj = dsObj.getField(valueFldName);\r\n\t\t\t\t\tlabel = fldObj.displayLabel();\r\n\t\t\t\t\tvalue = fldObj.getValue();\r\n\t\t\t\t\tchartData.push([label, value]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_drawLineChart: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartData = Z._getLineData(),\r\n\t\t\techart = Z._getEChart(),\r\n\t\t\tlegendLabels = chartData.legendLabels,\r\n\t\t\toption = {title: {text: Z._chartTitle},\r\n\t\t\t\tlegend: {data: legendLabels},\r\n\t\t\t\txAxis: {data: chartData.xLabels},\r\n\t\t\t\tyAxis: {type: 'value'}\r\n\t\t\t};\r\n\t\tvar yValues = chartData.yValues,\r\n\t\t\tyFields = chartData.yFields,\r\n\t\t\tseries = [], stack = null,\r\n\t\t\tchtype = Z._chartType;\r\n\t\tif(chtype === 'stackline'){\r\n\t\t\tstack = 'stack';\r\n\t\t\tchtype = 'line';\r\n\t\t}\r\n\t\tif(chtype === 'stackbar') {\r\n\t\t\tstack = 'stack';\r\n\t\t\tchtype = 'bar';\r\n\t\t}\r\n\t\tfor(var i = 0, len = yValues.length; i < len; i++) {\r\n\t\t\tseries.push({field: yFields[i], name: legendLabels[i], data: yValues[i], type: chtype, stack: stack});\r\n\t\t}\r\n\t\toption.series = series;\r\n\t\t\r\n\t\tif(Z._onSetChartOption) {\r\n\t\t\tZ._onSetChartOption(option);\r\n\t\t}\r\n\t\techart.setOption(option);\r\n\t},\r\n\t\t\r\n\t_drawPieChart: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartData = Z._getPieData(),\r\n\t\t\techart = Z._getEChart(),\r\n\t\t\ttitle = chartData.title,\r\n\t\t\tchartTitle = (Z._chartTitle? Z._chartTitle + ' - ' : '') + title,\r\n\t\tlegendLabels = chartData.legendLabels;\r\n\t\tchartData = chartData.chartData;\r\n\t\t\t\r\n\t\tvar option = {title: {text: chartTitle},\r\n\t\t\t\tlegend: {data: legendLabels}\r\n\t\t\t};\r\n\t\t\r\n\t\tvar series = [{type: 'pie', data: chartData}];\r\n\t\toption.series = series;\r\n\t\tif(Z._onSetChartOption) {\r\n\t\t\tZ._onSetChartOption(option);\r\n\t\t}\r\n\t\techart.setOption(option);\r\n\t},\r\n\t\r\n\tdrawChart: function () {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset;\r\n\t\tif(jQuery(Z.el).is(':hidden')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._getEChart().clear();\r\n\t\t\r\n\t\tif(dsObj.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recordRange === jslet.data.RecordRange.SELECTED) {\r\n\t\t\tif(!Z._dataset.hasSelectedRecords()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._validateFields();\r\n\t\tif(Z._chartType == 'pie') {\r\n\t\t\tZ._drawPieChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartType == 'line' || Z._chartType == 'bar' || \r\n\t\t\tZ._chartType == 'stackline' || Z._chartType == 'stackbar') {\r\n\t\t\tZ._drawLineChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\r\n\trefreshControl: function (evt) {\r\n\t\tvar evtType = evt.eventType;\r\n\t\tif (evtType === jslet.data.RefreshEvent.UPDATEALL || \r\n\t\t\tevtType === jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType === jslet.data.RefreshEvent.UPDATECOLUMN || \r\n\t\t\tevtType === jslet.data.RefreshEvent.INSERT || \r\n\t\t\tevtType === jslet.data.RefreshEvent.DELETE || \r\n\t\t\t(evtType === jslet.data.RefreshEvent.SCROLL && this._recordRange === jslet.data.RecordRange.CURRENT) || \r\n\t\t\t((evtType === jslet.data.RefreshEvent.SELECTRECORD || evtType === jslet.data.RefreshEvent.SELECTALL) &&\r\n\t\t\t\tthis._recordRange === jslet.data.RecordRange.SELECTED)\r\n\t\t\t) {\r\n\t\t\tthis.drawChart();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.ui.resizeEventBus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this;\r\n\t\tvar currHeight = jQuery(Z.el).height();\r\n\t\tif(Z._oldHeight < 0 || Z._oldHeight === currHeight) {\r\n\t\t\treturn;\r\n\t\t} \r\n\t\tZ._oldHeight = currHeight;\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tZ.drawChart();\r\n\t\t}, 10);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis.jqplot = null;\r\n\t\tjslet.ui.resizeEventBus.unsubscribe(this);\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBChart', jslet.ui.DBChart);\r\njslet.ui.DBChart.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class\r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBEditPanel is a container control used for user to input data. \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBEditPanel\",dataset:\"employee\",columnCount:3};\r\n * \r\n *     //1. Declaring:\r\n *       <div id='ctrlId' data-jslet='type:\"DBEditPanel\",dataset:\"employee\",columnCount:3' />\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\n\r\njslet.ui.DBEditPanel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t\r\n\t_totalColumns: 12, //Bootstrap column count \r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t*/\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,columnCount,labelCols,onlySpecifiedFields,fields,hasLabel,includeFields,excludeFields,layout';\r\n\t\t\r\n\t\tZ._columnCount = 3;\r\n\r\n\t\tZ._labelCols = 1;\r\n\r\n\t\tZ._onlySpecifiedFields = false;\r\n\t\t\r\n\t\tZ._includeFields = null;\r\n\t\t\r\n\t\tZ._excludeFields = null;\r\n\t\t\r\n\t\tZ._layout = null;\r\n\t\t\r\n\t\tZ._hasLabel = true;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get display column count of field label. According to Bootstrap document, this property is in range: [1,11].\r\n\t * \r\n\t * @param {Integer | undefined} labelCols The display column count of field label.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tlabelCols: function(labelCols) {\r\n\t\tif(labelCols === undefined) {\r\n\t\t\treturn this._labelCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.labelCols', labelCols).isNumber().between(1,10);\r\n\t\tthis._labelCols = parseInt(labelCols);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it only displays the fields which specified by \"fields\" property.\r\n\t * \r\n\t * @param {Boolean | undefined} onlySpecifiedFields True - only display the specified fields, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tonlySpecifiedFields: function(onlySpecifiedFields) {\r\n\t\tif(onlySpecifiedFields === undefined) {\r\n\t\t\treturn this._onlySpecifiedFields;\r\n\t\t}\r\n\t\tthis._onlySpecifiedFields = onlySpecifiedFields ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether it exists the field label part.\r\n\t * \r\n\t * @param {Boolean | undefined} hasLabel True - exists field label part, false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\thasLabel: function(hasLabel) {\r\n\t\tif(hasLabel === undefined) {\r\n\t\t\treturn this._hasLabel;\r\n\t\t}\r\n\t\tthis._hasLabel = hasLabel ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/*\r\n\t * @deprecated\r\n\t * Use 'layout' instead.\r\n\t */\r\n\tfields: function(fields) {\r\n\t\treturn this.layout(fields);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get editing field's layout.\r\n\t * \r\n\t * @param {Object[] | undefined} layout Editing fields setting.\r\n\t * @param {String} layout.field Field name.\r\n\t * @param {Integer} layout.labelCols Label display column, range: [1, 3].\r\n\t * @param {Integer} layout.dataCols Edit control display column, range: [1, 11].\r\n\t * @param {Boolean} layout.inFirstCol Display field at first column.\r\n\t * @param {Boolean} layout.showLine Display line separator.\r\n\t * @param {Boolean} layout.visible The field is visible or not.\r\n\t * @param {String | Number} layout.height The height of the edit field, if the value is numberic, the unit is 'px'.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.prefix The prefix part of the field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.suffix The suffix part of the field.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\tlayout: function(layout) {\r\n\t\tif(layout === undefined) {\r\n\t\t\treturn this._layout;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.layout', layout).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = layout.length; i < len; i++) {\r\n\t\t\tfldCfg = layout[i];\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.field', fldCfg.field).isString().required();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.labelCols', fldCfg.labelCols).isNumber().between(1,3);\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.dataCols', fldCfg.dataCols).isNumber().between(1,11);\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.prefix', fldCfg.prefix).isArray();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.suffix', fldCfg.suffix).isArray();\r\n\t\t\tjslet.Checker.test('DBEditPanel.layout.height', fldCfg.height).isGTZero();\r\n\t\t\tfldCfg.inFirstCol = fldCfg.inFirstCol ? true: false;\r\n\t\t\tfldCfg.showLine = fldCfg.showLine ? true: false;\r\n\t\t\tfldCfg.visible = (fldCfg.visible || fldCfg.visible === undefined) ? true: false;\r\n\t\t}\r\n\t\tthis._layout = layout;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\tincludeFields: function(includeFields) {\r\n\t\tif(includeFields === undefined) {\r\n\t\t\treturn this._includeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.includeFields', includeFields).isArray();\r\n\t\tthis._includeFields = includeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are not displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are not displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\texcludeFields: function(excludeFields) {\r\n\t\tif(excludeFields === undefined) {\r\n\t\t\treturn this._excludeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.excludeFields', excludeFields).isArray();\r\n\t\tthis._excludeFields = excludeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t*/\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\t\r\n\t_calcLayout: function () {\r\n\t\tvar Z = this,\r\n\t\t\tallFlds = Z._dataset.getNormalFields(), \r\n\t\t\tfldLayout,  fldObj, i, fldName, found, \r\n\t\t\tfcnt = allFlds.length,\r\n\t\t\tfldLayouts = [], \r\n\t\t\tlayoutCnt = Z._layout ? Z._layout.length : 0;\r\n\t\t\r\n\t\tif(Z._onlySpecifiedFields && Z._layout) {\r\n\t\t\t\r\n\t\t\tfor(i = 0; i < layoutCnt; i++) {\r\n\t\t\t\tfldLayout = Z._layout[i];\r\n\t\t\t\tif(fldLayout.visible || fldLayout.visible === undefined) {\r\n\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar exFields = Z._excludeFields,\r\n\t\t\t\tinFields = Z._includeFields;\r\n\t\t\tfor(i = 0; i < fcnt; i++) {\r\n\t\t\t\tfldObj = allFlds[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = false;\r\n\t\t\t\tif(inFields && inFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = false;\r\n\t\t\t\tfor(var j = 0; j < layoutCnt; j++) {\r\n\t\t\t\t\tfldLayout = Z._layout[j];\r\n\t\t\t\t\tif(fldLayout.field !== fldName) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tif(fldLayout.visible || fldLayout.visible === undefined) {\r\n\t\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(!found) {\r\n\t\t\t\t\tfldLayouts.push({field: fldName});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar dftDataCols = Math.floor((Z._totalColumns - Z._labelCols * Z._columnCount) / Z._columnCount);\r\n\t\tif(dftDataCols <= 0) {\r\n\t\t\tdftDataCols = 1;\r\n\t\t}\r\n\r\n\t\t//calc row, col\r\n\t\tvar layout, r = 0, c = 0, colsInRow = 0, itemCnt;\r\n\t\tfor (i = 0, layoutCnt = fldLayouts.length; i < layoutCnt; i++) {\r\n\t\t\tlayout = fldLayouts[i];\r\n\t\t\tif(!layout.labelCols) {\r\n\t\t\t\tlayout._innerLabelCols = Z._labelCols;\r\n\t\t\t}\r\n\t\t\tif(!layout.dataCols) {\r\n\t\t\t\tlayout._innerDataCols = dftDataCols;\r\n\t\t\t} else {\r\n\t\t\t\tlayout._innerDataCols = layout.dataCols;\t\r\n\t\t\t}\r\n\t\t\titemCnt = layout._innerLabelCols + layout._innerDataCols;\r\n\t\t\tif (layout.inFirstCol || layout.showLine || colsInRow + itemCnt > Z._totalColumns) {\r\n\t\t\t\tr++;\r\n\t\t\t\tcolsInRow = 0;\r\n\t\t\t}\r\n\t\t\tlayout.row = r;\r\n\t\t\tcolsInRow += itemCnt;\r\n\t\t}\r\n\t\treturn fldLayouts;\r\n\t},\r\n\t\r\n\tgetEditField: function (fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._layout) {\r\n\t\t\tZ._layout = [];\r\n\t\t}\r\n\t\tvar editFld;\r\n\t\tfor (var i = 0, cnt = Z._layout.length; i < cnt; i++) {\r\n\t\t\teditFld = Z._layout[i];\r\n\t\t\tif (editFld.field == fieldName) {\r\n\t\t\t\treturn editFld;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fieldName);\r\n\t\tif (!fldObj) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\teditFld = {\r\n\t\t\tfield: fieldName\r\n\t\t};\r\n\t\tZ._layout.push(editFld);\r\n\t\treturn editFld;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-editpanel')) {\r\n\t\t\tjqEl.addClass('jl-editpanel form-horizontal');\r\n\t\t}\r\n\t\tjqEl.html('');\r\n\t\tvar allFlds = Z._dataset.getNormalFields(),\r\n\t\t\tfcnt = allFlds.length;\r\n\t\tvar layouts = Z._calcLayout();\r\n\t\t//calc max label width\r\n\t\t\t\r\n\t\tvar layout, editor, r = -1, oLabel, editorCfg, fldName, fldObj, ohr, octrlDiv, opanel, ctrlId, dbCtrl;\r\n\t\tfor (var i = 0, cnt = layouts.length; i < cnt; i++) {\r\n\t\t\tlayout = layouts[i];\r\n\t\t\tif (layout.showLine) {\r\n\t\t\t\tohr = document.createElement('hr');\r\n\t\t\t\tZ.el.appendChild(ohr);\r\n\t\t\t}\r\n\t\t\tif (layout.row != r) {\r\n\t\t\t\topanel = document.createElement('div');\r\n\t\t\t\topanel.className = 'form-group form-group-sm';\r\n\t\t\t\t//jQuery(opanel).css('width','100%').css('margin', '0px');\r\n\t\t\t\tZ.el.appendChild(opanel);\r\n\t\t\t\tr = layout.row;\r\n\t\t\t}\r\n\t\t\tfldName = layout.field;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\teditorCfg = fldObj.editControl();\r\n\t\t\tvar isCheckBox = editorCfg.type.toLowerCase() == 'dbcheckbox';\r\n\t\t\tif(isCheckBox) {\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('div');\r\n\t\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\t\t\t\t}\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + (Z._hasLabel? layout._innerDataCols: 12);\r\n\t\t\t\t\r\n\t\t\t\teditorCfg.dataset = Z._dataset;\r\n\t\t\t\teditorCfg.field = fldName;\r\n\t\t\t\teditor = jslet.ui.createControl(editorCfg, null);\r\n\t\t\t\toctrlDiv.appendChild(editor.el);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\t\toctrlDiv.appendChild(oLabel);\r\n\t\t\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\t\tfield: fldName\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t} else {\r\n\t\t\t\tif(Z._hasLabel) {\r\n\t\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\t\t\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\t\tfield: fldName\r\n\t\t\t\t\t});\r\n\t\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + (Z._hasLabel? layout._innerDataCols: 12);\r\n\t\t\t\t\r\n\t\t\t\teditor = jslet.ui.createControl({type: 'DBPlace', dataset: this._dataset, field: fldName, \r\n\t\t\t\t\tprefix: layout.prefix, suffix: layout.suffix}, octrlDiv);\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tvar layoutHeight = layout.height;\r\n\t\t\t\tif(layoutHeight) {\r\n\t\t\t\t\tif(jslet.isNumber(layoutHeight)) {\r\n\t\t\t\t\t\tlayoutHeight = layoutHeight + 'px'; \r\n\t\t\t\t\t}\r\n\t\t\t\t\tjQuery(editor.el).css('height', layoutHeight);\r\n\t\t\t\t\tjQuery(editor.el.firstChild).css('height', '100%');\r\n\t\t\t\t}\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBEditPanel', jslet.ui.DBEditPanel);\r\njslet.ui.DBEditPanel.htmlTemplate = '<div></div>';\r\n\n\"use strict\";\r\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team\r\n * Released under GNU AGPL v3.0 license\r\n */\r\n\r\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBInspector. \r\n * Display & Edit fields in two columns: Label column and Value column. If in edit mode, this control takes the field editor configuration from dataset field object. <br />\r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100};\r\n * \r\n *     //1. Declaring:\r\n *       <div id='ctrlId' data-jslet='type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100' />\r\n *       or\r\n *       <div data-jslet='jsletParam' />\r\n * \r\n *     //2. Binding\r\n *       <div id=\"ctrlId\"  />\r\n *       //Js snippet\r\n *       var el = document.getElementById('ctrlId');\r\n *       jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *       jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBInspector = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,columnCount,layout';\r\n\t\t\r\n\t\tZ._columnCount = 1;\r\n\t\t\r\n\t\tZ._layout = null;\r\n\t\t\r\n\t\tZ._includeFields = null;\r\n\t\t\r\n\t\tZ._excludeFields = null;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get column count.\r\n\t * \r\n\t * @param {Integer | undefined} columnCount Column count.\r\n\t * \r\n\t * @return {this | undefined}\r\n\t */\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the edit layout.\r\n\t * \r\n\t * @param {Object[] | undefined} layout Edit layout.\r\n\t * @param {String} layout.field Field name.\r\n\t * @param {Boolean} layout.visible Visible of field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.prefix The prefix part of the field.\r\n\t * @param {jslet.ui.FieldControlAddon[]} layout.suffix The suffix part of the field.\r\n\t * \r\n\t * @return {this | Object[]}\r\n\t */\r\n\tlayout: function(layout) {\r\n\t\tif(layout === undefined) {\r\n\t\t\treturn this._layout;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.layout', layout).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = layout.length; i < len; i++) {\r\n\t\t\tfldCfg = layout[i];\r\n\t\t\tjslet.Checker.test('DBInspector.layout.field', fldCfg.field).isString().required();\r\n\t\t}\r\n\t\tthis._layout = layout;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\tincludeFields: function(includeFields) {\r\n\t\tif(includeFields === undefined) {\r\n\t\t\treturn this._includeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.includeFields', includeFields).isArray();\r\n\t\tthis._includeFields = includeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Specify which fields are not displayed in edit panel.\r\n\t * \r\n\t * @param {String[] | undefined} includeFields Field names which are not displayed in edit panel.\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\r\n\texcludeFields: function(excludeFields) {\r\n\t\tif(excludeFields === undefined) {\r\n\t\t\treturn this._excludeFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.excludeFields', excludeFields).isArray();\r\n\t\tthis._excludeFields = excludeFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar colCnt = Z._columnCount;\r\n\t\tif (colCnt) {\r\n\t\t\tcolCnt = parseInt(colCnt);\r\n\t\t}\r\n\t\tif (colCnt && colCnt > 0) {\r\n\t\t\tZ._columnCount = colCnt;\r\n\t\t} else {\r\n\t\t\tZ._columnCount = 1;\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t_calcLayout: function () {\r\n\t\tvar Z = this,\r\n\t\t\tallFlds = Z._dataset.getNormalFields(), \r\n\t\t\tfldObj, i, fldName, found, fldLayout,\r\n\t\t\tfcnt = allFlds.length,\r\n\t\t\tlayoutCnt = Z._layout ? Z._layout.length : 0,\r\n\t\t\tfldLayouts = [];\r\n\t\t\r\n\t\tvar exFields = Z._excludeFields,\r\n\t\t\tinFields = Z._includeFields;\r\n\t\tfor(i = 0; i < fcnt; i++) {\r\n\t\t\tfldObj = allFlds[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfound = false;\r\n\t\t\tif(inFields && inFields.indexOf(fldName) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfound = false;\r\n\t\t\tfor(var j = 0; j < layoutCnt; j++) {\r\n\t\t\t\tfldLayout = Z._layout[j];\r\n\t\t\t\tif(fldLayout.field !== fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfound = true;\r\n\t\t\t\tif(fldLayout.visible === undefined || fldLayout.visible) {\r\n\t\t\t\t\tfldLayouts.push(fldLayout);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tfldLayouts.push({field: fldName});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fldLayouts;\r\n\t},\r\n\r\n\t_calcLabelWidth: function(fields) {\r\n\t\tvar Z = this,\r\n\t\t\tfcnt = fields.length,\r\n\t\t\tcolumnCnt = Math.min(fcnt, Z._columnCount), \r\n\t\t\tarrLabelWidth = [],\r\n\t\t\tw, c, i;\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\tarrLabelWidth[i] = 0;\r\n\t\t}\r\n\t\tvar charWidth = jslet.ui.textMeasurer.getWidth('*');\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar dsObj = Z._dataset, fldObj, fldName;\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldName = fields[i].field; \r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tw = Math.round(jslet.ui.textMeasurer.getWidth(fldObj.displayLabel()) + charWidth) + 15;\r\n\t\t\tif (arrLabelWidth[c] < w) {\r\n\t\t\t\tarrLabelWidth[c] = w;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\treturn arrLabelWidth;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.removeAllChildControls();\r\n\t\t\r\n\t\tif (!jqEl.hasClass('jl-inspector'))\r\n\t\t\tjqEl.addClass('jl-inspector jl-round5');\r\n\t\tvar totalWidth = jqEl.width(),\r\n\t\t\tallFlds = Z._dataset.getFields();\r\n\t\tjqEl.html('<table cellpadding=0 cellspacing=0 style=\"margin:0;padding:0;table-layout:fixed;width:100%;height:100%\"><tbody></tbody></table>');\r\n\t\tvar fldObj, i, found, visible, fldName, cfgFld, fcnt,\r\n\t\t\tfieldLayouts = Z._calcLayout();\r\n\t\tfcnt = fieldLayouts.length;\r\n\t\tif (fcnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tcolumnCnt = Math.min(fcnt, Z._columnCount), \r\n\t\t\tarrLabelWidth = Z._calcLabelWidth(fieldLayouts);\r\n\t\t\r\n\t\tvar otable = Z.el.firstChild,\r\n\t\t\ttHead = otable.createTHead(), otd, otr = tHead.insertRow(-1);\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.style.width = arrLabelWidth[i] + 'px';\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t}\r\n\t\t\r\n\t\tvar oldRowNo = -1, oldC = -1, rowNo, odiv, oLabel, editor, fldCtrl, dbCtrl, c, fldCfg;\r\n\t\tZ.preRowIndex = -1;\r\n\t\tvar dsObj = Z._dataset;\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldCfg = fieldLayouts[i];\r\n\t\t\tfldName = fldCfg.field;\r\n\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\trowNo = Math.floor(i / columnCnt);\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tif (oldRowNo != rowNo) {\r\n\t\t\t\totr = otable.insertRow(-1);\r\n\t\t\t\toldRowNo = rowNo;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.labelColCls;\r\n\t\t\t\r\n\t\t\toLabel = document.createElement('label');\r\n\t\t\totd.appendChild(oLabel);\r\n\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\tfield: fldName\r\n\t\t\t});\r\n\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.editorColCls;\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.align = 'left';\r\n\t\t\todiv = document.createElement('div');\r\n\t\t\todiv.noWrap = true;\r\n\t\t\totd.appendChild(odiv);\r\n\t\t\tfldCtrl = {type: 'DBPlace'};\r\n\t\t\tfldCtrl.dataset = Z._dataset;\r\n\t\t\tfldCtrl.field = fldName;\r\n\t\t\tfldCtrl.prefix = fldCfg.prefix;\r\n\t\t\tfldCtrl.suffix = fldCfg.suffix;\r\n\t\t\t\r\n\t\t\teditor = jslet.ui.createControl(fldCtrl, odiv);\r\n\t\t\tif (!editor.isCheckBox) {\r\n\t\t\t\teditor.el.style.width = '100%';//editorWidth - 10 + 'px';\r\n\t\t\t}\r\n\t\t\tZ.addChildControl(editor);\r\n\t\t} // end for\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.DBINSPECTOR = {\r\n\tlabelColCls: 'jl-inspector-label',\r\n\teditorColCls: 'jl-inspector-editor'\r\n};\r\n\r\njslet.ui.register('DBInspector', jslet.ui.DBInspector);\r\njslet.ui.DBInspector.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBError. Display dataset error. Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBError\",dataset:\"employee\"};\r\n *  \r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBError\",dataset:\"employee\"' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *  \r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBError = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'styleClass,dataset';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-errorpanel')) {\r\n\t\t\tjqEl.addClass('jl-errorpanel');\r\n\t\t}\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType == jslet.data.RefreshEvent.ERROR) {\r\n\t\t\tthis.el.innerHTML = evt.message || '';\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n});\r\n\r\njslet.ui.register('DBError', jslet.ui.DBError);\r\njslet.ui.DBError.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.DBControl\r\n * \r\n * DBPageBar. Features: <br />\r\n * 1. First page, Prior Page, Next Page, Last Page; <br />\r\n * 2. Can go to specified page; <br />\r\n * 3. Can specify page size on runtime; <br />\r\n * 4. Need not write any code; <br />\r\n * \r\n * Example:\r\n * \r\n *     @example\r\n *      var jsletParam = {type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]};\r\n *\r\n *     //1. Declaring:\r\n *      <div data-jslet='type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]' />\r\n *      or\r\n *      <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *      <div id=\"ctrlId\"  />\r\n *      //Js snippet\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n */\r\njslet.ui.DBPageBar = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'styleClass,dataset,showPageSize,pageSizeList';\r\n\t\tZ._showPageSize = true;\r\n\t\t\r\n\t\tZ._pageSizeList = [100, 200, 500];\r\n\r\n\t\tZ._currPageCount = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Identify whether show \"Page Size\" part or not.\r\n\t * \r\n\t * @param {Boolean | undefined} showPageSize True - show \"PageSize\", false - otherwise.\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tshowPageSize: function(showPageSize) {\r\n\t\tif(showPageSize === undefined) {\r\n\t\t\treturn this._showPageSize;\r\n\t\t}\r\n\t\tthis._showPageSize = showPageSize ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get a list of page size.\r\n\t * \r\n\t * @param {Integer[] | undefined} pageSizeList Array of integer, like: [50,100,200].\r\n\t * \r\n\t * @return {this | Integer[]} \r\n\t */\r\n\tpageSizeList: function(pageSizeList) {\r\n\t\tif(pageSizeList === undefined) {\r\n\t\t\treturn this._pageSizeList;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBPageBar.pageSizeList', pageSizeList).isArray();\r\n\t\tvar size;\r\n\t\tfor(var i = 0, len = pageSizeList.length; i < len; i++) {\r\n\t\t\tsize = pageSizeList[i];\r\n\t\t\tjslet.Checker.test('DBPageBar.pageSizeList', size).isGTZero();\r\n\t\t}\r\n\t\tthis._pageSizeList = pageSizeList;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-pagebar')) {\r\n\t\t\tjqEl.addClass('jl-pagebar');\r\n\t\t}\r\n\t\tvar template = [\r\n\t\t'<div class=\"form-inline form-group\">',\r\n\t  \t'<select class=\"form-control input-sm jl-pb-pagesize\" title=\"', jsletlocale.DBPageBar.pageSize, '\"></select>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-first\" title=\"', jsletlocale.DBPageBar.first, '\"><i class=\"fa fa-angle-double-left\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-prior\" title=\"', jsletlocale.DBPageBar.prior, '\"><i class=\"fa fa-angle-left\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-next\" title=\"', jsletlocale.DBPageBar.next, '\"><i class=\"fa fa-angle-right\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-last\" title=\"', jsletlocale.DBPageBar.last, '\"><i class=\"fa fa-angle-double-right\" aria-hidden=\"true\"></i></button>',\r\n\t    '<button class=\"btn btn-default btn-sm jl-pb-refresh\" title=\"', jsletlocale.DBPageBar.refresh, '\"><i class=\"fa fa-refresh\" aria-hidden=\"true\"></i></button>',\r\n\t  \t'<select class=\"form-control input-sm jl-pb-pagenum\" title=\"', jsletlocale.DBPageBar.pageNum, '\"></select>',\r\n\t    '</div>'];\r\n\t\t\r\n\t\tjqEl.html(template.join(''));\r\n\r\n\t\tZ._jqPageSize = jqEl.find('.jl-pb-pagesize');\r\n\t\tif (Z._showPageSize) {\r\n\t\t\tZ._jqPageSize.removeClass('jl-hidden');\r\n\t\t\tvar pgSizeList = Z._pageSizeList;\r\n\t\t\tvar cnt = pgSizeList.length, s = '', pageSize;\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tpageSize = pgSizeList[i];\r\n\t\t\t\ts += '<option value=\"' + pageSize + '\">' + pageSize + '</option>';\r\n\t\t\t}\r\n\r\n\t\t\tZ._jqPageSize.html(s);\r\n\t\t\tif(cnt > 0) {\r\n\t\t\t\tZ._dataset.pageSize(parseInt(pgSizeList[0]));\r\n\t\t\t}\r\n\t\t\tZ._jqPageSize.on('change', function (event) {\r\n\t\t\t\tvar dsObj = Z.dataset();\r\n\t\t\t\tdsObj.pageNo(1);\r\n\t\t\t\tdsObj.pageSize(parseInt(this.value));\r\n\t\t\t\tdsObj.requery();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._jqPageSize.addClass('jl-hidden');\r\n\t\t}\r\n\r\n\t\tZ._jqFirstBtn = jqEl.find('.jl-pb-first');\r\n\t\tZ._jqPriorBtn = jqEl.find('.jl-pb-prior');\r\n\t\tZ._jqNextBtn = jqEl.find('.jl-pb-next');\r\n\t\tZ._jqLastBtn = jqEl.find('.jl-pb-last');\r\n\t\tZ._jqRefreshBtn = jqEl.find('.jl-pb-refresh');\r\n\t\tZ._jqPageNum = jqEl.find('.jl-pb-pagenum');\r\n\t\t\r\n\t\tZ._jqFirstBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset();\r\n\t\t\tdsObj.pageNo(1);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqPriorBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset(),\r\n\t\t\t\tnum = dsObj.pageNo();\r\n\t\t\tif (num == 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(num - 1);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqPageNum.on('change', function (event) {\r\n\t\t\tvar dsObj = Z.dataset();\r\n\t\t\tvar num = parseInt(this.value);\r\n\t\t\tdsObj.pageNo(num);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqNextBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset(),\r\n\t\t\t\tnum = dsObj.pageNo();\r\n\t\t\tif (num >= dsObj.pageCount()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(++num);\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqLastBtn.on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dsObj = Z.dataset();\r\n\r\n\t\t\tif (dsObj.pageCount() < 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdsObj.pageNo(dsObj.pageCount());\r\n\t\t\tdsObj.requery();\r\n\t\t});\r\n\r\n\t\tZ._jqRefreshBtn.on('click', function (event) {\r\n\t\t\tZ.dataset().requery();\r\n\t\t});\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType != jslet.data.RefreshEvent.CHANGEPAGE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._refreshPageNum();\r\n\t\tthis._refreshButtonStatus();\r\n\t},\r\n\r\n\t_refreshPageNum: function() {\r\n\t\tvar Z = this,\r\n\t\t\tnum = Z._dataset.pageNo(), \r\n\t\t\tcount = Z._dataset.pageCount();\r\n\t\tif(count !== Z._currPageCount) {\r\n\t\t\tvar s = '';\r\n\t\t\tfor(var i = 1; i <= count; i++) {\r\n\t\t\t\ts += '<option value=\"' + i + '\">' + i + '</option>';\r\n\t\t\t}\r\n\t\t\tZ._jqPageNum.html(s);\r\n\t\t\tZ._currPageCount = count;\r\n\t\t}\r\n\t\tZ._jqPageNum.val(num);\r\n\t},\r\n\t\r\n\t_refreshButtonStatus: function() {\r\n\t\tvar Z = this, \r\n\t\t\tds = Z._dataset,\r\n\t\t\tpageNo = ds.pageNo(),\r\n\t\t\tpageCnt = ds.pageCount(),\r\n\t\t\tprevDisabled = true,\r\n\t\t\tnextDisabled = true;\r\n\t\tif(pageNo > 1) {\r\n\t\t\tprevDisabled = false;\r\n\t\t}\r\n\t\tif(pageNo < pageCnt) {\r\n\t\t\tnextDisabled = false;\r\n\t\t}\r\n\t\tZ._jqFirstBtn.attr('disabled', prevDisabled);\r\n\t\tZ._jqPriorBtn.attr('disabled', prevDisabled);\r\n\t\tZ._jqNextBtn.attr('disabled', nextDisabled);\r\n\t\tZ._jqLastBtn.attr('disabled', nextDisabled);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z._jqPageSize) {\r\n\t\t\tZ._jqPageSize.off();\r\n\t\t\tZ._jqPageSize = null;\r\n\t\t}\r\n\t\tZ._jqFirstBtn.off();\r\n\t\tZ._jqPriorBtn.off();\r\n\t\tZ._jqNextBtn.off();\r\n\t\tZ._jqLastBtn.off();\r\n\t\tZ._jqPageNum.off();\r\n\t\tZ._jqRefreshBtn.off();\r\n\r\n\t\tZ._jqFirstBtn = null;\r\n\t\tZ._jqPriorBtn = null;\r\n\t\tZ._jqNextBtn = null;\r\n\t\tZ._jqLastBtn = null;\r\n\t\tZ._jqPageNum = null;\r\n\t\tZ._jqRefreshBtn = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBPageBar', jslet.ui.DBPageBar);\r\njslet.ui.DBPageBar.htmlTemplate = '<div></div>';\r\n\n/**\r\n * A dialog for dataset batch editing. Example:\r\n * \r\n *     @example\r\n *     var dialog = new jslet.ui.BatchEditDialog(dsObj, 'fld1,fld2');\r\n *     dialog.show();\r\n *       \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name which need to be modified in bulk.\r\n * @param {String[] | String} editFields A String array or a string which separate by comma, to identify which fields will be modified in bulk.\r\n */\r\njslet.ui.BatchEditDialog = function(dataset, editFields) {\r\n\tjslet.Checker.test('BatchEditDialog#dataset', dataset).required();\r\n\tif(editFields && jslet.isString(editFields)) {\r\n\t\teditFields = editFields.split(',');\r\n\t}\r\n\tjslet.Checker.test('BatchEditDialog#editFields', editFields).isArray();\r\n\tdataset = jslet.data.getDataset(dataset);\r\n\tvar Z = this;\r\n\tZ._dataset = dataset;\r\n\tZ._editFields = editFields;\r\n\tZ._onChanging = null;\r\n\tZ._batchDataset = new jslet.data.Dataset({name: dataset.name() + '_batch' + jslet.nextId(), fields: []});\r\n\tvar fields = dataset.getEditableFields(), \r\n\t\tfldName, i;\r\n\tif(editFields && editFields.length > 0) {\r\n\t\tfor(i = editFields.length - 1; i >= 0; i--) {\r\n\t\t\tfldName = editFields[i];\r\n\t\t\tif(fields.indexOf(fldName) < 0) {\r\n\t\t\t\teditFields.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfields = editFields;\r\n\t}\r\n\tvar fldObj;\r\n\tfor(i = fields.length - 1; i >= 0; i--) {\r\n\t\tfldName = fields[i];\r\n\t\tfldObj = dataset.getField(fldName);\r\n\t\t//If the field value is unique, it can't be batch modified.\r\n\t\tif(fldObj.unique()) {\r\n\t\t\tfields.splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tZ._batchDataset.addFieldFromDataset(dataset, fields);\r\n\tfields = Z._batchDataset.getNormalFields();\r\n\tvar len = fields.length;\r\n\tfor(i = 0; i < len; i++) {\r\n\t\tfldObj = fields[i];\r\n\t\tfldObj.defaultValue(null);\r\n\t\tfldObj.defaultExpr(null);\r\n\t\tfldObj.required(false);\r\n\t}\r\n};\r\n\r\njslet.ui.BatchEditDialog.prototype = {\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Changing event. Fired when modify the field's value. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var dialog = new jslet.ui.BatchEditDialog(dsObj, 'fld1,fld2');\r\n\t *     dialog.onChanging(function(fldName, theValue) {});\r\n\t *     dialog.show();\r\n\t *     \r\n\t * @param {Function} onChanging Changing event handler.\r\n\t * @param {String} onChanging.fieldName The changing field name;\r\n\t * @param {Object} onChanging.theValue The changing field value;\r\n\t * \r\n\t * @return {Boolean} True - The terminal the default field changing action. False - Perform the default changing action.\r\n\t */\t\r\n\tonChanging: function(onChanging) {\r\n\t\tif(onChanging === undefined) {\r\n\t\t\treturn this._onChanging;\r\n\t\t}\r\n\t\tthis._onChanging = onChanging;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show the batch edit dialog.\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._batchDataset.records(null);\r\n\t\t\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar bedLocale = jsletlocale.BatchEditDialog;\r\n\t\t\r\n\t\tvar opt = { type: 'window', caption: bedLocale.caption, isCenter: true, resizable: true, minimizable: false, maximizable: false, animation: 'fade', styleClass: 'jl-bedlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar onlySelectedId = jslet.nextId(), \r\n\t\t\tonlyNullId = jslet.nextId();\r\n\t\t\r\n\t\tvar html = [\r\n\t\t            '<div class=\"input-group input-group-sm\">',\r\n\t\t            '<div class=\"jl-bedlg-fields\" data-jslet=\"type:\\'DBInspector\\',dataset:\\'', this._batchDataset.name(), \r\n\t\t            '\\'\"></div></div>',\r\n\r\n\t\t            '<div class=\"input-group input-group-sm jl-bedlg-option\">',\r\n\t\t            '<div class=\"col-sm-6\"><label><input id=\"' + onlySelectedId + '\" name=\"jlOnlySelected\" type=\"checkbox\" aria-label=\"...\">',\r\n\t\t            bedLocale.onlySelected,\r\n\t\t            '</label></div>',\r\n\t\t            '<div class=\"col-sm-6\"><label><input id=\"' + onlyNullId + '\" name=\"jlOnlyNull\" type=\"checkbox\" aria-label=\"...\">',\r\n\t\t            bedLocale.onlyNullValue,\r\n\t\t            '</label></div>',\r\n\t\t            '</div>',\r\n\t\t\t\t\t\r\n\t\t            '<div class=\"input-group input-group-sm jl-bedlg-toolbar\"><label class=\"control-label col-sm-7\">&nbsp</label>',\r\n\t\t            '<div class=\"col-sm-5\"><button name=\"jlbtnOk\" class=\"btn btn-default btn-sm\">',\t\t            \r\n\t\t            bedLocale.ok,\r\n\t\t            '</button><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm\">',\r\n\t\t            bedLocale.cancel,\r\n\t\t            '</button></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el), \r\n\t\t\tZ = this;\r\n\t\t\r\n\t\tjqEl.find('[name=jlbtnOk]').on('click', function(event) {\r\n\t\t\tvar onlySelected = jqEl.find('[name=jlOnlySelected]').prop('checked');\r\n\t\t\tvar onlyNull = jqEl.find('[name=jlOnlyNull]').prop('checked');\r\n\t\t\tif(Z._modifyData(onlySelected, onlyNull)) {\r\n\t\t\t\towin.close();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.find('[name=jlbtnCancel]').on('click', function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\t\r\n\t\tjslet.ui.install(owin.el);\r\n\t},\r\n\t\r\n\t_modifyData: function(onlySelected, onlyNull) {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._batchDataset;\r\n\t\tdsObj.confirm();\r\n\t\tif(dsObj.recordCount() === 0 || dsObj.existDatasetError()) {\r\n\t\t\tjslet.showInfo(jsletlocale.BatchEditDialog.errorData);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tdsObj.first();\r\n\t\tvar fldNames = [], fldObj, fldValue, inputValue = {},\r\n\t\t\tallFldObjs = dsObj.getNormalFields();\r\n\t\tfor(var i = 0, len = allFldObjs.length; i < len; i++) {\r\n\t\t\tfldObj = allFldObjs[i];\r\n\t\t\tfldValue = fldObj.getValue();\r\n\t\t\tif(fldValue !== null && fldValue !== undefined) {\r\n\t\t\t\tfldNames.push(fldObj.name());\r\n\t\t\t\tinputValue[fldObj.name()] = fldValue;\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\tvar cnt = fldNames.length, fldName;\r\n\t\tZ._dataset.iterate(function() {\r\n\t\t\tif(onlySelected && !this.selected()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var j = 0; j < cnt; j++) {\r\n\t\t\t\tfldName = fldNames[j];\r\n\t\t\t\tif(onlyNull) {\r\n\t\t\t\t\tfldValue = this.getFieldValue(fldName);\r\n\t\t\t\t\tif(fldValue !== null && fldValue !== '' && fldValue !== undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onChanging) {\r\n\t\t\t\t\tif(Z._onChanging.call(this, fldName, inputValue[fldName])) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.setFieldValue(fldName, inputValue[fldName]);\r\n\t\t\t}\r\n\t\t\tthis.confirm();\r\n\t\t});\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n\n/**\r\n * Show chart for a dataset. Example:\r\n * \r\n *     @example\r\n *     var dialog = new jslet.ui.ChartDialog(dsObj, options);\r\n *     dialog.show();\r\n *       \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name which the chart is shown on.\r\n * @param {Object} options Chart dialog options.\r\n * @param {Object} options.chartTypes See property \"chartTypes\".\r\n * @param {Object} options.categoryField See property \"categoryField\".\r\n * @param {Object} options.valueFields See property \"valueFields\".\r\n * @param {Object} options.excludeValueFields See property \"excludeValueFields\".\r\n * @param {Object} options.width See property \"width\".\r\n * @param {Object} options.height See property \"height\".\r\n */\r\njslet.ui.ChartDialog = function(dataset, options) {\r\n\tjslet.Checker.test('ChartDialog#dataset', dataset).required();\r\n\t\r\n\tvar Z = this;\r\n\tZ._dataset = jslet.data.getDataset(dataset);\r\n\t\r\n\tZ._width = 800;\r\n\tZ._height = 500;\r\n\r\n\tfunction setProp(options, propName) {\r\n\t\tif(options && options[propName] !== undefined && Z[propName] !== undefined) {\r\n\t\t\tZ[propName](options[propName]);\r\n\t\t}\r\n\t}\r\n\tsetProp(options, 'chartTypes');\r\n\tsetProp(options, 'categoryField');\r\n\tsetProp(options, 'valueFields');\r\n\tsetProp(options, 'excludeValueFields');\r\n\tsetProp(options, 'width');\r\n\tsetProp(options, 'height');\r\n\t\r\n\tZ._dlgId = null;\r\n\tZ._chartId = null;\r\n\tZ._parsedValueFields = null;\r\n\t\r\n\tZ._chartSettingDs = null;\r\n\tZ._chartSettingDsName = null;\r\n\tZ._chartTypeDs = null;\r\n\tZ._initialize();\r\n};\r\n\r\njslet.ui.ChartDialog.prototype = {\r\n\t\t\r\n\t_initialize: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartLocale = jsletlocale.ChartDialog;\r\n\t\tvar chartTypes = [{code: 'line', name:  chartLocale.ctLine}, \r\n\t\t                  {code: 'bar', name:  chartLocale.ctBar},\r\n\t\t                  {code: 'pie', name:  chartLocale.ctPie},\r\n\t\t\t              {code: 'stackbar', name:  chartLocale.ctStackBar}],\r\n\t\t\tchartTypeDs = new jslet.data.Dataset({name: 'chartTypeDs' + jslet.nextId(), isEnum: true, defaultValue: 'line', \r\n\t\t\t\trecords: chartTypes});\r\n\t\tvar ranges = [{code: jslet.data.RecordRange.ALL, name: chartLocale.rrAll}, \r\n\t\t              {code: jslet.data.RecordRange.CURRENT, name:  chartLocale.rrCurrent},\r\n\t\t\t          {code: jslet.data.RecordRange.SELECTED, name:  chartLocale.rrSelected}],\r\n\t\t\trangeDs = new jslet.data.Dataset({name: 'rangeDs' + jslet.nextId(), isEnum: true, defaultValue: 'line', \r\n\t\t\t\trecords: ranges});\r\n\t\t\r\n\t\tZ._chartTypeDs = chartTypeDs;\r\n\t\tvar valueFldLkDs = new jslet.data.Dataset({name: 'chartDlgDs' + jslet.nextId(), isEnum: true});\r\n\t\tvar fldCfg = [{name: 'chartType', dataType: 'S', label: chartLocale.chartType, lookup: {dataset: chartTypeDs}, required: true}, \r\n\t\t              {name: 'recordRange', dataType: 'N', label: chartLocale.recordRange, lookup: {dataset: rangeDs}, required: true, defaultValue: jslet.data.RecordRange.ALL},\r\n\t\t              {name: 'reverse', dataType: 'B', label: chartLocale.reverse, defaultValue: false, visible: false},\r\n\t\t              {name: 'valueFields', dataType: 'S', label: chartLocale.valueFields, required: true, lookup: {dataset: valueFldLkDs}, \r\n\t\t\tvalueStyle: jslet.data.FieldValueStyle.MULTIPLE, editControl: {type:\"DBComboSelect\", textReadOnly: true}}];\r\n\t\tZ._chartSettingDsName = 'chartSetting' + jslet.nextId();\r\n\t\tZ._chartSettingDs = new jslet.data.Dataset({name: Z._chartSettingDsName, fields: fldCfg});\r\n\t\tZ._chartSettingDs.appendRecord();\r\n\t\tZ._chartSettingDs.onFieldChanged(jQuery.proxy(Z._doFieldChanged, Z));\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the valid chart types, the optional values are: 'line', 'stackline', 'pie', 'bar', 'stackbar'.\r\n\t *     \r\n\t * @param {String[] | undefined} chartTypes The valid chart types;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\tchartTypes: function(chartTypes) {\r\n\t\tif(chartTypes === undefined) {\r\n\t\t\treturn this._chartTypes;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#chartTypes', chartTypes).isArray();\r\n\t\tthis._chartTypes = chartTypes;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the category field name of chart.\r\n\t *     \r\n\t * @param {String | undefined} categoryField The category field name;\r\n\t * \r\n\t * @return {this | String}\r\n\t */\t\r\n\tcategoryField: function(categoryField) {\r\n\t\tif(categoryField === undefined) {\r\n\t\t\treturn this._categoryField;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#categoryField', categoryField).isString().required();\r\n\t\tthis._categoryField = categoryField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get the value fields name of chart. If this property is not set, it will use the all number fields as value fields.\r\n\t * \r\n\t * @param {String[] | undefined} valueFields The value field name;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\tvalueFields: function(valueFields) {\r\n\t\tif(valueFields === undefined) {\r\n\t\t\treturn this._valueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#valueFields', valueFields).isArray();\r\n\t\tthis._valueFields = valueFields;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @property\r\n\t * \r\n\t * Set or get which the fields name can not be value fields.\r\n\t *     \r\n\t * @param {String[] | undefined} valueFields The exclude value field names;\r\n\t * \r\n\t * @return {this | String[]}\r\n\t */\t\r\n\texcludeValueFields: function(excludeValueFields) {\r\n\t\tif(excludeValueFields === undefined) {\r\n\t\t\treturn this._excludeValueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog#excludeValueFields', excludeValueFields).isArray();\r\n\t\tthis._excludeValueFields = excludeValueFields;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Set or get the dialog width.\r\n\t * \r\n\t * @param {Integer | undefined} width Dialog width;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog.width', width).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get the dialog height.\r\n\t * \r\n\t * @param {Integer | undefined} height Dialog height;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('ChartDialog.height', height).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show chart dialog.\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.Checker.test('ChartDialog#categoryField', Z._categoryField).isString().required();\r\n\t\tZ._refreshValueFields();\r\n\t\t\r\n\t\tif(!Z._parsedValueFields || Z._parsedValueFields.length === 0) {\r\n\t\t\tjslet.ui.info(jsletlocale.ChartDialog.valueFieldsRequired);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartTypes && Z._chartTypes.length > 0) {\r\n\t\t\tZ._chartTypeDs.filter('inArray([code], ' + JSON.stringify(Z._chartTypes) + ')');\r\n\t\t\tZ._chartTypeDs.filtered(true);\r\n\t\t} else {\r\n\t\t\tZ._chartTypeDs.filtered(false);\r\n\t\t}\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\tjslet('#' + Z._chartId).drawChart();\r\n\t},\r\n\t\r\n\t_refreshValueFields: function() {\r\n\t\tvar Z = this, i, len, fldObj, fldName;\r\n\t\tif(Z._valueFields && Z._valueFields.length > 0) {\r\n\t\t\tZ._parsedValueFields = Z._valueFields;\r\n\t\t} else {\r\n\t\t\tZ._parsedValueFields = [];\r\n\t\t\tvar fields = Z._dataset.getNormalFields(),\r\n\t\t\t\texFields = Z._excludeValueFields;\r\n\t\t\tfor(i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(fldObj.dataType() !== jslet.data.DataType.NUMBER || fldObj.lookup()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(exFields && exFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ._parsedValueFields.push(fldName); \r\n\t\t\t}\r\n\t\t}\r\n\t\tvar records = [], values = [];\r\n\t\tfor(i = 0, len = Z._parsedValueFields.length; i < len; i++) {\r\n\t\t\tfldName = Z._parsedValueFields[i];\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\trecords.push({code: fldName, name: fldObj.displayLabel()});\r\n\t\t\tvalues.push(fldName);\r\n\t\t}\r\n\t\tvar dsObj = Z._chartSettingDs,\r\n\t\t\tlkds = dsObj.getField('valueFields').lookup().dataset();\r\n\t\tdsObj.setFieldValue('valueFields', values);\r\n\t\tlkds.records(records);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar Z = this,\r\n\t\t\tchartLocale = jsletlocale.ChartDialog;\r\n\t\tvar opt = { type: 'window', caption: chartLocale.caption, isCenter: true, resizable: true, minimizable: false, maximizable: true, animation: 'fade', styleClass: 'jl-chartdlg', \r\n\t\t\t\tonSizeChanged: function() {\r\n\t\t\t\t\twindow.setTimeout(function() {jslet('#' + Z._chartId).drawChart();}, 10);\r\n\t\t\t\t}};\r\n\t\tif(Z._width) {\r\n\t\t\topt.width = Z._width;\r\n\t\t}\r\n\t\tif(Z._height) {\r\n\t\t\topt.height = Z._height;\r\n\t\t}\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tvar chartCfg = \"type: 'DBChart', dataset: '\" + Z._dataset.name() + \r\n\t\t\t\"', categoryField: '\" + Z._categoryField + \r\n\t\t\t\"', valueFields: '\" + Z._parsedValueFields.join(',') + \"'\";\r\n\t\tvar html = '';\r\n\t\thtml += '<div class=\"jl-chartdlg-editor\" data-jslet=\"type: \\'DBEditPanel\\', dataset: \\'' + Z._chartSettingDsName + \r\n\t\t'\\'\"></div>';\r\n\t\thtml += '<div class=\"jl-chartdlg-chart\" data-jslet=\"' + chartCfg + '\" style=\"width: 100%;height: 100%\"></div>';\r\n\t\towin.setContent(html);\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\t\r\n\t\tjslet.ui.install(owin.el, function() {\r\n\t\t\tZ._chartId = jqEl.find('.jl-chartdlg-chart')[0].id;\r\n\t\t});\r\n\t},\r\n\r\n\t_doFieldChanged: function(fldName, fldValue) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._chartId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsObj = Z._chartSettingDs;\r\n\t\tvar chartObj = jslet('#' + Z._chartId);\r\n\t\tif(fldName === 'chartType') {\r\n\t\t\tif(fldValue === 'pie') {\r\n\t\t\t\tchartObj.chartType(fldValue);\r\n\t\t\t\tdsObj.getField('valueFields').valueStyle(jslet.data.FieldValueStyle.NORMAL);\r\n\t\t\t\tvar valueFlds = dsObj.getFieldValue('valueFields');\r\n\t\t\t\tif(valueFlds && jslet.isArray(valueFlds) && valueFlds.length > 1) {\r\n\t\t\t\t\tdsObj.setFieldValue('valueFields', valueFlds[0]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdsObj.getField('valueFields').valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fldName === 'valueFields' && jslet.isArray(fldValue)) {\r\n\t\t\tfldValue = fldValue.join(',');\r\n\t\t}\r\n\t\tchartObj[fldName](fldValue);\r\n\t\t\r\n\t\tchartObj.drawChart();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tvar Z = this;\r\n    \tif(Z._chartSettingDs) {\r\n    \t\tvar lkds = Z._chartSettingDs.getField('valueFields').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tZ._chartSettingDs.destroy();\r\n    \t\tZ._chartSettingDs = null;\r\n    \t}\r\n    \tZ._dataset = null;\r\n    \t\r\n\t}\r\n\r\n};\r\n\r\n\n/**\r\n * @class\r\n * \r\n * Export dialog for specified Dataset object. Example:\r\n * \r\n *     @example\r\n *     var dlg = new jslet.ui.ExportDialog('employee');\r\n *     //var dlg = new jslet.ui.ExportDialog(dsObj, {includeFields: ['fld1', 'fld2']});\r\n *     dlg.show('employee.xml');\r\n * \r\n * @param {jslet.data.Dataset | String} dataset Dataset object or dataset name.\r\n * @param {Object} options (Optional)Export options. \r\n * @param {Boolean} options.hasSchemaSection Identify whether export schema section is visible or not. \r\n * @param {String[]} options.includeFields Specify which fields need export. \r\n * @param {String[]} options.excludeFields Specify which fields need not export. \r\n */\r\njslet.ui.ExportDialog = function(dataset, options) {\r\n\tthis._dataset = jslet.data.getDataset(dataset);\r\n\t\r\n\tthis._exportDataset = null;\r\n\t\r\n\tthis._dlgId = null;\r\n\t\r\n\tthis._onExported = null;\r\n\r\n\tthis._onQuerySchema = null;\r\n\t\r\n\tthis._onSubmitSchema = null;\r\n\t\r\n\tthis._progressBar = null;\r\n\r\n\tthis._hasSchemaSection = false;\r\n\t\r\n\tthis._includeFields = null;\r\n\t\r\n\tthis._excludeFields = null;\r\n\t\r\n\tif(options) {\r\n\t\tthis._hasSchemaSection = (options.hasSchemaSection? true: false);\r\n\t\tthis._includeFields = options.includeFields;\r\n\t\tthis._excludeFields = options.excludeFields;\r\n\t}\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.ExportDialog.prototype = {\r\n\t/**\r\n\t * Show export dialog.\r\n\t * \r\n\t * @param {String} fileName Excel file name.\r\n\t */\t\r\n\tshow: function(fileName) {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.confirm();\r\n\t\tif(Z._dataset.existDatasetError()) {\r\n\t        jslet.ui.confirm(jsletlocale.ExportDialog.existedErrorData, null, function(button){\r\n\t        \tif(button == 'cancel') {\r\n\t        \t\treturn;\r\n\t        \t}\r\n\t    \t\treturn Z._innerShow(fileName);\r\n\t        });\r\n\t\t} else {\r\n\t\t\treturn Z._innerShow(fileName);\r\n\t\t}\r\n        \r\n\t},\r\n\t\r\n\t_innerShow: function(fileName) {\r\n\t\tvar Z = this;\r\n    \tif(Z._hasSchemaSection) {\r\n\t    \tvar exportDsClone = Z._exportDataset;\r\n\t\t\tZ._querySchema();\r\n    \t}\r\n\t\tZ._hasDetailDataset = false;\r\n\t\tZ._refreshFields();\r\n\t\tvar jqEl = jQuery('#' + this._dlgId);\r\n\t\tvar owin = jqEl[0].jslet;\r\n\t\tfileName = (fileName || Z._dataset.description() + '.xlsx');\r\n\t\tvar jqExpportFile = jqEl.find('[name=\"jltxtExportFile\"]');\r\n\t\tjqExpportFile.val(fileName);\r\n\t\tif(Z._hasDetailDataset) {\r\n\t\t\tjqEl.find('[name=\"jlOnlyOnceDiv\"]').show();\r\n\t\t}\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\treturn owin;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Query export schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset, {hasSchemaSection: true});\r\n\t *     var querySchemaFn = function(callBackFn) {\r\n\t * \t      var exportSchemaData = [{schema: '', fields: ['field1','field2']}];\r\n\t * \t      callBackFn(exportSchemaData); //For asynchronous operation.\r\n\t * \t     //return exportSchemaData; \t//For synchronous operation.\r\n\t *     };\r\n\t * \r\n\t *     exportDialog.onQuerySchema(querySchemaFn);\r\n\t *     \r\n\t * @param {Function} onQuerySchema Query schema event handler.\r\n\t * @param {Function} onQuerySchema.callBackFn Query schema callback function.\r\n\t * @param {Function} onQuerySchema.callBackFn.exportSchemaData Query schema.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonQuerySchema: function(onQuerySchema) {\r\n\t\tif(onQuerySchema === undefined) {\r\n\t\t\treturn this._onQuerySchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onQuerySchema', onQuerySchema).isFunction();\r\n\t\tthis._onQuerySchema = onQuerySchema;\r\n\t\treturn this;\r\n\t},\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Submit export schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset, {hasSchemaSection: true});\r\n\t *     var submitSchemaFn = function(action, changedRec) {\r\n\t * \t     if(action == 'insert') {}\r\n\t * \t     if(action == 'update') {}\r\n\t * \t     if(action == 'delete') {}\r\n\t *     };\r\n\t * \r\n\t *     exportDialog.onSubmitSchema(submitSchemaFn);\r\n\t *     \r\n\t * @param {Function | undefined} onSubmitSchema Submitting schema event handler.\r\n\t * @param {String} onSubmitSchema.action Submit action, optional value: 'insert', 'update', 'delete'.\r\n\t * @param {Object} onSubmitSchema.changedRecord Changed record.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSubmitSchema: function(onSubmitSchema) {\r\n\t\tif(onSubmitSchema === undefined) {\r\n\t\t\treturn this._onSubmitSchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onSubmitSchema', onSubmitSchema).isFunction();\r\n\t\tthis._onSubmitSchema = onSubmitSchema;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Exported event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var exportDialog = new jslet.ui.ExportDialog(exportingDataset);\r\n\t *     exportDialog.onExported(function(dataset) {});\r\n\t * \r\n\t * @param {Function | undefined} onExported Exported event.\r\n\t * @param {jslet.data.Dataset} onExported.dataset Exporting dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonExported: function(onExported) {\r\n\t\tif(onExported === undefined) {\r\n\t\t\treturn this._onExported;\r\n\t\t}\r\n\t\tjslet.Checker.test('ExportDialog#onExported', onExported).isFunction();\r\n\t\tthis._onExported = onExported;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tvar edLocale = jsletlocale.ExportDialog;\r\n\t\tvar fldCfg = [\r\n\t\t    \t      {name: 'field', type: 'S', length: 100, label: 'Field Name', nullText: 'default'}, \r\n\t\t    \t      {name: 'label', type: 'S', length: 50, label: 'Field Label'},\r\n\t\t    \t      {name: 'parent', type: 'S', length: 100, label: 'Field Name'}, \r\n\t\t    \t      {name: 'required', type: 'B', length: 8, visible: false} \r\n\t\t    \t    ];\r\n\t\tvar exportLKDs = new jslet.data.Dataset({name: 'exportLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'field', codeField: 'field', nameField: 'label', parentField: 'parent', isFireGlobalEvent: false});\r\n\t\texportLKDs.onCheckSelectable(function(){\r\n\t        return !this.hasChildren(); \r\n\t    });\r\n\t\t\r\n\t\tvar expFldCfg = [\r\n    \t      {name: 'schema', type: 'S', length: 30, label: 'Export Schema'}, \r\n    \t      {name: 'fields', type: 'S', length: 500, label: 'Export Fields', visible: false, valueStyle: jslet.data.FieldValueStyle.MULTIPLE, lookup: {dataset: exportLKDs}}\r\n    \t    ];\r\n\t\tvar Z = this;\r\n    \tZ._exportDataset = new jslet.data.Dataset({name: 'exportDs' + jslet.nextId(), fields: expFldCfg, keyField: 'schema', nameField: 'schema', isFireGlobalEvent: false});\r\n\t\tvar opt = { type: 'window', caption: edLocale.caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar expHtml = '';\r\n    \tif(Z._hasSchemaSection) {\r\n    \t\texpHtml = \r\n\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\"><span class=\"input-group-addon\">' +\r\n\t            edLocale.schemaName + \r\n\t            '</span>' + \r\n\t            '<select data-jslet=\"type:\\'DBSelectView\\', displayFields:\\'schema\\'\"></select>' + \r\n\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSaveAs\">' + \r\n\t            edLocale.saveAsSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSave\">' + \r\n\t            edLocale.saveSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnDelete\">' + \r\n\t            edLocale.deleteSchema + \r\n\t            '</button></span>' +\r\n\t            '</div>';\r\n    \t}\r\n\t\tvar html = ['<div class=\"form-horizontal jl-expdlg-content\" data-jslet=\"dataset: \\'', Z._exportDataset.name(),\r\n\t\t            '\\'\">',\r\n\t\t            expHtml,\r\n\t\t            '<div class=\"input-group input-group-sm\" style=\"width: 100%;margin-bottom: 10px\">',\r\n\t\t            '<div class=\"col-sm-12 jl-expdlg-fields\" data-jslet=\"type:\\'DBList\\',field:\\'fields\\',correlateCheck:true\" style=\"padding:0px!important\"></div></div>',\r\n\r\n\t\t            '<div class=\"input-group input-group-sm\"><span class=\"input-group-addon\">',\r\n\t\t            edLocale.fileName,\r\n\t\t            '</span>',\r\n\t\t\t\t\t'<input name=\"jltxtExportFile\" class=\"form-control\"></input>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"checkbox col-sm-6\">',\r\n\t\t\t\t\t'<label>',\r\n\t\t\t\t\t'<input name=\"jlOnlySelected\" type=\"checkbox\">', edLocale.onlySelected,\r\n\t\t\t\t    '</label>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"checkbox col-sm-6\" name=\"jlOnlyOnceDiv\" style=\"display:none\">',\r\n\t\t\t\t\t'<label>',\r\n\t\t\t\t\t'<input name=\"jlOnlyOnce\" type=\"checkbox\" checked=\"true\">', edLocale.onlyOnce,\r\n\t\t\t\t    '</label>',\r\n\t\t\t\t\t'</div>',\r\n\r\n\t\t\t\t\t'<div class=\"col-sm-12\"></div>',\r\n\t\t            '<div class=\"input-group input-group-sm jl-expdlg-toolbar\" style=\"margin-bottom: 0;width:100%\">',\r\n\t\t            '<div class=\"col-sm-8\"><div name=\"jlProgressExport\" data-jslet=\"type:\\'ProgressBar\\', value: 50\" style=\"display:none;width:100%\"></div></div><div class=\"col-sm-4\"><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm jl-expdlg-toolbutton\">',\r\n\t\t            edLocale.cancel,\r\n\t\t            '</button><button name=\"jlbtnExport\" class=\"btn btn-default btn-sm jl-expdlg-toolbutton\">',\r\n\t\t            edLocale.exportData,\r\n\t\t            '</button></div></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tjslet.ui.install(owin.el);\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tZ._progressBar = jqEl.find('[name=\"jlProgressExport\"]')[0].jslet;\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnExport\"]').click(function(event) {\r\n\t\t\tZ._exportData();\r\n\t\t});\r\n\t\tjqEl.find('[name=\"jlbtnSave\"]').click(function(event) {\r\n\t\t\tZ._saveSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnSaveAs\"]').click(function(event) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnDelete\"]').click(function(event) {\r\n\t\t\tZ._deleteSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnCancel\"]').click(function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t},\r\n\t\r\n\t_saveSchema: function() {\r\n\t\tvar dsExport = this._exportDataset;\r\n\t\tif(!dsExport.getFieldValue('schema')) {\r\n\t\t\tthis._saveAsSchema();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsExport.confirm();\r\n\t\tvar currRec = dsExport.getRecord();\r\n\t\tthis._submitSchema('update', {schema: currRec.schema, fields: currRec.fields});\r\n\t},\r\n\t\r\n\t_saveAsSchema: function() {\r\n\t\tvar Z = this;\r\n\t\tjslet.ui.prompt(jsletlocale.ExportDialog.inuputSchemaLabel, null, function(button, value){\r\n\t\t\tif(button === 'ok' && value) {\r\n\t\t\t\tvar fields = Z._exportDataset.getFieldValue('fields');\r\n\t\t\t\tvar dsObj = Z._exportDataset;\r\n\t\t\t\tdsObj.disableControls();\r\n\t\t\t\tZ._isProgChanged = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdsObj.cancel();\r\n\t\t\t\t\tdsObj.appendRecord();\r\n\t\t\t\t\tdsObj.setFieldValue('schema', value);\r\n\t\t\t\t\tdsObj.setFieldValue('fields', fields);\r\n\t\t\t\t\tdsObj.confirm();\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._isProgChanged = false;\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t}\r\n\t\t\t\tvar currRec = Z._exportDataset.getRecord();\r\n\t\t\t\tZ._submitSchema('insert', {schema: currRec.schema, fields: currRec.fields});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_deleteSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tcurrRec = this._exportDataset.getRecord();\r\n\t\tvar result = this._submitSchema('delete', {schema: currRec.schema, fields: currRec.fields});\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function() {\r\n\t\t\t\tZ._exportDataset.deleteRecord();\r\n\t\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\t\tZ._refreshFields();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._exportDataset.deleteRecord();\r\n\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\tZ._refreshFields();\r\n\t\t\t}\r\n\t\t}\r\n\t},\t\r\n\r\n\t_querySchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tqueryFn = this._onQuerySchema || jslet.global.exportDialog.onQuerySchema;\r\n\t\tif(!queryFn) {\r\n\t\t\tconsole.warn('Event handler: onQuerySchema NOT set, can not query export schema!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar result = queryFn();\r\n\t\tif(jslet.isPromise(result)) {\r\n\t\t\tresult.done(function(schemaData) {\r\n\t\t\t\tif(schemaData) {\r\n\t\t\t\t\tZ._exportDataset.records(schemaData);\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\t\tZ._refreshFields();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif(result) {\r\n\t\t\t\tZ._exportDataset.records(result);\r\n\t\t\t}\r\n\t\t\tif(Z._exportDataset.recordCount() === 0) {\r\n\t\t\t\tZ._refreshFields();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_submitSchema: function(action, changedRecord) {\r\n\t\tvar Z = this,\r\n\t\t\tactionFn = Z._onSubmitSchema || jslet.global.exportDialog.onSubmitSchema;\r\n\t\tif(actionFn) {\r\n\t\t\treturn actionFn(action, changedRecord);\r\n\t\t} else {\r\n\t\t\tconsole.warn('Event handler: onSubmitSchema NOT set, can not save export schema!');\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_exportData: function() {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery('#' + Z._dlgId);\r\n\t\tvar jqExpportFile = jqEl.find('[name=\"jltxtExportFile\"]');\r\n\t\tvar fileName = jqExpportFile.val();\r\n\t\tif(!fileName || !fileName.trim()) {\r\n\t\t\tjslet.showInfo(jsletlocale.ExportDialog.fileAndFieldsRequired);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fields = Z._exportDataset.getFieldValue('fields');\r\n\t\tif(!fields || fields.length === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ExportDialog.fileAndFieldsRequired);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tjqEl.find('[name=\"jlProgressExport\"]').css('display', '');\r\n\t\tvar onlySelected = jqEl.find('[name=\"jlOnlySelected\"]').prop('checked');\r\n\t\tvar onlyOnce = jqEl.find('[name=\"jlOnlyOnce\"]').prop('checked');\r\n\t\tjslet.data.defaultXPorter.excelXPorter().exportData(Z._dataset, fileName, \r\n\t\t\t\t{includeFields: fields, onlySelected: onlySelected, onlyOnce: onlyOnce, exportAggregated: true, \r\n\t\t\tonExporting: jQuery.proxy(Z._doExporting, Z), \r\n\t\t\tonExported: jQuery.proxy(Z._doExported, Z)});\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_doExported: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onExported) {\r\n\t\t\tZ._onExported.call(Z, Z._dataset);\r\n\t\t}\r\n\t\tjslet('#' + Z._dlgId).close();\r\n\t},\r\n\t\r\n\t_doExporting: function(percent) {\r\n\t\tthis._progressBar.value(percent);\r\n\t},\r\n\t\r\n\t_refreshFields: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfieldRecords = [{field: '_all_', label: jsletlocale.ExportDialog.all}],\r\n\t\t\tfieldNames = [],\r\n\t\t\tincludeFields = Z._includeFields,\r\n\t\t\texcludeFields = Z._excludeFields;\r\n\t\t\r\n\t\tfunction addFields(fieldRecords, fieldNames, fields, parentField, isDetailDs) {\r\n\t\t\tvar fldObj, fldName, dataType;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tdataType = fldObj.dataType();\r\n\t\t\t\tvar isActionCol = (dataType === jslet.data.DataType.ACTION);\r\n\t\t\t\tvar isEdtActCol = (dataType === jslet.data.DataType.EDITACTION);\r\n\t\t\t\tif(isActionCol || isEdtActCol) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(parentField && isDetailDs) {\r\n\t\t\t\t\tfldName = parentField + '.' + fldName;\r\n\t\t\t\t}\r\n\t\t\t\tvar detailDs = fldObj.detailDataset();\r\n\t\t\t\tif(detailDs) {\r\n\t\t\t\t\tZ._hasDetailDataset = true;\r\n\t\t\t\t\tfieldRecords.push({field: fldName, label: fldObj.label(), parent: parentField || '_all_'});\r\n\t\t\t\t\taddFields(fieldRecords, fieldNames, detailDs.getNormalFields(), fldName, true);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(includeFields) {\r\n\t\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t\tif(excludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar required = fldObj.required();\r\n\t\t\t\tfieldRecords.push({field: fldName, label: fldObj.label() + (required? '<span class=\"jl-lbl-required\">*</span>': ''), \r\n\t\t\t\t\tparent: parentField || '_all_', required: required});\r\n\t\t\t\tvar fldChildren = fldObj.children();\r\n\t\t\t\tif(fldChildren) {\r\n\t\t\t\t\taddFields(fieldRecords, fieldNames, fldChildren, fldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfieldNames.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\taddFields(fieldRecords, fieldNames, this._dataset.getFields());\r\n\t\tvar exportLKDs = this._exportDataset.getField('fields').lookup().dataset();\r\n\t\texportLKDs.records(fieldRecords);\r\n\t\tthis._exportDataset.setFieldValue('fields', fieldNames);\r\n\t\texportLKDs.first();\r\n\t},\r\n\r\n\tdestroy: function() {\r\n    \tif(this._exportDataset) {\r\n    \t\tvar lkds = this._exportDataset.getField('fields').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tthis._exportDataset.destroy();\r\n    \t\tthis._exportDataset = null;\r\n    \t}\r\n    \tthis._dataset = null;\r\n    \tthis._progressBar = null;\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * A dialog to view image. Example:\r\n * \r\n *     @example\r\n *     var imgViewer = new jslet.ui.ImageViewer({width: 500, height: 600, isModal: true});\r\n *     imgViewer.show('./img/igm1.jpg', 'Dog');\r\n * \r\n * @param {Object} dialogCfg Dialog configuration.\r\n * @param {Integer} dialogCfg.width Dialog width.\r\n * @param {Integer} dialogCfg.height Dialog height.\r\n * @param {Boolean} dialogCfg.isModal Show image viewer as a modal dialog. \r\n */\r\njslet.ui.ImageViewer = function(dialogCfg) {\r\n\tthis._imageUrl = null;\r\n\tthis._width = 400;\r\n\tthis._height = 500;\r\n\tthis._isModal = false;\r\n\tif(dialogCfg){\r\n\t\tif(dialogCfg.width) {\r\n\t\t\tthis.width(dialogCfg.width);\r\n\t\t}\r\n\t\tif(dialogCfg.height) {\r\n\t\t\tthis.height(dialogCfg.height);\r\n\t\t}\r\n\t\tthis.isModal(dialogCfg.isModal);\r\n\t}\r\n};\r\n\r\njslet.ui.ImageViewer.prototype = {\r\n\t\r\n\t/**\r\n\t * Set or get the dialog width.\r\n\t * \r\n\t * @param {Integer | undefined} width Dialog width;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImageViewer.width', width).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get the dialog height.\r\n\t * \r\n\t * @param {Integer | undefined} height Dialog height;\r\n\t * \r\n\t * @return {this | Integer}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImageViewer.height', height).isNumber();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify showing the dialog as modal or not.\r\n\t * \r\n\t * @param {Boolean | undefined} isModal True - Showing as modal, false -otherwise;\r\n\t * \r\n\t * @return {this | Boolean}\r\n\t */\r\n\tisModal: function(isModal) {\r\n\t\tif(isModal === undefined) {\r\n\t\t\treturn this._isModal;\r\n\t\t}\r\n\t\tthis._isModal = isModal? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set image URL and show it.\r\n\t * \r\n\t * @param {String} imageUrl Image URL.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\timageUrl: function(imageUrl) {\r\n\t\tthis._imageUrl = imageUrl;\r\n\t\tthis.show(imageUrl);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show dialog.\r\n\t * \r\n\t */\r\n\tshow: function(imageUrl, name) {\r\n\t\tvar Z = this;\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\tvar jqViewer = jQuery(owin.el).find('*[name=viewer]').css('background-image', 'url(' + imageUrl + ')');\r\n\t\towin.changeCaption(jsletlocale.ImageViewer.caption + (name? ' - ' + name: ''));\r\n\t\tif(Z._isModal) {\r\n\t\t\towin.showModal();\r\n\t\t} else {\r\n\t\t\towin.show();\r\n\t\t}\r\n\t\t\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar opt = { type: 'window', caption: jsletlocale.ImageViewer.caption, isCenter: true, resizable: true, minimizable: false, maximizable: true, \r\n\t\t\t\twidth: this._width, height: this._height, animation: 'fade', styleClass: 'jl-isdlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar html = '<div name=\"viewer\" style=\"width: 100%; height: 100%;background-size:contain;background-origin:content;background-position:50% 50%;background-repeat:no-repeat;\"/>';\r\n\t\towin.setContent(html);\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tjslet.ui.install(owin.el);\r\n\t}\r\n};\r\n\n/**\r\n * @class\r\n * \r\n * Import dialog for specified Dataset object. Example:\r\n * \r\n *     @example\r\n *     var dlg = new jslet.ui.ImportDialog(dsObj, {includeFields: ['fld1', 'fld2']});\r\n *     var dlg = new jslet.ui.ImportDialog('employee');\r\n * \r\n * @param {jslet.data.Dataset | String} dataset (Required)Dataset object or dataset name.\r\n * @param {Object} options (Optional)Import options. \r\n * @param {Boolean} options.hasSchemaSection Identify whether import schema section is visible or not. \r\n * @param {String[]} options.includeFields Specify which fields need import. \r\n * @param {String[]} options.excludeFields Specify which fields need not import. \r\n */\r\njslet.ui.ImportDialog = function(dataset, options) {\r\n\tthis._dataset = jslet.data.getDataset(dataset);\r\n\tthis._importDataset = null;\r\n\t\r\n\tthis._parsedData = null;\r\n\t\r\n\tthis._dlgId = null;\r\n\t\r\n\tthis._onCustomImport = null;\r\n\tthis._onImporting = null;\r\n\tthis._onImported = null;\r\n\t\r\n\tthis._onQuerySchema = null;\r\n\tthis._onSubmitSchema = null;\r\n\t\r\n\tthis._schemaDsName = null;\r\n\tthis._schemaLkDsName = null;\r\n\t\r\n\tthis._colHeaders = null;\r\n\t\r\n\tthis._progressBar = null;\r\n\t\r\n\tthis._hasSchemaSection = false;\r\n\t\r\n\tthis._includeFields = null;\r\n\t\r\n\tthis._excludeFields = null;\r\n\t\r\n\tif(options) {\r\n\t\tthis._hasSchemaSection = (options.hasSchemaSection? true: false);\r\n\t\tthis._includeFields = options.includeFields;\r\n\t\tthis._excludeFields = options.excludeFields;\r\n\t}\r\n\tthis._initialize();\r\n};\r\n\r\njslet.ui.ImportDialog.prototype = {\r\n\t/**\r\n\t * Show import dialog\r\n\t */\r\n\tshow: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._hasSchemaSection) {\r\n\t\t\tZ._querySchema();\r\n\t\t}\r\n\t\tZ._refreshFields();\r\n\t\tvar jqEl = jQuery('#' + this._dlgId);\r\n\t\tjqEl.find('#jltxtImportFile').val('');\r\n\t\tvar owin = jqEl[0].jslet;\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t\treturn owin;\r\n\t},\r\n\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Query import schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset, {hasSchemaSection: true});\r\n\t *     var querySchemaFn = function(callBackFn) {\r\n\t * \t      var exportSchemaData = [{schema: '', fields: ['field1','field2']}];\r\n\t * \t      callBackFn(exportSchemaData); //For asynchronous operation.\r\n\t * \t     //return exportSchemaData; \t//For synchronous operation.\r\n\t *     };\r\n\t * \r\n\t *     importDialog.onQuerySchema(querySchemaFn);\r\n\t *     \r\n\t * @param {Function} onQuerySchema Query schema event handler.\r\n\t * @param {Function} onQuerySchema.callBackFn Query schema callback function.\r\n\t * @param {Function} onQuerySchema.callBackFn.exportSchemaData Query schema.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonQuerySchema: function(onQuerySchema) {\r\n\t\tif(onQuerySchema === undefined) {\r\n\t\t\treturn this._onQuerySchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onQuerySchema', onQuerySchema).isFunction();\r\n\t\tthis._onQuerySchema = onQuerySchema;\r\n\t\treturn this;\r\n\t},\t\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Submit import schema event handler. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset, {hasSchemaSection: true});\r\n\t *     var submitSchemaFn = function(action, changedRec) {\r\n\t * \t     if(action == 'insert') {}\r\n\t * \t     if(action == 'update') {}\r\n\t * \t     if(action == 'delete') {}\r\n\t *     };\r\n\t * \r\n\t *     importDialog.onSubmitSchema(submitSchemaFn);\r\n\t *     \r\n\t * @param {Function | undefined} onSubmitSchema Submitting schema event handler.\r\n\t * @param {String} onSubmitSchema.action Submit action, optional value: 'insert', 'update', 'delete'.\r\n\t * @param {Object} onSubmitSchema.changedRecord Changed record.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonSubmitSchema: function(onSubmitSchema) {\r\n\t\tif(onSubmitSchema === undefined) {\r\n\t\t\treturn this._onSubmitSchema;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onSubmitSchema', onSubmitSchema).isFunction();\r\n\t\tthis._onSubmitSchema = onSubmitSchema;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Customized importing event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.onCustomImport(function(importingDataset, parsedData, fieldMaps) { });\r\n\t *     \r\n\t * @param {Function | undefined} onCustomImport Customized importing event.\r\n\t * @param {jslet.data.Dataset} onCustomImport.importingDataset Importing dataset object.\r\n\t * @param {Object[]} onCustomImport.parsedData Parsed data from excel file.\r\n\t * @param {Object[]} onCustomImport.fieldMaps Field map to excel header.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonCustomImport: function(onCustomImport) {\r\n\t\tif(onCustomImport === undefined) {\r\n\t\t\treturn this._onCustomImport;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onCustomImport', onCustomImport).isFunction();\r\n\t\tthis._onCustomImport = onCustomImport;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Importing event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.onImporting(function(fieldName, excelColValue) { });\r\n\t *     \r\n\t * @param {Function | undefined} onImporting Importing event.\r\n\t * @param {String} onImporting.fieldName The importing field name.\r\n\t * @param {String} onImporting.excelColValue The mapping column value of excel file.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonImporting: function(onImporting) {\r\n\t\tif(onImporting === undefined) {\r\n\t\t\treturn this._onImporting;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onImporting', onImporting).isFunction();\r\n\t\tthis._onImporting = onImporting;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Imported event. Example:\r\n\t * \r\n\t *     @example\r\n\t *     var importDialog = new jslet.ui.ImportDialog(importingDataset);\r\n\t *     importDialog.imported(function(dataset) { });\r\n\t *     \r\n\t * @param {Function | undefined} onImported Imported event.\r\n\t * @param {jslet.data.Dataset} onImported.dataset Importing dataset object.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonImported: function(onImported) {\r\n\t\tif(onImported === undefined) {\r\n\t\t\treturn this._onImported;\r\n\t\t}\r\n\t\tjslet.Checker.test('ImportDialog#onImported', onImported).isFunction();\r\n\t\tthis._onImported = onImported;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fldCfg = [\r\n\t\t              {name: 'schema', type: 'S', length: 100, label: 'Schema'},\r\n\t\t              {name: 'fieldMaps', type: 'S', length: 5000, label: 'fieldMaps', visible: false},\r\n\t\t              {name: 'colHeaders', type: 'S', length: 5000, label: 'fieldMaps', visible: false}\r\n\t\t              ];\r\n\t\tvar schemaLKDs = new jslet.data.Dataset({name: 'schemaLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'schema', codeField: 'schema', nameField: 'schema', autoRefreshHostDataset: true, auditLogEnabled: false, logChanges: false});\r\n\t\t\r\n\t\tvar importDialogLocale = jsletlocale.ImportDialog;\r\n\t\tZ._schemaLkDsName = schemaLKDs.name();\r\n\t\tfldCfg = [\r\n\t\t    {name: 'schema', type: 'S', length: 100, label: 'Schema', lookup: {dataset: schemaLKDs}}\r\n        ];\t\t\r\n\t\tZ._schemaDsName = 'schemaDs' + jslet.nextId();\r\n\t\tvar schemaDs = new jslet.data.Dataset({name: Z._schemaDsName, fields: fldCfg}); \r\n\t\tschemaDs.onFieldChanged(function(fldName, fldValue) {\r\n\t\t\tZ._doSchemaChanged(this, fldValue);\r\n\t\t});\r\n\t\t\r\n\t\tfldCfg = [\r\n\t    \t      {name: 'colHeader', type: 'S', length: 100, label: 'Column Header', displayWidth: 16}\r\n\t    \t    ];\r\n\t\tvar exportLKDs = new jslet.data.Dataset({name: 'exportLKDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'colHeader', codeField: 'colHeader', nameField: 'colHeader', autoRefreshHostDataset: true});\r\n\t\t\r\n\t\tvar expFldCfg = [\r\n       \t      {name: 'field', type: 'S', length: 100, label: 'Field Name', visible: false}, \r\n\t   \t      {name: 'label', type: 'S', length: 100, visible: false},\r\n\t   \t      {name: 'displayLabel', type: 'S', length: 100, label: importDialogLocale.fieldLabel, displayWidth: 12, readOnly: true},\r\n    \t      {name: 'colHeader', type: 'S', length: 100, label: importDialogLocale.columnHeader, displayWidth: 12, editControl: 'DBSelect',\r\n    \t    \t  lookup: {dataset: exportLKDs}},\r\n    \t      {name: 'required', type: 'B', length: 10, label: 'required', visible: false},\r\n    \t      {name: 'fixedValue', type: 'S', length: 50, label: importDialogLocale.fixedValue, displayWidth: 12}\r\n    \t    ];\r\n    \tZ._importDataset = new jslet.data.Dataset({name: 'importDs' + jslet.nextId(), fields: expFldCfg, keyField: 'schema', nameField: 'schema', isFireGlobalEvent: false});\r\n\t\tvar opt = { type: 'window', caption: importDialogLocale.caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, animation: 'fade'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar expHtml = '';\r\n    \tif(Z._hasSchemaSection) {\r\n    \t\texpHtml = \r\n\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\"><span class=\"input-group-addon\">' +\r\n\t            importDialogLocale.schemaName + \r\n\t            '</span>' + \r\n\t            '<select data-jslet=\"type:\\'DBSelect\\',dataset: \\'' + schemaDs.name() + '\\', field:\\'schema\\'\"></select>' + \r\n\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSaveAs\">' + \r\n\t            importDialogLocale.saveAsSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnSave\">' + \r\n\t            importDialogLocale.saveSchema + \r\n\t            '</button></span>' +\r\n\t            '<span class=\"input-group-btn\"><button class=\"btn btn-default btn-sm\" name=\"jlbtnDelete\">' + \r\n\t            importDialogLocale.deleteSchema + \r\n\t            '</button></span>' +\r\n\t            '</div>';\r\n    \t}\r\n\r\n\t\tvar html = ['<div class=\"form-horizontal jl-impdlg-content\">',\r\n\t            expHtml,\r\n\t            '<div class=\"input-group input-group-sm\"><span class=\"input-group-addon\">',\r\n\t            importDialogLocale.fileName,\r\n\t            '</span>',\r\n\t\t\t\t'<input name=\"jltxtImportFile\" title=\"*.xls|*.xlsx|*.xlsb|*.xlsm|*.ods\" class=\"form-control\" type=\"file\"></input>',\r\n\t\t\t\t'</div>',\r\n\t\t\t\t\r\n\t            '<div class=\"col-sm-12 jl-impdlg-fieldmap\" style=\"padding: 0!important\">',\r\n\t            '<div data-jslet=\"type:\\'DBTable\\', dataset: \\'', \r\n\t            Z._importDataset.name(), \r\n\t            '\\', editable: true, hasFilterDialog:false, disableHeadSort: true\"></div></div>',\r\n\r\n\t\t\t\t'<div class=\"col-sm-12\"></div>',\r\n\t            '<div class=\"input-group input-group-sm jl-impdlg-toolbar\" style=\"margin-bottom: 0;width:100%\">',\r\n\t            '<div class=\"col-sm-9\"><div name=\"jlProgressImport\" data-jslet=\"type:\\'ProgressBar\\', value: 50\" style=\"display:none;width:100%\"></div></div>',\r\n\t            '<div class=\"col-sm-3\"><button name=\"jlbtnCancel\" class=\"btn btn-default btn-sm jl-impdlg-toolbutton\">',\r\n\t            importDialogLocale.cancel,\r\n\t            '</button><button name=\"jlbtnImport\" class=\"btn btn-default btn-sm jl-impdlg-toolbutton\">',\r\n\t            importDialogLocale.importData,\r\n\t            '</button></div></div></div>',\r\n\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\tZ.destroy();\r\n\t\t});\r\n\t\tjslet.ui.install(owin.el);\r\n\t\tZ._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tZ._progressBar = jqEl.find('[name=\"jlProgressImport\"]')[0].jslet;\r\n\r\n\t\tjqEl.find('[name=\"jlbtnSaveAs\"]').click(function(event) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnSave\"]').click(function(event) {\r\n\t\t\tZ._saveSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnDelete\"]').click(function(event) {\r\n\t\t\tZ._deleteSchema();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jltxtImportFile\"]').on('change', function(event) {\r\n\t\t\tvar files = event.delegateTarget.files;\r\n\t\t\tif(files.length > 0) {\r\n\t\t\t\tZ._readFile(files[0]);\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.find('[name=\"jlbtnImport\"]').click(function(event) {\r\n\t\t\tZ._importData();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('[name=\"jlbtnCancel\"]').click(function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t}, //End of '_initialize'\r\n\t\r\n\t_querySchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tqueryFn = this._onQuerySchema || jslet.global.importDialog.onQuerySchema;\r\n\t\t\r\n\t\tfunction innerRefresh(schemaData) {\r\n\t\t\tif(!schemaData) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tjslet.data.getDataset(Z._schemaLkDsName).records(schemaData);\r\n\t\t}\r\n\t\t\r\n\t\tif(!queryFn) {\r\n\t\t\tconsole.warn('Event handler: onQuerySchema NOT set, can not query export schema!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = queryFn();\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function(schemaData) {\r\n\t\t\t\tinnerRefresh(schemaData);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tinnerRefresh(result);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_submitSchema: function(action, changedRecord) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tvar actionFn = Z._onSubmitSchema || jslet.global.importDialog.onSubmitSchema;\r\n\t\tif(actionFn) {\r\n\t\t\tdelete changedRecord._jl_;\r\n\t\t\treturn actionFn(action, changedRecord);\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_saveAsSchema: function() {\r\n\t\tvar Z = this;\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.ui.prompt(jsletlocale.ExportDialog.inuputSchemaLabel, null, function(button, schemaName){\r\n\t\t\tif(button === 'ok' && schemaName) {\r\n\t\t\t\tvar dsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\t\t\tvar dsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName);\r\n\t\t\t\tvar context = dsSchemaLk.startSilenceMove();\r\n\t\t\t\tvar foundRecno = -1;\r\n\t\t\t\tvar breakDown = false;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif(dsSchemaLk.findByKey(schemaName)) {\r\n\t\t            \tfoundRecno = dsSchemaLk.recno();\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tdsSchemaLk.endSilenceMove(context);\r\n\t\t\t\t}\r\n\t\t\t\tif(foundRecno >= 0) {\r\n\t\t            jslet.ui.confirm(jsletlocale.ImportDialog.existedSchema, null, function(button){\r\n\t\t            \tif(button == 'cancel') {\r\n\t\t            \t\treturn;\r\n\t\t            \t}\r\n\t\t            \tdsSchemaLk.recno(foundRecno);\r\n\t\t\t\t\t\tdsSchemaLk.editRecord();\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('fieldMaps', strMaps);\r\n\t\t\t\t\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\t\t\t\tdsSchemaLk.confirm();\r\n\t\t\t\t\t\tZ._isSaving = true;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tdsSchema.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tZ._isSaving = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tZ._submitSchema('insert', dsSchemaLk.getRecord());\r\n\t\t            });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdsSchemaLk.appendRecord();\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('schema', schemaName);\r\n\t\t\t\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('fieldMaps', strMaps);\r\n\t\t\t\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\t\t\tdsSchemaLk.confirm();\r\n\t\t\t\t\tZ._isSaving = true;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdsSchema.setFieldValue('schema', schemaName);\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tZ._isSaving = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._submitSchema('insert', dsSchemaLk.getRecord());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_saveSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName),\r\n\t\t\tdsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchemaLk.recordCount() === 0 || !dsSchema.getFieldValue('schema')) {\r\n\t\t\tZ._saveAsSchema();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsSchemaLk.editRecord();\r\n\t\tvar strMaps = JSON.stringify(fieldMaps);\r\n\t\tdsSchemaLk.setFieldValue('fieldMaps', fieldMaps);\r\n\t\tdsSchemaLk.setFieldValue('colHeaders', JSON.stringify(Z._getColHeaders()));\r\n\t\t\r\n\t\tdsSchemaLk.confirm();\r\n\t\tZ._submitSchema('update', dsSchemaLk.getRecord());\r\n\t},\r\n\t\r\n\t_deleteSchema: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName),\r\n\t\t\tdsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchemaLk.recordCount() === 0 || !dsSchema.getFieldValue('schema')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = Z._submitSchema('delete', dsSchemaLk.getRecord());\r\n\t\tif(result && jslet.isPromise(result)) {\r\n\t\t\tresult.done(function() {\r\n\t\t\t\tdsSchemaLk.deleteRecord();\r\n\t\t\t\tdsSchema.setFieldValue('schema', null);\r\n\t\t\t\tdsSchema.confirm();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdsSchemaLk.deleteRecord();\r\n\t\t\tdsSchema.setFieldValue('schema', null);\r\n\t\t\tdsSchema.confirm();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_refreshFields: function() {\r\n\t\tvar fieldRecords = [], fldObj, fldName, required, label,\r\n\t\t\tfields = this._dataset.getNormalFields(), \r\n\t\t\tlabels = {}, errLabels = null,\r\n\t\t\tincludeFields = this._includeFields,\r\n\t\t\texcludeFields = this._excludeFields;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(includeFields) {\r\n\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\tif(excludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\trequired = fldObj.required();\r\n\t\t\tlabel = fldObj.label();\r\n\t\t\tif(labels[label]) {\r\n\t\t\t\tif(errLabels) {\r\n\t\t\t\t\terrLabels += ',' + errLabels;\r\n\t\t\t\t} else {\r\n\t\t\t\t\terrLabels = label;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlabels[label] = true;\r\n\t\t\t}\r\n\t\t\tfieldRecords.push({field: fldName, label: label, displayLabel: label + (required? '<span class=\"jl-lbl-required\">*</span>': ''), required: required});\r\n\t\t}\r\n\t\tif(errLabels) {\r\n\t\t\tjslet.showInfo(jslet.formatMessage(jsletlocale.ImportDialog.duplicateFields, [errLabels]));\r\n\t\t}\r\n\t\tthis._importDataset.records(fieldRecords);\r\n\t\tthis._importDataset.first();\r\n\t\tthis._colHeaders = null;\r\n\t},\r\n\r\n\t_readFile: function(fileObj) {\r\n\t\tvar Z = this,\r\n\t\t\tname = fileObj.name,\r\n\t\t\tsuffix = name.substring(name.lastIndexOf('.') + 1) || '';\r\n\t\tsuffix = suffix.toLowerCase();\r\n\t\tif(suffix != 'xls' && suffix != 'xlsx' && suffix != 'xlsb' && suffix != 'xlsm' && suffix != 'ods') {\r\n\t\t\tjslet.showError(jsletlocale.ImportDialog.notSupportFile);\r\n\t\t\treturn;\r\n\t\t}\r\n\t    var\treader = new window.FileReader();\r\n\t\treader.onload = function(e) {\r\n\t\t\tvar fileContent,\r\n\t\t\t\tparsedResult = null;\r\n\t\t\tif(e) {\r\n\t\t\t\tfileContent = e.target.result;\r\n\t\t\t} else {\r\n\t\t\t\tfileContent = reader.content;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tparsedResult = jslet.data.defaultXPorter.excelXPorter().importData(Z._dataset, fileContent);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tjslet.showError(jsletlocale.ImportDialog.notSupportFile);\r\n\t\t\t}\r\n\t\t\tif(parsedResult) {\r\n\t\t\t\tZ._colHeaders = parsedResult.header;\r\n\t\t\t\tZ._addColumnHeader(Z._colHeaders);\r\n\t\t\t\tZ._parsedData = parsedResult.data;\r\n\t\t\t} else {\r\n\t\t\t\tjslet.showError(jsletlocale.ImportDialog.noData);\r\n\t\t\t}\r\n\t\t};\r\n\t\treader.readAsBinaryString(fileObj);\r\n\t},\r\n\t\r\n\t_addColumnHeader: function(headers) {\r\n\t\tif(!headers) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldRecords = [], i, len;\r\n\t\tfor(i = 0, len = headers.length; i < len; i++) {\r\n\t\t\tfieldRecords.push({/*colNum: i,*/ colHeader: headers[i]});\r\n\t\t}\r\n\t\tthis._importDataset.getField('colHeader').lookup().dataset().records(fieldRecords);\r\n\t\tthis._mapFieldColumn();\r\n\t},\r\n\t\r\n\t_mapFieldColumn: function() {\r\n\t\tvar headers = this._colHeaders;\r\n\t\tif(!headers) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar records = this._importDataset.records(),\r\n\t\t\tlabel, rec, found = false;\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tif(!rec.fixedValue) {\r\n\t\t\t\tlabel = rec.colHeader || rec.label;\r\n\t\t\t\tif(headers.indexOf(label) >= 0) {\r\n\t\t\t\t\trec.colHeader = label;\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trec.colHeader = null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(rec.colHeader) {\r\n\t\t\t\t\trec.colHeader = null;\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tthis._importDataset.records(records);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doSchemaChanged: function(dsSchema, schemaName) {\r\n\t\tif(this._isSaving) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mapFlds = null,\r\n\t\t\tcolHeaders, records,\r\n\t\t\tmapFldCnt = 0,\r\n\t\t\tdsSchemaLk = jslet.data.getDataset(this._schemaLkDsName);\r\n\t\tif(schemaName) {\r\n\t\t\tmapFlds = JSON.parse(dsSchema.getFieldValue('schema.fieldMaps'));\r\n\t\t\tmapFldCnt = mapFlds.length;\r\n\t\t\t\r\n\t\t\tvar arrColHeaders = JSON.parse(dsSchema.getFieldValue('schema.colHeaders'));\r\n\t\t\trecords = [];\r\n\t\t\tfor(var k = 0, headerCnt = arrColHeaders.length; k < headerCnt; k++) {\r\n\t\t\t\trecords.push({colHeader: arrColHeaders[k]});\r\n\t\t\t}\r\n\t\t\tvar dsColHeader = this._importDataset.getField('colHeader').lookup().dataset();\r\n\t\t\tdsColHeader.records(records);\r\n\t\t}\r\n\t\trecords = this._importDataset.records();\r\n\t\tvar rec, fldName, schColHeader, mapFld;\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tfldName = rec.field;\r\n\t\t\trec.colHeader = null;\r\n\t\t\trec.fixedValue = null;\r\n\t\t\tschColHeader = null;\r\n\t\t\tif(mapFlds) {\r\n\t\t\t\tfor(var j = 0; j < mapFldCnt; j++) {\r\n\t\t\t\t\tmapFld = mapFlds[j];\r\n\t\t\t\t\tif(mapFld.field == fldName) {\r\n\t\t\t\t\t\trec.colHeader = mapFld.colHeader;\r\n\t\t\t\t\t\trec.fixedValue = mapFld.fixedValue;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._importDataset.records(records);\r\n\t},\r\n\t\r\n\t_getFieldMaps: function() {\r\n\t\tvar records = this._importDataset.records(), \r\n\t\t\trow, fieldMaps = [];\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\trow = records[i];\r\n\t\t\tif(row.colHeader || row.fixedValue) {\r\n\t\t\t\tfieldMaps.push({field: row.field, colHeader: row.colHeader, fixedValue: row.fixedValue});\r\n\t\t\t} else if(row.required) {\r\n\t\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noColHeader);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldCnt = fieldMaps.length;\r\n\t\tif(fldCnt === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noColHeader);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn fieldMaps;\r\n\t},\r\n\t\r\n\t_getColHeaders: function() {\r\n\t\tvar colHeaders = [],\r\n\t\t\trecords = this._importDataset.getField('colHeader').lookup().dataset().records();\r\n\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\tcolHeaders.push(records[i].colHeader);\r\n\t\t}\r\n\t\treturn colHeaders;\r\n\t},\r\n\t\r\n\t_importData: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._parsedData || Z._parsedData.length === 0) {\r\n\t\t\tjslet.showInfo(jsletlocale.ImportDialog.noData);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldMaps = Z._getFieldMaps();\r\n\t\tif(!fieldMaps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._onCustomImport) {\r\n\t\t\tvar isSuccess = Z._onCustomImport(Z._dataset, Z._parsedData, fieldMaps);\r\n\t\t\tif(!isSuccess) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar fldMap, text, colHeader,\r\n\t\t\t\tmasterDs = Z._dataset, \r\n\t\t\t\tparsedData = Z._parsedData,\r\n\t\t\t\ttextList = [], textRec, row,\r\n\t\t\t\tfldCnt = fieldMaps.length,\r\n\t\t\t\timportingFn = Z._onImporting;\r\n\t\t\t\r\n\t\t\tfor(var i = 0, len = parsedData.length; i < len; i++) {\r\n\t\t\t\trow = parsedData[i];\r\n\t\t\t\ttextRec = {};\r\n\t\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\t\tfldMap = fieldMaps[j];\r\n\t\t\t\t\tcolHeader = fldMap.colHeader; \r\n\t\t\t\t\tif(colHeader) {\r\n\t\t\t\t\t\tif(importingFn) {\r\n\t\t\t\t\t\t\ttext = importingFn(fldMap.field, row[colHeader]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = row[colHeader];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext = fldMap.fixedValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(text) {\r\n\t\t\t\t\t\ttextRec[fldMap.field] = text;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttextList.push(textRec);\r\n\t\t\t}\r\n\t\t\tvar jqEl = jQuery('#' + Z._dlgId);\r\n\t\t\tjqEl.find('[name=\"jlProgressImport\"]').css('display', '');\r\n\t\t\tvar dsObj = Z._dataset;\r\n\t\t\tvar progressBarObj = Z._progressBar;\r\n\t\t\tdsObj.disableControls();\r\n\t\t\tnew jslet.StepProcessor(textList.length, function(start, end, percent) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdsObj.importTextList(textList, start, end);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t\tprogressBarObj.value(percent);\r\n\t\t\t\tif(percent === 100) {\r\n\t\t\t\t\tdsObj.enableControls();\r\n\t\t\t\t\tdsObj.first();\r\n\t\t\t\t\tZ._doImported();\r\n\t\t\t\t}\r\n\t\t\t}).run();\r\n\t\t}\r\n\t\t\r\n\t\treturn;\r\n\t},\r\n\t\r\n\t_doImported: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._onImported) {\r\n\t\t\tZ._onImported(Z._dataset);\r\n\t\t}\r\n\t\tjslet('#' + Z._dlgId).close();\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._onImporting = null;\r\n\t\tZ._onImported = null;\r\n\t\tZ._onCustomImport = null;\r\n\t\tZ._progressBar = null;\r\n\t\t\r\n\t\tZ._dataset = null;\r\n\t\tvar dsSchemaLk = jslet.data.getDataset(Z._schemaLkDsName);\r\n\t\tif(dsSchemaLk) {\r\n\t\t\tdsSchemaLk.destroy();\r\n\t\t}\r\n\t\tvar dsSchema = jslet.data.getDataset(Z._schemaDsName);\r\n\t\tif(dsSchema) {\r\n\t\t\tdsSchema.destroy();\r\n\t\t}\r\n\t\tif(Z._importDataset) {\r\n    \t\tvar lkds = Z._importDataset.getField('colHeader').lookup().dataset();\r\n    \t\tlkds.destroy();\r\n    \t\tthis._importDataset.destroy();\r\n    \t\tthis._importDataset = null;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\n/**\r\n * @class\r\n * \r\n * A dialog to configure input settings like 'defaultValue', 'valueFollowed', 'focused'. <br />\r\n * It's used for ender user to configure their own preferences. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.defaultInputSettingDialog.show(dataset); \r\n */\r\njslet.ui.InputSettingDialog = function() {\r\n\tthis._inputSettingDs = null;\r\n\t\r\n\tthis._hostDataset = null;\r\n\t\r\n\tthis._onClosed = null;\r\n\t\r\n\tthis._onRestoreDefault = null;\r\n\t\r\n\tthis._settings = null;\r\n\tvar Z = this;\r\n\t\r\n\tfunction doProxyFieldChanged(dataRec, proxyFldName, proxyFldObj) {\r\n\t\tvar hostFldObj = jslet.data.getDataset(dataRec.dataset).getField(proxyFldName);\r\n\t\tproxyFldObj.dataType(hostFldObj.dataType());\r\n\t\tproxyFldObj.length(hostFldObj.length());\r\n\t\tproxyFldObj.scale(hostFldObj.scale());\r\n\t\tproxyFldObj.editMask(hostFldObj.editMask());\r\n\r\n\t\tproxyFldObj.displayFormat(hostFldObj.displayFormat());\r\n\t\tproxyFldObj.dateFormat(hostFldObj.dateFormat());\r\n\t\tproxyFldObj.displayControl(hostFldObj.displayControl());\r\n\t\tproxyFldObj.validChars(hostFldObj.validChars());\r\n\t\tif(hostFldObj.lookup()) {\r\n\t\t\tvar hostLkObj = hostFldObj.lookup();\r\n\t\t\tvar lkObj = hostLkObj.toPlanObject();\r\n\t\t\tlkObj.onlyLeafLevel = false;\r\n\t\t\t\r\n\t\t\tproxyFldObj.lookup(lkObj);\r\n\t\t\tproxyFldObj.editControl('DBComboSelect');\r\n\t\t} else {\r\n\t\t\tproxyFldObj.lookup(null);\r\n\t\t\tvar editorObj = hostFldObj.editControl();\r\n\t\t\tvar fldType = hostFldObj.getType();\r\n\t\t\tif(fldType !== jslet.data.DataType.DATE && fldType !== jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\teditorObj = {type: 'DBText'};\r\n\t\t\t}\r\n\t\t\tproxyFldObj.editControl(editorObj);\r\n\t\t}\r\n\t\tproxyFldObj.valueStyle(jslet.data.FieldValueStyle.NORMAL);\r\n\t}\r\n\r\n\tfunction initialize() {\r\n\t\tvar fldCfg = [{name: 'dataset', type: 'S', length: 30, visible: false},\r\n\t\t              {name: 'field', type: 'S', length: 30, displayWidth: 20, visible: false},\r\n\t\t              {name: 'label', type: 'S', label: jsletlocale.InputSettingDialog.labelLabel, length: 50, displayWidth: 15, disabled: true},\r\n\t\t              {name: 'parentField', type: 'S', length: 30, visible: false},\r\n\t\t              {name: 'tabIndex', type: 'N', label: 'tabIndex', length: 3, visible: false},\r\n\t\t              {name: 'focused', type: 'B', label: jsletlocale.InputSettingDialog.labelFocused, displayWidth: 6},\r\n\t\t              {name: 'valueFollow', type: 'B', label: jsletlocale.InputSettingDialog.labelValueFollow, displayWidth: 6},\r\n\t\t              {name: 'defaultValue', type: 'P', label: jsletlocale.InputSettingDialog.labelDefaultValue, length: 200, displayWidth:30, proxyHostFieldName: 'field', proxyFieldChanged: doProxyFieldChanged},\r\n\t\t              {name: 'isDatasetField', type: 'B', label: '', visible: false}\r\n\t\t              ];\r\n\t\t\r\n\t\tZ._inputSettingDs = new jslet.data.Dataset({name: 'custDs' + jslet.nextId(), fields: fldCfg, \r\n\t\t\t\tkeyField: 'field', nameField: 'label', parentField: 'parentField', logChanges: false, indexFields: 'tabIndex', isFireGlobalEvent: false});\r\n\t\t\r\n\t\tvar custContextFn = function(fldObj, changingFldName){\r\n\t\t\tvar dataset = fldObj.dataset();\r\n\t\t\tfldObj.disabled(dataset.getFieldValue('isDatasetField'));\r\n\t\t};\r\n\t\t\r\n\t\tZ._inputSettingDs.contextRules([{\"condition\": \"true\", \"rules\": [\r\n\t\t     {\"field\": 'defaultValue', \"customized\": custContextFn},\r\n\t\t     {\"field\": 'focused', \"customized\": custContextFn},\r\n\t\t     {\"field\": 'valueFollow', \"customized\": custContextFn}\r\n\t\t]}]);\r\n\t\tZ._inputSettingDs.enableContextRule();\r\n\t\tZ._inputSettingDs.onFieldChanged(function(propName, propValue){\r\n\t\t\tif(Z._isInit) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!Z._settings) {\r\n\t\t\t\tZ._settings = {};\r\n\t\t\t}\r\n\t\t\tvar hostDsName = this.getFieldValue('dataset'),\r\n\t\t\t\thostFldName = this.getFieldValue('field'),\r\n\t\t\t\tdsSetting = Z._settings[hostDsName];\r\n\t\t\tif(!dsSetting) {\r\n\t\t\t\tdsSetting = {};\r\n\t\t\t\tZ._settings[hostDsName] = dsSetting;\r\n\t\t\t}\r\n\t\t\tvar fldSetting = dsSetting[hostFldName];\r\n\t\t\tif(!fldSetting) {\r\n\t\t\t\tfldSetting = {};\r\n\t\t\t\tdsSetting[hostFldName] = fldSetting; \r\n\t\t\t}\r\n\t\t\tfldSetting[propName] = propValue;\r\n\t\t});\r\n\t}\r\n\t\r\n\tinitialize.call(this);\r\n};\r\n\r\njslet.ui.InputSettingDialog.prototype = {\r\n\t\t\r\n\thostDataset: function(hostDataset) {\r\n\t\tif(hostDataset === undefined) {\r\n\t\t\treturn this._hostDataset;\r\n\t\t}\r\n\t\tthis._hostDataset = hostDataset;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close event, you can use this event to store input settings. Example:\r\n\t * \r\n\t *     @example\r\n\t *     jslet.ui.defaultInputSettingDialog.show(dataset);\r\n\t *     jslet.ui.defaultInputSettingDialog.onClosed(function(settings) {\r\n\t *        //Save into DB\r\n\t *     });\r\n\t * \r\n\t * @param {Function | undefined} onClosed Close event.\r\n\t * @param {Object} onClosed.settings Input settings.\r\n\t * \r\n\t * @return {this | Function}\r\n\t */\r\n\tonClosed: function(onClosedFn) {\r\n\t\tif(onClosedFn === undefined) {\r\n\t\t\treturn this._onClosed;\r\n\t\t}\r\n\t\tthis._onClosed = onClosedFn;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tonRestoreDefault: function(onRestoreDefaultFn) {\r\n\t\tif(onRestoreDefaultFn === undefined) {\r\n\t\t\treturn this._onRestoreDefault;\r\n\t\t}\r\n\t\tthis._onRestoreDefault = onRestoreDefaultFn;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Show dialog.\r\n\t * \r\n\t * @param {jslet.data.Dataset | String} hostDataset The dataset will be changed input setting.\r\n\t */\r\n\tshow: function(hostDataset) {\r\n\t\tjslet.Checker.test('InputSettingDialog.show#hostDataset', hostDataset).required();\r\n\t\tvar Z = this;\r\n\t\tZ._hostDataset = jslet.data.getDataset(hostDataset);\r\n\t\tZ._isInit = true;\r\n\t\tZ._settings = null;\r\n\t\tZ._inputSettingDs.disableControls();\r\n\t\ttry {\r\n\t\t\tZ._initializeFields();\r\n\t\t} finally {\r\n\t\t\tZ._isInit = false;\r\n\t\t\tZ._inputSettingDs.first();\r\n\t\t\tZ._inputSettingDs.enableControls();\r\n\t\t}\r\n\t\tvar creating = false;\r\n\t\tif(!Z._dlgId) {\r\n\t\t\tZ._createDialog();\r\n\t\t\tcreating = true;\r\n\t\t}\r\n\t\tvar tblFields = jQuery('#' + Z._dlgId).find('.jl-isdlg-fields')[0].jslet;\r\n\t\ttblFields.expandAll();\r\n\t\tvar tableWidth = tblFields.getTotalWidth() + tblFields.getTotalWidth(true);\r\n\t\tif(creating) {\r\n\t\t\ttblFields.onRowClick(function() {\r\n\t\t\t\tif(this.dataset().getFieldValue('isDatasetField')) {\r\n\t\t\t\t\tthis.toggle();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar owin = jslet('#' + Z._dlgId);\r\n\t\towin.changeSize(tableWidth + 60);\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(999);\r\n\t},\r\n\t\r\n\t_initializeFields: function(hostDs, isKeepFields, parentField) {\r\n\t\tvar Z = this,\r\n\t\t\tdataset = Z._inputSettingDs,\r\n\t\t\tfldObj;\r\n\t\tif(!hostDs) {\r\n\t\t\thostDs = jslet.data.getDataset(Z._hostDataset);\r\n\t\t}\r\n\t\tvar fields = hostDs.getNormalFields();\r\n\t\tif(!isKeepFields) {\r\n\t\t\tdataset.records(null);\r\n\t\t}\r\n\t\tvar isDsFld;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tisDsFld = fldObj.detailDataset()? true: false;\r\n\t\t\tvar dataType = fldObj.dataType;\r\n\t\t\tif(!isDsFld && !fldObj.visible() || \r\n\t\t\t\t\tdataType === jslet.data.DataType.ACTION || \r\n\t\t\t\t\tdataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tdataset.appendRecord();\r\n\t\t\tdataset.setFieldValue('isDatasetField', isDsFld);\r\n\t\t\t\r\n\t\t\tdataset.setFieldValue('dataset', hostDs.name());\r\n\t\t\tdataset.setFieldValue('field', fldObj.name());\r\n\t\t\tdataset.setFieldValue('label', fldObj.label());\r\n\t\t\tdataset.setFieldValue('tabIndex', fldObj.tabIndex());\r\n\t\t\tif(parentField) {\r\n\t\t\t\tdataset.setFieldValue('parentField', parentField);\r\n\t\t\t}\r\n\t\t\tif(!isDsFld) {\r\n\t\t\t\tdataset.setFieldValue('defaultValue', fldObj.defaultValue());\r\n\t\t\t\tdataset.setFieldValue('focused', fldObj.focused());\r\n\t\t\t\tdataset.setFieldValue('valueFollow', fldObj.valueFollow());\r\n\t\t\t}\r\n\t\t\tdataset.confirm();\r\n\t\t\tif(isDsFld) {\r\n\t\t\t\tthis._initializeFields(fldObj.detailDataset(), true, fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createDialog: function() {\r\n\t\tvar opt = { type: 'window', caption: jsletlocale.InputSettingDialog.caption, isCenter: true, resizable: true, minimizable: false, maximizable: false, animation: 'fade', styleClass: 'jl-isdlg'};\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar html = [\r\n\t\t            '<div class=\"input-group input-group-sm\" style=\"margin-bottom: 10px\">',\r\n\t\t            '<div class=\"jl-isdlg-fields\" data-jslet=\"type:\\'DBTable\\',dataset:\\'', this._inputSettingDs.name(), \r\n\t\t            '\\',treeField:\\'label\\',readOnly:false,hasFilterDialog:false\"></div></div>',\r\n\r\n//\t\t            '<div class=\"input-group input-group-sm\">',\r\n//\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\r\n//\t\t            '<button id=\"jlbtnUp\" class=\"btn btn-default btn-sm\">', jsletlocale.InputSettingDialog.save, '</button>',\r\n//\t\t            '<button id=\"jlbtnDown\" class=\"btn btn-default btn-sm\">', jsletlocale.InputSettingDialog.save, '</button>',\r\n//\t\t            '</div>',\r\n//\t\t            '<label class=\"control-label col-sm-6\">&nbsp</label>',\r\n//\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\r\n//\t\t            '<hr class=\"col-sm-11\" />',\r\n\t\t            '<div class=\"input-group input-group-sm jl-isdlg-toolbar\"><label class=\"control-label col-sm-9\">&nbsp</label>',\r\n\t\t            '<div class=\"col-sm-3\"><button id=\"jlbtnSave\" class=\"btn btn-default btn-sm\">',\t\t            \r\n\t\t            jsletlocale.InputSettingDialog.save,\r\n\t\t            '</button><button id=\"jlbtnCancel\" class=\"btn btn-default btn-sm\">',\r\n\t\t            jsletlocale.InputSettingDialog.cancel,\r\n\t\t            '</button></div></div>',\r\n\t\t            '</div>'];\r\n\t\towin.setContent(html.join(''));\r\n\t\towin.onClosed(function () {\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\tthis._dlgId = owin.el.id;\r\n\t\tvar jqEl = jQuery(owin.el), \r\n\t\t\tZ = this;\r\n\t\t\r\n//\t\tjqEl.find('#jlbtnUp').on('click', function(event) {\r\n//\t\t\tvar dataset = Z._inputSettingDs;\r\n//\t\t\tif(dataset.recordCount() === 0) {\r\n//\t\t\t\treturn;\r\n//\t\t\t}\r\n//\t\t\tvar idx = dataset.getFieldValue('tabIndex');\r\n//\t\t\tif(!idx) {\r\n//\t\t\t\tidx = dataset.recno();\r\n//\t\t\t}\r\n//\t\t\tif(idx === 0) {\r\n//\t\t\t\treturn;\r\n//\t\t\t}\r\n//\t\t\tvar context = dataset.startSilenceMove();\r\n//\t\t\ttry {\r\n//\t\t\t\tdataset.setFieldValue('tabIndex', idx - 1);\r\n//\t\t\t\tdataset.prior();\r\n//\t\t\t\tdataset.setFieldValue('tabIndex', idx);\r\n//\t\t\t\tdataset.confirm();\r\n//\t\t\t} finally {\r\n//\t\t\t\tdataset.endSilenceMove(context);\r\n//\t\t\t}\r\n//\t\t\tdataset.indexFields(dataset.indexFields());\r\n//\t\t});\r\n\t\t\r\n\t\tjqEl.find('#jlbtnSave').on('click', function(event) {\r\n\t\t\tif(Z._settings) {\r\n\t\t\t\tvar hostDs, fldObj, fldSetting, propSetting;\r\n\t\t\t\tfor(var dsName in Z._settings) {\r\n\t\t\t\t\thostDs = jslet.data.getDataset(dsName);\r\n\t\t\t\t\tfldSetting = Z._settings[dsName]; \r\n\t\t\t\t\tfor(var fldName in fldSetting) {\r\n\t\t\t\t\t\tfldObj = hostDs.getField(fldName);\r\n\t\t\t\t\t\tpropSetting = fldSetting[fldName];\r\n\t\t\t\t\t\tfor(var propName in propSetting) {\r\n\t\t\t\t\t\t\tfldObj[propName](propSetting[propName]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(Z._onClosed) {\r\n\t\t\t\t\tZ._onClosed(Z._settings);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\tjqEl.find('#jlbtnCancel').on('click', function(event) {\r\n\t\t\towin.close();\r\n\t\t});\r\n\t\t\r\n\t\tjslet.ui.install(owin.el);\r\n\t}\r\n};\r\n\r\n/**\r\n * Default input setting dialog. Example:\r\n * \r\n *     @example\r\n *     jslet.ui.defaultInputSettingDialog.show(dataset);\r\n *      \r\n * @member jslet.ui\r\n * @type {jslet.ui.InputSettingDialog}\r\n * \r\n */\r\njslet.ui.defaultInputSettingDialog = new jslet.ui.InputSettingDialog();\r\n\n/**\r\n * @class \r\n * @extend jslet.ui.Control\r\n * \r\n * Dataset designer, it can be used to design a dataset object. <br />  \r\n * Example:\r\n * \r\n *     @example\r\n *     var jsletParam = {type:\"DatasetDesigner\"};\r\n * \r\n *     //1. Declaring:\r\n *     <div id=\"chartId\" data-jslet='type:\"DatasetDesigner\"' />\r\n *     or\r\n *     <div data-jslet='jsletParam' />\r\n *\r\n *     //2. Binding\r\n *     <div id=\"ctrlId\"  />\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *     //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n */\r\njslet.ui.DatasetDesigner = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'onLoadDatasetMeta, onSaveDatasetMeta';\r\n\t\tZ.requiredProperties = 'onLoadDatasetMeta, onSaveDatasetMeta';\r\n\t\t\r\n\t\tZ._datasetMetas = null;\r\n\t\t\r\n\t\tZ._onLoadDatasetMeta = null;\r\n\t\t\r\n\t\tZ._onSaveDatasetMeta = null;\r\n\t\t\r\n\t\tZ._prepareDataset();\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Dataset meta loading event. It can be a Function or a global function name.\r\n\t * \r\n\t * @param {Function | String} onLoadDatasetMeta Dataset meta loading event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonLoadDatasetMeta: function(onLoadDatasetMeta) {\r\n\t\tjslet.Checker.test('DatasetDesigner.onLoadDatasetMeta', onLoadDatasetMeta).required();\r\n\t\tthis._onLoadDatasetMeta = onLoadDatasetMeta;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @event\r\n\t * \r\n\t * Dataset meta saving event. It can be a Function or a global function name.\r\n\t * \r\n\t * @param {Function | String} onSaveDatasetMeta Dataset meta saving event handler.\r\n\t * \r\n\t * @return {this}\r\n\t */\r\n\tonSaveDatasetMeta: function(onSaveDatasetMeta) {\r\n\t\tjslet.Checker.test('DatasetDesigner.onSaveDatasetMeta', onSaveDatasetMeta).required();\r\n\t\tthis._onSaveDatasetMeta = onSaveDatasetMeta;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_prepareDataset: function() {\r\n\t\tvar dsgnLocale = jsletlocale.DatasetDesigner;\r\n\t\tnew jslet.data.Dataset({name: 'dsgnDatatype', isEnum: true, records: \r\n\t\t\t'S:' + dsgnLocale.dtString + \r\n\t\t\t',N:' + dsgnLocale.dtNumber + \r\n\t\t\t',D:' + dsgnLocale.dtDate + \r\n\t\t\t',B:' + dsgnLocale.dtBoolean +\r\n\t\t\t',V:' + dsgnLocale.dtDataset +\r\n\t\t\t',A:' + dsgnLocale.dtAction +\r\n\t\t\t',E:' + dsgnLocale.dtEdit\r\n\t\t\t});\r\n\t\t\r\n\t\tnew jslet.data.Dataset({name: 'dsgnAlignment', isEnum: true, records: \r\n\t\t\t'left:' + dsgnLocale.alLeft + \r\n\t\t\t',center:' + dsgnLocale.alCenter + \r\n\t\t\t',right:' + dsgnLocale.alRight}); \r\n\t\t\r\n\t\tnew jslet.data.Dataset({name: 'dsgnValueStyle', isEnum: true, records: \r\n\t\t\t'0:' + dsgnLocale.vsNormal + \r\n\t\t\t',1:' + dsgnLocale.vsBetween + \r\n\t\t\t',2:' + dsgnLocale.vsMultiple});\r\n\r\n\t\tnew jslet.data.Dataset({name: 'dsgnEditor', fields: [{name: 'code', type: 'S'}], keyField: 'code', \r\n\t\t\trecords: \r\n\t\t[{code: 'DBText'}, {code: 'DBCheckBox'}, {code: 'DBSelect'}, {code: 'DBComboSelect'},\r\n\t\t{code: 'DBAutoComplete'}, {code: 'DBDatePicker'}, {code: 'DBPassword'}, {code: 'DBTextArea'},\r\n\t\t{code: 'DBSpinEdit'}, {code: 'DBBetweenEdit'}, {code: 'DBCheckBoxGroup'}, {code: 'DBRadioGroup'},\r\n\t\t{code: 'DBRangeSelect'}, {code: 'DBDataLabel'}, {code: 'DBTimePicker'}, {code: 'DBImage'},\r\n\t\t{code: 'DBRating'}, {code: 'DBHtml'}, {code: 'DBCKEditor'}, {code: 'DBUEditor'}]\r\n\t\t});\r\n\r\n\t\tvar objAccessor = {\r\n\t\t\tgetValue: function(dataRec, fldName) {\r\n\t\t\t\tif(dataRec) {\r\n\t\t\t\t\tvar origValue = dataRec[fldName];\r\n\t\t\t\t\tif(origValue) {\r\n\t\t\t\t\t\treturn JSON.stringify(origValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tsetValue: function(dataRec, fldName, value) {\r\n\t\t\t\tif(!dataRec) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} \r\n\t\t\t\tif(value && jslet.isString(value)) {\r\n\t\t\t\t\tdataRec[fldName] = JSON.parse(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\t\r\n\t\tvar fldCfg = [\r\n          \t{name: 'name', type: 'S', length: 30, label: dsgnLocale.fName, displayWidth: 20, required: true, unique: true},\r\n          \t{name: 'shortName', type: 'S', length: 10, label: dsgnLocale.fShortName, displayWidth: 10},\r\n          \t{name: 'label', type: 'S', length: 30, label: dsgnLocale.fLabel, displayWidth: 20},\r\n          \t{name: 'displayLabel', type: 'S', length: 30, label: dsgnLocale.fDisplayLabel, displayWidth: 20},\r\n          \t{name: 'tip', type: 'S', length: 30, label: dsgnLocale.fTip, displayWidth: 20},\r\n          \t{name: 'dataType', type: 'S', length: 1, label: dsgnLocale.fDateType, lookup: {dataset:\"dsgnDatatype\"}, displayWidth: 10, defaultValue:'S'},\r\n            {name: 'detailDataset', type: 'S', length: 30, label: dsgnLocale.fDetailDataset, displayWidth: 10},\r\n          \t{name: 'length', type: 'N', length: 3, label: dsgnLocale.fLength, displayWidth: 10, diaplayFormat: '##0', editControl: 'DBSpinEdit', dataRange: {min: 0, max: 10000}, defaultValue: 10},\r\n          \t{name: 'scale', type: 'N', length: 3, label: dsgnLocale.fScale, displayWidth: 6, diaplayFormat: '##0', editControl:'DBSpinEdit', dataRange: {min: 0, max: 10}},\r\n          \t{name: 'defaultExpr', type: 'S', length: 100, label: dsgnLocale.fDefaultExpr, displayWidth: 10},\r\n          \t{name: 'defaultValue', type: 'S', length: 100, label: dsgnLocale.fDefaultValue, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'valueStyle', type: 'S', label: dsgnLocale.fValueStyle, displayWidth: 10, lookup: {dataset:\"dsgnValueStyle\"}, defaultValue: 0},\r\n\r\n          \t{name: 'displayWidth', type: 'N', length: 3, label: dsgnLocale.fDisplayWidth, displayWidth: 10, dataRange: {min: 0, max: 10000}, diaplayFormat: '##0',editControl:'DBSpinEdit'},\r\n          \t{name: 'displayOrder', type: 'N', length: 3, label: dsgnLocale.fDisplayOrder, displayWidth: 6, defaultValue: 0, diaplayFormat: '##0', editControl:'DBSpinEdit', dataRange: {min: 0, max: 10000}},\r\n          \t{name: 'alignment', type: 'S', length: 3, label: dsgnLocale.fAlignment, displayWidth: 10, lookup: {dataset:\"dsgnAlignment\"}},\r\n          \t{name: 'displayFormat', type: 'S', length: 30, label: dsgnLocale.fDisplayFormat, displayWidth: 10},\r\n          \t{name: 'editControl', type: 'S', length: 100, label: dsgnLocale.fEditControl, displayWidth: 10, lookup: {dataset: \"dsgnEditor\"}, nullText: dsgnLocale.fvEditControl},\r\n          \t{name: 'nullText', type: 'S', label: dsgnLocale.fNullText, displayWidth: 10, defaultValue: dsgnLocale.fvNullText},\r\n\r\n          \t{name: 'formula', type: 'S', length: 100, label: dsgnLocale.fFormula, displayWidth: 50},\r\n          \t{name: 'readOnly', type: 'B', label: dsgnLocale.fReadOnly, displayWidth: 10},\r\n          \t{name: 'visible', type: 'B', label: dsgnLocale.fVisible, displayWidth: 10},\r\n          \t{name: 'unitConverted', type: 'B', label: dsgnLocale.fUnitConverted, displayWidth: 10},\r\n\r\n          \t{name: 'required', type: 'B', label: dsgnLocale.fRequired, displayWidth: 10},\r\n          \t{name: 'dataRange', type: 'S', length: 50, label: dsgnLocale.fDataRange, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'regularExpr', type: 'S', length: 50, label: dsgnLocale.fRegularExpr, displayWidth: 10, customValueAccessor: objAccessor},\r\n          \t{name: 'unique', type: 'B', label: dsgnLocale.fUnique, displayWidth: 10},\r\n          \t{name: 'editMask', type: 'S', label: dsgnLocale.fEditMask, displayWidth: 10},\r\n          \t{name: 'valueCountLimit', type: 'N', length: 3, label: dsgnLocale.fValueCountLimit, displayWidth: 8, dataRange: {min: 0, max: 10}, diaplayFormat: '##0', editControl:'DBSpinEdit'},\r\n          \t{name: 'validChars', type: 'S', label: dsgnLocale.fValidChars, displayWidth: 10},\r\n          \t\r\n          \t{name: 'mergeSame', type: 'B', label: dsgnLocale.fMergeSame, displayWidth: 10},\r\n          \t{name: 'mergeSameBy', type: 'S', label: dsgnLocale.fMmergeSameBy, displayWidth: 10},\r\n          \t{name: 'aggraded', type: 'B', label: dsgnLocale.fAggraded, displayWidth: 10},\r\n          \t{name: 'aggradedBy', type: 'S', label: dsgnLocale.fAggradedBy, displayWidth: 10},\r\n          \t{name: 'valueFollow', type: 'B', label: dsgnLocale.fValueFollow, displayWidth: 10},\r\n          \t{name: 'focused', type: 'B', label: dsgnLocale.fFocused, displayWidth: 10},\r\n          \t{name: 'fixedValue', type: 'S', label: dsgnLocale.fFixedValue, displayWidth: 10},\r\n          \t{name: 'antiXss', type: 'B', label: dsgnLocale.fAntiXss, displayWidth: 10},\r\n\r\n          \t{name: 'trueValue', type: 'S', label: dsgnLocale.fTrueValue, displayWidth: 10},\r\n          \t{name: 'falseValue', type: 'S', label: dsgnLocale.fFalseValue, displayWidth: 10},\r\n          \t{name: 'trueText', type: 'S', label: dsgnLocale.fTrueText, displayWidth: 10},\r\n          \t{name: 'falseText', type: 'S', label: dsgnLocale.fFalseText, displayWidth: 10},\r\n          \t\r\n          \t{name: 'lookup', type: 'S', length: 100, label: dsgnLocale.fLookup, displayWidth: 10, customValueAccessor: objAccessor}\r\n          ];\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tvar dsgnField = new jslet.data.Dataset({name: 'dsgnField', fields: fldCfg});\r\n\t\tdsgnField.onFieldChanged(function(fldName, fldValue) {\r\n\t\t\tif(fldName === 'dataType') {\r\n\t\t\t\tZ._doDataTypeChanged(fldValue);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar contextRules = [\r\n\t\t    {condition: '[valueStyle] === 2',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'valueCountLimit', meta: {disabled: false}}\r\n\t\t\t\t],\r\n\t\t\t\totherwise: [\r\n\t\t\t\t\t{field: 'valueCountLimit', meta: {disabled: true}, value: null}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"B\"',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBCheckBox\", \"DBText\", \"DBDataLabel\") '}},\r\n\t\t\t\t    {field: 'valueStyle', meta: {disabled: true}},\r\n\t\t\t\t    {field: 'displayFormat', meta: {disabled: true}},\r\n\t\t\t\t    {field: 'editMask', meta: {disabled: true}}\r\n\t\t\t\t],\r\n\t\t\t\totherwise: [\r\n\t\t\t\t    {field: 'valueStyle', meta: {disabled: false}},\r\n\t\t\t\t    {field: 'displayFormat', meta: {disabled: false}},\r\n\t\t\t\t    {field: 'editMask', meta: {disabled: false}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"D\"',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBDatePicker\", \"DBText\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBComboSelect\", \"DBSelect\", \"DBAutoComplete\", \"DBCheckBoxGroup\", \"DBRadioGroup\",\"DBText\", \"DBDataLabel\")'}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"N\" && ![lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBText\", \"DBSpinEdit\", \"DBRangeSelect\", \"DBRating\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{condition: '[dataType] === \"S\" && ![lookup]',\r\n\t\t\t\trules: [\r\n\t\t\t\t    {field: 'editControl', lookup: {fixedFilter: 'inlist([code], \"DBText\", \"DBTextArea\", \"DBPassword\", \"DBHtml\", \"DBImage\", \"DBCKEditor\", \"DBUEditor\", \"DBDataLabel\") '}}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t];\r\n\t\t\r\n\t\tdsgnField.contextRules(contextRules);\r\n\t\t\r\n\t\tfldCfg = [\r\n\t      \t{name: 'name', type: 'S', length: 30, label: dsgnLocale.dsName, displayWidth: 20, required: true, unique: true},\r\n\t      \t{name: 'description', type: 'S', length: 100, label: dsgnLocale.dsDesc, displayWidth: 20},\r\n\t      \t\r\n\t      \t{name: 'isEnum', type: 'B', defaultValue: false},\r\n\t      \t{name: 'records', type: 'S', length: 2000, editControl: 'DBTextArea'},\r\n\t      \t{name: 'keyField', type: 'S', length: 30, label: dsgnLocale.dsKeyField, displayWidth: 10},\r\n\t      \t{name: 'codeField', type: 'S', length: 30, label: dsgnLocale.dsCodeField, displayWidth: 10},\r\n\t      \t{name: 'nameField', type: 'S', length: 30, label: dsgnLocale.dsNameField, displayWidth: 10},\r\n\t      \t{name: 'parentField', type: 'S', length: 30, label: dsgnLocale.dsParentField, displayWidth: 10},\r\n\t      \t{name: 'selectField', type: 'S', length: 30, label: dsgnLocale.dsSelectField, displayWidth: 10, visible: false},\r\n\t      \t{name: 'statusField', type: 'S', length: 30, label: dsgnLocale.dsStatusField, displayWidth: 10, visible: false},\r\n\t      \t{name: 'contextRules', type: 'S', length: 3000, label: dsgnLocale.dsContextRules, displayWidth: 10},\r\n\t      \t{name: 'queryUrl', type: 'S', length: 300, label: dsgnLocale.dsQueryUrl, displayWidth: 10, visible: false},\r\n\t      \t{name: 'submitUrl', type: 'S', length: 300, label: dsgnLocale.dsSubmitUrl, displayWidth: 10, visible: false},\r\n\t      \t{name: 'recordClass', type: 'S', length: 50, label: dsgnLocale.dsRecordClass, displayWidth: 10, visible: false},\r\n\t      \t{name: 'pageSize', type: 'N', length: 5, label: dsgnLocale.dsPageSize, displayWidth: 10, visible: false},\r\n\t      \t\r\n\t      \t{name: 'fixedIndexFields', type: 'S', length: 100, label: dsgnLocale.dsFixedIndexFields, displayWidth: 10},\r\n\t      \t{name: 'indexFields', type: 'S', length: 100, label: dsgnLocale.dsIndexFields, displayWidth: 10},\r\n\t      \t{name: 'fixedFilter', type: 'S', length: 200, label: dsgnLocale.dsFixedFilter, displayWidth: 10},\r\n\t      \t{name: 'filter', type: 'S', length: 200, label: dsgnLocale.dsFilter, displayWidth: 10},\r\n\t      \t\r\n\t      \t{name: 'filtered', type: 'B', label: dsgnLocale.dsFiltered, displayWidth: 10, visible: false},\r\n\t      \t{name: 'readOnly', type: 'B', label: dsgnLocale.dsReadOnly, displayWidth: 10, visible: false},\r\n\t      \t{name: 'auditLogEnabled', type: 'B', label: dsgnLocale.dsAuditLogEnabled, displayWidth: 10, visible: false},\r\n\t\t\t{name: 'fields', type: 'V', label: 'Fields', detailDataset:'dsgnField', visible:false}\r\n\t    ];\r\n\t\t\r\n\t\tvar dsgnDataset = new jslet.data.Dataset({name: 'dsgnDataset', fields: fldCfg});\r\n\t\t\r\n\t\tfldCfg = [\r\n\t      \t{name: 'id', type: 'S', length: 30},\r\n\t      \t{name: 'objCode', type: 'S', length: 50},\r\n\t      \t{name: 'objName', type: 'S', length: 50},\r\n\t      \t{name: 'objType', type: 'S', length: 2},\r\n\t      \t{name: 'parentId', type: 'S', length: 30},\r\n\t      \t{name: 'changed', type: 'B'},\r\n\t      \t{name: 'isEnum', type: 'B'},\r\n\t      \t{name: 'dsName', type: 'S'},\r\n\t      \t{name: 'fldName', type: 'S'}\r\n\t\t];\r\n\t\tvar dsObject = new jslet.data.Dataset({name: 'dsgnObject', fields: fldCfg, keyField: 'id', codeField: 'objCode', nameField: 'objName', parentField: 'parentId', logChanges: false});\r\n\t\tdsObject.on(jslet.data.DatasetEvent.AFTERSCROLL, function() {\r\n\t\t\tZ._doObjectChanged();\r\n\t\t});\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(jqEl.hasClass('jl-dsgn-ds')) {\r\n\t\t\tjqEl.addClass('form-group form-group-sm jl-dsgn-ds');\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el);\r\n\t\tvar html = '<div class=\"col-xs-3\" style=\"height: 100%\"><div style=\"height: 100%\" name=\"dsgnObject\" ' + \r\n\t\t\t'data-jslet=\"type: \\'DBTreeView\\', dataset: \\'dsgnObject\\', displayFields: \\'[objName] + %22(%22 + [objCode] + %22)%22\\', expandLevel: 1\"' +\r\n\t\t\t'></div></div>' + \r\n\t\t\t'<div class=\"col-xs-9\">' + \r\n\t\t\t'<div name=\"dsgnDs\" style=\"display: none\">' + \r\n\t\t\t'<div name=\"dsgnDsBase\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'name\\'}, {field: \\'description\\', dataCols: 6}]\"></div>' + \r\n\r\n\t\t\t'<div name=\"dsgnEnumValues\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'records\\'}]\"></div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnDsLookup\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'keyField\\'}, {field: \\'codeField\\'}, {field: \\'nameField\\'}, {field: \\'parentField\\'}]\"></div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnDsFilter\" style=\"display: none\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnDataset\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'fixedIndexFields\\'}, {field: \\'indexFields\\'}, {field: \\'fixedFilter\\'}, {field: \\'filter\\'}]\"></div>' + \r\n\t\t\t'</div>' + \r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFld\" style=\"display: none\">' + \r\n\t\t\t'<div name=\"dsgnFldBase\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'name\\'}, {field: \\'label\\'}, {field: \\'shortName\\'}, {field: \\'dataType\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldDetail\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'detailDataset\\', dataCols: 6}]\"></div>' +\r\n\r\n\t\t\t'<div name=\"dsgnFldCommon\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'displayOrder\\'},{field: \\'displayWidth\\'}, {field: \\'alignment\\'}, {field: \\'visible\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldLookup\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'lookup\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldEditable\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'editControl\\'}, {field: \\'readOnly\\'}, {field: \\'required\\'}, {field: \\'unique\\'}, {field: \\'nullText\\'}, {field: \\'valueStyle\\'}, {field: \\'valueCountLimit\\'}, ' + \r\n\t\t\t'{field: \\'defaultValue\\'}, {field: \\'displayFormat\\'}, {field: \\'editMask\\'}, {field: \\'focused\\'}, ' + \r\n\t\t\t'{field: \\'valueFollow\\'}, {field: \\'dataRange\\'}, {field: \\'regularExpr\\'}, {field: \\'mergeSame\\', inFirstCol: true}, {field: \\'mergeSameBy\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldAction\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'fixedValue\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldBool\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'trueValue\\'}, {field: \\'falseValue\\'}, {field: \\'trueText\\'}, {field: \\'falseText\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldString\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'antiXss\\'}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'<div name=\"dsgnFldNumber\" data-jslet=\"type:\\'DBEditPanel\\', dataset: \\'dsgnField\\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,' + \r\n\t\t\t'fields: [{field: \\'aggraded\\'}, {field: \\'aggradedBy\\', dataCols: 6}]\"></div>' +\r\n\t\t\t\r\n\t\t\t'</div>';\r\n\t\tconsole.log(html);\r\n\t\t\r\n\t\tjqEl.html(html);\r\n\t\tjslet.ui.install(Z.el);\r\n\t\tjslet(jqEl.find('[name=\"dsgnObject\"]')).onGetIconClass(function() {\r\n\t\t\tvar dsObj = this.dataset();\r\n\t\t\tif(dsObj.getFieldValue('objType') === 'd') {\r\n\t\t\t\treturn 'fa fa-table';\r\n\t\t\t} else {\r\n\t\t\t\treturn 'fa fa-dot-circle-o';\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.queryDatasetMeta();\r\n\t},\r\n\t\r\n\tqueryDatasetMeta: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._onLoadDatasetMeta) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsMetas = Z._onLoadDatasetMeta();\r\n\t\tif(!dsMetas) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(dsMetas.done) {\r\n\t\t\tdsMetas.done(function(result) {\r\n\t\t\t\tZ._parse(result);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tZ._parse(dsMetas);\r\n\t\t}\r\n\t},\r\n\t\r\n\taddDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.appendRecord();\r\n\t\tdsObject.setFieldValue('isEnum', true);\r\n\t},\r\n\t\r\n\taddEnumDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.appendRecord();\r\n\t\tdsObject.setFieldValue('isEnum', false);\r\n\t},\r\n\t\r\n\tdeleteDatasetMeta: function() {\r\n\t\tvar dsObject = jslet.data.getDataset('dsgnObject');\r\n\t\tdsObject.deleteRecord();\r\n\t},\r\n\t\r\n\t_parse: function (dsMetas) {\r\n\t\tthis._datasetMetas = dsMetas;\r\n\t\tjslet.data.getDataset('dsgnDataset').records(dsMetas);\r\n\t\tif(!dsMetas || dsMetas.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar dsMeta, arrObj = [];\r\n\t\t\r\n\t\tfunction addFields(fields, parentId, dsName) {\r\n\t\t\tvar fldMeta, fldId, fldName;\r\n\t\t\tfor(var j = 0, fldLen = fields.length; j < fldLen; j++) {\r\n\t\t\t\tfldMeta = fields[j];\r\n\t\t\t\tfldName = fldMeta.name;\r\n\t\t\t\tfldId = 'f-' + fldName;\r\n\t\t\t\tarrObj.push({id: fldId, objCode: fldName, objName: fldMeta.label || fldMeta.name, objType: 'f', parentId: parentId, dsName: dsName, fldName: fldName});\r\n\t\t\t\tif(fldMeta.children) {\r\n\t\t\t\t\taddFields(fldMeta.children, fldId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar dsId, isEnum, dsName;\r\n\t\tfor(var i = 0, len = dsMetas.length; i < len; i++) {\r\n\t\t\tdsMeta = dsMetas[i];\r\n\t\t\tdsName = dsMeta.name;\r\n\t\t\tdsId = 'd-' + dsName;\r\n\t\t\tisEnum = dsMeta.isEnum? true: false;\r\n\t\t\tarrObj.push({id: dsId, objCode: dsName, objName: dsMeta.description || dsName, objType: 'd', isEnum: isEnum, dsName: dsName});\r\n\t\t\tif(!isEnum) {\r\n\t\t\t\taddFields(dsMeta.fields, dsId, dsName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.data.getDataset('dsgnObject').records(arrObj);\r\n\t},\r\n\t\r\n\t_doObjectChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObject = jslet.data.getDataset('dsgnObject'),\r\n\t\t\tobjType = dsObject.getFieldValue('objType'),\r\n\t\t\tdsName = dsObject.getFieldValue('dsName'),\r\n\t\t\tfldName = dsObject.getFieldValue('fldName'),\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqDataset = jqEl.find('[name=dsgnDs]'),\r\n\t\t\tjqDsLookup = jqEl.find('[name=dsgnDsLookup]'),\r\n\t\t\tjqDsFilter = jqEl.find('[name=dsgnDsFilter]'),\r\n\t\t\t\r\n\t\t\tjqField = jqEl.find('[name=dsgnFld]'),\r\n\t\t\tdsgnDataset = jslet.data.getDataset('dsgnDataset'),\r\n\t\t\tdsgnField = jslet.data.getDataset('dsgnField');\r\n\t\tif(objType === 'd' ) {\r\n\t\t\tdsgnDataset.findByField('name', dsName);\r\n\t\t\tvar isEnum = dsObject.getFieldValue('isEnum');\r\n\t\t\tif(isEnum) {\r\n\t\t\t\tjqDsLookup.hide();\r\n\t\t\t\tjqDsFilter.hide();\r\n\t\t\t} else {\r\n\t\t\t\tjqDsLookup.show();\r\n\t\t\t\tjqDsFilter.show();\r\n\t\t\t}\r\n\t\t\tjqField.hide();\r\n\t\t\tjqDataset.show();\r\n\t\t} else {\r\n\t\t\tdsgnDataset.findByField('name', dsName);\r\n\t\t\tdsgnField.findByField('name', fldName);\r\n\t\t\tvar dataType = dsgnField.getFieldValue('dataType');\r\n\t\t\tZ._doDataTypeChanged(dataType);\r\n\t\t\tjqDataset.hide();\r\n\t\t\tjqField.show();\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doDataTypeChanged: function(dataType) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tdsgnField = jslet.data.getDataset('dsgnField'),\r\n\t\t\tjqFldDetail = jqEl.find('[name=dsgnFldDetail]'),\r\n\t\t\tjqFldCommon = jqEl.find('[name=dsgnFldCommon]'),\r\n\t\t\tjqFldAction = jqEl.find('[name=dsgnFldAction]'),\r\n\t\t\tjqFldEditAction = jqEl.find('[name=dsgnFldEditAction]'),\r\n\r\n\t\t\tjqFldEditable = jqEl.find('[name=dsgnFldEditable]'),\r\n\t\t\tjqFldBool = jqEl.find('[name=dsgnFldBool]'),\r\n\t\t\tjqFldLookup = jqEl.find('[name=dsgnFldLookup]'),\r\n\t\t\tjqFldString = jqEl.find('[name=dsgnFldString]'),\r\n\t\t\tjqFldNumber = jqEl.find('[name=dsgnFldNumber]');\r\n\t\t\r\n\t\tjqFldDetail.hide();\r\n\t\tjqFldCommon.hide();\r\n\t\tjqFldAction.hide();\r\n\t\tjqFldEditAction.hide();\r\n\t\tjqFldBool.hide();\r\n\t\tjqFldEditable.hide();\r\n\t\tjqFldLookup.hide();\r\n\t\tjqFldString.hide();\r\n\t\tjqFldNumber.hide();\r\n\t\tif(dataType === jslet.data.DataType.DATASET) {\r\n\t\t\tjqFldDetail.show();\r\n\t\t\tdsgnField.getField('detailDataset').required(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdsgnField.getField('detailDataset').required(false);\r\n\t\t\r\n\t\tjqFldCommon.show();\r\n\t\tif(dataType === jslet.data.DataType.EDITACTION) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(dataType === jslet.data.DataType.ACTION) {\r\n\t\t\tjqFldAction.show();\r\n\t\t\tdsgnField.getField('fixedValue').required(true);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tdsgnField.getField('fixedValue').required(false);\r\n\t\t}\r\n\t\t\r\n\t\tjqFldEditable.show();\r\n\t\tif(dataType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\tjqFldBool.show();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(dataType === jslet.data.DataType.DATE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjqFldLookup.show();\r\n\t\tif(dataType === jslet.data.DataType.STRING) {\r\n\t\t\tjqFldString.show();\r\n\t\t}\r\n\t\t\r\n\t\tif(dataType === jslet.data.DataType.NUMBER) {\r\n\t\t\tjqFldNumber.show();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DatasetDesigner', jslet.ui.DatasetDesigner);\r\njslet.ui.DatasetDesigner.htmlTemplate = '<div></div>';\r\n\n/**\r\n * @class jslet.Report\r\n * \r\n * A class to connect to jslet report assistant. It provides the following feature:\r\n * design report, preview report, print report.\r\n */\r\n\r\n(function() {\r\n\tvar wsSocket, serverIp, onSavingReport;\r\n\tjslet.Report = function(reportServerIp) {\r\n\t\tserverIp = reportServerIp;\r\n\t};\r\n\t\r\n\tjslet.Report.prototype = {\r\n\t\t\r\n\t\tgetWsSocket: function() {\r\n\t\t\tif(!wsSocket) {\r\n\t\t\t\twsSocket = new WsSocket(serverIp);\r\n\t\t\t\t\r\n\t\t\t\twsSocket.onSavingReport = function(reportBo) {\r\n\t\t\t\t\tvar template = window.decodeURIComponent(window.escape(window.atob(reportBo.template)));\r\n\t\t\t\t\treportBo.template = template;\r\n\t\t\t\t\tif(onSavingReport) {\r\n\t\t\t\t\t\tonSavingReport.call(reportBo);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn wsSocket;\r\n\t\t},\r\n\t\t\r\n\t\tonSavingReport: function(savingReportFn) {\r\n\t\t\tif(savingReportFn === undefined) {\r\n\t\t\t\treturn onSavingReport;\r\n\t\t\t}\r\n\t\t\tonSavingReport = savingReportFn;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Design a report template. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     //Design a new report template.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List');\r\n\t\t *     \r\n\t\t *     var template = '...';\r\n\t\t *     //Design an existed report template.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.design('employee', 'report1', 'Employee List', null, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t */\r\n\t\tdesign: function(datasets, reportId, reportName, templateXml, printFields) {\r\n\t\t\tjslet.Checker.test('Report.design#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.design#template', templateXml).isString();\r\n\t\t\tjslet.Checker.test('Report.design#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields);\r\n\t\t\tthis.getWsSocket().designReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Preview a report. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     var template = '...';\r\n\t\t *     //Preview all records.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t *     //Preview the current record.\r\n\t\t *     jslet.defaultReport.preview('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}}, jslet.data.RecordRange.CURRENT);\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t * @param {jslet.data.RecordRange} printRange Record range to preview, \r\n\t\t * \t\tthe optional values are jslet.data.RecordRange.ALL(default), \r\n\t\t * \t\tjslet.data.RecordRange.SELECTED, jslet.data.RecordRange.CURRENT.\r\n\t\t */\r\n\t\tpreview: function(datasets, reportId, reportName, templateXml, printFields, printRange) {\r\n\t\t\tjslet.Checker.test('Report.preview#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#template', templateXml).required().isString();\r\n\t\t\tjslet.Checker.test('Report.preview#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields, printRange);\r\n\t\t\tvar wsSocket = new WsSocket();\r\n\t\t\tthis.getWsSocket().previewReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Print a report. Example:\r\n\t\t * \r\n\t\t *     @example\r\n\t\t *     var template = '...';\r\n\t\t *     //Print all records.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template);\r\n\t\t *     \r\n\t\t *     //Exclude the 'salary' field.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}});\r\n\t\t * \r\n\t\t *     //Print the current record.\r\n\t\t *     jslet.defaultReport.print('employee', 'report1', 'Employee List', template, \r\n\t\t *     \t\t{'employee':{exclude:'salary'}}, jslet.data.RecordRange.CURRENT);\r\n\t\t * \r\n\t\t * @param {String} datasets (Required)Dataset names, multiple dataset names are separated by comma(,).\r\n\t\t * @param {String} reportId (Required)Report id.\r\n\t\t * @param {String} reportName (Required)Report name.\r\n\t\t * @param {String} templateXml (Required)Report template XML string, the template is designed by jslet.defaultReport.design(..).\r\n\t\t * @param {Object} printFields The fields need to be print, the format is:\r\n\t\t * \t\t{dsName: {includeFields: ['f1',...], excludeFields: ['f3',...]}}, \r\n\t\t * \t\tfor example: {'employee', {includeFields: ['code']}, excludeFields: ['birthday']}}.\r\n\t\t * @param {jslet.data.RecordRange} printRange Record range to print, \r\n\t\t * \t\tthe optional values are jslet.data.RecordRange.ALL(default), \r\n\t\t * \t\tjslet.data.RecordRange.SELECTED, jslet.data.RecordRange.CURRENT.\r\n\t\t */\r\n\t\tprint: function(datasets, reportId, reportName, templateXml, printFields, printRange) {\r\n\t\t\tjslet.Checker.test('Report.print#datasets', datasets).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#reportId', reportId).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#reportName', reportName).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#template', templateXml).required().isString();\r\n\t\t\tjslet.Checker.test('Report.print#printFields', printFields).isPlanObject();\r\n\t\t\tvar reportBo = this._combineReportBo(reportId, reportName, datasets, templateXml, printFields, printRange);\r\n\t\t\tvar wsSocket = new WsSocket();\r\n\t\t\tthis.getWsSocket().printReport(reportBo);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t\r\n\t\t_combineReportBo: function(reportId, reportName, datasets, templateXml, printFields, printRange, inDesign) {\r\n\t\t\tvar reportBO = {reportId: reportId, reportName: reportName};\r\n\t\t\tvar template = templateXml? window.btoa(window.unescape(window.encodeURIComponent(templateXml))): null;\r\n\t\t\treportBO.template = template;\r\n\r\n\t\t\tvar rptDatasets = [];\r\n\t\t\treportBO.datasets = rptDatasets;\r\n\t\t\tvar dsCodes = datasets.split(','), dsCode, rtnCfg, \r\n\t\t\t\trecordRange = null, dsPrintFields;\r\n\t\t\tfor(var i = 0, len = dsCodes.length; i < len; i++) {\r\n\t\t\t\tdsCode = dsCodes[i];\r\n\t\t\t\trtnCfg = this._createRptDataset(rptDatasets, dsCode, null, printFields);\r\n\t\t\t\tif(inDesign) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(printRange) {\r\n\t\t\t\t\trecordRange = printRange[dsCode] || null;\r\n\t\t\t\t}\r\n\t\t\t\trtnCfg.rptDataset.data = rtnCfg.dataset.exportTextArray({exportHeader: false, recordRange: recordRange, includeFields: rtnCfg.fieldNames});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn reportBO;\r\n\t\t},\r\n\t\t\r\n\t\t_createRptDataset: function(rptDatasets, dsCode, dsName, printFields) {\r\n\t\t\tvar dsObj = jslet.data.getDataset(dsCode);\r\n\t\t\tif(!dsObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jsletlocale.Report.notFoundDs, dsCode));\r\n\t\t\t}\r\n\t\t\tif(!dsName) {\r\n\t\t\t\tdsName = dsObj.description();\r\n\t\t\t}\r\n\t\t\tvar rptDataset = {name: dsName};\r\n\t\t\trptDatasets.push(rptDataset);\r\n\t\t\tvar rptFields = [];\r\n\t\t\trptDataset.fields = rptFields;\r\n\t\t\tvar dsPrintFields = printFields && printFields[dsCode], includeFields, excludeFields;\r\n\t\t\tif(dsPrintFields) {\r\n\t\t\t\tincludeFields = dsPrintFields && dsPrintFields.includeFields;\r\n\t\t\t\texcludeFields = dsPrintFields && dsPrintFields.excludeFields;\r\n\t\t\t}\r\n\r\n\t\t\tvar fields = dsObj.getNormalFields(), fldObj, dataType, fldName,\r\n\t\t\t\tarrFldNames = [];\r\n\t\t\tfor(var i = 0 , len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(includeFields && includeFields.indexOf(fldName) < 0 || \r\n\t\t\t\t\texcludeFields && excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tdataType = fldObj.getType();\r\n\t\t\t\tif(fldObj.lookup()) { //\r\n\t\t\t\t\tdataType = 'S';\r\n\t\t\t\t}\r\n\t\t\t\tif(dataType == 'V') { //\r\n\t\t\t\t\tthis._createRptDataset(rptDatasets, fldObj.detailDataset(), fldObj.label(), printFields);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\t\tif(!includeFields || includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trptFields.push(jslet.trim(fldObj.label()) + '|' + dataType);\r\n\t\t\t\tarrFldNames.push(fldName);\r\n\t\t\t}\r\n\t\t\treturn {dataset: dsObj, fieldNames: arrFldNames, rptDataset: rptDataset};\r\n\t\t}\r\n\t};\r\n\r\n\tjslet.defaultReport = new jslet.Report();\r\n/*\r\n**************************************************************************\r\n sgcWebSocket component\r\n\r\n written by eSeGeCe\r\n \r\n            copyright ?2016\r\n            Email : info@esegece.com\r\n            Web : http://www.esegece.com\r\n**************************************************************************\r\n*/\r\n/* jshint ignore:start */\r\nfunction GUID(){var a=function(){return Math.floor(Math.random()*65536).toString(16)};return(a()+a()+a()+a()+a()+a()+a()+a())}function event(a){this.name=a;this.eventAction=null;this.subscribe=function(b){this.eventAction=b};this.fire=function(c,b){if(this.eventAction!=null){this.eventAction(c,b)}}}function sgcStreamToString(b,c){var a=new FileReader();a.readAsText(b);a.onload=function(){vResult=a.result;c(vResult)}}function sgcWSStreamRead(b,c){var a=b.slice(0,10);sgcStreamToString(a,function(f){var e=parseInt(f);var d=b.slice(10,10+e);sgcStreamToString(d,function(h){var g=h;var i=b.slice(10+e,b.size);c(g,i)})})}function sgcWebSocket(){if(arguments.length==0){return}if(typeof arguments[0]==\"object\"){this.host=arguments[0][\"host\"];this.subprotocol=arguments[0][\"subprotocol\"];this.user=arguments[0][\"user\"];this.password=arguments[0][\"password\"];this.transport=arguments[0][\"transport\"]}else{if(typeof arguments[0]==\"string\"){this.host=arguments[0];this.subprotocol=arguments[1];this.transport=arguments[2]}else{return}}if(this.host==undefined){this.host=\"127.0.0.1\"}if(this.subprotocol==undefined){this.subprotocol=\"\"}if(this.transport==undefined){this.transport=[\"websocket\",\"sse\"]}var a=new event(\"onopen\");var c=new event(\"onclose\");var f=new event(\"onmessage\");var e=new event(\"onerror\");if((window.WebSocket)&&(this.transport.indexOf(\"websocket\")>-1)){var d=new event(\"onstream\");this.open=function(){if((this.host!==\"\")&&(this.user!==\"\")&&(this.user!==undefined)){if(this.password==undefined){this.password==\"\"}if((this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.websocket=new WebSocket(this.host+\"/sgc/auth/url/\"+this.user+\"/\"+this.password,this.subprotocol)}else{this.websocket=new WebSocket(this.host+\"/sgc/auth/url/\"+this.user+\"/\"+this.password)}}else{if((this.host!==\"\")&&(this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.websocket=new WebSocket(this.host,this.subprotocol)}else{if(this.host!==\"\"){this.websocket=new WebSocket(this.host)}}}this.websocket.onopen=function(){a.fire({name:\"onopen\",message:\"\"})};this.websocket.onmessage=function(g){if(typeof g.data===\"object\"){d.fire({name:\"onstream\",stream:g.data})}else{f.fire({name:\"onmessage\",message:g.data})}};this.websocket.onclose=function(g){c.fire({name:\"onclose\",message:\"\",code:g.code,reason:g.reason,clean:g.wasClean})};this.websocket.onerror=function(g){e.fire({name:\"onerror\",message:g.data})}};if(this.websocket==undefined){this.open()}this.send=function(g){this.websocket.send(g)};this.close=function(){this.websocket.close()};this.state=function(){switch(this.websocket.readyState){case 0:return\"connecting\";break;case 1:return\"open\";break;case 2:return\"closing\";break;case 3:return\"closed\";break;default:return\"undefined\";break}};this.on=function(g,h){if(g==\"open\"){a.subscribe(h)}else{if(g==\"close\"){c.subscribe(h)}else{if(g==\"message\"){f.subscribe(h)}else{if(g==\"stream\"){d.subscribe(h)}else{if(g==\"error\"){e.subscribe(h)}}}}}}}else{if((window.EventSource)&&(this.transport.indexOf(\"sse\")>-1)){var b=\"\";this.open=function(){if((this.host!==\"\")&&(this.user!==\"\")&&(this.user!==undefined)){if(this.password==undefined){this.password==\"\"}if((this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\\:\\/{2}[a-z,0-9,.]{1,}\\:[0-9]{1,4}.(.*)/,\"$1\")+\"/sgc/auth/url/\"+this.user+\"/\"+this.password+\"/\"+this.subprotocol)}else{this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\\:\\/{2}[a-z,0-9,.]{1,}\\:[0-9]{1,4}.(.*)/,\"$1\")+\"/sgc/auth/url/\"+this.user+\"/\"+this.password)}}else{if((this.host!==\"\")&&(this.subprotocol!==\"\")&&(this.subprotocol!==undefined)){this.EventSource=new EventSource(this.subprotocol)}else{if(this.host!==\"\"){this.EventSource=new EventSource(\"/\")}}}this.EventSource.onopen=function(){a.fire({name:\"onopen\",message:\"\"})};this.EventSource.onmessage=function(g){if(b==\"\"){b=g.data}else{f.fire({name:\"onmessage\",message:g.data})}};this.EventSource.onerror=function(g){e.fire({name:\"onerror\",message:g.data})}};if(this.EventSource==undefined){this.open()}this.send=function(g){if(b!==\"\"){if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else{if(window.ActiveXObject){xhr=new ActiveXObject(\"Microsoft.XMLHTTP\")}else{return}}xhr.open(\"POST\",\"/sgc/xhr/\"+b,true);xhr.send(g)}};this.close=function(){this.EventSource.close();c.fire({name:\"onclose\",message:\"\",code:1000,reason:\"\",clean:true})};this.state=function(){switch(this.EventSource.readyState){case 0:return\"connecting\";break;case 1:return\"open\";break;case 2:return\"closed\";break;default:return\"undefined\";break}};this.on=function(g,h){if(g==\"open\"){a.subscribe(h)}else{if(g==\"close\"){c.subscribe(h)}else{if(g==\"message\"){f.subscribe(h)}else{if(g==\"error\"){e.subscribe(h)}}}}}}else{alert(\"WebSockets not supported by your Browser.\")}}};\r\n/* jshint ignore:end */\r\nvar assistantURL, authURLSSL, isSSL;\r\nvar WsSocket = function(serverIp) {\r\n\tserverIp = serverIp || '127.0.0.1';\r\n\tisSSL = document.location.protocol == 'https:';\r\n\tif(isSSL) {\r\n\t\tassistantURL = 'wss://' + serverIp + ':20169';\r\n\t} else {\r\n\t\tassistantURL = 'ws://' + serverIp + ':20167';\r\n\t}\r\n\tauthURLSSL = 'https://' + serverIp + ':20169';\r\n\t\r\n\tthis.ws = null;\r\n\t\r\n\tthis.connected = false;\r\n\t\r\n\tthis.onSavingReport = null;\r\n\t\r\n\tthis.needAlert = true;\r\n\t\r\n\tthis.version = null;\r\n};\r\n\r\nWsSocket.prototype = {\r\n\topen: function(openCallBackFn) {\r\n        this.connected = false;\r\n\t\tvar self = this;\r\n\t\t/* jshint ignore:start */\r\n        this.ws = new sgcWebSocket(assistantURL);\r\n        /* jshint ignore:end */\r\n        this.ws.on('open', function(evt){\r\n            self.connected = true;\r\n\t\t\tif(openCallBackFn) {\r\n\t\t\t\topenCallBackFn();\r\n\t\t\t}\r\n\t\t});\r\n\r\n        this.ws.on('message', function(event) {\r\n        \tvar messageText = event.message;\r\n        \tvar message = JSON.parse(messageText);\r\n        \t\r\n\t\t\tvar msgName = message.name;\r\n\t\t\tvar msgBody = message.body;\r\n\t\t\tif(msgName == 'save' && self.onSavingReport) {\r\n\t\t\t\tself.onSavingReport(msgBody);\r\n\t\t\t}\r\n        \r\n\t\t\tif(msgName == 'version') {\r\n\t\t\t\tself.version = msgBody;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(self.onMessage) {\r\n\t\t\t\tself.onMessage(message);\r\n\t\t\t}\r\n\t\t\t\r\n        });\r\n        \r\n        this.ws.on('close', function() {\r\n        \tself.connected = false;\r\n        });\r\n        \r\n        this.ws.on('error', function(event, msg) {\r\n        \tvar tips = jsletlocale.Report.tips;\r\n\t\t\tif(isSSL && self.needAlert) {\r\n\t\t\t\ttips += '<br /><br />' + jsletlocale.Report.tips1;\r\n\t            jslet.ui.confirm(tips, null, function(button){\r\n\t\t\t\t\tif(button == 'ok') {\r\n\t\t\t\t\t\tjslet.ui.info(jsletlocale.Report.ignoreWarning);\r\n\t\t\t\t\t\twindow.open(authURLSSL);\r\n\t\t\t\t\t}\r\n                });\r\n\t\t\t} else {\r\n\t\t\t\tjslet.ui.info(tips);\r\n\t\t\t}\r\n        \tthis.connected = false;\r\n        });\r\n\t},\r\n\t\r\n\tsend: function(msgText) {\r\n\t\tvar self = this;\r\n\t\tif(!this.ws || !this.connected) {\r\n\t\t\tthis.open(function() {\r\n\t\t\t\tself._innerSend(msgText);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tself._innerSend(msgText);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_innerSend: function(msgText) {\r\n\t\tif(!this.ws || !this.connected) {\r\n\t\t\tif(this.needAlert) {\r\n\t\t\t\tconsole.log(jsletlocale.tips);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!msgText) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar state = this.ws.state();\r\n\t\tif(state == 'open') {\r\n\t\t\tvar self = this;\r\n\t\t\ttry {\r\n\t\t\t\tself.ws.send(JSON.stringify(msgText));\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(jsletlocale.tips);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdesignReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"design\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tpreviewReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"preview\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tprintReport: function(report) {\r\n\t\tthis.needAlert = true;\r\n\t\tvar msg = {\"name\":\"print\", \"body\": report}; \r\n\t\tthis.send(msg);\r\n\t},\r\n\t\r\n\tupgrade: function(upgradeUrl) {\r\n\t\tthis.needAlert = false;\r\n\t\tthis.send({\"name\": \"upgrade\", \"body\": upgradeUrl});\r\n\t},\r\n\t\r\n\tgetVersion: function() {\r\n\t\tvar msg = {\"name\": \"version\"};\r\n\t\tthis.needAlert = false;\r\n\t\tthis.send(msg);\r\n\t}\r\n};\r\n})();\r\n\n/* jshint ignore:start */\r\n\treturn jslet;\r\n});\r\n/* jshint ignore:end */\r\n"],"sourceRoot":"/source/"}