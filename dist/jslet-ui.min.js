/*!
 * Jslet Javascript Framework v4.0.0
 * https://github.com/jslet/jslet/
 *
 * Copyright 2016 Jslet Team
 * Released under GNU AGPL v3.0 license
 */
 
"use strict";!function(e,t){"function"==typeof define?define.amd?define("jslet-ui",["jslet-data","jslet-locale"],t):define(function(require,e,i){require("jslet-css");var l=require("jslet-data"),n=require("jslet-locale");i.exports=t(l,n)}):t(window.jslet,window.jsletlocale)}(this,function(e,t){e.ui||(e.ui={}),e.ui.Control=e.Class.create({initialize:function(i,l){var n=this;if(n.el=i,n.binded=!1,n.allProperties=null,l=e.ui._evalParams(l),n.isValidTemplateTag&&!n.isValidTemplateTag(n.el)){var a,r=e.ui.getControlClass(l.type);throw a=r?r.htmlTemplate:"",new Error(e.formatMessage(t.DBControl.invalidHtmlTag,a))}n._styleClass=null,n.styleClass=function(e){return void 0===e?n._styleClass:void(n._styleClass=e)},n._childControls=null,n.setParams(l),n.checkRequiredProperty(),n.el.jslet=this,n.beforeBind(),n.el.id||(n.el.id=e.nextId()),n.bind();var s=jQuery(n.el);n._styleClass&&s.addClass(n._styleClass),n.afterBind(),n.binded=!0},beforeBind:function(){},bind:function(){},afterBind:function(){},renderAll:function(){return this},setParams:function(e){if(e){var t=e.type;this.styleClass(e.styleClass);for(var i in e){var l=this[i];if("type"!=i&&"styleClass"!=i){if(!l||!l.call)throw new Error(t+" NOT support control property: "+i);l.call(this,e[i])}}}},checkRequiredProperty:function(){if(this.requiredProperties)for(var i,l=this.requiredProperties.split(","),n=l.length,a=0;n>a;a++)if(i=l[a].trim(),!this[i])throw new Error(e.formatMessage(t.DBControl.expectedProperty,[i]))},addChildControl:function(e){var t=this;t._childControls||(t._childControls=[]),e&&t._childControls.push(e)},doUIChanged:function(){},removeAllChildControls:function(){var e,t=this;if(t._childControls){for(var i=0,l=t._childControls.length;l>i;i++)e=t._childControls[i],e.destroy();t._childControls=null}t.el&&(t.el.innerHTML="")},destroy:function(){this.el&&(this.el.jslet=null,this.el=null)}}),e.ui.DBControl=e.Class.create(e.ui.Control,{initialize:function($super,e,t){$super(e,t)},_dataset:void 0,_isDBControl:!0,dataset:function(t){return void 0===t?this._dataset:(e.isString(t)&&(t=e.data.getDataset(jQuery.trim(t))),e.Checker.test("DBControl.dataset",t).required().isClass(e.data.Dataset.className),this._dataset=t,this)},setParams:function($super,e){if($super(e),this._isDBControl&&!this._dataset){var t=this.getDatasetInParentElement();this.dataset(t)}},beforeBind:function($super){$super(),this._isDBControl&&this._dataset.addLinkedControl(this)},checkRequiredProperty:function($super){this._isDBControl&&e.Checker.test("DBControl.dataset",this._dataset).required(),$super()},refreshControl:function(t){var i,l=this;if(i=t?t.eventType:e.data.RefreshEvent.UPDATEALL,i==e.data.RefreshEvent.CHANGEMETA){var n=t.metaName;return l._field&&l._field==t.fieldName?l.doMetaChanged(n):l._field||"visible"!=n&&"editControl"!=n||l.doMetaChanged(n),!0}return i==e.data.RefreshEvent.UPDATELOOKUP&&t.fieldName==l._field?(l.doLookupChanged(t.isMetaChanged),!0):i==e.data.RefreshEvent.SCROLL||i==e.data.RefreshEvent.INSERT||i==e.data.RefreshEvent.DELETE?(l.doValueChanged(),!0):(i==e.data.RefreshEvent.UPDATERECORD||i==e.data.RefreshEvent.UPDATECOLUMN)&&void 0===t.fieldName||t&&t.fieldName==l._field?(l.doValueChanged(),!0):i==e.data.RefreshEvent.UPDATEALL?(l.doMetaChanged(),l.doLookupChanged(),l.doValueChanged(),!0):!0},doMetaChanged:function(e){},doValueChanged:function(){},doLookupChanged:function(){},getDatasetInParentElement:function(){for(var t=this.el,i=null;;){if(i=e.ui.getParentElement(t,1),!i)break;if(i.jslet)return i.jslet.dataset;t=i}return null},destroy:function($super){this.removeAllChildControls(),this._isDBControl&&this._dataset&&this._dataset.removeLinkedControl(this),this._dataset=null,$super()}}),e.ui.DBFieldControl=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){$super(e,t)},_field:void 0,_valueIndex:void 0,_enableInvalidTip:!0,_tableId:null,_tabIndex:null,field:function(t){if(void 0===t)return this._field;t=jQuery.trim(t),e.Checker.test("DBControl.field",t).isString().required();var i=t.lastIndexOf("#");return i>0&&(this._fieldMeta=t.substring(i+1),t=t.substring(0,i)),this._field=t,this},fieldMeta:function(){return this._fieldMeta},valueIndex:function(t){return void 0===t?this._valueIndex:(e.Checker.test("DBControl.valueIndex",t).isNumber(),this._valueIndex=parseInt(t),this)},tabIndex:function(t){return void 0===t?this._tabIndex:(e.Checker.test("DBControl.tabIndex",t).isNumber(),this._tabIndex=t,this)},setParams:function($super,e){if($super(e),this._isDBControl){var t=e.valueIndex;void 0!==t&&this.valueIndex(t)}var i=e.tabIndex;void 0!==i&&this.tabIndex(i)},checkRequiredProperty:function($super){$super(),this._isDBControl&&(e.Checker.test("DBControl.field",this._field).required(),this.existField(this._field))},doMetaChanged:function($super,e){if($super(e),!e||"tip"==e){var t=this._dataset.getField(this._field);if(!t)throw new Error("Field: "+this._field+" NOT exist!");var i=t.tip();i=i?i:"",this.el.title=i}},setTabIndex:function(){var e=this,t=e._tabIndex;if(e._isDBControl&&0!==t&&!t){var i=e._dataset.getField(e._field);i&&(t=i.tabIndex())}(0===t||t)&&(e.el.tabIndex=t)},existField:function(e){var t=this._dataset.getField(e);return!!t},tableId:function(e){return void 0===e?this._tableId:(this._tableId=e,this)},getValue:function(){return this._dataset.getFieldValue(this._field,this._valueIndex)},getText:function(e){return this._dataset.getFieldText(this._field,e,this._valueIndex)},getFieldError:function(){return this._dataset.getFieldError(this._field,this._valueIndex)},renderInvalid:function(e){var t=this;t._field&&(e?(jQuery(t.el).parent().addClass("has-error"),t.el.title=e.message||""):(jQuery(t.el).parent().removeClass("has-error"),t.el.title=""))},canFocus:function(){return!0},focus:function(){var t=this;if(t.canFocus()){if(t._isDBControl){var i=t._dataset.getField(t._field),l=!i||i.disabled()||i.readOnly()||!i.visible();if(l)return;t._tableId&&e("#"+t._tableId).gotoField(t._field)}return this.innerFocus(),this}},innerFocus:function(){var e=this,i=e.el;if(i.focus)try{return i.focus(),void(e.selectText&&e.autoSelectAll&&e.autoSelectAll()&&e.selectText())}catch(l){console.warn(t.Dataset.cannotFocusControl)}},destroy:function($super){$super(),this._field=null}}),e.ui._evalParams=function(i){if(e.Checker.test("evalParams#ctrlParams",i).required(),e.isString(i)){var l=jQuery.trim(i);!l.startsWith("{")&&l.indexOf(":")>0&&(l="{"+l+"}");try{return i=new Function("return "+unescape(l))(),i["var"]&&(i=i["var"]),i}catch(n){throw new Error(e.formatMessage(t.DBControl.invalidJsletProp,[i]))}}return i},e.ui.controls={},e.ui.register=function(t,i){e.Checker.test("jslet.ui.register#ctrlName",t).required().isString(),e.Checker.test("jslet.ui.register#ctrlType",i).required(),e.ui.controls[t.toLowerCase()]=i},e.ui.createControl=function(t,i,l,n,a){e.Checker.test("jslet.ui.createControl#jsletparam",t).required();var r=document.createElement("div"),s=e.ui._evalParams(t),o=s.type;o||(o=e.ui.controls.DBTEXT);var d=e.ui.controls[o.toLowerCase()];if(!d)throw new Error("NOT found control type: "+o);r.innerHTML=d.htmlTemplate;var u=r.firstChild;return r.removeChild(u),a&&(u.style.display="none"),i?i.appendChild(u):document.body.appendChild(u),l&&(parseInt(l)==l&&(l+="px"),u.style.width=l),n&&(parseInt(n)==n&&(n+="px"),u.style.height=n),new d(u,s)},e.ui.getControlClass=function(t){return e.Checker.test("jslet.ui.getControlClass#name",t).required().isString(),e.ui.controls[t.toLowerCase()]},e.ui.bindControl=function(t,i,l){if(l||e.Checker.test("jslet.ui.bindControl#el",t).required().isHTMLElement(),i||(i=jQuery(t).attr("data-jslet")),t.jslet)return console.warn("Control has installed! Don't install it again!"),null;l||e.Checker.test("jslet.ui.bindControl#jsletParam",i).required();var n=e.ui._evalParams(i),a=n.type;if(!a)return t.jslet=n,null;var r=e.ui.controls[a.toLowerCase()];if(!r)throw new Error("NOT found control type: "+a);return new r(t,n)},e.ui.unbindControl=function(t,i){i||e.Checker.test("jslet.ui.unbindControl#el",t).required().isHTMLElement(),t.jslet&&t.jslet.destroy&&t.jslet.destroy(),t.jslet=null},e.ui.rebindControl=function(t){e.Checker.test("jslet.ui.rebindControl#el",t).required().isHTMLElement(),e.ui.unbindControl(t),e.ui.bindControl(t)},e.ui.install=function(i,l){if(i&&void 0===l&&jQuery.isFunction(i)&&(l=i,i=null),!i&&t.isRtl){var n=jQuery(document.body);n.hasClass("jl-rtl")||n.addClass("jl-rtl")}var a;i?e.Checker.test("jslet.ui.install#pElement",i).isHTMLElement():i=document.body,a=jQuery(i).find("*[data-jslet]");var r,s,o=a.length,d=e.existIds;d||(d={},e.existIds=d);for(var u=0;o>u;u++)r=a[u],s=r.id,s&&(d[s]?console.warn(e.formatMessage(t.Control.duplicatedId,[s])):d[s]=1),e.ui.bindControl(r,void 0,!0);l&&l(),e.global.afterInstall&&e.global.afterInstall(i)},e.ui.uninstall=function(t){var i;t?(e.Checker.test("jslet.ui.install#pElement",t).isHTMLElement(),i=jQuery(t).find("*[data-jslet]")):i=jQuery("*[data-jslet]");for(var l,n=0,a=i.length;a>n;n++)l=i[n],l.jslet&&l.jslet.destroy&&l.jslet.destroy(),l.jslet=null;e.ui.menuManager&&jQuery(document).off("mousedown",e.ui.menuManager.hideAll)},e.ui.DnD=function(){var e,t,i,l,n,a,r,s=2,o=!1,d=!0,u=this;this._docMouseDown=function(s){s=jQuery.event.fix(s||window.event),d=!0,n=0,a=0,e=s.pageX,t=s.pageY,o=!1,r&&r._doMouseDown&&r._doMouseDown(e,t,i,l,n,a)},this._docMouseMove=function(u){if(d){if(u=jQuery.event.fix(u||window.event),i=u.pageX,l=u.pageY,!o&&(Math.abs(n)>s||Math.abs(a)>s))return o=!0,e=i,t=l,void(r&&r._doDragStart&&r._doDragStart(e,t));n=i-e,a=l-t,o?r&&r._doDragging&&r._doDragging(e,t,i,l,n,a):(r&&r._doMouseMove&&r._doMouseMove(e,t,i,l,n,a),e=i,t=l)}},this._docMouseUp=function(s){d=!1,o?(o=!1,r&&r._doDragEnd&&r._doDragEnd(e,t,i,l,n,a)):r&&r._doMouseUp&&r._doMouseUp(e,t,i,l,n,a),u.unbindControl()},this._docKeydown=function(e){e=jQuery.event.fix(e||window.event),27==e.which&&o&&(o=!1,r&&r._doDragCancel&&(r._doDragCancel(),u.unbindControl()))},this._docSelectStart=function(e){return e=jQuery.event.fix(e||window.event),e.preventDefault(),!1},this.bindControl=function(e){r=e;var t=jQuery(document);t.on("mousedown",this._docMouseDown),t.on("mouseup",this._docMouseUp),t.on("mousemove",this._docMouseMove),t.on("selectstart",this._docSelectStart),t.on("keydown",this._docKeydown)},this.unbindControl=function(){var e=jQuery(document);e.off("mousedown",this._docMouseDown),e.off("mouseup",this._docMouseUp),e.off("mousemove",this._docMouseMove),e.off("selectstart",this._docSelectStart),e.off("keydown",this._docKeydown),r=null}},e.ui.dnd=new e.ui.DnD,e.ui.EditMask=function(){this._mask=null,this._keepChar=!0,this._transform=null,this._literalChars=null,this._parsedMask=null,this._format=null,this._target=null,this._buffer=null},e.ui.EditMask.prototype={maskChars:{"#":{regexpr:new RegExp("[0-9\\-]"),required:!1},0:{regexpr:new RegExp("[0-9]"),required:!0},9:{regexpr:new RegExp("[0-9]"),required:!1},L:{regexpr:new RegExp("[A-Za-z]"),required:!0},l:{regexpr:new RegExp("[A-Za-z]"),required:!1},A:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!0},a:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!1},C:{regexpr:null,required:!0},c:{regexpr:null,required:!1}},transforms:["upper","lower"],setMask:function(t,i,l){if(t=jQuery.trim(t),e.Checker.test("EditMask#mask",t).isString(),this._mask=t,this._keepChar=!!i,this._transform=null,l){var n=e.Checker.test("EditMask#transform",l).isString();l=jQuery.trim(l),l=l.toLowerCase(),n.inArray(this.transforms),this._transform=l}this._parseMask()},attach:function(t){e.Checker.test("EditMask.attach#target",t).required();var i=this,l=jQuery(t);i._target=t,l.on("keypress.editmask",function(e){if(this.readOnly||!i._mask)return!0;var t=e.which;return 0===t?!0:i._doKeypress(t)?!0:void e.preventDefault()}),l.on("keydown.editmask",function(e){return this.readOnly||!i._mask?!0:i._doKeydown(e.which)?!0:void e.preventDefault()}),l.on("blur.editmask",function(e){return this.readOnly||!i._mask?!0:i._doBur()?!0:(e.preventDefault(),void e.currentTarget.focus())}),l.on("cut.editmask",function(e){return this.readOnly||!i._mask?!0:(i._doCut(e.originalEvent.clipboardData||window.clipboardData),e.preventDefault(),!1)}),l.on("paste.editmask",function(e){return this.readOnly||!i._mask?!0:void(i._doPaste(e.originalEvent.clipboardData||window.clipboardData)||e.preventDefault())})},detach:function(){var e=jQuery(this._target);e.off("keypress.editmask"),e.off("keydown.editmask"),e.off("blur.editmask"),e.off("cut.editmask"),e.off("paste.editmask"),this._target=null},setValue:function(t){if(e.Checker.test("EditMask.setValue#value",t).isString(),t=jQuery.trim(t),t=t?t:"",!this._mask)return void(this._target.value=t);var i=this;i._clearBuffer(0);var l,n,a,r,s,o,d=0,u=0,c=0;for(i._parsedMask.length;;){if(o=i._getFixedCharAndPos(d),l=o.pos,r=o.ch,0>l&&(l=d),!r){n=0;var h,f=i._buffer.length;for(a=d;f>a&&(h=t.charAt(u+n),h);a++)i._buffer[a]=h,n++;break}for(c=t.indexOf(r,u),0>c&&(c=t.length),n=-1,a=c-1;a>=u;a--)s=t.charAt(a),i._buffer[n+l]=s,n--;u=c+1,d=l+1}i._showValue()},getValue:function(){var e=this._target.value;if(this._keepChar)return e;for(var t,i=[],l=0,n=e.length;n>l;l++)t=this._parsedMask[l],t.isMask&&i.push(e.charAt(l));return i.join("")},validateValue:function(){for(var e,t=this,i=t._parsedMask.length,l=0;i>l;l++)if(e=t._parsedMask[l],e.isMask&&t.maskChars[e.ch].required&&t._buffer[l]==t._format[l])return!1;return!0},_getFixedCharAndPos:function(e){var t=this;if(!t._literalChars||0===t._literalChars.length)return{pos:0,ch:null};e||(e=0);for(var i,l,n=e,a=t._parsedMask.length;a>n;n++)if(l=t._parsedMask[n],!l.isMask&&(i=l.ch,t._literalChars.indexOf(i)>=0))return{ch:i,pos:n};return{pos:-1,ch:null}},_parseMask:function(){var e=this;if(!e._mask)return void(e._parsedMask=null);e._parsedMask=[],e._format=[];for(var t,i,l=null,n=0,a=e._mask.length;a>n;n++)if(t=e._mask.charAt(n),"\\"!=t){if(i=!1,void 0===e.maskChars[t]?(l&&e._parsedMask.push({ch:l,isMask:i}),e._parsedMask.push({ch:t,isMask:i})):(i=!l,e._parsedMask.push({ch:t,isMask:i})),e._keepChar&&!i){e._literalChars||(e._literalChars=[]);for(var r=!0,s=0,o=e._literalChars.length;o>s;s++)if(e._literalChars[s]==t){r=!1;break}r&&e._literalChars.push(t)}l=null,e._format.push(i?"_":t)}else l=t;e._buffer=e._format.slice(0),e._target&&(e._target.value=e._format.join(""))},_validateChar:function(e,t){var i=this.maskChars[e],l=i.regexpr;return l?l.test(t):!0},_getValidPos:function(e,t){var i,l=this,n=l._parsedMask.length;if(e>=n)return n-1;if(t){for(i=e;i>=0;i--)if(l._parsedMask[i].isMask)return i;for(i=e;n>i;i++)if(l._parsedMask[i].isMask)return i}else{for(i=e;n>i;i++)if(l._parsedMask[i].isMask)return i;for(i=e;i>=0;i--)if(l._parsedMask[i].isMask)return i}return-1},_clearBuffer:function(e,t){if(this._buffer){t||(t=this._buffer.length-1);for(var i=e;t>=i;i++)this._buffer[i]=this._format[i]}},_packEmpty:function(e,t){var i,l,n=0,a=this;for(l=e;l>=0;l--)if(i=a._format[l],a._literalChars&&a._literalChars.indexOf(i)>=0){n=l;break}e=n;var r=[];for(l=e;t>l;l++)i=a._buffer[l],i!=a._format[l]&&r.push(i);var s=r.length-1;for(l=t-1;l>=e;l--)s>=0?(a._buffer[l]=r[s],s--):a._buffer[l]=a._format[l]},_updateBuffer:function(e,t){var i=e.begin,l=e.end,n=this;if(i=n._getValidPos(i),0>i)return-1;if(n._clearBuffer(i+1,l),!(n._literalChars&&n._literalChars.indexOf(t)>=0)){var a=n._parsedMask[i];return n._validateChar(a.ch,t)?(n._buffer[i]=t,i):-1}for(var r=i,s=n._parsedMask.length;s>r;r++)if(n._parsedMask[r].ch==t)return n._packEmpty(i,r),r},_moveCursor:function(t,i){t=this._getValidPos(t,i),t>=0&&e.ui.TextUtil.setCursorPos(this._target,t)},_showValue:function(){this._target.value=this._buffer.join("")},_doKeypress:function(t){if(13==t)return!0;var i=String.fromCharCode(t),l=this;"upper"==l._transform?i=i.toUpperCase():"lower"==l._transform&&(i=i.toLowerCase());var n=e.ui.TextUtil.getCursorPos(l._target),a=l._updateBuffer(n,i);return l._showValue(),a>=0?l._moveCursor(a+1):l._moveCursor(n.begin),!1},_doKeydown:function(t){var i=this,l=e.ui.TextUtil.getCursorPos(i._target),n=l.begin,a=l.end;if(229==t){var r=i._parsedMask.legnth>n;if(r){var s=i._parsedMask[n];if(r=s.isMask){var o=s.ch;r="c"==o||"C"==o}}r||window.setTimeout(function(){i._showValue(),i._moveCursor(n)},50)}return 13==t?!0:8==t?(n==a&&(n=i._getValidPos(--n,!0),a=n),i._clearBuffer(n,a),i._showValue(),i._moveCursor(n,!0),!1):27==t?!1:46==t?(i._clearBuffer(n,a-1),i._showValue(),i._moveCursor(n),!1):!0},_doBur:function(){for(var e,t,i=this,l=0,n=i._parsedMask.length;n>l;l++)if(e=i._parsedMask[l],e.isMask&&(t=e.ch,i.maskChars[t].required&&i._buffer[l]==i._format[l]))return!0;return!0},_doCut:function(t){var i=this,l=e.ui.TextUtil.getSelectedText(i._target),n=e.ui.TextUtil.getCursorPos(i._target),a=n.begin;return i._clearBuffer(a,n.end-1),i._showValue(),i._moveCursor(a,!0),t.setData("Text",l),!1},_doPaste:function(t){var i=t.getData("Text");if(!i)return!1;var l,n=e.ui.TextUtil.getCursorPos(this._target),a=0;n.end=n.begin;for(var r=0;r<i.length;r++)l=i.charAt(r),a=this._updateBuffer(n,l),n.begin=r,n.end=n.begin;return this._showValue(),a>=0&&this._moveCursor(a+1),!0}},e.ui.TextUtil={selectText:function(e,t,i){var l=e.value;if(l.length>0)if(t=void 0===t?0:t,i=void 0===i?l.length:i,e.setSelectionRange)e.setSelectionRange(t,i);else if(e.createTextRange){var n=e.createTextRange();n.moveStart("character",t),n.moveEnd("character",i-l.length),n.select()}},getSelectedText:function(e){if(e.setSelectionRange){var t=e.selectionStart,i=e.selectionEnd;return e.value.substring(t,i)}return document.selection&&document.selection.createRange?document.selection.createRange().text:void 0},getCursorPos:function(e){var t={begin:0,end:0};if(e.setSelectionRange)t.begin=e.selectionStart,t.end=e.selectionEnd;else if(document.selection&&document.selection.createRange){var i=document.selection.createRange();t.begin=0-i.duplicate().moveStart("character",-1e5),t.end=t.begin+i.text.length}return t},setCursorPos:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}}},e.ui.FocusManager=function(){this._onChangingFocus=null,this._focusKeyCode=null,this._containerIds=null,this._activeDataset=null,this._activeField=null,this._activeValueIndex=null,this._initialize()},e.ui.FocusManager.prototype={onChangingFocus:function(t){return void 0===t?this._onChangingFocus:(e.Checker.test("FocusManager.onChangingFocus",t).isFunction(),this._onChangingFocus=t,this)},focusKeyCode:function(t){return void 0===t?this._focusKeyCode:(e.Checker.test("FocusManager.focusKeyCode",t).isNumber(),this._focusKeyCode=t,this)},activeDataset:function(t){return void 0===t?this._activeDataset:(e.Checker.test("FocusManager.activeDataset",t).isString(),this._activeDataset=t,this)},activeField:function(t){return void 0===t?this._activeField:(e.Checker.test("FocusManager.activeField",t).isString(),this._activeField=t,this)},activeValueIndex:function(t){return void 0===t?this._activeValueIndex:(e.Checker.test("FocusManager.activeValueIndex",t).isNumber(),this._activeValueIndex=t,this)},pushContainer:function(t){e.Checker.test("FocusManager.pushContainer#containerId",t).required().isString(),null===this._containerIds&&(this._containerIds=[]),this._containerIds.push(t)},popContainer:function(t){e.Checker.test("FocusManager.pushContainer#containerId",t).required().isString(),this._containerIds[this._containerIds.length-1]==t&&this._containerIds.pop()},tabPrev:function(){jQuery.tabPrev(this._getContainer(),!0,jQuery.proxy(this._doChangingFocus,this))},tabNext:function(){jQuery.tabNext(this._getContainer(),!0,jQuery.proxy(this._doChangingFocus,this))},_getContainer:function(){var e,t=this;if(t._containerIds&&t._containerIds.length>0){var i=t._containerIds[t._containerIds.length-1];if(e=jQuery("#"+i),0===e.length)throw new Error("Not found container: "+i)}else e=jQuery(document);return e},_doChangingFocus:function(t,i){var l=this,n=e.data.getDataset(l._activeDataset),a=n&&n.mergedFocusedFields();if(l._onChangingFocus){var r=l._onChangingFocus(t,i,n,l._activeField,a,l._activeValueIndex);if(!r)return!1}if(!l._activeDataset&&!l._activeField)return!0;if(!n||!n.focusedFields())return!0;var s=a.indexOf(l._activeField);if(0>s)return!0;var o;if(i){if(0===s)return o=n.masterField(),o?(l._activeDataset=n.masterDataset(),l._activeField=o,l._doChangingFocus(t,i)):!0;n.focusEditControl(a[s-1])}else{if(s===a.length-1)return o=n.masterField(),o?(l._activeDataset=n.masterDataset(),l._activeField=o,l._doChangingFocus(t,i)):!0;n.focusEditControl(a[s+1])}return!1},_initialize:function(){function t(e){var t=e.tagName;if("TEXTAREA"==t||"A"==t||"BUTTON"==t)return!1;if("INPUT"==t){var i=e.type;if("button"==i||"image"==i||"reset"==i||"submit"==i||"url"==i||"file"==i)return!1}return!0}function i(i){var n=l._focusKeyCode||e.global.defaultFocusKeyCode||9,a=i.which;if(a===n||9===a){if(9!==a&&!t(i.target))return;return i.shiftKey?l.tabPrev():l.tabNext(),i.preventDefault(),i.stopImmediatePropagation(),!1}}var l=this;jQuery(document).keydown(i)}},e.ui.globalFocusManager=new e.ui.FocusManager,function(e){function t(t,i,n,a){i||(i=document);var r=jQuery(i).find(t);l(r);var s=e(":focus"),o=0,d=null;if(1===s.length){d=s[0];var u=r.index(s);u+1<r.length?o=u+1:n&&(o=0)}var c=!0;if(a&&d&&(c=a(d,!1)),c){var h=r.eq(o);return h.focus(),h[0]}return d}function i(t,i,n,a){i||(i=document);var r=jQuery(i).find(t);l(r);var s=e(":focus"),o=r.length-1,d=null;if(1===s.length){d=s[0];var u=r.index(s);u>0?o=u-1:n&&(o=r.length-1)}var c=!0;if(a&&d&&(c=a(d,!0)),c){var h=r.eq(o);return h.focus(),h[0]}return d}function l(e){if(e)for(var t,i,l,n=1,a=e.length;a>n;n++){t=e[n],l=0;for(var r=n-1;r>=0;r--)if(i=e[r],i.tabIndex<=t.tabIndex){l=r+1;break}n!==l&&(e.splice(n,1),e.splice(l,0,t))}}function n(t){function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var l,n,a,r=t.nodeName.toLowerCase(),s=!isNaN(e.attr(t,"tabindex"));return"area"===r?(l=t.parentNode,n=l.name,t.href&&n&&"map"===l.nodeName.toLowerCase()?(a=e("img[usemap=#"+n+"]")[0],!!a&&i(a)):!1):(/input|select|textarea/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}e.focusNext=function(e,i,l){t(":focusable",e,i,l)},e.focusPrev=function(e,t,l){return i(":focusable",e,t,l)},e.tabNext=function(e,i,l){return t(":tabbable",e,i,l)},e.tabPrev=function(e,t,l){return i(":tabbable",e,t,l)},e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,l){return!!e.data(t,l[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),l=isNaN(i);return(l||i>=0)&&n(t,!l)}})}(jQuery),e.MessageBus=function(){var t={};t[e.MessageBus.SIZECHANGED]=[];var i=[];this.sendMessage=function(e,l,n){if(t[e]){var a=i[e];a&&window.clearTimeout(a),a=setTimeout(function(){i[e]=null;for(var n,a=t[e],r=0,s=a.length;s>r;r++)n=a[r],n&&n.onReceiveMessage&&n.onReceiveMessage(e,l)},30),i[e]=a}},this.subscribe=function(e,i){if(!e||!i)throw new Error("MessageName and ctrlObj required!");var l=t[e];l||(l=[],t[e]=l),l.push(i)},this.unsubscribe=function(e,i){var l=t[e];if(l){var n=l.indexOf(i);n>=0&&l.splice(n,1)}}},e.MessageBus.SIZECHANGED="SIZECHANGED",e.messageBus=new e.MessageBus,jQuery(window).on("resize",function(){e.messageBus.sendMessage(e.MessageBus.SIZECHANGED,null,window)}),e.ui.ResizeEventBus=function(){function t(i,l){i||(i=document.body);var n=i.children;if(n)for(var a,r=0,s=n.length;s>r;r++)a=n[r],a.getAttribute(e.ui.ResizeEventBus.RESIZABLE)?l.push(a):a.children&&t(a,l)}this.resize=function(i){var l=[];t(i,l);var n,a;e.ui._activePopup&&e.ui._activePopup.hide();for(var r=0,s=l.length;s>r;r++)n=l[r],n&&(a=n.jslet,a&&a.checkSizeChanged&&a.checkSizeChanged())},this._bodyResize=e.debounce(this.resize,100),this.subscribe=function(t){if(!t||!t.el)throw new Error("ctrlObj required!");if(!t.checkSizeChanged||!jQuery.isFunction(t.checkSizeChanged))throw new Error('subscribe#ctrlObj must have a method named: "checkSizeChanged"!');jQuery(t.el).attr(e.ui.ResizeEventBus.RESIZABLE,!0);for(var i=t.el.parentNode;i&&!jQuery(i).attr(e.ui.ResizeEventBus.RESIZABLE);)i=i.parentNode},this.unsubscribe=function(t){if(!t||!t.el)throw new Error("ctrlObj required!");jQuery(t.el).removeAttr(e.ui.ResizeEventBus.RESIZABLE)}},e.ui.ResizeEventBus.RESIZABLE="data-jslet-resizable",e.ui.resizeEventBus=new e.ui.ResizeEventBus,jQuery(window).on("resize",function(){e.ui.resizeEventBus._bodyResize()}),e.ui.htmlclass={},e.ui.GlobalZIndex=100,e.ui.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,IME:229};for(var i=65;90>i;i++)e.ui.KeyCode[String.fromCharCode(i)]=i;return e.ui.getParentElement=function(e,t){t||(t=1);for(var i=!!e.parentElement,l=e,n=0;t>n;n++)if(l=i?l.parentElement:l.parentNode,!l)return null;return l},e.ui.findFirstParent=function(t,i,l){var n=t;return n?i?i(n)?n:l&&l(n.parentNode)?null:e.ui.findFirstParent(n.parentNode,i,l):n.parentNode:null},e.ui.findJsletParent=function(t){return e.ui.findFirstParent(t,function(e){return!!e.jslet})},e.ui.isChild=function(e,t){if(!e||!t)return!1;for(var i=t;i;){if(i==e)return!0;i=i.parentNode}return!1},e.ui.TextMeasurer=function(){function e(e){n!=e&&(t.innerHTML=e)}var t,i,l=document.body,n=null,a=function(){t||(t=document.createElement("div"),document.body.appendChild(t),t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.overflow="hidden"),l||(l=document.body)};this.setElement=function(e){l=e,l&&(a(),t.style.fontSize=l.style.fontSize,t.style.fontStyle=l.style.fontStyle,t.style.fontWeight=l.style.fontWeight,t.style.fontFamily=l.style.fontFamily,t.style.lineHeight=l.style.lineHeight,t.style.textTransform=l.style.textTransform,t.style.letterSpacing=l.style.letterSpacing)},this.setElementWidth=function(e){i=e,l&&(e?l.style.width=e:l.style.width="")},this.getSize=function(i){a(),e(i);var l=jQuery(t);return{width:l.width(),height:l.height()}},this.getWidth=function(e){return this.getSize(e).width},this.getHeight=function(e){return this.getSize(e).height}},e.ui.textMeasurer=new e.ui.TextMeasurer,e.ui.getCssValue=function(e,t){var i=document.createElement("div");i.className=e,i.style.display="none",document.body.appendChild(i);var l=jQuery(i).css(t);return document.body.removeChild(i),l},e.ui.setEditableStyle=function(e,t,i,l,n){l||(e.disabled=t,e.readOnly=i);var a=jQuery(e);t||i?a.hasClass("jl-readonly")||(a.addClass("jl-readonly"),a.removeClass("jl-ctrl-required")):(a.removeClass("jl-readonly"),n&&a.addClass("jl-ctrl-required"))},e.ui.scrollbarSize=function(){var e,t,i;return void 0===i&&(e=jQuery('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),i=t.innerWidth()-t.height(99).innerWidth(),e.remove()),i},function(e){e.fn.getStyleObject=function(){var e,t,i=this.get(0),l={};if(window.getComputedStyle){var n=function(e,t){return t.toUpperCase()};e=window.getComputedStyle(i,null);for(var a=0;a<e.length;a++){t=e[a];var r=t.replace(/\-([a-z])/g,n),s=e.getPropertyValue(t);l[r]=s}return l}if(i.currentStyle){e=i.currentStyle;for(t in e)l[t]=e[t];return l}return this.css()}}(jQuery),e.Clipboard=function(){var e=window.document,t=e.getElementById("jsletClipboard");t||(jQuery('<textarea id="jsletClipboard" style="position:absolute;top:-1000px" tabindex="-1"></textarea>').appendTo(e.body),window.addEventListener("copy",function(e){var t=jQuery("#jsletClipboard").val();return t?(e.clipboardData?e.clipboardData.setData("text/plain",t):window.clipboardData.setData("text",t),jQuery("#jsletClipboard").val(null),e.preventDefault(),!1):void 0}))},e.Clipboard.putText=function(e){var t=jQuery("#jsletClipboard").val(e);t[0].select()},e.Clipboard(),e.ui.Accordion=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,selectedIndex,onChanged,items",i._selectedIndex=0,i._onChanged=null,i._items=null,$super(e,t)},selectedIndex:function(t){return void 0===t?this._selectedIndex:(e.Checker.test("Accordion.selectedIndex",t).isGTEZero(),this._selectedIndex=t,this)},onChanged:function(t){return void 0===t?this._onChanged:(e.Checker.test("Accordion.onChanged",t).isFunction(),this._onChanged=t,this)},items:function(t){if(void 0===t)return this._items;e.Checker.test("Accordion.items",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("Accordion.items.caption",i.caption).isString().required();return this._items=t,this},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-accordion")||t.addClass("jl-accordion jl-border-box jl-round5");var i,l=t.find(">div"),n=0,a=e._items?e._items.length-1:-1;l.before(function(t){return i=a>=t?e._items[t].caption:"caption"+t,'<button class="btn btn-default jl-accordion-head btn-sm" jsletindex = "'+t+'">'+i+"</button>"});var r=t.find(">.jl-accordion-head");r.click(e._doCaptionClick),n=r.outerHeight()*l.length;var s=t.innerHeight()-n-1;l.wrap('<div class="jl-accordion-body" style="height:'+s+'px;display:none"></div>');var o=e._selectedIndex;o>0&&(e._selectedIndex=0),e.setSelectedIndex(o,!0)},_doCaptionClick:function(t){var i=jQuery(t.currentTarget),l=e.ui.findJsletParent(i[0]).jslet,n=parseInt(i.attr("jsletindex"));l.setSelectedIndex(n)},setSelectedIndex:function(e,t){e||(e=0);var i=this,l=jQuery(i.el).find(">.jl-accordion-body"),n=l.length-1;if(!(e>n)){if(i._selectedIndex==e&&n>e)return jQuery(l[e]).hide(),(!t||t&&e>0)&&e++,jQuery(l[e]).show(),i._selectedIndex=e,void(i._onChanged&&i._onChanged.call(this,e));i._selectedIndex>=0&&i._selectedIndex!=e&&jQuery(l[i._selectedIndex]).hide(),jQuery(l[e]).show(),i._selectedIndex=e,i._onChanged&&i._onChanged.call(this,e)}},destroy:function($super){var e=jQuery(this.el);e.find(">.jl-accordion-head").off(),$super()}}),e.ui.register("Accordion",e.ui.Accordion),e.ui.Accordion.htmlTemplate="<div></div>",e.ui.Desktop=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.allProperties="header,onLoadMenu,menuType,menuWidth",i.requiredProperties="onLoadMenu",i._header=null,i._onLoadMenu=null,i._menuType="side",i._menuWidth=160,i._expanded=!0,$super(e,t)},header:function(e){return void 0===e?this._header:(this._header=e,this)},onLoadMenu:function(t){return e.Checker.test("DeskTop.onLoadMenu",t).required(),this._onLoadMenu=t,this},menuType:function(t){return void 0===t?this._menuType:(e.Checker.test("Desktop.menuType",t).inArray(["side","top","tree"]),this._menuType=t,this)},menuWidth:function(e){return void 0===e?this._menuWidth:(this._menuWidth=e,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=e.nextId());var t=jQuery(this.el);t.hasClass("jl-desktop")||t.addClass("jl-desktop"),this.renderAll(),e.desktop=this},renderAll:function(){var t,i=this,l=jQuery(this.el),n="top"===i._menuType;n?t='<div name="mainMenu" class="jl-dsk-menu-top"></div><div name="workbench" class="jl-dsk-bench-top"></div>':(i._expanded=!0,t='<div class="jl-dsk-menu-left" style="width: '+i._menuWidth+'px"><div class="jl-dsk-header"><span class="jl-dsk-headercontent">'+(i._header||"")+'</span><a class="jl-dsk-toggle" href="javascript:void(0)"><i class="fa fa-exchange"></i></a></div><div class="jl-dsk-menu" name="mainMenu"></div></div><div name="workbench" class="jl-dsk-bench-left" style="padding-left: '+i._menuWidth+'px"></div>'),l.html(t);var a=l.find('[name="mainMenu"]')[0],r=l.find('[name="workbench"]')[0],s={type:"TabControl",newable:!1,isFixedHeight:!0,styleClass:(i.styleClass()||"")+" jl-dsk-bench",enableLoading:!0,onContentLoading:i._doContentLoading,onContentLoaded:i._doContentLoaded,onRemoveTabItem:i._doRemoveTabItem};i._workbench=e.ui.bindControl(r,s);
var o={type:n?"MenuBar":"SideMenuBar",onItemClick:jQuery.proxy(i._openMenu,i)},d=null;if(i._onLoadMenu){var u=i._onLoadMenu();u.done?u.done(function(t){e.Checker.test("Desktop.MenuItems",t).isArray(),i._mainMenu.items(t),i._mainMenu.renderAll(),i._autoOpenMenu(t)}):(o.items=u,d=u)}i._mainMenu=e.ui.bindControl(a,o),d&&i._autoOpenMenu(d),n||l.find(".jl-dsk-toggle").off().on("click",function(){i._toggleMenu()})},_autoOpenMenu:function(e){if(e)for(var t,i=0,l=e.length;l>i;i++)t=e[i],t.items?this._autoOpenMenu(t.items):t.autoOpen&&this._openMenu(t)},_toggleMenu:function(){var e=this,t=jQuery(e.el);e._expanded=!e._expanded;var i=t.find(".jl-dsk-menu-left"),l=t.find(".jl-dsk-headercontent"),n=jQuery(e._workbench.el);e._expanded?(e._mainMenu.expand(),i.removeClass("jl-dsk-menu-left-collapsed"),l.show(),n.css("padding-left",e._menuWidth)):(e._mainMenu.collapse(),l.hide(),i.addClass("jl-dsk-menu-left-collapsed"),n.css("padding-left",40))},showTabPanel:function(e){this._workbench.setContentLoadedState(e)},setTabPanelChanged:function(e,t){this._workbench.setContentChangedState(e,t)},openMenuById:function(e){var t=this._getMenuCfg(this._mainMenu.items(),e,!0);this._openMenu(t)},openMenuByName:function(e){var t=this._getMenuCfg(this._mainMenu.items(),e);this._openMenu(t)},setContentChangedState:function(e,t){this._workbench.setContentChangedState(e,t)},setContentLoadedState:function(e){this._workbench.setContentLoadedState(e)},_getMenuCfg:function(e,t,i){for(var l,n=null,a=0,r=e.length;r>a;a++)if(l=e[a],l.items){if(n=this._getMenuCfg(l.items,t,i))return n}else if(i){if(l.id===t)return l}else if(l.name===t)return l;return null},_doContentLoading:function(e,t){if(t.debounce){jQuery("#"+e).hide();var i=this,l=window.setTimeout(function(){jQuery("#"+e).fadeIn("fast"),i.hideLoading(e),console.warn('Show tab panel after 5 minutes automatically. There must be the code "jslet.ui.desktopUtil.showTabPanel();" in the iframe page!'),window.clearTimeout(l)},5e3)}},_doContentLoaded:function(e,t){t.debounce&&jQuery("#"+e).fadeIn("fast")},_doRemoveTabItem:function(e,t){return!0},_openMenu:function(t){if(t){var i=jQuery.trim(t.url);if(i){var l=t.id;return i=e.urlUtil.addParam(i,{menuId:l}),void this._workbench.addTabItem({id:"if-"+l,header:t.name,url:i,closable:!0,userIFrame:!0,debounce:t.debounce,iconClass:t.iconClass})}return t.onclick?void t.onclick.call(t):void console.warn("Menu: "+t.name+' not exists properties: "url" or "onclick"！')}},destroy:function($super){var e=jQuery(this.el);e.find(".jl-dsk-toggle").off(),$super()}}),e.ui.register("Desktop",e.ui.Desktop),e.ui.Desktop.htmlTemplate="<div></div>",e.ui.DesktopUtil=function(){function t(){if(!a){var t=window.document.location.href;a=e.urlUtil.getParam(t,"jlTabItemId")}return a}function i(){if(null===s){var t=window.document.location.href;s=e.urlUtil.getParam(t,"debounce")}return!!s}function l(){var e=window.parent,t=null;if(e!==window)for(;;){if(!e)break;if(e.jslet&&e.jslet.desktop){t=e.jslet.desktop;break}if(e===e.parent)break;e=e.parent}return t||window.jslet&&(t=window.jslet.desktop),t}var n,a,r,s=null;this.showTabPanel=function(){var e=l();e&&e.showTabPanel(t())},this.registerEditableDataset=function(i){if(e.Checker.test("registerEditableDataset的参数必须为String",i).isString(),i){var a=i;e.isString(a)&&(a=i.split(",")),r={};for(var s=0,o=a.length;o>s;s++)r[a[s]]=!1;if(!n&&t()){n=window.setInterval(function(){var i,n,a,s=!1,o=!1;for(var d in r)if(i=e.data.getDataset(d),i&&(n=r[d],a=i.hasChangedData(!0),o=o||a,n!==a&&(s=!0,r[d]=a,o)))break;if(s){var u=l();if(!u)return;u.setContentChangedState(t(),o)}},500)}}else n||(window.clearInterval(n),n=null),r=null},this.openMenuById=function(e){var t=l();t&&t.openMenuById(e)},this.openMenuByName=function(e){var t=l();t&&t.openMenuByName(e)},this.setContentLoadedState=function(){if(i()){var e=l();e&&e.setContentLoadedState(t())}}},e.ui.desktopUtil=new e.ui.DesktopUtil,e.ui.FieldSet=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,caption,collapsed",i._caption=null,i._collapsed=!1,$super(e,t)},caption:function(t){return void 0===t?this._caption:(e.Checker.test("FieldSet.caption",t).isString(),this._caption=t,this)},collapsed:function(e){return void 0===e?this._collapsed:(this._collapsed=!!e,this)},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-fieldset")||t.addClass("jl-fieldset jl-round5");var i=['<legend class="jl-fieldset-legend">'];i.push('<span class="jl-fieldset-title"><i class="fa fa-chevron-circle-up jl-fieldset-btn">'),i.push("<span>"),i.push(e._caption),i.push('</span></span></legend><div class="jl-fieldset-body"></div>');var l,n,a=e.el.childNodes,r=[];for(n=a.length,l=0;n>l;l++)r.push(a[l]);t.html(i.join(""));var s=jQuery(e.el).find(".jl-fieldset-body")[0];for(n=r.length,l=0;n>l;l++)s.appendChild(r[l]);t.find(".jl-fieldset-btn").click(jQuery.proxy(e._doExpandBtnClick,this))},_doExpandBtnClick:function(){var e=this,t=jQuery(e.el),i=t.find(".jl-fieldset-body");e._collapsed?(i.slideDown(),t.removeClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").removeClass("fa-chevron-circle-down")):(i.slideUp(),t.addClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").addClass("fa-chevron-circle-down")),i[0].focus(),e._collapsed=!e._collapsed},destroy:function($super){var e=jQuery(this.el);e.find("input.jl-fieldset-btn").off(),$super()}}),e.ui.register("FieldSet",e.ui.FieldSet),e.ui.FieldSet.htmlTemplate="<fieldset></fieldset>",e.ui.menuManager={},e.ui.menuManager._menus=[],e.ui.menuManager.register=function(t){e.ui.menuManager._menus.push(t)},e.ui.menuManager.unregister=function(t){for(var i=0,l=this._menus.length;l>i;i++)e.ui.menuManager._menus.splice(i,1)},e.ui.menuManager.hideAll=function(t){for(var i,l,n=e.ui.menuManager._menus,a=0,r=n.length;r>a;a++)i=n[a],l=e("#"+i),l&&l.hide();e.ui.menuManager.menuBarShown=!1,e.ui.menuManager._contextObject=null},jQuery(document).on("mousedown",e.ui.menuManager.hideAll),e.ui.MenuBar=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,onItemClick,items",i._onItemClick=null,i._items=null,$super(e,t)},onItemClick:function(t){return void 0===t?this._onItemClick:(e.Checker.test("MenuBar.onItemClick",t).isFunction(),this._onItemClick=t,this)},items:function(t){if(void 0===t)return this._items;if(!t)return this._items=null,this;e.Checker.test("MenuBar.items",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("MenuBar.items.name",i.name).isString().required();return this._items=t,this},bind:function(){var t=this,i=jQuery(t.el);i.hasClass("jl-menubar")||i.addClass("jl-menubar jl-unselectable jl-round5"),this.renderAll(),i.on("mouseout",function(i){t._preHoverItem&&!e.ui.menuManager.menuBarShown&&jQuery(t._preHoverItem).removeClass("jl-menubar-item-hover")})},renderAll:function(){var e=this,t=jQuery(e.el);t.find(".jl-menubar-item").off(),this._createMenuBar()},setDisabled:function(t,i){var l=new e.ui.Menu.Operator(this);l.setDisabled(t,i)},setChecked:function(t,i){var l=new e.ui.Menu.Operator(this);l.setChecked(t,i)},_createMenuBar:function(){var e=this;if(!e.isPopup&&e._items)for(var t,i=0,l=e._items.length;l>i;i++)t=e._items[i],e._createBarItem(e.el,t,e._menubarclick)},_showSubMenu:function(i){var l=i.parentNode.jslet,n=i.jsletvar;if(n.items){if(!n.subMenu){var a=document.createElement("div");document.body.appendChild(a),n.subMenu=new e.ui.Menu(a,{onItemClick:l._onItemClick,items:n.items})}var r=jQuery(document.body),s=(parseInt(r.css("margin-top")),parseInt(r.css("margin-left")),jQuery(i)),o=s.offset(),d=o.left;t.isRtl&&(d+=s.width()+10),n.subMenu.show(d,o.top+s.height()),e.ui.menuManager.menuBarShown=!0,l._activeMenuItem=i}},_createBarItem:function(t,i){if(void 0===i.visible||i.visible){var l=document.createElement("div");jQuery(l).addClass("jl-menubar-item"),l.jsletvar=i;var n=this,a=jQuery(l);a.on("click",function(t){var i=this.jsletvar;i.items?n._showSubMenu(this):(e.ui.menuManager.hideAll(),i.onClick?i.onClick.call(n,i):n._onItemClick&&n._onItemClick.call(n,i)),t.stopPropagation(),t.preventDefault()}),a.on("mouseover",function(t){n._preHoverItem&&jQuery(n._preHoverItem).removeClass("jl-menubar-item-hover"),n._preHoverItem=this,jQuery(this).addClass("jl-menubar-item-hover"),e.ui.menuManager.menuBarShown&&(e.ui.menuManager.hideAll(),n._showSubMenu(this),e.ui.menuManager._inPopupMenu=!0)});var r=[];r.push('<a class="jl-focusable-item" href="javascript:void(0)">'),r.push(i.name),r.push("</a>"),l.innerHTML=r.join(""),t.appendChild(l)}},destroy:function($super){var e=this;e._activeMenuItem=null,e._preHoverItem=null,e._menubarclick=null,e._onItemClick=null;var t=jQuery(e.el);t.off(),t.find(".jl-menubar-item").off(),t.find(".jl-menubar-item").each(function(){var e=this;e.jsletvar&&(e.jsletvar.subMenu=null,e.jsletvar=null)}),$super()}}),e.ui.register("MenuBar",e.ui.MenuBar),e.ui.MenuBar.htmlTemplate="<div></div>",e.ui.Menu=e.Class.create(e.ui.Control,{_onItemClick:void 0,_items:void 0,_invoker:null,initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="onItemClick,items,invoker",$super(e,t),i._activeSubMenu=null},onItemClick:function(t){return void 0===t?this._onItemClick:(e.Checker.test("Menu.onItemClick",t).isFunction(),this._onItemClick=t,this)},items:function(t){if(void 0===t)return this._items;e.Checker.test("Menu.items",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("Menu.items.name",i.name).isString().required();return this._items=t,this},invoker:function(e){return void 0===e?this._invoker:void(this._invoker=e)},bind:function(){this.renderAll()},renderAll:function(){var t=this,i=jQuery(t.el),l=t.el;i.hasClass("jl-menu")||i.addClass("jl-menu"),l.style.display="none",l.id||(l.id=e.nextId()),e.ui.menuManager.register(l.id),t._createMenuPopup(),i.on("mousedown",function(e){return e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault(),!1}),i.on("mouseover",function(t){e.ui.menuManager._inPopupMenu=!0,e.ui.menuManager.timerId&&window.clearTimeout(e.ui.menuManager.timerId)}),i.on("mouseout",function(t){e.ui.menuManager._inPopupMenu=!1,e.ui.menuManager.timerId=window.setTimeout(function(){e.ui.menuManager._inPopupMenu||e.ui.menuManager.hideAll(),e.ui.menuManager.timerId=null},800)})},setDisabled:function(t,i){var l=new e.ui.Menu.Operator(this);l.setDisabled(t,i)},setChecked:function(t,i){var l=new e.ui.Menu.Operator(this);l.setChecked(t,i)},show:function(e,i){var l=this,n=jQuery(l.el),a=n.outerWidth(),r=n.outerHeight(),s=jQuery(window),o=s.scrollLeft()+s.width(),d=s.scrollTop()+s.height();e=e||l.left||10,i=i||l.top||10,t.isRtl&&(e-=a),e+a>o&&(e+=o-e-a-1),i+r>d&&(i+=d-i-r-1),0>e&&(e=0),0>i&&(i=0),l.el.style.left=e+"px",l.el.style.top=parseInt(i)+"px",l.el.style.display="block"},showAt:function(e){var t=jQuery(e);if(0===t.length)throw new Error("Host control NOT found When showing menu, check it first!");var i=t.offset();this.show(i.left,i.top+t.outerHeight())},hide:function(){this.ctxElement=null,this.el.style.display="none"},showContextMenu:function(t,i){e.ui.menuManager.hideAll(),t=jQuery.event.fix(t||window.event),e.ui.menuManager._contextObject=i,this.show(t.pageX,t.pageY),t.preventDefault()},_createMenuPopup:function(){var e,t,i,l,n=this.el,a=this._items;for(l=a.length,i=0;l>i;i++)e=a[i],e.name&&(t=e.name.trim(),"-"!=t?this._createMenuItem(n,e):this._createLine(n,e));document.body.appendChild(n)},_ItemClick:function(t,i){if(i.items)return void this._showSubMenu(t,i);if(!i.disabled){e.ui.menuManager.hideAll(),"check"!=i.itemType&&"radio"!=i.itemType||this.setChecked(t.id,!i.checked);var l=e.ui.menuManager._contextObject||this;i.onClick?i.onClick.call(l,i):this._onItemClick&&this._onItemClick.call(l,i)}},_hideSubMenu:function(){var e=this;e._activeSubMenu&&(e._activeSubMenu._hideSubMenu(),e._activeSubMenu.hide(),e._activeSubMenu.el.style.zIndex=parseInt(jQuery(e.el).css("zIndex")))},_showSubMenu:function(e,i,l){var n=this,a=function(){if(n._hideSubMenu(),i.subMenu){var l=jQuery(e),a=l.offset(),r=a.left;t.isRtl||(r+=l.width()),i.subMenu.show(r-2,a.top),i.subMenu.el.style.zIndex=parseInt(jQuery(n.el).css("zIndex"))+1,n._activeSubMenu=i.subMenu}};l?window.setTimeout(a,l):a()},_ItemOver:function(e,t){this._activeSubMenu&&this._showSubMenu(e,t,200)},_createMenuItem:function(t,i,l){var n=!1,a=!1,r=i.itemType;r&&(n="check"==r,a="radio"==r),n&&(i.iconClass="fa fa-check"),a&&(i.iconClass="fa fa-circle"),i.items&&(i.disabled=!1);var s=document.createElement("div"),o=this,d=jQuery(s);d.addClass("jl-menu-item "+(i.disabled?"jl-menu-disabled":"")),i.id||(i.id=e.nextId()),s.id=i.id,s.jsletvar=i,d.on("click",function(e){o._ItemClick(this,this.jsletvar),e.stopPropagation(),e.preventDefault()}),d.on("mouseover",function(e){o._ItemOver(this,this.jsletvar),o._preHoverItem&&jQuery(o._preHoverItem).removeClass("jl-menu-item-hover"),o._preHoverItem=this,this.jsletvar.disabled||jQuery(this).addClass("jl-menu-item-hover")}),d.on("mouseout",function(e){this.jsletvar.subMenu||jQuery(this).removeClass("jl-menu-item-hover")});var u=[];if(u.push('<span class="jl-menu-icon-placeholder '),(!n&&!a||i.checked)&&i.iconClass&&u.push(i.disabled&&i.disabledIconClass?i.disabledIconClass:i.iconClass),u.push('"></span>'),i.items&&u.push('<div class="jl-menu-arrow"><i class="fa fa-caret-right" aria-hidden="true"></i></div>'),u.push('<a  href="javascript:void(0)" class="jl-focusable-item jl-menu-content '),u.push(" jl-menu-content-left jl-menu-content-right"),u.push('">'),u.push(i.name+"&nbsp;&nbsp;&nbsp;&nbsp;"),u.push("</a>"),s.innerHTML=u.join(""),t.appendChild(s),i.items){var c=document.createElement("div");document.body.appendChild(c),i.subMenu=new e.ui.Menu(c,{onItemClick:o._onItemClick,items:i.items,invoker:s})}},_createLine:function(e,t){var i=document.createElement("div");jQuery(i).addClass("jl-menu-line"),e.appendChild(i)},destroy:function($super){var t=this,i=jQuery(t.el);t._activeSubMenu=null,e.ui.menuManager.unregister(t.el.id),i.off(),i.find(".jl-menu-item").each(function(){this.onmouseover=null,this.onclick=null,this.onmouseout=null}),$super()}}),e.ui.register("Menu",e.ui.Menu),e.ui.Menu.htmlTemplate="<div></div>",e.ui.Menu.Operator=function(e){this._menuObj=e},e.ui.Menu.Operator.prototype={getMenuItemById:function(t){function i(e,t){for(var l,n=0,a=e.length;a>n;n++){if(l=e[n],l.id===t)return l;if(l.items&&(l=i(l.items,t)))return l}return null}e.Checker.test("getMenuItemById#id",t).required().isString();var l=this._menuObj.items();return l?i(l,t):null},getMenuGroup:function(t,i){function l(e,t){for(var n,a=0,r=e.length;r>a;a++){if(n=e[a],n.id===t&&"radio"===n.itemType){for(var s,o=n.group,d=[],u=0,c=e.length;c>u;u++)s=e[u],i&&s.id===t||"radio"===s.itemType&&s.group===o&&d.push(s);return d}if(n.items){var h=l(n.items,t);if(h)return h}}return null}e.Checker.test("getMenuGroup#id",t).required().isString();var n=this._menuObj.items();return n?l(n,t):null},setDisabled:function(e,t){var i=this.getMenuItemById(e);if(i.disabled=!!t,!i.items){var l=jQuery("#"+e);0!==l.length&&(t?(l.removeClass("jl-menu-enabled"),l.addClass("jl-menu-disabled")):(l.removeClass("jl-menu-disabled"),l.addClass("jl-menu-enabled")))}},setChecked:function(e,t){var i=this.getMenuItemById(e),l=i.itemType;if(t="radio"===l?!0:t,!(i.disabled||"check"!=l&&"radio"!=l||i.checked==t)){i.checked=t;var n,a,r=[i];if("radio"==l){var s=this.getMenuGroup(e,!0);for(n=0,a=s.length;a>n;n++)if(i=s[n],i.checked){i.checked=!1,r.push(i);break}}var o;for(n=0,a=r.length;a>n;n++)i=r[n],o=jQuery("#"+i.id).find(".jl-menu-icon-placeholder"),i.checked?o.addClass(i.iconClass):o.removeClass(i.iconClass)}}},e.ui.Portal=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.allProperties="parts,partChanged",i.requiredProperties="",i._parts=null,i._partChanged=!1,$super(e,t)},parts:function(t){if(void 0===t)return this._parts;if(this.clearParts(),this._parts=t,t){e.Checker.test("Portal.parts",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("Portal.part.id",i.id).required().isString(),e.Checker.test("Portal.part.caption",i.caption).isString(),e.Checker.test("Portal.part.url",i.url).isString(),e.Checker.test("Portal.part.top",i.top).isNumber(),e.Checker.test("Portal.part.left",i.left).isNumber(),e.Checker.test("Portal.part.width",i.width).isNumber(),e.Checker.test("Portal.part.height",i.height).isNumber();this.binded&&this.loadParts()}return this},partChanged:function(){return!!this._partChanged},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=e.nextId());var t=jQuery(this.el);t.hasClass("jl-portal")||t.addClass("jl-portal"),this.renderAll()},renderAll:function(){this.clearParts(),this.loadParts()},addPart:function(e){if(!e)return this;var t=this;return t._parts||(t._parts=[]),t._parts.push(e),t._createPart(e),t._partChanged=!0,this},removePart:function(t){if(!t)return this;for(var i,l=this,n=0,a=l._parts.length;a>n;n++)if(i=l._parts[n],i.id==t&&i.elId)return e("#"+i.elId).close(),l._parts.splice(n,1),l._partChanged=!0,this;return this},loadParts:function(){var e=this,t=e._parts;if(!t)return this;for(var i=0,l=t.length;l>i;i++)e._createPart(t[i]);return this._partChanged=!1,this},clearParts:function(){var t,i=this._parts;if(!i)return this;for(var l=0,n=i.length;n>l;l++)t=i[l],t.elId&&e("#"+elId).close();return this._parts=null,this._partChanged=!1,this},setPartCaption:function(t,i){e.Checker.test("setPartCaption.partId",t).required().isString(),e.Checker.test("setPartCaption.caption",i).isString();var l=this.getPartWindow(t);return l&&l.setCaption(i),this},setPartContent:function(t,i){e.Checker.test("setPartCaption.partId",t).required().isString();var l=this.getPartWindow(t);return l&&l.setContent(i),this},getPartWindow:function(t){var i,l=this._parts;if(!l)return null;for(var n=0,a=l.length;a>n;n++)if(i=l[n],i.id==t&&i.elId)return e("#"+i.elId);return null},_createPart:function(t){var i=this,l={type:"Window",animation:"none",iconClass:t.iconClass,caption:t.caption,isSmallHeader:!0,width:t.width,height:t.height,closable:t.closable,onMoving:function(e,t,l,n){return i._doMoving(this.el.id,e,t,l,n)},onPositionChanged:function(e,t){i._doPosChanged(this.el.id,e,t)},onSizeChanged:function(e,t){i._doSizeChanged(this.el.id,e,t)},onClosed:function(){i._doClosed(this.el.id)}},n=e.ui.createControl(l,i.el);t.url?n.setContent("<iframe src='"+t.url+"' style='width: 100%;height: calc(100% - 5px); border:none' />"):t.content&&n.setContent(t.content),n.show(t.left,t.top),t.elId=n.el.id},_doMoving:function(e,t,i,l,n){for(var a,r=this,s=r._parts,o=this._getPartCfgWithElId(e),d=t,u=i,c=t+o.width,h=i+o.height,f={},p=0,_=s.length;_>p;p++)if(a=s[p],o!==a){var v=a.left||0,m=a.top||0,g=v+a.width,C=m+a.height,b=10;if(0!==l&&(m>=u&&h>=m||C>=u&&h>=C)){var y=d-g,j=c-v;Math.abs(y)<b&&(f.deltaX=l-y),Math.abs(j)<b&&(f.deltaX=l-j)}if(0!==n&&(v>=d&&c>=v||g>=d&&c>=g)){var w=u-C,x=h-m;Math.abs(w)<b&&(f.deltaY=n-w),Math.abs(x)<b&&(f.deltaY=n-x)}}return this._partChanged=!0,f},_doPosChanged:function(e,t,i){var l=this._getPartCfgWithElId(e);l&&(l.left=t,l.top=i,this._partChanged=!0)},_doSizeChanged:function(e,t,i){var l=this._getPartCfgWithElId(e);l&&(l.width=t,l.height=i,this._partChanged=!0)},_doClosed:function(e){for(var t,i=0,l=this._parts.length;l>i;i++)if(t=this._parts[i],t.elId==e)return this._parts.splice(i,1),void(this._partChanged=!0)},_getPartCfgWithElId:function(e){var t=this,i=t._parts;if(!i)return null;for(var l,n=0,a=i.length;a>n;n++)if(l=i[n],l.elId===e)return l;return null},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),e.ui.register("Portal",e.ui.Portal),e.ui.Desktop.htmlTemplate="<div></div>",e.ui.SideMenuBar=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,hasSubTitle,onItemClick,items,popupWidth",i._hasSubTitle=!0,i._onItemClick=null,i._items=null,i._popupWidth=null,i._containerId=null,i._closeTimeout=null,i._showTimeout=null,i.oldHeight=0,$super(e,t)},hasSubTitle:function(e){return void 0===e?this._hasSubTitle:(this._hasSubTitle=!!e,this)},onItemClick:function(t){return void 0===t?this._onItemClick:(e.Checker.test("SideMenuBar.onItemClick",t).isFunction(),this._onItemClick=t,this)},items:function(t){if(void 0===t)return this._items;if(!t)return this._items=null,this;e.Checker.test("SideMenuBar.items",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("SideMenuBar.items.name",i.name).isString().required();return this._items=t,this},popupWidth:function(t){return void 0===t?this._popupWidth:(e.Checker.test("SideMenuBar.popupWidth",t).isGTEZero(),this._popupWidth=parseInt(t),this)},bind:function(){var t=this;e.ui.resizeEventBus.subscribe(t),t.el.id||(t.el.id=e.nextId());var i=jQuery(t.el);i.hasClass("jl-sidemenubar")||i.addClass("jl-sidemenubar jl-unselectable jl-round4"),i.on("mouseenter",".jl-smb-baritem",function(e){t._clearShowTimeout(),t._clearCloseTimeout();var i=e.currentTarget;t._showTimeout=window.setTimeout(function(){t._showSubMenu(i)},100)}),i.on("mouseleave",function(){t._doMouseLeave()});var l=t.el.id+"_panel";t._containerId=l;var n=document.getElementById(l);n||(n=document.createElement("div"),document.body.appendChild(n),n.id=l,n.className="jl-smb-popup",jQuery(n).on("mouseleave",function(){t._doMouseLeave()}).on("mouseenter",function(){t._doMouseEnter()}).on("click",".jl-smb-item",function(e){t._doMenuClick(e.currentTarget)})),this.renderAll()},renderAll:function(){var t=this,i=jQuery(t.el),l=jQuery("#"+t._containerId);i.find(".jl-smb-up").off(),i.find(".jl-smb-down").off(),l.html('<span class="jl-smb-box"></span>'),t._popupWidth&&l.css("width",t._popupWidth+"px"),t._itemHeight=parseFloat(e.ui.getCssValue("jl-smb-baritem","height"));var n="";n+='<div class="jl-smb-up"><a href="javascript:void(0)"><i class="fa fa-chevron-up"></i></a></div>',n+='<div class="jl-smb-items"><ul class="jl-smb-ul">';for(var a,r=t._items||[],s=0,o=r.length;o>s;s++)a=r[s],null!==a.id&&void 0!==a.id||(a.id=e.nextId()),a.items&&0!==a.items.length?(n+='<li><a class="jl-smb-baritem" id="'+a.id+'" href="javascript:void(0)">',n+='<i class="jl-smb-icon '+(a.iconClass||"jl-hidden")+'"></i>',n+="<span>"+a.name+'</span><i class="jl-smb-arrow fa fa-chevron-right"></i>',n+="</a></li>",t._createMenuItem(l,a.id,a.items)):console.warn("Menu item: "+a.name+" does not have items!");n+='<li class="jl-smb-lastbaritem"></li></ul></div>',n+='<div class="jl-smb-down"><a href="javascript:void(0)"><i class="fa fa-chevron-down"></i></a></div>',i.html(n),i.find(".jl-smb-up").on("click",function(){t._hideSubMenu(),i.find(".jl-smb-down").show();var e=i.find(".jl-smb-items"),l=e.scrollTop();l-=t._itemHeight,0>=l&&jQuery(this).hide(),e.scrollTop(l)}).on("mouseenter",function(){t._hideSubMenu()}),i.find(".jl-smb-down").on("click",function(){t._hideSubMenu(),i.find(".jl-smb-up").show();var e=i.find(".jl-smb-items"),l=e.scrollTop()+t._itemHeight,n=e[0].scrollHeight-e.innerHeight();l>n&&jQuery(this).hide(),e.scrollTop(l)}).on("mouseenter",function(){t._hideSubMenu()}),t.resize()},collapse:function(){var e=this,t=jQuery(e.el);t.find(".jl-smb-baritem > .jl-smb-arrow").hide(),t.find(".jl-smb-baritem > span").hide()},expand:function(){var e=this,t=jQuery(e.el);t.find(".jl-smb-baritem > .jl-smb-arrow").show(),t.find(".jl-smb-baritem > span").show()},_clearShowTimeout:function(){var e=this;e._showTimeout&&(window.clearTimeout(e._showTimeout),e._showTimeout=null)},_clearCloseTimeout:function(){var e=this;e._closeTimeout&&(window.clearTimeout(e._closeTimeout),e._closeTimeout=null)},_getItemById:function(e,t,i){for(var l,n=this,a=0,r=e.length;r>a;a++){if(l=e[a],l.id===t)return l;if(!i&&l.items&&(l=n._getItemById(l.items,t)))return l}return null},_createMenuItem:function(e,t,i){var l=this,n=l._innerCreateMenuItem(t,i,0);e.append(n)},_innerCreateMenuItem:function(t,i,l){function n(e,t){for(var i,l=0,a=e.length;a>l;l++)i=e[l],i.items?n(i.items,t):t.push(i)}for(var a,r,s,o,d=this,u=[],c=null,h=0,f=i.length-1;f>=h;h++)if(o=i[h],o.items)s=[],n(o.items,s),u.push({id:o.id||e.nextId(),name:o.name,items:s}),c=null;else{if(null===c&&(a=[],c={id:e.nextId(),items:a,isLine:!0},u.push(c)),r=jQuery.trim(o.name),"-"===r){c=null;continue}a.push(o)}for(var p='<ul id="'+t+'_popup" class="jl-smb-popup-ul '+(0===l?"jl-hidden":"")+'">',_=0,v=u.length-1;v>=_;_++){for(c=u[_],r=jQuery.trim(c.name),p+='<li class="jl-smb-group'+(v>_?" jl-smb-line":"")+'">',c.isLine||d._hasSubTitle&&r&&(p+='<div class="jl-smb-subtitle">'+r+"</div>"),p+='<ul id="'+c.id+'_popup" class="jl-smb-popup-ul">',a=c.items,h=0,f=a.length-1;f>=h;h++)o=a[h],t=o.id,t||0===t||(t=e.nextId(),o.id=t),r=jQuery.trim(o.name),p+="<li>",p+='<a id="'+t+'" class="jl-smb-item'+(o.disabled?" jl-smb-disabled":"")+'" href="javascript:void(0)">',p+='<span class="jl-smb-popup-icon '+(o.iconClass||"")+'"></span>'+r+"</a>",p+="</li>";p+="</ul>",p+="</li>"}return p+="</ul>"},_hideSubMenu:function(){this._clearShowTimeout(),jQuery("#"+this._containerId).hide()},_showSubMenu:function(e){var t=this,i=t._getItemById(t._items,e.id,!0);if(i.items){var l=(jQuery(t.el),jQuery("#"+t._containerId));l.children().each(function(e){var t=jQuery(this);if(!t.hasClass("jl-smb-box")){var l=t.hasClass("jl-hidden");this.id!==i.id+"_popup"?l||t.addClass("jl-hidden"):l&&t.removeClass("jl-hidden")}});var n=jQuery(e),a=n.offset(),r=a.left+n.width()+2,s=a.top,o=a.top+l.outerHeight()-jQuery(window).innerHeight()-document.body.scrollTop,d=l.find(".jl-smb-box");o>0?(s-=o,d.css("top",o+"px")):d.css("top","0"),l.show(),l.offset({left:r,top:s-1})}},_doMouseEnter:function(){var e=this;e._clearShowTimeout(),e._clearCloseTimeout()},_doMouseLeave:function(){var e=this;e._clearShowTimeout(),e._closeTimeout=window.setTimeout(function(){window.clearTimeout(e._closeTimeout),e._closeTimeout=null,e._hideSubMenu()},200)},_doMenuClick:function(e){var t=this,i=t._getItemById(t._items,e.id);i.disabled||(t._hideSubMenu(),i.onClick&&i.onClick(i),t._onItemClick&&t._onItemClick(i))},resize:function(){var e=this,t=jQuery(e.el),i=t.height();if(i!==e.oldHeight){e.oldHeight=i;var l=t.find(".jl-smb-items");l.height(i);var n=l.innerHeight();if(l[0].scrollHeight<=n)return t.find(".jl-smb-up").hide(),void t.find(".jl-smb-down").hide();l.scrollTop()>0&&t.find(".jl-smb-up").show(),t.find(".jl-smb-down").show();var a=Math.floor(n/e._itemHeight),r=n-a*e._itemHeight;t.find(".jl-smb-lastbaritem").css("height",r+"px")}},checkSizeChanged:function(){this.resize()},destroy:function($super){var t=this;e.ui.resizeEventBus.unsubscribe(t),t._clearShowTimeout(),t._activeMenuItem=null,t._preHoverItem=null,t._menubarclick=null,t._onItemClick=null;var i=jQuery(t.el);i.off(),jQuery("#"+t._containerId).off(),$super()}}),e.ui.register("SideMenuBar",e.ui.SideMenuBar),e.ui.SideMenuBar.htmlTemplate="<div></div>",e.ui.SplitPanel=e.Class.create(e.ui.Control,{directions:["hori","vert"],initialize:function($super,t,i){var l=this;l.el=t,l.allProperties="styleClass,direction,floatIndex,onExpanded,onResize",l._direction="hori",l._floatIndex=1,l._onExpanded=null,l._onResize=null,l.panels=null,l._oldSize=0,l._oldHeight=0,l._oldWidth=0,l._changeFloatSizeDebounce=e.debounce(l._changeFloatSize,110),$super(t,i)},floatIndex:function(t){return void 0===t?this._floatIndex:(e.Checker.test("SplitPanel.floatIndex",t).isGTEZero(),this._floatIndex=t,this)},direction:function(t){if(void 0===t)return this._direction;t=jQuery.trim(t);var i=e.Checker.test("SplitPanel.direction",t).required().isString();return t=t.toLowerCase(),i.inArray(this.directions),this._direction=t,this},onExpanded:function(t){return void 0===t?this._onExpanded:(e.Checker.test("SplitPanel.onExpanded",t).isFunction(),this._onExpanded=t,this)},onResize:function(t){return void 0===t?this._onResize:(e.Checker.test("SplitPanel.onResize",t).isFunction(),this._onResize=t,this)},bind:function(){var t=this,i=jQuery(t.el);i.hasClass("jl-splitpanel")||i.addClass("jl-splitpanel jl-border-box jl-round5"),this.renderAll(),e.ui.resizeEventBus.subscribe(t)},renderAll:function(){var t=this,i=jQuery(t.el);t._isHori="hori"==t._direction,t._splitterClsName=t._isHori?"jl-sp-splitter-hori":"jl-sp-splitter-vert",i.off(),i.on("mousedown","."+t._splitterClsName,t._splitterMouseDown),i.on("click",".jl-sp-button",function(e){var i=jQuery(e.currentTarget),l=i.parent(),n=parseInt(l.attr("jsletindex"));t.expand(n),e.stopPropagation()});var l=i.find(">div"),n=l.length-1;(!t._floatIndex&&0!==t._floatIndex||t._floatIndex>n)&&(t._floatIndex=n),t._floatIndex>n&&(t._floatIndex=n),t.panels||(t.panels=[]),l.each(function(e){var i=jQuery(l[e]),n=t.panels[e];n||(n={},t.panels[e]=n);var a=parseInt(i.css(t._isHori?"min-width":"min-height"));n.minSize=a?a:5;var r=parseInt(i.css(t._isHori?"max-width":"max-height"));n.maxSize=r?r:1/0,n.expanded="none"!=i.css("display");var s=n.size;null!==s&&void 0!==s&&(t._isHori?i.outerWidth(s-5):i.outerHeight(s-5))}),t.width=i.innerWidth(),t.height=i.innerHeight(),t._splitterTracker=document.createElement("div");var a=jQuery(t._splitterTracker);a.addClass("jl-sp-splitter-tracker");var r=0,s=t._isHori?"jl-sp-panel-hori":"jl-sp-panel-vert";t.el.appendChild(t._splitterTracker),t._isHori?t._splitterTracker.style.height="100%":t._splitterTracker.style.width="100%";var o=parseInt(e.ui.getCssValue(t._splitterClsName,t._isHori?"width":"height"));l.after(function(i){var a=l[i],d=jQuery(a),u=t.panels[i].expanded;if(t._isHori&&d.outerHeight(t.height),d.addClass(s),i===t._floatIndex?t.floatPanel=a:u?r+=o+t.panels[i].size:(d.css("display","none"),r+=o),i===n)return t._isHori?'<div style="clear:both;width:0px"></div>':"";var c=e.nextId(),h=t._isHori?"fa-caret-left":"fa-caret-up";return(t._floatIndex<=i||!u)&&(h+=t._isHori?" fa-caret-right":" fa-caret-down"),'<div class="'+t._splitterClsName+' jl-unselectable" id = "'+c+'" jsletindex="'+(i>=t._floatIndex?i+1:i)+'"><div class="jl-sp-button '+(t._isHori?"jl-sp-button-hori":"jl-sp-button-vert")+'"'+(u?"":' jsletcollapsed="1"')+'><i class="fa '+h+'" aria-hidden="true"></i></div></div>'});var d=i.find("."+t._splitterClsName);t._isHori&&d.outerHeight(t.height);for(var u,c=0,h=d.length;h>c;c++)u=d[c],u._doDragStart=t._splitterDragStart,u._doDragging=t._splitterDragging,u._doDragEnd=t._splitterDragEnd,u._doDragCancel=t._splitterDragCancel;t._changeFloatSize()},_changeFloatSize:function(e){var t=this,i=jQuery(t.el),l=i.find(">div"),n=0,a=2*t.panels.length;l.each(function(i){if(!(i>=a)){var l=jQuery(this);this===t.floatPanel||e!==this&&"none"==l.css("display")||(n+=t._isHori?l.outerWidth(!0):l.outerHeight(!0))}});var r,s=5,o=t.panels[t._floatIndex];o&&(s=o.minSize?o.minSize:5),t._isHori?(r=i.innerWidth()-n-6,s>r&&(r=s),jQuery(t.floatPanel).outerWidth(r)):(r=i.innerHeight()-n-6,s>r&&(r=s),jQuery(t.floatPanel).outerHeight(r))},expand:function(t,i,l){var n,a=this,r=jQuery(a.el),s=r.find("."+a._splitterClsName);if(!(0>t||t>s.length)){var o=jQuery(s[t>=a._floatIndex?t-1:t]),d=o.find(":first-child");void 0===i&&(i="1"==d.attr("jsletcollapsed")),n=t<a._floatIndex?o.prev():o.next();var u=d.find(":first-child");a._isHori?u.hasClass("fa-caret-right")?(u.removeClass("fa-caret-right"),u.addClass("fa-caret-left")):(u.removeClass("fa-caret-left"),u.addClass("fa-caret-right")):u.hasClass("fa-caret-down")?(u.removeClass("fa-caret-down"),u.addClass("fa-caret-up")):(u.removeClass("fa-caret-up"),u.addClass("fa-caret-down")),i?(a._changeFloatSize(n[0]),n.css("display","block"),d.attr("jsletcollapsed","0")):(n.css("display","none"),d.attr("jsletcollapsed","1"),a._changeFloatSize()),l||(a.panels[t].expanded=i,a._onExpanded&&a._onExpanded.call(a,t),e.ui.resizeEventBus.resize(a.el))}},_splitterMouseDown:function(t){var i=jQuery(this).position(),l=this.parentNode.jslet;l._splitterTracker.style.top=i.top+"px",l._splitterTracker.style.left=i.left+"px",l._draggingId=this.id;var n=jQuery("#"+l._draggingId),a=n.find(":first-child");return"1"==a.attr("jsletcollapsed")?void a.click():void e.ui.dnd.bindControl(this)},_splitterDragStart:function(e,t,i,l,n,a){
var r=this.parentNode.jslet,s=jQuery(r._splitterTracker),o=jQuery("#"+r._draggingId),d=parseInt(o.attr("jsletindex")),u=d<r._floatIndex?o.prev():o.next(),c=r.panels[d],h=jQuery(r.floatPanel),f=r._isHori?u.outerWidth(!0):u.outerHeight(!0);r._dragRangeMin=f-c.minSize,r._dragRangeMax=c.maxSize-f;var p=(r._isHori?h.outerWidth(!0):h.outerHeight(!0))-r.panels[r._floatIndex].minSize;r._dragRangeMax>p&&(r._dragRangeMax=p),s.show()},_splitterDragging:function(e,t,i,l,n,a){var r,s=this.parentNode.jslet,o=jQuery(s._splitterTracker),d=jQuery("#"+s._draggingId),u=parseInt(d.attr("jsletindex")),c=Math.abs(s._isHori?n:a);if(r=s._isHori?u<s._floatIndex&&n>=0||u>s._floatIndex&&0>n:u<s._floatIndex&&a>=0||u>s._floatIndex&&0>a,r&&c>s._dragRangeMax)return void(s.endDelta=s._dragRangeMax);if(!r&&c>s._dragRangeMin)return void(s.endDelta=s._dragRangeMin);s.endDelta=Math.abs(s._isHori?n:a);var h=o.offset();s._isHori?h.left=i:h.top=l,o.offset(h)},_splitterDragEnd:function(t,i,l,n,a,r){var s,o=this.parentNode.jslet,d=jQuery(o._splitterTracker),u=jQuery("#"+o._draggingId),c=parseInt(u.attr("jsletindex")),h=c<o._floatIndex?u.prev():u.next(),f=jQuery(o.floatPanel);s=o._isHori?c<o._floatIndex&&a>=0||c>o._floatIndex&&0>a:c<o._floatIndex&&r>=0||c>o._floatIndex&&0>r;var p=o.endDelta*(s?1:-1);o._isHori?0>p?(h.outerWidth(h.outerWidth()+p),f.outerWidth(f.outerWidth()-p)):(f.outerWidth(f.outerWidth()-p),h.outerWidth(h.outerWidth()+p)):0>p?(h.outerHeight(h.outerHeight()+p),f.outerHeight(f.outerHeight()-p)):(f.outerHeight(f.outerHeight()-p),h.outerHeight(h.outerHeight()+p)),o._onResize&&o._onResize.call(o,h[0]),e.ui.resizeEventBus.resize(o.el),d.hide()},_splitterDragCancel:function(e,t,i,l,n,a){var r=this.parentNode.jslet,s=jQuery(r._splitterTracker);s.hide()},checkSizeChanged:function(){var t=this,i=jQuery(t.el),l=i.innerWidth(),n=i.innerHeight();(t._isHori&&l!==t._oldWidth||!t._isHori&&n!==t._oldHeight)&&t._changeFloatSizeDebounce(),t._oldWidth==l&&t._oldHeight==n||e.ui.resizeEventBus.resize(t.el),t._oldWidth=l,t._oldHeight=n},destroy:function($super){var t=this,i=jQuery(t.el);t._splitterTracker=null,t._draggingId=null,t.floatPanel=null;var l=i.find("."+t._splitterClsName);l.off("mousedown",t._splitterMouseDown),t._splitterMouseDown=null;for(var n,a=0,r=l.length;r>a;a++)n=l[a],e.ui.dnd.unbindControl(n),n._doDragStart=null,n._doDragging=null,n._doDragEnd=null,n._doDragCancel=null;e.ui.resizeEventBus.unsubscribe(t),$super()}}),e.ui.register("SplitPanel",e.ui.SplitPanel),e.ui.SplitPanel.htmlTemplate="<div></div>",e.ui.TabControl=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,activeIndex,newable,closable,items,isFixedHeight,hasContent,onAddTabItem,onActiveIndexChanged,onRemoveTabItem,onCreateContextMenu,onContentLoading,onContentLoaded,enableLoading",i._activeIndex=-1,i._newable=!0,i._closable=!0,i._onActiveIndexChanged=null,i._onAddTabItem=null,i._onRemoveTabItem=null,i._onCreateContextMenu=null,i._items=[],i._hasContent=!0,i._isFixedHeight=!1,i._itemsWidth=[],i._containerWidth=0,i._ready=!1,i._leftIndex=0,i._rightIndex=0,i._maxHeaderWidth=160,i._tabControlWidth=jQuery(i.el).width(),i._tabControlHeight=jQuery(i.el).height(),i._contextItemIndex=0,i._onContentLoading=null,i._onContentLoaded=null,i._enableLoading=!1,$super(e,t)},activeIndex:function(t){return void 0===t?this._activeIndex:(e.Checker.test("TabControl.activeIndex",t).isGTEZero(),this._ready?this._chgActiveIndex(t):this._activeIndex=t,this)},activeItemId:function(t){var i=this;if(void 0===t){var l=i._items[this._activeIndex];return l?l.id:null}if(e.Checker.test("TabControl.activeItemId",t).isString(),this._ready)for(var n=i._items,a=0,r=n.length;r>a;a++)if(t===n[a].id){this._chgActiveIndex(a);break}return this},activeItem:function(){var e=this._items;return e&&e.length>0?this._items[this._activeIndex||0]:null},newable:function(e){return void 0===e?this._newable:(this._newable=!!e,this)},closable:function(e){return void 0===e?this._closable:(this._closable=!!e,this)},hasContent:function(e){return void 0===e?this._hasContent:(this._hasContent=!!e,this)},isFixedHeight:function(e){return void 0===e?this._isFixedHeight:(this._isFixedHeight=!!e,this)},enableLoading:function(e){return void 0===e?this._enableLoading:(this._enableLoading=!!e,this)},onAddTabItem:function(t){return void 0===t?this._onAddTabItem:(e.Checker.test("TabControl.onAddTabItem",t).isFunction(),this._onAddTabItem=t,this)},onActiveIndexChanged:function(t){return void 0===t?this._onActiveIndexChanged:(e.Checker.test("TabControl.onActiveIndexChanged",t).isFunction(),this._onActiveIndexChanged=t,this)},onRemoveTabItem:function(t){return void 0===t?this._onRemoveTabItem:(e.Checker.test("TabControl.onRemoveTabItem",t).isFunction(),this._onRemoveTabItem=t,this)},onCreateContextMenu:function(t){return void 0===t?this._onCreateContextMenu:(e.Checker.test("TabControl.onCreateContextMenu",t).isFunction(),this._onCreateContextMenu=t,this)},onContentLoading:function(t){return void 0===t?this._onContentLoading:(e.Checker.test("TabControl.onContentLoading",t).isFunction(),this._onContentLoading=t,this)},onContentLoaded:function(t){return void 0===t?this._onContentLoaded:(e.Checker.test("TabControl.onContentLoaded",t).isFunction(),this._onContentLoaded=t,this)},items:function(t){if(void 0===t)return this._items;e.Checker.test("TabControl.items",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("TabControl.items.header",i.header).isString().required();return this._items=t,this},bind:function(){this.renderAll(),e.ui.resizeEventBus.subscribe(this)},renderAll:function(){function t(e){e&&(i.addTabItem(e),i._calcItemsWidth(),i.activeIndex(i._items.length-1))}var i=this;i._createContextMenu();var l=['<div class="jl-tab-header jl-unselectable"><div class="jl-tab-container jl-unselectable"><ul class="jl-tab-list">',i._newable?'<li><a href="javascript:;" class="jl-tab-inner"><span class="jl-tab-new">+</span></a></li>':"",'</ul></div><a class="jl-tab-left jl-hidden"><span class="jl-nav-btn fa fa-arrow-circle-left"></span></a><a class="jl-tab-right jl-hidden"><span class="jl-nav-btn fa fa-arrow-circle-right"></span></a></div>','<div class="jl-tab-panels jl-round5 jl-hidden'+(i._isFixedHeight?" jl-tab-panels-fixed":"")+' "',i._hasContent?"":' style="border: 0;height:0"',"></div>"],n=jQuery(i.el);if(n.hasClass("jl-tabcontrol")||n.addClass("jl-tabcontrol jl-round5"),n.html(l.join("")),i._newable){var a=n.find(".jl-tab-list")[0],r=a.childNodes[a.childNodes.length-1];i._newTabItem=r,r.onclick=function(){if(i._onAddTabItem){var l=i._onAddTabItem.call(i);e.isPromise(l)?l.done(function(e){t(e)}):t(l)}}}var s=n.find(".jl-tab-left");if(s.on("click",function(e){return i._setVisiTabItems(i._leftIndex-1),e.stopImmediatePropagation(),e.preventDefault(),!1}),s.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),s=n.find(".jl-tab-right"),s.on("click",function(e){return i._setVisiTabItems(i._leftIndex+1),e.stopImmediatePropagation(),e.preventDefault(),!1}),s.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),i._items&&i._items.length>0){for(var o,d=i._items.length,u=0;d>u;u++)o=i._items[u],i._renderTabItem(o);i._activeIndex=0}i._calcItemsWidth(),i._ready=!0,i._chgActiveIndex(i._activeIndex),i._checkTabItemCount()},addItem:function(e){this._items[this._items.length]=e},tabHeader:function(t,i){e.Checker.test("tabHeader#index",t).isGTEZero(),e.Checker.test("tabHeader#label",i).required().isString();var l=this,n=l._getTabItemCfg(t);if(n){n.header=i;var a=jQuery(l.el),r=a.find(".jl-tab-list")[0],s=r.childNodes;jQuery(s[t]).find(".jl-tab-title").html(i),l._calcItemsWidth()}},tabDisabled:function(t,i){e.Checker.test("tabDisabled#index",t).isGTEZero();var l=this,n=l._getTabItemCfg(t);if(n){if(t==l._activeIndex)return void console.warn("Cannot set current tab item to disabled.");n.disabled(i);var a=jQuery(l.el),r=a.find(".jl-tab-panels"),s=r[0],o=s.childNodes,d=jQuery(o[t]);i?d.addClass("jl-tab-disabled"):d.removeClass("jl-tab-disabled")}},_checkTabItemCount:function(){var e=this,t=jQuery(e.el).find(".jl-tab-panels");e._items&&0!==e._items.length?t.removeClass("jl-hidden"):t.hasClass("jl-hidden")||t.addClass("jl-hidden")},_chgActiveIndex:function(t){function i(){for(var e,i,n=jQuery(l.el),a=n.find(".jl-tab-list")[0],r=a.childNodes,s=r.length-(l._newable?2:1),o=n.find(".jl-tab-panels")[0],d=o.childNodes,u=0;s>=u;u++)if(e=jQuery(r[u]),i=d[u],u===t){e.addClass("jl-tab-active"),i.style.display="block";var c=i.childNodes[0];if("IFRAME"==c.tagName){i.style.overflow="hidden";var h=c.style.height;c.style.height="0",c.scrollWidth,c.style.height=h||"100%"}}else e.removeClass("jl-tab-active"),i.style.display="none";l._activeIndex=t,(t<l._leftIndex||t>=l._rightIndex)&&l._setVisiTabItems(null,l._activeIndex)}var l=this,n=l._getTabItemCfg(t);if(n&&!n.disabled)if(t!=l._activeIndex&&l._onActiveIndexChanged){var a=l._onActiveIndexChanged.call(l,l._activeIndex,t);e.isPromise(a)?a.done(function(e){(void 0===e||e)&&i()}):(void 0===a||a)&&i()}else i()},_getTabItemCfg:function(e){var t=this;return t._items.length<=e?null:t._items[e]},_calcItemsWidth:function(){var e=this,t=jQuery(e.el),i=t.find(".jl-tab-list").children();e._itemsWidth=[],e._totalItemsWidth=0,i.each(function(t){var i=jQuery(this).outerWidth()+5;e._itemsWidth[t]=i,e._totalItemsWidth+=i}),e._containerWidth=t.find(".jl-tab-container").innerWidth(),e._setNavBtnVisible()},_setVisiTabItems:function(e,i){var l,n,a,r=this;if(e||0===e)r._leftIndex=e;else{if(!i)return;for(r._newable&&i++,l=r._itemsWidth[i],r._leftIndex=i,n=i-1;n>=0;n--){if(l+=r._itemsWidth[n],l>r._containerWidth){r._leftIndex=n+1;break}r._leftIndex=n}e=r._leftIndex}for(l=0,r._rightIndex=e,n=e,a=r._itemsWidth.length;a>n;n++){if(l+=r._itemsWidth[n],l>r._containerWidth){r._rightIndex=n-1;break}r._rightIndex=n}var s=0;for(n=0;n<r._leftIndex;n++)s+=r._itemsWidth[n];s+=5;var o=jQuery(r.el);o.find(".jl-tab-container").scrollLeft(t.isRtl?5e4-s:s),r._setNavBtnVisible()},_setNavBtnVisible:function(){var e=this,t=jQuery(e.el),i=t.find(".jl-tab-left"),l=i.hasClass("jl-hidden");e._leftIndex>0&&e._totalItemsWidth>e._containerWidth?l&&i.removeClass("jl-hidden"):l||i.addClass("jl-hidden");var n=t.find(".jl-tab-right"),a=e._itemsWidth.length;l=n.hasClass("jl-hidden"),e._rightIndex<a-1&&e._totalItemsWidth>e._containerWidth?l&&n.removeClass("jl-hidden"):l||n.addClass("jl-hidden")},_createHeader:function(t,i){var l=this,n=l._closable&&i.closable,a=[];l._enableLoading&&a.push('<div class="jl-tab-loading jl-hidden"><i class="fa fa-spinner fa-pulse fa-fw"></i></div>'),a.push('<a href="javascript:;" class="jl-tab-inner'+(n?" jl-tab-close-loc":"")+'" onclick="javascript:this.blur();" title="'+i.header+'">'),a.push('<span class="jl-tab-icon '+(i.iconClass||"")+'"></span>'),a.push('<span class="jl-tab-title">'),a.push(i.header),a.push("</span>"),a.push('<span class="fa fa-times close jl-tab-close'+(!n||i.disabled?" jl-hidden":"")+'"></span><span style="clear:both"></span>'),a.push("</a>"),i.id||0===i.id||(i.id=e.nextId());var r=document.createElement("li");if(r.id=i.id+"_h",i.disabled&&jQuery(r).addClass("jl-tab-disabled"),r.innerHTML=a.join(""),l._newable){var s=t.childNodes[t.childNodes.length-1];t.insertBefore(r,s)}else t.appendChild(r);r.jslet=l,jQuery(r).on("click",l._changeTabItem),n&&jQuery(r).find(".jl-tab-close").click(l._doCloseBtnClick),l.contextMenu&&!i.disabled&&(r.oncontextmenu=function(e){var t=0;jQuery(l.el).find(".jl-tab-list li").each(function(){return this===e.currentTarget?(l._contextItemIndex=t,!1):void t++});l.contextMenu.showContextMenu(e,l)})},_changeTabItem:function(e){for(var t=this.parentNode.childNodes,i=-1,l=0;l<t.length;l++)if(t[l]==this){i=l;break}this.jslet._chgActiveIndex(i)},_doCloseBtnClick:function(e){for(var t=this.parentNode.parentNode,i=t.parentNode.childNodes,l=-1,n=0;n<i.length;n++)if(i[n]==t){l=n;break}return t.jslet.removeTabItem(l),e.preventDefault(),!1},_createBody:function(t,i){var l=this,n=jQuery(document.createElement("div"));if(n.hasClass("jl-tab-panel")||n.addClass("jl-tab-panel"),t.appendChild(n[0]),i.content||i.contentId){var a=i.content;if(i.contentId&&(a=jQuery("#"+i.contentId)[0]),a)return n.html(""),n.append(a),void n.children().show()}var r=i.url;if(r&&(r=e.urlUtil.addParam(r,{jlTabItemId:i.id}),i.debounce&&(r=e.urlUtil.addParam(r,{debounce:!0})),i.url=r,i.useIFrame||void 0===i.useIFrame)){var s=i.height;s&&!e.isString(s)&&(s+="px"),s=s?s:"100%";var o=i.id||e.nextId(),d='<iframe id="'+o+'" scrolling="yes" frameborder="0" allowtransparency="true" src="'+r+'" style="background-color:transparent;width: 100%;'+(l._isFixedHeight?"":"height:"+s)+'"'+(l._isFixedHeight?'class="jl-tab-frame-fixed"':"")+"></iframe>";if(n.html(d),i.contentId=o,i.debounce){if(l._enableLoading){var u=jQuery(l.el),c=u.find(".jl-tab-header");c.find("#"+o+"_h .jl-tab-loading").removeClass("jl-hidden")}l._onContentLoading&&l._onContentLoading.call(l,o,i)}}},addTabItem:function(t,i){var l=this,n=l._items,a=t.id;a||(a=e.nextId(),t.id=a);var r;if((void 0===i||i)&&a)for(var s=0,o=n.length;o>s;s++)if(r=n[s],a===r.id)return r.url!==t.url&&(r.url=t.url,l.reloadTabItem(r)),void l.activeIndex(s);n.push(t),l._renderTabItem(t),l._calcItemsWidth(),l._chgActiveIndex(n.length-1),l._checkTabItemCount()},hideLoading:function(e){var t=this,i=jQuery(t.el);t._enableLoading&&i.find("#"+e+"_h .jl-tab-loading").addClass("jl-hidden")},setContentLoadedState:function(e){var t=this;jQuery(t.el);if(t.hideLoading(e),t._onContentLoaded){for(var i,l=t._items,n=null,a=0,r=l.length;r>a;a++)if(i=l[a],e===i.id){n=i.contentId;break}n&&t._onContentLoaded.call(t,n,i)}},setContentChangedState:function(e,t){for(var i,l=this,n=l._items,a=-1,r=0,s=n.length;s>r;r++)if(i=n[r],e===i.id){a=r;break}if(!(0>a)){i.changed=t;var o=i.header,d="*"===o.charAt(0);t?d||(o="*"+o,l.tabHeader(a,o)):d&&(o=o.substring(1),l.tabHeader(a,o))}},hasChanged:function(t){e.Checker.test("TabControl.hasChanged#tabIndex",t).isGTEZero();for(var i,l=this,n=l._items,a=void 0===t||null===t,r=0,s=n.length;s>r;r++)if(i=n[r],i.changed&&(a||t===r))return!0;return!1},_renderTabItem:function(t){var i=this,l=jQuery(i.el),n=l.find(".jl-tab-list")[0],a=l.find(".jl-tab-panels")[0];t.id||(t.id=e.nextId()),i._createHeader(n,t),i._createBody(a,t)},removeTabItem:function(i){var l=this;if(!(i>=l._items.length||0>i)){var n=l._items[i];n.changed?e.ui.confirm(t.TabControl.contentChanged,t.MessageBox.confirm,function(e){"ok"===e&&l._innerRemoveTabItem(i)}):l._innerRemoveTabItem(i)}},_innerRemoveTabItem:function(t){function i(){s.find(".jl-tab-close").hide(),s.animate({width:"toggle"},200,function(){var e=s[0];e.oncontextmenu=null,a.removeChild(e),l._items.splice(t,1);var i=n.find(".jl-tab-panels")[0];r=i.childNodes;var d=r[t];if(i.removeChild(d),l._calcItemsWidth(),l._checkTabItemCount(),o){var u=r.length-(l._newable?2:1);t=l._getNextValidIndex(t,t>=u),t>=0?l._chgActiveIndex(t):l._activeIndex=-1}else l._activeIndex>t&&l._activeIndex--})}var l=this,n=jQuery(l.el),a=n.find(".jl-tab-list")[0],r=a.childNodes,s=jQuery(r[t]),o=s.hasClass("jl-tab-active");if(l._onRemoveTabItem){var d=l._onRemoveTabItem.call(l,l._items[t],o);e.isPromise(d)?d.done(function(e){(void 0===e||e)&&i()}):(void 0===d||d)&&i()}},_getNextValidIndex:function(e,t){var i,l,n=this;if(t){for(i=e-1;i>=0;i--)if(!n._items[i].disabled)return i}else for(i=e,l=n._items.length;l>i;i++)if(!n._items[i].disabled)return i;return-1},reload:function(){var e=this,t=e._contextItemIndex,i=e._items[t];e.reloadTabItem(i)},reloadTabItem:function(e){var t=this;if(e){var i=e.contentId;if(i){if(e.debounce){if(t._enableLoading){var l=jQuery(t.el),n=l.find(".jl-tab-header");n.find("#"+i+"_h .jl-tab-loading").removeClass("jl-hidden")}t._onContentLoading&&t._onContentLoading.call(t,i,e)}jQuery("#"+i).attr("src",e.url)}}},close:function(e){var t=this;void 0===e&&(e=t._activeIndex);var i=t._items[e];i&&e>=0&&i.closable&&!i.disabled&&t.removeTabItem(e)},closeOther:function(){for(var e,t=this,i=t._items.length-1;i>=0;i--)if(e=t._items[i],e.closable&&!e.disabled){if(t._contextItemIndex==i)continue;t.removeTabItem(i)}},closeAll:function(){for(var e,t=this,i=t._items.length-1;i>=0;i--)e=t._items[i],e.closable&&!e.disabled&&t.removeTabItem(i)},checkSizeChanged:function(){var t=this,i=jQuery(t.el),l=i.width(),n=i.height();l===t._tabControlWidth&&n===t._tabControlHeight||(t._tabControlWidth!=l&&(t._tabControlWidth=l,t._calcItemsWidth(),t._setVisiTabItems(t._leftIndex)),t._tabControlHeight=n,e.ui.resizeEventBus.resize(t.el))},_createContextMenu:function(){var i=this;if(i.contextMenu=null,e.ui.Menu&&i._closable){var l={type:"Menu",onItemClick:jQuery.proxy(i._menuItemClick,i),items:[{id:"reload",name:t.TabControl.reload},{id:"close",name:t.TabControl.close},{id:"closeOther",name:t.TabControl.closeOther},{id:"closeAll",name:t.TabControl.closeAll}]};i._onCreateContextMenu&&i._onCreateContextMenu.call(i,l.items),0!==l.items.length&&(i.contextMenu=e.ui.createControl(l))}},_menuItemClick:function(e,t){var i=e.id;"reload"===i?this.reload():"close"===i?this.close(this._contextItemIndex):"closeOther"===i?this.closeOther():"closeAll"===i&&this.closeAll()},destroy:function($super){var t=this;t._newTabItem&&(t._newTabItem.onclick=null,t._newTabItem=null);var i=jQuery(t.el),l=i.find(".jl-tab-header")[0];i.find(".jl-tab-left").off(),i.find(".jl-tab-right").off(),l.oncontextmenu=null,i.find(".jl-tab-close").off();var n=i.find(".jl-tab-list").find("li");n.off(),n.each(function(){this.jslet=null}),e.ui.resizeEventBus.unsubscribe(this),$super()}}),e.ui.register("TabControl",e.ui.TabControl),e.ui.TabControl.htmlTemplate="<div></div>",e.ui.TabItem=function(){var e=this;e.id=null,e.index=-1,e.header=null,e.closable=!1,e.disabled=!1,e.useIFrame=!1,e.height="100%",e.url=null,e.contentId=null,e.content=null},e.ui.Window=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onMoving,onActive,left,top,width,height,minWidth,maxWidth,minHeight,maxHeight,isCenter,isSmallHeader,stopEventBubbling,animation",i._caption=null,i._resizable=!0,i._minimizable=!0,i._maximizable=!0,i._closable=!0,i._iconClass=null,i._left=0,i._top=0,i._width=0,i._height=0,i._minWidth=20,i._minHeight=30,i._maxWidth=-1,i._maxHeight=-1,i._isCenter=!1,i._isSmallHeader=!1,i._animation="linear",i._onSizeChanged=null,i._onPositionChanged=null,i._onMoving=null,i._onActive=null,i._onClosed=null,i._stopEventBubbling=!1,i._isModal=!1,i._state=null,$super(e,t)},caption:function(t){return void 0===t?this._caption:(e.Checker.test("Window.caption",t).isString(),this._caption=t,this)},iconClass:function(t){return void 0===t?this._iconClass:(e.Checker.test("Window.iconClass",t).isString(),this._iconClass=t,this)},resizable:function(e){return void 0===e?this._resizable:(this._resizable=!!e,this)},minimizable:function(e){return void 0===e?this._minimizable:(this._minimizable=!!e,this)},maximizable:function(e){return void 0===e?this._maximizable:(this._maximizable=!!e,this)},closable:function(e){return void 0===e?this._closable:(this._closable=!!e,this)},isCenter:function(e){return void 0===e?this._isCenter:(this._isCenter=!!e,this)},isSmallHeader:function(e){return void 0===e?this._isSmallHeader:(this._isSmallHeader=!!e,this)},animation:function(e){return void 0===e?this._animation:(this._animation=e,this)},stopEventBubbling:function(e){return void 0===e?this._stopEventBubbling:(this._stopEventBubbling=!!e,this)},left:function(t){return void 0===t?this._left:(e.Checker.test("Window.left",t).isNumber(),this._left=t,this)},top:function(t){return void 0===t?this._top:(e.Checker.test("Window.top",t).isNumber(),this._top=t,this)},width:function(t){return void 0===t?this._width:(e.Checker.test("Window.width",t).isGTZero(),this._width=t,this)},height:function(t){return void 0===t?this._height:(e.Checker.test("Window.height",t).isGTZero(),this._height=t,this)},minWidth:function(t){return void 0===t?this._minWidth:(e.Checker.test("Window.minWidth",t).isGTZero(),20>t&&(t=20),this._minWidth=t,this)},minHeight:function(t){return void 0===t?this._minHeight:(e.Checker.test("Window.minHeight",t).isGTZero(),30>t&&(t=30),this._minHeight=t,this)},maxWidth:function(t){return void 0===t?this._maxWidth:(e.Checker.test("Window.maxWidth",t).isNumber(),this._maxWidth=t,this)},maxHeight:function(t){return void 0===t?this._maxHeight:(e.Checker.test("Window.maxHeight",t).isNumber(),this._maxHeight=t,this)},onSizeChanged:function(t){return void 0===t?this._onSizeChanged:(e.Checker.test("Window.onSizeChanged",t).isFunction(),this._onSizeChanged=t,this)},onMoving:function(t){return void 0===t?this._onMoving:(e.Checker.test("Window.onMoving",t).isFunction(),this._onMoving=t,this)},onPositionChanged:function(t){return void 0===t?this._onPositionChanged:(e.Checker.test("Window.onPositionChanged",t).isFunction(),this._onPositionChanged=t,this)},onActive:function(t){return void 0===t?this._onActive:(e.Checker.test("Window.onActive",t).isFunction(),this._onActive=t,this)},onClosed:function(t){return void 0===t?this._onClosed:(e.Checker.test("Window.onClosed",t).isFunction(),this._onClosed=t,this)},bind:function(){var t=this;t._doMovingDebounce=e.debounce(t._doMoving,10),this.renderAll()},renderAll:function(){var t=this,i=jQuery(t.el);i.hasClass("jl-window")||i.addClass("panel panel-default jl-window"),t._width&&i.outerWidth(t._width),t._height&&i.outerHeight(t._height),i.css("display","none");var l=['<div class="panel-heading jl-win-header'+(t._isSmallHeader?" jl-win-header-sm":"")+'" style="cursor:move">',t._iconClass?'<span class="jl-win-header-icon '+t._iconClass+'"></span>':"",'<span class="panel-title jl-win-caption">',t._caption?t._caption:"","</span>",'<span class="jl-win-tool jl-unselectable">'];l.push(t._closable?'<button class="jl-win-tool-btn close jl-win-close" onfocus="this.blur();">x</button>':""),l.push(t._maximizable?'<button class="jl-win-tool-btn close jl-win-max" onfocus="this.blur();">□</button>':""),l.push(t._minimizable?'<button class="jl-win-tool-btn close jl-win-min" onfocus="this.blur();">-</button>':""),l.push("</span></div>"),l.push('<div class="panel-body jl-win-body"></div>'),i.html(l.join("")),i.on("mousemove",t._doWinMouseMove),i.on("mousedown",t._doWinMouseDown),i.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),i.on("click",function(e){t._stopEventBubbling&&(e.stopPropagation(),e.preventDefault())}),t._changeBodyHeight();var n=i.find(".jl-win-header"),a=n[0],r=i.find(".jl-win-body");if(r.on("mouseenter",function(i){window.setTimeout(function(){e.temp_dragging||(t.cursor=null)},300)}),r.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),n.on("mousedown",function(i){t.activate(),"max"!=t._state&&(t.cursor=null,e.ui.dnd.bindControl(this))}),n.on("dblclick",function(e){e.stopPropagation(),e.preventDefault(),t._maximizable&&("max"!=t._state?t.maximize():t.restore())}),a._doDragStart=function(l,n,a,r,s,o){var d=i.position();t._left=d.left,t._top=d.top,e.temp_dragging=!0},a._doDragging=function(e,i,l,n,a,r){t._doMovingDebounce.call(t,a,r)},a._doDragEnd=function(i,l,n,a,r,s){var o=jQuery(t.el).position(),d=o.left,u=o.top;t.setPosition(d,u),t.cursor=null,e.temp_dragging=!1},a._doDragCancel=function(i,l,n,a,r,s){t.setPosition(t._left,t._top),t.cursor=null,e.temp_dragging=!1},t.el._doDragStart=function(i,l,n,a,r,s){t._createTrackerMask(this),t._createTracker(),t.trackerMask.style.cursor=t.el.style.cursor,e.temp_dragging=!0},t.el._doDragging=function(e,i,l,n,a,r){t._changeTrackerSize(a,r)},t.el._doDragEnd=function(i,l,n,a,r,s){if(t.tracker){var o=jQuery(t.tracker),d=o.offset(),u=o.width(),c=o.height(),h=jQuery(t.el).offsetParent().offset(),f=d.left-h.left,p=d.top-h.top;t.setPosition(f,p),t.changeSize(u,c),t._removeTrackerMask(),t._removeTracker(),t.cursor=null,e.temp_dragging=!1}},t.el._doDragCancel=function(i,l,n,a,r,s){t._removeTrackerMask(),t._removeTracker(),t.cursor=null,e.temp_dragging=!1},t._closable){var s=i.find(".jl-win-close");s.click(function(e){t.close(),e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault()})}if(t._minimizable){var o=i.find(".jl-win-min");o.click(function(e){t.minimize(),e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault()})}if(t._maximizable){var d=i.find(".jl-win-max"),u=d[0];d.click(function(e){"max"!=t._state?(u.innerHTML="■",t.maximize()):(u.innerHTML="□",t.restore()),e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault()})}},show:function(e,t){var i=this,l=jQuery(i.el);if(i._isCenter){var n=l.offsetParent(),a=n.width(),r=n.height(),s=$(window).height(),o=$(window).width();a=a>o?o:a,r=r>s?s:r,e=document.body.scrollLeft+Math.round((a-l.outerWidth())/2),t=document.body.scrollTop+Math.round((r-l.outerHeight())/2),0>e&&(e=0),0>t&&(t=0),i._top=t?t:0,i._left=e?e:0}else null!==t&&void 0!==t||(t=i._top),null!==e&&void 0!==e||(e=i._left);i.setPosition(e,t),"slide"==i._animation&&l.slideDown(function(){i._changeBodyHeight(),i.activate()}),"fade"==i._animation?l.fadeIn(function(){i._changeBodyHeight(),i.activate()}):"none"==i._animation?l.show(0,function(){i._changeBodyHeight(),i.activate()}):l.show("fast",function(){i._changeBodyHeight(),i.activate()})},showModal:function(t,i){var l=this;l._isModal=!0,l.overlay||(l.overlay=new e.ui.OverlayPanel(l.el.parentNode)),e.ui.GlobalZIndex+=10;var n=e.ui.GlobalZIndex;l.el.style.zIndex=n,l.show(t,i),l.overlay.setZIndex(n-2),l.overlay.show()},hide:function(){var e=this,t=jQuery(e.el);"slide"==e._animation?t.slideUp():"fade"==e._animation?t.fadeOut():"none"==e._animation?t.hide():t.hide("fast"),e.overlay&&e.overlay.hide()},close:function(){var t=this;if(t.el){if(t._onClosed){var i=t._onClosed.call(t);if(i&&"hidden"==i.toLowerCase())return void t.hide()}var l=t.el.parentNode;l.removeChild(t.el),t.overlay&&(t.overlay.destroy(),t.overlay=null),e.ui.GlobalZIndex-=10,t.destroy()}},minimize:function(){var e=this;if("min"==e._state)return void e.restore();"max"==e._state&&e.restore();var t=jQuery(e.el);e._tempHeight=t.height(),e._tempWidth=t.width(),e.changeSize(e._tempWidth,e._getHeaderHeight()+2),e._state="min"},maximize:function(){var e=this,t=jQuery(e.el),i=t.offsetParent(),l=i.innerWidth(),n=i.innerHeight();i.offset();e.setPosition(0,0,!0),"min"!==e._state&&(e._tempHeight=t.height(),e._tempWidth=t.width()),e.changeSize(l-10,n-10),e._state="max"},restore:function(){var e=this;e.setPosition(e._left,e._top,!0),e.changeSize(e._tempWidth,e._tempHeight),e._state=null},activate:function(){var e=this;e.overlay||e.bringToFront(),e._onActive&&e._onActive.call()},setPosition:function(e,t,i){var l=this;if(0>t&&(t=0),0>e&&(e=0),i){if(l._onPositionChanged){var n=l._onPositionChanged.call(l,e,t);n&&(n.left&&(e=n.left),n.top&&(t=n.top))}}else l._left=e,l._top=t;var a=jQuery(l.el),r=a.offsetParent().offset();a.offset({left:r.left+e,top:r.top+t})},changeSize:function(e,t){var i=this;i._onSizeChanged&&i._onSizeChanged.call(i,e,t);var l=jQuery(i.el);e&&l.width(e),t&&l.height(t),i._changeBodyHeight()},_doMoving:function(e,t){var i=this,l=i._left+e,n=i._top+t;if(i._onMoving){var a=i._onMoving.call(i,l,n,e,t);if(a){var r=a.deltaX,s=a.deltaY;e=r||0===r?r:e,t=s||0===s?s:t}}l=i._left+e,n=i._top+t,i.setPosition(l,n,!0)},_getHeaderHeight:function(){var e=this,t=jQuery(e.el),i=t.find(".jl-win-header");return i.outerHeight()||30},_changeBodyHeight:function(){var t=this;if(t._height){var i=jQuery(t.el),l=i.find(".jl-win-body");l.outerHeight(i.innerHeight()-t._getHeaderHeight()),e.ui.resizeEventBus.resize(t.el)}},getCaptionPanel:function(){return jQuery(this.el).find(".jl-win-caption")[0]},setCaption:function(e){this.caption=e;var t=jQuery(this.el).find(".jl-win-caption");return t.html(e),this},getContentPanel:function(){return jQuery(this.el).find(".jl-win-body")[0]},setContent:function(t){if(!t)return void e.showError("Window content cannot be null!");var i=jQuery(this.el).find(".jl-win-body");return t&&t.toLowerCase?i.html(t):(i.html(""),t.parentNode.removeChild(t),i[0].appendChild(t),t.style&&"none"==t.style.display&&(t.style.display="block")),this},bringToFront:function(){for(var e,t,i,l=this,n=l.el.parentNode,a=jQuery(l.el),r=0,s=0,o=n.childNodes.length;o>s;s++)e=n.childNodes[s],1==e.nodeType&&e!=l.el?(t=jQuery(e),t.hasClass("jl-window")&&(i=parseInt(e.style.zIndex)||0,i>r&&(r=i),l._isModal||t.find(".jl-win-header").removeClass("jl-window-active"))):l._isModal||a.find(".jl-win-header").addClass("jl-window-active");var d=a.getStyleObject();i=parseInt(d.zIndex)||0,r>=i&&l.setZIndex(r+2)},setZIndex:function(e){this.el.style.zIndex=e,this.overlay&&this.overlay.setZIndex(e-2)},_checkSize:function(e,t){var i=this;return e&&(e<i._minWidth||i._maxWidth>0&&e>i._maxWidth)?!1:!t||!(t<i.minHeight||i._maxHeight>0&&t>i._maxHeight)},_changeTrackerSize:function(e,t){var i=this;if(i.tracker&&i.cursor){var l=jQuery(i.el),n=l.outerWidth(),a=l.outerHeight(),r=null,s=null;if("nw"==i.cursor?(n-=e,a-=t,r=i._top+t,s=i._left+e):"n"==i.cursor?(a-=t,r=i._top+t):"ne"==i.cursor?(a-=t,n+=e,r=i._top+t):"e"==i.cursor?n+=e:"se"==i.cursor?(n+=e,a+=t):"s"==i.cursor?a+=t:"sw"==i.cursor?(a+=t,n-=e,s=i._left+e):"w"==i.cursor&&(n-=e,s=i._left+e),i._checkSize(n,a)){var o=jQuery(i.tracker);n&&o.width(n),a&&o.height(a);var d=jQuery(i.el).offsetParent().offset();null===s&&(s=i._left),null===r&&(r=i._top),o.offset({top:d.top+r,left:d.left+s}),o.show()}}},_doWinMouseMove:function(t){if(!e.temp_dragging){t=jQuery.event.fix(t||window.event);var i=t.target,l=jQuery(i);if(l.hasClass("jl-window")){if(!i.jslet._resizable||i.jslet._state)return i.jslet.cursor=null,void(i.style.cursor="default");var n=l.offset(),a=t.pageX-n.left,r=t.pageY-n.top,s=l.width(),o=l.height(),d=8,u=s-d,c=o-d,h=null;d>=a&&d>=r?h="nw":a>d&&u>a&&d>=r?h="n":a>=u&&d>=r?h="ne":a>=u&&r>d&&c>=r?h="e":a>=u&&r>=c?h="se":a>d&&u>a&&r>=c?h="s":d>=a&&r>=c?h="sw":d>=a&&r>d&&c>r&&(h="w"),i.jslet.cursor=h,i.style.cursor=h?h+"-resize":"default"}}},_doWinMouseDown:function(t){var i=this.jslet;i.activate(),i.cursor&&e.ui.dnd.bindControl(this)},_createTrackerMask:function(e){var t=this;if(!t.trackerMask){var i=jQuery(document.body);t.trackerMask=document.createElement("div");var l=jQuery(t.trackerMask);l.addClass("jl-win-tracker-mask"),t.trackerMask.style.top="0px",t.trackerMask.style.left="0px",t.trackerMask.style.zIndex=99998,t.trackerMask.style.width=i.width()+"px",t.trackerMask.style.height=i.height()+"px",t.trackerMask.style.display="block",l.on("mousedown",function(){e&&e._doDragCancel&&e._doDragCancel()}),i[0].appendChild(t.trackerMask)}},_removeTrackerMask:function(){var e=this;e.trackerMask&&(e.trackerMask.onmousedown=null,document.body.removeChild(e.trackerMask)),e.trackerMask=null},_createTracker:function(){var e=this;if(!e.tracker){e.tracker=document.createElement("div");var t=jQuery(e.tracker);t.hide(),t.addClass("jl-win-tracker"),e.tracker.style.zIndex=99999,e.el.parentNode.appendChild(e.tracker)}},_removeTracker:function(){var e=this;e.tracker&&e.el.parentNode.removeChild(e.tracker),e.tracker=null},destroy:function($super){var t=this,i=jQuery(t.el);e.ui.uninstall(t.el),i.find(".jl-win-max").off(),i.find(".jl-win-min").off(),i.find(".jl-win-close").off();var l=i.find(".jl-win-header"),n=l[0];l.off(),i.find(".jl-win-body").off(),t.trackerMask&&(t.trackerMask.onmousedown=null),t.trackerMask=null,t.tracker=null,t._onMoving=null,t._onPositionChanged=null,t._onSizeChanged=null,t._onActive=null,t._onClosed=null,t.el._doDragCancel=null,t.el._doDragEnd=null,t.el._doDragging=null,t.el._doDragStart=null,n._doDragCancel=null,n._doDragEnd=null,n._doDragging=null,n._doDragStart=null,$super&&$super()}}),e.ui.register("Window",e.ui.Window),e.ui.Window.htmlTemplate="<div></div>",e.ui.Calendar=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,value,onDateSelected,minDate,maxDate",i._value=null,i._onDateSelected=null,i._minDate=null,
i._maxDate=null,i._currYear=0,i._currMonth=0,i._currDate=0,$super(e,t)},value:function(t){return void 0===t?this._value:(e.Checker.test("Calendar.value",t).isDate(),this._value=t,this)},minDate:function(t){return void 0===t?this._minDate:(e.Checker.test("Calendar.minDate",t).isDate(),this._minDate=t,this)},maxDate:function(t){return void 0===t?this._maxDate:(e.Checker.test("Calendar.maxDate",t).isDate(),this._maxDate=t,this)},onDateSelected:function(t){return void 0===t?this._onDateSelected:(e.Checker.test("Calendar.onDateSelected",t).isFunction(),this._onDateSelected=t,this)},bind:function(){this.renderAll()},renderAll:function(){var i=this,l=jQuery(i.el);l.hasClass("jl-calendar")||l.addClass("jl-calendar panel panel-default");var n=t.Calendar,a=['<div class="jl-cal-header">','<a class="jl-cal-btn jl-cal-yprev" title="',n.yearPrev,'" href="javascript:;">&lt;&lt;</a><a href="javascript:;" class="jl-cal-btn jl-cal-mprev" title="',n.monthPrev,'">&lt;','</a><a href="javascript:;" class="jl-cal-title"></a><a href="javascript:;" class="jl-cal-btn jl-cal-mnext" title="',n.monthNext,'">&gt;','</a><a href="javascript:;" class="jl-cal-btn jl-cal-ynext" title="',n.yearNext,'">&gt;&gt;</a>',"</div>",'<div class="jl-cal-body">','<table cellpadding="0" cellspacing="0">','<thead><tr><th class="jl-cal-weekend">',n.Sun,"</th><th>",n.Mon,"</th><th>",n.Tue,"</th><th>",n.Wed,"</th><th>",n.Thu,"</th><th>",n.Fri,'</th><th class="jl-cal-weekend">',n.Sat,"</th></tr></thead><tbody>",'<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','</tbody></table></div><div class="jl-cal-footer"><a class="jl-cal-today" href="javascript:;">',n.today,"</a></div>"];l.html(a.join(""));var r=l.find(".jl-cal-body table");i._currYear=-1,r.on("click",i._doTableClick);var s=i._value&&e.isDate(i._value)?i._value:new Date;this.setValue(s),l.find(".jl-cal-today").click(function(e){var t=new Date;i.setValue(new Date(t.getFullYear(),t.getMonth(),t.getDate())),i._fireSelectedEvent()}),l.find(".jl-cal-yprev").click(function(e){i.incYear(-1)}),l.find(".jl-cal-mprev").click(function(e){i.incMonth(-1)}),l.find(".jl-cal-ynext").click(function(e){i.incYear(1)}),l.find(".jl-cal-mnext").click(function(e){i.incMonth(1)}),l.on("keydown",function(t){var l=t.ctrlKey,n=t.keyCode;return n==e.ui.KeyCode.UP?(l?i.incYear(-1):i.incDate(-7),void t.preventDefault()):n==e.ui.KeyCode.DOWN?(l?i.incYear(1):i.incDate(7),void t.preventDefault()):n==e.ui.KeyCode.LEFT?(l?i.incMonth(-1):i.incDate(-1),void t.preventDefault()):n==e.ui.KeyCode.RIGHT?(l?i.incMonth(1):i.incDate(1),void t.preventDefault()):void 0})},_getNotNullDate:function(){var e=this._value;return e||(e=new Date),e},incDate:function(e){var t=this._getNotNullDate();t.setDate(t.getDate()+e),this.setValue(t)},incMonth:function(e){var t=this._getNotNullDate(),i=t.getDate();if(t.setMonth(t.getMonth()+e),i>=29){var l=t.getDate();i!=l&&(t=new Date(t.getFullYear(),t.getMonth(),1)-864e5,t=new Date(t))}this.setValue(t)},incYear:function(e){var t=this._getNotNullDate(),i=t.getDate();if(t.setFullYear(t.getFullYear()+e),i>=29){var l=t.getDate();i!=l&&(t=new Date(t.getFullYear(),t.getMonth(),1)-864e5,t=new Date(t))}this.setValue(t)},_innerSetValue:function(e){var t=this,i=t._getNotNullDate();e&&i.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t._value=i},setValue:function(e){if(e){var t=this;t._minDate&&e<t._minDate&&(e=new Date(t._minDate.getTime())),t._maxDate&&e>t._maxDate&&(e=new Date(t._maxDate.getTime())),t._innerSetValue(e);var i=e.getFullYear(),l=e.getMonth();t._currYear==i&&t._currMonth==l?t._setCurrDateCls():t._refreshDateCell(i,l)}},focus:function(){var e=this,t=jQuery(e.el);t.find(".jl-cal-current")[0].focus()},_checkNaviState:function(){var e,t,i=this,l=jQuery(i.el);if(i._minDate){var n=i._minDate.getFullYear(),a=i._minDate.getMonth(),r=l.find(".jl-cal-yprev")[0];e=i._currYear<=n,r.style.visibility=e?"hidden":"visible",e=i._currYear==n&&i._currMonth<=a;var s=l.find(".jl-cal-mprev")[0];s.style.visibility=e?"hidden":"visible",e=i._minDate>new Date,t=l.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}if(i._maxDate){var o=i._maxDate.getFullYear(),d=i._maxDate.getMonth(),u=l.find(".jl-cal-ynext")[0];e=i._currYear>=o,u.jslet_disabled=e,u.style.visibility=e?"hidden":"visible",e=i._currYear==o&&i._currMonth>=d;var c=l.find(".jl-cal-mnext")[0];c.jslet_disabled=e,c.style.visibility=e?"hidden":"visible",e=i._maxDate<new Date,t=l.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}},_refreshDateCell:function(e,i){var l=this,n=jQuery(l.el),a=t.Calendar.monthNames,r=a[i],s=n.find(".jl-cal-title")[0];s.innerHTML=r+","+e;var o=n.find(".jl-cal-body table")[0],d=o.tBodies[0].rows,u=new Date(e,i,1),c=u.getDay(),h=864e5,f=new Date(u.getTime()-(c+1)*h);f=new Date(f.getFullYear(),f.getMonth(),f.getDate());for(var p,_,v,m,g=d.length,C=1;g>=C;C++){p=d[C-1];for(var b=1,y=p.cells.length;y>=b;b++)_=p.cells[b-1],f=new Date(f.getTime()+h),m=_.firstChild,l._minDate&&f<l._minDate||l._maxDate&&f>l._maxDate?(m.innerHTML="",_.jslet_date_value=null):(m.innerHTML=f.getDate(),_.jslet_date_value=f,v=f.getMonth(),v!=i?jQuery(_).addClass("jl-cal-disable"):jQuery(_).removeClass("jl-cal-disable"))}l._currYear=e,l._currMonth=i,l._setCurrDateCls(),l._checkNaviState()},_fireSelectedEvent:function(){var e=this;e._onDateSelected&&e._onDateSelected.call(e,e._value)},_doTableClick:function(t){t=jQuery.event.fix(t||window.event);var i=t.target,l=i.parentNode;if(l&&l.tagName&&"td"==l.tagName.toLowerCase()){if(!l.jslet_date_value)return;var n=e.ui.findFirstParent(l,function(e){return e.jslet}),a=n.jslet;a._innerSetValue(l.jslet_date_value),a._setCurrDateCls();try{l.firstChild.focus()}catch(r){}a._fireSelectedEvent()}},_setCurrDateCls:function(){var t=this;if(e.isDate(t._value))for(var i,l,n,a,r,s,o,d=t._value.getMonth(),u=t._value.getFullYear(),c=t._value.getDate(),h=jQuery(t.el),f=h.find(".jl-cal-body table")[0],p=f.tBodies[0].rows,_=p.length,v=0;_>v;v++){i=p[v];for(var m=0,g=i.cells.length;g>m;m++)if(l=i.cells[m],s=l.jslet_date_value)if(n=s.getMonth(),r=s.getFullYear(),a=s.getDate(),o=jQuery(l.firstChild),r==u&&n==d&&a==c){o.hasClass("jl-cal-current")||o.addClass("jl-cal-current");try{l.firstChild.focus()}catch(C){}}else o.removeClass("jl-cal-current")}},destroy:function($super){var e=jQuery(this.el);e.off(),e.find(".jl-cal-body table").off(),e.find(".jl-cal-today").off(),e.find(".jl-cal-yprev").off(),e.find(".jl-cal-mprev").off(),e.find(".jl-cal-mnext").off(),e.find(".jl-cal-ynext").off(),$super()}}),e.ui.register("Calendar",e.ui.Calendar),e.ui.Calendar.htmlTemplate="<div></div>",e.ui.MessageBox=function(){this.show=function(i,l,n,a,r,s,o,d){var u={type:"window",caption:l,isCenter:!0,resizable:!1,minimizable:!1,maximizable:!1,stopEventBubbling:!0,animation:"fade"},c=e.ui.createControl(u),h="";if(n){switch(h='<div class="jl-msg-icon ',h+="info"==n||"error"==n||"question"==n||"warning"==n?"jl-msg-icon-"+n:n,h+='"><i class="fa ',n){case"info":h+="fa-info";break;case"error":h+="fa-times";break;case"success":h+="fa-check";break;case"warning":h+="fa-exclamation";break;case"question":h+="fa-question";break;default:h+="fa-info"}h+='"></i></div>'}var f,p,_=a.length,v=[];if(t.isRtl)for(p=_-1;p>=0;p--)f=a[p],v.push('<button class="jl-msg-button btn btn-default btn-xs" '),v.push(' data-jsletname="'),v.push(f),v.push('">'),v.push(t.MessageBox[f]),v.push("</button>");else for(p=0;_>p;p++)f=a[p],v.push('<button class="jl-msg-button btn btn-default btn-xs" '),v.push('" data-jsletname="'),v.push(f),v.push('">'),v.push(t.MessageBox[f]),v.push("</button>");var m=["<br />"];s&&(1==s?m.push('<input type="text"'):m.push('<textarea rows="5"'),m.push(' style="width:'),m.push('98%"'),null!==o&&void 0!==o&&(m.push(' value="'),m.push(o),m.push('"')),1==s?m.push(" />"):m.push("></textarea>")),i&&(i=i.replace("\n","<br />"));var g=['<div class="jl-msg-container">',h,'<div class="'+(s?"jl-msg-message-noicon":"jl-msg-message")+'">',i,m.join(""),"</div>","</div>",'<div class="jl-msg-tool"><div>',v.join(""),"</div></div>"];c.setContent(g.join(""));var C=jQuery(c.el),b=C.find(".jl-msg-tool")[0].firstChild,y=null;y=1==s?C.find(".jl-msg-container input")[0]:C.find(".jl-msg-container textarea")[0],jQuery(b).on("click","button",function(e){var t=e.currentTarget,i=jQuery(t).attr("data-jsletname"),l=null;return s&&"ok"==i&&(l=y.value,d&&!d(l))?void y.focus():(c.close(),void(r&&r(i,l)))}),c.showModal(),c.setZIndex(99981);var j=_-1;if(t.isRtl&&(j=0),y)y.focus();else{var w=b.childNodes[j];w&&w.focus()}return c}},e.ui.info=e.ui.alert=function(i,l,n,a){var r=new e.ui.MessageBox;l||(l=t.MessageBox.info);var s=r.show(i,l,"info",["ok"],n);a&&(a=parseInt(a),window.isNaN(a)||window.setTimeout(function(){s.close()},a))},e.ui.error=function(i,l,n,a){var r=new e.ui.MessageBox;l||(l=t.MessageBox.error);var s=r.show(i,l,"error",["ok"],n);a&&(a=parseInt(a),window.isNaN(a)||window.setTimeout(function(){s.close()},a))},e.ui.warn=function(i,l,n,a){var r=new e.ui.MessageBox;l||(l=t.MessageBox.warn);var s=r.show(i,l,"warning",["ok"],n);a&&(a=parseInt(a),window.isNaN(a)||window.setTimeout(function(){s.close()},a))},e.ui.confirm=function(i,l,n,a){var r=new e.ui.MessageBox;l||(l=t.MessageBox.confirm),a?r.show(i,l,"question",["yes","no","cancel"],n):r.show(i,l,"question",["ok","cancel"],n)},e.ui.prompt=function(i,l,n,a,r,s){var o=new e.ui.MessageBox;l||i||(l=t.MessageBox.prompt),s?o.show(i,l,null,["ok","cancel"],n,2,a,r):o.show(i,l,null,["ok","cancel"],n,1,a,r)},e.ui.OverlayPanel=function(t,i){var l=document.createElement("div");jQuery(l).addClass("jl-overlay").on("click",function(t){t=jQuery.event.fix(t||window.event);var i=t.target;e.ui.PopupPanel.popupElement.checkAndHide(i)&&(t.stopPropagation(),t.preventDefault())}),i&&(l.style.backgroundColor=i);var n,a,r,s;if(t)r=jQuery(t).width(),s=jQuery(t).height();else{var o=jQuery(document.body);n=0,a=0,r=o.width(),s=o.height()}l.style.left="0px",l.style.top="0px",l.style.bottom="0px",l.style.right="0px",t?t.appendChild(l):document.body.appendChild(l),l.style.display="none";var d=null;t?(d=t.onresize,t.onresize=function(){var e=jQuery(t).width()-12,i=jQuery(t).height()-12;l.style.width=e+"px",l.style.height=i+"px"}):(d=window.onresize,window.onresize=function(){l.style.width=document.body.scrollWidth+"px",l.style.height=document.body.scrollHeight+"px"}),this.overlayPanel=l,this.show=function(){return l.style.display="block",l},this.hide=function(){return l.style.display="none",l},this.setZIndex=function(e){this.overlayPanel.style.zIndex=e},this.destroy=function(){this.hide(),t?(t.onresize=d,t.removeChild(l)):(window.onresize=d,document.body.removeChild(l)),jQuery(this.overlayPanel).off()}},e.ui.PopupPanel=function(e){this._onHidePopup=null,this._excludedEl=e,this._contentEl=null},e.ui.PopupPanel.prototype={onHidePopup:function(e){return void 0===e?this._onHidePopup:(this._onHidePopup=e,this)},excludedElement:function(e){return void 0===e?this._excludedEl:(this._excludedEl=e,this)},contentElement:function(e){return void 0===e?this._contentEl:(this._contentEl=e,this)},show:function(t,i,l,n,a,r){e.ui.PopupPanel.popupElement.show(this,t,i,l,n,a,r)},hide:function(){e.ui.PopupPanel.popupElement.hide()},destroy:function(){this._onHidePopup=null,this._excludedEl=null,this._contentEl=null}},function(){var i=function(){function i(){if(!n){var e=document.createElement("div");e.style.display="none",e.className="jl-popup-panel jl-opaque jl-border-box dropdown-menu",e.style.position="absolute",e.style.zIndex=99e3,document.body.appendChild(e),jQuery(document).on("click",o),n=e}}function l(e){var t=n.childNodes[0];if(t&&n.removeChild(t),e){var i=e.contentElement();if(!i)return;n.appendChild(i),i.style.border="none"}}var n=null,a=null,r=function(e){return e&&e!==document?jQuery(e).hasClass("jl-popup-panel")?!0:r(e.parentNode):!1},s=this,o=function(e){if(a){e=jQuery.event.fix(e||window.event);var t=e.target;s.checkAndHide(t)}};this.show=function(e,r,s,o,d,u,c){i(),a!==e&&(this.hide(),l(e)),a=e,r=parseInt(r),s=parseInt(s),d&&(n.style.height=parseInt(d)+"px"),o&&(n.style.width=parseInt(o)+"px");var h=jQuery(window),f=h.scrollLeft()+h.width(),p=h.scrollTop()+h.height(),_=jQuery(n),v=_.outerWidth(),m=_.outerHeight();t.isRtl&&(r-=v),r+v>f&&(r+=f-r-v-1),s+m>p&&(s-=m+2+c),0>r&&(r=1),0>s&&(s=1),s&&(n.style.top=s+"px"),r&&(n.style.left=r+"px"),n.style.display="block"},this.hide=function(){if(a){n&&(n.style.display="none");var e=a.onHidePopup();e&&e.call(a),a=null}},this.checkAndHide=function(t){return a?e.ui.isChild(a.excludedElement(),t)||r(t)?!1:(this.hide(),!0):!0},this.destroy=function(){n&&(document.body.removeChild(n),jQuery(n).off(),jQuery(document).off("click",o))}};e.ui.PopupPanel.popupElement=new i}(),e.ui.ProgressBar=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.el=e,i.allProperties="styleClass,value,labelText",i._value=0,i._labelText="0%",$super(e,t)},value:function(e){return void 0===e?this._value:(e=parseInt(e),e||(e=0),0>e&&(e=0),e>100&&(e=100),this._value=e,this._setValue(),this)},labelText:function(e){if(void 0===e)return this._labelText;if(this._labelText=e,this.binded){var t=jQuery(this.el),i=t.find(".jl-progressbar-label");i.text(e)}return this},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-progressbar")||t.addClass("jl-progressbar jl-border-box jl-round5"),t.attr("role","progressbar").attr("aria-valuemax","100").attr("aria-valuemin","0").attr("aria-valuenow",this._value),t.html('<div class="jl-progressbar-label">'+e._labelText+'</div><div class="jl-progressbar-value"></div>')},_setValue:function(){var e=this;if(e.binded){var t=jQuery(e.el),i=t.find(".jl-progressbar-label"),l=t.find(".jl-progressbar-value");e._oldValue=-1;var n=e._value,a=n+"%";n!=e._oldValue&&(i.text(a),l.css("width",a),t.attr("aria-valuenow",n),e._oldValue=n)}},destroy:function($super){$super()}}),e.ui.register("ProgressBar",e.ui.ProgressBar),e.ui.ProgressBar.htmlTemplate="<div></div>",e.ui.ProgressPopup=function(t,i,l,n){e.Checker.test("ProgressPopus#container",t).isHTMLElement(),e.Checker.test("ProgressPopus#onCancelled",n).isFunction(),this._dialog=null,this._value=0,this._cancellable=!1,void 0!==l&&(this._cancellable=!!l),this._onCancelled=n,this.initialize(t||document.body,i||"")},e.ui.ProgressPopup.prototype={initialize:function(t,i){var l={type:"window",caption:i,isCenter:!0,resizable:!0,minimizable:!1,closable:this._cancellable,maximizable:!1,width:500,height:80,animation:"fade",onClosed:this._onCancelled},n=e.ui.createControl(l,t),a='<div name="progressBar" data-jslet="type: \'ProgressBar\'" style="width: 100%"/>';n.setContent(a),this._dialog=n,e.ui.install(n.el)},show:function(){return this._dialog.showModal(),this},value:function(e){if(void 0===e)return this._value;e=parseInt(e),e||(e=0),0>e&&(e=0),e>100&&(e=100),this._value=e;var t=jQuery(this._dialog.el).find("[name=progressBar]")[0].jslet;t.value(e)},destroy:function(){this._dialog&&(this._dialog.close(),this._dialog=null)}},e.ui.Rating=e.Class.create(e.ui.DBFieldControl,{_isDBControl:!1,initialize:function($super,e,t){var i=this;i.allProperties="styleClass,value,itemCount,splitCount,readOnly",i._itemCount=5,i._splitCount=0,i._itemWidth=0,i._value=0,i._readOnly=!1,i._isReady=!1,$super(e,t)},itemCount:function(t){return void 0===t?this._itemCount:(e.Checker.test("DBRating.itemCount",t).isGTZero(),this._itemCount=parseInt(t),this)},value:function(t){return void 0===t?this._value:(e.Checker.test("DBRating.value",t).isGTZero(),this._value=t,this._isReady&&this._setValue(t),this)},readOnly:function(e){return void 0===e?this._readOnly:(this._readOnly=!!e,this)},splitCount:function(t){return void 0===t?this._splitCount:(e.Checker.test("DBRating.splitCount",t).isGTEZero(),this._splitCount=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-rating")||t.addClass("jl-rating"),e.renderAll(),t.on("mousemove","td",jQuery.proxy(e._mouseMove,e)),t.on("mouseleave",jQuery.proxy(e._mouseOut,e)),t.on("mouseup","td",jQuery.proxy(e._mouseUp,e)),e._isReady=!0},renderAll:function(){var e,t,i=this,l=jQuery(i.el),n="",a="",r='<td><i class="fa fa-star" aria-hidden="true"></i></td>';for(e=0,t=i._itemCount;t>e;e++)n+=r,a+=r;var s='<div class="jl-rating"><table><tr>'+n+'</tr></table><div class="jl-rating-value"><table><tr>'+a+"</tr></table></div></div>";return l.html(s),window.setTimeout(function(){i._itemWidth=l.find("td:first").outerWidth(),i._setValue(i._value)},5),this},_mouseMove:function(e){var t=this;if(!t._readOnly){var i=jQuery(t.el);i.find(".jl-rating-value").width(t._getMovedWidth(e)),t._changed=!0}},_getMovedWidth:function(e){var t=e.currentTarget,i=t.cellIndex;return this._itemWidth*i+e.offsetX},_mouseOut:function(e){var t=this;t._readOnly||t._changed&&t._setValue(t._value)},_mouseUp:function(e){var t=this;if(!t._readOnly){t._changed=!1;var i=(jQuery(t.el),t._getMovedWidth(e));t._value=t._round(t._itemCount*i/(t._itemCount*t._itemWidth)),t.doUIChanged()}},_round:function(e){var t=this._splitCount;if(!t||1===t)return Math.ceil(e);for(var i,l=parseInt(e),n=e-l,a=1/t,r=1,s=t;s>=r;r++)if(i=r*a,i>n)return l+i;return e},_setValue:function(t){e.Checker.test("Rating.value",t).isNumber(),0>t&&(t=0);var i=this,l=i._itemCount;t>l&&(t=l);var n=jQuery(i.el);n.find(".jl-rating-value").width(t*i._itemWidth)},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),e.ui.register("Rating",e.ui.Rating),e.ui.Rating.htmlTemplate="<Div></Div>",e.ui.TipPanel=function(){this._hideTimerId=null,this._showTimerId=null,this._oldElement=null;var e=document.createElement("div");jQuery(e).addClass("jl-tip-panel"),document.body.appendChild(e),this._tipPanel=e,this.show=function(e,t,i){var l=this,n=arguments.length,a=!1,r=t;if(2==n){var s=r;s=jQuery.event.fix(s),i=s.pageY+16,r=s.pageX+2;var o=s.currentTarget;a=o===l._oldElement,l._oldElement=o}else r=parseInt(r),i=parseInt(i);l._hideTimerId&&(window.clearTimeout(l._hideTimerId),a)||(this._showTimerId=window.setTimeout(function(){var t=l._tipPanel;t.innerHTML=e,t.style.left=r+"px",t.style.top=i+"px",l._tipPanel.style.display="block",l._showTimerId=null},300))},this.hide=function(){var e=this;return e._showTimerId?void window.clearTimeout(e._showTimerId):void(e._hideTimerId=window.setTimeout(function(){e._tipPanel.style.display="none",e._hideTimerId=null,e._oldElement=null},300))}},e.ui.WaitingBox=function(t,i,l){var n=new e.ui.OverlayPanel(t),a='<div class="jl-waitingbox jl-round4"><i class="fa fa-spinner fa-pulse fa-2x fa-fw jl-waitingbox-icon"></i>';a+='<span class="jl-waitingbox-text"></span></div>',jQuery(n.overlayPanel).html(a),this.show=function(e){var t=n.overlayPanel,i=t.firstChild,l=i.childNodes[1];l.innerHTML=e?e:"";var a=jQuery(t),r=a.height(),s=a.width();setTimeout(function(){var e=jQuery(i);i.style.top=Math.round((r-e.height())/2)+"px",i.style.left=Math.round((s-e.width())/2)+"px"},10),n.show()},this.hide=function(){n.hide()},this.destroy=function(){n.overlayPanel.innerHTML="",n.destroy()}},e.ui.FieldControlAddon={field:null,content:null,width:"10px"},e.ui.DBPlace=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field,prefix,suffix,expandChildWidth",this.editControl=null,this._expandChildWidth=!0,$super(e,t)},prefix:function(t){if(void 0===t)return this._prefix;e.Checker.test("DBPlace#prefix",t).isArray();for(var i,l=0,n=t.length;n>l;l++)if(i=t[l],!i.field&&!i.content)throw new Error('In DBPlace#prefix setting, one of property "field" or "content" is required!');return t&&0===t.length&&(t=null),this._prefix=t,this},suffix:function(t){if(void 0===t)return this._suffix;e.Checker.test("DBPlace#suffix",t).isArray(),e.Checker.test("DBPlace#suffix",t).isArray();for(var i,l=0,n=t.length;n>l;l++)if(i=t[l],!i.field&&!i.content)throw new Error('In DBPlace#suffix setting, one of property "field" or "content" is required!');return t&&0===t.length&&(t=null),this._suffix=t,this},expandChildWidth:function(e){return void 0===e?this._expandChildWidth:(this._expandChildWidth=!!e,this)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},refreshControl:function(t){var i=this,l=t.eventType;return l!=e.data.RefreshEvent.CHANGEMETA||i._field!=t.fieldName||"editControl"!=t.metaName&&"valueStyle"!=t.metaName?void 0:(i.renderAll(),!0)},renderAll:function(){var e=this;e.removeAllChildControls();var t=e._prefix||e._suffix;if(!t)return void e._renderEditor(e._field,e.el);jQuery(e.el).addClass("jl-comb-editor"),e._prefix&&e._renderOtherPart(e.el,e._prefix);var i=e._renderEditor(e._field,e.el);return jQuery(i).addClass("jl-comb-master"),e._suffix&&e._renderOtherPart(e.el,e._suffix),this},_renderEditor:function(t,i){var l=this,n=l._dataset.getField(t),a=n.editControl();n.valueStyle()==e.data.FieldValueStyle.BETWEEN&&void 0===l._valueIndex&&(a={type:"DBBetweenEdit"}),a.dataset=l._dataset,a.field=t,void 0!==l._valueIndex&&(a.valueIndex=l._valueIndex),(l._tabIndex||0===l._tabIndex)&&(a.tabIndex=l._tabIndex);var r=e.ui.createControl(a,i);l.addChildControl(r),r.tableId&&r.tableId(l._tableId);var s=e.nextId();return r.el.id=s,r.el},_renderOtherPart:function(t,i){for(var l,n,a,r=jQuery(t),s=0,o=i.length;o>s;s++){l=i[s],n=l.width;var d=e.nextId();if(r.append('<span id = "'+d+'"></span>'),a=document.getElementById(d),l.field)this._renderEditor(l.field,a);else{if(!l.content){console.warn("prefix or suffix: field or content is required!");continue}a.innerHTML=l.content}n||(console.warn("Width is empty, use 5% instead!"),n="5%"),jQuery(a).addClass("jl-comb-addon").children().first().addClass("input-sm"),a.style.width=n}},canFocus:function(){return!1}}),e.ui.register("DBPlace",e.ui.DBPlace),e.ui.DBPlace.htmlTemplate="<div></div>",e.ui.DBText=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll,readOnly",i._beforeUpdateToDataset=null,i._enableInvalidTip=!0,i._enterProcessed=!1,i._autoSelectAll=!0,i._readOnly=!1,i.oldValue=null,i.editMask=null,i._position=null,$super(e,t)},beforeUpdateToDataset:function(t){return void 0===t?this._beforeUpdateToDataset:(e.Checker.test("DBText.beforeUpdateToDataset",t).isFunction(),this._beforeUpdateToDataset=t,this)},enableInvalidTip:function(e){return void 0===e?this._enableInvalidTip:(this._enableInvalidTip=!!e,this)},readOnly:function(e){return void 0===e?this._readOnly:(this._readOnly=!!e,e&&(this.el.readOnly=!0),this)},autoSelectAll:function(e){return void 0===e?this._autoSelectAll:(this._autoSelectAll=!!e,this)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.addClass("form-control input-sm"),e.el.name=e._field,e.doFocus&&t.on("focus",jQuery.proxy(e.doFocus,e)),e.doBlur&&t.on("blur",jQuery.proxy(e.doBlur,e)),e.doKeydown&&t.on("keydown",e.doKeydown),e.doKeypress&&t.on("keypress",e.doKeypress),e.doMetaChanged("required")},doFocus:function(){var t=this;t._skipFocusEvent||(e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex),t.doValueChanged(),t.oldValue=t.el.value,t._autoSelectAll&&e.ui.TextUtil.selectText(t.el))},doBlur:function(){var t=this,i=t._dataset.getField(t._field);if(e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null),t._position=e.ui.TextUtil.getCursorPos(t.el),!i.readOnly()&&!i.disabled()){var l=jQuery(this.el);if(!l.attr("readOnly")&&!l.attr("disabled")){t.updateToDataset(),t._isBluring=!0;try{t.doValueChanged()}finally{t._isBluring=!1}}}},doKeydown:function(t){t=jQuery.event.fix(t||window.event);var i=t.which,l=this.jslet,n=e.ui.KeyCode;i===n.ENTER&&(l._enterProcessed=!0,l.updateToDataset());var a=l._dataset.status()>0;!a||i!==n.UP&&i!==n.DOWN&&i!==n.PAGEUP&&i!==n.PAGEDOWN||(l._enterProcessed=!0,l.updateToDataset());var r=l._dataset.getField(l._field);if(r.readOnly()||r.disabled()||i!==n.BACKSPACE&&i!==n.DELETE||l._dataset.editRecord(),i===n.LEFT||i===n.RIGHT){var s=e.ui.TextUtil.getCursorPos(l.el);(i===n.LEFT&&s.begin>0||39===i&&s.begin<l.el.value.length)&&t.stopImmediatePropagation()}},doKeypress:function(t){var i=this.jslet,l=i._dataset.getField(i._field);if(!l.readOnly()&&!l.disabled()){t=jQuery.event.fix(t||window.event);var n=t.which,a=e.cutString(i.el.value,e.ui.TextUtil.getSelectedText(i.el)),r=e.ui.TextUtil.getCursorPos(i.el);if(!i._dataset.fieldValidator().checkInputChar(l,String.fromCharCode(n),a,r.begin))return t.preventDefault(),!1;i._dataset.editRecord(),n===e.ui.KeyCode.ENTER&&(i._enterProcessed?i._enterProcessed=!1:i.updateToDataset())}},selectText:function(t,i){return e.ui.TextUtil.selectText(this.el,t,i),this},inputText:function(t){if(t){e.Checker.test("DBText.inputText#text",t).isString();var i=this,l=i._dataset.getField(i._field);if(l.getType()!==e.data.DataType.STRING)return void console.warn("Only String Field can be input!");for(var n,a=[],r=0,s=t.length;s>r;r++)n=t[r],i._dataset.fieldValidator().checkInputChar(l,n)&&a.push(n);i._position||(i._position=e.ui.TextUtil.getCursorPos(i.el));var o=(a.join(""),i.el.value),d=i._position.begin,u=i._position.end,c=o.substring(0,d),h=o.substring(u);return i.el.value=c+t+h,i._position=e.ui.TextUtil.getCursorPos(i.el),i.updateToDataset(),this}},refreshControl:function($super,e,t){$super(e,t)&&this.afterRefreshControl&&this.afterRefreshControl(e)},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(i._readOnly||t&&"disabled"!=t&&"readOnly"!=t||e.ui.setEditableStyle(i.el,l.disabled(),l.readOnly(),!1,l.required()),t&&"required"==t){var n=jQuery(i.el);l.required()?n.addClass("jl-ctrl-required"):n.removeClass("jl-ctrl-required")}if(!t||"editMask"==t){var a=l.editMask();if(a){i.editMask||(i.editMask=new e.ui.EditMask,i.editMask.attach(i.el));var r=a.mask,s=a.keepChar,o=a.transform;i.editMask.setMask(r,s,o)}else i.editMask&&(i.editMask.detach(),i.editMask=null)}t&&"tabIndex"!=t||i.setTabIndex(),i.el.maxLength=l.getEditLength()},doValueChanged:function(){var i=this;if(!i._keep_silence_){var l=i.getFieldError();if(l&&l.message)return i.el.value=l.inputText||i._dataset.getFieldText(i._field),void i.renderInvalid(l);i.renderInvalid(null);var n=i._dataset.getField(i._field),a=n.alignment();t.isRtl&&(a="left"==a?"right":"left"),i.el.style.textAlign=a;var r;i.editMask?(r=i.getText(),i.editMask.setValue(r)):(r=document.activeElement!=i.el||i.el.readOnly||i._isBluring?i.getText(!1):i.getText(!0),n.getType()===e.data.DataType.STRING&&n.antiXss()&&(r=e.htmlDecode(r)),i.el.value=r),i.oldValue=i.el.value}},doLookupChanged:function(){this.doValueChanged()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},updateToDataset:function(){var t=this;if(t._keep_silence_)return!0;var i=t.el.value;if(t.oldValue==i)return!0;if(t._dataset.editRecord(),this.editMask&&!this.editMask.validateValue())return!1;if(t._beforeUpdateToDataset&&!t._beforeUpdateToDataset.call(t))return!1;t._keep_silence_=!0;try{t.editMask&&(i=t.editMask.getValue()),t._dataset.setFieldText(t._field,i,t._valueIndex)}finally{t._keep_silence_=!1}return t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field)),!0},destroy:function($super){var e=this;jQuery(e.el).off(),e.editMask&&(e.editMask.detach(),e.editMask=null),e._beforeUpdateToDataset=null,e.onKeyDown=null,$super()}}),e.ui.register("DBText",e.ui.DBText),e.ui.DBText.htmlTemplate='<input type="text"></input>',e.ui.DBPassword=e.Class.create(e.ui.DBText,{initialize:function($super,e,t){jQuery(e).attr("type","password"),$super(e,t)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()}}),e.ui.register("DBPassword",e.ui.DBPassword),e.ui.DBPassword.htmlTemplate='<input type="password"></input>',e.ui.DBTextArea=e.Class.create(e.ui.DBText,{initialize:function($super,e,t){$super(e,t)},isValidTemplateTag:function(e){return"textarea"==e.tagName.toLowerCase()}}),e.ui.register("DBTextArea",e.ui.DBTextArea),e.ui.DBTextArea.htmlTemplate="<textarea></textarea>",e.ui.DBCustomComboBox=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,textReadOnly",i._textReadOnly=!1,i.enableInvalidTip=!1,$super(e,t)},textReadOnly:function(e){return void 0===e?this._textReadOnly:(this._textReadOnly=!!e,this.textCtrl&&this.textCtrl.readOnly(e),this)},bind:function(){var t=this,i=jQuery(t.el);i.hasClass("input-group")||i.addClass("input-group input-group-sm");var l=t.comboButtonCls?t.comboButtonCls:"fa-caret-down",n='<input type="text" class="form-control"><span class="input-group-btn jl-comb-btn-group"><button class="btn btn-default btn-sm " tabindex="-1"><i class="fa '+l+'"></i></button></span>';i.html(n);var a=i.find('[type="text"]')[0];t.textCtrl=new e.ui.DBText(a,{type:"dbtext",dataset:t._dataset,field:t._textField||t._field,enableInvalidTip:!0,valueIndex:t._valueIndex,tabIndex:t._tabIndex,readOnly:t._textReadOnly}),jQuery(a).on("keydown",function(i){var l=i.which;l!==e.ui.KeyCode.BACKSPACE||this.value||t.buttonClick()}),jQuery(a).on("click",function(e){return t._textReadOnly&&t.buttonClick(),e.preventDefault(),e.stopImmediatePropagation(),!1}),t.addChildControl(t.textCtrl);var r=i.find("button");this.buttonClick&&(r.on("click",function(e){t.buttonClick(r[0])}),r.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),r.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}))},tableId:function($super,e){$super(e),this.textCtrl.tableId(e)},renderAll:function(){return this.refreshControl(),this},innerFocus:function(){var e=this;e._textReadOnly?jQuery(e.el).find("button").focus():e.textCtrl.focus()},doMetaChanged:function($super,e){$super(e);var t=this;if(!e||"disabled"==e||"readOnly"==e){var i=t._dataset.getField(t._field),l=i.disabled()||i.readOnly(),n=jQuery(t.el);n.find("button").attr("disabled",l)}},destroy:function($super){var e=this,t=e.el.childNodes[1];
t.onclick=null,jQuery(e.textCtrl.el).off("keydown",this.popupUp),e.textCtrl.destroy(),e.textCtrl=null,$super()}}),e.ui.DBAutoComplete=e.Class.create(e.ui.DBText,{MatchModes:["start","end","any"],initialize:function($super,e,t){var i=this;i.allProperties||(i.allProperties="styleClass,dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields"),i._lookupField=null,i._minChars=0,i._minDelay=0,i._beforePopup=null,i._filterFields=null,i._defaultFilterFields=null,i._onGetFilterField=null,i._matchMode="start",i._timeoutHandler=null,$super(e,t)},lookupField:function(t){return void 0===t?this._lookupField:(e.Checker.test("DBAutoComplete.lookupField",t).isString(),this._lookupField=t,this)},minChars:function(t){return void 0===t?this._minChars:(e.Checker.test("DBAutoComplete.minChars",t).isGTEZero(),this._minChars=parseInt(t),this)},minDelay:function(t){return void 0===t?this._minDelay:(e.Checker.test("DBAutoComplete.minDelay",t).isGTEZero(),this._minDelay=parseInt(t),this)},matchMode:function(t){if(void 0===t)return this._matchMode;t=jQuery.trim(t);var i=e.Checker.test("DBAutoComplete.matchMode",t).isString();return t=t.toLowerCase(),i.testValue(t).inArray(this.MatchModes),this._matchMode=t,this},filterFields:function(t){var i=this;return void 0===t?i._filterFields:(e.Checker.test("DBAutoComplete.filterFields",t).isString(),i._filterFields=t,this)},beforePopup:function(e){return void 0===e?this._beforePopup:(this._beforePopup=e,this)},onGetFilterField:function(e){return void 0===e?this._onGetFilterField:(this._onGetFilterField=e,this)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},doBlur:function(){var t=this;if(!t.el.disabled&&!t.el.readOnly){var i=t._dataset.getField(t._field);if(!i.readOnly()&&!i.disabled())if(t.contentPanel&&t.contentPanel.isShowing()){if(t._isSelecting)return;var l=t.el.value,n=!0;if(!t._lookupField){i=t._dataset.getField(t._field);var a=i.lookup(),r=a.dataset();l.length>0&&0===r.recordCount()&&(n=!1)}t.contentPanel&&t.contentPanel.isShowing()&&t.contentPanel.closePopup(),t.updateToDataset(),t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field)),n||t.el.focus()}else t.updateToDataset(),t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field))}},doChange:null,doKeydown:function(t){if(!this.disabled&&!this.readOnly){t=jQuery.event.fix(t||window.event);var i=t.which,l=this.jslet,n=e.ui.KeyCode;if(!(i>=n.F1&&i<=n.F12||i===n.SHIFT||i===n.CONTROL||i===n.ALT||i===n.CAPSLOCK||i===n.INSERT||i===n.HOME||i===n.END||i===n.PAGEUP||i===n.PAGEDOWN||i===n.LEFT||i===n.RIGHT)){if(i===n.ESCAPE&&l.contentPanel)return void l.contentPanel.closePopup();if(i!==n.UP&&i!==n.DOWN)return i===n.DELETE||i===n.BACKSPACE||i===n.IME?void l._invokePopup():void(i!==n.ENTER&&i!==n.TAB?l._invokePopup():l.contentPanel&&l.contentPanel.isShowing()&&l.contentPanel.confirmSelect());if(l.contentPanel&&l.contentPanel.isPop){var a=l._dataset.getField(l._lookupField||l._field),r=a.lookup(),s=r.dataset();i===n.UP&&(s.prior(),t.preventDefault(),t.stopImmediatePropagation()),i===n.DOWN&&(s.next(),t.preventDefault(),t.stopImmediatePropagation())}else l.tableId()||l._invokePopup()}}},doKeypress:function(e){this.disabled||this.readOnly},_invokePopup:function(){var e=this;e._timeoutHandler&&clearTimeout(e._timeoutHandler);var t=100;e._minDelay&&(t=parseInt(e._minDelay)),e._timeoutHandler=setTimeout(function(){e._populate(e.el.value)},t)},_getDefaultFilterFields:function(e){var t=this;if(t._defaultFilterFields)return t._defaultFilterFields;var i=e.codeField(),l=e.nameField(),n=e.dataset(),a=n.getField(i),r=n.getField(l),s=[];return a&&a.visible()&&s.push(i),i!=l&&r&&r.visible()&&s.push(l),t._defaultFilterFields=s,s},_getFilterFields:function(t,i){var l=this,n=null,a=e.getFunction(l._onGetFilterField);a&&(n=a.call(l,t.dataset(),i),e.Checker.test("DBAutoComplete.onGetFilterField#return",n).isString()),n=n||l._filterFields;var r;if(r=n?n.split(","):l._getDefaultFilterFields(t),0===r.length)throw new Error("Not specified [filter fields]!");var s=i;"start"==l._matchMode?s+="%":s="end"==l._matchMode?"%"+s:"%"+s+"%";for(var o,d="",u=0,c=r.length;c>u;u++)o=r[u],u>0&&(d+=" || "),d+="like(["+o+'],"'+s+'")';return d},_populate:function(i){var l=this;if(!(l._minChars>0&&i&&i.length<l._minChars)){var n=l._dataset.getField(l._lookupField||l._field),a=n.lookup();if(!a)return void console.error(l._field+" is NOT a lookup field!");var r=a.dataset(),s=r.autoRefreshHostDataset();r.autoRefreshHostDataset(!0);try{var o=a.editFilter(),d=e.getFunction(l._beforePopup);if(d)d.call(l,r,i,o);else if(i){var u=l._getFilterFields(a,i);o&&(u=u?"("+o+") && ("+u+")":o),r.filter(u),r.filtered(!0)}else o?(r.filter(o),r.filtered(!0)):(r.filter(null),r.fixedFilter()||r.filtered(!1))}finally{r.autoRefreshHostDataset(s)}if(l._lookupField){var c=l._dataset.getRecord();c&&(c[l._lookupField]=null)}if(l.contentPanel){if(l.contentPanel.isShowing())return}else l.contentPanel=new e.ui.DBAutoCompletePanel(l);var h=jQuery(l.el),f=h.offset(),p=h.outerHeight(),_=f.left,v=f.top+p;t.isRtl&&(_=_+h.outerWidth()-l.contentPanel.dlgWidth),l.contentPanel.showPopup(_,v,0,p)}},_destroyPopPanel:function(){var e=this;e.contentPanel&&(e.contentPanel.destroy(),e.contentPanel=null)},doLookupChanged:function(e){e&&this._destroyPopPanel()},destroy:function($super){this._destroyPopPanel(),jQuery(this.el).off(),$super()}}),e.ui.DBAutoCompletePanel=function(t){function i(){l.panel||(l.panel=document.createElement("div"),l.panel.style.width="100%",l.panel.style.height="100%",jQuery(l.panel).on("mousedown",function(e){l.comboCfg._isSelecting=!0,e.stopPropagation()}));var t=l.dataset.getField(l.field),i=t.lookup(),n=i.dataset();l.lkDataset=n;for(var a=n.getNormalFields(),r=0,s=0,o=a.length;o>s;s++)t=a[s],t.visible()&&(r+=t.displayWidth());var d=r*(e.global.defaultCharWidth||12)+30;l.dlgWidth=d,l.dlgWidth<150&&(l.dlgWidth=150),l.dlgWidth>500&&(l.dlgWidth=500),l.panel.innerHTML="";var u=(l.dlgWidth-4,l.dlgHeight-4),c={type:"DBTable",dataset:n,readOnly:!0,noborder:!0,hasSelectCol:!1,hasSeqCol:!1,hideHead:!0};return c.onRowClick=l.confirmSelect,l.otable=e.ui.createControl(c,l.panel,"100%",u),l.otable.el.focus(),l.otable.el.style.border="0",l.panel}var l=this;l.dlgWidth=320,l.dlgHeight=180;l.comboCfg=t,l.dataset=t.dataset(),l.field=t.lookupField()||t.field(),l.lkDataset=null,l.confirmSelect=function(){l.comboCfg._isSelecting=!0;var e=l.lkDataset.keyValue();(e||0===e)&&(l.dataset.setFieldValue(l.field,e,l.valueIndex),l.comboCfg.el.focus()),l.comboCfg.afterSelect&&l.comboCfg.afterSelect(l.dataset,l.lkDataset),l.closePopup()},l.showPopup=function(e,t,i,n){l.comboCfg._isSelecting=!1,l.isPop=!0,l.popup.show(e,t,l.dlgWidth,l.dlgHeight,i,n)},l.doClosePopup=function(){l.isPop=!1;var e=l.lkDataset.recno()||0;try{l.lkDataset.filter(null)}finally{e>=0&&l.lkDataset.recno(e)}},l.closePopup=function(){l.popup.hide()},l.isShowing=function(){return l.isPop},i(),l.popup=new e.ui.PopupPanel(t.el),l.popup.contentElement(l.panel),l.popup.onHidePopup(l.doClosePopup),l.isPop=!1,l.destroy=function(){jQuery(l.panel).off(),l.otable.onRowClick=null,l.otable.destroy(),l.otable=null,l.panel=null,l.popup.destroy(),l.popup=null,l.comboCfg=null,l.dataset=null,l.field=null,l.lkDataset=null}},e.ui.register("DBAutoComplete",e.ui.DBAutoComplete),e.ui.DBAutoComplete.htmlTemplate='<input type="text"></input>',e.ui.DBBetweenEdit=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",this._minEleId=null,this._maxEleId=null,$super(e,t)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},refreshControl:function(e){},renderAll:function(){var i=this;i.removeAllChildControls(),e.ui.textMeasurer.setElement(i.el);var l=t.Dataset.betweenLabel;l||(l="-"),l="&nbsp;"+l+"&nbsp;";var n=(i._dataset.getField(i._field),{});n.dataset=i._dataset.name(),n.field=i._field,n.type="DBPlace",n.valueIndex=0;var a='<div class="input-group"><div class="jl-btw-min" data-jslet=\''+JSON.stringify(n)+'\'></div><span class="input-group-addon jl-btw-separator">'+l+"</span>";n.valueIndex=1,a+='<div class="jl-btw-max" data-jslet=\''+JSON.stringify(n)+"'></div></div>",i.el.innerHTML=a,e.ui.install(i.el);var r=jQuery(i.el);return i._minEleId=r.find(".jl-btw-min")[0].id,i._maxEleId=r.find(".jl-btw-max")[0].id,this},tableId:function($super,t){$super(t),e("#"+this._minEleId).tableId(t),e("#"+this._maxEleId).tableId(t)},innerFocus:function(){e("#"+this._minEleId).focus()}}),e.ui.register("DBBetweenEdit",e.ui.DBBetweenEdit),e.ui.DBBetweenEdit.htmlTemplate="<div></div>",e.ui.DBCheckBox=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.isCheckBox=!0,i.allProperties="styleClass,dataset,field,beforeClick",i._beforeClick=null,i._skipRefresh=!1,jQuery(e).attr("type","checkbox"),$super(e,t)},beforeClick:function(t){return void 0===t?this._beforeClick:(e.Checker.test("DBCheckBox.beforeClick",t).isFunction(),this._beforeClick=t,this)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()},bind:function(){var t=this;t.renderAll(),t.el.name=t._field;var i=jQuery(t.el);i.hasClass("jl-dbcheck")||i.addClass("jl-dbcheck"),i.on("click",t._doClick),i.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),i.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),i.addClass("checkbox-inline form-control")},_doClick:function(e){var t=this.jslet;if(t._beforeClick){var i=t._beforeClick.call(t,t.el);if(!i)return}t.updateToDataset()},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t){var n=l.disabled()||l.readOnly();e.ui.setEditableStyle(i.el,n,n,!1,l.required()),i.setTabIndex()}t&&"tabIndex"!=t||i.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=(e._dataset.getField(e._field),e.getValue());t?e.el.checked=!0:e.el.checked=!1}},focus:function(){this.el.focus()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t=(e._dataset.getField(e._field),e.el.checked);e._keep_silence_=!0;try{e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function($super){jQuery(this.el).off(),$super()}}),e.ui.register("DBCheckBox",e.ui.DBCheckBox),e.ui.DBCheckBox.htmlTemplate='<input type="checkbox"></input>',e.ui.DBCheckBoxGroup=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,columnCount,hasSelectAllBox",i._columnCount=99999,i._hasSelectAllBox=!1,i._itemIds=null,$super(e,t)},columnCount:function(t){return void 0===t?this._columnCount:(e.Checker.test("DBCheckBoxGroup.columnCount",t).isGTEZero(),this._columnCount=parseInt(t),this)},hasSelectAllBox:function(e){return void 0===e?this._hasSelectAllBox:(this._hasSelectAllBox=!!e,this)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var t=this;t._dataset.getField(t._field);t.renderAll();var i=jQuery(t.el);i.on("keydown",function(i){var l,n,a,r=i.which;if(r===e.ui.KeyCode.LEFT){if(!t._itemIds||0===t._itemIds.length)return;if(n=document.activeElement,a=n&&n.id,l=t._itemIds.indexOf(a),0===l)return;document.getElementById(t._itemIds[l-1]).focus(),i.preventDefault(),i.stopImmediatePropagation()}else if(r===e.ui.KeyCode.RIGHT){if(!t._itemIds||0===t._itemIds.length)return;if(n=document.activeElement,a=n&&n.id,l=t._itemIds.indexOf(a),l===t._itemIds.length-1)return;document.getElementById(t._itemIds[l+1]).focus(),i.preventDefault(),i.stopImmediatePropagation()}}),i.on("click",'input[type="checkbox"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),i.on("focus",'input[type="checkbox"]',function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),i.on("blur",'input[type="checkbox"]',function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),i.addClass("form-control"),i.css("height","auto")},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t){var n=l.disabled(),a=l.readOnly();n=n||a;for(var r,s=jQuery(i.el).find('input[type="checkbox"]'),o=l.tabIndex(),d=l.required(),u=0,c=s.length;c>u;u++)r=s[u],e.ui.setEditableStyle(r,n,a,!1,d),r.tabIndex=o}},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t,i,l=jQuery(e.el).find('input[type="checkbox"]'),n=l.length;for(i=0;n>i;i++)t=l[i],jQuery(t).hasClass("jl-selectall")||(t.checked=!1);var a=e.getValue();if(a&&a.length>0){var r,s=a.length;for(i=0;n>i;i++){t=l[i];for(var o=0;s>o;o++)r=a[o],r==t.value&&(t.checked=!0)}}}},doLookupChanged:function(){var i=this,l=i._dataset.getField(i._field),n=l.lookup();if(!n)return void console.error(e.formatMessage(t.Dataset.lookupNotFound,[l.name()]));var a=n.dataset(),r=a.recordCount();if(0===r)return void(i.el.innerHTML=t.DBCheckBoxGroup.noOptions);i._itemIds=[];var s=['<table cellpadding="0" cellspacing="0">'],o=!1,d=n.editFilter();i._innerEditFilterExpr=null;var u=n.editItemDisabled();d&&(i._innerEditFilterExpr=new e.data.Expression(a,d));var c,h=!1,f=-1;i._hasSelectAllBox&&r>0&&(s.push("<tr>"),c=e.nextId(),s.push('<td style="white-space: nowrap;vertical-align:middle"><input type="checkbox" class="jl-selectall"'),s.push(' id="'),s.push(c),s.push('"/><label for="'),s.push(c),s.push('">'),s.push(t.DBCheckBoxGroup.selectAll),s.push("</label></td>"),f=0,i._itemIds.push(c)),i.el.innerHTML="";var p=a.recnoSilence();try{for(var _=0;r>_;_++){if(a.recnoSilence(_),h=!1,i._innerEditFilterExpr&&!i._innerEditFilterExpr.eval()){if(!u)continue;h=!0}f++,o=f%i._columnCount===0,o&&(f>0&&s.push("</tr>"),s.push("<tr>")),c=e.nextId(),i._itemIds.push(c),s.push('<td style="white-space: nowrap; "><input type="checkbox" value="'),s.push(a.getFieldValue(n.keyField())),s.push('" id="'),s.push(c),s.push('" '+(h?" disabled":"")+'/><label for="'),s.push(c),s.push('">'),s.push(n.getCurrentDisplayValue()),s.push("</label></td>"),o=f%i._columnCount===0}r>0&&s.push("</tr>"),s.push("</table>"),i.el.innerHTML=s.join("")}finally{a.recnoSilence(p)}i.doMetaChanged()},updateToDataset:function(i){var l=this;if(!l._is_silence_){var n,a,r,s=jQuery(l.el).find('input[type="checkbox"]');if(jQuery(i).hasClass("jl-selectall")){var o=i.checked;for(a=0,r=s.length;r>a;a++)n=s[a],n!=i&&(n.disabled||(n.checked=o))}var d=l._dataset.getField(l._field),u=d.valueCountLimit(),c=null;if(d.valueStyle()===e.data.FieldValueStyle.NORMAL){if(i.checked){for(a=0,r=s.length;r>a;a++)n=s[a],n===i||jQuery(n).hasClass("jl-selectall")||(n.checked=!1);c=i.value}}else{c=[];var h=0;for(a=0,r=s.length;r>a;a++)n=s[a],jQuery(n).hasClass("jl-selectall")||n.checked&&(c.push(n.value),h++);if(u&&h>u)return i.checked=!i.checked,void e.showInfo(e.formatMessage(t.DBCheckBoxGroup.invalidCheckedCount,[""+u]))}l._is_silence_=!0;try{l._dataset.setFieldValue(l._field,c)}finally{l._is_silence_=!1}}},innerFocus:function(){var e=this._itemIds;e&&e.length>0&&document.getElementById(e[0]).focus()},renderAll:function(){var t=this,i=jQuery(t.el);return i.hasClass("jl-checkboxgroup")||i.addClass("jl-checkboxgroup"),t.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),e.ui.register("DBCheckBoxGroup",e.ui.DBCheckBoxGroup),e.ui.DBCheckBoxGroup.htmlTemplate="<div></div>",e.ui.DBCKEditor=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,height",i._height=150,i._oldValue=null,i._editorId=null,i._editor=null,$super(e,t)},height:function(t){return void 0===t?this._height:(e.Checker.test("DBCKEditor.height",t).isGTZero(),this._height=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var t=this;if(!window.CKEDITOR)throw new Error("Not found CKEDITOR component! Goto for more: http://ckeditor.com/");var i=jQuery(t.el);i.addClass("jl-ckeditor");var l=e.nextId(),n='<textarea class="jl-hidden"></textarea>';i.html(n),i.children().attr("id",l).attr("name",t._field);var a=window.CKEDITOR.replace(l,{height:t._height});a.on("focus",jQuery.proxy(t._doFocus,t)),a.on("blur",jQuery.proxy(t._doBlur,t)),a.on("change",jQuery.proxy(t._doChange,t)),t._editor=a,t._editorId="#cke_"+l,t.renderAll()},_doFocus:function(){var t=this;e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex),jQuery(t._editorId).addClass("jl-focus")},_doBlur:function(){var t=this;jQuery(t._editorId).removeClass("jl-focus"),e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)},_doChange:function(){this.updateToDataset()},doMetaChanged:function($super,e){$super(e);var t=this,i=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var l=i.disabled()||i.readOnly();window.setTimeout(function(){t._editor.setReadOnly(l)},100)}if(e&&"required"==e){var n=jQuery(t.el);i.required()?n.addClass("jl-ctrl-required"):n.removeClass("jl-ctrl-required")}},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t,i=e.getFieldError();i&&i.message?(e.renderInvalid(i),t=i.inputText):(e.renderInvalid(null),t=e.getText()),e._editor.setData(t),e._editor.resetDirty(),e._oldValue=e.el.value}},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},innerFocus:function($super){this._editor.focus()},updateToDataset:function(){var t=this;if(!t._keep_silence_&&t._editor.checkDirty()){var i=t._editor.getData();if(t._oldValue!=i){t._dataset.editRecord(),t._keep_silence_=!0;try{t._dataset.setFieldText(t._field,i,t._valueIndex),t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field))}finally{t._keep_silence_=!1,t._editor.resetDirty()}var l=t.getFieldError();l&&l.message?t.renderInvalid(l):t.renderInvalid(null)}}},destroy:function($super){var e=this;jQuery(e.el).off(),e._editor=null,$super()}}),e.ui.register("DBCKEditor",e.ui.DBCKEditor),e.ui.DBCKEditor.htmlTemplate="<div></div>",e.ui.DBComboSelect=e.Class.create(e.ui.DBCustomComboBox,{showStyles:["auto","table","tree"],initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck,autoSelected",i._textField=null,i._showStyle="auto",i._popupWidth=300,i._popupHeight=300,i._contentPanel=null,i._pickupField=null,i._onGetSearchField=null,i._correlateCheck=!1,i._autoSelected=!0,$super(e,t)},textField:function(t){return void 0===t?this._textField:(e.Checker.test("DBComboSelect.textField",t).required().isString(),this._textField=t.trim(),this)},popupHeight:function(t){return void 0===t?this._popupHeight:(e.Checker.test("DBComboSelect.popupHeight",t).isGTEZero(),this._popupHeight=parseInt(t),this)},popupWidth:function(t){return void 0===t?this._popupWidth:(e.Checker.test("DBComboSelect.popupWidth",t).isGTEZero(),this._popupWidth=parseInt(t),this)},showStyle:function(t){if(void 0===t)return this._showStyle;t=jQuery.trim(t);var i=e.Checker.test("DBComboSelect.showStyle",t).isString();return t=t.toLowerCase(),i.testValue(t).inArray(this.showStyles),this._showStyle=t,this},onGetSearchField:function(e){return void 0===e?this._onGetSearchField:(this._onGetSearchField=e,this)},correlateCheck:function(e){return void 0===e?this._correlateCheck:(this._correlateCheck=e,this)},autoSelected:function(e){return void 0===e?this._autoSelected:(this._autoSelected=e,this)},isValidTemplateTag:function(e){return!0},afterBind:function($super){$super(),this._contentPanel&&(this._contentPanel=null)},buttonClick:function(i){var l=this,n=l.el,a=l._dataset.getField(l._field),r=a.lookup(),s=jQuery(n);if(!a.readOnly()&&!a.disabled()){if(null===r||void 0===r)throw new Error(l._field+" is NOT a lookup field!");var o=l._showStyle;"auto"==l._showStyle&&(o=r.parentField()?"tree":"table"),l._contentPanel||(l._contentPanel=new e.ui.DBComboSelectPanel(l,i),l._contentPanel.showStyle=o,l._contentPanel.customButtonLabel=l.customButtonLabel,l._contentPanel.onCustomButtonClick=l.onCustomButtonClick,l._popupWidth&&(l._contentPanel.popupWidth=l._popupWidth),l._popupHeight&&(l._contentPanel.popupHeight=l._popupHeight));var d=s.offset(),u=s.outerHeight(),c=d.left,h=d.top+u;t.isRtl&&(c+=s.outerWidth()),l._contentPanel.showPopup(c,h,0,u)}},closePopup:function(){var e=this;return e._contentPanel&&e._contentPanel.closePopup(),e._contentPanel=null,e.focus(),e},doLookupChanged:function(e){e&&this._destroyPopPanel()},_destroyPopPanel:function(){var e=this;e._contentPanel&&(e._contentPanel.destroy(),e._contentPanel=null)},destroy:function($super){this._destroyPopPanel(),$super()}}),e.ui.DBComboSelectPanel=function(t,i){var l=this;l.showStyle="auto",l.customButtonLabel=null,l.onCustomButtonClick=null,l.popupWidth=350,l.popupHeight=350,l._isShowing=!1;l.comboSelectObj=t,l.dataset=t._dataset,l.field=t._field,l.fieldObject=l.dataset.getField(l.field),l.panel=null,l.searchBoxEle=null,l._oldFilter=null,l._oldFiltered=null,l.popup=new e.ui.PopupPanel(i),l.popup.onHidePopup=function(){l._isShowing=!1,l._restoreLkDsEvent(),l.comboSelectObj&&l.comboSelectObj.focus()},l._confirmSelectDebounce=e.debounce(this._confirmSelect,50)},e.ui.DBComboSelectPanel.prototype={lookupDs:function(){return this.fieldObject.lookup().dataset()},isMultiple:function(){return this.fieldObject&&this.fieldObject.valueStyle()===e.data.FieldValueStyle.MULTIPLE},showPopup:function(i,l,n,a){var r=this;if(!r._isShowing){r._initSelected();var s=r.showStyle.toLowerCase();if(r.panel){var o=r.otree?r.otree:r.otable;o.dataset().addLinkedControl(o),window.setTimeout(function(){o.renderAll()},1)}else r.panel=r._create();var d=jQuery(r.panel);if(d.find(".jl-combopnl-head input").val(""),d.find(".jl-combopnl-head").hide(),"table"==s){for(var u,c=r.lookupDs().getNormalFields(),h=0,f=0,p=c.length;p>f;f++)u=c[f],u.visible()&&(h+=u.displayWidth());var _=h*(e.global.defaultCharWidth||12)+40;r.popupWidth=_,r.popupWidth<150&&(r.popupWidth=150),r.popupWidth>500&&(r.popupWidth=500)}r._setLookupDsEvent(),r._isShowing=!0,r.popup.contentElement(r.panel),r.popup.show(i,l,r.popupWidth,r.popupHeight,n,a),r._showTips(t.DBComboSelect.find),r._focus()}},closePopup:function(){var e=this;e.popup.hide();var t=e.otree?e.otree:e.otable;t&&t.dataset().removeLinkedControl(t),e.comboSelectObj.focus()},_setLookupDsEvent:function(){var t=this,i=t.dataset.getField(t.field),l=i.lookup(),n=l.dataset(),a=l.editFilter();if(a){var r=n.filter();t._oldFilter=r,t._oldFiltered=n.filtered(),r=r?"("+a+") && ("+r+")":a,n.filter(r),n.filtered(!0)}t.isMultiple()&&(t._oldLkDsCheckSelectable=null,l.onlyLeafLevel()&&(t._oldLkDsCheckSelectable=n.onCheckSelectable(),n.onCheckSelectable(function(){return!this.hasChildren()})),n=t.lookupDs(),t._oldLkDsListener=n.datasetListener(),n.datasetListener(function(i){t._oldLkDsListener&&t._oldLkDsListener.call(n,i),i===e.data.DatasetEvent.AFTERSELECT&&t._confirmSelectDebounce.call(t)}))},_restoreLkDsEvent:function(){var e=this,t=e.dataset.getField(e.field),i=t.lookup();if(i){var l=i.dataset();e.isMultiple()&&(l.onCheckSelectable(e._oldLkDsCheckSelectable?e._oldLkDsCheckSelectable:null),l.datasetListener(e._oldLkDsListener?e._oldLkDsListener:null)),e._oldFiltered&&l.filtered(e._oldFiltered),e._oldFilter&&l.filter(e._oldFilter)}},_create:function(){var t=this;t.panel||(t.panel=document.createElement("div"),t.panel.style.width="100%",t.panel.style.height="100%");var i=t.dataset.getField(t.field),l=i.lookup(),n=(l.parentField(),t.showStyle.toLowerCase()),a=t.lookupDs(),r=['<div class="jl-combopnl-tip" style="display:none"></div>','<div class=" col-xs-8 col-xs-offset-4 jl-combopnl-head">','<div class="input-group input-group-sm">','<input class="form-control" type="text" size="10"></input>','<span class="input-group-btn">','<button class="jl-combopnl-search btn btn-secondary" type="button"><i class="fa fa-search"></i></button>','<button class="jl-combopnl-closesearch btn btn-secondary" type="button"><i class="fa fa-times"></i></button>',"</span>","</div></div>",'<div class="jl-combopnl-content"></div>'];t.panel.innerHTML=r.join("");var s=jQuery(t.panel),o=s.find(".jl-combopnl-head");s.on("keydown",function(i){var l=i.which;return l===e.ui.KeyCode.ENTER&&t._confirmAndClose(),l===e.ui.KeyCode.ESCAPE&&t.closePopup(),i.ctrlKey&&l===e.ui.KeyCode.F?(s.find(".jl-combopnl-head").slideDown(),t.searchBoxEle.focus(),i.preventDefault(),i.stopImmediatePropagation(),!1):void 0}),t.searchBoxEle=o.find("input")[0],jQuery(t.searchBoxEle).on("keydown",function(e){e=jQuery.event.fix(e||window.event),13==e.which&&t._findData(e.currentTarget)}),s.find(".jl-combopnl-closesearch").click(function(){s.find(".jl-combopnl-head").slideUp(),t._focus()}),s.find(".jl-combopnl-search").click(function(){t._findData(t.searchBoxEle)});var d=s.find(".jl-combopnl-content")[0];if("tree"==n){var u={type:"DBTreeView",dataset:a,readOnly:!1,displayFields:l.displayFields(),hasCheckBox:t.isMultiple(),expandLevel:1};t.isMultiple()||(u.onItemClick=jQuery.proxy(t._confirmAndClose,t)),u.correlateCheck=t.comboSelectObj.correlateCheck(),window.setTimeout(function(){t.otree=e.ui.createControl(u,d,"100%","100%")},1)}else{var c={type:"DBTable",dataset:a,readOnly:!0,hasSelectCol:t.isMultiple(),hasSeqCol:!1,hasFindDialog:!1,hasFilterDialog:!1};t.isMultiple()||(c.onRowClick=jQuery.proxy(t._confirmAndClose,t)),window.setTimeout(function(){t.otable=e.ui.createControl(c,d,"100%","100%")},1)}return t.panel},_initSelected:function(){var t=this,i=t.comboSelectObj.getValue(),l=t.lookupDs(),n=t.dataset.getField(t.field),a=n.lookup();if(a.onlyLeafLevel()&&l.onCheckSelectable(function(){return!this.hasChildren()}),!t.isMultiple())return void(i&&l.findByKey(i));l.disableControls();try{if(l.selectAll(!1),i){var r=i;e.isArray(i)||(r=i.split(e.global.valueSeparator));for(var s=0,o=r.length;o>s;s++)l.selectByKeyValue(!0,r[s])}}finally{l.enableControls()}},_findData:function(i){var l=this,n=l.comboSelectObj.searchField,a=this.searchBoxEle.value;if(a){var r=e.getFunction(l.comboSelectObj.onGetSearchField);r&&(n=r.call(a));var s=null,o=l.lookupDs();if(n)s=n.split(",");else{s=[];for(var d,u=o.getNormalFields(),c=0,h=u.length;h>c;c++)d=u[c],d.visible()&&s.push(d.name())}if(!s||0===s.length)return void console.warn("Search field NOT specified! Can't search data!");var f=o.recno()+1,p={startRecno:f,findingByText:!0,matchType:"any"},_=o.findByField(s,a,p);_||(p.startRecno=0,_=o.findByField(s,a,p)),_&&_.isEqual&&l.comboSelectObj.autoSelected()&&o.select(!0),_||l._showTips(t.DBComboSelect.notFound),i&&i.focus()}},_focus:function(){var e=this;window.setTimeout(function(){var t=e.otable||e.otree;t&&t.el.focus()},10)},_showTips:function(e){var t=jQuery(this.panel);t.find(".jl-combopnl-tip").html(e).slideDown(),window.setTimeout(function(){t.find(".jl-combopnl-tip").slideUp()},1500)},_confirmSelect:function(){var e=this,i=e.comboSelectObj.getValue(),l=e.dataset.getField(e.field),n=l.lookup(),a=e.isMultiple(),r=e.lookupDs();if(a)i=r.selectedKeyValues();else{if(r.hasChildren()&&n.onlyLeafLevel())return e._showTips(t.DBComboSelect.cannotSelect),!1;i=r.keyValue()}return e.dataset.setFieldValue(e.field,i,e._valueIndex),!a&&e.comboSelectObj._afterSelect&&e.comboSelectObj._afterSelect(e.dataset,r),!0},_confirmAndClose:function(){this._confirmSelect()&&this.closePopup()},destroy:function(){var e=this;e._restoreLkDsEvent(),e.otree&&(e.otree.destroy(),e.otree=null),e.otable&&(e.otable.destroy(),e.otable=null),e.comboSelectObj=null,jQuery(e.searchBoxEle).off(),e.fieldObject=null,e.searchBoxEle=null,e.popup.destroy(),e.popup=null,e.panel=null}},e.ui.register("DBComboSelect",e.ui.DBComboSelect),e.ui.DBComboSelect.htmlTemplate="<div></div>",e.ui.DBDataLabel=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",$super(e,t)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control-static jl-datalabel jl-lbl-normal")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this,t=(e._dataset.getField(e._field),e.getText());e.el.innerHTML=t,e.el.title=t},doLookupChanged:function(){this.doValueChanged()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},canFocus:function(){return!1}}),e.ui.register("DBDataLabel",e.ui.DBDataLabel),e.ui.DBDataLabel.htmlTemplate="<label></label>",e.ui.DBDatePicker=e.Class.create(e.ui.DBCustomComboBox,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,textReadOnly,popupWidth,popupHeight",i._popupWidth=260,i._popupHeight=226,i.popup=null,i.comboButtonCls="fa-calendar",$super(e,t)},popupHeight:function(t){return void 0===t?this._popupHeight:(e.Checker.test("DBDatePicker.popupHeight",t).isGTEZero(),this._popupHeight=parseInt(t),this)},popupWidth:function(t){return void 0===t?this._popupWidth:(e.Checker.test("DBDatePicker.popupWidth",t).isGTEZero(),this._popupWidth=parseInt(t),this)},isValidTemplateTag:function(e){return!0},buttonClick:function(i){var l=this.el,n=this,a=n._dataset.getField(n._field),r=jQuery(l);if(!a.readOnly()&&!a.disabled()){var s=n._popupWidth,o=n._popupHeight,d=n.getValue(),u=a.dataRange(),c=null,h=null;u&&(u.min&&(c=u.min),u.max&&(h=u.max)),n.contentPanel||(n.contentPanel=e.ui.createControl({type:"Calendar",value:d,minDate:c,maxDate:h,onDateSelected:function(e){n._dataset.setFieldValue(n._field,new Date(e.getTime()),n._valueIndex),n.popup.hide();try{n.el.focus()}catch(t){}}},null,s+"px",o+"px",!0),n.popup=new e.ui.PopupPanel(i),n.popup.onHidePopup=function(){n.focus()},n.popup.contentElement(n.contentPanel.el));var f=r.offset(),p=r.outerHeight(),_=f.left,v=f.top+p;t.isRtl&&(_+=r.outerWidth()),n.contentPanel.el.style.display="block",n.popup.show(_,v,s+3,o+3,0,p),n.contentPanel.focus(),n.contentPanel.setValue(d)}},destroy:function($super){var e=this;e.contentPanel&&(e.contentPanel.destroy(),e.contentPanel=null),e.popup&&(e.popup.destroy(),e.popup=null),$super()}}),e.ui.register("DBDatePicker",e.ui.DBDatePicker),e.ui.DBDatePicker.htmlTemplate="<div></div>",e.ui.DBHtml=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",$super(e,t)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this.getText();this.el.innerHTML=e},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},canFocus:function(){return!1}}),e.ui.register("DBHtml",e.ui.DBHtml),e.ui.DBHtml.htmlTemplate='<div style="width:200px;height:200px"></div>',e.ui.DBImage=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,locked,baseUrl,altField,enableViewer,viewUrlField",i._locked=!1,i._baseUrl=null,i._altField=null,i._enableViewer=!1,i._viewUrlField=null,$super(e,t)},baseUrl:function(t){return void 0===t?this._baseUrl:(t=jQuery.trim(t),e.Checker.test("DBImage.baseUrl",t).isString(),this._baseUrl=t,this)},enableViewer:function(e){return void 0===e?this._enableViewer:(this._enableViewer=!!e,this)},viewUrlField:function(t){return void 0===t?this._viewUrlField:(t=jQuery.trim(t),e.Checker.test("DBImage.viewUrlField",t).isString(),this._viewUrlField=t,this)},altField:function(t){return void 0===t?this._altField:(t=jQuery.trim(t),e.Checker.test("DBImage.altField",t).isString(),this._altField=t,this)},locked:function(e){return void 0===e?this._locked:(this._locked=e,this)},isValidTemplateTag:function(e){return"img"==e.tagName.toLowerCase();
},bind:function(){var t=this;t.renderAll();var i=jQuery(t.el);i.addClass("img-responsive img-rounded"),e.ui.ImageViewer&&i.on("click",function(){if(!t._locked&&t._enableViewer&&t._dataset&&t._field&&0!==t._dataset.recordCount()&&t._dataset.getFieldValue(t._field)){var i=new e.ui.ImageViewer;i.show(t._getImgUrl(!0))}})},_getImgUrl:function(e){var t,i=this;return e&&i._viewUrlField?(t=i._dataset.getFieldValue(i._viewUrlField),t||(t=i.getValue())):t=i.getValue(),t?i._baseUrl&&(t=i._baseUrl+t):t="",t},doValueChanged:function(){var e=this;e._dataset.getField(e._field);if(e._locked)return e.el.alt=t.DBImage.lockedImageTips,void(e.el.src="");var i=e._getImgUrl();if(e.el.src!=i){var l=i;e._altField&&(l=e._dataset.getFieldText(e._altField)),e.el.alt=l||"",e.el.src=i}},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},canFocus:function(){return!1}}),e.ui.register("DBImage",e.ui.DBImage),e.ui.DBImage.htmlTemplate="<img></img>",e.ui.DBLabel=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",this.isLabel=!0,$super(e,t)},bind:function(){jQuery(this.el).addClass("control-label"),this.renderAll()},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doMetaChanged:function(t){if(!(t&&e.ui.DBLabel.METANAMES.indexOf(t)<0)){var i=this,l=i._fieldMeta,n=i._dataset.getField(i._field),a="";if(!n)throw new Error("Field: "+this._field+" NOT exist!");var r=jQuery(i.el);if(!(l&&"label"!=l||t&&"label"!=t&&"required"!=t))return n.required()&&(a+='<span class="jl-lbl-required">'+e.ui.DBLabel.REQUIREDCHAR+"</span>"),a+=n.displayLabel()||"",r.html(a),void(i.el.title=r.text());if(l&&"tip"==l&&(!t||t==l))return a=n.tip()||"",r.html(a),void(i.el.title=r.text());if(l&&"error"==l&&t&&t==l){var s=i.getFieldError();return a=s&&s.message||"",r.html(a),void(i.el.title=r.text())}}},renderAll:function(){var t=jQuery(this.el),i=this.fieldMeta();return this.refreshControl(e.data.RefreshEvent.updateAllEvent()),"error"==i?t.hasClass("jl-lbl-error")||t.addClass("jl-lbl-error"):"tip"==i?t.hasClass("jl-lbl-tip")||t.addClass("jl-lbl-tip"):t.hasClass("jl-lbl")||t.addClass("jl-lbl"),this}}),e.ui.DBLabel.REQUIREDCHAR="*",e.ui.DBLabel.METANAMES=["label","required","tip","error"],e.ui.register("DBLabel",e.ui.DBLabel),e.ui.DBLabel.htmlTemplate="<label></label>",e.ui.DBList=e.Class.create(e.ui.DBFieldControl,{showStyles:["auto","table","tree"],initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,showStyle,correlateCheck",i._showStyle="auto",i._correlateCheck=!1,$super(e,t)},showStyle:function(t){if(void 0===t)return this._showStyle;t=jQuery.trim(t);var i=e.Checker.test("DBComboSelect.showStyle",t).isString();return t=t.toLowerCase(),i.testValue(t).inArray(this.showStyles),this._showStyle=t,this},correlateCheck:function(e){return void 0===e?this._correlateCheck:(this._correlateCheck=e,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.renderAll()},renderAll:function(){var t=this,i=jQuery(t.el);i.hasClass("jl-dblist")&&i.addClass("jl-dblist");var l=t._dataset.getField(t._field),n=l.lookup(),a=n.parentField(),r=t._showStyle.toLowerCase(),s=n.dataset(),o=l.valueStyle()===e.data.FieldValueStyle.MULTIPLE;if("auto"==r&&a&&(r="tree"),"tree"==r){var d={type:"DBTreeView",dataset:s,readOnly:!1,displayFields:n.displayFields(),hasCheckBox:o,correlateCheck:t._correlateCheck,expandLevel:99};o?d.afterCheckBoxClick=function(){t.updateToDataset()}:d.onItemClick=function(){t.updateToDataset()},window.setTimeout(function(){e.ui.createControl(d,t.el,"100%","100%"),jQuery(t.el.childNodes[0]).on("focus",function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}).on("blur",function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)})},1)}else{var u={type:"DBTable",dataset:s,readOnly:!0,hasSelectCol:o,hasSeqCol:!1,hasFindDialog:!1,hasFilterDialog:!1};o?u.afterSelect=u.afterSelectAll=function(){t.updateToDataset()}:u.onRowClick=function(){t.updateToDataset()},window.setTimeout(function(){e.ui.createControl(u,t.el,"100%","100%")},1)}return this},doMetaChanged:function($super,e){$super(e);var t=this,i=t._dataset.getField(t._field);if(e&&"disabled"!=e&&"readOnly"!=e?t.el.disabled=!1:t.el.disabled=!0,e&&"required"==e){var l=jQuery(t.el);i.required()?l.addClass("jl-ctrl-required"):l.removeClass("jl-ctrl-required")}e&&"tabIndex"!=e||t.setTabIndex()},updateToDataset:function(){var t=this;if(t._keep_silence_)return!0;var i,l=t._dataset.getField(t._field),n=l.lookup(),a=n.dataset(),r=l.valueStyle()===e.data.FieldValueStyle.MULTIPLE;i=r?a.selectedKeyValues():a.keyValue(),t._dataset.editRecord(),t._keep_silence_=!0;try{t._dataset.setFieldValue(t._field,i,t._valueIndex),t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field))}finally{t._keep_silence_=!1}return!0},doValueChanged:function(){var t=this;if(!t._keep_silence_){var i=t.getFieldError();if(i&&i.message)return t.el.value=i.inputText||"",void t.renderInvalid(i);t.renderInvalid(null);var l=t._dataset.getField(t._field),n=l.getValue(),a=l.lookup(),r=(a.parentField(),a.dataset()),s=l.valueStyle()===e.data.FieldValueStyle.MULTIPLE;if(s){var o=r.recno();r.disableControls();try{if(r.selectAll(!1),n)for(var d=0,u=n.length;u>d;d++)r.findByKey(n[d]),r.selected(!0)}finally{r.recno(o),r.enableControls()}}else r.findByKey(n)}},destroy:function($super){$super()}}),e.ui.register("DBList",e.ui.DBList),e.ui.DBList.htmlTemplate="<div></div>",e.ui.DBLookupLabel=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,lookupField,returnField,lookupValue",i.requiredProperties="lookupValue,lookupField,returnField",i._lookupField=null,i._lookupValue=null,i._returnField=null,$super(e,t)},lookupField:function(t){return void 0===t?this._lookupField:(e.Checker.text("lookupField",t).required().isString(),this._lookupField=t,this)},lookupValue:function(t){return void 0===t?this._lookupValue:(e.Checker.text("lookupValue",t).required(),this._lookupValue=t,this)},returnField:function(t){return void 0===t?this._returnField:(e.Checker.text("returnField",t).required().isString(),this._returnField=t,this)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},refreshControl:function(t,i){if(t.eventType==e.data.RefreshEvent.UPDATEALL&&i){var l=this,n=l.dataset.lookup(l._lookupField,l._lookupValue,l._returnField);null===n&&(n="NOT found: "+l._lookupValue),l.el.innerHTML=n}},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent,!0),this},canFocus:function(){return!1}}),e.ui.register("DBLookupLabel",e.ui.DBLookupLabel),e.ui.DBLookupLabel.htmlTemplate="<label></label>",e.ui.DBRadioGroup=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,columnCount",i._columnCount=99999,i._itemIds=null,$super(e,t)},columnCount:function(t){return void 0===t?this._columnCount:(e.Checker.test("DBRadioGroup.columnCount",t).isGTEZero(),this._columnCount=parseInt(t),this)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var t=this;t.renderAll();var i=jQuery(t.el);i.on("keydown",function(i){var l,n,a,r=i.which;if(r===e.ui.KeyCode.LEFT){if(!t._itemIds||0===t._itemIds.length)return;if(n=document.activeElement,a=n&&n.id,l=t._itemIds.indexOf(a),0===l)return;document.getElementById(t._itemIds[l-1]).focus(),i.preventDefault(),i.stopImmediatePropagation()}else if(r===e.ui.KeyCode.RIGHT){if(!t._itemIds||0===t._itemIds.length)return;if(n=document.activeElement,a=n&&n.id,l=t._itemIds.indexOf(a),l===t._itemIds.length-1)return;document.getElementById(t._itemIds[l+1]).focus(),i.preventDefault(),i.stopImmediatePropagation()}}),i.on("click",'input[type="radio"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),i.on("focus",'input[type="radio"]',function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),i.on("blur",'input[type="radio"]',function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),i.addClass("form-control"),i.css("height","auto")},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t){var n=l.disabled(),a=l.readOnly();i.disabled=n||a,n=i.disabled;for(var r,s=jQuery(i.el).find('input[type="radio"]'),o=l.required(),d=l.tabIndex(),u=0,c=s.length;c>u;u++)r=s[u],e.ui.setEditableStyle(r,n,a,!1,o),r.tabIndex=d}},doValueChanged:function(){var e=this;if(!e._keep_silence_)for(var t,i=e.getValue(),l=jQuery(e.el).find('input[type="radio"]'),n=0,a=l.length;a>n;n++)t=l[n],t.checked=i==jQuery(t.parentNode).attr("value")},doLookupChanged:function(){var i=this,l=i._dataset.getField(i._field),n=l.lookup();if(!n)return void console.error(e.formatMessage(t.Dataset.lookupNotFound,[l.name()]));var a=n.dataset(),r=a.recordCount();if(0===r)return void(i.el.innerHTML=t.DBRadioGroup.noOptions);var s=a.recno();try{var o,d=['<table cellpadding="0" cellspacing="0">'],u=!1,c=n.editFilter();i._innerEditFilterExpr=null;var h=n.editItemDisabled();c&&(i._innerEditFilterExpr=new e.data.Expression(a,c));var f=!1,p=-1;i._itemIds=[];for(var _=0;r>_;_++){if(a.recnoSilence(_),f=!1,i._innerEditFilterExpr&&!i._innerEditFilterExpr.eval()){if(!h)continue;f=!0}p++,u=p%i._columnCount===0,u&&(p>0&&d.push("</tr>"),d.push("<tr>")),o=e.nextId(),i._itemIds.push(o),d.push('<td style="white-space: nowrap;vertical-align:middle" value="'),d.push(a.getFieldValue(n.keyField())),d.push('"><input name="'),d.push(i._field),d.push('" type="radio" id="'),d.push(o),d.push('" '+(f?" disabled":"")+'/><label for="'),d.push(o),d.push('">'),d.push(n.getCurrentDisplayValue()),d.push("</label></td>")}r>0&&d.push("</tr>"),d.push("</table>"),i.el.innerHTML=d.join("")}finally{a.recnoSilence(s)}i.doMetaChanged()},updateToDataset:function(e){var t=this;if(!t._keep_silence_&&!t.disabled){t._keep_silence_=!0;try{t._dataset.setFieldValue(t._field,jQuery(e.parentNode).attr("value")),e.checked=!0}finally{t._keep_silence_=!1}}},innerFocus:function(){var e=this._itemIds;e&&e.length>0&&document.getElementById(e[0]).focus()},renderAll:function(){var t=this,i=jQuery(t.el);return i.hasClass("jl-radiogroup")||i.addClass("jl-radiogroup"),t.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),e.ui.register("DBRadioGroup",e.ui.DBRadioGroup),e.ui.DBRadioGroup.htmlTemplate="<div></div>",e.ui.DBRangeSelect=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,beginItem,endItem,step",i.requiredProperties||(i.requiredProperties="field,beginItem,endItem,step"),i._beginItem=0,i._endItem=10,i._step=1,$super(e,t)},beginItem:function(t){return void 0===t?this._beginItem:(e.Checker.test("DBRangeSelect.beginItem",t).isNumber(),this._beginItem=parseInt(t),this)},endItem:function(t){return void 0===t?this._endItem:(e.Checker.test("DBRangeSelect.endItem",t).isNumber(),this._endItem=parseInt(t),this)},step:function(t){return void 0===t?this._step:(e.Checker.test("DBRangeSelect.step",t).isNumber(),this._step=parseInt(t),this)},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var t=this,i=t._dataset.getField(t._field),l=i.valueStyle();t.el.multiple&&l!=e.data.FieldValueStyle.MULTIPLE?i.valueStyle(e.data.FieldValueStyle.MULTIPLE):l!=e.data.FieldValueStyle.MULTIPLE||t.el.multiple||(t.el.multiple="multiple"),t.renderAll(),t.el.name=t._field;var n=jQuery(t.el);n.on("change",t._doChanged),n.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),n.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),t.el.multiple&&n.on("click","option",function(){t._currOption=this}),n.addClass("form-control")},_doChanged:function(i){var l=this.jslet;if(l.el.multiple){l.inProcessing&&(l.inProcessing=!1);var n=l._dataset.getField(l._field),a=n.valueCountLimit();if(a){var r=l.getValue(),s=1;if(e.isArray(r)&&(s=r.length),s>=a)return e.showInfo(e.formatMessage(t.DBCheckBoxGroup.invalidCheckedCount,[""+a])),void window.setTimeout(function(){l._currOption&&(l.inProcessing=!0,l._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},renderOptions:function(){var e=this,t=[],i=e._dataset.getField(e._field);i.required()||(t.push('<option value="_null_">'),t.push(i.nullText()),t.push("</option>"));for(var l=e._beginItem;l<=e._endItem;l+=e._step)t.push('<option value="'),t.push(l),t.push('">'),t.push(l),t.push("</option>");jQuery(e.el).html(t.join(""))},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t){var n=l.disabled()||l.readOnly();i.el.disabled=n,e.ui.setEditableStyle(i.el,n,n,!0,l.required())}t&&"tabIndex"!=t||i.setTabIndex()},doValueChanged:function(){var e=this;if(!e._keep_silence_)if(e.el.multiple){var t,i,l,n=e.getValue(),a=e.el.options.length;e._keep_silence_=!0;try{for(l=0;a>l;l++)t=e.el.options[l],t&&(t.selected=!1);var r,s=n.length-1;for(l=0;a>l;l++)for(t=e.el.options[l],r=s;r>=0;r--)i=n[r]==t.value,i&&(t.selected=i)}finally{e._keep_silence_=!1}}else{var o=e.getValue();null!==o?e.el.value=o:e.el.value=null}},focus:function(){return this.el.focus(),this},renderAll:function(){return this.renderOptions(),this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t,i=e.el.multiple;if(i){var l,n=jQuery(e.el).find("option"),a=n.length-1;t=[];for(var r=0;a>=r;r++)l=n[r],l.selected&&t.push(l.value)}else{t=e.el.value;var s=e._dataset.getField(e._field);"_null_"!=t||s.required()||(t=null)}e._keep_silence_=!0;try{i?e._dataset.setFieldValue(e._field,t):e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function($super){jQuery(this.el).off(),$super()}}),e.ui.register("DBRangeSelect",e.ui.DBRangeSelect),e.ui.DBRangeSelect.htmlTemplate="<select></select>",e.ui.DBRating=e.Class.create(e.ui.Rating,{_isDBControl:!0,initialize:function($super,e,t){$super(e,t),this.refreshControl()},doMetaChanged:function($super,e){$super(e);var t=this,i=t._dataset.getField(t._field);e&&"disabled"!=e&&"readOnly"!=e||(t._readOnly=i.disabled()||i.readOnly()),e&&"required"!=e||(t._required=i.required())},doValueChanged:function(){var e=this,t=(e._dataset.getField(e._field),e.getValue());e._value=t,e._setValue(t)},doUIChanged:function(){var e=this;e._dataset.setFieldValue(e._field,e.value(),e._valueIndex)}}),e.ui.register("DBRating",e.ui.DBRating),e.ui.DBRating.htmlTemplate="<Div></Div>",e.ui.DBSelect=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,groupField,lookupDataset",i._groupField=null,i._lookupDataset=null,i._enableInvalidTip=!0,i._innerEditFilterExpr=null,i._isRendering=!1,$super(e,t)},groupField:function(t){return void 0===t?this._groupField:(t=jQuery.trim(t),e.Checker.test("DBSelect.groupField",t).isString(),this._groupField=t,this)},lookupDataset:function(t){return void 0===t?this._lookupDataset:(e.isString(t)&&(t=e.data.getDataset(jQuery.trim(t))),e.Checker.test("DBSelect.lookupDataset",t).isClass(e.data.Dataset.className),this._lookupDataset=t,this)},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var t=this,i=t._dataset.getField(t._field),l=i.valueStyle();t.el.multiple&&l!=e.data.FieldValueStyle.MULTIPLE?i.valueStyle(e.data.FieldValueStyle.MULTIPLE):l!=e.data.FieldValueStyle.MULTIPLE||t.el.multiple||(t.el.multiple="multiple"),t.renderAll(),t.el.name=t._field;var n=jQuery(t.el);n.on("change",t._doChanged),n.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),n.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),t.el.multiple&&n.on("click","option",t._doCheckLimitCount),n.addClass("form-control input-sm"),t.doMetaChanged("required")},_doChanged:function(i){var l=this.jslet;if(l.el.multiple){l.inProcessing&&(l.inProcessing=!1);var n=l._dataset.getField(l._field),a=n.valueCountLimit();if(a){var r=l._dataset.getFieldValue(l._field),s=1;if(e.isArray(r)&&(s=r.length),s>=a)return e.showInfo(e.formatMessage(t.DBCheckBoxGroup.invalidCheckedCount,[""+a])),void window.setTimeout(function(){l._currOption&&(l.inProcessing=!0,l._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},_doCheckLimitCount:function(e){var t=e.delegateTarget.jslet;t._currOption=this},_setDefaultValue:function(e,t){if(t&&e.required()){var i=e.defaultValue();if(i){var l=e.lookup().dataset(),n=l.findByKey(i);if(n)return;i=null}i||e.defaultValue(t),this._dataset.changedStatus()&&!e.getValue()&&e.setValue(t)}},doLookupChanged:function(){var i=this;if(!i._isRendering){var l=i._dataset.getField(i._field),n=l.lookup();if(i._lookupDataset)n=new e.data.FieldLookup(l,{dataset:i._lookupDataset});else if(!n)return;i._isRendering=!0;var a,r,s=n.dataset(),o=!1;if(i._groupField){if(r=s.getField(i._groupField),null===r)throw"NOT found field: "+i._groupField+" in "+s.name();s.indexFields(i._groupField)}var d,u,c=null,h=[];i.el.multiple||l.required()||(h.push('<option value="_null_">'),h.push(l.nullText()),h.push("</option>"));var f,p=s.recno(),_=null,v=n.editFilter();i._innerEditFilterExpr=null;var m=n.editItemDisabled();v&&(i._innerEditFilterExpr=new e.data.Expression(s,v));var g=!1,C=0;try{for(var b=0,y=s.recordCount();y>b;b++){if(s.recnoSilence(b),g=!1,i._innerEditFilterExpr&&!i._innerEditFilterExpr.eval()){if(!m)continue;g=!0}if(i._groupField&&(d=s.getFieldValue(i._groupField),d!=c)){if(null!==c&&h.push("</optgroup>"),o){if(!a.dataset().findByField(a.keyField(),d))throw"Not found: ["+d+"] in Dataset: ["+a.dataset().name()+"]field: ["+a.keyField()+"]";u=a.getCurrentDisplayValue()}else u=d;h.push('<optgroup label="'),h.push(u),h.push('">'),c=d}h.push('<option value="'),f=s.getFieldValue(n.keyField()),null===_&&(_=f),h.push(f),h.push('"'+(g?" disabled":"")+">"),h.push(n.getCurrentDisplayValue()),h.push("</option>"),C++}null!==c&&h.push("</optgroup>"),C>100&&console.warn(l.label()+"("+i._field+"): "+t.DBSelect.moreLookupRecords),jQuery(i.el).html(h.join("")),i._setDefaultValue(l,_),i.doValueChanged()}finally{i._isRendering=!1,s.recnoSilence(p)}}},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t){var n=l.disabled()||l.readOnly();i.el.disabled=n,e.ui.setEditableStyle(i.el,n,n,!0,l.required())}if(t&&"required"==t){var a=jQuery(i.el);l.required()?a.addClass("jl-ctrl-required"):a.removeClass("jl-ctrl-required")}t&&"tabIndex"!=t||i.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText,void e.renderInvalid(t);e.renderInvalid(null);var i=e.getValue();if(e.el.multiple||i!==e.el.value){var l,n,a=e.el.options.length;for(l=0;a>l;l++)n=e.el.options[l],n&&(n.selected=!1);var r=e._dataset.getField(e._field);if(e.el.multiple){var s=i;if(null===s||0===s.length)return;var o,d=s.length-1;e._skipRefresh=!0;try{for(l=0;a>l;l++){n=e.el.options[l];for(var u=d;u>=0;u--)o=s[u]==n.value,o&&(n.selected=o)}}finally{e._skipRefresh=!1}}else e._checkOptionEditable(r,i)||(i=null),null===i&&(r.required()||(i="_null_")),e.el.value=i}}},_checkOptionEditable:function(e,t){var i=this;if(!i._innerEditFilterExpr||null===t||void 0===t||""===t)return!0;var l=e.lookup().dataset();return!l.findByKey(t)||i._innerEditFilterExpr.eval()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},updateToDataset:function(){var e=this;if(!e._skipRefresh){var t,i,l=e.el.multiple;if(l){var n=jQuery(e.el).find("option"),a=n.length-1;i=[];for(var r=0;a>=r;r++)t=n[r],t.selected&&i.push(t.value?t.value:t.innerHTML)}else i=e.el.value,i||(t=e.el.options[e.el.selectedIndex],i=t.innerHTML);e._skipRefresh=!0;try{e._dataset.editRecord();var s=!1;if(l)e._dataset.setFieldValue(e._field,i),i!=e._dataset.getFieldValue(e._field)&&(s=!0);else{var o=e._dataset.getField(e._field);"_null_"!=i||o.required()||(i=null),e._dataset.setFieldValue(e._field,i,e._valueIndex),i!=e._dataset.getFieldValue(e._field,e._valueIndex)&&(s=!0)}s&&(e._skipRefresh=!1,e.doValueChanged())}finally{e._skipRefresh=!1}}},destroy:function($super){this._currOption=null,jQuery(this.el).off(),$super()}}),e.ui.register("DBSelect",e.ui.DBSelect),e.ui.DBSelect.htmlTemplate="<select></select>",e.ui.DBSelectView=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,displayFields,groupField",i._groupField=null,i._displayFields=null,i._innerEditFilterExpr=null,i._isRendering=!1,$super(e,t)},groupField:function(t){return void 0===t?this._groupField:(t=jQuery.trim(t),e.Checker.test("DBSelectView.groupField",t).isString(),this._groupField=t,this)},displayFields:function(t){if(void 0===t){var i=this._displayFields;if(i)return this._dataset.getField(i)?"["+i+"]":i;var l=this._dataset,n=l.nameField()||l.codeField()||l.keyField();if(n)return"["+n+"]";e.Checker.test("DBSelectView.displayFields",n).required()}return t=jQuery.trim(t),e.Checker.test("DBSelectView.displayFields",t).required().isString(),this._displayFields=t,this._innerDisplayFieldsExpr=null,this},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("change",e._doChanged),t.addClass("form-control input-sm")},_doChanged:function(e){this.jslet._dataset.recno(parseInt(this.value))},_renderOptions:function(){var i=this;if(!i._isRendering){i._isRendering=!0;var l,n,a=i.dataset(),r=!1;if(i._groupField){if(n=a.getField(i._groupField),null===n)throw"NOT found field: "+i._groupField+" in "+a.name();a.fixedIndexFields(i._groupField)}var s,o,d=null,u=[],c=a.recno(),h=i.displayFields();e.Checker.test("DBSelectView.displayFields",h).required().isString(),i._innerDisplayFieldsExpr||(i._innerDisplayFieldsExpr=new e.data.Expression(a,h));var f=0;try{for(var p=0,_=a.recordCount();_>p;p++){if(a.recnoSilence(p),i._groupField&&(s=a.getFieldValue(i._groupField),s!=d)){if(null!==d&&u.push("</optgroup>"),r){if(!l.dataset().findByField(l.keyField(),s))throw"Not found: ["+s+"] in Dataset: ["+l.dataset().name()+"]field: ["+l.keyField()+"]";o=l.getCurrentDisplayValue()}else o=s;u.push('<optgroup label="'),u.push(o),u.push('">'),d=s}u.push('<option value="'+p+'">'),u.push(i._innerDisplayFieldsExpr.eval()),u.push("</option>"),f++}null!==d&&u.push("</optgroup>"),f>100&&console.warn(a.name()+t.DBSelectView.moreLookupRecords),jQuery(i.el).html(u.join(""))}finally{i._isRendering=!1,a.recnoSilence(c),i.el.value=i.dataset().recno()}}},renderAll:function(){return this._renderOptions(),this},refreshControl:function(t){var i=this,l=t.eventType;l==e.data.RefreshEvent.CHANGEMETA||(l==e.data.RefreshEvent.UPDATEALL?i.renderAll():l==e.data.RefreshEvent.INSERT||l==e.data.RefreshEvent.DELETE?i.renderAll():l==e.data.RefreshEvent.UPDATERECORD||l==e.data.RefreshEvent.UPDATECOLUMN?i.renderAll():l==e.data.RefreshEvent.SCROLL&&(i.el.value=i.dataset().recno()))},destroy:function($super){jQuery(this.el).off(),$super()}}),e.ui.register("DBSelectView",e.ui.DBSelectView),e.ui.DBSelectView.htmlTemplate="<select></select>",e.ui.DBSpinEdit=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,step",i._step=1,$super(e,t)},step:function(t){return void 0===t?this._step:(e.Checker.test("DBSpinEdit.step",t).isNumber(),this._step=t,this)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-spinedit")||t.addClass("input-group jl-spinedit"),e._createControl(),e.renderAll()},_createControl:function(){var t=this,i=jQuery(t.el),l='<input type="text" class="form-control"><div class="jl-spinedit-btn-group"><button class="btn btn-default jl-spinedit-up" tabindex="-1"><i class="fa fa-caret-up"></i></button><button class="btn btn-default jl-spinedit-down" tabindex="-1"><i class="fa fa-caret-down"></i></button>';i.html(l);var n=i.find("input")[0],a=i.find(".jl-spinedit-up")[0],r=i.find(".jl-spinedit-down")[0];t.editor=n,n.name=t._field,jQuery(t.editor).on("keydown",function(i){if(!t._isDisabled()){var l=i.keyCode;return l===e.ui.KeyCode.UP?(t.decValue(),void i.preventDefault()):l===e.ui.KeyCode.DOWN?(t.incValue(),void i.preventDefault()):void 0}}),new e.ui.DBText(n,{dataset:t._dataset,field:t._field,beforeUpdateToDataset:t.beforeUpdateToDataset,valueIndex:t._valueIndex,tabIndex:t._tabIndex});var s=jQuery(a);s.on("click",function(){t.incValue()}),s.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),s.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),s=jQuery(r),s.on("click",function(){t.decValue()}),s.focus(function(i){e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)}),s.blur(function(t){e.ui.globalFocusManager.activeDataset(null).activeField(null).activeValueIndex(null)})},_isDisabled:function(){var e=this,t=e._dataset.getField(e._field);return t.disabled()||t.readOnly()},beforeUpdateToDataset:function(){var e=this,t=e.el.value,i=e._dataset.getField(e._field),l=i.dataRange(),n=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return l&&((l.min||0===l.min)&&(n=parseFloat(l.min)),(l.max||0===l.min)&&(a=parseFloat(l.max))),t&&(t=parseFloat(t)),jQuery(e.el).attr("aria-valuenow",t),e.el.value=t,!0},setValueToDataset:function(e){var t=this;if(!t.silence){t.silence=!0,void 0===e&&(e=t.value);try{t._dataset.setFieldValue(t._field,e,t._valueIndex)}finally{t.silence=!1}}},incValue:function(){var e=this,t=e.getValue();t||(t=0);var i=e._getRange().maxValue;if(t!==i)return i>t?t+=e._step:t=i,t>i&&(t=i),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t),this},_getRange:function(){var e=this,t=e._dataset.getField(e._field),i=t.dataRange(),l=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;return i&&((i.min||0===i.min)&&(l=parseFloat(i.min)),(i.max||0===i.min)&&(n=parseFloat(i.max))),{minValue:l,maxValue:n}},decValue:function(){var e=this,t=e.getValue();t||(t=0);var i=e._getRange().minValue;if(t!==i)return t>i?t-=e._step:t=i,i>t&&(t=i),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t),this},innerFocus:function(){this.editor.focus()},doMetaChanged:function($super,e){$super(e);var t=this,i=jQuery(this.el),l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var n=l.disabled()||l.readOnly(),a=i.find(".jl-spinedit-up"),r=i.find(".jl-spinedit-down");n?(a.attr("disabled","disabled"),r.attr("disabled","disabled")):(a.attr("disabled",!1),r.attr("disabled",!1))}if(!e||"dataRange"==e){var s=l.dataRange();i.attr("aria-valuemin",s&&(s.min||0===s.min)?s.min:""),i.attr("aria-valuemin",s&&(s.max||0===s.max)?s.max:"")}e&&"tabIndex"!=e||t.setTabIndex()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},tableId:function($super,e){$super(e),this.editor.jslet.tableId(e)},destroy:function(){var e=jQuery(this.el);jQuery(this.editor).off(),this.editor=null,e.find(".jl-upbtn-up").off(),e.find(".jl-downbtn-up").off()}}),e.ui.register("DBSpinEdit",e.ui.DBSpinEdit),e.ui.DBSpinEdit.htmlTemplate="<div></div>",e.ui.DBTimePicker=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,is12Hour,hasSecond",i._is12Hour=!1,i._hasSecond=!0,$super(e,t)},is12Hour:function(e){return void 0===e?this._is12Hour:(this._is12Hour=!!e,this)},hasSecond:function(e){return void 0===e?this._hasSecond:(this._hasSecond=!!e,this)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t||"span"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-timepicker")||t.addClass("form-control jl-timepicker"),e.renderAll(),t.on("change","select",function(t){e.updateToDataset()})},renderAll:function(){var t=this,i=jQuery(t.el),l=t._dataset.getField(t._field),n=l.dataRange(),a={hour:0,minute:0,second:0},r={hour:23,minute:59,second:59};n&&(n.min&&(a=t._splitTime(n.min)),n.max&&(r=t._splitTime(n.max)));var s=[];if(s.push('<select class="jl-time-hour">'),t._is12Hour){for(var o,d=a.hour,u=r.hour,c=100,h=0,f=d;u>f;f++)o=f,f>11&&(o=f-12),c=Math.min(c,o),h=Math.max(h,o);s.push(t._getOptions(c,h))}else s.push(t._getOptions(a.hour,r.hour||23));return s.push("</select>"),s.push('<select class="jl-time-minute">'),s.push(t._getOptions(0,59)),s.push("</select>"),t._hasSecond&&(s.push('<select class="jl-time-second">'),s.push(t._getOptions(0,59)),s.push("</select>")),t._is12Hour&&s.push('<select class="jl-time-ampm"><option value="am">AM</option><option value="pm">PM</option></select>'),i.html(s.join("")),t.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},_getOptions:function(e,t){for(var i,l=[],n=e;t>=n;n++)i=10>n?"0"+n:""+n,l.push('<option value="'),l.push(n),l.push('">'),l.push(i),l.push("</option>");return l.join("")},doMetaChanged:function($super,t){$super(t);var i=this,l=i._dataset.getField(i._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t)for(var n,a=l.disabled()||l.readOnly(),r=jQuery(i.el).find("select"),s=l.required(),o=l.tabIndex(),d=0,u=r.length;u>d;d++)n=r[d],n.disabled=a,e.ui.setEditableStyle(n,a,a,!0,s),n.tabIndex=o},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getValue(),i=e._splitTime(t),l=i.hour,n=jQuery(e.el),a=n.find(".jl-time-hour"),r=n.find(".jl-time-minute");if(e._is12Hour){var s=n.find(".jl-time-ampm");s.prop("selectedIndex",12>l?0:1),l>11&&(l-=12)}a.val(l),r.val(i.minute),e._hasSecond&&(r=n.find(".jl-time-second"),r.val(i.second))}},_splitTime:function(t){var i=0,l=0,n=0;if(t)if(e.isDate(t))i=t.getHours(),l=t.getMinutes(),n=t.getSeconds();else if(e.isString(t)){var a=t.split(":");i=parseInt(a[0]),a.length>1&&(l=parseInt(a[1])),a.length>2&&(n=parseInt(a[2]))}return{hour:i,minute:l,second:n}},_prefix:function(e){return parseInt(e)<10?"0"+e:e},updateToDataset:function(){var t=this;if(t._keep_silence_)return!0;t._keep_silence_=!0;try{var i,l=jQuery(t.el),n=t._dataset.getField(t._field),a=null;if(n.getType()!=e.data.DataType.DATE)a=[],t._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0?(i=parseInt(l.find(".jl-time-hour").val())+12,a.push(i)):a.push(t._prefix(l.find(".jl-time-hour").val())),a.push(":"),a.push(t._prefix(l.find(".jl-time-minute").val())),t._hasSecond&&(a.push(":"),a.push(t._prefix(l.find(".jl-time-second").val()))),a=a.join("");else{a=t.getValue(),a||(a=new Date),i=parseInt(l.find(".jl-time-hour").val()),t._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0&&(i+=12);var r=parseInt(l.find(".jl-time-minute").val()),s=0;t._hasSecond&&(s=parseInt(l.find(".jl-time-second").val())),a.setHours(i),a.setMinutes(r),a.setSeconds(s)}t._dataset.setFieldValue(t._field,a,t._valueIndex)}finally{t._keep_silence_=!1}return!0},innerFocus:function(){var e=jQuery(this.el);e.find(".jl-time-hour").focus()},destroy:function($super){jQuery(this.el).off(),$super()}}),e.ui.register("DBTimePicker",e.ui.DBTimePicker),e.ui.DBTimePicker.htmlTemplate="<div></div>",e.ui.DBUEditor=e.Class.create(e.ui.DBFieldControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,field,height",i._height=150,i._oldValue=null,i._editor=null,$super(e,t)},height:function(t){return void 0===t?this._height:(e.Checker.test("DBUEditor.height",t).isGTZero(),
this._height=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var t=this;if(!window.UE)throw new Error("Not found UEditor component! Goto for more: http://ueditor.baidu.com/website/");var i=jQuery(t.el);i.addClass("jl-ueditor");var l=e.nextId(),n="<textarea></textarea>";i.html(n),i.children().attr("id",l).attr("name",t._field);var a=window.UE.getEditor(l);a.on("focus",jQuery.proxy(t._doFocus,t)),a.on("contentchange",jQuery.proxy(t._doChange,t)),t._editor=a,a.addListener("ready",function(e){t.renderAll()})},_doFocus:function(){var t=this;e.ui.globalFocusManager.activeDataset(t._dataset.name()).activeField(t._field).activeValueIndex(t._valueIndex)},_doChange:function(){this.updateToDataset()},doMetaChanged:function($super,e){$super(e);var t=this,i=t._dataset.getField(t._field);if(e&&"disabled"!=e&&"readOnly"!=e||console.warn("UEditor Not support this feature: set read only!"),e&&"required"==e){var l=jQuery(t.el);i.required()?l.addClass("jl-ctrl-required"):l.removeClass("jl-ctrl-required")}},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t,i=e.getFieldError();i&&i.message?(e.renderInvalid(i),t=i.inputText):(e.renderInvalid(null),t=e.getText()),e._editor.setContent(t||""),e._oldValue=e.el.value}},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},innerFocus:function($super){this._editor.focus()},updateToDataset:function(){var t=this;if(!t._keep_silence_){var i=t._editor.getContent();if(t._oldValue!=i){t._dataset.editRecord(),t._keep_silence_=!0;try{t._dataset.setFieldText(t._field,i,t._valueIndex),t.refreshControl(e.data.RefreshEvent.updateRecordEvent(t._field))}finally{t._keep_silence_=!1}var l=t.getFieldError();l&&l.message?t.renderInvalid(l):t.renderInvalid(null)}}},destroy:function($super){var e=this;jQuery(e.el).off(),e._editor=null,$super()}}),e.ui.register("DBUEditor",e.ui.DBUEditor),e.ui.DBUEditor.htmlTemplate="<div></div>",e.ui.ListViewModel=function(e,t){var i=0,l=0,n=0,a=null,r=null,s=0,o=0;this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null,this.fixedRows=0;var d=function(){if(!t)return!1;var i=e;return!(!i._parentField||!i._keyField)};d(),this.refreshModel=function(i){if(t){void 0===i&&(i=-1);var l,n,a=e,s=(a.recordCount(),[]),o=a.recnoSilence();try{a.recnoSilence(this.fixedRows);var d,u,c,h,f,p,_,v=0,m=[];for(l=0,_=a.recordCount();_>l;l++){a.recnoSilence(l),p=a.keyValue(),v=0,u=null,n=a.parentValue();for(var g=m.length-1;g>=0;g--)if(c=m[g],h=c.keyvalue,null!==h&&void 0!==h&&""!==h&&h==n){v=c.level+1,u=c;break}if(u)for(var C=m.length-1;C>g;C--)m.pop();f=a.getRecord();var b=!0;b=i>=0&&i>=v?!0:a.expanded(),d={parent:u,recno:l,keyvalue:p,expanded:b,isbold:0,level:v},m.push(d),u?(u.children||(u.children=[]),u.children.push(d)):s.push(d)}}finally{a.recnoSilence(o)}r=s;for(var y=0,j=r.length;j>y;y++)this._updateNodeBoldStyle(r[y]);this._setLastFlag(s),this._refreshNeedShowRows()}},this._updateNodeBoldStyle=function(t){function i(t){var l,n=t.children,a=!1;if(n){for(var r=0,s=n.length;s>r;r++)if(l=n[r],l.children){if(i(l),l.isbold){t.isbold=!0,a=!0;break}if(e.selectedByRecno(l.recno)){t.isbold=!0,a=!0;break}}else if(e.selectedByRecno(l.recno)){t.isbold=!0,a=!0;break}a||(t.isbold=!1)}}if(t){for(var l=t,n=t;;){if(l=t.parent,null===l){n=t;break}t=l}i(n)}},this._setLastFlag=function(e){if(e&&0!==e.length){var t;e[e.length-1].islast=!0;for(var i=0,l=e.length;l>i;i++)t=e[i],t.children&&t.children.length>0&&this._setLastFlag(t.children);return null}},this._refreshNeedShowRows=function(e){if(t){if(!r)return void this.refreshModel();a?a.length:0;a=[],this._findVisibleNode(r);var i=a.length;!e&&this.onNeedShowRowsCountChanged&&this.onNeedShowRowsCountChanged(i)}},this.hasChildren=function(i){if(!t)return!1;i||(i=e.recno());var l=this._innerFindNode(r,i);if(null!==l)return l.children&&l.children.length>0},this.getLevel=function(i){if(!t)return!1;i||(i=e.recno());var l=this._innerFindNode(r,i);if(null!==l)return l.level},this._findVisibleNode=function(e){if(e)for(var t,i=0,l=e.length;l>i;i++)t=e[i],a.push(t),t.expanded&&this._findVisibleNode(t.children)},this.rownoToRecno=function(e){return t?0>e?(e+=this.fixedRows,e>=0?e:-1):e>=a.length?-1:a[e].recno:e+this.fixedRows},this.recnoToRowno=function(e){if(!t)return e-this.fixedRows;for(var i=0,l=a.length;l>i;i++)if(a[i].recno==e)return i;return-1},this.setVisibleStartRow=function(e,t){if(e>=0){var a=this.getNeedShowRowCount()+1-i;e>a&&(e=a)}0>e&&(e=0),l!=e&&(l=e,n=e+i-1,!t&&this.onTopRownoChanged&&this.onTopRownoChanged(e))},this.getVisibleStartRow=function(){return l},this.setVisibleEndRow=function(e){n=e},this.getVisibleEndRow=function(){return n},this.setVisibleCount=function(e,t){i!=e&&(i=e,n=l+e-1,!t&&this.onVisibleCountChanged&&this.onVisibleCountChanged(e))},this.getVisibleCount=function(){return i},this.getNeedShowRowCount=function(){return t?a.length:e.recordCount()-this.fixedRows},this.getCurrentRow=function(){return a[s]},this.skipSetCurrentRowno=function(){this._skipSetCurrentRowno=!0},this.setCurrentRowno=function(e,n,r){if(this._skipSetCurrentRowno)return this._skipSetCurrentRowno=!1,null;if(void 0===e)return null;var d=s,u=0,c=null;if(0>e){var h=-1*this.fixedRows;h>e&&(e=h),u=this.fixedRows+e}else{var f=this.getNeedShowRowCount();if(0===f)return s=0,o=-1,null;e>=f&&(e=f-1),t?(c=a[e],u=c.recno):u=e+this.fixedRows,r&&(e>=0&&l>e?this.setVisibleStartRow(e):e>=l+i&&this.setVisibleStartRow(e-i+1))}return s=e,o=u,!n&&this.onCurrentRownoChanged&&this.onCurrentRownoChanged(d,s),c},this.getCurrentRowno=function(){return s},this.getCurrentRecno=function(){return o},this.nextRow=function(){e.confirm(),this.setCurrentRowno(s+1,!1,!0)},this.priorRow=function(t){e.confirm(),this.setCurrentRowno(s-1,!1,!0)},this.nextPage=function(){e.confirm(),this.setVisibleStartRow(l+i),this.setCurrentRowno(l)},this.priorPage=function(){e.confirm(),this.setVisibleStartRow(l-i),this.setCurrentRowno(l)},this._innerFindNode=function(e,t){for(var i,l=0,n=e.length-1;n>=l;l++){if(i=e[l],i.recno==t)return i;if(i.children){var a=this._innerFindNode(i.children,t);if(a)return a}}return null},this.expand=function(i){if(t){var l=this._innerFindNode(r,e.recno());if(null!==l){e.confirm();var n=e.recnoSilence();try{l.expanded=!!l.children,e.recnoSilence(l.recno),e.expanded(l.expanded);for(var a=l;;){if(a=a.parent,!a)break;a.expanded||(e.recnoSilence(a.recno),e.expanded(!0),a.expanded=!0)}}finally{e.recnoSilence(n)}this._refreshNeedShowRows(),i&&i()}}},this.collapse=function(i){if(t){var l=this._innerFindNode(r,e.recno());if(null!==l){e.confirm();var n=e.recnoSilence();try{e.recnoSilence(l.recno),e.expanded(!1),l.expanded=!1}finally{e.recnoSilence(n)}this._refreshNeedShowRows(),i&&i()}}},this._iterateNode=function(e,t){for(var i,l=0,n=e.length;n>l;l++)i=e[l],i.children&&(t&&t(i),i.children&&i.children.length>0&&this._iterateNode(i.children,t));return null},this._callbackFn=function(t,i){var l=e.recnoSilence();try{e.recnoSilence(t.recno),e.expanded(i),t.expanded=i}finally{e.recnoSilence(l)}},this.expandAll=function(i){if(t){e.confirm();var l=this;l._iterateNode(r,function(e){l._callbackFn(e,!0)}),l._refreshNeedShowRows(),i&&i()}},this.collapseAll=function(i){if(t){e.confirm();var l=this;l._iterateNode(r,function(e){l._callbackFn(e,!1)}),l._refreshNeedShowRows(),i&&i()}},this.syncDataset=function(){var t=e.recno();if(!(0>t)){var i=this._innerFindNode(r,e.recno()),l=i.parent;if(l&&!l.expanded)for(;;){if(l.expanded)break;if(l.expanded=!0,l=l.parent,!l)break}this._refreshNeedShowRows();var n=this.recnoToRowno(t);this.setCurrentRowno(n,!1,!0)}},this.checkNode=function(t,i,l){var n=this.getCurrentRow();e.selected(t?1:0),i&&(n.children&&n.children.length>0&&this._updateChildState(n,t),n.parent&&!l&&this._updateParentState(n,t)),this._updateNodeBoldStyle(n),this.onCheckStateChanged&&this.onCheckStateChanged()},this.checkChildNodes=function(t,i){var l=this.getCurrentRow();e.selected(t?1:0),i&&(l.parent&&this._updateParentState(l,t),l.children&&l.children.length>0&&this._updateChildState(l,t)),this._updateNodeBoldStyle(l),this.onCheckStateChanged&&this.onCheckStateChanged()},this._updateChildState=function(t,i){var l,n=e.recnoSilence();try{for(var a=0,r=t.children.length;r>a;a++)l=t.children[a],e.recnoSilence(l.recno),e.selected(i),l.children&&l.children.length>0&&this._updateChildState(l,i)}finally{e.recnoSilence(n)}},this._updateParentState=function(t,i){var l=t.parent;if(l){var n,a,r;if(2!=i)for(var s=0,o=l.children.length;o>s;s++){if(n=l.children[s],r=e.selectedByRecno(n.recno),2==r){a=2;break}if(0===s)a=r;else if(a!=r){a=2;break}}else a=i;var d=e.selectedByRecno(l.recno);if(d!=a){var u=e.recnoSilence();try{e.recnoSilence(l.recno),e.selected(a)}finally{e.recnoSilence(u)}}this._updateParentState(l,a)}},this.reset=function(){i=0,l=0,n=0,a=null,r=null,s=0,o=0,this.fixedRows=0},this.destroy=function(){e=null,r=null,this.reset(),this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null}},e.ui.DBTreeView=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,displayFields,useArrow,itemHeight,hasLine,hasCheckBox,enableErrorFinding,correlateCheck,correlative,onlyCheckChildren,readOnly,expandLevel,onItemClick,onItemDblClick,beforeCheckBoxClick,afterCheckBoxClick,iconClassField,onGetIconClass,onRenderItem,onCreateContextMenu",i.requiredProperties="displayFields",i._displayFields=null,i._itemHeight=22,i._useArrow=!1,i._hasLine=!0,i._hasCheckBox=!1,i._readOnly=!1,i._correlative=!1,i._onlyCheckChildren=!1,i._iconClassField=null,i._expandLevel=-1,i._onItemClick=null,i._onItemDblClick=null,i._beforeCheckBoxClick=null,i._afterCheckBoxClick=null,i._onGetIconClass=null,i._onRenderItem=null,i._onCreateContextMenu=null,i._enableErrorFinding=!1,i.iconWidth=null,$super(e,t)},displayFields:function(t){if(void 0===t){var i=this._displayFields;if(i)return this._dataset.getField(i)?"["+i+"]":i;var l=this._dataset,n=l.nameField()||l.codeField()||l.keyField();if(n)return"["+n+"]";e.Checker.test("DBTreeView.displayFields",n).required()}return t=jQuery.trim(t),e.Checker.test("DBTreeView.displayFields",t).required().isString(),this._displayFields=t,this},itemHeight:function(t){return void 0===t?this._itemHeight:(e.Checker.test("DBTreeView.itemHeight",t).isNumber(),void(this._itemHeight=t))},iconClassField:function(t){return void 0===t?this._iconClassField:(t=jQuery.trim(t),e.Checker.test("DBTreeView.iconClassField",t).isString(),this._iconClassField=t,this)},useArrow:function(e){return void 0===e?this._useArrow:(this._useArrow=!!e,this)},hasLine:function(e){return void 0===e?this._hasLine:(this._hasLine=!!e,this)},hasCheckBox:function(e){return void 0===e?this._hasCheckBox:(this._hasCheckBox=!!e,this)},correlateCheck:function(e){return this.correlative(e)},correlative:function(e){return void 0===e?this._correlative:(this._correlative=!!e,this)},onlyCheckChildren:function(e){return void 0===e?this._onlyCheckChildren:(this._onlyCheckChildren=!!e,this)},readOnly:function(e){return void 0===e?this._readOnly:(this._readOnly=!!e,this)},expandLevel:function(t){return void 0===t?this._expandLevel:(e.Checker.test("DBTreeView.expandLevel",t).isGTEZero(),this._expandLevel=parseInt(t),this)},enableErrorFinding:function(e){return void 0===e?this._enableErrorFinding:(this._enableErrorFinding=!!e,this)},onItemClick:function(t){return void 0===t?this._onItemClick:(e.Checker.test("DBTreeView.onItemClick",t).isFunction(),this._onItemClick=t,this)},onItemDblClick:function(t){return void 0===t?this._onItemDblClick:(e.Checker.test("DBTreeView.onItemDblClick",t).isFunction(),this._onItemDblClick=t,this)},beforeCheckBoxClick:function(t){return void 0===t?this._beforeCheckBoxClick:(e.Checker.test("DBTreeView.beforeCheckBoxClick",t).isFunction(),this._beforeCheckBoxClick=t,this)},afterCheckBoxClick:function(t){return void 0===t?this._afterCheckBoxClick:(e.Checker.test("DBTreeView.afterCheckBoxClick",t).isFunction(),this._afterCheckBoxClick=t,this)},onGetIconClass:function(t){return void 0===t?this._onGetIconClass:(e.Checker.test("DBTreeView.onGetIconClass",t).isFunction(),this._onGetIconClass=t,this)},onRenderItem:function(t){return void 0===t?this._onRenderItem:(e.Checker.test("DBTreeView.onRenderItem",t).isFunction(),this._onRenderItem=t,this)},onCreateContextMenu:function(t){return void 0===t?this._onCreateContextMenu:(e.Checker.test("DBTreeView.onCreateContextMenu",t).isFunction(),this._onCreateContextMenu=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var t=this,i=jQuery(t.el);t.scrBarSize=e.ui.scrollbarSize()+1,void 0===t._keyField&&(t._keyField=t._dataset.keyField());var l=i.attr("tabindex");l||i.attr("tabindex",-1),i.keydown(function(i){var l=i.which,n=i.ctrlKey;return n&&l===e.ui.KeyCode.E?(t.gotoNextError(),i.preventDefault(),i.stopImmediatePropagation(),!1):n&&l===e.ui.KeyCode.HOME?(t._dataset.first(),i.preventDefault(),i.stopImmediatePropagation(),!1):n&&l===e.ui.KeyCode.END?(t._dataset.last(),i.preventDefault(),i.stopImmediatePropagation(),!1):void(t._doKeydown(i.which)&&i.preventDefault())}),i.on("mouseenter","td.jl-tree-text",function(e){jQuery(this).addClass("jl-tree-nodes-hover")}),i.on("mouseleave","td.jl-tree-text",function(e){jQuery(this).removeClass("jl-tree-nodes-hover")}),i.hasClass("jl-tree")||i.addClass("jl-tree");var n="object"==typeof t.el.onmousewheel,a=n?"mousewheel":"DOMMouseScroll";i.on(a,function(e){var i=e.originalEvent,l=n?i.wheelDelta/-120:i.detail/3;t.listvm.setVisibleStartRow(t.listvm.getVisibleStartRow()+l),e.preventDefault()}),t.renderAll(),t.refreshControl(e.data.RefreshEvent.scrollEvent(this._dataset.recno())),t._createContextMenu(),e.ui.resizeEventBus.subscribe(t)},renderAll:function(){var t=this,i=jQuery(t.el);t.evaluator=new e.data.Expression(t._dataset,t.displayFields()),t._useArrow?(i.removeClass("jl-tree-plus"),i.removeClass("jl-tree-plus-nl"),i.addClass("jl-tree-arrow")):(i.removeClass("jl-tree-arrow"),t._hasLine?i.addClass("jl-tree-plus"):i.addClass("jl-tree-plus-nl")),i.html(""),t.oldWidth=i.width(),t.oldHeight=i.height(),i.css("line-height",t._itemHeight+"px"),t.nodeHeight=t.iconWidth=t._itemHeight||parseInt(e.ui.getCssValue("jl-tree","line-height"));var l=i[0].style.height;l.indexOf("%")>0?t.treePanelHeight=i.parent().height()*parseFloat(l)/100:t.treePanelHeight=i.height(),t.treePanelWidth=i.width(),t.nodeCount=Math.floor(t.treePanelHeight/t.nodeHeight),t._initVm(),t._initFrame(),t.listvm.syncDataset()},_initFrame:function(){var t=this,i=jQuery(t.el);i.find(".jl-tree-container").off(),i.find(".jl-tree-scrollbar").off();var l='<span class="fa-stack jl-tree-mixedchecked jl-hidden"><i class="fa fa-square fa-stack-1x"></i><i class="fa fa-square-o fa-stack-2x" aria-hidden="true"></i></span>';l+='<span class="fa fa-check-square-o jl-tree-checked jl-hidden"></span>',l+='<span class="fa fa-square-o jl-tree-unchecked jl-hidden"></span>';var n,a,r=[];for(n=0;5>n;n++)r.push('<td class="jl-tree-unit jl-tree-lines" '),r.push(e.ui.DBTreeView.NODETYPE),r.push('="0"></td>');var s=r.join(""),o=['<div class="jl-tree-container">'],d=!t._hasLine||t._useArrow;for(n=0,a=t.nodeCount;a>n;n++)o.push('<table class="jl-tree-nodes" cellpadding="0" cellspacing="0"><tr>'),o.push(s),o.push('<td class="jl-tree-unit jl-tree-expander" '),o.push(e.ui.DBTreeView.NODETYPE),o.push('="1">'),d&&(t._useArrow?o.push('<i class="fa fa-caret-right" aria-hidden="true"></i>'):o.push('<i class="fa fa-plus-square-o" aria-hidden="true"></i>')),o.push('</td><td class="jl-tree-unit jl-tree-checkbox" '),o.push(e.ui.DBTreeView.NODETYPE),o.push('="2">'+l+"</td><td "),o.push(e.ui.DBTreeView.NODETYPE),o.push('="3"></td><td class="jl-tree-text" '),o.push(e.ui.DBTreeView.NODETYPE),o.push('="9" nowrap="nowrap"></td></tr></table>');o.push('</div><div class="jl-tree-scrollbar"><div class="jl-tree-tracker"></div></div>'),i.html(o.join("")),i.on("click","td[data-nodetype]",function(e){t._doRowClick(e.currentTarget),e.stopImmediatePropagation()}),i.on("dblclick","td[data-nodetype]",function(e){t._doRowDblClick(e.currentTarget),e.stopImmediatePropagation()}),t.listvm.setVisibleCount(t.nodeCount);var u=i.find(".jl-tree-scrollbar");u.on("scroll",function(){var e=Math.ceil(this.scrollTop/t.nodeHeight);if(e!=t.listvm.getVisibleStartRow()){t._skip_=!0;try{t.listvm.setVisibleStartRow(e)}finally{t._skip_=!1}}})},gotoNextError:function(){var e=this;e._dataset.nextError()||e._dataset.firstError()},resize:function(){var e=this,t=jQuery(e.el),i=t.height(),l=t.width();l!=e.oldWidth&&(e.oldWidth=l,e.treePanelWidth=t.innerWidth(),e._fillData()),i!=e.oldHeight&&(e.oldHeight=i,e.treePanelHeight=t.innerHeight(),e.nodeCount=Math.floor(i/e.nodeHeight)-1,e._initFrame())},hasChildren:function(){return this.listvm.hasChildren()},_initVm:function(){var t=this;t.listvm=new e.ui.ListViewModel(t._dataset,!0),t.listvm.refreshModel(t._expandLevel),t.listvm.fixedRows=0,t.listvm.onTopRownoChanged=function(e){e=t.listvm.getCurrentRowno(),t._fillData(),t._doCurrentRowChanged(e),t._syncScrollBar(e)},t.listvm.onVisibleCountChanged=function(){t._fillData();var e=t.listvm.getNeedShowRowCount();jQuery(t.el).find(".jl-tree-tracker").height(t.nodeHeight*e)},t.listvm.onCurrentRownoChanged=function(e,i){t._doCurrentRowChanged(i)},t.listvm.onNeedShowRowsCountChanged=function(e){t._fillData(),jQuery(t.el).find(".jl-tree-tracker").height(t.nodeHeight*(e+2))},t.listvm.onCheckStateChanged=function(){t._fillData()}},_doKeydown:function(i){var l=this,n=!1;return i===e.ui.KeyCode.SPACE?(l._doCheckBoxClick(),n=!0):i===e.ui.KeyCode.UP?(l.listvm.priorRow(),l._dataset.recno(l.listvm.getCurrentRecno()),n=!0):i===e.ui.KeyCode.DOWN?(l.listvm.nextRow(),l._dataset.recno(l.listvm.getCurrentRecno()),n=!0):i===e.ui.KeyCode.LEFT?(t.isRtl?l.listvm.expand():l.listvm.collapse(),n=!0):i===e.ui.KeyCode.RIGHT?(t.isRtl?l.listvm.collapse():l.listvm.expand(),n=!0):i===e.ui.KeyCode.PAGEUP?(l.listvm.priorPage(),l._dataset.recno(l.listvm.getCurrentRecno()),n=!0):i===e.ui.KeyCode.PAGEDOWN&&(l.listvm.nextPage(),l._dataset.recno(l.listvm.getCurrentRecno()),n=!0),n},_getTrByRowno:function(e){for(var t,i=jQuery(this.el).find(".jl-tree-nodes"),l=0,n=i.length;n>l;l++)if(t=i[l].rows[0],t.jsletrowno==e)return t;return null},_doCurrentRowChanged:function(t){var i=this;i.prevRow&&jQuery(i._getTextTd(i.prevRow)).removeClass(e.ui.htmlclass.TREENODECLASS.selected);var l=i._getTrByRowno(t);l&&jQuery(i._getTextTd(l)).addClass(e.ui.htmlclass.TREENODECLASS.selected),i.prevRow=l},_getTextTd:function(e){return e.cells[e.cells.length-1]},_doExpand:function(){this.expand()},_doRowClick:function(t){var i=this,l=t.getAttribute(e.ui.DBTreeView.NODETYPE);if(l){if("0"!=l&&i._syncToDs(t),"1"==l||"2"==l){var n=i.listvm.getCurrentRow();"1"==l&&n.children&&n.children.length>0&&(n.expanded?i.collapse():i.expand()),"2"==l&&i._doCheckBoxClick()}"9"==l&&(i._doCheckBoxClick(),i._onItemClick&&i._onItemClick.call(i))}},_doRowDblClick:function(t){this._syncToDs(t);var i=t.getAttribute(e.ui.DBTreeView.NODETYPE);this._onItemDblClick&&"9"==i&&this._onItemDblClick.call(this)},_doCheckBoxClick:function(){var e=this;if(!e._readOnly){var t=e.listvm.getCurrentRow();t.hasCheckbox&&(e._beforeCheckBoxClick&&!e._beforeCheckBoxClick.call(e)||(e.listvm.checkNode(e._dataset.selected()?0:1,e._correlative,e._onlyCheckChildren),e._afterCheckBoxClick&&e._afterCheckBoxClick.call(e)))}},_syncToDs:function(e){for(var t,i=-1;;){if(t=e.jsletrowno,0===t||t){i=t;break}if(e=e.parentNode,!e)break}0>i||(this.listvm.setCurrentRowno(i),this._dataset.recno(this.listvm.getCurrentRecno()))},_fillData:function(){var e,t=this,i=t.listvm.getVisibleCount(),l=t.listvm.getVisibleStartRow(),n=t.listvm.getNeedShowRowCount(),a=i+l,r=0,s=jQuery(t.el),o=s.find(".jl-tree-nodes");if(!t._isRendering){t._isRendering=!0,t._skip_=!0;var d,u=t._dataset.recnoSilence(),c=t.listvm.getCurrentRowno(),h=!0,f=0;try{if(a>n){for(var p=a-n;p>0;p--)e=o[i-p],e.style.display="none";h=!1}else n=a;for(var _=n-1,v=l;_>=v;v++)e=o[r++],d=t._fillNode(e,v),h&&f<t.treePanelWidth&&(v==_&&d<t.treePanelWidth?h=!1:f=Math.max(f,d)),v==_&&h?e.style.display="none":(e.style.display="",e.jsletrowno=v)}finally{t.listvm.setCurrentRowno(c,!1),t._dataset.recnoSilence(u),t._isRendering=!1,t._skip_=!1}window.setTimeout(function(){t._checkScrollBar()},5)}},_setCheckClsName:function(e,t){var i=jQuery(e);t?2==t?(i.find(".jl-tree-checked").addClass("jl-hidden"),i.find(".jl-tree-mixedchecked").removeClass("jl-hidden"),i.find(".jl-tree-unchecked").addClass("jl-hidden")):(i.find(".jl-tree-checked").removeClass("jl-hidden"),i.find(".jl-tree-mixedchecked").addClass("jl-hidden"),i.find(".jl-tree-unchecked").addClass("jl-hidden")):(i.find(".jl-tree-checked").addClass("jl-hidden"),i.find(".jl-tree-mixedchecked").addClass("jl-hidden"),i.find(".jl-tree-unchecked").removeClass("jl-hidden"))},_fillNode:function(t,i){var l,n,a,r=t.rows[0],s=this,o=s.listvm.setCurrentRowno(i,!0),d=r.cells,u=d.length,c=o.level+4;if(s._dataset.recnoSilence(s.listvm.getCurrentRecno()),r.jsletrowno=i,c>u)for(n=1,a=c-u;a>=n;n++)l=r.insertCell(0),jQuery(l).addClass("jl-tree-unit jl-tree-lines").attr("jsletline",1);if(u>=c){for(n=0,a=u-c;a>n;n++)d[n].style.display="none";for(n=u-c;c>n;n++)d[n].style.display=""}u=d.length;var h=o,f=1,p=s.iconWidth*o.level;for(n=o.level;n>0;n--)l=r.cells[u-4-f++],h=h.parent,h.islast?l.className=e.ui.htmlclass.TREELINECLASS.empty:l.className=e.ui.htmlclass.TREELINECLASS.line;var _,v=r.cells[u-4];v.noWrap=!0,v.style.display="",o.children&&o.children.length>0?!s._useArrow&&s._hasLine?o.islast?v.className=o.expanded?e.ui.htmlclass.TREELINECLASS.minusBottom:e.ui.htmlclass.TREELINECLASS.plusBottom:v.className=o.expanded?e.ui.htmlclass.TREELINECLASS.minus:e.ui.htmlclass.TREELINECLASS.plus:(_=jQuery(v.childNodes[0]),s._useArrow?o.expanded?_.addClass("jl-tree-rotate-45"):_.removeClass("jl-tree-rotate-45"):o.expanded?(_.removeClass("fa-plus-square-o"),_.addClass("fa-minus-square-o")):(_.addClass("fa-plus-square-o"),_.removeClass("fa-minus-square-o")),_.show()):!s._useArrow&&s._hasLine?o.islast?v.className=e.ui.htmlclass.TREELINECLASS.joinBottom:v.className=e.ui.htmlclass.TREELINECLASS.join:(_=jQuery(v.childNodes[0]),_.hide()),p+=s.iconWidth;var m=s._hasCheckBox&&s._dataset.checkSelectable(),g=s.listvm.getCurrentRow();g.hasCheckbox=m;var C=r.cells[u-3];m?(C.noWrap=!0,s._setCheckClsName(C,s._dataset.selected()),C.style.display="",p+=s.iconWidth):C.style.display="none";var b=r.cells[u-2],y="jl-tree-unit jl-tree-icon",j=null,w=!(o.children&&o.children.length>0);s._iconClassField||s._onGetIconClass?(s._iconClassField?j=s._dataset.getFieldValue(s._iconClassField):s._onGetIconClass&&(j=s._onGetIconClass.call(s,s._dataset.keyValue(),o.level,w)),j&&(y=j+" "+y),b.className!=y&&(b.className=y),b.style.display="",p+=s.iconWidth):b.style.display="none";var x=s.evaluator.eval()||"      ";e.ui.textMeasurer.setElement(s.el);var D=Math.round(e.ui.textMeasurer.getWidth(x))+10;p+=D+10,e.ui.textMeasurer.setElement();var k=r.cells[u-1];k.style.width=D+"px";var S=jQuery(k);return S.html(x),s._dataset.existRecordError()?(S.hasClass("has-error")||S.addClass("has-error"),k.title=s._dataset.getRecordErrorInfo()):(S.hasClass("has-error")&&S.removeClass("has-error"),k.title=S.text()),o.isbold?S.addClass("jl-tree-child-checked"):S.removeClass("jl-tree-child-checked"),s._onRenderItem&&s._onRenderItem.call(s,b,k,o.level,w),p},_syncScrollBar:function(){var e=this;e._skip_||jQuery(e.el).find(".jl-tree-scrollbar").scrollTop(e.nodeHeight*e.listvm.getVisibleStartRow())},_checkScrollBar:function(){var e=jQuery(this.el).find(".jl-tree-scrollbar"),t=e[0];t.scrollHeight>t.clientHeight?e.removeClass("jl-tree-scrollbar-hidden"):e.hasClass("jl-tree-scrollbar-hidden")||e.addClass("jl-tree-scrollbar-hidden")},expand:function(){this.listvm.expand()},collapse:function(){this.listvm.collapse()},expandAll:function(){this.listvm.expandAll()},collapseAll:function(){this.listvm.collapseAll()},_createContextMenu:function(){if(e.ui.Menu){var i=this,l={type:"Menu",onItemClick:jQuery.proxy(i._menuItemClick,i),items:[]};i._hasCheckBox&&(l.items.push({id:"checkAll",name:t.DBTreeView.checkAll}),l.items.push({id:"uncheckAll",name:t.DBTreeView.uncheckAll}),l.items.push({name:"-"})),l.items.push({id:"expandAll",name:t.DBTreeView.expandAll}),l.items.push({id:"collapseAll",name:t.DBTreeView.collapseAll}),i._enableErrorFinding&&(l.items.push({name:"-"}),l.items.push({id:"nextError",name:t.DBTreeView.nextError})),i._onCreateContextMenu&&i._onCreateContextMenu.call(i,l.items),0!==l.items.length&&(i.contextMenu=e.ui.createControl(l),jQuery(i.el).on("contextmenu",function(t){var l=t.target,n=l.getAttribute(e.ui.DBTreeView.NODETYPE);n&&"0"!=n&&(i._syncToDs(l),i.contextMenu.showContextMenu(t,i))}))}},_menuItemClick:function(e,t){var i=e.id,l=this;"expandAll"==i?l.expandAll():"collapseAll"==i?l.collapseAll():"checkAll"==i?(l.listvm.checkChildNodes(!0,!0),l._afterCheckBoxClick&&l._afterCheckBoxClick.call(l)):"uncheckAll"==i?(l.listvm.checkChildNodes(!1,!0),l._afterCheckBoxClick&&l._afterCheckBoxClick.call(l)):"nextError"==i&&l.gotoNextError()},refreshControl:function(t){var i=this,l=t.eventType;l==e.data.RefreshEvent.CHANGEMETA||(l==e.data.RefreshEvent.UPDATEALL?i.renderAll():l==e.data.RefreshEvent.INSERT||l==e.data.RefreshEvent.DELETE?(i.listvm.refreshModel(i._expandLevel),l==e.data.RefreshEvent.INSERT&&i.listvm.syncDataset()):l==e.data.RefreshEvent.UPDATERECORD||l==e.data.RefreshEvent.UPDATECOLUMN?i._fillData():l==e.data.RefreshEvent.SELECTALL?i._hasCheckBox&&i._fillData():l==e.data.RefreshEvent.SELECTRECORD?i._hasCheckBox&&i.listvm.checkNode(i._dataset.selected(),i._correlative,i._onlyCheckChildren):l==e.data.RefreshEvent.SCROLL&&i.listvm.syncDataset())},checkSizeChanged:function(){this.resize()},destroy:function($super){var t=this,i=jQuery(t.el);e.ui.resizeEventBus.unsubscribe(t),i.find(".jl-tree-nodes").off(),t.listvm.destroy(),t.listvm=null,t.prevRow=null,$super()}}),e.ui.htmlclass.TREELINECLASS={line:"jl-tree-unit jl-tree-lines jl-tree-line",join:"jl-tree-unit jl-tree-lines jl-tree-join",joinBottom:"jl-tree-unit jl-tree-lines jl-tree-join-bottom",minus:"jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-minus",minusBottom:"jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-minus-bottom",noLineMinus:"jl-tree-unit  jl-tree-expander jl-tree-lines jl-tree-noline-minus",plus:"jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus",plusBottom:"jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-plus-bottom",noLinePlus:"jl-tree-unit jl-tree-expander jl-tree-lines jl-tree-noline-plus",empty:"jl-tree-unit"},e.ui.htmlclass.TREECHECKBOXCLASS={checked:"jl-tree-unit jl-tree-checkbox jl-tree-checked",unChecked:"jl-tree-unit jl-tree-checkbox jl-tree-unchecked",mixedChecked:"jl-tree-unit jl-tree-checkbox jl-tree-mixedchecked"},e.ui.htmlclass.TREENODECLASS={selected:"jl-tree-selected",childChecked:"jl-tree-child-checked",treeNodeLevel:"jl-tree-child-level"},e.ui.DBTreeView.NODETYPE="data-nodetype",e.ui.register("DBTreeView",e.ui.DBTreeView),e.ui.DBTreeView.htmlTemplate="<div></div>",e.ui.table||(e.ui.table={}),e.ui.table.TableCellEditor=function(t){function i(){var i,n,r,s='<div class="form-group form-group-sm jl-tbl-editpanel"><table class="jl-tbl-edittable"><tbody><tr class="jl-tbl-editrow">',o=a._sysColumns,d=t.dataset(),u=d.name(),c=1;for(n=0,r=o.length;r>n;n++)i=o[n],c+=i.width+1;o=a.innerColumns;var h,f,p,_,v,m=t.el.id,g=t.editorTabIndex(),C=";text-align: center",b=t.editableFields(),y=t.readOnlyFields();for(v=b&&b.length>0||y&&y.length>0,n=0,r=o.length;r>n;n++)if(i=o[n],p=i.field,p&&!(y&&y.indexOf(p)>=0||b&&b.indexOf(p)<0||(f=d.getField(p),_=f.getType(),_===e.data.DataType.ACTION||_===e.data.DataType.EDITACTION))){if(s+='<td class="jl-edtfld-'+p+'" style="display:none;vertical-align: middle'+(h?C:"")+'">',v||!f.fieldReadOnly()&&!f.fieldDisabled()){var j="";i.prefix&&(j=", prefix: "+e.JSON.stringify(i.prefix)),i.suffix&&(j+=", suffix: "+e.JSON.stringify(i.suffix)),h=f.dataType()===e.data.DataType.BOOLEAN,s+='<div data-jslet=\'type:"DBPlace",dataset:"'+u+'",field:"'+p+'", tableId: "'+m+'", expandChildWidth: '+(h?"false":"true")+(g?", tabIndex: "+g:"")+j+"' class=\""+i.widthCssName+(h?" jl-tbl-check-col":"")+'"></div>'}s+="</td>"}s+="</tr></tbody></table></div>";var w=jQuery(s);w.appendTo(jQuery(a.el)),w.css("left",c+"px"),e.ui.install(w[0]),l=w,w.height(a.rowHeight()),w.on("keydown",function(t){var i=t.which;t.ctrlKey&&i===e.ui.KeyCode.C&&t.stopImmediatePropagation()})}var l,n,a=t;i(),this.showEditor=function(e,t){var i=a.dataset();if(0!==i.recordCount()){if(!e)return void i.focusEditControl(n);var r=i.getField(e);if(!r||r.disabled()||r.readOnly())return void this.hideEditor();var s,o=jQuery(t),d=o.attr("jsletFirstId");if(d){var u=jQuery("#"+d).offset(),c=parseFloat(o.attr("jsletOffsetHeight"));s={left:u.left,top:u.top+c}}else s=o.offset();l.show(),n&&l.find(".jl-edtfld-"+n).hide();var h=l.find(".jl-edtfld-"+e);l.offset(s),h.show(),i.focusEditControl(e),n=e}},this.currentField=function(){return n},this.hideEditor=function(){l.hide(),a.el.focus()},this.destroy=function(){a=null}},e.ui.table||(e.ui.table={}),e.ui.table.CellRender=e.Class.create({createHeader:function(e,t){},createCell:function(e,t){},refreshCell:function(e,t,i){}}),e.ui.table.DefaultCellRender=e.Class.create(e.ui.table.CellRender,{createCell:function(e,t){var i=this,l=t.field,n=i._dataset.getField(l);e.parentNode.style.textAlign=n.alignment()},refreshCell:function(e,t,i){if(t&&!t.noRefresh){var l=this,n=t.field;if(n){var a,r=l._dataset.getField(n);try{a=l._dataset.getFieldTextByRecno(i,n)}catch(s){a="error: "+s.message,console.error(s)}if(r.urlExpr()){var o="<a href="+r.calcUrl(),d=r.urlTarget();d&&(o+=" target="+d),o+=">"+a+"</a>",a=o}""!==a&&null!==a&&void 0!==a||(a="&nbsp;");var u=jQuery(e);u.html(a),e.title=u.text(),l._showSelected(e.parentNode,n,i)}}}}),e.ui.table.SequenceCellRender=e.Class.create(e.ui.table.CellRender,{createHeader:function(e,t){e.innerHTML=this._seqColHeader||"&nbsp;"},createCell:function(e,t){jQuery(e.parentNode).addClass("jl-tbl-sequence")},refreshCell:function(e,t){if(t&&!t.noRefresh){var i,l=jQuery(e),n=this.listvm.getCurrentRecno();i=this._reverseSeqCol?this._dataset.recordCount()-n:n+1;var a;this._dataset.existRecordError(n)?(l.parent().addClass("has-error"),a=this._dataset.getRecordErrorInfo(n)):(l.parent().removeClass("has-error"),a=i),e.title=a,l.html(i)}}}),e.ui.table.SelectCellRender=e.Class.create(e.ui.table.CellRender,{createHeader:function(e,t){e.style.textAlign="center";var i=document.createElement("input");i.type="checkbox";var l=this;jQuery(i).addClass("jl-tbl-select-check jl-tbl-select-all").on("click",function(e){l._beforeSelectAll&&l._beforeSelectAll.call(l),l._dataset.selectAll(this.checked?1:0,l._onSelectAll),l._afterSelectAll&&l._afterSelectAll.call(l)}),e.appendChild(i)},createCell:function(e,t){e.style.textAlign="center";var i=this,l=document.createElement("input"),n=jQuery(l);n.attr("type","checkbox").addClass("jl-tbl-select-check"),n.click(i._doSelectBoxClick),e.appendChild(l)},refreshCell:function(e,t,i){if(t&&!t.noRefresh){var l=this,n=e.firstChild;l._dataset.checkSelectable(i)?(n.checked=l._dataset.selectedByRecno(i),n.style.display=""):n.style.display="none"}}}),e.ui.table.EditActionCellRender=e.Class.create(e.ui.table.CellRender,{createHeader:function(e,i){e.style.textAlign="center";var l=this,n=jQuery(e);n.html('<a class="jl-tbl-insert" href="javascript: void(0)" title="'+t.DBTable.appendTip+'"><i class="fa fa-plus"></i></a>'),n.on("click",function(e){window.setTimeout(function(){l._doAppendRecord()},80)})},createCell:function(e,i){e.style.textAlign="center";var l=this,n=jQuery(e);n.html('<a class="jl-tbl-delete" href="javascript: void(0)" title="'+t.DBTable.deleteTip+'"><i class="fa fa-minus"></i></a>'),n.on("click",function(e){
window.setTimeout(function(){l._doDeleteRecord()},80)})}}),e.ui.table.SubgroupCellRender=e.Class.create(e.ui.table.CellRender,{createCell:function(e,t){}}),e.ui.table.BoolCellRender=e.Class.create(e.ui.table.DefaultCellRender,{createCell:function(e,t){var i=jQuery(e);i.css("textAlign","center"),i.html('<i class="fa fa-square-o" aria-hidden="true"></i>')},refreshCell:function(e,t,i){if(t&&!t.noRefresh){var l=jQuery(e),n=this,a=t.field;n._dataset.getField(a);n._dataset.getFieldValueByRecno(i,a)?l.find(".fa-square-o").removeClass("fa-square-o").addClass("fa-check-square-o"):l.find(".fa-check-square-o").removeClass("fa-check-square-o").addClass("fa-square-o"),n._showSelected(e.parentNode,a,i)}}}),e.ui.table.TreeCellRender=e.Class.create(e.ui.table.CellRender,{createCell:function(e,t,i){var l=this,n=document.createElement("div"),a=jQuery(n);n.style.height=l.rowHeight()-2+"px",a.html('<span class="jl-tbltree-indent"></span><a class="jl-tbltree-btn" href="javascript:void()"><i class="fa fa-minus-square-o" aria-hidden="true"></i></a><span class="jl-tbltree-iconhost"></span><span class="jl-tbltree-text"></span>'),e.appendChild(n)},refreshCell:function(t,i,l){if(i&&!i.noRefresh){var n=t.firstChild,a=jQuery(n),r=(n.childNodes,this),s=r.listvm.getLevel(l);e.ui.table.TreeCellRender.iconWidth||(e.ui.table.TreeCellRender.iconWidth=parseInt(e.ui.getCssValue("jl-tbltree-indent","width")));var o=r.listvm.hasChildren(l),d=(o?s:s+1)*e.ui.table.TreeCellRender.iconWidth;a.find(".jl-tbltree-indent").css("width",d+"px");var u=a.find(".jl-tbltree-btn");if(u.css("display",o?"inline-block":"none"),o){var c=r._dataset.expandedByRecno(l);c?u.find(".fa-plus-square-o").removeClass("fa-plus-square-o").addClass("fa-minus-square-o"):u.find(".fa-minus-square-o").removeClass("fa-minus-square-o").addClass("fa-plus-square-o")}if(i.getIconClass){var h=i.getIconClass(s,o);if(h){var f=a.find(".jl-tbltree-iconhost");f.addClass("jl-tbltree-icon "+h)}}var p,_=i.field,v=r._dataset.getField(_);try{p=r._dataset.getFieldTextByRecno(l,_)}catch(m){p="error: "+m.message}if(t.title=p,v.urlExpr()){var g="<a href="+v.calcUrl(),C=v.urlTarget();C&&(g+=" target="+C),g+=">"+p+"</a>",p=g}a.find(".jl-tbltree-text").html(p),r._showSelected(t.parentNode,_,l)}}}),e.ui.table.cellRenders={defaultCellRender:new e.ui.table.DefaultCellRender,treeCellRender:new e.ui.table.TreeCellRender,boolCellRender:new e.ui.table.BoolCellRender,sequenceCellRender:new e.ui.table.SequenceCellRender,selectCellRender:new e.ui.table.SelectCellRender,editActionCellRender:new e.ui.table.EditActionCellRender,subgroupCellRender:new e.ui.table.SubgroupCellRender},e.ui.htmlclass.TABLECLASS={currentrow:"jl-tbl-current",scrollBarWidth:16,selectColWidth:30,hoverrow:"jl-tbl-row-hover"},e.ui.table||(e.ui.table={}),e.ui.table.TableColumn=function(){var e=this;e.field=null,e.label=null,e.title=null,e.prefix=null,e.suffix=null,e.width=null,e.disableHeadSort=!1,e.disableFilter=!1,e.mergeSame=!1,e.noRefresh=!1,e.visible=!0,e.cellRender=null,e.colNum=null,e.displayOrder=null,e.colSpan=null},e.ui.table.TableSubgroup=function(){var e=this;e.hasExpander=!0,e.template=null,e.height=0},e.ui.table.TableHead=function(){var e=this;e.label=null,e.title=null,e.id=null,e.disableHeadSort=!1,e.disableFilter=!1,e.subHeads=null,e.rowSpan=0,e.colSpan=0},e.ui.AbstractDBTable=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,editable,hideHead,disableHeadSort,onlySpecifiedCol,disableMouseWheel,selectBy,rowHeight,footerRowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,beforeSelect,beforeSelectAll,afterSelect,afterSelectAll,onFillRow,onFillCell,treeField,columns,subgroup,aggregated,autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog,autoStretch,minVisibleRows,maxVisibleRowsonAppendRecord,onDeleteRecord,editableFields,readOnlyFields,enableErrorFinding",i._fixedRows=0,i._fixedCols=0,i._hasSeqCol=!0,i._reverseSeqCol=!1,i._seqColHeader=null,i._hasSelectCol=!1,i._noborder=!1,i._editable=!1,i._hideHead=!1,i._onlySpecifiedCol=!1,i._disableHeadSort=!1,i._disableMouseWheel=!1,i._aggregated=!0,i._autoClearSelection=!0,i._selectBy=null,i._rowHeight=null,i._headRowHeight=null,i._footerRowHeight=null,i._treeField=null,i._columns=null,i._editableFields=null,i._readOnlyFields=null,i._onRowClick=null,i._onRowDblClick=null,i._onCellClick=null,i._onSelect=null,i._onSelectAll=null,i._beforeSelect=null,i._afterSelect=null,i._beforeSelectAll=null,i._afterSelectAll=null,i._onFillRow=null,i._onFillCell=null,i._onAppendRecord=null,i._onDeleteRecord=null,i._defaultCellRender=null,i._hasFindDialog=!0,i._hasFilterDialog=!0,i._enableErrorFinding=!1,i._repairHeight=0,i.contentHeight=0,i.subgroup=null,i._sysColumns=null,i._isHoriOverflow=!1,i._oldHeight=null,i._currRow=null,i._currColNum=0,i._editingField=null,i._editorTabIndex=1,i._rowHeightChanged=!1,i._autoStretch=!1,i._minVisibleRows=1,i._maxVisibleRows=0,i._oldVisibleRows=-1,i._cellEditor=null,$super(e,t)},fixedRows:function(t){return void 0===t?this._fixedRows:(e.Checker.test("DBTable.fixedRows",t).isNumber(),this._fixedRows=parseInt(t),this)},fixedCols:function(t){return void 0===t?this._fixedCols:(e.Checker.test("DBTable.fixedCols",t).isNumber(),this._fixedCols=parseInt(t),this)},rowHeight:function(t){var i=this;if(void 0===t){if(null===i._rowHeight){var l=i._editable?"jl-tbl-editing-row":"jl-tbl-row";i._rowHeight=parseInt(e.ui.getCssValue(l,"height"))||25}return i._rowHeight}return e.Checker.test("DBTable.rowHeight",t).isGTZero(),i._rowHeight=parseInt(t),i._rowHeightChanged=!0,this},headRowHeight:function(t){return void 0===t?(null===this._headRowHeight&&(this._headRowHeight=parseInt(e.ui.getCssValue("jl-tbl-header-row","height"))||25),this._headRowHeight):(e.Checker.test("DBTable.headRowHeight",t).isGTZero(),this._headRowHeight=parseInt(t),this)},footerRowHeight:function(t){return void 0===t?(null===this._footerRowHeight&&(this._footerRowHeight=parseInt(e.ui.getCssValue("jl-tbl-footer-row","height"))||20),this._footerRowHeight):(e.Checker.test("DBTable.footerRowHeight",t).isGTZero(),this._footerRowHeight=parseInt(t),this)},hasSeqCol:function(e){return void 0===e?this._hasSeqCol:(this._hasSeqCol=!!e,this)},reverseSeqCol:function(e){return void 0===e?this._reverseSeqCol:(this._reverseSeqCol=!!e,this)},seqColHeader:function(e){return void 0===e?this._seqColHeader:(this._seqColHeader=e,this)},hasSelectCol:function(e){return void 0===e?this._hasSelectCol:(this._hasSelectCol=!!e,this)},noborder:function(e){return void 0===e?this._noborder:(this._noborder=!!e,this)},readOnly:function(e){var t=this;return void 0===e?!t._editable:(t.editable(!e),this)},editable:function(e){var t=this;return void 0===e?t._editable:(t._editable=!!e,t._editable&&!t._rowHeightChanged&&(t._rowHeight=null),this)},hideHead:function(e){return void 0===e?this._hideHead:(this._hideHead=!!e,this)},aggregated:function(e){return void 0===e?this._aggregated:(this._aggregated=!!e,this)},autoClearSelection:function(e){return void 0===e?this._autoClearSelection:(this._autoClearSelection=!!e,this)},disableHeadSort:function(e){return void 0===e?this._disableHeadSort:(this._disableHeadSort=!!e,this)},disableMouseWheel:function(e){return void 0===e?this._disableMouseWheel:(this._disableMouseWheel=!!e,this)},onlySpecifiedCol:function(e){return void 0===e?this._onlySpecifiedCol:(this._onlySpecifiedCol=!!e,this)},selectBy:function(t){return void 0===t?this._selectBy:(e.Checker.test("DBTable.selectBy",t).isString(),this._selectBy=t,this)},treeField:function(t){return void 0===t?this._treeField:(e.Checker.test("DBTable.treeField",t).isString(),this._treeField=t,this)},defaultCellRender:function(t){return void 0===t?this._defaultCellRender:(e.Checker.test("DBTable.defaultCellRender",t).isObject(),this._defaultCellRender=t,this)},currColNum:function(e){var t=this;if(void 0===e)return t._currColNum;var i=t._currColNum;if(t._currColNum=e,i!==e&&(t._adjustCurrentCellPos(i>e),t._showCurrentCell()),t._findDialog){var l=t.innerColumns[e];l.field&&t._findDialog.findingField(l.field)}return this},onRowClick:function(t){return void 0===t?this._onRowClick:(e.Checker.test("DBTable.onRowClick",t).isFunction(),this._onRowClick=t,this)},onRowDblClick:function(t){return void 0===t?this._onRowDblClick:(e.Checker.test("DBTable.onRowDblClick",t).isFunction(),this._onRowDblClick=t,this)},onCellClick:function(t){return void 0===t?this._onCellClick:(e.Checker.test("DBTable.onCellClick",t).isFunction(),this._onCellClick=t,this)},onSelect:function(t){return void 0===t?this._onSelect:(e.Checker.test("DBTable.onSelect",t).isFunction(),this._onSelect=t,this)},onSelectAll:function(t){return void 0===t?this._onSelectAll:(e.Checker.test("DBTable.onSelectAll",t).isFunction(),this._onSelectAll=t,this)},beforeSelect:function(t){return void 0===t?this._beforeSelect:(e.Checker.test("DBTable.beforeSelect",t).isFunction(),this._beforeSelect=t,this)},afterSelect:function(t){return void 0===t?this._afterSelect:(e.Checker.test("DBTable.afterSelect",t).isFunction(),this._afterSelect=t,this)},beforeSelectAll:function(t){return void 0===t?this._beforeSelectAll:(e.Checker.test("DBTable.beforeSelectAll",t).isFunction(),this._beforeSelectAll=t,this)},afterSelectAll:function(t){return void 0===t?this._afterSelectAll:(e.Checker.test("DBTable.afterSelectAll",t).isFunction(),this._afterSelectAll=t,this)},onFillRow:function(t){return void 0===t?this._onFillRow:(e.Checker.test("DBTable.onFillRow",t).isFunction(),this._onFillRow=t,this)},onFillCell:function(t){return void 0===t?this._onFillCell:(e.Checker.test("DBTable.onFillCell",t).isFunction(),this._onFillCell=t,this)},onAppendRecord:function(t){return void 0===t?this._onAppendRecord:(e.Checker.test("DBTable.onAppendRecord",t).isFunction(),this._onAppendRecord=t,this)},onDeleteRecord:function(t){return void 0===t?this._onDeleteRecord:(e.Checker.test("DBTable.onDeleteRecord",t).isFunction(),this._onDeleteRecord=t,this)},hasFindDialog:function(e){var t=this;return void 0===e?t._hasFindDialog:(t._hasFindDialog=!!e,this)},hasFilterDialog:function(e){var t=this;return void 0===e?t._hasFilterDialog:(t._hasFilterDialog=!!e,this)},enableErrorFinding:function(e){return void 0===e?this._enableErrorFinding:(this._enableErrorFinding=!!e,this)},autoStretch:function(e){var t=this;return void 0===e?t._autoStretch:(t._autoStretch=!!e,this)},minVisibleRows:function(t){return void 0===t?this._minVisibleRows:(e.Checker.test("DBTable.minVisibleRows",t).isGTZero(),this._minVisibleRows=parseInt(t),this)},maxVisibleRows:function(t){return void 0===t?this._maxVisibleRows:(e.Checker.test("DBTable.maxVisibleRows",t).isNumber(),this._maxVisibleRows=parseInt(t),this)},cellEditor:function(){var t=this;return t._editable?(t._cellEditor||(t._cellEditor=new e.ui.table.TableCellEditor(t)),t._cellEditor):null},columns:function(t){if(void 0===t)return this._columns;e.Checker.test("DBTable.columns",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("DBTable.Column.field",i.field).isString(),e.Checker.test("DBTable.Column.label",i.label).isString(),e.Checker.test("DBTable.Column.colNum",i.colNum).isGTEZero(),e.Checker.test("DBTable.Column.displayOrder",i.displayOrder).isNumber(),e.Checker.test("DBTable.Column.width",i.width).isGTZero(),e.Checker.test("DBTable.Column.colSpan",i.colSpan).isGTZero(),e.Checker.test("DBTable.Column.prefix",i.prefix).isArray(),e.Checker.test("DBTable.Column.suffix",i.suffix).isArray(),i.field?(i.disableHeadSort=!!i.disableHeadSort,i.disableFilter=!!i.disableFilter):(i.disableHeadSort=!0,i.disableFilter=!0),i.mergeSame=!!i.mergeSame,i.noRefresh=!!i.noRefresh,e.Checker.test("DBTable.Column.cellRender",i.cellRender).isObject();return this._columns=t,this},editableFields:function(t){if(void 0===t)return this._editableFields;e.isString(t)?t=t.split(","):e.Checker.test("DBTable.editableFields",t).isArray();for(var i=0,l=t.length;l>i;i++)e.Checker.test("DBTable.editableFields#fieldName",t[i]).required().isString(),t[i]=t[i].trim();this._editableFields=t},readOnlyFields:function(t){if(void 0===t)return this._readOnlyFields;e.isString(t)?t=t.split(","):e.Checker.test("DBTable.readOnlyFields",t).isArray();for(var i=0,l=t.length;l>i;i++)e.Checker.test("DBTable.readOnlyFields#fieldName",t[i]).required().isString(),t[i]=t[i].trim();this._readOnlyFields=t},gotoField:function(t){e.Checker.test("DBTable.gotoField#fldName",t).required().isString();var i=this.getColNumByField(t);i>=0&&this.gotoColumn(i)},getColNumByField:function(e){for(var t,i=this.innerColumns.length-1,l=0;i>=l;l++)if(t=this.innerColumns[l],t.field==e)return t.colNum;return-1},getFieldByColNum:function(e){for(var t,i=this.innerColumns.length-1,l=0;i>=l;l++)if(t=this.innerColumns[l],t.colNum==e)return t.field;return null},gotoColumn:function(t){e.Checker.test("DBTable.gotoColumn#colNum",t).required().isGTEZero();var i=this.innerColumns.length-1;t>i&&(t=i),this.currColNum(t)},editorTabIndex:function(){return this._editorTabIndex},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},_calcTabIndex:function(){var e=this;jQuery(e.el);if(e._editable){var t=e._dataset.getMasterFieldObject(),i=null;t&&(i=t.tabIndex()),i||(i=e.el.tabIndex),e._editorTabIndex=i&&i>0?i:null}e.el.tabIndex=-1},bind:function(){var t=this;e.ui.resizeEventBus.subscribe(t),e.ui.textMeasurer.setElement(t.el),t.charHeight=e.ui.textMeasurer.getHeight("M")+4,e.ui.textMeasurer.setElement(),t.charWidth=e.global.defaultCharWidth||12,t._widthStyleId=e.nextId(),t._initializeVm(),t._calcTabIndex(),t.renderAll(),t._bindEvents()},_bindEvents:function(){var i=this,l=jQuery(i.el),n="object"==typeof i.el.onmousewheel,a=n?"mousewheel":"DOMMouseScroll";l.on(a,function(t){if(!i._disableMouseWheel){var l=t.originalEvent,a=n?l.wheelDelta/-120:l.detail/3;i._editable&&i._dataset.status()!=e.data.DataSetStatus.BROWSE&&i._dataset.confirm(),i.listvm.setVisibleStartRow(i.listvm.getVisibleStartRow()+a);var r=i.cellEditor();r&&r.hideEditor(),t.preventDefault()}}),l.on("mousedown",function(e){return e.shiftKey?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}),l.on("click","button.jl-tbl-filter",function(l){i._filterPanel||(i._filterPanel=new e.ui.table.DBTableFilterPanel(i));var n=l.currentTarget,a=jQuery(n),r=jQuery(i.el).offset(),s=a.offset(),o=a.outerHeight(),d=s.left-r.left,u=s.top+o-r.top;t.isRtl&&(d+=a.outerWidth());var c=a[0].getAttribute("jsletfilterfield");i._filterPanel.changeField(c),i._filterPanel.jqFilterBtn(a),i._filterPanel.show(d,u,0,o),l.preventDefault(),l.stopImmediatePropagation()}),l.on("dblclick","td.jl-tbl-cell",function(e){var t=e.currentTarget;i._doDblCellClick(t,e.offsetY)}),l.on("mousedown","td.jl-tbl-cell",function(e){var t=e.currentTarget,l=e.offsetY;return e.target!=t&&(l=jQuery(e.target).offset().top-jQuery(t).offset().top+e.offsetY),i._doCellClick(t,l,e),e.shiftKey||e.ctrlKey?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}),l.on("click",".jl-tbltree-btn",function(t){function l(e){return e.tagName&&"tr"==e.tagName.toLowerCase()&&(e.jsletrecno||0===e.jsletrecno)}function n(){i._fillData()}var a=e.ui.findFirstParent(this,l);t.stopImmediatePropagation(),t.preventDefault();var r=a.jsletrecno;return i._dataset.recno(r),i._dataset.aborted()?!1:(i._dataset.expandedByRecno(r)?i.listvm.collapse(n):i.listvm.expand(n),!1)}),l.on("keydown",function(t){var l=t.which,n=t.ctrlKey,a=t.shiftKey,r=t.altKey;if(n){var s=!1;if(i._hasFindDialog&&l===e.ui.KeyCode.F&&(i.showFindDialog(),s=!0),l===e.ui.KeyCode.E&&(i._enableErrorFinding||i._editable)&&(i.gotoNextError(),s=!0),l===e.ui.KeyCode.A&&(i.selectAllCells(),s=!0),l===e.ui.KeyCode.HOME&&(i._dataset.first(),s=!0),l===e.ui.KeyCode.END&&(i._dataset.last(),s=!0),l===e.ui.KeyCode.C)return void i.copySelection(!1);if(s)return t.preventDefault(),t.stopImmediatePropagation(),!1}var o=l===e.ui.KeyCode.TAB||l===e.global.defaultFocusKeyCode;if(a&&o){if(!i.tabPrior())return}else if(o){if(!i.tabNext())return}else if(l===e.ui.KeyCode.LEFT)i.movePriorCell(n,a,r);else if(l===e.ui.KeyCode.RIGHT)i.moveNextCell(n,a,r);else if(l===e.ui.KeyCode.UP)i._doBeforeSelect(n,a,r),i.listvm.priorRow(),i._processSelection(n,a,r);else if(l===e.ui.KeyCode.DOWN)i._doBeforeSelect(n,a,r),i.listvm.nextRow(),i._processSelection(n,a,r);else if(l===e.ui.KeyCode.PAGEUP)i.listvm.priorPage();else{if(l!==e.ui.KeyCode.PAGEDOWN)return;i.listvm.nextPage()}(l!==e.ui.KeyCode.ENTER||i._editable)&&(t.preventDefault(),t.stopImmediatePropagation())}),i._createContextMenu()},_createContextMenu:function(){if(e.ui.Menu){var i=this,l={type:"Menu",onItemClick:jQuery.proxy(i._menuItemClick,i),items:[]};l.items.push({id:"selectAll",name:t.DBTable.selectAll}),l.items.push({id:"copy",name:t.DBTable.copy}),l.items.push({name:"-"}),i._hasFindDialog&&l.items.push({id:"find",name:t.DBTable.find}),l.items.push({id:"fixed",name:t.DBTable.fixed,items:[{id:"fixedCol",name:t.DBTable.fixedCol},{id:"fixedRow",name:t.DBTable.fixedRow}]}),(i._enableErrorFinding||i._editable)&&(l.items.push({name:"-"}),l.items.push({id:"nextError",name:t.DBTable.nextError})),i._onCreateContextMenu&&i._onCreateContextMenu.call(i,l.items),0!==l.items.length&&(i.contextMenu=e.ui.createControl(l),jQuery(i.el).on("contextmenu",".jl-tbl-cell",function(e){i.contextMenu.showContextMenu(e,i)}))}},_menuItemClick:function(i,l){var n=i.id,a=this;"selectAll"==n?a.selectAllCells():"find"==n?a.showFindDialog():"fixedRow"==n?(a.fixedRows(a._dataset.recno()+1),a.renderAll()):"fixedCol"==n?(a.fixedCols(a._currColNum+1),a.renderAll()):"copy"==n?e.ui.info(t.DBTable.copyInfo):"nextError"==n&&a.gotoNextError()},showFindDialog:function(){var t=this;if(t._filterPanel&&t._filterPanel.hide(),t._hasFindDialog){if(t._findDialog||(t._findDialog=new e.ui.table.FindDialog(t)),!t._findDialog.findingField()){var i=t.innerColumns[t._currColNum];if(i.field)t._findDialog.findingField(i.field);else for(var l=t._currColNum+1,n=t.innerColumns.length;n>l;l++)if(i=t.innerColumns[l],i.field){t._findDialog.findingField(i.field);break}}return t._findDialog.findingField()&&t._findDialog.show(0,t.headSectionHt),this}},gotoNextError:function(){var e=this;return e._dataset.nextError()||e._dataset.firstError(),this},copySelection:function(t){var i,l=this;if(i=t?l._dataset.selection.getSelectionText('"',!0,"	"):l._dataset.selection.getSelectionText("",!1,"	"),!i){var n=l.getFieldByColNum(l._currColNum);n&&(i=l._dataset.getFieldText(n))}return i&&(e.Clipboard.putText(i),window.setTimeout(function(){l.el.focus()},5)),this},selectAllCells:function(){for(var e,t,i=this,l=[],n=0,a=i.innerColumns.length;a>n;n++)e=i.innerColumns[n],t=e.field,t&&l.push(t);return i._dataset.selection.selectAll(l,!0),i._refreshSelection(),this},tabPrior:function(){var t,i=this,l=i.getFieldByColNum(i._currColNum),n=null,a=i._dataset.focusedFields(),r=i._getEditingFields();if(r&&r.indexOf(l)>=0){var s=e.ui.globalFocusManager,o=s.onChangingFocus();if(a){a=a.slice(0);for(var d=a.length-1;d>=0;d--)r.indexOf(a[d])<0&&a.splice(d,1)}var u,c=-1;if(a&&(u=a,c=u.indexOf(l)),0>c&&(u=r,c=u.indexOf(l)),o){var h=o(document.activeElement||i.el,!0,i._dataset,s.activeField(),u,s.activeValueIndex());if(!h)return!0}if(u&&c>=0){if(0===c){if(!(i._dataset.recno()>0))return!1;i._dataset.prior(),l=u[u.length-1]}else l=u[c-1];n=i.getColNumByField(l)}}if(null===n)if(t=i.innerColumns.length-1,0===i._currColNum){if(!(i._dataset.recno()>0))return!1;i._dataset.prior(),n=t}else n=i._currColNum-1;return i.currColNum(n),!0},tabNext:function(){var t,i=this,l=i.getFieldByColNum(i._currColNum),n=null,a=i._dataset.focusedFields(),r=i._getEditingFields();if(r&&r.indexOf(l)>=0){var s=e.ui.globalFocusManager,o=s.onChangingFocus();if(a){a=a.slice(0);for(var d=a.length-1;d>=0;d--)r.indexOf(a[d])<0&&a.splice(d,1)}var u,c=-1;if(a&&(u=a,c=u.indexOf(l)),0>c&&(u=r,c=u.indexOf(l)),o){var h=o(document.activeElement||i.el,!1,i._dataset,s.activeField(),u,s.activeValueIndex());if(!h)return!0}if(u&&c>=0){if(c===u.length-1){if(!(i._dataset.recno()<i._dataset.recordCount()-1))return!1;i._dataset.next(),l=u[0]}else l=u[c+1];n=i.getColNumByField(l)}}if(null===n)if(t=i.innerColumns.length-1,i._currColNum<t)n=i._currColNum+1;else{if(i._dataset.recno()===i._dataset.recordCount()-1)return!1;i._dataset.next(),n=0}return i.currColNum(n),!0},movePriorCell:function(e,t,i){var l,n=this,a=n.innerColumns.length-1;if(0===n._currColNum){if(!(n._dataset.recno()>0))return;n._dataset.prior(),l=a}else l=n._currColNum-1;return n._doBeforeSelect(e,t,i),n.currColNum(l),n._processSelection(e,t,i),this},moveNextCell:function(e,t,i){var l,n=this,a=n.innerColumns.length-1;if(n._currColNum<a)l=n._currColNum+1;else{if(n._dataset.recno()===n._dataset.recordCount()-1)return;n._dataset.next(),l=0}return n._doBeforeSelect(e,t,i),n.currColNum(l),n._processSelection(e,t,i),this},_getEditingFields:function(){var e=this;if(!e._editable)return null;for(var t,i,l=e._dataset,n=null,a=0,r=e.innerColumns.length;r>a;a++)t=e.innerColumns[a].field,t&&(i=l.getField(t),i.disabled()||i.readOnly()||(n||(n=[]),n.push(t)));return n},_initializeVm:function(){var t=this;t.listvm=new e.ui.ListViewModel(t._dataset,!!t._treeField),t.listvm.onTopRownoChanged=function(e){0>e||(t._fillData(),t._syncScrollBar(e),t._showCurrentRow())},t.listvm.onVisibleCountChanged=function(){t.renderAll()},t.listvm.onCurrentRownoChanged=function(i,l){if(t._hideCurrentRow(),0===t._dataset.recordCount())return void(t._currRow=null);t._dataset.recno(t.listvm.getCurrentRecno());var n,a=t._getTrByRowno(l);if(a&&(n=a.fixed,n&&jQuery(n).addClass(e.ui.htmlclass.TABLECLASS.currentrow),n=a.content,jQuery(n).addClass(e.ui.htmlclass.TABLECLASS.currentrow),t._currRow=a,t._editable)){var r=t._editingField;if(r){var s=t._dataset.getField(r);!s||s.disabled()||s.readOnly()||t._dataset.focusEditControl(r)}}}},renderAll:function(){var e=this;return e._innerDestroy(),e.el.innerHTML="",e.listvm.fixedRows=e._fixedRows,e._calcParams(),e.listvm.refreshModel(),e._createFrame(),e._fillData(),e._showCurrentRow(!0),e._oldHeight=jQuery(e.el).height(),e._updateSortFlag(!0),this},_doBeforeSelect:function(e,t,i){},_getSelectionFields:function(e,t){if(e>t){var i=e;e=t,t=i}for(var l,n,a,r=[],s=0,o=this.innerColumns.length;o>s;s++)n=this.innerColumns[s],a=n.colNum,a>=e&&t>=a&&(l=n.field,l&&r.push(l));return r},_processSelection:function(e,t,i){var l,n=this,a=n._dataset.recno();if(e||!n._autoClearSelection)return l=n.innerColumns[n._currColNum].field,l&&(n._dataset.selection.isSelected(a,l)?n._dataset.selection.remove(a,a,[l],!0):n._dataset.selection.add(a,a,[l],!0),n._refreshSelection()),n._preRecno=a,void(n._preColNum=n._currColNum);if(t){var r;n._preTmpRecno>=0&&n._preTmpColNum>=0&&(r=n._getSelectionFields(n._preColNum||0,n._preTmpColNum),n._dataset.selection.remove(n._preRecno||0,n._preTmpRecno,r,!1)),r=n._getSelectionFields(n._preColNum||0,n._currColNum),n._dataset.selection.add(n._preRecno||0,a,r,!0),n._refreshSelection(),n._preTmpRecno=a,n._preTmpColNum=n._currColNum}else n._preRecno=a,n._preColNum=n._currColNum,n._preTmpRecno=a,n._preTmpColNum=n._currColNum,n._autoClearSelection&&(n._dataset.selection.removeAll(),n._refreshSelection())},_processColumnSelection:function(e,t,i,l){if(t||i){var n=this,a=n._dataset.recordCount();if(0!==a){var r,s;if(i)n._preTmpColNum>=0&&(r=n._getSelectionFields(n._preColNum||0,n._preTmpColNum),n._dataset.selection.remove(0,a,r,!0)),s=e.colNum+e.colSpan-1,r=n._getSelectionFields(n._preColNum||0,s),n._dataset.selection.add(0,a,r,!0),n._preTmpColNum=s;else{if(!t&&n._autoClearSelection&&n._dataset.selection.removeAll(),e.colSpan>1){r=[];var o,d=e.colNum,u=e.colNum+e.colSpan;for(s=d;u>s;s++)o=n.innerColumns[s].field,r.push(o)}else r=[e.field];n._dataset.selection.add(0,a,r,!0),n._preColNum=e.colNum}n._refreshSelection()}}},_processRowSelection:function(e,t,i){if(e||t){var l=this,n=l._getSelectionFields(0,l.innerColumns.length-1),a=l._dataset.recno();t?(l._preTmpRecno>=0&&l._dataset.selection.remove(l._preRecno||0,l._preTmpRecno,n,!0),l._dataset.selection.add(l._preRecno||0,a,n,!0),l._preTmpColNum=a):(!e&&l._autoClearSelection&&l._dataset.selection.removeAll(),l._dataset.selection.add(a,a,n,!0),l._preRecno=a),l._refreshSelection()}},_prepareColumn:function(){function t(e){if(l._columns)for(var t=0,n=l._columns.length;n>t;t++)if(i=l._columns[t],i.field&&i.field==e)return i;return null}var i,l=this;l._sysColumns=[],l._hasSeqCol&&(i={label:"&nbsp;",width:l.seqColWidth,disableHeadSort:!0,isSeqCol:!0,cellRender:e.ui.table.cellRenders.sequenceCellRender,widthCssName:l._widthStyleId+"-s0"},l._sysColumns.push(i)),l._hasSelectCol&&(i={label:'<input type="checkbox" />',width:l.selectColWidth,disableHeadSort:!0,isSelectCol:!0,cellRender:e.ui.table.cellRenders.selectCellRender,widthCssName:l._widthStyleId+"-s1"},l._sysColumns.push(i)),l.subgroup&&l.subgroup.hasExpander&&(i={label:"&nbsp;",width:l.selectColWidth,disableHeadSort:!0,isSubgroup:!0,cellRender:e.ui.table.cellRenders.subgroupCellRender,widthCssName:l._widthStyleId+"-s2"},l._sysColumns.push(i));var n,a=[];if(l._columns)for(var r=0,s=l._columns.length;s>r;r++){if(i=l._columns[r],i.field){if(n=l._dataset.getField(i.field),!n)throw new Error("Not found Field: "+i.field);i.displayOrder=n.displayOrder()}else i.disableHeadSort=!0;a.push(i)}var o,d,u,c;if(!l._onlySpecifiedCol){var h=l._dataset.getFields();for(o=0,d=h.length;d>o;o++)n=h[o],c=n.name(),n.visible()&&(i=t(c),i||(i=new e.ui.table.TableColumn,i.field=n.name(),i.displayOrder=n.displayOrder(),a.push(i)));if(l._columns)for(o=0,u=l._columns.length;u>o;o++)if(i=l._columns[o],i.field){if(n=l._dataset.getTopField(i.field),!n)throw new Error("Field: "+i.field+" doesn't exist!");var f=n.children();if(f&&f.length>0){c=n.name();var p=!0;if(i.field!=c)for(var _=0;_<a.length;_++)if(a[_].field==c){p=!1;break}p&&(i=new e.ui.table.TableColumn,i.field=c,i.displayOrder=n.displayOrder(),a.push(i))}}}a.sort(function(e,t){var i=e.displayOrder||0,l=t.displayOrder||0;return i===l?0:l>i?-1:1}),l.innerHeads=[],l.innerColumns=[];var v,m,g={lastColNum:0,depth:0};for(o=0,u=a.length;u>o;o++)i=a[o],c=i.field,c?(n=l._dataset.getField(c),l._convertField2Head(g,n)):(v=new e.ui.table.TableHead,m=i.label,v.label=m?m:"",v.level=0,v.colNum=g.lastColNum++,i.colNum=v.colNum,v.id=e.nextId(),v.widthCssName=l._widthStyleId+"-"+v.colNum,i.widthCssName=v.widthCssName,v.disableHeadSort=i.disableHeadSort,l.innerHeads.push(v),l.innerColumns.push(i));l.maxHeadRows=g.depth+1,l._calcHeadSpan();var C,b=0,y=l._fixedCols-l._sysColumns.length;for(u=0,o=1,C=l.innerHeads.length;C>o&&(v=l.innerHeads[o],u+=v.colSpan,!(b>=y||y==u));o++)u>y&&y>b&&(l._fixedCols=b+l._sysColumns.length),b=u},_calcHeadSpan:function(e){var t=this;e||(e=t.innerHeads);for(var i,l=0,n=0,a=e.length;a>n;n++)i=e[n],i.rowSpan=t.maxHeadRows-i.level,i.subHeads?(i.colSpan=t._calcHeadSpan(i.subHeads),l+=i.colSpan):(i.colSpan=1,l++);return l},_convertField2Head:function(t,i,l){function n(e){var t=/<[^>]+>/g;return t.test(e)}var a=this;if(!i.visible())return!1;var r,s=0;l?(s=l.level+1,r=l.subHeads):r=a.innerHeads;var o,d=i.name();o=new e.ui.table.TableHead,o.label=i.displayLabel(),o.field=d,o.level=s,o.colNum=t.lastColNum,o.id=e.nextId(),r.push(o),t.depth=Math.max(s,t.depth);var u=i.children();if(u&&u.length>0){o.subHeads=[];for(var c=0,h=u.length;h>c;c++)a._convertField2Head(t,u[c],o)}else{t.lastColNum++;for(var f,p=!1,_=a._columns?a._columns.length:0,v=0;_>v;v++)if(f=a._columns[v],f.field==d){p=!0;break}p||(f=new e.ui.table.TableColumn,f.field=d),f.label||(f.label=i.displayLabel());var m=i.getType();if(m===e.data.DataType.BOOLEAN&&(f.isBoolColumn=!0),f.mergeSame=i.mergeSame(),f.colNum=o.colNum,!f.width){var g=i?i.displayWidth():0;!a._hideHead&&f.label&&(g=n(f.label)?Math.max(g,jQuery(f.label).text().length):Math.max(g,f.label.length)),f.width=g?g*a.charWidth:10}f.cellRender||(m===e.data.DataType.BOOLEAN?f.cellRender=e.ui.table.cellRenders.boolCellRender:m===e.data.DataType.EDITACTION?o.cellRender=f.cellRender=e.ui.table.cellRenders.editActionCellRender:f.field==a._treeField&&(f.cellRender=e.ui.table.cellRenders.treeCellRender)),m!==e.data.DataType.ACTION&&m!==e.data.DataType.EDITACTION||(o.disableHeadSort=!0,o.disableFilter=!0),o.widthCssName=a._widthStyleId+"-"+o.colNum,f.widthCssName=o.widthCssName,a.innerColumns.push(f)}return!0},_calcParams:function(){var t=this;if(t._currColNum=0,t._preTmpColNum=-1,t._preTmpRecno=-1,t._preRecno=-1,t._preColNum=-1,t._treeField&&(t._disableHeadSort=!0),t._hasSeqCol){t.seqColWidth=(""+t._dataset.recordCount()).length*t.charWidth+5;var i=e.ui.htmlclass.TABLECLASS.selectColWidth;t.seqColWidth=t.seqColWidth>i?t.seqColWidth:i}else t.seqColWidth=0;if(t._hasSelectCol?t.selectColWidth=e.ui.htmlclass.TABLECLASS.selectColWidth:t.selectColWidth=0,t._fixedRows>0?t.fixedSectionHt=t._fixedRows*t.rowHeight():t.fixedSectionHt=0,t.aggregated()&&t.dataset().checkAggregated()?t.footSectionHt=t.footerRowHeight():t.footSectionHt=0,t._prepareColumn(),t._fixedCols&&t._fixedCols>t.innerColumns.length&&(t._fixedCols=t.innerColumns.length),t.hasFixedCol=t._sysColumns.length>0||t._fixedCols>0,t.hasFixedCol){var l,n,a=0;for(l=0,n=t._sysColumns.length;n>l;l++)a+=t._sysColumns[l].width+1;for(l=0,n=t._fixedCols;n>l;l++)a+=t.innerColumns[l].width+1;t.fixedColWidth=a+1}else t.fixedColWidth=0},_setScrollBarMaxValue:function(e){var t=this,i=e+t._repairHeight+(t._autoStretch?t.footSectionHt:0);t.jqVScrollBar.find("div").height(i),t.contentSectionHt>=i?t.jqVScrollBar.parent().addClass("jl-scrollbar-hidden"):t.jqVScrollBar.parent().removeClass("jl-scrollbar-hidden")},_changeColWidthCssRule:function(e,t){var i=this,l=document.getElementById(i._widthStyleId),n=l.styleSheet||l.sheet,a=n.cssRules||n.rules,r=null,s=!1;e="."+e;for(var o=0,d=a.length;d>o;o++)if(r=a[o],r.selectorText==e){s=!0;break}return s&&(r.style.width=t+"px"),s},_changeColWidth:function(e,t){var i=this,l=i.innerColumns[e];if(!(l.width+t<=0)){if(l.width+=t,l.field){i._dataset.designMode(!0);try{i._dataset.getField(l.field).displayWidth(Math.round(l.width/i.charWidth))}finally{i._dataset.designMode(!1)}}i._changeColWidthCssRule(l.widthCssName,l.width)&&i._changeContentWidth(t)}},_refreshSeqColWidth:function(){var t=this;if(t._hasSeqCol){var i=t.seqColWidth;t.seqColWidth=(""+t._dataset.recordCount()).length*t.charWidth;var l=e.ui.htmlclass.TABLECLASS.selectColWidth;if(t.seqColWidth=t.seqColWidth>l?t.seqColWidth:l,t.seqColWidth!=i){for(var n,a=0,r=t._sysColumns.length;r>a&&(n=t._sysColumns[a],!n.isSeqCol);a++);n.width=t.seqColWidth,t._changeColWidthCssRule(n.widthCssName,t.seqColWidth);var s=t.seqColWidth-i;t._changeContentWidth(s,!0)}}},_changeContentWidth:function(e,t){var i=this,l=i.getTotalWidth(t),n=l+"px";t?(i.fixedColWidth=l,i.leftHeadTbl.parentNode.parentNode.style.width=i.fixedColWidth+1+"px",i.leftHeadTbl.parentNode.style.width=n,i.leftFixedTbl.parentNode.style.width=n,i.leftContentTbl.parentNode.style.width=n):(i.rightHeadTbl.parentNode.style.width=n,i.rightFixedTbl.parentNode.style.width=n,i.rightContentTbl.parentNode.style.width=n,i.footSectionHt&&(i.rightFootTbl.style.width=n)),i._checkHoriOverflow()},_createFrame:function(){function i(){var e,t,i,l=['<style type="text/css" id="'+n._widthStyleId+'">\n'];for(t=0,i=n._sysColumns.length;i>t;t++)e=n._sysColumns[t],l.push("."+e.widthCssName+"{width:"+e.width+"px}\n");for(t=0,i=n.innerColumns.length;i>t;t++)e=n.innerColumns[t],l.push("."+e.widthCssName+"{width:"+e.width+"px}\n");return l.push("</style>"),l.join("")}function l(e){var t=e.jsletColCfg,i=d.rowIndex,l=d.cellIndex,a=e.parentNode.rowIndex,r=e.cellIndex,s=i==a&&r!=l;if(!s)return s;var o=d.fieldName,u=t.field,c=n._dataset.getField(o).parent(),h=u&&n._dataset.getField(u).parent();return s=c===h||h&&c.name()==h.name()}var n=this;n.el.style.position="relative";var a=jQuery(n.el);a.hasClass("jl-table")||a.addClass("jl-table jl-border-box jl-round5"),n._noborder&&a.addClass("jl-tbl-noborder");var r=['<div class="jl-tbl-splitter" style="display: none"></div>',i(),'<div class="jl-tbl-norecord">',t.DBTable.norecord,"</div>",'<table class="jl-tbl-container"><tr>','<td><div class="jl-tbl-fixedcol"><table class="jl-tbl-data"><tbody /></table><table class="jl-tbl-data"><tbody /></table><div class="jl-tbl-content-div"><table class="jl-tbl-data"><tbody /></table><table><tbody /></table></div></div></td>','<td><div class="jl-tbl-contentcol"><div><table class="jl-tbl-data jl-tbl-content-table" border="0" cellpadding="0" cellspacing="0"><tbody /></table></div><div><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><div class="jl-tbl-content-div"><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table><table class="jl-tbl-content-table jl-tbl-footer"><tbody /></table></div></div></td>','<td class="jl-scrollbar-col"><div class="jl-tbl-vscroll-head"></div><div class="jl-tbl-vscroll"><div /></div></td></tr></table>'];
a.html(r.join(""));var s=a.find(".jl-tbl-fixedcol")[0].childNodes;n.leftHeadTbl=s[0],n.leftFixedTbl=s[1],n.leftContentTbl=s[2].firstChild,n.leftFootTbl=s[2].children[1],s=a.find(".jl-tbl-contentcol")[0].childNodes,n.rightHeadTbl=s[0].firstChild,n.rightFixedTbl=s[1].firstChild,n.rightContentTbl=s[2].firstChild,n.rightFootTbl=s[2].children[1],n.height=a.height(),n.height<=1&&!n._autoStretch&&(n.height=200,a.height(200)),n._hideHead&&(n.leftHeadTbl.style.display="none",n.rightHeadTbl.style.display="none",a.find(".jl-tbl-vscroll-head").css("display","none")),n._fixedRows<=0&&(n.leftFixedTbl.style.display="none",n.rightFixedTbl.style.display="none"),n.footSectionHt||(n.leftFootTbl.style.display="none",n.rightFootTbl.style.display="none"),n.leftHeadTbl.parentNode.parentNode.style.width=n.fixedColWidth+"px";var o=jQuery(n.rightHeadTbl);o.off();o.on("mousedown",n._doSplitHookDown),o.on("mouseup",n._doSplitHookUp);jQuery(n.leftHeadTbl).on("mousedown",".jl-tbl-header-cell",function(e){if(e=jQuery.event.fix(e||window.event),!e.button){var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&n._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}}),o.on("mousedown",".jl-tbl-header-cell",function(e){if(!e.button){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&n._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}}),jQuery(n.leftHeadTbl).on("mouseup",".jl-focusable-item",function(e){if(!e.button){e=jQuery.event.fix(e||window.event);e.target;if(!n.isDraggingColumn)return n._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),n._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1}}),o.on("mouseup",".jl-focusable-item",function(e){if(!e.button){e=jQuery.event.fix(e||window.event);e.target;if(!n.isDraggingColumn)return n._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),n._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1}});var d=null;o.on("dragstart",".jl-focusable-item",function(e){n._filterPanel&&n._filterPanel.hide();var t=this.parentNode.parentNode.parentNode,i=t.jsletColCfg,l=e.originalEvent,a=l.dataTransfer;return a.dropEffect="link",a.effectAllowed="link",d={fieldName:i.field,rowIndex:t.parentNode.rowIndex,cellIndex:t.cellIndex},a.setData("fieldName",i.field),!0}),o.on("dragover",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!d)return!1;var t=this.parentNode,i=e.originalEvent,n=i.dataTransfer;return l(t)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),n.dropEffect="link"):n.dropEffect="move",!1}),o.on("dragenter",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!d)return!1;var t=this.parentNode,i=e.originalEvent,n=i.dataTransfer;return l(t)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),n.dropEffect="link"):n.dropEffect="move",!1}),o.on("dragleave",".jl-tbl-header-cell .jl-tbl-header-div",function(e){return d?(jQuery(e.currentTarget).removeClass("jl-tbl-col-over"),!1):!1}),o.on("drop",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!d)return!1;jQuery(e.currentTarget).removeClass("jl-tbl-col-over");var t=this.parentNode,i=e.originalEvent,a=(i.dataTransfer,t.jsletColCfg,d.rowIndex),r=d.cellIndex,s=(t.parentNode.rowIndex,t.cellIndex);if(l(t)){var o=this.parentNode.jsletColCfg.field;if(o){d.fieldName;return n._moveColumn(a,r,s),!1}}});var u=jQuery(n.leftFixedTbl),c=jQuery(n.rightFixedTbl),h=jQuery(n.leftContentTbl),f=jQuery(n.rightContentTbl);u.off(),u.on("mouseenter","tr",function(){jQuery(this).addClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(c[0].rows[this.rowIndex]).addClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),u.on("mouseleave","tr",function(){jQuery(this).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(c[0].rows[this.rowIndex]).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),c.off(),c.on("mouseenter","tr",function(){jQuery(this).addClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(u[0].rows[this.rowIndex]).addClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),c.on("mouseleave","tr",function(){jQuery(this).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(u[0].rows[this.rowIndex]).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),h.off(),h.on("mouseenter","tr",function(){jQuery(this).addClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(f[0].rows[this.rowIndex]).addClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),h.on("mouseleave","tr",function(){jQuery(this).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow),jQuery(f[0].rows[this.rowIndex]).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),f.off(),f.on("mouseenter","tr",function(){jQuery(this).addClass(e.ui.htmlclass.TABLECLASS.hoverrow);var t=n._fixedRows>0||n._sysColumns.length>0;t&&jQuery(h[0].rows[this.rowIndex]).addClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),f.on("mouseleave","tr",function(){jQuery(this).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow);var t=n._fixedRows>0||n._sysColumns.length>0;t&&jQuery(h[0].rows[this.rowIndex]).removeClass(e.ui.htmlclass.TABLECLASS.hoverrow)}),n.jqVScrollBar=a.find(".jl-tbl-vscroll"),n.jqVScrollBar.width(e.ui.scrollbarSize()+1),n.jqVScrollBar.off().on("scroll",function(){if(!n._keep_silence_){n._editable&&n._dataset.status()!=e.data.DataSetStatus.BROWSE&&n._dataset.confirm();var t=Math.round(this.scrollTop/n.rowHeight());if(t!=n.listvm.getVisibleStartRow()){n._keep_silence_=!0;try{n.listvm.setVisibleStartRow(t),n._showCurrentRow();var i=n.cellEditor();i&&i.hideEditor()}finally{n._keep_silence_=!1}}}}),a.find(".jl-tbl-contentcol").off().on("scroll",function(){if(n._isCurrCellInView()){e.temp.focusing=!0;try{n._showCurrentCell()}finally{e.temp.focusing=!1}}else{var t=n.cellEditor();t&&t.hideEditor()}n._filterPanel&&n._filterPanel.hide()});var p=a.find(".jl-tbl-splitter")[0];p._doDragStart=function(){this.style.display="block",n._filterPanel&&n._filterPanel.hide()},p._doDragging=function(e,t,i,l,n,a){var r=parseInt(jQuery(document.body).css("margin-left")),s=p.parentNode.jslet,o=s.innerColumns[s.currColId];o.width+n<=40||(p.style.left=i-jQuery(p.parentNode).offset().left-r+"px")},p._doDragEnd=function(e,t,i,l,n,a){var r=p.parentNode.jslet,s=r.cellEditor();s&&s.hideEditor(),r._changeColWidth(r.currColId,n),p.style.display="none",p.parentNode.jslet.isDraggingColumn=!1},p._doDragCancel=function(){p.style.display="none",p.parentNode.jslet.isDraggingColumn=!1},n.footSectionHt&&(n.leftFootTbl.style.display="",n.rightFootTbl.style.display=""),n._renderHeader(),n._hideHead?n.headSectionHt=0:n.headSectionHt=n.maxHeadRows*n.headRowHeight(),n._changeContentWidth(0),n.noRecordDiv=a.find(".jl-tbl-norecord")[0],n.noRecordDiv.style.top=n.headSectionHt+"px",n.noRecordDiv.style.left=a.find(".jl-tbl-fixedcol").width()+5+"px",a.find(".jl-tbl-vscroll-head").height(n.headSectionHt+n.fixedSectionHt),n._renderBody()},_moveColumn:function(e,t,i){function l(e,t,i,l,n){var a,r,s,o=0,d=[],u=[];for(r=0,s=e.length;s>r;r++){if(a=e[r],o>=t&&i>=o)d.push(a);else if(o>=l&&n>=o)u.push(a);else if(o>i&&o>n)break;o+=a.colSpan||1}var c;if(t>l)for(c=u[0],r=0,s=d.length;s>r;r++)jQuery(d[r]).insertBefore(c);else for(c=u[u.length-1],r=d.length;r>=0;r--)jQuery(d[r]).insertAfter(c)}function n(e,t,i,n,a,r){var s=e.length;if(0!==s&&s!==t)for(var o,d=t,u=e.length;u>d;d++)o=e[d],l(o.cells,i,n,a,r)}for(var a,r=this,s=r.rightHeadTbl.createTHead().rows,o=s[e],d=0,u=0,c=0,h=0,f=0,p=0,_=0,v=o.cells.length;v>_;_++)a=o.cells[_],f=p,p+=a.colSpan||1,_===t&&(d=f,u=p-1),_===i&&(c=f,h=p-1);var m=o.cells[t],g=o.cells[i],C=m.jsletColCfg,b=g.jsletColCfg,y=C.field,j=b.field;if(y&&j){r._dataset.designMode(!0);try{r._dataset.moveField(y,j)}finally{r._dataset.designMode(!1)}}var w=r.getFieldByColNum(r._currColNum),x=r.rightContentTbl.tBodies[0].rows;r._changeColNum(x[0],d,u,c,h);var D=r.rightHeadTbl.createTHead().rows;n(D,e,d,u,c,h),n(r.rightFixedTbl.tBodies[0].rows,0,d,u,c,h),n(x,0,d,u,c,h),n(r.rightFootTbl.tBodies[0].rows,0,d,u,c,h),r._dataset.selection.removeAll(),r._refreshSelection(),r.gotoField(w)},_changeColNum:function(e,t,i,l,n){if(e){var a,r,s,o=0,d=[],u=[],c=e.cells;for(r=0,s=c.length;s>r;r++){if(a=c[r],o>=t&&i>=o)d.push(a);else if(o>=l&&n>=o)u.push(a);else if(o>i&&o>n)break;o+=a.colSpan||1}var h,f=d.length,p=u.length,_=u[0].jsletColCfg.colNum,v=0;if(t>l){for(r=t;i>=r;r++)h=c[r].jsletColCfg,h.colNum=_+v++;for(r=l;t>r;r++)h=c[r].jsletColCfg,h.colNum=h.colNum+f}else{var m=_-f+p;for(r=t;i>=r;r++)h=c[r].jsletColCfg,h.colNum=m+v++;for(r=i+1;n>=r;r++)h=c[r].jsletColCfg,h.colNum=h.colNum-f}}},_calcAndSetContentHeight:function(){var t,i=this,l=jQuery(i.el),n=i.rowHeight();if(i._autoStretch){if(t=i._dataset.recordCount()-i._fixedRows,i._oldVisibleRows===t)return;i._maxVisibleRows>0&&t>i._maxVisibleRows&&(t=i._maxVisibleRows),t<i._minVisibleRows&&(t=i._minVisibleRows),i.contentSectionHt=n*t+i.footSectionHt,i._repairHeight=0,i._oldVisibleRows=t,i.listvm.setVisibleCount(t,!0)}else i.contentSectionHt=i.height-i.headSectionHt-i.fixedSectionHt,i._isHoriOverflow&&(i.contentSectionHt-=e.ui.htmlclass.TABLECLASS.scrollBarWidth),t=Math.floor((i.contentSectionHt-i.footSectionHt)/n),i.listvm.setVisibleCount(t,!0),i._repairHeight=i.contentSectionHt-t*n;l.find(".jl-tbl-content-div").height(i.contentSectionHt),i.jqVScrollBar.height(i.contentSectionHt),i._setScrollBarMaxValue(i.listvm.getNeedShowRowCount()*n)},_stretchContentHeight:function(){this._autoStretch&&(this._calcAndSetContentHeight(),this._stretchContentRow())},_checkHoriOverflow:function(){var e=this,t=e.getTotalWidth();e._hideHead?e._isHoriOverflow=t>jQuery(e.rightContentTbl.parentNode.parentNode).innerWidth():e._isHoriOverflow=t>e.rightHeadTbl.parentNode.parentNode.clientWidth,e._calcAndSetContentHeight()},_refreshHeadCell:function(e){var t,i=this,l=jQuery(i.el),n=null;if(l.find(".jl-tbl-header-cell").each(function(i,l){return t=this.jsletColCfg,t&&t.field==e?(n=this,!1):void 0}),n){var a=i._dataset.getField(t.field);t.label=a.displayLabel();var r=n.childNodes[0],s=t.cellRender||i._defaultCellRender;if(s&&s.createHeader)r.html(""),s.createHeader.call(i,r,t);else{var o=t.label||"&nbsp;";t.field&&i._isCellEditable(t)&&a&&a.required()&&(o='<span class="jl-lbl-required">*</span>'+o),jQuery(n).find(".jl-focusable-item").html(o)}}},_createHeadCell:function(e,i){var l=this,n=0,a=0;i.subHeads?a=i.colSpan:n=l.maxHeadRows-(i.level?i.level:0);var r=document.createElement("th");r.className="jl-tbl-header-cell jl-unselectable",r.noWrap=!0,r.jsletColCfg=i,n&&n>1&&(r.rowSpan=n),a&&a>1&&(r.colSpan=a),r.innerHTML='<div style="position: relative" unselectable="on" class="jl-unselectable jl-tbl-header-div jl-border-box '+(i.widthCssName||"")+'">';var s=r.childNodes[0],o=i.cellRender||l._defaultCellRender;if(o&&o.createHeader)o.createHeader.call(l,s,i);else{var d=i.label||"&nbsp;";if(i.field){var u=l._dataset.getField(i.field);u&&u.required()&&(d='<span class="jl-lbl-required">*</span>'+d)}s.innerHTML=[l._hasFilterDialog&&i.field&&!i.subHeads&&!i.disableFilter?'<button class="jl-tbl-filter" jsletfilterfield="'+i.field+'"><i class="fa fa-filter"></i></button>':"",'<span id="',i.id,'" unselectable="on" style="width:100%;padding:0px 2px">',l._disableHeadSort||i.disableHeadSort?d:'<span class="jl-focusable-item" draggable="true">'+d+"</span>",'</span><span unselectable="on" class="jl-tbl-sorter" title="',t.DBTable.sorttitle,'">&nbsp;</span><div  unselectable="on" class="jl-tbl-splitter-hook" colid="',i.colNum,'">&nbsp;</div>'].join("")}e.appendChild(r)},_renderHeader:function(){function e(i){for(var l,n,a=0,o=i.length;o>a;a++)l=i[a],n=l.colNum<t._fixedCols?r.rows[l.level]:s.rows[l.level],t._createHeadCell(n,l),l.subHeads&&e(l.subHeads)}var t=this;if(!t._hideHead){var i,l,n,a,r=t.leftHeadTbl.createTHead(),s=t.rightHeadTbl.createTHead();for(n=0;n<t.maxHeadRows;n++)r.insertRow(-1),s.insertRow(-1);for(i=r.rows[0],n=0,a=t._sysColumns.length;a>n;n++)l=t._sysColumns[n],l.rowSpan=t.maxHeadRows,t._createHeadCell(i,l);e(t.innerHeads);var o,d,u=t.headRowHeight();for(n=0;n<=t.maxHeadRows;n++)o=jQuery(r.rows[n]),d=jQuery(s.rows[n]),o.height(u),d.height(u);t.sortedCell=null,t.indexField=null}},getTotalWidth:function(e){var t,i,l=this,n=0;if(e){for(t=0,i=l._sysColumns.length;i>t;t++)n+=l._sysColumns[t].width;for(t=0,i=l._fixedCols;i>t;t++)n+=l.innerColumns[t].width}else for(t=l._fixedCols,i=l.innerColumns.length;i>t;t++)n+=l.innerColumns[t].width;return n},_doSplitHookDown:function(t){t=jQuery.event.fix(t||window.event);var i=t.target;if("jl-tbl-splitter-hook"==i.className){var l=e.ui.findFirstParent(i,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),n=jQuery(l),a=jQuery(document.body),r=parseInt(a.css("margin-top")),s=parseInt(a.css("margin-left")),o=(n.position().top-r,jQuery(i)),d=n.height()-20,u=o.offset().left-n.offset().left-s,c=n.find(".jl-tbl-splitter")[0];c.style.left=u+"px",c.style.top="1px",c.style.height=d+"px",e.ui.dnd.bindControl(c),l.jslet.currColId=parseInt(o.attr("colid")),l.jslet.isDraggingColumn=!0}},_doSplitHookUp:function(t){t=jQuery.event.fix(t||window.event);var i=t.target.lastChild;if(i&&"jl-tbl-splitter-hook"==i.className){var l=e.ui.findFirstParent(i,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),n=jQuery(l),a=jQuery(document.body);a.css("cursor","auto");var r=n.find(".jl-tbl-splitter")[0];"none"!=r.style.display&&(r.style.display="none"),l.jslet.isDraggingColumn=!1}},_getColumnByField:function(e){var t=this;if(!t.innerColumns)return null;for(var i,l=0,n=t.innerColumns.length;n>l;l++)if(i=t.innerColumns[l],i.field==e)return i;return null},_doHeadClick:function(e,t){var i=this;i._disableHeadSort||e.disableHeadSort||i.isDraggingColumn||i._doSort(e.field,t)},_doSort:function(e,t){var i=this;i._dataset.confirm(),i._dataset.disableControls();try{i._dataset.toggleIndexField(e,!t),i.listvm.refreshModel()}finally{i._dataset.enableControls()}},_updateSortFlag:function(){var e=this;if(!e._hideHead){var t,i,l,n,a,r,s=e._dataset.mergedIndexFields(),o=e.leftHeadTbl.createTHead(),d=e.rightHeadTbl.createTHead(),u=[],c=o.rows.length;for(r=0;c>r;r++)for(t=o.rows[r].cells,n=0,a=t.length;a>n;n++)l=t[n],l.jsletColCfg&&(u[u.length]=l);for(r=0;c>r;r++)for(i=d.rows[r].cells,n=0,a=i.length;a>n;n++)l=i[n],l.jsletColCfg&&(u[u.length]=l);var h,f=u.length;for(n=0;f>n;n++)l=u[n],h=jQuery(l).find(".jl-tbl-sorter")[0],h&&(h.innerHTML="&nbsp;");var p,_,v,m=1,g=s.length;for(n=0;g>n;n++){v=s[n];for(var C=0;f>C;C++)if(l=u[C],p=l.jsletColCfg.field,p&&(h=jQuery(l).find(".jl-tbl-sorter")[0],_="&nbsp;",p==v.fieldName)){_=1===v.order?'<i class="fa fa-arrow-up"></i>':'<i class="fa fa-arrow-down"></i>',g>1&&(_+=m++),h.innerHTML=_;break}}}},_doSelectBoxClick:function(t){var i=null;t?(t=jQuery.event.fix(t||window.event),i=t.target):i=this;var l=e.ui.getParentElement(i,2);try{jQuery(l).click()}finally{var n=e.ui.findFirstParent(l,function(e){return!!e.jslet}),a=n.jslet;if(a._onSelect){var r=a._onSelect.call(a,i.checked);if(void 0!==r&&!r)return void(i.checked=!i.checked)}a._beforeSelect&&a._beforeSelect.call(a),a._dataset.select(i.checked?1:0,a._selectBy),a._showCurrentCell(),a._afterSelect&&a._afterSelect.call(a)}},_getTableRow:function(e,t){var i=e.parentElement,l=e.rowSpan;if(2>l)return i;for(var n=i.rowIndex,a=i.parentElement.rows,r=0,s=n;n+l>s;s++)if(i=a[s],r+=i.offsetHeight,r>=t)return i;return i},_doCellClick:function(e,t,i){var l=this,n=e.jsletColCfg;if(n){if(l._doRowClick(l._getTableRow(e,t)),n.isSeqCol)l._processRowSelection(i.ctrlKey,i.shiftKey,i.altKey);else{var a=n.colNum;if(0!==a&&!a)return;l._doBeforeSelect(i.ctrlKey,i.shiftKey,i.altKey),l.currColNum(a),l._processSelection(i.ctrlKey,i.shiftKey,i.altKey);var r=l.cellEditor();if(r)if(l._isCellEditable(n)){var s=n.field;r.showEditor(s,e),n.isBoolColumn&&window.setTimeout(function(){l._dataset.setFieldValue(s,!l._dataset.getFieldValue(s))},5)}else r.hideEditor()}l._onCellClick&&l._onCellClick.call(l,e)}},_doDblCellClick:function(e,t){this._doRowDblClick(this._getTableRow(e,t))},_doRowDblClick:function(e){e&&this._onRowDblClick&&this._onRowDblClick.call(this,e)},_doRowClick:function(e){if(e){var t=this,i=t.dataset(),l=e.jsletrecno;if(l!==i.recno()){if(i.status()){var n=document.activeElement;n&&(t.el.focus(),n.focus()),i.confirm()}var a=t.listvm.recnoToRowno(l);t.listvm.setCurrentRowno(a),i.recno(t.listvm.getCurrentRecno())}t._onRowClick&&t._onRowClick.call(t,e)}},_renderCell:function(t,i,l){var n=this,a=document.createElement("td");a.noWrap=!0,a.jsletColCfg=i,jQuery(a).addClass("jl-tbl-cell"),a.innerHTML='<div class="jl-tbl-cell-div '+(i.widthCssName||"")+'"></div>';var r=a.firstChild,s=i.cellRender||n._defaultCellRender;s&&s.createCell?s.createCell.call(n,r,i):n._isCellEditable(i)?(e.ui.table.cellRenders.defaultCellRender.createCell.call(n,r,i),i.editable=!0):(e.ui.table.cellRenders.defaultCellRender.createCell.call(n,r,i),i.editable=!1),t.appendChild(a)},_renderRow:function(e,t){var i,l=this,n=0,a=null,r=l._fixedCols>0||l._sysColumns.length>0;switch(e){case 1:n=l._fixedRows,r&&(a=l.leftFixedTbl.tBodies[0]),i=l.rightFixedTbl.tBodies[0];break;case 2:n=l.listvm.getVisibleCount(),r&&(a=l.leftContentTbl.tBodies[0]),i=l.rightContentTbl.tBodies[0]}var s,o,d,u,c=0,h=l.innerColumns.length;t&&(c=i.rows.length);for(var f=l.rowHeight(),p=c;n>p;p++){if(r){s=a.insertRow(-1),s.style.height=f+"px";var _=l._sysColumns.length;for(u=0;_>u;u++)o=l._sysColumns[u],l._renderCell(s,o,0===u);for(d=0===_,u=0;u<l._fixedCols;u++)o=l.innerColumns[u],l._renderCell(s,o,d&&0===u)}for(d=!r,s=i.insertRow(-1),s.style.height=f+"px",u=l._fixedCols;h>u;u++)o=l.innerColumns[u],l._renderCell(s,o,u==l._fixedCols)}},_stretchContentRow:function(){var e,t,i=this,l=i.listvm.getVisibleCount()-i._fixedRows,n=null,a=null,r=i._fixedCols>0||i._sysColumns.length>0;r&&(n=i.leftContentTbl.tBodies[0],a=n.rows),e=i.rightContentTbl.tBodies[0],t=e.rows;var s,o=t.length;for(s=l;o>s;s++)r&&(a[s].style.display="none"),t[s].style.display="none";var d,u,c,h,f=i.innerColumns.length,p=i.rowHeight();for(s=0;l>s;s++)if(o>s)r&&(a[s].style.display="table-row"),t[s].style.display="table-row";else{if(r){d=n.insertRow(-1),d.style.height=p+"px";var _=i._sysColumns.length;for(h=0;_>h;h++)u=i._sysColumns[h],i._renderCell(d,u,0===h);for(c=0===_,h=0;h<i._fixedCols;h++)u=i.innerColumns[h],i._renderCell(d,u,c&&0===h)}for(c=!r,d=e.insertRow(-1),d.style.height=p+"px",h=i._fixedCols;f>h;h++)u=i.innerColumns[h],i._renderCell(d,u,h==i._fixedCols)}},_renderBody:function(e){var t=this;e?t._renderRow(2,!0):(t._renderRow(1),t._renderRow(2),t._renderTotalSection())},_renderTotalSection:function(){function e(e){var t=document.createElement("td");return t.noWrap=!0,t.innerHTML='<div class="jl-tbl-footer-div '+(e.widthCssName||"")+'"></div>',t.jsletColCfg=e,t}var t=this;if(t.footSectionHt){var i,l,n,a,r,s,o=t._fixedCols>0||t._sysColumns.length>0;if(o&&(i=t.leftFootTbl.tBodies[0]),l=t.rightFootTbl.tBodies[0],o){for(n=i.insertRow(-1),n.style.height=t.footerRowHeight()+"px",r=0,s=t._sysColumns.length;s>r;r++)a=t._sysColumns[r],n.appendChild(e(a));for(r=0;r<t._fixedCols;r++)a=t.innerColumns[r],n.appendChild(e(a))}for(n=l.insertRow(-1),n.style.height=t.footerRowHeight()+"px",r=t._fixedCols,s=t.innerColumns.length;s>r;r++)a=t.innerColumns[r],n.appendChild(e(a))}},_fillTotalSection:function(){var i=this,l=i._dataset.aggregatedValues();if(i.footSectionHt&&l){var n,a,r=i._sysColumns.length,s=i._fixedCols>0||r>0;s&&(n=i.leftFootTbl.tBodies[0].rows[0]),a=i.rightFootTbl.tBodies[0].rows[0];var o,d,u,c,h,f,p=!1,_=!0;r>0&&(o=n.cells[r-1],o.innerHTML=t.DBTable.totalLabel,_=!1);for(var v,m=0,g=i.innerColumns.length;g>m;m++)if(u=i.innerColumns[m],v=u.colNum,o=v<i._fixedCols?n.cells[v+r]:a.cells[v-i._fixedCols],o.style.textAlign="right",c=u.field,f=l[c])if(_=!1,d=i._dataset.getField(c),h=d.getType()===e.data.DataType.NUMBER?f.sum:f.count){var C=d.displayFormat(),b=h;C&&d.getType()===e.data.DataType.NUMBER&&(b=h?e.formatNumber(h,C):""),o.firstChild.innerHTML=b,o.firstChild.title=b}else o.firstChild.innerHTML="&nbsp;",o.firstChild.title="";else if(_){var y;p?y="&nbsp;":(y=t.DBTable.totalLabel,p=!0),o.firstChild.innerHTML=y,o.firstChild.title=""}}},_fillData:function(){var e=this,t=(e._dataset.recno(),e.listvm.getNeedShowRowCount()),i=t*e.rowHeight();e._setScrollBarMaxValue(i);var l=0===e.dataset().recordCount();e.noRecordDiv.style.display=l?"block":"none";var n=e._dataset.recnoSilence();try{e._fillRow(!0),e._fillRow(!1),e.footSectionHt&&e._fillTotalSection()}finally{e._dataset.recnoSilence(n)}e._refreshSeqColWidth(),e._cellEditor&&l&&e._cellEditor.hideEditor()},_fillRow:function(e){var t,i=this,l=0,n=0,a=null,r=i._fixedCols>0||i._sysColumns.length>0;if(e){if(l=i._fixedRows,n=-1*i._fixedRows,0===l)return;r&&(a=i.leftFixedTbl.tBodies[0]),t=i.rightFixedTbl.tBodies[0]}else l=i.listvm.getVisibleCount(),n=i.listvm.getVisibleStartRow(),r&&(a=i.leftContentTbl.tBodies[0]),t=i.rightContentTbl.tBodies[0];for(var s,o,d,u,c,h=-1,f=(i.innerColumns.length,i.listvm.getNeedShowRowCount()-i.listvm.getVisibleStartRow()),p=r?a.rows:null,_=t.rows,v={},m=!0,g=Math.min(_.length,l),C=0;g>C;C++)if(C+(e?n:0)>=f)r&&(s=p[C],s.style.display="none"),s=_[C],s.style.display="none";else{if(i.listvm.setCurrentRowno(C+n,!0),h=i.listvm.getCurrentRecno(),i._dataset.recnoSilence(h),r)for(s=p[C],s.jsletrecno=h,s.style.display="",i._onFillRow&&i._onFillRow.call(i,s,i._dataset),o=s.childNodes,d=o.length,c=0;d>c;c++)u=o[c],i._fillCell(h,u,v,m);for(s=_[C],s.jsletrecno=h,s.style.display="",i._onFillRow&&i._onFillRow.call(i,s,i._dataset),s=_[C],o=s.childNodes,d=o.length,c=0;d>c;c++)u=o[c],i._fillCell(h,u,v,m);m=0}i.listvm.setCurrentRowno(0,!0)},_fillCell:function(t,i,l,n){var a=this,r=i.jsletColCfg;if(r){var s,o=r.field,d=i.firstChild;if(a._onFillCell&&a._onFillCell.call(a,d,a._dataset,o),o&&r.mergeSame&&l)if(n||!a._dataset.isSameAsPrevious(o)){if(l[o]={cell:i,count:1},s=jQuery(i),s.attr("rowspan",1),a._editable){s.offset();s.attr("jsletFirstId",null),i.id||(i.id=e.nextId())}i.style.display=""}else{var u=l[o];u.count++,i.style.display="none";var c=jQuery(u.cell);a._editable&&jQuery(i).attr("jsletOffsetHeight",(u.count-1)*a.rowHeight()).attr("jsletFirstId",c.attr("id")),c.attr("rowspan",u.count)}var h=r.cellRender||a._defaultCellRender;if(h&&h.refreshCell?h.refreshCell.call(a,d,r,t):e.ui.table.cellRenders.defaultCellRender.refreshCell.call(a,d,r,t),o){var f=a._dataset.getFieldErrorByRecno(t,o);s=jQuery(i);d.title;f&&f.message?(s.hasClass("has-error")||s.addClass("has-error"),d.title=f.message):s.hasClass("has-error")&&s.removeClass("has-error")}}},refreshCurrentRow:function(){var e,t,i=this,l=i._fixedCols>0||i._hasSeqCol||i._hasSelectCol,n=null,a=i._dataset.recno();a<i._fixedRows?(l&&(n=i.leftFixedTbl.tBodies[0]),e=i.rightFixedTbl.tBodies[0],t=a):(l&&(n=i.leftContentTbl.tBodies[0]),e=i.rightContentTbl.tBodies[0],t=i.listvm.recnoToRowno(i._dataset.recno())-i.listvm.getVisibleStartRow());var r,s,o,d,u,c,h;if(l){if(r=n.rows[t],!r)return;s=r.childNodes,d=r.jsletrecno,i._onFillRow&&i._onFillRow.call(i,r,i._dataset);var f;for(c=0,h=s.length;h>c;c++)o=s[c],u=o.jsletColCfg,u&&u.isSeqCol?u.cellRender.refreshCell.call(i,o.firstChild,u):u&&u.isSelectCol?(f=o.firstChild,f.checked=i._dataset.selected()):i._fillCell(d,o)}if(r=e.rows[t])for(d=r.jsletrecno,i._onFillRow&&i._onFillRow.call(i,r,i._dataset),s=r.childNodes,c=0,h=s.length;h>c;c++)o=s[c],i._fillCell(d,o)},_getLeftRowByRecno:function(e){var t=this;if(e<t._fixedRows)return t.leftFixedTbl.tBodies[0].rows[e];for(var i,l=t.leftContentTbl.tBodies[0].rows,n=0,a=l.length;a>n;n++)if(i=l[n],i.jsletrecno==e)return i;return null},_showCurrentRow:function(e){var t=this,i=t.listvm.recnoToRowno(t._dataset.recno());t.listvm.setCurrentRowno(i,!1,e),t._showCurrentCell()},_hideCurrentRow:function(){var t=this;t._currRow&&(t._currRow.fixed&&jQuery(t._currRow.fixed).removeClass(e.ui.htmlclass.TABLECLASS.currentrow),jQuery(t._currRow.content).removeClass(e.ui.htmlclass.TABLECLASS.currentrow))},_getTrByRowno:function(e){var t,i,l,n,a=this,r=a._fixedCols>0||a._sysColumns.length>0;return 0>e?(i=a.rightFixedTbl.tBodies[0].rows,t=a._fixedRows+e,l=i[t],n=r?a.leftFixedTbl.tBodies[0].rows[t]:null,{fixed:n,content:l}):(i=a.rightContentTbl.tBodies[0].rows,t=e-a.listvm.getVisibleStartRow(),t>=0&&(l=i[t])?(n=r?a.leftContentTbl.tBodies[0].rows[t]:null,{fixed:n,content:l}):null)},_getCurrCellEl:function(){var e=this;if(!e._currRow)return null;for(var t,i,l=e._currRow.content,n=l.cells,a=0,r=n.length;r>a;a++)if(t=n[a],i=t.jsletColCfg,i&&i.colNum===e._currColNum)return t;return null},_adjustCurrentCellPos:function(e){var t=this;if(t._currRow){var i=jQuery(t.el),l=i.find(".jl-tbl-contentcol"),n=l[0];n.scrollLeft;if(!(t._currColNum<t._fixedCols)){var a=t._getCurrCellEl(),r=a.offsetLeft,s=a.offsetWidth,o=n.clientWidth,d=n.scrollLeft;return d>r?void(n.scrollLeft=r):void(r+s>d+o&&(n.scrollLeft=r+s-o))}}},_isCurrCellInView:function(){var e,t,i=this,l=jQuery(i.el),n=l.find(".jl-tbl-contentcol"),a=n[0],r=i._noborder?0:2,s=a.scrollLeft,o=0;if(i._currColNum<i._fixedCols)return!0;for(e=i._fixedCols,t=i.innerColumns.length;e<i._currColNum;e++)o+=i.innerColumns[e].width+r;if(s>o)return!1;var d=n.innerWidth(),u=n.find(".jl-tbl-content-div").width(),c=0;for(e=i.innerColumns.length-1;e>i._currColNum;e--)c+=i.innerColumns[e].width+r;return o=u-c-d,o=o>=0?o:0,!(o>s)},_showCurrentCell:function(){var e=this,t=e._currRow;if(t){var i;i=e._currColNum>=e._fixedCols?t.content:t.fixed;var l=i.jsletrecno,n=e.cellEditor();if(l!==e._dataset.recno())return e.prevCell&&e.prevCell.removeClass("jl-tbl-curr-cell"),void(n&&n.hideEditor());for(var a,r,s=i.cells,o=!1,d=0,u=s.length;u>d;d++)if(a=s[d],r=a.jsletColCfg,r&&r.colNum==e._currColNum){e.prevCell&&e.prevCell.removeClass("jl-tbl-curr-cell");var c=jQuery(a);c.addClass("jl-tbl-curr-cell"),e.prevCell=c,o=!0;break}n&&o&&(e._isCurrCellInView()?n.showEditor(r.field,a):n.hideEditor())}},_showSelected:function(e,t,i){var l=this,n=jQuery(e);void 0===i&&(i=l._dataset.recno());var a=l._dataset.selection.isSelected(i,t);a?n.addClass("jl-tbl-selected"):n.removeClass("jl-tbl-selected")},_refreshSelection:function(){var e=this;jQuery(e.el).find("td.jl-tbl-cell").each(function(t,i){var l=i.jsletColCfg,n=parseInt(i.parentNode.jsletrecno);if((n||0===n)&&l){var a=l.field;a&&e._showSelected(i,a,n)}})},_syncScrollBar:function(e){var t=this;if(!t._keep_silence_){var i=e*t.rowHeight();t._keep_silence_=!0;try{var l=t.jqVScrollBar[0];window.setTimeout(function(){l.scrollTop=i},10)}finally{t._keep_silence_=!1}}},toggle:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t?e.listvm.collapse(function(){e._fillData()}):e.listvm.expand(function(){e._fillData()})}},expand:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t||e.listvm.expand(function(){e._fillData()})}},collapse:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t&&e.listvm.collapse(function(){e._fillData()})}},expandAll:function(){var e=this;e.listvm.expandAll(function(){e._fillData()})},collapseAll:function(){var e=this;e.listvm.collapseAll(function(){e._fillData()})},_doMetaChanged:function(e,t){var i=this;if(!t)return void i.renderAll();if("label"==e&&!i._hideHead)return void i._refreshHeadCell(t);if("required"==e&&i._editable&&!i._hideHead)return void i._refreshHeadCell(t);if(i._editable&&("readOnly"==e||"disabled"==e)){var l=i.cellEditor();if(l){var n=l.currentField();n==t&&l.showEditor(t)}}},refreshControl:function(t){var i,l,n,a,r,s,o,d,u=this,c=t.eventType;if(c==e.data.RefreshEvent.CHANGEMETA)u._doMetaChanged(t.metaName,t.fieldName);else if(c==e.data.RefreshEvent.AGGREGATED)u._fillTotalSection();else if(c==e.data.RefreshEvent.BEFORESCROLL);else if(c==e.data.RefreshEvent.SCROLL){if(0===u._dataset.recordCount())return;u._showCurrentRow(!0)}else if(c==e.data.RefreshEvent.UPDATEALL){if(!u.listvm)return;u._hideCurrentRow(),u.listvm.refreshModel(),u._stretchContentHeight(),u._updateSortFlag(!0),0===u._dataset.recordCount()&&(u._currRow=null),u._fillData(),u._showCurrentRow(!0),u._filterPanel&&u._filterPanel.checkFilterBtnStyle(),u._hasSelectCol&&(jQuery(u.el).find(".jl-tbl-select-all")[0].checked=!1)}else if(c==e.data.RefreshEvent.UPDATERECORD){var h=t.fieldName;if(h){var f=u._dataset.getField(h);if(f&&f.mergeSame())return void u._fillData()}u.refreshCurrentRow()}else if(c==e.data.RefreshEvent.UPDATECOLUMN||c==e.data.RefreshEvent.UPDATELOOKUP)u._fillData();else if(c==e.data.RefreshEvent.INSERT){u.listvm.refreshModel(),u._stretchContentHeight(),d=u._dataset.recno();var p=t.preRecno;u._fillData(),u._keep_silence_=!0;try{u.refreshControl(e.data.RefreshEvent.scrollEvent(d,p))}finally{u._keep_silence_=!1}}else if(c==e.data.RefreshEvent.DELETE)u.listvm.refreshModel(),u._stretchContentHeight(),u._fillData(),0===u._dataset.recordCount()&&(u._currRow=null);else if(c==e.data.RefreshEvent.SELECTRECORD){if(!u._hasSelectCol)return;for(o=0,u._hasSeqCol&&o++,d=t.recno,i=0,l=d.length;l>i;i++)n=u._getLeftRowByRecno(d[i]),n&&(a=n.cells[o],r=!!t.selected,s=jQuery(a).find("[type=checkbox]")[0],s.checked=r,s.defaultChecked=r)}else if(c==e.data.RefreshEvent.SELECTALL){if(!u._hasSelectCol)return;o=0,u._hasSeqCol&&o++;var _=u.leftFixedTbl.tBodies[0],v=u.leftContentTbl.tBodies[0],m=u._dataset.recno();try{for(i=0,l=_.rows.length;l>i&&(n=_.rows[i],"none"!=n.style.display);i++)u._dataset.recnoSilence(n.jsletrecno),r=!!u._dataset.selected(),a=n.cells[o],s=jQuery(a).find("[type=checkbox]")[0],s.checked=r,s.defaultChecked=r;for(i=0,l=v.rows.length;l>i&&(n=v.rows[i],"none"!=n.style.display);i++)u._dataset.recnoSilence(n.jsletrecno),r=!!u._dataset.selected(),a=n.cells[o],s=jQuery(a).find("[type=checkbox]")[0],s.checked=r,s.defaultChecked=r}finally{u._dataset.recnoSilence(m)}}},_isCellEditable:function(e){var t=this;if(!t._editable)return!1;var i=e.field;if(!i)return!1;if(t._editableFields&&t._editableFields.length>0&&t._editableFields.indexOf(i)<0)return!1;if(t._readOnlyFields&&t._readOnlyFields.length>0&&t._readOnlyFields.indexOf(i)>=0)return!1;var l=t._dataset.getField(i),n=l.fieldDisabled()||l.fieldReadOnly()?0:1;return n},_doAppendRecord:function(){var e=this;e._onAppendRecord?e._onAppendRecord.call(e):e._dataset.appendRecord()},_doDeleteRecord:function(){var e=this;e._onDeleteRecord?e._onDeleteRecord.call(e):e._dataset.deleteRecord()},checkSizeChanged:function(){var e=this,t=jQuery(e.el),i=t.height();i!=e._oldHeight&&(e.height=i,e.renderAll())},_innerDestroy:function(){var e=this,t=jQuery(e.el);e._currRow=null,e._oldVisibleRows=-1,e.listvm.reset(),e.leftHeadTbl=null,e.rightHeadTbl=null,jQuery(e.rightHeadTbl).off(),e.leftFixedTbl=null,e.rightFixedTbl=null,e.leftContentTbl=null,e.rightContentTbl=null,e.leftFootTbl=null,e.rightFootTbl=null,e.noRecordDiv=null,e.jqVScrollBar&&e.jqVScrollBar.off(),e.jqVScrollBar=null;var i=t.find(".jl-tbl-splitter")[0];i&&(i._doDragging=null,i._doDragEnd=null,i._doDragCancel=null),e.parsedHeads=null,e.prevCell=null,t.find(".jl-tbl-select-check").off(),e._filterPanel&&(e._filterPanel.destroy(),e._filterPanel=null),e._findDialog&&(e._findDialog.destroy(),e._findDialog=null),e._cellEditor&&(e._cellEditor.destroy(),e._cellEditor=null)},destroy:function($super){var t=this,i=jQuery(t.el);e.ui.resizeEventBus.unsubscribe(t),i.off(),t._innerDestroy(),t.listvm.destroy(),t.listvm=null,$super()}}),e.ui.DBTable=e.Class.create(e.ui.AbstractDBTable,{}),e.ui.register("DBTable",e.ui.DBTable),e.ui.DBTable.htmlTemplate="<div></div>",e.ui.Splitter=function(){if(!e.ui._splitDiv){var t=document.createElement("div");t.className="jl-split-column",t.style.display="none",e.ui._splitDiv=t,document.body.appendChild(t),t=null}this.isDragging=!1,this.attach=function(t,i,l,n){n||(n=jQuery(t).height());var a=e.ui._splitDiv;a.style.height=n+"px",a.style.left=i+"px",a.style.top=l+"px",a.style.display="block",e.ui.dnd.bindControl(this),this.isDragging=!1},this.unattach=function(){e.ui._splitDiv.style.display="none",this.onSplitEnd=null,this.onSplitCancel=null},this.onSplitEnd=null,
this.onSplitCancel=null,this._doDragEnd=function(t,i,l,n,a,r){e.ui.dnd.unbindControl(),this.onSplitEnd&&this.onSplitEnd(l-t),this.unattach(),this.isDragging=!1},this._doDragging=function(t,i,l,n,a,r){this.isDragging=!0,e.ui._splitDiv.style.left=l+"px"},this._doDragCancel=function(){e.ui.dnd.unbindControl(),this.onSplitCancel&&this.onSplitCancel(),this.unattach(),this.isDragging=!1}},e.ui.table||(e.ui.table={}),e.ui.table.DBTableFilterPanel=function(t){var i=this;i._width=300,i._height=150,i.fieldName=null,i._filterDatasetObj=new e.data.FilterDataset(t.dataset()),i._filterDataset=i._filterDatasetObj.filterDataset(),i._filterDataset.getField("lParenthesis").visible(!1),i._filterDataset.getField("rParenthesis").visible(!1),i._filterDataset.getField("logicalOpr").visible(!1),i._filterDataset.getField("valueExprInput").visible(!1),i._dbtable=t,i._jqFilterBtn=null,i._currFieldName=null,i._currFilterExpr=null},e.ui.table.DBTableFilterPanel.prototype={jqFilterBtn:function(e){this._jqFilterBtn=e},changeField:function(e){var t=this._filterDataset,i=t.getField("field"),l=i.lookup().dataset();t.cancel(),l.filter('[name] == "'+e+'" || like([name],"'+e+'.%")'),l.filtered(!0),i.visible(l.recordCount()>1),t.find('[field] == "'+e+'" || like([field], "'+e+'.%")')||(t.appendRecord(),t.setFieldValue("field",e)),this._currFieldName=e},show:function(e,t,i,l){var n=this;n._panel||(n._panel=n._create()),n._panel.style.left=e+"px",n._panel.style.top=t+"px",jQuery(n._panel).show("fast"),window.setTimeout(function(){n._filterDataset.focusEditControl("value")},5)},hide:function(){this._filterDataset.cancel(),jQuery(this._panel).hide("fast")},cancelFilter:function(){this._filterDataset.cancel()},_create:function(){var i=this;i._panel||(i._panel=document.createElement("div"),i._dbtable.el.appendChild(i._panel)),jQuery(i._panel).addClass("panel panel-default jl-filter-panel"),i._panel.innerHTML="<div class=\"\"><div data-jslet=\"type: 'DBEditPanel', dataset: '"+i._filterDataset.name()+'\', columnCount: 1,hasLabel:false " style="width:100%;height:100%" ></div></div><div class="jl-filter-panel-toolbar"><button class="btn btn-default btn-sm jl-filter-panel-ok" tabIndex="90990">'+t.FilterPanel.ok+'</button><button class="btn btn-default btn-sm jl-filter-panel-cancel" tabIndex="90991">'+t.FilterPanel.cancel+'</button><button class="btn btn-default btn-sm jl-filter-panel-clear" tabIndex="90992">'+t.FilterPanel.clear+'</button><button class="btn btn-default btn-sm jl-filter-panel-clearall" tabIndex="90993">'+t.FilterPanel.clearAll+"</button></div>",e.ui.install(i._panel);var l=jQuery(i._panel);return l.find(".jl-filter-panel-ok").on("click",function(){var t=i._filterDataset;t.confirm(),e.isEmpty(t.getFieldValue("value"))&&t.deleteRecord();var l=i._filterDatasetObj.getFilterExpr();i._dbtable.dataset().filter(l).filtered(!0),i._currFilterExpr=l,i.hide(),i._setFilterBtnStyle()}),l.find(".jl-filter-panel-cancel").on("click",function(){i._filterDataset.cancel(),i.hide()}),l.find(".jl-filter-panel-clear").on("click",function(){i._filterDataset.deleteRecord();var e=i._filterDatasetObj.getFilterExpr();i._dbtable.dataset().filter(e).filtered(!0),i.hide(),i._currFilterExpr=e,i._setFilterBtnStyle()}),l.find(".jl-filter-panel-clearall").on("click",function(){i._filterDataset.records(null),i._dbtable.dataset().filter(null).filtered(!1),i.hide(),i._clearFilterBtnStyle()}),l.on("keydown",function(e){e.stopImmediatePropagation()}),i._panel},_clearFilterBtnStyle:function(){var e=jQuery(this._panel);jQuery(this._dbtable.el).find(".jl-tbl-filter-hasfilter").attr("title","").removeClass("jl-tbl-filter-hasfilter"),e.find(".jl-filter-panel-clearall").attr("title",""),this._currFilterExpr=null},checkFilterBtnStyle:function(){var e=this;if(e._currFilterExpr){var t=e._dbtable.dataset(),i=t.filter();if(!t.filtered()||i!=e._currFilterExpr){e._clearFilterBtnStyle();var l=e._filterDataset;i&&t.filtered()||l.records(null);var n=e._filterDatasetObj.getFilterExprText();jQuery(e._dbtable.el).find("button.jl-tbl-filter").each(function(){var e=this.getAttribute("jsletfilterfield"),t=jQuery(this);l.find('[field] == "'+e+'" || like([field], "'+e+'.%")')?t.addClass("jl-tbl-filter-hasfilter"):t.removeClass("jl-tbl-filter-hasfilter"),t.attr("title",n||"")}),jQuery(e._panel).find(".jl-filter-panel-clearall").attr("title",n||"")}}},_setFilterBtnStyle:function(){var e=this,t=e._filterDatasetObj.getFilterExprText(),i=e._filterDataset;i.find('[field] == "'+e._currFieldName+'" || like([field], "'+e._currFieldName+'.%")')?e._jqFilterBtn.addClass("jl-tbl-filter-hasfilter"):e._jqFilterBtn.removeClass("jl-tbl-filter-hasfilter"),e._jqFilterBtn.attr("title",t||""),jQuery(e._dbtable.el).find(".jl-tbl-filter-hasfilter").attr("title",t||""),jQuery(e._panel).find(".jl-filter-panel-clearall").attr("title",t||"")},destroy:function(){var t=this;e.ui.uninstall(t._panel),t._panel.innerHTML="",t._panel=null,t._dbtable=null,t._jqFilterBtn=null}},e.ui.table||(e.ui.table={}),e.ui.table.FindDialog=function(i){function l(){function i(){if(!(a.recordCount()<2)){var e=h.val(),t=0;f||(t=a.recno()+1);var l={startRecno:t,findingByText:!0,matchType:"any"},n=a.findByField(s,e,l);return f=!n,n||t>0&&i(),n}}var l={type:"window",caption:e.formatMessage(t.findDialog.caption,[""]),isCenter:!1,resizable:!0,minimizable:!1,maximizable:!1,stopEventBubbling:!0,styleClass:"jl-finddlg"};n=e.ui.createControl(l,r),n.onClosed(function(){return"hidden"});var u='<div class="input-group input-group-sm"><input class="form-control jl-finddlg-value" placeholder="'+t.findDialog.placeholder+'"/><div class="input-group-btn"><button class="btn btn-default jl-finddlg-find"><i class="fa fa-search" /></button></div></div>';n.setContent(u),n.onPositionChanged(function(e,t){o=e>0?e:0,d=t>0?t:0});var c=n.el,h=jQuery(c).find(".jl-finddlg-value"),f=!0;h.on("keydown",function(t){return t.keyCode===e.ui.KeyCode.ENTER?(i(),t.stopImmediatePropagation(),t.preventDefault(),!1):void(f=!0)});var p=jQuery(c).find(".jl-finddlg-find");p.on("click",function(e){i()})}var n,a=i.dataset(),r=i.el,s=null,o=-1,d=-1;this.show=function(e,t){s&&(o>=0&&(e=o),d>=0&&(t=d),e=e||0,t=t||0,n.show(e,t),this.focus())},this.hide=function(){n.hide()},this.findingField=function(i){if(void 0===i)return s;var l=s;if(s=i){var r=a.getField(s);if(r){var o=r.getType();if(o===e.data.DataType.ACTION||o===e.data.DataType.EDITACTION)return void(s=null);n.changeCaption(e.formatMessage(t.findDialog.caption,[r.label()])),l!=i&&jQuery(n.el).find(".jl-finddlg-value").val("")}}},this.focus=function(){jQuery(n.el).find(".jl-finddlg-value").focus()},this.destroy=function(){n.destroy()},l()},e.ui.DBChart=e.Class.create(e.ui.DBControl,{chartTypes:["line","stackline","bar","stackbar","pie"],legendPositions:["none","top","bottom","left","right"],initialize:function($super,t,i){var l=this;l.allProperties="styleClass,dataset,chartType,chartTitle,categoryField,valueFields,legendPos,recordRange,reverse",l.requiredProperties="valueFields,categoryField",l._chartType="line",l._categoryField=null,l._valueFields=null,l._chartTitle=null,l._legendPos="none",l._recordRange=e.data.RecordRange.ALL,l._reverse=!1,l._fieldValidated=!1,l._oldHeight=-1,l._echart=null,l._onSetChartOption=null,$super(t,i)},chartType:function(t){if(void 0===t)return this._chartType;t=jQuery.trim(t);var i=e.Checker.test("DBChart.chartType",t).isString().required();return i.testValue(t.toLowerCase()).inArray(this.chartTypes),this._chartType=t,this},categoryField:function(t){return void 0===t?this._categoryField:(e.Checker.test("DBChart.categoryField",t).isString().required(),t=jQuery.trim(t),this._categoryField=t,this._fieldValidated=!1,this)},valueFields:function(t){return void 0===t?this._valueFields:(e.Checker.test("DBChart.valueFields",t).isString().required(),t=jQuery.trim(t),this._valueFields=t.split(","),this._fieldValidated=!1,this)},chartTitle:function(t){return void 0===t?this._chartTitle:(e.Checker.test("DBChart.chartTitle",t).isString(),this._chartTitle=t,this)},legendPos:function(t){if(void 0===t)return this._legendPos;t=jQuery.trim(t);var i=e.Checker.test("DBChart.legendPos",t).isString().required();return i.testValue(t.toLowerCase()).inArray(this.legendPositions),this._legendPos=t,this},recordRange:function(e){return void 0===e?this._recordRange:(this._recordRange=e,this)},reverse:function(e){return void 0===e?this._reverse:(this._reverse=!!e,this)},onSetChartOption:function(t){return void 0===t?this._onSetChartOption:(e.Checker.test("DBChart.onSetChartOption",t).isFunction(),this._onSetChartOption=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=e.nextId()),this.renderAll(),e.ui.resizeEventBus.subscribe(this)},_getEChart:function(){return this._echart||(this._echart=e.global.echarts.init(this.el)),this._echart},_validateFields:function(){var i=this;if(!i._fieldValidated){var l=i._dataset,n=i._categoryField;if(!l.getField(n))throw new Error(e.formatMessage(t.Dataset.fieldNotFound,[n]));if(i._valueFields)for(var a=0,r=i._valueFields.length;r>a;a++)if(n=i._valueFields[a],!l.getField(n))throw new Error(e.formatMessage(t.Dataset.fieldNotFound,[n]));i._fieldValidated=!0}},_getLineRecord:function(t,i,l,n,a){var r=this,s=0,o=t.recordCount()-1;r._recordRange===e.data.RecordRange.CURRENT&&(s=o=t.recno());for(var d,u,c=!1,h=r._valueFields.length,f=r._recordRange===e.data.RecordRange.SELECTED,p=s;o>=p;p++)if(t.recnoSilence(p),!f||t.selected()){i.push(t.getFieldText(r._categoryField));for(var _=0;h>_;_++)d=r._valueFields[_],c?u=l[_]:(u=[],l.push(u),a.push(t.getField(d).label()),n.push(d)),u.push(t.getFieldValue(d));c=!0}},_getLineRecordReverse:function(t,i,l,n,a){var r=this,s=0,o=t.recordCount()-1;r._recordRange===e.data.RecordRange.CURRENT&&(s=o=t.recno());for(var d,u,c=!1,h=r._valueFields.length,f=r._recordRange===e.data.RecordRange.SELECTED,p=s;o>=p;p++)if(t.recnoSilence(p),!f||t.selected()){a.push(t.getFieldText(r._categoryField)),u=[];for(var _=0;h>_;_++)d=r._valueFields[_],c||(i.push(t.getField(d).label()),n.push(d)),u.push(t.getFieldValue(d));l.push(u),c=!0}},_getLineData:function(){var e=this,t=e._dataset,i=[],l=[],n=[],a=[];if(0===t.recordCount()||!e._valueFields)return{xLabels:i,yValues:l,yFields:n,legendLabels:a};var r=t.recnoSilence();try{e._reverse?e._getLineRecordReverse(t,i,l,n,a):e._getLineRecord(t,i,l,n,a)}finally{t.recnoSilence(r)}return{xLabels:i,yValues:l,yFields:n,legendLabels:a}},_getPieData:function(){var t=this,i=t._dataset,l=[],n=[],a={chartData:l,legendLabels:n,title:""};if(0===i.recordCount()||!t._valueFields)return l=[["",0]],a;var r=0,s=i.recordCount()-1;(t._recordRange===e.data.RecordRange.CURRENT||t._reverse)&&(r=s=i.recno()),t._reverse&&(a.title=t._dataset.getField(t._valueFields[0]).displayLabel());var o,d,u,c,h,f=i.recnoSilence(),p=t._recordRange===e.data.RecordRange.SELECTED;try{if(t._reverse){i.recnoSilence(r),a.title=t._dataset.getField(t._categoryField).displayLabel();var _;for(o=0,d=t._valueFields.length;d>o;o++)u=t._valueFields[o],_=i.getField(u),c=_.displayLabel(),h=_.getValue(),l.push([c,h])}else for(a.title=t._dataset.getField(t._valueFields[0]).displayLabel(),u=t._valueFields[0],o=r;s>=o;o++)i.recnoSilence(o),p&&!i.selected()||(c=i.getFieldText(t._categoryField),h=i.getFieldValue(u),l.push({name:c,value:h}),n.push(c))}finally{i.recnoSilence(f)}return a},_drawLineChart:function(){var e=this,t=e._getLineData(),i=e._getEChart(),l=t.legendLabels,n={title:{text:e._chartTitle},legend:{data:l},xAxis:{data:t.xLabels},yAxis:{type:"value"}},a=t.yValues,r=t.yFields,s=[],o=null,d=e._chartType;"stackline"===d&&(o="stack",d="line"),"stackbar"===d&&(o="stack",d="bar");for(var u=0,c=a.length;c>u;u++)s.push({field:r[u],name:l[u],data:a[u],type:d,stack:o});n.series=s,e._onSetChartOption&&e._onSetChartOption(n),i.setOption(n)},_drawPieChart:function(){var e=this,t=e._getPieData(),i=e._getEChart(),l=t.title,n=(e._chartTitle?e._chartTitle+" - ":"")+l,a=t.legendLabels;t=t.chartData;var r={title:{text:n},legend:{data:a}},s=[{type:"pie",data:t}];r.series=s,e._onSetChartOption&&e._onSetChartOption(r),i.setOption(r)},drawChart:function(){var t=this,i=t._dataset;if(!jQuery(t.el).is(":hidden")&&(t._getEChart().clear(),0!==i.recordCount()&&(t._recordRange!==e.data.RecordRange.SELECTED||t._dataset.hasSelectedRecords())))return t._validateFields(),"pie"==t._chartType?void t._drawPieChart():"line"==t._chartType||"bar"==t._chartType||"stackline"==t._chartType||"stackbar"==t._chartType?void t._drawLineChart():void 0},refreshControl:function(t){var i=t.eventType;(i===e.data.RefreshEvent.UPDATEALL||i===e.data.RefreshEvent.UPDATERECORD||i===e.data.RefreshEvent.UPDATECOLUMN||i===e.data.RefreshEvent.INSERT||i===e.data.RefreshEvent.DELETE||i===e.data.RefreshEvent.SCROLL&&this._recordRange===e.data.RecordRange.CURRENT||(i===e.data.RefreshEvent.SELECTRECORD||i===e.data.RefreshEvent.SELECTALL)&&this._recordRange===e.data.RecordRange.SELECTED)&&this.drawChart()},renderAll:function(){return this.refreshControl(e.data.RefreshEvent.updateAllEvent(),!0),this},checkSizeChanged:function(){var e=this,t=jQuery(e.el).height();e._oldHeight<0||e._oldHeight===t||(e._oldHeight=t,window.setTimeout(function(){e.drawChart()},10))},destroy:function($super){this.jqplot=null,e.ui.resizeEventBus.unsubscribe(this),$super()}}),e.ui.register("DBChart",e.ui.DBChart),e.ui.DBChart.htmlTemplate="<div></div>",e.ui.DBEditPanel=e.Class.create(e.ui.DBControl,{_totalColumns:12,initialize:function($super,t,i){var l=this;l.allProperties="styleClass,dataset,columnCount,labelCols,onlySpecifiedFields,fields,hasLabel,includeFields,excludeFields,layout",l._columnCount=3,l._labelCols=1,l._onlySpecifiedFields=!1,l._includeFields=null,l._excludeFields=null,l._layout=null,l._hasLabel=!0,l._metaChangedDebounce=e.debounce(l.renderAll,10),$super(t,i)},columnCount:function(t){return void 0===t?this._columnCount:(e.Checker.test("DBEditPanel.columnCount",t).isGTZero(),this._columnCount=parseInt(t),this)},labelCols:function(t){return void 0===t?this._labelCols:(e.Checker.test("DBEditPanel.labelCols",t).isNumber().between(1,10),this._labelCols=parseInt(t),this)},onlySpecifiedFields:function(e){return void 0===e?this._onlySpecifiedFields:(this._onlySpecifiedFields=!!e,this)},hasLabel:function(e){return void 0===e?this._hasLabel:(this._hasLabel=!!e,this)},fields:function(e){return this.layout(e)},layout:function(t){if(void 0===t)return this._layout;e.Checker.test("DBEditPanel.layout",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("DBEditPanel.layout.field",i.field).isString().required(),e.Checker.test("DBEditPanel.layout.labelCols",i.labelCols).isNumber().between(1,3),e.Checker.test("DBEditPanel.layout.dataCols",i.dataCols).isNumber().between(1,11),e.Checker.test("DBEditPanel.layout.prefix",i.prefix).isArray(),e.Checker.test("DBEditPanel.layout.suffix",i.suffix).isArray(),e.Checker.test("DBEditPanel.layout.height",i.height).isGTZero(),i.inFirstCol=!!i.inFirstCol,i.showLine=!!i.showLine,i.visible=!(!i.visible&&void 0!==i.visible);return this._layout=t,this},includeFields:function(t){return void 0===t?this._includeFields:(e.Checker.test("DBEditPanel.includeFields",t).isArray(),this._includeFields=t,this)},excludeFields:function(t){return void 0===t?this._excludeFields:(e.Checker.test("DBEditPanel.excludeFields",t).isArray(),this._excludeFields=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.renderAll()},_calcLayout:function(){var e,t,i,l,n,a=this,r=a._dataset.getNormalFields(),s=r.length,o=[],d=a._layout?a._layout.length:0;if(a._onlySpecifiedFields&&a._layout)for(i=0;d>i;i++)e=a._layout[i],(e.visible||void 0===e.visible)&&o.push(e);else{var u=a._excludeFields,c=a._includeFields;for(i=0;s>i;i++)if(t=r[i],l=t.name(),!(u&&u.indexOf(l)>=0)&&(n=!1,!(c&&c.indexOf(l)<0)&&t.visible())){n=!1;for(var h=0;d>h;h++)if(e=a._layout[h],e.field===l){n=!0,(e.visible||void 0===e.visible)&&o.push(e);break}n||o.push({field:l})}}var f=Math.floor((a._totalColumns-a._labelCols*a._columnCount)/a._columnCount);0>=f&&(f=1);var p,_,v=0,m=0;for(i=0,d=o.length;d>i;i++)p=o[i],p.labelCols||(p._innerLabelCols=a._labelCols),p.dataCols?p._innerDataCols=p.dataCols:p._innerDataCols=f,_=p._innerLabelCols+p._innerDataCols,(p.inFirstCol||p.showLine||m+_>a._totalColumns)&&(v++,m=0),p.row=v,m+=_;return o},getEditField:function(e){var t=this;t._layout||(t._layout=[]);for(var i,l=0,n=t._layout.length;n>l;l++)if(i=t._layout[l],i.field==e)return i;var a=t._dataset.getField(e);return a?(i={field:e},t._layout.push(i),i):null},renderAll:function(){var i=this;i.removeAllChildControls();var l=jQuery(i.el);l.hasClass("jl-editpanel")||l.addClass("jl-editpanel form-horizontal"),l.html("");for(var n,a,r,s,o,d,u,c,h,f,p,_=i._dataset.getNormalFields(),v=(_.length,i._calcLayout()),m=-1,g=0,C=v.length;C>g;g++){if(n=v[g],n.showLine&&(u=document.createElement("hr"),i.el.appendChild(u)),n.row!=m&&(h=document.createElement("div"),h.className="form-group form-group-sm",i.el.appendChild(h),m=n.row),o=n.field,d=i._dataset.getField(o),!d)throw new Error(e.formatMessage(t.Dataset.fieldNotFound,[o]));s=d.editControl();var b="dbcheckbox"==s.type.toLowerCase();if(b)i._hasLabel&&(r=document.createElement("div"),h.appendChild(r),r.className="col-sm-"+n._innerLabelCols),c=document.createElement("div"),h.appendChild(c),c.className="col-sm-"+(i._hasLabel?n._innerDataCols:12),s.dataset=i._dataset,s.field=o,a=e.ui.createControl(s,null),c.appendChild(a.el),i.addChildControl(a),i._hasLabel&&(r=document.createElement("label"),c.appendChild(r),p=new e.ui.DBLabel(r,{type:"DBLabel",dataset:i._dataset,field:o})),f=e.nextId(),a.el.id=f,jQuery(r).attr("for",f),i.addChildControl(p);else{i._hasLabel&&(r=document.createElement("label"),h.appendChild(r),r.className="col-sm-"+n._innerLabelCols,p=new e.ui.DBLabel(r,{type:"DBLabel",dataset:i._dataset,field:o}),i.addChildControl(p)),c=document.createElement("div"),h.appendChild(c),c.className="col-sm-"+(i._hasLabel?n._innerDataCols:12),a=e.ui.createControl({type:"DBPlace",dataset:this._dataset,field:o,prefix:n.prefix,suffix:n.suffix},c),f=e.nextId(),a.el.id=f;var y=n.height;y&&(e.isNumber(y)&&(y+="px"),jQuery(a.el).css("height",y),jQuery(a.el.firstChild).css("height","100%")),jQuery(r).attr("for",f),i.addChildControl(a)}}return this},doMetaChanged:function($super,e){!e||"visible"!=e&&"editControl"!=e||this._metaChangedDebounce.call(this)}}),e.ui.register("DBEditPanel",e.ui.DBEditPanel),e.ui.DBEditPanel.htmlTemplate="<div></div>",e.ui.DBInspector=e.Class.create(e.ui.DBControl,{initialize:function($super,t,i){var l=this;l.allProperties="styleClass,dataset,columnCount,layout",l._columnCount=1,l._layout=null,l._includeFields=null,l._excludeFields=null,l._metaChangedDebounce=e.debounce(l.renderAll,10),$super(t,i)},columnCount:function(t){return void 0===t?this._columnCount:(e.Checker.test("DBInspector.columnCount",t).isGTZero(),this._columnCount=parseInt(t),this)},layout:function(t){if(void 0===t)return this._layout;e.Checker.test("DBInspector.layout",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("DBInspector.layout.field",i.field).isString().required();return this._layout=t,this},includeFields:function(t){return void 0===t?this._includeFields:(e.Checker.test("DBInspector.includeFields",t).isArray(),this._includeFields=t,this)},excludeFields:function(t){return void 0===t?this._excludeFields:(e.Checker.test("DBInspector.excludeFields",t).isArray(),this._excludeFields=t,this)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._columnCount;t&&(t=parseInt(t)),t&&t>0?e._columnCount=t:e._columnCount=1,e.renderAll()},_calcLayout:function(){var e,t,i,l,n,a=this,r=a._dataset.getNormalFields(),s=r.length,o=a._layout?a._layout.length:0,d=[],u=a._excludeFields,c=a._includeFields;for(t=0;s>t;t++)if(e=r[t],i=e.name(),!(u&&u.indexOf(i)>=0)&&(l=!1,!(c&&c.indexOf(i)<0)&&e.visible())){l=!1;for(var h=0;o>h;h++)if(n=a._layout[h],n.field===i){l=!0,(void 0===n.visible||n.visible)&&d.push(n);break}l||d.push({field:i})}return d},_calcLabelWidth:function(t){var i,l,n,a=this,r=t.length,s=Math.min(r,a._columnCount),o=[];for(n=0;s>n;n++)o[n]=0;var d=e.ui.textMeasurer.getWidth("*");e.ui.textMeasurer.setElement(a.el);var u,c,h=a._dataset;for(n=0;r>n;n++)c=t[n].field,u=h.getField(c),l=n%s,i=Math.round(e.ui.textMeasurer.getWidth(u.displayLabel())+d)+15,o[l]<i&&(o[l]=i);return e.ui.textMeasurer.setElement(),o},renderAll:function(){var t=this,i=jQuery(t.el);t.removeAllChildControls(),i.hasClass("jl-inspector")||i.addClass("jl-inspector jl-round5");i.width(),t._dataset.getFields();i.html('<table cellpadding=0 cellspacing=0 style="margin:0;padding:0;table-layout:fixed;width:100%;height:100%"><tbody></tbody></table>');var l,n,a,r,s=t._calcLayout();if(r=s.length,0!==r){var o,d=Math.min(r,t._columnCount),u=t._calcLabelWidth(s),c=t.el.firstChild,h=c.createTHead(),f=h.insertRow(-1);for(n=0;d>n;n++)o=f.insertCell(-1),o.style.width=u[n]+"px",o=f.insertCell(-1);var p,_,v,m,g,C,b,y,j=-1;t.preRowIndex=-1;var w=t._dataset;for(n=0;r>n;n++)y=s[n],a=y.field,l=w.getField(a),p=Math.floor(n/d),b=n%d,j!=p&&(f=c.insertRow(-1),j=p),o=f.insertCell(-1),o.noWrap=!0,o.className=e.ui.htmlclass.DBINSPECTOR.labelColCls,v=document.createElement("label"),o.appendChild(v),C=new e.ui.DBLabel(v,{type:"DBLabel",dataset:t._dataset,field:a}),t.addChildControl(C),o=f.insertCell(-1),o.className=e.ui.htmlclass.DBINSPECTOR.editorColCls,o.noWrap=!0,o.align="left",_=document.createElement("div"),_.noWrap=!0,o.appendChild(_),g={type:"DBPlace"},g.dataset=t._dataset,g.field=a,g.prefix=y.prefix,g.suffix=y.suffix,m=e.ui.createControl(g,_),m.isCheckBox||(m.el.style.width="100%"),t.addChildControl(m);return this}},doMetaChanged:function($super,e){!e||"visible"!=e&&"editControl"!=e||this._metaChangedDebounce.call(this)}}),e.ui.htmlclass.DBINSPECTOR={labelColCls:"jl-inspector-label",editorColCls:"jl-inspector-editor"},e.ui.register("DBInspector",e.ui.DBInspector),e.ui.DBInspector.htmlTemplate="<div></div>",e.ui.DBError=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset",$super(e,t)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-errorpanel")||t.addClass("jl-errorpanel"),e.renderAll()},refreshControl:function(t){t&&t.eventType==e.data.RefreshEvent.ERROR&&(this.el.innerHTML=t.message||"")},renderAll:function(){this.refreshControl()}}),e.ui.register("DBError",e.ui.DBError),e.ui.DBError.htmlTemplate="<div></div>",e.ui.DBPageBar=e.Class.create(e.ui.DBControl,{initialize:function($super,e,t){var i=this;i.allProperties="styleClass,dataset,showPageSize,pageSizeList",i._showPageSize=!0,i._pageSizeList=[100,200,500],i._currPageCount=0,$super(e,t)},showPageSize:function(e){return void 0===e?this._showPageSize:(this._showPageSize=!!e,this)},pageSizeList:function(t){if(void 0===t)return this._pageSizeList;e.Checker.test("DBPageBar.pageSizeList",t).isArray();for(var i,l=0,n=t.length;n>l;l++)i=t[l],e.Checker.test("DBPageBar.pageSizeList",i).isGTZero();return this._pageSizeList=t,this},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,i=jQuery(e.el);i.hasClass("jl-pagebar")||i.addClass("jl-pagebar");var l=['<div class="form-inline form-group">','<select class="form-control input-sm jl-pb-pagesize" title="',t.DBPageBar.pageSize,'"></select>','<button class="btn btn-default btn-sm jl-pb-first" title="',t.DBPageBar.first,'"><i class="fa fa-angle-double-left" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-prior" title="',t.DBPageBar.prior,'"><i class="fa fa-angle-left" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-next" title="',t.DBPageBar.next,'"><i class="fa fa-angle-right" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-last" title="',t.DBPageBar.last,'"><i class="fa fa-angle-double-right" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-refresh" title="',t.DBPageBar.refresh,'"><i class="fa fa-refresh" aria-hidden="true"></i></button>','<select class="form-control input-sm jl-pb-pagenum" title="',t.DBPageBar.pageNum,'"></select>',"</div>"];if(i.html(l.join("")),e._jqPageSize=i.find(".jl-pb-pagesize"),e._showPageSize){e._jqPageSize.removeClass("jl-hidden");for(var n,a=e._pageSizeList,r=a.length,s="",o=0;r>o;o++)n=a[o],s+='<option value="'+n+'">'+n+"</option>";e._jqPageSize.html(s),r>0&&e._dataset.pageSize(parseInt(a[0])),e._jqPageSize.on("change",function(t){var i=e.dataset();i.pageNo(1),i.pageSize(parseInt(this.value)),i.requery()})}else e._jqPageSize.addClass("jl-hidden");e._jqFirstBtn=i.find(".jl-pb-first"),e._jqPriorBtn=i.find(".jl-pb-prior"),e._jqNextBtn=i.find(".jl-pb-next"),e._jqLastBtn=i.find(".jl-pb-last"),e._jqRefreshBtn=i.find(".jl-pb-refresh"),e._jqPageNum=i.find(".jl-pb-pagenum"),e._jqFirstBtn.on("click",function(t){if(!this.disabled){var i=e.dataset();i.pageNo(1),i.requery()}}),e._jqPriorBtn.on("click",function(t){if(!this.disabled){var i=e.dataset(),l=i.pageNo();1!=l&&(i.pageNo(l-1),i.requery())}}),e._jqPageNum.on("change",function(t){var i=e.dataset(),l=parseInt(this.value);i.pageNo(l),i.requery()}),e._jqNextBtn.on("click",function(t){if(!this.disabled){var i=e.dataset(),l=i.pageNo();l>=i.pageCount()||(i.pageNo(++l),i.requery())}}),e._jqLastBtn.on("click",function(t){if(!this.disabled){var i=e.dataset();i.pageCount()<1||(i.pageNo(i.pageCount()),i.requery())}}),e._jqRefreshBtn.on("click",function(t){e.dataset().requery()}),e.renderAll()},refreshControl:function(t){t&&t.eventType!=e.data.RefreshEvent.CHANGEPAGE||(this._refreshPageNum(),this._refreshButtonStatus())},_refreshPageNum:function(){var e=this,t=e._dataset.pageNo(),i=e._dataset.pageCount();if(i!==e._currPageCount){for(var l="",n=1;i>=n;n++)l+='<option value="'+n+'">'+n+"</option>";e._jqPageNum.html(l),e._currPageCount=i}e._jqPageNum.val(t)},_refreshButtonStatus:function(){var e=this,t=e._dataset,i=t.pageNo(),l=t.pageCount(),n=!0,a=!0;i>1&&(n=!1),l>i&&(a=!1),e._jqFirstBtn.attr("disabled",n),e._jqPriorBtn.attr("disabled",n),e._jqNextBtn.attr("disabled",a),e._jqLastBtn.attr("disabled",a)},renderAll:function(){this.refreshControl()},destroy:function($super){var e=this;e._jqPageSize&&(e._jqPageSize.off(),e._jqPageSize=null),e._jqFirstBtn.off(),e._jqPriorBtn.off(),e._jqNextBtn.off(),e._jqLastBtn.off(),e._jqPageNum.off(),e._jqRefreshBtn.off(),e._jqFirstBtn=null,e._jqPriorBtn=null,e._jqNextBtn=null,e._jqLastBtn=null,e._jqPageNum=null,e._jqRefreshBtn=null,$super()}}),e.ui.register("DBPageBar",e.ui.DBPageBar),e.ui.DBPageBar.htmlTemplate="<div></div>",e.ui.BatchEditDialog=function(t,i){e.Checker.test("BatchEditDialog#dataset",t).required(),i&&e.isString(i)&&(i=i.split(",")),e.Checker.test("BatchEditDialog#editFields",i).isArray(),t=e.data.getDataset(t);var l=this;l._dataset=t,l._editFields=i,l._onChanging=null,l._batchDataset=new e.data.Dataset({name:t.name()+"_batch"+e.nextId(),fields:[]});var n,a,r=t.getEditableFields();if(i&&i.length>0){for(a=i.length-1;a>=0;a--)n=i[a],r.indexOf(n)<0&&i.splice(a,1);r=i}var s;for(a=r.length-1;a>=0;a--)n=r[a],s=t.getField(n),s.unique()&&r.splice(a,1);l._batchDataset.addFieldFromDataset(t,r),r=l._batchDataset.getNormalFields();var o=r.length;for(a=0;o>a;a++)s=r[a],s.defaultValue(null),s.defaultExpr(null),s.required(!1)},e.ui.BatchEditDialog.prototype={onChanging:function(e){return void 0===e?this._onChanging:(this._onChanging=e,this)},show:function(){var t=this;t._batchDataset.records(null);var i=!1;t._dlgId||(t._createDialog(),i=!0);var l=e("#"+t._dlgId);l.showModal(),l.setZIndex(999)},_createDialog:function(){var i=t.BatchEditDialog,l={type:"window",caption:i.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!1,animation:"fade",styleClass:"jl-bedlg"},n=e.ui.createControl(l),a=e.nextId(),r=e.nextId(),s=['<div class="input-group input-group-sm">',"<div class=\"jl-bedlg-fields\" data-jslet=\"type:'DBInspector',dataset:'",this._batchDataset.name(),"'\"></div></div>",'<div class="input-group input-group-sm jl-bedlg-option">','<div class="col-sm-6"><label><input id="'+a+'" name="jlOnlySelected" type="checkbox" aria-label="...">',i.onlySelected,"</label></div>",'<div class="col-sm-6"><label><input id="'+r+'" name="jlOnlyNull" type="checkbox" aria-label="...">',i.onlyNullValue,"</label></div>","</div>",'<div class="input-group input-group-sm jl-bedlg-toolbar"><label class="control-label col-sm-7">&nbsp</label>','<div class="col-sm-5"><button name="jlbtnOk" class="btn btn-default btn-sm">',i.ok,'</button><button name="jlbtnCancel" class="btn btn-default btn-sm">',i.cancel,"</button></div></div>","</div>"];n.setContent(s.join("")),n.onClosed(function(){return"hidden"}),this._dlgId=n.el.id;var o=jQuery(n.el),d=this;o.find("[name=jlbtnOk]").on("click",function(e){var t=o.find("[name=jlOnlySelected]").prop("checked"),i=o.find("[name=jlOnlyNull]").prop("checked");d._modifyData(t,i)&&n.close()}),o.find("[name=jlbtnCancel]").on("click",function(e){n.close()}),e.ui.install(n.el)},_modifyData:function(i,l){var n=this,a=n._batchDataset;if(a.confirm(),0===a.recordCount()||a.existDatasetError())return e.showInfo(t.BatchEditDialog.errorData),!1;a.first();for(var r,s,o=[],d={},u=a.getNormalFields(),c=0,h=u.length;h>c;c++)r=u[c],s=r.getValue(),null!==s&&void 0!==s&&(o.push(r.name()),d[r.name()]=s);var f,p=o.length;return n._dataset.iterate(function(){if(!i||this.selected()){for(var e=0;p>e;e++)f=o[e],l&&(s=this.getFieldValue(f),null!==s&&""!==s&&void 0!==s)||n._onChanging&&n._onChanging.call(this,f,d[f])||this.setFieldValue(f,d[f]);this.confirm()}}),!0}},e.ui.ChartDialog=function(t,i){function l(e,t){e&&void 0!==e[t]&&void 0!==n[t]&&n[t](e[t])}e.Checker.test("ChartDialog#dataset",t).required();var n=this;n._dataset=e.data.getDataset(t),n._width=800,n._height=500,l(i,"chartTypes"),l(i,"categoryField"),l(i,"valueFields"),l(i,"excludeValueFields"),l(i,"width"),l(i,"height"),n._dlgId=null,n._chartId=null,n._parsedValueFields=null,n._chartSettingDs=null,n._chartSettingDsName=null,n._chartTypeDs=null,n._initialize()},e.ui.ChartDialog.prototype={_initialize:function(){var i=this,l=t.ChartDialog,n=[{code:"line",name:l.ctLine},{code:"bar",name:l.ctBar},{code:"pie",name:l.ctPie},{code:"stackbar",name:l.ctStackBar}],a=new e.data.Dataset({name:"chartTypeDs"+e.nextId(),isEnum:!0,defaultValue:"line",records:n}),r=[{code:e.data.RecordRange.ALL,name:l.rrAll},{code:e.data.RecordRange.CURRENT,name:l.rrCurrent},{code:e.data.RecordRange.SELECTED,name:l.rrSelected}],s=new e.data.Dataset({name:"rangeDs"+e.nextId(),isEnum:!0,defaultValue:"line",records:r});i._chartTypeDs=a;var o=new e.data.Dataset({name:"chartDlgDs"+e.nextId(),isEnum:!0}),d=[{name:"chartType",dataType:"S",label:l.chartType,lookup:{dataset:a},required:!0},{name:"recordRange",dataType:"N",label:l.recordRange,lookup:{dataset:s},required:!0,defaultValue:e.data.RecordRange.ALL},{name:"reverse",dataType:"B",label:l.reverse,defaultValue:!1,visible:!1},{name:"valueFields",dataType:"S",label:l.valueFields,required:!0,lookup:{dataset:o},valueStyle:e.data.FieldValueStyle.MULTIPLE,editControl:{type:"DBComboSelect",textReadOnly:!0}}];i._chartSettingDsName="chartSetting"+e.nextId(),i._chartSettingDs=new e.data.Dataset({name:i._chartSettingDsName,fields:d}),i._chartSettingDs.appendRecord(),i._chartSettingDs.onFieldChanged(jQuery.proxy(i._doFieldChanged,i))},chartTypes:function(t){return void 0===t?this._chartTypes:(e.Checker.test("ChartDialog#chartTypes",t).isArray(),this._chartTypes=t,this)},categoryField:function(t){return void 0===t?this._categoryField:(e.Checker.test("ChartDialog#categoryField",t).isString().required(),this._categoryField=t,this)},valueFields:function(t){return void 0===t?this._valueFields:(e.Checker.test("ChartDialog#valueFields",t).isArray(),this._valueFields=t,this)},excludeValueFields:function(t){return void 0===t?this._excludeValueFields:(e.Checker.test("ChartDialog#excludeValueFields",t).isArray(),
this._excludeValueFields=t,this)},width:function(t){return void 0===t?this._width:(e.Checker.test("ChartDialog.width",t).isNumber(),this)},height:function(t){return void 0===t?this._height:(e.Checker.test("ChartDialog.height",t).isNumber(),this)},show:function(){var i=this;if(e.Checker.test("ChartDialog#categoryField",i._categoryField).isString().required(),i._refreshValueFields(),!i._parsedValueFields||0===i._parsedValueFields.length)return void e.ui.info(t.ChartDialog.valueFieldsRequired);i._chartTypes&&i._chartTypes.length>0?(i._chartTypeDs.filter("inArray([code], "+JSON.stringify(i._chartTypes)+")"),i._chartTypeDs.filtered(!0)):i._chartTypeDs.filtered(!1);var l=!1;i._dlgId||(i._createDialog(),l=!0);var n=e("#"+i._dlgId);n.showModal(),n.setZIndex(999),e("#"+i._chartId).drawChart()},_refreshValueFields:function(){var t,i,l,n,a=this;if(a._valueFields&&a._valueFields.length>0)a._parsedValueFields=a._valueFields;else{a._parsedValueFields=[];var r=a._dataset.getNormalFields(),s=a._excludeValueFields;for(t=0,i=r.length;i>t;t++)l=r[t],n=l.name(),l.dataType()!==e.data.DataType.NUMBER||l.lookup()||s&&s.indexOf(n)>=0||a._parsedValueFields.push(n)}var o=[],d=[];for(t=0,i=a._parsedValueFields.length;i>t;t++)n=a._parsedValueFields[t],l=a._dataset.getField(n),o.push({code:n,name:l.displayLabel()}),d.push(n);var u=a._chartSettingDs,c=u.getField("valueFields").lookup().dataset();u.setFieldValue("valueFields",d),c.records(o)},_createDialog:function(){var i=this,l=t.ChartDialog,n={type:"window",caption:l.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!0,animation:"fade",styleClass:"jl-chartdlg",onSizeChanged:function(){window.setTimeout(function(){e("#"+i._chartId).drawChart()},10)}};i._width&&(n.width=i._width),i._height&&(n.height=i._height);var a=e.ui.createControl(n);a.onClosed(function(){i.destroy()});var r="type: 'DBChart', dataset: '"+i._dataset.name()+"', categoryField: '"+i._categoryField+"', valueFields: '"+i._parsedValueFields.join(",")+"'",s="";s+="<div class=\"jl-chartdlg-editor\" data-jslet=\"type: 'DBEditPanel', dataset: '"+i._chartSettingDsName+"'\"></div>",s+='<div class="jl-chartdlg-chart" data-jslet="'+r+'" style="width: 100%;height: 100%"></div>',a.setContent(s),i._dlgId=a.el.id;var o=jQuery(a.el);e.ui.install(a.el,function(){i._chartId=o.find(".jl-chartdlg-chart")[0].id})},_doFieldChanged:function(t,i){var l=this;if(l._chartId){var n=l._chartSettingDs,a=e("#"+l._chartId);if("chartType"===t)if("pie"===i){a.chartType(i),n.getField("valueFields").valueStyle(e.data.FieldValueStyle.NORMAL);var r=n.getFieldValue("valueFields");if(r&&e.isArray(r)&&r.length>1)return void n.setFieldValue("valueFields",r[0])}else n.getField("valueFields").valueStyle(e.data.FieldValueStyle.MULTIPLE);"valueFields"===t&&e.isArray(i)&&(i=i.join(",")),a[t](i),a.drawChart()}},destroy:function(){var e=this;if(e._chartSettingDs){var t=e._chartSettingDs.getField("valueFields").lookup().dataset();t.destroy(),e._chartSettingDs.destroy(),e._chartSettingDs=null}e._dataset=null}},e.ui.ExportDialog=function(t,i){this._dataset=e.data.getDataset(t),this._exportDataset=null,this._dlgId=null,this._onExported=null,this._onQuerySchema=null,this._onSubmitSchema=null,this._progressBar=null,this._hasSchemaSection=!1,this._includeFields=null,this._excludeFields=null,i&&(this._hasSchemaSection=!!i.hasSchemaSection,this._includeFields=i.includeFields,this._excludeFields=i.excludeFields),this._initialize()},e.ui.ExportDialog.prototype={show:function(i){var l=this;return l._dataset.confirm(),l._dataset.existDatasetError()?void e.ui.confirm(t.ExportDialog.existedErrorData,null,function(e){return"cancel"!=e?l._innerShow(i):void 0}):l._innerShow(i)},_innerShow:function(e){var t=this;if(t._hasSchemaSection){t._exportDataset;t._querySchema()}t._hasDetailDataset=!1,t._refreshFields();var i=jQuery("#"+this._dlgId),l=i[0].jslet;e=e||t._dataset.description()+".xlsx";var n=i.find('[name="jltxtExportFile"]');return n.val(e),t._hasDetailDataset&&i.find('[name="jlOnlyOnceDiv"]').show(),l.showModal(),l.setZIndex(999),l},onQuerySchema:function(t){return void 0===t?this._onQuerySchema:(e.Checker.test("ImportDialog#onQuerySchema",t).isFunction(),this._onQuerySchema=t,this)},onSubmitSchema:function(t){return void 0===t?this._onSubmitSchema:(e.Checker.test("ImportDialog#onSubmitSchema",t).isFunction(),this._onSubmitSchema=t,this)},onExported:function(t){return void 0===t?this._onExported:(e.Checker.test("ExportDialog#onExported",t).isFunction(),this._onExported=t,this)},_initialize:function(){var i=t.ExportDialog,l=[{name:"field",type:"S",length:100,label:"Field Name",nullText:"default"},{name:"label",type:"S",length:50,label:"Field Label"},{name:"parent",type:"S",length:100,label:"Field Name"},{name:"required",type:"B",length:8,visible:!1}],n=new e.data.Dataset({name:"exportLKDs"+e.nextId(),fields:l,keyField:"field",codeField:"field",nameField:"label",parentField:"parent",isFireGlobalEvent:!1});n.onCheckSelectable(function(){return!this.hasChildren()});var a=[{name:"schema",type:"S",length:30,label:"Export Schema"},{name:"fields",type:"S",length:500,label:"Export Fields",visible:!1,valueStyle:e.data.FieldValueStyle.MULTIPLE,lookup:{dataset:n}}],r=this;r._exportDataset=new e.data.Dataset({name:"exportDs"+e.nextId(),fields:a,keyField:"schema",nameField:"schema",isFireGlobalEvent:!1});var s={type:"window",caption:i.caption,isCenter:!0,resizable:!1,minimizable:!1,maximizable:!1,animation:"fade"},o=e.ui.createControl(s),d="";r._hasSchemaSection&&(d='<div class="input-group input-group-sm" style="margin-bottom: 10px"><span class="input-group-addon">'+i.schemaName+'</span><select data-jslet="type:\'DBSelectView\', displayFields:\'schema\'"></select><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnSaveAs">'+i.saveAsSchema+'</button></span><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnSave">'+i.saveSchema+'</button></span><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnDelete">'+i.deleteSchema+"</button></span></div>");var u=['<div class="form-horizontal jl-expdlg-content" data-jslet="dataset: \'',r._exportDataset.name(),"'\">",d,'<div class="input-group input-group-sm" style="width: 100%;margin-bottom: 10px">','<div class="col-sm-12 jl-expdlg-fields" data-jslet="type:\'DBList\',field:\'fields\',correlateCheck:true" style="padding:0px!important"></div></div>','<div class="input-group input-group-sm"><span class="input-group-addon">',i.fileName,"</span>",'<input name="jltxtExportFile" class="form-control"></input>',"</div>",'<div class="checkbox col-sm-6">',"<label>",'<input name="jlOnlySelected" type="checkbox">',i.onlySelected,"</label>","</div>",'<div class="checkbox col-sm-6" name="jlOnlyOnceDiv" style="display:none">',"<label>",'<input name="jlOnlyOnce" type="checkbox" checked="true">',i.onlyOnce,"</label>","</div>",'<div class="col-sm-12"></div>','<div class="input-group input-group-sm jl-expdlg-toolbar" style="margin-bottom: 0;width:100%">','<div class="col-sm-8"><div name="jlProgressExport" data-jslet="type:\'ProgressBar\', value: 50" style="display:none;width:100%"></div></div><div class="col-sm-4"><button name="jlbtnCancel" class="btn btn-default btn-sm jl-expdlg-toolbutton">',i.cancel,'</button><button name="jlbtnExport" class="btn btn-default btn-sm jl-expdlg-toolbutton">',i.exportData,"</button></div></div></div>","</div>"];o.setContent(u.join("")),o.onClosed(function(){r.destroy()}),r._dlgId=o.el.id,e.ui.install(o.el);var c=jQuery(o.el);r._progressBar=c.find('[name="jlProgressExport"]')[0].jslet,c.find('[name="jlbtnExport"]').click(function(e){r._exportData()}),c.find('[name="jlbtnSave"]').click(function(e){r._saveSchema()}),c.find('[name="jlbtnSaveAs"]').click(function(e){r._saveAsSchema()}),c.find('[name="jlbtnDelete"]').click(function(e){r._deleteSchema()}),c.find('[name="jlbtnCancel"]').click(function(e){o.close()})},_saveSchema:function(){var e=this._exportDataset;if(!e.getFieldValue("schema"))return void this._saveAsSchema();e.confirm();var t=e.getRecord();this._submitSchema("update",{schema:t.schema,fields:t.fields})},_saveAsSchema:function(){var i=this;e.ui.prompt(t.ExportDialog.inuputSchemaLabel,null,function(e,t){if("ok"===e&&t){var l=i._exportDataset.getFieldValue("fields"),n=i._exportDataset;n.disableControls(),i._isProgChanged=!0;try{n.cancel(),n.appendRecord(),n.setFieldValue("schema",t),n.setFieldValue("fields",l),n.confirm()}finally{i._isProgChanged=!1,n.enableControls()}var a=i._exportDataset.getRecord();i._submitSchema("insert",{schema:a.schema,fields:a.fields})}})},_deleteSchema:function(){var t=this,i=this._exportDataset.getRecord(),l=this._submitSchema("delete",{schema:i.schema,fields:i.fields});l&&e.isPromise(l)?l.done(function(){t._exportDataset.deleteRecord(),0===t._exportDataset.recordCount()&&t._refreshFields()}):(t._exportDataset.deleteRecord(),0===t._exportDataset.recordCount()&&t._refreshFields())},_querySchema:function(){var t=this,i=this._onQuerySchema||e.global.exportDialog.onQuerySchema;if(!i)return void console.warn("Event handler: onQuerySchema NOT set, can not query export schema!");var l=i();e.isPromise(l)?l.done(function(e){e&&t._exportDataset.records(e),0===t._exportDataset.recordCount()&&t._refreshFields()}):(l&&t._exportDataset.records(l),0===t._exportDataset.recordCount()&&t._refreshFields())},_submitSchema:function(t,i){var l=this,n=l._onSubmitSchema||e.global.exportDialog.onSubmitSchema;return n?n(t,i):(console.warn("Event handler: onSubmitSchema NOT set, can not save export schema!"),null)},_exportData:function(){var i=this,l=jQuery("#"+i._dlgId),n=l.find('[name="jltxtExportFile"]'),a=n.val();if(!a||!a.trim())return e.showInfo(t.ExportDialog.fileAndFieldsRequired),!1;var r=i._exportDataset.getFieldValue("fields");if(!r||0===r.length)return e.showInfo(t.ExportDialog.fileAndFieldsRequired),!1;l.find('[name="jlProgressExport"]').css("display","");var s=l.find('[name="jlOnlySelected"]').prop("checked"),o=l.find('[name="jlOnlyOnce"]').prop("checked");return e.data.defaultXPorter.excelXPorter().exportData(i._dataset,a,{includeFields:r,onlySelected:s,onlyOnce:o,exportAggregated:!0,onExporting:jQuery.proxy(i._doExporting,i),onExported:jQuery.proxy(i._doExported,i)}),!0},_doExported:function(){var t=this;t._onExported&&t._onExported.call(t,t._dataset),e("#"+t._dlgId).close()},_doExporting:function(e){this._progressBar.value(e)},_refreshFields:function(){function i(t,n,a,o,d){for(var u,c,h,f=0,p=a.length;p>f;f++){u=a[f],h=u.dataType();var _=h===e.data.DataType.ACTION,v=h===e.data.DataType.EDITACTION;if(!_&&!v){c=u.name(),o&&d&&(c=o+"."+c);var m=u.detailDataset();if(m)l._hasDetailDataset=!0,t.push({field:c,label:u.label(),parent:o||"_all_"}),i(t,n,m.getNormalFields(),c,!0);else{if(r){if(r.indexOf(c)<0)continue}else if(!u.visible())continue;if(!(s&&s.indexOf(c)>=0)){var g=u.required();t.push({field:c,label:u.label()+(g?'<span class="jl-lbl-required">*</span>':""),parent:o||"_all_",required:g});var C=u.children();C?i(t,n,C,c):n.push(c)}}}}}var l=this,n=[{field:"_all_",label:t.ExportDialog.all}],a=[],r=l._includeFields,s=l._excludeFields;i(n,a,this._dataset.getFields());var o=this._exportDataset.getField("fields").lookup().dataset();o.records(n),this._exportDataset.setFieldValue("fields",a),o.first()},destroy:function(){if(this._exportDataset){var e=this._exportDataset.getField("fields").lookup().dataset();e.destroy(),this._exportDataset.destroy(),this._exportDataset=null}this._dataset=null,this._progressBar=null}},e.ui.ImageViewer=function(e){this._imageUrl=null,this._width=400,this._height=500,this._isModal=!1,e&&(e.width&&this.width(e.width),e.height&&this.height(e.height),this.isModal(e.isModal))},e.ui.ImageViewer.prototype={width:function(t){return void 0===t?this._width:(e.Checker.test("ImageViewer.width",t).isNumber(),this)},height:function(t){return void 0===t?this._height:(e.Checker.test("ImageViewer.height",t).isNumber(),this)},isModal:function(e){return void 0===e?this._isModal:(this._isModal=!!e,this)},imageUrl:function(e){return this._imageUrl=e,this.show(e),this},show:function(i,l){var n=this,a=!1;n._dlgId||(n._createDialog(),a=!0);var r=e("#"+n._dlgId);jQuery(r.el).find("*[name=viewer]").css("background-image","url("+i+")");r.changeCaption(t.ImageViewer.caption+(l?" - "+l:"")),n._isModal?r.showModal():r.show(),r.setZIndex(999)},_createDialog:function(){var i={type:"window",caption:t.ImageViewer.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!0,width:this._width,height:this._height,animation:"fade",styleClass:"jl-isdlg"},l=e.ui.createControl(i),n='<div name="viewer" style="width: 100%; height: 100%;background-size:contain;background-origin:content;background-position:50% 50%;background-repeat:no-repeat;"/>';l.setContent(n),this._dlgId=l.el.id,e.ui.install(l.el)}},e.ui.ImportDialog=function(t,i){this._dataset=e.data.getDataset(t),this._importDataset=null,this._parsedData=null,this._dlgId=null,this._onCustomImport=null,this._onImporting=null,this._onImported=null,this._onQuerySchema=null,this._onSubmitSchema=null,this._schemaDsName=null,this._schemaLkDsName=null,this._colHeaders=null,this._progressBar=null,this._hasSchemaSection=!1,this._includeFields=null,this._excludeFields=null,i&&(this._hasSchemaSection=!!i.hasSchemaSection,this._includeFields=i.includeFields,this._excludeFields=i.excludeFields),this._initialize()},e.ui.ImportDialog.prototype={show:function(){var e=this;e._hasSchemaSection&&e._querySchema(),e._refreshFields();var t=jQuery("#"+this._dlgId);t.find("#jltxtImportFile").val("");var i=t[0].jslet;return i.showModal(),i.setZIndex(999),i},onQuerySchema:function(t){return void 0===t?this._onQuerySchema:(e.Checker.test("ImportDialog#onQuerySchema",t).isFunction(),this._onQuerySchema=t,this)},onSubmitSchema:function(t){return void 0===t?this._onSubmitSchema:(e.Checker.test("ImportDialog#onSubmitSchema",t).isFunction(),this._onSubmitSchema=t,this)},onCustomImport:function(t){return void 0===t?this._onCustomImport:(e.Checker.test("ImportDialog#onCustomImport",t).isFunction(),this._onCustomImport=t,this)},onImporting:function(t){return void 0===t?this._onImporting:(e.Checker.test("ImportDialog#onImporting",t).isFunction(),this._onImporting=t,this)},onImported:function(t){return void 0===t?this._onImported:(e.Checker.test("ImportDialog#onImported",t).isFunction(),this._onImported=t,this)},_initialize:function(){var i=this,l=[{name:"schema",type:"S",length:100,label:"Schema"},{name:"fieldMaps",type:"S",length:5e3,label:"fieldMaps",visible:!1},{name:"colHeaders",type:"S",length:5e3,label:"fieldMaps",visible:!1}],n=new e.data.Dataset({name:"schemaLKDs"+e.nextId(),fields:l,keyField:"schema",codeField:"schema",nameField:"schema",autoRefreshHostDataset:!0,auditLogEnabled:!1,logChanges:!1}),a=t.ImportDialog;i._schemaLkDsName=n.name(),l=[{name:"schema",type:"S",length:100,label:"Schema",lookup:{dataset:n}}],i._schemaDsName="schemaDs"+e.nextId();var r=new e.data.Dataset({name:i._schemaDsName,fields:l});r.onFieldChanged(function(e,t){i._doSchemaChanged(this,t)}),l=[{name:"colHeader",type:"S",length:100,label:"Column Header",displayWidth:16}];var s=new e.data.Dataset({name:"exportLKDs"+e.nextId(),fields:l,keyField:"colHeader",codeField:"colHeader",nameField:"colHeader",autoRefreshHostDataset:!0}),o=[{name:"field",type:"S",length:100,label:"Field Name",visible:!1},{name:"label",type:"S",length:100,visible:!1},{name:"displayLabel",type:"S",length:100,label:a.fieldLabel,displayWidth:12,readOnly:!0},{name:"colHeader",type:"S",length:100,label:a.columnHeader,displayWidth:12,editControl:"DBSelect",lookup:{dataset:s}},{name:"required",type:"B",length:10,label:"required",visible:!1},{name:"fixedValue",type:"S",length:50,label:a.fixedValue,displayWidth:12}];i._importDataset=new e.data.Dataset({name:"importDs"+e.nextId(),fields:o,keyField:"schema",nameField:"schema",isFireGlobalEvent:!1});var d={type:"window",caption:a.caption,isCenter:!0,resizable:!1,minimizable:!1,maximizable:!1,animation:"fade"},u=e.ui.createControl(d),c="";i._hasSchemaSection&&(c='<div class="input-group input-group-sm" style="margin-bottom: 10px"><span class="input-group-addon">'+a.schemaName+"</span><select data-jslet=\"type:'DBSelect',dataset: '"+r.name()+'\', field:\'schema\'"></select><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnSaveAs">'+a.saveAsSchema+'</button></span><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnSave">'+a.saveSchema+'</button></span><span class="input-group-btn"><button class="btn btn-default btn-sm" name="jlbtnDelete">'+a.deleteSchema+"</button></span></div>");var h=['<div class="form-horizontal jl-impdlg-content">',c,'<div class="input-group input-group-sm"><span class="input-group-addon">',a.fileName,"</span>",'<input name="jltxtImportFile" title="*.xls|*.xlsx|*.xlsb|*.xlsm|*.ods" class="form-control" type="file"></input>',"</div>",'<div class="col-sm-12 jl-impdlg-fieldmap" style="padding: 0!important">',"<div data-jslet=\"type:'DBTable', dataset: '",i._importDataset.name(),"', editable: true, hasFilterDialog:false, disableHeadSort: true\"></div></div>",'<div class="col-sm-12"></div>','<div class="input-group input-group-sm jl-impdlg-toolbar" style="margin-bottom: 0;width:100%">','<div class="col-sm-9"><div name="jlProgressImport" data-jslet="type:\'ProgressBar\', value: 50" style="display:none;width:100%"></div></div>','<div class="col-sm-3"><button name="jlbtnCancel" class="btn btn-default btn-sm jl-impdlg-toolbutton">',a.cancel,'</button><button name="jlbtnImport" class="btn btn-default btn-sm jl-impdlg-toolbutton">',a.importData,"</button></div></div></div>","</div>"];u.setContent(h.join("")),u.onClosed(function(){i.destroy()}),e.ui.install(u.el),i._dlgId=u.el.id;var f=jQuery(u.el);i._progressBar=f.find('[name="jlProgressImport"]')[0].jslet,f.find('[name="jlbtnSaveAs"]').click(function(e){i._saveAsSchema()}),f.find('[name="jlbtnSave"]').click(function(e){i._saveSchema()}),f.find('[name="jlbtnDelete"]').click(function(e){i._deleteSchema()}),f.find('[name="jltxtImportFile"]').on("change",function(e){var t=e.delegateTarget.files;t.length>0&&i._readFile(t[0])}),f.find('[name="jlbtnImport"]').click(function(e){i._importData()}),f.find('[name="jlbtnCancel"]').click(function(e){u.close()})},_querySchema:function(){function t(t){t&&e.data.getDataset(i._schemaLkDsName).records(t)}var i=this,l=this._onQuerySchema||e.global.importDialog.onQuerySchema;if(!l)return void console.warn("Event handler: onQuerySchema NOT set, can not query export schema!");var n=l();n&&e.isPromise(n)?n.done(function(e){t(e)}):t(n)},_submitSchema:function(t,i){var l=this,n=l._onSubmitSchema||e.global.importDialog.onSubmitSchema;return n?(delete i._jl_,n(t,i)):null},_saveAsSchema:function(){var i=this,l=i._getFieldMaps();l&&e.ui.prompt(t.ExportDialog.inuputSchemaLabel,null,function(n,a){if("ok"===n&&a){var r=e.data.getDataset(i._schemaDsName),s=e.data.getDataset(i._schemaLkDsName),o=s.startSilenceMove(),d=-1;try{s.findByKey(a)&&(d=s.recno())}finally{s.endSilenceMove(o)}if(d>=0)e.ui.confirm(t.ImportDialog.existedSchema,null,function(e){if("cancel"!=e){s.recno(d),s.editRecord(),s.setFieldValue("schema",a);var t=JSON.stringify(l);s.setFieldValue("fieldMaps",t),s.setFieldValue("colHeaders",JSON.stringify(i._getColHeaders())),s.confirm(),i._isSaving=!0;try{r.setFieldValue("schema",a)}finally{i._isSaving=!1}i._submitSchema("insert",s.getRecord())}});else{s.appendRecord(),s.setFieldValue("schema",a);var u=JSON.stringify(l);s.setFieldValue("fieldMaps",u),s.setFieldValue("colHeaders",JSON.stringify(i._getColHeaders())),s.confirm(),i._isSaving=!0;try{r.setFieldValue("schema",a)}finally{i._isSaving=!1}i._submitSchema("insert",s.getRecord())}}})},_saveSchema:function(){var t=this,i=e.data.getDataset(t._schemaLkDsName),l=e.data.getDataset(t._schemaDsName);if(0===i.recordCount()||!l.getFieldValue("schema"))return void t._saveAsSchema();var n=t._getFieldMaps();if(n){i.editRecord();JSON.stringify(n);i.setFieldValue("fieldMaps",n),i.setFieldValue("colHeaders",JSON.stringify(t._getColHeaders())),i.confirm(),t._submitSchema("update",i.getRecord())}},_deleteSchema:function(){var t=this,i=e.data.getDataset(t._schemaLkDsName),l=e.data.getDataset(t._schemaDsName);if(0!==i.recordCount()&&l.getFieldValue("schema")){var n=t._submitSchema("delete",i.getRecord());n&&e.isPromise(n)?n.done(function(){i.deleteRecord(),l.setFieldValue("schema",null),l.confirm()}):(i.deleteRecord(),l.setFieldValue("schema",null),l.confirm())}},_refreshFields:function(){for(var i,l,n,a,r=[],s=this._dataset.getNormalFields(),o={},d=null,u=this._includeFields,c=this._excludeFields,h=0,f=s.length;f>h;h++){if(i=s[h],l=i.name(),u){if(u.indexOf(l)<0)continue}else if(!i.visible())continue;c&&c.indexOf(l)>=0||(n=i.required(),a=i.label(),o[a]?d?d+=","+d:d=a:o[a]=!0,r.push({field:l,label:a,displayLabel:a+(n?'<span class="jl-lbl-required">*</span>':""),required:n}))}d&&e.showInfo(e.formatMessage(t.ImportDialog.duplicateFields,[d])),this._importDataset.records(r),this._importDataset.first(),this._colHeaders=null},_readFile:function(i){var l=this,n=i.name,a=n.substring(n.lastIndexOf(".")+1)||"";if(a=a.toLowerCase(),"xls"!=a&&"xlsx"!=a&&"xlsb"!=a&&"xlsm"!=a&&"ods"!=a)return void e.showError(t.ImportDialog.notSupportFile);var r=new window.FileReader;r.onload=function(i){var n,a=null;n=i?i.target.result:r.content;try{a=e.data.defaultXPorter.excelXPorter().importData(l._dataset,n)}catch(i){console.error(i),e.showError(t.ImportDialog.notSupportFile)}a?(l._colHeaders=a.header,l._addColumnHeader(l._colHeaders),l._parsedData=a.data):e.showError(t.ImportDialog.noData)},r.readAsBinaryString(i)},_addColumnHeader:function(e){if(e){var t,i,l=[];for(t=0,i=e.length;i>t;t++)l.push({colHeader:e[t]});this._importDataset.getField("colHeader").lookup().dataset().records(l),this._mapFieldColumn()}},_mapFieldColumn:function(){var e=this._colHeaders;if(e){for(var t,i,l=this._importDataset.records(),n=!1,a=0,r=l.length;r>a;a++)i=l[a],i.fixedValue?i.colHeader&&(i.colHeader=null,n=!0):(t=i.colHeader||i.label,e.indexOf(t)>=0?(i.colHeader=t,n=!0):i.colHeader=null);n&&this._importDataset.records(l)}},_doSchemaChanged:function(t,i){if(!this._isSaving){var l,n=null,a=0;e.data.getDataset(this._schemaLkDsName);if(i){n=JSON.parse(t.getFieldValue("schema.fieldMaps")),a=n.length;var r=JSON.parse(t.getFieldValue("schema.colHeaders"));l=[];for(var s=0,o=r.length;o>s;s++)l.push({colHeader:r[s]});var d=this._importDataset.getField("colHeader").lookup().dataset();d.records(l)}l=this._importDataset.records();for(var u,c,h,f,p=0,_=l.length;_>p;p++)if(u=l[p],c=u.field,u.colHeader=null,u.fixedValue=null,h=null,n)for(var v=0;a>v;v++)if(f=n[v],f.field==c){u.colHeader=f.colHeader,u.fixedValue=f.fixedValue;break}this._importDataset.records(l)}},_getFieldMaps:function(){for(var i,l=this._importDataset.records(),n=[],a=0,r=l.length;r>a;a++)if(i=l[a],i.colHeader||i.fixedValue)n.push({field:i.field,colHeader:i.colHeader,fixedValue:i.fixedValue});else if(i.required)return e.showInfo(t.ImportDialog.noColHeader),null;var s=n.length;return 0===s?(e.showInfo(t.ImportDialog.noColHeader),null):n},_getColHeaders:function(){for(var e=[],t=this._importDataset.getField("colHeader").lookup().dataset().records(),i=0,l=t.length;l>i;i++)e.push(t[i].colHeader);return e},_importData:function(){var i=this;if(!i._parsedData||0===i._parsedData.length)return void e.showInfo(t.ImportDialog.noData);var l=i._getFieldMaps();if(l)if(i._onCustomImport){var n=i._onCustomImport(i._dataset,i._parsedData,l);if(!n)return}else{for(var a,r,s,o,d,u=(i._dataset,i._parsedData),c=[],h=l.length,f=i._onImporting,p=0,_=u.length;_>p;p++){d=u[p],o={};for(var v=0;h>v;v++)a=l[v],s=a.colHeader,r=s?f?f(a.field,d[s]):d[s]:a.fixedValue,r&&(o[a.field]=r);c.push(o)}var m=jQuery("#"+i._dlgId);m.find('[name="jlProgressImport"]').css("display","");var g=i._dataset,C=i._progressBar;g.disableControls(),new e.StepProcessor(c.length,function(e,t,l){try{g.importTextList(c,e,t)}catch(n){throw g.enableControls(),n}C.value(l),100===l&&(g.enableControls(),g.first(),i._doImported())}).run()}},_doImported:function(){var t=this;t._onImported&&t._onImported(t._dataset),e("#"+t._dlgId).close()},destroy:function(){var t=this;t._onImporting=null,t._onImported=null,t._onCustomImport=null,t._progressBar=null,t._dataset=null;var i=e.data.getDataset(t._schemaLkDsName);i&&i.destroy();var l=e.data.getDataset(t._schemaDsName);if(l&&l.destroy(),t._importDataset){var n=t._importDataset.getField("colHeader").lookup().dataset();n.destroy(),this._importDataset.destroy(),this._importDataset=null}}},e.ui.InputSettingDialog=function(){function i(t,i,l){var n=e.data.getDataset(t.dataset).getField(i);if(l.dataType(n.dataType()),l.length(n.length()),l.scale(n.scale()),l.editMask(n.editMask()),l.displayFormat(n.displayFormat()),l.dateFormat(n.dateFormat()),l.displayControl(n.displayControl()),l.validChars(n.validChars()),n.lookup()){var a=n.lookup(),r=a.toPlanObject();r.onlyLeafLevel=!1,l.lookup(r),l.editControl("DBComboSelect")}else{l.lookup(null);var s=n.editControl(),o=n.getType();o!==e.data.DataType.DATE&&o!==e.data.DataType.BOOLEAN&&(s={type:"DBText"}),l.editControl(s)}l.valueStyle(e.data.FieldValueStyle.NORMAL)}function l(){var l=[{name:"dataset",type:"S",length:30,visible:!1},{name:"field",type:"S",length:30,displayWidth:20,visible:!1},{name:"label",type:"S",label:t.InputSettingDialog.labelLabel,length:50,displayWidth:15,disabled:!0},{name:"parentField",type:"S",length:30,visible:!1},{name:"tabIndex",type:"N",label:"tabIndex",length:3,visible:!1},{name:"focused",type:"B",label:t.InputSettingDialog.labelFocused,displayWidth:6},{name:"valueFollow",type:"B",label:t.InputSettingDialog.labelValueFollow,displayWidth:6},{name:"defaultValue",type:"P",label:t.InputSettingDialog.labelDefaultValue,length:200,displayWidth:30,proxyHostFieldName:"field",proxyFieldChanged:i},{name:"isDatasetField",type:"B",label:"",visible:!1}];n._inputSettingDs=new e.data.Dataset({name:"custDs"+e.nextId(),fields:l,keyField:"field",nameField:"label",parentField:"parentField",logChanges:!1,indexFields:"tabIndex",isFireGlobalEvent:!1});var a=function(e,t){var i=e.dataset();e.disabled(i.getFieldValue("isDatasetField"))};n._inputSettingDs.contextRules([{condition:"true",rules:[{field:"defaultValue",customized:a},{field:"focused",customized:a},{field:"valueFollow",customized:a}]}]),n._inputSettingDs.enableContextRule(),n._inputSettingDs.onFieldChanged(function(e,t){if(!n._isInit){n._settings||(n._settings={});var i=this.getFieldValue("dataset"),l=this.getFieldValue("field"),a=n._settings[i];a||(a={},n._settings[i]=a);var r=a[l];r||(r={},a[l]=r),r[e]=t}})}this._inputSettingDs=null,this._hostDataset=null,this._onClosed=null,this._onRestoreDefault=null,this._settings=null;var n=this;l.call(this)},e.ui.InputSettingDialog.prototype={hostDataset:function(e){return void 0===e?this._hostDataset:(this._hostDataset=e,this)},onClosed:function(e){return void 0===e?this._onClosed:(this._onClosed=e,this)},onRestoreDefault:function(e){return void 0===e?this._onRestoreDefault:(this._onRestoreDefault=e,this)},show:function(t){e.Checker.test("InputSettingDialog.show#hostDataset",t).required();var i=this;i._hostDataset=e.data.getDataset(t),i._isInit=!0,i._settings=null,i._inputSettingDs.disableControls();try{i._initializeFields()}finally{i._isInit=!1,i._inputSettingDs.first(),i._inputSettingDs.enableControls()}var l=!1;i._dlgId||(i._createDialog(),l=!0);var n=jQuery("#"+i._dlgId).find(".jl-isdlg-fields")[0].jslet;n.expandAll();var a=n.getTotalWidth()+n.getTotalWidth(!0);l&&n.onRowClick(function(){this.dataset().getFieldValue("isDatasetField")&&this.toggle()});var r=e("#"+i._dlgId);r.changeSize(a+60),r.showModal(),r.setZIndex(999)},_initializeFields:function(t,i,l){var n,a=this,r=a._inputSettingDs;t||(t=e.data.getDataset(a._hostDataset));var s=t.getNormalFields();i||r.records(null);for(var o,d=0,u=s.length;u>d;d++){n=s[d],o=!!n.detailDataset();var c=n.dataType;(o||n.visible())&&c!==e.data.DataType.ACTION&&c!==e.data.DataType.EDITACTION&&(r.appendRecord(),r.setFieldValue("isDatasetField",o),r.setFieldValue("dataset",t.name()),r.setFieldValue("field",n.name()),r.setFieldValue("label",n.label()),r.setFieldValue("tabIndex",n.tabIndex()),l&&r.setFieldValue("parentField",l),o||(r.setFieldValue("defaultValue",n.defaultValue()),r.setFieldValue("focused",n.focused()),r.setFieldValue("valueFollow",n.valueFollow())),r.confirm(),o&&this._initializeFields(n.detailDataset(),!0,n.name()))}},_createDialog:function(){var i={type:"window",caption:t.InputSettingDialog.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!1,animation:"fade",styleClass:"jl-isdlg"},l=e.ui.createControl(i),n=['<div class="input-group input-group-sm" style="margin-bottom: 10px">',"<div class=\"jl-isdlg-fields\" data-jslet=\"type:'DBTable',dataset:'",this._inputSettingDs.name(),"',treeField:'label',readOnly:false,hasFilterDialog:false\"></div></div>",'<div class="input-group input-group-sm jl-isdlg-toolbar"><label class="control-label col-sm-9">&nbsp</label>','<div class="col-sm-3"><button id="jlbtnSave" class="btn btn-default btn-sm">',t.InputSettingDialog.save,'</button><button id="jlbtnCancel" class="btn btn-default btn-sm">',t.InputSettingDialog.cancel,"</button></div></div>","</div>"];l.setContent(n.join("")),l.onClosed(function(){return"hidden"}),this._dlgId=l.el.id;var a=jQuery(l.el),r=this;a.find("#jlbtnSave").on("click",function(t){if(r._settings){var i,n,a,s;for(var o in r._settings){i=e.data.getDataset(o),a=r._settings[o];for(var d in a){n=i.getField(d),s=a[d];for(var u in s)n[u](s[u])}}r._onClosed&&r._onClosed(r._settings)}l.close()}),a.find("#jlbtnCancel").on("click",function(e){l.close()}),e.ui.install(l.el)}},e.ui.defaultInputSettingDialog=new e.ui.InputSettingDialog,e.ui.DatasetDesigner=e.Class.create(e.ui.Control,{initialize:function($super,e,t){var i=this;i.allProperties="onLoadDatasetMeta, onSaveDatasetMeta",i.requiredProperties="onLoadDatasetMeta, onSaveDatasetMeta",i._datasetMetas=null,i._onLoadDatasetMeta=null,i._onSaveDatasetMeta=null,i._prepareDataset(),$super(e,t)},onLoadDatasetMeta:function(t){return e.Checker.test("DatasetDesigner.onLoadDatasetMeta",t).required(),this._onLoadDatasetMeta=t,this},onSaveDatasetMeta:function(t){return e.Checker.test("DatasetDesigner.onSaveDatasetMeta",t).required(),this._onSaveDatasetMeta=t,this},_prepareDataset:function(){var i=t.DatasetDesigner;new e.data.Dataset({name:"dsgnDatatype",isEnum:!0,records:"S:"+i.dtString+",N:"+i.dtNumber+",D:"+i.dtDate+",B:"+i.dtBoolean+",V:"+i.dtDataset+",A:"+i.dtAction+",E:"+i.dtEdit}),new e.data.Dataset({name:"dsgnAlignment",isEnum:!0,records:"left:"+i.alLeft+",center:"+i.alCenter+",right:"+i.alRight}),new e.data.Dataset({name:"dsgnValueStyle",isEnum:!0,records:"0:"+i.vsNormal+",1:"+i.vsBetween+",2:"+i.vsMultiple}),new e.data.Dataset({name:"dsgnEditor",fields:[{name:"code",type:"S"}],keyField:"code",records:[{code:"DBText"},{code:"DBCheckBox"},{code:"DBSelect"},{code:"DBComboSelect"},{code:"DBAutoComplete"},{code:"DBDatePicker"},{code:"DBPassword"},{code:"DBTextArea"},{code:"DBSpinEdit"},{code:"DBBetweenEdit"},{code:"DBCheckBoxGroup"},{code:"DBRadioGroup"},{code:"DBRangeSelect"},{code:"DBDataLabel"},{code:"DBTimePicker"},{code:"DBImage"},{code:"DBRating"},{code:"DBHtml"},{code:"DBCKEditor"},{code:"DBUEditor"}]});var l={getValue:function(e,t){if(e){var i=e[t];if(i)return JSON.stringify(i)}return null},setValue:function(t,i,l){t&&l&&e.isString(l)&&(t[i]=JSON.parse(l))}},n=[{name:"name",type:"S",length:30,label:i.fName,displayWidth:20,required:!0,unique:!0},{name:"shortName",type:"S",length:10,label:i.fShortName,displayWidth:10},{name:"label",type:"S",length:30,label:i.fLabel,displayWidth:20},{name:"displayLabel",type:"S",length:30,label:i.fDisplayLabel,displayWidth:20},{name:"tip",type:"S",length:30,label:i.fTip,displayWidth:20},{name:"dataType",type:"S",length:1,label:i.fDateType,lookup:{dataset:"dsgnDatatype"},displayWidth:10,defaultValue:"S"},{name:"detailDataset",
type:"S",length:30,label:i.fDetailDataset,displayWidth:10},{name:"length",type:"N",length:3,label:i.fLength,displayWidth:10,diaplayFormat:"##0",editControl:"DBSpinEdit",dataRange:{min:0,max:1e4},defaultValue:10},{name:"scale",type:"N",length:3,label:i.fScale,displayWidth:6,diaplayFormat:"##0",editControl:"DBSpinEdit",dataRange:{min:0,max:10}},{name:"defaultExpr",type:"S",length:100,label:i.fDefaultExpr,displayWidth:10},{name:"defaultValue",type:"S",length:100,label:i.fDefaultValue,displayWidth:10,customValueAccessor:l},{name:"valueStyle",type:"S",label:i.fValueStyle,displayWidth:10,lookup:{dataset:"dsgnValueStyle"},defaultValue:0},{name:"displayWidth",type:"N",length:3,label:i.fDisplayWidth,displayWidth:10,dataRange:{min:0,max:1e4},diaplayFormat:"##0",editControl:"DBSpinEdit"},{name:"displayOrder",type:"N",length:3,label:i.fDisplayOrder,displayWidth:6,defaultValue:0,diaplayFormat:"##0",editControl:"DBSpinEdit",dataRange:{min:0,max:1e4}},{name:"alignment",type:"S",length:3,label:i.fAlignment,displayWidth:10,lookup:{dataset:"dsgnAlignment"}},{name:"displayFormat",type:"S",length:30,label:i.fDisplayFormat,displayWidth:10},{name:"editControl",type:"S",length:100,label:i.fEditControl,displayWidth:10,lookup:{dataset:"dsgnEditor"},nullText:i.fvEditControl},{name:"nullText",type:"S",label:i.fNullText,displayWidth:10,defaultValue:i.fvNullText},{name:"formula",type:"S",length:100,label:i.fFormula,displayWidth:50},{name:"readOnly",type:"B",label:i.fReadOnly,displayWidth:10},{name:"visible",type:"B",label:i.fVisible,displayWidth:10},{name:"unitConverted",type:"B",label:i.fUnitConverted,displayWidth:10},{name:"required",type:"B",label:i.fRequired,displayWidth:10},{name:"dataRange",type:"S",length:50,label:i.fDataRange,displayWidth:10,customValueAccessor:l},{name:"regularExpr",type:"S",length:50,label:i.fRegularExpr,displayWidth:10,customValueAccessor:l},{name:"unique",type:"B",label:i.fUnique,displayWidth:10},{name:"editMask",type:"S",label:i.fEditMask,displayWidth:10},{name:"valueCountLimit",type:"N",length:3,label:i.fValueCountLimit,displayWidth:8,dataRange:{min:0,max:10},diaplayFormat:"##0",editControl:"DBSpinEdit"},{name:"validChars",type:"S",label:i.fValidChars,displayWidth:10},{name:"mergeSame",type:"B",label:i.fMergeSame,displayWidth:10},{name:"mergeSameBy",type:"S",label:i.fMmergeSameBy,displayWidth:10},{name:"aggraded",type:"B",label:i.fAggraded,displayWidth:10},{name:"aggradedBy",type:"S",label:i.fAggradedBy,displayWidth:10},{name:"valueFollow",type:"B",label:i.fValueFollow,displayWidth:10},{name:"focused",type:"B",label:i.fFocused,displayWidth:10},{name:"fixedValue",type:"S",label:i.fFixedValue,displayWidth:10},{name:"antiXss",type:"B",label:i.fAntiXss,displayWidth:10},{name:"trueValue",type:"S",label:i.fTrueValue,displayWidth:10},{name:"falseValue",type:"S",label:i.fFalseValue,displayWidth:10},{name:"trueText",type:"S",label:i.fTrueText,displayWidth:10},{name:"falseText",type:"S",label:i.fFalseText,displayWidth:10},{name:"lookup",type:"S",length:100,label:i.fLookup,displayWidth:10,customValueAccessor:l}],a=this,r=new e.data.Dataset({name:"dsgnField",fields:n});r.onFieldChanged(function(e,t){"dataType"===e&&a._doDataTypeChanged(t)});var s=[{condition:"[valueStyle] === 2",rules:[{field:"valueCountLimit",meta:{disabled:!1}}],otherwise:[{field:"valueCountLimit",meta:{disabled:!0},value:null}]},{condition:'[dataType] === "B"',rules:[{field:"editControl",lookup:{fixedFilter:'inlist([code], "DBCheckBox", "DBText", "DBDataLabel") '}},{field:"valueStyle",meta:{disabled:!0}},{field:"displayFormat",meta:{disabled:!0}},{field:"editMask",meta:{disabled:!0}}],otherwise:[{field:"valueStyle",meta:{disabled:!1}},{field:"displayFormat",meta:{disabled:!1}},{field:"editMask",meta:{disabled:!1}}]},{condition:'[dataType] === "D"',rules:[{field:"editControl",lookup:{fixedFilter:'inlist([code], "DBDatePicker", "DBText", "DBDataLabel") '}}]},{condition:"[lookup]",rules:[{field:"editControl",lookup:{fixedFilter:'inlist([code], "DBComboSelect", "DBSelect", "DBAutoComplete", "DBCheckBoxGroup", "DBRadioGroup","DBText", "DBDataLabel")'}}]},{condition:'[dataType] === "N" && ![lookup]',rules:[{field:"editControl",lookup:{fixedFilter:'inlist([code], "DBText", "DBSpinEdit", "DBRangeSelect", "DBRating", "DBDataLabel") '}}]},{condition:'[dataType] === "S" && ![lookup]',rules:[{field:"editControl",lookup:{fixedFilter:'inlist([code], "DBText", "DBTextArea", "DBPassword", "DBHtml", "DBImage", "DBCKEditor", "DBUEditor", "DBDataLabel") '}}]}];r.contextRules(s),n=[{name:"name",type:"S",length:30,label:i.dsName,displayWidth:20,required:!0,unique:!0},{name:"description",type:"S",length:100,label:i.dsDesc,displayWidth:20},{name:"isEnum",type:"B",defaultValue:!1},{name:"records",type:"S",length:2e3,editControl:"DBTextArea"},{name:"keyField",type:"S",length:30,label:i.dsKeyField,displayWidth:10},{name:"codeField",type:"S",length:30,label:i.dsCodeField,displayWidth:10},{name:"nameField",type:"S",length:30,label:i.dsNameField,displayWidth:10},{name:"parentField",type:"S",length:30,label:i.dsParentField,displayWidth:10},{name:"selectField",type:"S",length:30,label:i.dsSelectField,displayWidth:10,visible:!1},{name:"statusField",type:"S",length:30,label:i.dsStatusField,displayWidth:10,visible:!1},{name:"contextRules",type:"S",length:3e3,label:i.dsContextRules,displayWidth:10},{name:"queryUrl",type:"S",length:300,label:i.dsQueryUrl,displayWidth:10,visible:!1},{name:"submitUrl",type:"S",length:300,label:i.dsSubmitUrl,displayWidth:10,visible:!1},{name:"recordClass",type:"S",length:50,label:i.dsRecordClass,displayWidth:10,visible:!1},{name:"pageSize",type:"N",length:5,label:i.dsPageSize,displayWidth:10,visible:!1},{name:"fixedIndexFields",type:"S",length:100,label:i.dsFixedIndexFields,displayWidth:10},{name:"indexFields",type:"S",length:100,label:i.dsIndexFields,displayWidth:10},{name:"fixedFilter",type:"S",length:200,label:i.dsFixedFilter,displayWidth:10},{name:"filter",type:"S",length:200,label:i.dsFilter,displayWidth:10},{name:"filtered",type:"B",label:i.dsFiltered,displayWidth:10,visible:!1},{name:"readOnly",type:"B",label:i.dsReadOnly,displayWidth:10,visible:!1},{name:"auditLogEnabled",type:"B",label:i.dsAuditLogEnabled,displayWidth:10,visible:!1},{name:"fields",type:"V",label:"Fields",detailDataset:"dsgnField",visible:!1}];new e.data.Dataset({name:"dsgnDataset",fields:n});n=[{name:"id",type:"S",length:30},{name:"objCode",type:"S",length:50},{name:"objName",type:"S",length:50},{name:"objType",type:"S",length:2},{name:"parentId",type:"S",length:30},{name:"changed",type:"B"},{name:"isEnum",type:"B"},{name:"dsName",type:"S"},{name:"fldName",type:"S"}];var o=new e.data.Dataset({name:"dsgnObject",fields:n,keyField:"id",codeField:"objCode",nameField:"objName",parentField:"parentId",logChanges:!1});o.on(e.data.DatasetEvent.AFTERSCROLL,function(){a._doObjectChanged()})},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=e.nextId());var t=jQuery(this.el);t.hasClass("jl-dsgn-ds")&&t.addClass("form-group form-group-sm jl-dsgn-ds"),this.renderAll()},renderAll:function(){var t=this,i=jQuery(this.el),l='<div class="col-xs-3" style="height: 100%"><div style="height: 100%" name="dsgnObject" data-jslet="type: \'DBTreeView\', dataset: \'dsgnObject\', displayFields: \'[objName] + %22(%22 + [objCode] + %22)%22\', expandLevel: 1"></div></div><div class="col-xs-9"><div name="dsgnDs" style="display: none"><div name="dsgnDsBase" data-jslet="type:\'DBEditPanel\', dataset: \'dsgnDataset\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: \'name\'}, {field: \'description\', dataCols: 6}]"></div><div name="dsgnEnumValues" style="display: none" data-jslet="type:\'DBEditPanel\', dataset: \'dsgnDataset\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: \'records\'}]"></div><div name="dsgnDsLookup" style="display: none" data-jslet="type:\'DBEditPanel\', dataset: \'dsgnDataset\', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,'+"fields: [{field: 'keyField'}, {field: 'codeField'}, {field: 'nameField'}, {field: 'parentField'}]\"></div><div name=\"dsgnDsFilter\" style=\"display: none\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnDataset', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'fixedIndexFields'}, {field: 'indexFields'}, {field: 'fixedFilter'}, {field: 'filter'}]\"></div></div><div name=\"dsgnFld\" style=\"display: none\"><div name=\"dsgnFldBase\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'name'}, {field: 'label'}, {field: 'shortName'}, {field: 'dataType'}]\"></div><div name=\"dsgnFldDetail\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'detailDataset', dataCols: 6}]\"></div><div name=\"dsgnFldCommon\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'displayOrder'},{field: 'displayWidth'}, {field: 'alignment'}, {field: 'visible'}]\"></div><div name=\"dsgnFldLookup\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'lookup', dataCols: 6}]\"></div><div name=\"dsgnFldEditable\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'editControl'}, {field: 'readOnly'}, {field: 'required'}, {field: 'unique'}, {field: 'nullText'}, {field: 'valueStyle'}, {field: 'valueCountLimit'}, {field: 'defaultValue'}, {field: 'displayFormat'}, {field: 'editMask'}, {field: 'focused'}, {field: 'valueFollow'}, {field: 'dataRange'}, {field: 'regularExpr'}, {field: 'mergeSame', inFirstCol: true}, {field: 'mergeSameBy', dataCols: 6}]\"></div><div name=\"dsgnFldAction\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'fixedValue', dataCols: 6}]\"></div><div name=\"dsgnFldBool\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'trueValue'}, {field: 'falseValue'}, {field: 'trueText'}, {field: 'falseText'}]\"></div><div name=\"dsgnFldString\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'antiXss'}]\"></div><div name=\"dsgnFldNumber\" data-jslet=\"type:'DBEditPanel', dataset: 'dsgnField', labelCols: 2, columnCount: 3, onlySpecifiedFields: true,fields: [{field: 'aggraded'}, {field: 'aggradedBy', dataCols: 6}]\"></div></div>";console.log(l),i.html(l),e.ui.install(t.el),e(i.find('[name="dsgnObject"]')).onGetIconClass(function(){var e=this.dataset();return"d"===e.getFieldValue("objType")?"fa fa-table":"fa fa-dot-circle-o"}),t.queryDatasetMeta()},queryDatasetMeta:function(){var e=this;if(e._onLoadDatasetMeta){var t=e._onLoadDatasetMeta();t&&(t.done?t.done(function(t){e._parse(t)}):e._parse(t))}},addDatasetMeta:function(){var t=e.data.getDataset("dsgnObject");t.appendRecord(),t.setFieldValue("isEnum",!0)},addEnumDatasetMeta:function(){var t=e.data.getDataset("dsgnObject");t.appendRecord(),t.setFieldValue("isEnum",!1)},deleteDatasetMeta:function(){var t=e.data.getDataset("dsgnObject");t.deleteRecord()},_parse:function(t){function i(e,t,l){for(var n,a,r,o=0,d=e.length;d>o;o++)n=e[o],r=n.name,a="f-"+r,s.push({id:a,objCode:r,objName:n.label||n.name,objType:"f",parentId:t,dsName:l,fldName:r}),n.children&&i(n.children,a)}if(this._datasetMetas=t,e.data.getDataset("dsgnDataset").records(t),t&&0!==t.length){for(var l,n,a,r,s=[],o=0,d=t.length;d>o;o++)l=t[o],r=l.name,n="d-"+r,a=!!l.isEnum,s.push({id:n,objCode:r,objName:l.description||r,objType:"d",isEnum:a,dsName:r}),a||i(l.fields,n,r);e.data.getDataset("dsgnObject").records(s)}},_doObjectChanged:function(){var t=this,i=e.data.getDataset("dsgnObject"),l=i.getFieldValue("objType"),n=i.getFieldValue("dsName"),a=i.getFieldValue("fldName"),r=jQuery(t.el),s=r.find("[name=dsgnDs]"),o=r.find("[name=dsgnDsLookup]"),d=r.find("[name=dsgnDsFilter]"),u=r.find("[name=dsgnFld]"),c=e.data.getDataset("dsgnDataset"),h=e.data.getDataset("dsgnField");if("d"===l){c.findByField("name",n);var f=i.getFieldValue("isEnum");f?(o.hide(),d.hide()):(o.show(),d.show()),u.hide(),s.show()}else{c.findByField("name",n),h.findByField("name",a);var p=h.getFieldValue("dataType");t._doDataTypeChanged(p),s.hide(),u.show()}},_doDataTypeChanged:function(t){var i=this,l=jQuery(i.el),n=e.data.getDataset("dsgnField"),a=l.find("[name=dsgnFldDetail]"),r=l.find("[name=dsgnFldCommon]"),s=l.find("[name=dsgnFldAction]"),o=l.find("[name=dsgnFldEditAction]"),d=l.find("[name=dsgnFldEditable]"),u=l.find("[name=dsgnFldBool]"),c=l.find("[name=dsgnFldLookup]"),h=l.find("[name=dsgnFldString]"),f=l.find("[name=dsgnFldNumber]");return a.hide(),r.hide(),s.hide(),o.hide(),u.hide(),d.hide(),c.hide(),h.hide(),f.hide(),t===e.data.DataType.DATASET?(a.show(),void n.getField("detailDataset").required(!0)):(n.getField("detailDataset").required(!1),r.show(),t!==e.data.DataType.EDITACTION?t===e.data.DataType.ACTION?(s.show(),void n.getField("fixedValue").required(!0)):(n.getField("fixedValue").required(!1),d.show(),t===e.data.DataType.BOOLEAN?void u.show():void(t!==e.data.DataType.DATE&&(c.show(),t===e.data.DataType.STRING&&h.show(),t===e.data.DataType.NUMBER&&f.show()))):void 0)},destroy:function($super){$super()}}),e.ui.register("DatasetDesigner",e.ui.DatasetDesigner),e.ui.DatasetDesigner.htmlTemplate="<div></div>",function(){function i(e){this.name=e,this.eventAction=null,this.subscribe=function(e){this.eventAction=e},this.fire=function(e,t){null!=this.eventAction&&this.eventAction(e,t)}}function l(){if(0!=arguments.length){if("object"==typeof arguments[0])this.host=arguments[0].host,this.subprotocol=arguments[0].subprotocol,this.user=arguments[0].user,this.password=arguments[0].password,this.transport=arguments[0].transport;else{if("string"!=typeof arguments[0])return;this.host=arguments[0],this.subprotocol=arguments[1],this.transport=arguments[2]}void 0==this.host&&(this.host="127.0.0.1"),void 0==this.subprotocol&&(this.subprotocol=""),void 0==this.transport&&(this.transport=["websocket","sse"]);var e=new i("onopen"),t=new i("onclose"),l=new i("onmessage"),n=new i("onerror");if(window.WebSocket&&this.transport.indexOf("websocket")>-1){var a=new i("onstream");this.open=function(){""!==this.host&&""!==this.user&&void 0!==this.user?(void 0==this.password&&""==this.password,""!==this.subprotocol&&void 0!==this.subprotocol?this.websocket=new WebSocket(this.host+"/sgc/auth/url/"+this.user+"/"+this.password,this.subprotocol):this.websocket=new WebSocket(this.host+"/sgc/auth/url/"+this.user+"/"+this.password)):""!==this.host&&""!==this.subprotocol&&void 0!==this.subprotocol?this.websocket=new WebSocket(this.host,this.subprotocol):""!==this.host&&(this.websocket=new WebSocket(this.host)),this.websocket.onopen=function(){e.fire({name:"onopen",message:""})},this.websocket.onmessage=function(e){"object"==typeof e.data?a.fire({name:"onstream",stream:e.data}):l.fire({name:"onmessage",message:e.data})},this.websocket.onclose=function(e){t.fire({name:"onclose",message:"",code:e.code,reason:e.reason,clean:e.wasClean})},this.websocket.onerror=function(e){n.fire({name:"onerror",message:e.data})}},void 0==this.websocket&&this.open(),this.send=function(e){this.websocket.send(e)},this.close=function(){this.websocket.close()},this.state=function(){switch(this.websocket.readyState){case 0:return"connecting";case 1:return"open";case 2:return"closing";case 3:return"closed";default:return"undefined"}},this.on=function(i,r){"open"==i?e.subscribe(r):"close"==i?t.subscribe(r):"message"==i?l.subscribe(r):"stream"==i?a.subscribe(r):"error"==i&&n.subscribe(r)}}else if(window.EventSource&&this.transport.indexOf("sse")>-1){var r="";this.open=function(){""!==this.host&&""!==this.user&&void 0!==this.user?(void 0==this.password&&""==this.password,""!==this.subprotocol&&void 0!==this.subprotocol?this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\:\/{2}[a-z,0-9,.]{1,}\:[0-9]{1,4}.(.*)/,"$1")+"/sgc/auth/url/"+this.user+"/"+this.password+"/"+this.subprotocol):this.EventSource=new EventSource(this.host.replace(/^[a-z]{2,3}\:\/{2}[a-z,0-9,.]{1,}\:[0-9]{1,4}.(.*)/,"$1")+"/sgc/auth/url/"+this.user+"/"+this.password)):""!==this.host&&""!==this.subprotocol&&void 0!==this.subprotocol?this.EventSource=new EventSource(this.subprotocol):""!==this.host&&(this.EventSource=new EventSource("/")),this.EventSource.onopen=function(){e.fire({name:"onopen",message:""})},this.EventSource.onmessage=function(e){""==r?r=e.data:l.fire({name:"onmessage",message:e.data})},this.EventSource.onerror=function(e){n.fire({name:"onerror",message:e.data})}},void 0==this.EventSource&&this.open(),this.send=function(e){if(""!==r){if(window.XMLHttpRequest)xhr=new XMLHttpRequest;else{if(!window.ActiveXObject)return;xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.open("POST","/sgc/xhr/"+r,!0),xhr.send(e)}},this.close=function(){this.EventSource.close(),t.fire({name:"onclose",message:"",code:1e3,reason:"",clean:!0})},this.state=function(){switch(this.EventSource.readyState){case 0:return"connecting";case 1:return"open";case 2:return"closed";default:return"undefined"}},this.on=function(i,a){"open"==i?e.subscribe(a):"close"==i?t.subscribe(a):"message"==i?l.subscribe(a):"error"==i&&n.subscribe(a)}}else alert("WebSockets not supported by your Browser.")}}var n,a,r;e.Report=function(e){a=e},e.Report.prototype={getWsSocket:function(){return n||(n=new u(a),n.onSavingReport=function(e){var t=window.decodeURIComponent(window.escape(window.atob(e.template)));e.template=t,r&&r.call(e)}),n},onSavingReport:function(e){return void 0===e?r:(r=e,this)},design:function(t,i,l,n,a){e.Checker.test("Report.design#datasets",t).required().isString(),e.Checker.test("Report.design#reportId",i).required().isString(),e.Checker.test("Report.design#reportName",l).required().isString(),e.Checker.test("Report.design#template",n).isString(),e.Checker.test("Report.design#printFields",a).isPlanObject();var r=this._combineReportBo(i,l,t,n,a);return this.getWsSocket().designReport(r),this},preview:function(t,i,l,n,a,r){e.Checker.test("Report.preview#datasets",t).required().isString(),e.Checker.test("Report.preview#reportId",i).required().isString(),e.Checker.test("Report.preview#reportName",l).required().isString(),e.Checker.test("Report.preview#template",n).required().isString(),e.Checker.test("Report.preview#printFields",a).isPlanObject();var s=this._combineReportBo(i,l,t,n,a,r);new u;return this.getWsSocket().previewReport(s),this},print:function(t,i,l,n,a,r){e.Checker.test("Report.print#datasets",t).required().isString(),e.Checker.test("Report.print#reportId",i).required().isString(),e.Checker.test("Report.print#reportName",l).required().isString(),e.Checker.test("Report.print#template",n).required().isString(),e.Checker.test("Report.print#printFields",a).isPlanObject();var s=this._combineReportBo(i,l,t,n,a,r);new u;return this.getWsSocket().printReport(s),this},_combineReportBo:function(e,t,i,l,n,a,r){var s={reportId:e,reportName:t},o=l?window.btoa(window.unescape(window.encodeURIComponent(l))):null;s.template=o;var d=[];s.datasets=d;for(var u,c,h=i.split(","),f=null,p=0,_=h.length;_>p;p++)u=h[p],c=this._createRptDataset(d,u,null,n),r||(a&&(f=a[u]||null),c.rptDataset.data=c.dataset.exportTextArray({exportHeader:!1,recordRange:f,includeFields:c.fieldNames}));return s},_createRptDataset:function(i,l,n,a){var r=e.data.getDataset(l);if(!r)throw new Error(e.formatMessage(t.Report.notFoundDs,l));n||(n=r.description());var s={name:n};i.push(s);var o=[];s.fields=o;var d,u,c=a&&a[l];c&&(d=c&&c.includeFields,u=c&&c.excludeFields);for(var h,f,p,_=r.getNormalFields(),v=[],m=0,g=_.length;g>m;m++)if(h=_[m],p=h.name(),!(d&&d.indexOf(p)<0||u&&u.indexOf(p)>=0)){if(f=h.getType(),h.lookup()&&(f="S"),"V"==f)this._createRptDataset(i,h.detailDataset(),h.label(),a);else if(!h.visible()&&(!d||d.indexOf(p)<0))continue;o.push(e.trim(h.label())+"|"+f),v.push(p)}return{dataset:r,fieldNames:v,rptDataset:s}}},e.defaultReport=new e.Report;var s,o,d,u=function(e){e=e||"127.0.0.1",d="https:"==document.location.protocol,s=d?"wss://"+e+":20169":"ws://"+e+":20167",o="https://"+e+":20169",this.ws=null,this.connected=!1,this.onSavingReport=null,this.needAlert=!0,this.version=null};u.prototype={open:function(i){this.connected=!1;var n=this;this.ws=new l(s),this.ws.on("open",function(e){n.connected=!0,i&&i()}),this.ws.on("message",function(e){var t=e.message,i=JSON.parse(t),l=i.name,a=i.body;"save"==l&&n.onSavingReport&&n.onSavingReport(a),"version"==l&&(n.version=a),n.onMessage&&n.onMessage(i)}),this.ws.on("close",function(){n.connected=!1}),this.ws.on("error",function(i,l){var a=t.Report.tips;d&&n.needAlert?(a+="<br /><br />"+t.Report.tips1,e.ui.confirm(a,null,function(i){"ok"==i&&(e.ui.info(t.Report.ignoreWarning),window.open(o))})):e.ui.info(a),this.connected=!1})},send:function(e){var t=this;this.ws&&this.connected?t._innerSend(e):this.open(function(){t._innerSend(e)})},_innerSend:function(e){if(!this.ws||!this.connected)return void(this.needAlert&&console.log(t.tips));if(e){var i=this.ws.state();if("open"==i){var l=this;try{l.ws.send(JSON.stringify(e))}catch(n){console.error(t.tips)}}}},designReport:function(e){this.needAlert=!0;var t={name:"design",body:e};this.send(t)},previewReport:function(e){this.needAlert=!0;var t={name:"preview",body:e};this.send(t)},printReport:function(e){this.needAlert=!0;var t={name:"print",body:e};this.send(t)},upgrade:function(e){this.needAlert=!1,this.send({name:"upgrade",body:e})},getVersion:function(){var e={name:"version"};this.needAlert=!1,this.send(e)}}}(),e});
//# sourceMappingURL=jslet-ui.min.js.map
